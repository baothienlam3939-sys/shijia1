<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>ä¸–å®¶é£åå½• Â· å…»æˆæœ­è®°</title>
<link 
href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ===================== ã€æ–°å¢ã€‘çº¢ç‚¹æç¤ºæ ·å¼ ===================== */
.tab {
    position: relative; /* ç¡®ä¿çº¢ç‚¹å¯ä»¥æ­£ç¡®å®šä½ */
}
.tab .red-dot {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 10px;
    height: 10px;
    background-color: #c0392b;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 5px rgba(192, 57, 43, 0.8);
}
.utility-tabs-group .tab .red-dot {
    top: 2px;
    right: 2px;
}
/* ======================================================================= */
/* ===================== ã€æ–°å¢ã€‘å¤ç­å°æ¸¸æˆä¸“å±æ ·å¼ (v3) =================== */
/* ======================================================================= */
.guzheng-game-container {
    width: 100%;
    max-width: 400px;
    height: 450px;
    background: linear-gradient(to bottom, #2c3e50, #46425e);
    border: 2px solid #bda27e;
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    margin: 15px auto 5px;
    display: flex;
    justify-content: space-around;
    padding: 0 10px;
}

.guzheng-string {
    width: 2px;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.2);
    position: relative;
}

.guzheng-note {
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 40px;
    background: transparent;
    font-size: 30px;
    color: var(--particle-color);
    text-align: center;
    line-height: 40px;
    animation: fall linear forwards;
}

@keyframes fall {
    from { top: -40px; transform: translateX(-50%) rotate(0deg); }
    to { top: 100%; transform: translateX(-50%) rotate(360deg); }
}

.guzheng-hit-line {
    position: absolute;
    bottom: 10%;
    left: 0;
    width: 100%;
    height: 3px;
    background: rgba(255, 215, 0, 0.8);
    box-shadow: 0 0 10px 2px #FFD700;
    z-index: 2; /* ç¡®ä¿åˆ¤å®šçº¿åœ¨æœ€ä¸Šå±‚ */
}

/* [æ ¸å¿ƒæ–°å¢] å®Œç¾åŒºåŸŸçš„æ ·å¼ */
.guzheng-perfect-zone {
    position: absolute;
    bottom: calc(10% - 18px); /* (åˆ¤å®šçº¿ä½ç½® - åŒºåŸŸé«˜åº¦çš„ä¸€åŠ) + åˆ¤å®šçº¿é«˜åº¦ä¸€åŠ */
    left: 0;
    width: 100%;
    height: 40px; /* å®Œç¾åŒºåŸŸçš„é«˜åº¦ */
    background: rgba(255, 255, 255, 0.1);
    border-top: 1px dashed rgba(255, 255, 255, 0.3);
    border-bottom: 1px dashed rgba(255, 255, 255, 0.3);
    z-index: 1;
}

.guzheng-hit-buttons-container {
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-around;
    padding: 0 10px;
}

.guzheng-hit-button {
    flex: 1;
    height: 60px;
    margin: 0 5px;
    border: 2px solid var(--decorator-color);
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.1s ease;
}

.guzheng-hit-button:active, .guzheng-hit-button.active {
    background: var(--highlight-strong);
    transform: scale(0.98);
}

.guzheng-feedback {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3rem;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 5px rgba(0,0,0,0.7);
    opacity: 0;
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    pointer-events: none;
    z-index: 3;
}
.guzheng-feedback.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.2);
}

/* ã€æ–°å¢ã€‘è¿™æ®µCSSä»£ç å¯ä»¥æ”¾åœ¨<style>æ ‡ç­¾çš„ä»»æ„ä½ç½® */
.quantity-slider-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 20px 0;
}
.quantity-slider-container input[type="range"] {
    flex-grow: 1;
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 8px;
    background: var(--progress-bg);
    border-radius: 5px;
    outline: none;
}
.quantity-slider-container input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: var(--highlight-strong);
    cursor: pointer;
    border-radius: 50%;
}
.quantity-slider-container input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: var(--highlight-strong);
    cursor: pointer;
    border-radius: 50%;
}
.quantity-slider-container input[type="number"] {
    width: 70px;
    text-align: center;
    font-size: 1.1rem;
    border: 1px solid var(--border-color-light);
    border-radius: 8px;
    padding: 5px;
}
.inventory-container { display: flex; flex-direction: column; gap: 10px; max-height: 250px; overflow-y: auto; padding-right: 5px;}
.inventory-item { display: flex; align-items: center; background: var(--event-bg); padding: 10px; border-radius: 8px; border-left: 4px solid var(--decorator-color); }
.inventory-item-icon { font-size: 1.5rem; margin-right: 15px; color: var(--highlight-strong); width: 30px; text-align:center; }
.inventory-item-details { flex-grow: 1; }
.inventory-item-name { font-weight: bold; }
.inventory-item-type { font-size: 0.8em; background: var(--progress-bg); padding: 2px 6px; border-radius: 10px; margin-left: 5px; color: var(--text-color); }
.inventory-item-desc { font-size: 0.9em; color: var(--text-comment); margin-top: 4px; }
/* --- å…¨å±€ä¸åŸºç¡€æ ·å¼ --- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Noto Serif SC', serif;
    transition: all 0.3s ease;
}

html {
    width: 100%;
    height: 100%;
}
body {
    width: 100%;
    min-height: 100%; /* å…è®¸å†…å®¹è¶…å‡ºå±å¹•æ—¶é¡µé¢å¯ä»¥æ»šåŠ¨ */
    overflow-x: hidden; /* é˜²æ­¢æ¨ªå‘æ»šåŠ¨ */
    color: var(--text-color);
    padding: 10px;
    font-size: 16px;
    position: relative;
    background: var(--bg-gradient);
    display: flex;
    flex-direction: column;
}
.container-wrapper {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: thin;
    scrollbar-color: var(--decorator-color) transparent;
}
.container-wrapper::-webkit-scrollbar {
    width: 5px;
}
.container-wrapper::-webkit-scrollbar-track {
    background: transparent;
}
.container-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--decorator-color);
    border-radius: 10px;
    border: 3px solid transparent;
}


.container {
    max-width: 100%;
    margin: 0 auto;
    padding-bottom: 20px;
}

/* --- ä¸»é¢˜åˆ‡æ¢ --- */
.theme-switcher {
    position: absolute;
    top: 18px;
    right: 18px;
    display: flex;
    gap: 5px;
    background: rgba(255, 255, 255, 0.2);
    padding: 5px;
    border-radius: 20px;
    z-index: 100;
    backdrop-filter: blur(5px);
}
.theme-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 14px;
}
.theme-icon.active {
    border-color: var(--accent-color-deep);
    transform: scale(1.2);
}
#theme-spring { background: #ffc0cb; color: #fff; }
#theme-summer { background: #98fb98; color: #fff; }
#theme-autumn { background: #ffdab9; color: #fff; }
#theme-winter { background: #add8e6; color: #fff; }
#theme-night { background: #46425e; color: #fff; }


/* --- æ¸¸æˆä¸»å¡ç‰‡æ ·å¼ --- */
.game-block {
    background: var(--card-bg);
    border: 2px solid var(--border-color);
    border-radius: 20px;
    padding: 18px;
    margin-bottom: 18px;
    font-family: 'Noto Serif SC', serif;
    color: var(--text-color);
    line-height: 1.8;
    box-shadow: 0 6px 20px var(--shadow-color);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    overflow-x: hidden;
    word-wrap: break-word;
}

.game-block p { margin-bottom: 8px; }
.game-block strong { color: var(--highlight-strong); }
.game-block .value { color: var(--highlight-value); font-weight: bold; }
.game-block .comment { color: var(--text-comment); font-style: italic; font-size: 0.9em; }
.game-block .highlight-npc { color: var(--highlight-npc); font-weight: bold; cursor: pointer; }
.game-block .highlight-npc:hover { text-decoration: underline; }
.game-block .highlight-secret { color: #c0392b; font-weight: bold; text-shadow: 0 0 5px rgba(255, 100, 100, 0.7); }


/* --- å¡ç‰‡é€šç”¨æ ·å¼ --- */
.card-header {
    text-align: center;
    margin-bottom: 20px;
    color: var(--header-color);
    font-size: 1.6rem;
    font-weight: bold;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border-color-light);
    position: relative;
    font-family: 'Ma Shan Zheng', cursive;
}

.card-header::before, .card-header::after {
    content: var(--header-decorator);
    margin: 0 10px;
    color: var(--decorator-color);
    font-size: 1.2rem;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* --- åŠ¨æ€é£˜æ´’æ•ˆæœ --- */
.particle-container {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; overflow: hidden; z-index: 9999;
}

.particle {
    position: absolute;
    opacity: 0.7;
    animation: fall linear forwards;
    background-size: contain;
    background-repeat: no-repeat;
    font-size: 20px;
    color: var(--particle-color);
    user-select: none;
}

@keyframes fall {
    to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* --- ç©å®¶ä¿¡æ¯ä¸å±æ€§æ¡ --- */
.character-info { display: flex; align-items: center; margin-bottom: 20px; gap: 18px; }
.avatar-wrapper {
    position: relative;
    width: 100px; height: 100px;
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
    background: var(--avatar-bg);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border: 4px solid #fff;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
}
.avatar-image {
    width: 100%; height: 100%; object-fit: cover;
    position: absolute; top: 0; left: 0;
    display: none; /* é»˜è®¤éšè— */
}
.avatar-svg { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
.info-details { flex: 1; position: relative; }
.info-row { display: flex; margin-bottom: 8px; font-size: 0.95rem; align-items: center; }
.info-label { width: 80px; font-weight: bold; color: var(--info-label-color); }
.attributes-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0 15px;}
.attribute { margin-bottom: 15px; }
.attribute-name { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.95rem; }
.progress-bar { height: 14px; background-color: var(--progress-bg); border-radius: 7px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
.progress-fill { height: 100%; border-radius: 7px; background: var(--progress-fill-talent); transition: width 0.5s ease-out; }
.talent-fill { background: var(--progress-fill-talent); }
.etiquette-fill { background: var(--progress-fill-etiquette); }
.wisdom-fill { background: var(--progress-fill-wisdom); }
.health-fill { background: var(--progress-fill-health); }
.virtue-fill { background: var(--progress-fill-virtue); }
.charm-fill { background: var(--progress-fill-charm); }
.martial-fill { background: var(--progress-fill-martial); }


/* --- é¡¶éƒ¨çŠ¶æ€æ  --- */
.status-bar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
}
.status-item {
    background: var(--status-item-bg);
    padding: 10px 15px; border-radius: 20px; font-size: 0.9rem;
    display: flex; align-items: center; border: 1px solid var(--status-border-color);
    box-shadow: 0 3px 6px rgba(0,0,0,0.08);
}
.status-item i { margin-right: 8px; color: var(--status-icon-color); }
.status-item.disease { background: linear-gradient(to right, #fff0f0, #ffe8e8); border-color: #ffcccc; color: #c0392b; }
.status-item.disease i { color: #c0392b; }

/* --- æ ‡ç­¾é¡µç³»ç»Ÿ --- */
.tab-container {
    display: flex; margin-bottom: 15px; border-bottom: 1px solid var(--tab-border-color); overflow-x: auto; -ms-overflow-style: none; scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
}
.tab-container::-webkit-scrollbar { display: none; }
.tab {
    padding: 12px 18px; cursor: pointer; border-bottom: 4px solid transparent;
    white-space: nowrap; font-size: 1rem; border-radius: 8px 8px 0 0;
    flex-shrink: 0;
    color: var(--tab-color);
}
.tab:hover { background-color: var(--tab-hover-bg); color: var(--tab-hover-color); }
.tab.active { border-bottom: 4px solid var(--tab-active-border); color: var(--tab-active-color); font-weight: bold; background-color: var(--tab-active-bg); }
.tab.disabled {
    color: var(--text-comment);
    cursor: not-allowed;
    background-color: transparent;
    opacity: 0.6;
}
.tab.disabled:hover { background-color: transparent; }
.tab-content { display: none; animation: fadeIn 0.5s forwards; }
.tab-content.active { display: block; }

.section-header {
    margin-top: 20px;
    margin-bottom: 10px;
    font-size: 1.1rem;
    color: var(--highlight-strong);
    padding-bottom: 5px;
    border-bottom: 1px dashed var(--border-color-light);
    display:flex; align-items:center;
}
.section-header i { margin-right:8px; font-size:1.2rem; }


/* --- é€‰é¡¹ä¸æ§åˆ¶æŒ‰é’® --- */
.options { margin-top: 15px; display: flex; flex-direction: column; gap: 12px; }
.option {
    background: var(--option-bg);
    color: white; border: none; border-radius: 30px;
    padding: 15px 22px; width: 100%;
    text-align: left; cursor: pointer; font-size: 1rem;
    box-shadow: 0 5px 15px var(--option-shadow);
    display: flex; align-items: center; position: relative; overflow: hidden;
}
.option:hover { transform: translateY(-3px); box-shadow: 0 8px 20px var(--option-shadow-hover); }
.option:active { transform: translateY(0); box-shadow: 0 2px 5px var(--option-shadow-active); }
.option i { margin-right: 12px; font-size: 1.3rem; width: 20px; text-align: center; }
.option .option-text { flex-grow: 1; }
.option .option-text small { display: block; opacity: 0.85; font-size: 0.8em; margin-top: 4px; }
.option:disabled {
    background: #dcdcdc !important;
    cursor: not-allowed;
    box-shadow: none; transform: none; opacity: 0.7;
}

.controls { display: flex; justify-content: space-between; margin-top: 15px; gap: 10px; flex-wrap: wrap; }
.control-btn {
    background: var(--control-bg);
    color: white; border: none; border-radius: 30px;
    padding: 14px 18px; cursor: pointer; font-size: 0.95rem; flex: 1;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 5px 15px var(--control-shadow);
    min-width: 120px;
    transition: all 0.2s ease-in-out;
}
.control-btn i { margin-right: 8px;}
.control-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px var(--control-shadow-hover); }
.control-btn:active { transform: translateY(0); box-shadow: 0 2px 5px var(--control-shadow-active); }

/* --- å†…å®¹æ ·å¼ --- */
.event-log { max-height: 400px; overflow-y: auto; padding-right: 10px; }
.event-log::-webkit-scrollbar { width: 6px; }
.event-log::-webkit-scrollbar-thumb { background-color: var(--decorator-color); border-radius: 10px; }
.event {
    background: var(--event-bg); padding: 15px; border-radius: 12px; margin-bottom: 12px;
    border-left: 5px solid var(--event-border);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    animation: fadeIn 0.3s ease-out;
}
.event-content { line-height: 1.7; font-size: 0.98rem; }

/* --- å©šæ‹ä¸å­å—£å¡ç‰‡ --- */
.suitor {
    display: flex; padding: 15px; margin-bottom: 12px;
    background: var(--suitor-bg);
    border-radius: 12px; border: 1px solid var(--suitor-border); align-items: center; cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    transition: all 0.2s ease-in-out;
}
.suitor:hover { box-shadow: 0 4px 12px var(--suitor-shadow-hover); transform: translateY(-3px); }
.suitor-avatar-wrapper {
    width: 60px; height: 60px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin-right: 15px; flex-shrink: 0;
    overflow: hidden;
    position: relative;
    border: 3px solid rgba(255,255,255,0.8);
    background:var(--avatar-bg);
}
.suitor-avatar { width: 100%; height: 100%; object-fit: cover; }
.suitor-avatar-text { font-size: 2.2rem; color: white; font-family: 'Ma Shan Zheng', cursive; }
.suitor-details { flex: 1; }
.suitor-name { font-weight: bold; margin-bottom: 5px; font-size: 1.1rem; }
.suitor-desc { font-size: 0.9rem; color: var(--text-comment); line-height: 1.5; }
.suitor-stats { display: flex; margin-top: 8px; gap: 10px; flex-wrap: wrap; }
.stat { font-size: 0.8rem; background: var(--stat-bg); padding: 4px 10px; border-radius: 15px; color: var(--stat-color); }
.stat i { margin-right: 5px; }

.child-card {
    background: linear-gradient(to right, #fffcf0, #fff5e6);
    padding: 15px; border-radius: 12px; margin-bottom: 12px;
    border-left: 5px solid #ffd47a;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    display: flex; align-items: center; gap: 15px;
}
.child-name { font-weight: bold; color: #cc8433; margin-bottom: 8px; display: flex; align-items: center; font-size: 1.1rem; }
.child-name i { margin-right: 10px; font-size: 1.2rem; }
.child-details { font-size: 0.95rem; line-height: 1.6; flex: 1;}
.child-btn-group { display: flex; flex-direction: column; gap: 8px;}
.child-cultivate-btn {
    background: linear-gradient(135deg, #f4a261, #e76f51); color: white;
    border: none; border-radius: 20px; padding: 10px 15px;
    font-size: 0.9rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    flex-shrink: 0;
}
.concubine-card {
    background: linear-gradient(to right, #fcfcfc, #fef5f8);
    padding: 15px; border-radius: 12px; margin-bottom: 12px;
    border-left: 5px solid #ffbfd3;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.concubine-name { font-weight: bold; color: #e06c9e; margin-bottom: 8px; display: flex; align-items: center; font-size: 1.1rem; }
.concubine-name i { margin-right: 10px; font-size: 1.2rem; }
.concubine-details { font-size: 0.95rem; line-height: 1.6; }
.intimate-scene {
    font-size: 0.95em; color: #880044; background: #fff0f5;
    padding: 12px; border-radius: 8px; margin-top: 10px;
    border-left: 4px solid #ff69b4; font-style: italic;
}
.intimate-scene i { color: #d84381; margin-right: 5px; }

/* --- åä¸½å©šç¤¼ & ä¼ æ‰¿ç•Œé¢ --- */
.overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--overlay-bg);
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    z-index: 10000; animation: fadeIn 0.5s forwards;
    display: none; padding: 10px;
}
.overlay-card {
    background: var(--card-bg);
    border-radius: 25px; padding: 35px; text-align: center; width: 100%; max-width: 500px;
    box-shadow: 0 12px 35px var(--overlay-shadow); border: 2px solid var(--overlay-border);
    position: relative; overflow: hidden;
}
.overlay-close-btn {
    position: absolute; top: 15px; right: 15px;
    background: rgba(0,0,0,0.1); color: var(--text-color);
    border: none; width: 30px; height: 30px;
    border-radius: 50%; font-size: 1.2rem;
    cursor: pointer; line-height:30px;
}
.overlay-close-btn:hover { background: rgba(0,0,0,0.2); }
.overlay-content-wrapper {
    max-height: calc(85vh - 150px);
    overflow-y: auto;
    padding: 0 15px;
    margin-bottom: 20px;
    scrollbar-width: thin;
    scrollbar-color: var(--highlight-strong) transparent;
}
.overlay-content-wrapper::-webkit-scrollbar { width: 5px; }
.overlay-content-wrapper::-webkit-scrollbar-thumb { background-color: var(--highlight-strong); border-radius: 10px;}

.overlay-header { font-size: 2.2rem; color: var(--overlay-header-color); margin-bottom: 25px; text-shadow: 1px 1px 3px rgba(0,0,0,0.1); font-family: 'Ma Shan Zheng', cursive; }
.overlay-content { line-height: 1.8; margin-bottom: 15px; color: var(--text-color); }
.overlay-name { font-weight: bold; color: var(--overlay-header-color); font-size: 1.4rem; margin: 10px 0; display: inline-block; }
.overlay-animation { font-size: 3.5rem; margin: 20px 0; animation: float 3s infinite ease-in-out; color: var(--overlay-animation-color); }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

/* NPC Detail & Other Specific Overlays */
#npcDetailOverlay .overlay-card, #clinicOverlay .overlay-card, #careerChallengeOverlay .overlay-card, #debugOverlay .overlay-card, #fengYueJianOverlay .overlay-card, #arrangedMarriageOverlay .overlay-card, #childMarriageOverlay .overlay-card, #newFriendEncounterOverlay .overlay-card, #matchmakerOverlay .overlay-card {
    text-align: left; padding: 30px;
}
#npcDetailOverlay .overlay-header, #clinicOverlay .overlay-header, #careerChallengeOverlay .overlay-header, #debugOverlay .overlay-header, #fengYueJianOverlay .overlay-header, #arrangedMarriageOverlay .overlay-header, #childMarriageOverlay .overlay-header, #newFriendEncounterOverlay .overlay-header, #matchmakerOverlay .overlay-header { text-align: center; margin-bottom: 15px; padding-bottom: 10px; }
#npcDetailOverlay .npc-detail-section {
    margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px dashed var(--border-color-light);
}
#npcDetailOverlay .npc-detail-section:last-child { border-bottom: none; padding-bottom: 0; margin-bottom: 0; }
#npcDetailOverlay .npc-detail-section h4 {
    color: var(--highlight-strong); font-size: 1.1rem; margin-bottom: 10px; display: flex; align-items: center;
}
#npcDetailOverlay .npc-detail-section h4 i { margin-right: 8px; font-size: 1.2rem; }
#npcDetailOverlay .npc-detail-section p { font-size: 0.95rem; line-height: 1.6; margin-bottom: 5px; }
#npcDetailOverlay .npc-detail-section .attribute { margin-bottom: 8px; }
#debugOverlay .input-group { margin-top: 15px; }
#debugOverlay .input-group input, #debugOverlay .input-group select {
    width: calc(100% - 20px); padding: 10px; border-radius: 8px; display: block;
    border: 1px solid var(--border-color-light); margin: 0 auto 10px; font-size:1rem;
}

/* Child Naming Overlay */
#nameChildOverlay .overlay-card { max-width: 80%; padding: 25px; }
#nameChildOverlay input {
    width: calc(100% - 20px); padding: 12px; margin: 15px auto; display: block;
    border-radius: 10px; border: 1px solid var(--border-color-light);
    font-size: 1.1rem; color: var(--text-color); text-align: center;
}
#nameChildOverlay input:focus {
    outline: none; border-color: var(--highlight-strong);
    box-shadow: 0 0 5px var(--shadow-color);
}
#rankingsOverlay .ranking-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border-color-light); align-items: center; }
#rankingsOverlay .ranking-item.player { background: var(--border-color-light); font-weight: bold; }
.rank-num { font-weight: bold; color: var(--highlight-strong); width: 30px; text-align: center;}


/* --- å…¶ä»– --- */
.loading-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: var(--loading-bg);
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    z-index: 10001; font-size: 1.3rem; color: var(--loading-text);
}
.loading-spinner {
    width: 60px; height: 60px; border: 6px solid var(--loading-spinner-bg);
    border-radius: 50%; border-top-color: var(--loading-spinner-fg);
    animation: spin 1s linear infinite; margin-bottom: 20px;
}
@keyframes spin { to { transform: rotate(360deg); } }
.toast {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    background-color: rgba(90, 45, 82, 0.9); color: white;
    padding: 15px 30px; border-radius: 30px; z-index: 10002;
    opacity: 0; transition: opacity 0.5s, bottom 0.5s; font-size: 1rem;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    pointer-events: none;
}
.toast.show { opacity: 1; bottom: 50px; }
.marketplace-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 0; border-bottom: 1px dashed var(--border-color-light);
}
.marketplace-item:last-child { border-bottom: none; }
.marketplace-item span { color: var(--text-color); }
.marketplace-item button {
    background: var(--control-bg); color: white; border: none; padding: 8px 12px;
    border-radius: 20px; cursor: pointer; font-size: 0.85rem;
    flex-shrink: 0;
    margin-left: 10px;
}

/* Save/Load Overlay */
.save-slot {
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid var(--border-color);
    border-radius: 15px; padding: 15px; margin-bottom: 12px;
    display: flex; justify-content: space-between; align-items: center;
    cursor: pointer;
}
.save-slot:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
.save-slot.empty { background: rgba(255, 255, 255, 0.4); font-style: italic; color: #888; }
.slot-info { flex-grow: 1; }
.slot-info .slot-title { font-weight: bold; color: var(--highlight-strong); margin-bottom: 5px; }
.slot-info .slot-details { font-size: 0.9em; color: var(--text-comment); }
.slot-actions button {
    background: none; border: none; font-size: 1.2rem; cursor: pointer;
    margin-left: 10px; color: #ff6b6b;
}
.slot-actions button:hover { color: #e74c3c; }

.decision-options {
    display: flex; justify-content: center; gap: 20px; margin-top: 25px; flex-wrap: wrap;
}

/* [æ›¿æ¢] ç§»åŠ¨ç«¯ä¼˜åŒ–ä»£ç  */
@media (max-width: 768px) { /* ä½¿ç”¨ 768px å…¼å®¹æ›´å¤šè®¾å¤‡ */
    body {
        padding: 5px;
        font-size: 15px; /* è°ƒæ•´åŸºç¡€å­—å· */
    }
    .game-block {
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 15px; /* æ›´åœ†æ¶¦çš„å¡ç‰‡ */
    }
    .card-header {
        font-size: 1.5rem;
    }
    .character-info {
        flex-direction: column;
        text-align: center;
        gap: 10px;
    }
    .info-details {
        width: 100%;
    }
    .info-row {
        justify-content: center;
    }
    .attributes-grid {
        grid-template-columns: 1fr; /* å±æ€§å•åˆ—æ˜¾ç¤º */
        gap: 0;
    }
    .status-bar {
        grid-template-columns: 1fr 1fr; /* çŠ¶æ€æ ä¸¤åˆ—æ˜¾ç¤º */
    }
    .tab-container {
        flex-wrap: wrap; /* æ ‡ç­¾é¡µå…è®¸æ¢è¡Œ */
        justify-content: center;
    }
    .tab {
        padding: 10px 15px;
        font-size: 0.95rem;
    }
    .options {
        gap: 10px;
    }
    .option {
        padding: 12px 20px;
        font-size: 0.95rem;
    }
    .controls {
        flex-direction: row;
        flex-wrap: wrap;
    }
    .control-btn {
        min-width: calc(50% - 5px); /* ç¡®ä¿ä¸€è¡Œä¸¤ä¸ªæŒ‰é’® */
        padding: 12px 15px;
    }
    .suitor {
        flex-direction: column;
        text-align: center;
    }
    .suitor-avatar-wrapper {
        margin: 0 auto 15px;
    }
    .suitor-stats {
        justify-content: center;
    }
    .child-card {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
    }
    .child-btn-group {
        margin-top: 10px;
        flex-direction: row;
        justify-content: center;
    }
    .overlay-card {
        padding: 25px 15px;
        width: 95%;
        max-height: 90vh;
    }
    .overlay-header {
        font-size: 1.8rem;
        margin-bottom: 15px;
}
/* ã€ä¿®å¤ã€‘ç²˜è´´è¿™æ®µä»£ç åˆ° @media (max-width: 768px) { ... } ä»£ç å—çš„å†…éƒ¨ */
.tab-container {
    flex-direction: column; /* è®©ä¸»æ ‡ç­¾ç»„å’Œå·¥å…·æ ‡ç­¾ç»„å‚ç›´å †å  */
    align-items: center;    /* è®©ä¸¤ç»„åœ¨å‚ç›´è½´çº¿ä¸Šå±…ä¸­ */
    gap: 5px;               /* åœ¨ä¸¤è¡Œæ ‡ç­¾ä¹‹é—´å¢åŠ ä¸€ç‚¹é—´è· */
}
.main-tabs-group, .utility-tabs-group {
    width: 100%;             /* è®©æ¯ä¸ªç»„éƒ½å æ®å…¨éƒ¨å®½åº¦ï¼Œä»¥ä¾¿å†…éƒ¨å±…ä¸­ */
    justify-content: center; /* å†…éƒ¨çš„æ ‡ç­¾å±…ä¸­æ’åˆ— */
    margin-left: 0 !important; /* å¼ºåˆ¶è¦†ç›–JSæ·»åŠ çš„ margin-left: auto */
    flex-direction: row !important; /* å¼ºåˆ¶è¦†ç›–JSæ·»åŠ çš„ flex-direction: column */
}
    .theme-switcher {
        top: 8px; right: 8px;
        padding: 4px;
    }
    .theme-icon {
        width: 22px; height: 22px; font-size: 12px;
    }
}
/* æŒ‰é’®åŠ è½½çŠ¶æ€ */
.button-loading {
    position: relative;
    pointer-events: none;
    color: transparent !important;
}
.button-loading i {
    color: transparent !important;
}
.button-loading::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

:root {
    --bg-gradient: linear-gradient(135deg, #fdf6f9 0%, #fff0f5 100%);
    --text-color: #5a2d52;
    --text-comment: #b3a7a9;
    --card-bg: rgba(255, 255, 255, 0.7);
    --border-color: #ffe8f0;
    --border-color-light: #ffcee7;
    --shadow-color: rgba(255, 192, 203, 0.35);
    --highlight-strong: #d84381;
    --highlight-value: #8e44ad;
    --highlight-npc: #e06c9e;
    --header-color: #d84381;
    --header-decorator: "â€";
    --decorator-color: #ff91ad;
    --particle-content: 'ğŸŒ¸';
    --particle-color: #ffb6c1;
    --avatar-bg: linear-gradient(135deg, #ffc0cb 0%, #db7093 100%);
    --info-label-color: #c71585;
    --progress-bg: #ffe5e5;
    --progress-fill-talent: linear-gradient(to right, #ff66b2, #ff4da6);
    --progress-fill-etiquette: linear-gradient(to right, #9370db, #7b68ee);
    --progress-fill-wisdom: linear-gradient(to right, #20b2aa, #48d1cc);
    --progress-fill-health: linear-gradient(to right, #3cb371, #2e8b57);
    --progress-fill-virtue: linear-gradient(to right, #f4a261, #e76f51);
    --progress-fill-charm: linear-gradient(to right, #a7c957, #6a9ac9);
    --progress-fill-martial: linear-gradient(to right, #e74c3c, #c0392b);
    --status-item-bg: linear-gradient(to right, #fff8fb, #ffe8f0);
    --status-border-color: #ffd8e8;
    --status-icon-color: #e06c9e;
    --tab-border-color: #ffb6c1;
    --tab-color: #8c7386;
    --tab-hover-bg: #fff9fc;
    --tab-hover-color: #ff85c1;
    --tab-active-border: #ff69b4;
    --tab-active-color: #ff69b4;
    --tab-active-bg: #fffafb;
    --option-bg: linear-gradient(135deg, #ff9ebf, #ff69b4);
    --option-shadow: rgba(219, 112, 147, 0.25);
    --option-shadow-hover: rgba(219, 112, 147, 0.35);
    --option-shadow-active: rgba(219, 112, 147, 0.2);
    --control-bg: linear-gradient(135deg, #9bbde0, #6a9ac9);
    --control-shadow: rgba(132, 169, 192, 0.35);
    --control-shadow-hover: rgba(132, 169, 192, 0.45);
    --control-shadow-active: rgba(132, 169, 192, 0.2);
    --event-bg: #fffcfc;
    --event-border: #ff9dbd;
    --suitor-bg: linear-gradient(to right, #f0f8ff, #e6f7ff);
    --suitor-border: #c0d8ff;
    --suitor-shadow-hover: rgba(65, 105, 225, 0.12);
    --stat-bg: #e6f0ff;
    --stat-color: #4169e1;
    --overlay-bg: rgba(255, 245, 247, 0.98);
    --overlay-card-bg: linear-gradient(135deg, #ffd1e4 0%, #ffa7c9 100%);
    --overlay-shadow: rgba(219, 112, 147, 0.4);
    --overlay-border: #ff85c1;
    --overlay-header-color: #c71585;
    --overlay-animation-color: #ff69b4;
    --loading-bg: rgba(255, 245, 247, 0.98);
    --loading-text: #db7093;
    --loading-spinner-bg: #ffb6c1;
    --loading-spinner-fg: #db7093;
    --accent-color-deep: #d84381;
}

[data-theme="summer"] {
    --bg-gradient: linear-gradient(135deg, #f0fff0 0%, #e6ffe6 100%);
    --text-color: #2e8b57;
    --text-comment: #556b2f;
    --card-bg: rgba(255, 255, 255, 0.8);
    --border-color: #c1ffc1;
    --border-color-light: #b4eeb4;
    --shadow-color: rgba(60, 179, 113, 0.3);
    --highlight-strong: #3cb371;
    --highlight-value: #20b2aa;
    --highlight-npc: #2e8b57;
    --header-color: #2e8b57;
    --header-decorator: "ğŸŒ¿";
    --decorator-color: #3cb371;
    --particle-content: 'ğŸƒ';
    --particle-color: #98fb98;
    --avatar-bg: linear-gradient(135deg, #98fb98 0%, #3cb371 100%);
    --info-label-color: #2e8b57;
    --progress-bg: #e0eee0;
    --status-item-bg: linear-gradient(to right, #f5fff5, #e6ffe6);
    --status-border-color: #c1ffc1;
    --status-icon-color: #3cb371;
    --tab-border-color: #90ee90;
    --tab-color: #556b2f;
    --tab-hover-bg: #fafffa;
    --tab-hover-color: #3cb371;
    --tab-active-border: #2e8b57;
    --tab-active-color: #2e8b57;
    --tab-active-bg: #f0fff0;
    --option-bg: linear-gradient(135deg, #8fbc8f, #3cb371);
    --option-shadow: rgba(60, 179, 113, 0.25);
    --option-shadow-hover: rgba(60, 179, 113, 0.35);
    --option-shadow-active: rgba(60, 179, 113, 0.2);
    --event-bg: #fafffa;
    --event-border: #66cdaa;
    --overlay-bg: rgba(240, 255, 240, 0.98);
    --overlay-card-bg: linear-gradient(135deg, #c1ffc1 0%, #90ee90 100%);
    --overlay-shadow: rgba(46, 139, 87, 0.4);
    --overlay-border: #3cb371;
    --overlay-header-color: #2e8b57;
    --overlay-animation-color: #32cd32;
    --loading-bg: rgba(240, 255, 240, 0.98);
    --loading-text: #2e8b57;
    --loading-spinner-bg: #98fb98;
    --loading-spinner-fg: #2e8b57;
    --accent-color-deep: #2e8b57;
}

[data-theme="autumn"] {
    --bg-gradient: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    --text-color: #8d6e63;
    --text-comment: #a1887f;
    --card-bg: rgba(255, 255, 255, 0.8);
    --border-color: #ffe082;
    --border-color-light: #ffd54f;
    --shadow-color: rgba(255, 167, 38, 0.3);
    --highlight-strong: #d35400;
    --highlight-value: #bf360c;
    --highlight-npc: #e65100;
    --header-color: #f57c00;
    --header-decorator: "ğŸ";
    --decorator-color: #ffa726;
    --particle-content: 'ğŸ‚';
    --particle-color: #ffb74d;
    --avatar-bg: linear-gradient(135deg, #ffcc80 0%, #ff9800 100%);
    --info-label-color: #d84315;
    --progress-bg: #fff3e0;
    --status-item-bg: linear-gradient(to right, #fffaf2, #ffecb3);
    --status-border-color: #ffe0b2;
    --status-icon-color: #f57c00;
    --tab-border-color: #ffca28;
    --tab-color: #795548;
    --tab-hover-bg: #fff8e1;
    --tab-hover-color: #fb8c00;
    --tab-active-border: #f57c00;
    --tab-active-color: #f57c00;
    --tab-active-bg: #fffde7;
    --option-bg: linear-gradient(135deg, #ffb74d, #ff9100);
    --option-shadow: rgba(255, 145, 0, 0.25);
    --option-shadow-hover: rgba(255, 145, 0, 0.35);
    --option-shadow-active: rgba(255, 145, 0, 0.2);
    --event-bg: #fffaf0;
    --event-border: #ffab40;
    --overlay-bg: rgba(255, 248, 225, 0.98);
    --overlay-card-bg: linear-gradient(135deg, #ffe0b2 0%, #ffca28 100%);
    --overlay-shadow: rgba(239, 108, 0, 0.4);
    --overlay-border: #ffa000;
    --overlay-header-color: #e65100;
    --overlay-animation-color: #ff6d00;
    --loading-bg: rgba(255, 248, 225, 0.98);
    --loading-text: #e65100;
    --loading-spinner-bg: #ffcc80;
    --loading-spinner-fg: #e65100;
    --accent-color-deep: #e65100;
}

[data-theme="winter"] {
    --bg-gradient: linear-gradient(135deg, #f0f8ff 0%, #e6e6fa 100%);
    --text-color: #4682b4;
    --text-comment: #708090;
    --card-bg: rgba(255, 255, 255, 0.85);
    --border-color: #d1e3ff;
    --border-color-light: #b0c4de;
    --shadow-color: rgba(100, 149, 237, 0.3);
    --highlight-strong: #4169e1;
    --highlight-value: #0000cd;
    --highlight-npc: #1e90ff;
    --header-color: #00bfff;
    --header-decorator: "â„ï¸";
    --decorator-color: #87cefa;
    --particle-content: 'â…';
    --particle-color: #e0ffff;
    --avatar-bg: linear-gradient(135deg, #b0e0e6 0%, #4682b4 100%);
    --info-label-color: #483d8b;
    --progress-bg: #e6f0ff;
    --status-item-bg: linear-gradient(to right, #f5faff, #e6f7ff);
    --status-border-color: #d6eaff;
    --status-icon-color: #6495ed;
    --tab-border-color: #add8e6;
    --tab-color: #607b8b;
    --tab-hover-bg: #f0f8ff;
    --tab-hover-color: #4682b4;
    --tab-active-border: #1e90ff;
    --tab-active-color: #1e90ff;
    --tab-active-bg: #f5faff;
    --option-bg: linear-gradient(135deg, #87ceeb, #4682b4);
    --option-shadow: rgba(70, 130, 180, 0.25);
    --option-shadow-hover: rgba(70, 130, 180, 0.35);
    --option-shadow-active: rgba(70, 130, 180, 0.2);
    --event-bg: #f8faff;
    --event-border: #87cefa;
    --overlay-bg: rgba(240, 248, 255, 0.98);
    --overlay-card-bg: linear-gradient(135deg, #d4e8ff 0%, #a7c7e7 100%);
    --overlay-shadow: rgba(70, 130, 180, 0.4);
    --overlay-border: #4169e1;
    --overlay-header-color: #00008b;
    --overlay-animation-color: #1e90ff;
    --loading-bg: rgba(240, 248, 255, 0.98);
    --loading-text: #4682b4;
    --loading-spinner-bg: #add8e6;
    --loading-spinner-fg: #4682b4;
    --accent-color-deep: #00008b;
}

[data-theme="night"] {
    --bg-gradient: linear-gradient(135deg, #262626 0%, #171717 100%);
    --text-color: #e2e8f0;
    --text-comment: #94a3b8;
    --card-bg: rgba(39, 39, 42, 0.75);
    --border-color: #404040;
    --border-color-light: #525252;
    --shadow-color: rgba(0, 0, 0, 0.6);
    --highlight-strong: #facc15;
    --highlight-value: #fbbf24;
    --highlight-npc: #60a5fa;
    --header-color: #fde047;
    --header-decorator: "ğŸŒ™";
    --decorator-color: #facc15;
    --particle-content: 'âœ¨';
    --particle-color: #fde047;
    --avatar-bg: linear-gradient(135deg, #475569, #1e293b);
    --info-label-color: #93c5fd;
    --progress-bg: #404040;
    --status-item-bg: linear-gradient(to right, #262626, #404040);
    --status-border-color: #525252;
    --status-icon-color: #facc15;
    --tab-border-color: #525252;
    --tab-color: #94a3b8;
    --tab-hover-bg: #404040;
    --tab-hover-color: #e2e8f0;
    --tab-active-border: #facc15;
    --tab-active-color: #fde047;
    --tab-active-bg: #262626;
    /* ã€ä¿®æ”¹ã€‘é€‰é¡¹æŒ‰é’®æ”¹ä¸ºå‚è€ƒå›¾ç‰‡ä¸­çš„é›è“è‰² */
    --option-bg: linear-gradient(135deg, #6366f1, #4f46e5);
    --option-shadow: rgba(79, 70, 229, 0.4);
    --option-shadow-hover: rgba(79, 70, 229, 0.6);
    --option-shadow-active: rgba(79, 70, 229, 0.3);
    /* ã€ä¿®æ”¹ã€‘æ§åˆ¶æŒ‰é’®æ”¹ä¸ºå‚è€ƒå›¾ç‰‡ä¸­çš„äº®é‡‘è‰² */
    --control-bg: linear-gradient(135deg, #fde047, #facc15);
    --control-shadow: rgba(250, 204, 21, 0.3);
    --control-shadow-hover: rgba(250, 204, 21, 0.4);
    --control-shadow-active: rgba(250, 204, 21, 0.2);
    --event-bg: #262626;
    --event-border: #4f46e5; /* äº‹ä»¶è¾¹æ¡†ä¹Ÿæ”¹ä¸ºè“è‰²ç³»ä»¥åŒ¹é…é€‰é¡¹æŒ‰é’® */
    --suitor-bg: linear-gradient(to right, #404040, #262626);
    --suitor-border: #525252;
    --suitor-shadow-hover: rgba(96, 165, 250, 0.3);
    --stat-bg: #404040;
    --stat-color: #fde047;
    --overlay-bg: rgba(23, 23, 23, 0.98);
    --overlay-card-bg: linear-gradient(135deg, #262626 0%, #171717 100%);
    --overlay-shadow: rgba(0, 0, 0, 0.7);
    --overlay-border: #facc15;
    --overlay-header-color: #fde047;
    --overlay-animation-color: #fde047;
    --loading-bg: rgba(23, 23, 23, 0.98);
    --loading-text: #e2e8f0;
    --loading-spinner-bg: #525252;
    --loading-spinner-fg: #e2e8f0;
    --accent-color-deep: #facc15;
}
/* å¾’å¼Ÿå¡ç‰‡æ ·å¼ */
.apprentice-card {
  background: linear-gradient(to right, #f0f8ff, #e6f7ff);
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 12px;
  border-left: 5px solid #6a9ac9;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  display: flex;
  align-items: center;
  gap: 15px;
}

.apprentice-name {
  font-weight: bold;
  color: #4169e1;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  font-size: 1.1rem;
}

.apprentice-name i {
  margin-right: 10px;
  font-size: 1.2rem;
}

.apprentice-details {
  font-size: 0.95rem;
  line-height: 1.6;
  flex: 1;
}

.apprentice-btn-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.apprentice-interact-btn {
  background: linear-gradient(135deg, #6a9ac9, #4169e1);
  color: white;
  border: none;
  border-radius: 20px;
  padding: 10px 15px;
  font-size: 0.9rem;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  flex-shrink: 0;
}

/* æ”¶å¾’å¼¹çª—æ ·å¼ */
#apprenticeSystemOverlay .overlay-card {
  max-width: 90%;
  padding: 25px;
}

.apprentice-option {
  background: var(--option-bg);
  color: white;
  border: none;
  border-radius: 30px;
  padding: 15px 22px;
  width: 100%;
  text-align: left;
  cursor: pointer;
  font-size: 1rem;
  box-shadow: 0 5px 15px var(--option-shadow);
  display: flex;
  align-items: center;
  position: relative;
  overflow: hidden;
  margin-bottom: 10px;
}

.apprentice-option:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px var(--option-shadow-hover);
}

.apprentice-option i {
  margin-right: 12px;
  font-size: 1.3rem;
  width: 20px;
  text-align: center;
}
 /* --- å­å¥³å©šå«ç•Œé¢ä¸“å±æ ·å¼ --- */
#childMarriageProposalOverlay .suitor {
    background: var(--suitor-bg);
    border: 1px solid var(--suitor-border);
    margin-bottom: 12px;
    padding: 15px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
}
#childMarriageProposalOverlay .suitor-name {
    font-size: 1.1rem;
    font-weight: bold;
}
#childMarriageProposalOverlay .suitor-desc {
    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--text-comment);
}
.hidden-trait {
    background-color: var(--progress-bg);
    padding: 8px;
    margin-top: 10px;
    border-radius: 8px;
    font-style: italic;
}
.trait-positive {
    color: #27ae60; /* ç»¿è‰² */
    border-left: 3px solid #27ae60;
}
.trait-negative {
    color: #c0392b; /* çº¢è‰² */
    border-left: 3px solid #c0392b;
}
/* ======================================================================= */
/* ======================= æ–°ç‰ˆå•†ä¼šäº¤æ˜“ç©æ³•ä¸“å±æ ·å¼ ====================== */
/* ======================================================================= */
#tradeSimOverlay .overlay-card {
    max-width: 95%;
    width: 800px; /* ç»™ä¸€ä¸ªå›ºå®šå®½åº¦ï¼Œåœ¨å¤§å±å¹•ä¸Šæ›´å¥½çœ‹ */
    height: 90vh;
    display: flex;
    flex-direction: column;
}
#tradeSimOverlay .overlay-content-wrapper {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* é˜²æ­¢å†…éƒ¨æ»šåŠ¨æ¡å½±å“å¸ƒå±€ */
}
.trade-sim-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.trade-sim-header {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color-light);
}
.trade-sim-header-item {
    background: var(--status-item-bg);
    padding: 8px 12px;
    border-radius: 10px;
    font-size: 0.9rem;
    border: 1px solid var(--status-border-color);
    text-align: center;
}
.trade-sim-news {
    background: var(--event-bg);
    padding: 10px;
    border-radius: 8px;
    font-size: 0.9em;
    border-left: 4px solid var(--decorator-color);
    max-height: 80px;
    overflow-y: auto;
}
.trade-sim-body {
    flex-grow: 1;
    overflow-y: auto; /* æ ¸å¿ƒæ»šåŠ¨åŒº */
    border: 1px solid var(--border-color);
    border-radius: 10px;
}
.trade-sim-table {
    width: 100%;
    border-collapse: collapse;
}
.trade-sim-table th, .trade-sim-table td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid var(--border-color-light);
    font-size: 0.9rem;
}
.trade-sim-table th {
    background: var(--tab-active-bg);
    position: sticky;
    top: 0;
}
.trade-sim-table tr:hover {
    background: var(--tab-hover-bg);
}
.trade-sim-table .price-up { color: #c0392b; font-weight: bold; }
.trade-sim-table .price-down { color: #27ae60; font-weight: bold; }
.trade-sim-table input[type="number"] {
    width: 60px;
    padding: 5px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    text-align: center;
}
.trade-sim-table .btn-buy, .trade-sim-table .btn-sell {
    padding: 5px 10px;
    border: none;
    color: white;
    border-radius: 15px;
    cursor: pointer;
    font-size: 0.8rem;
}
.trade-sim-table .btn-buy { background-color: #27ae60; }
.trade-sim-table .btn-sell { background-color: #c0392b; }
.trade-sim-footer {
    display: flex;
    justify-content: space-between;
    padding-top: 10px;
    border-top: 1px solid var(--border-color-light);
    gap: 10px;
}
.trade-sim-footer .control-btn {
    flex: 1;
}
/* æ”¾ç½®åœ¨æ‚¨ <style> æ ‡ç­¾çš„æœ«å°¾ï¼Œæˆ–è€…å•†ä¼šå°æ¸¸æˆä¸“å±æ ·å¼åŒºåŸŸ */

/* --- å•†ä¼šäº¤æ˜“ç³»ç»Ÿä¸“å±æ ·å¼ --- */
.trading-main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}
.trading-info-box {
    background: var(--status-item-bg);
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    border: 1px solid var(--status-border-color);
}
.trading-info-box h4 {
    margin-bottom: 8px;
    color: var(--highlight-strong);
}
.trading-info-box .value {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--header-color);
}
.market-fluctuation-card {
    grid-column: 1 / -1; /* è·¨ä¸¤åˆ— */
    background: var(--event-bg);
    border-left: 5px solid var(--decorator-color);
}
.market-fluctuation-card ul {
    list-style: none;
    padding: 0;
}
.market-fluctuation-card li {
    padding: 5px 0;
    border-bottom: 1px dashed var(--border-color-light);
}
.market-fluctuation-card li:last-child {
    border-bottom: none;
}
.text-gain { color: #27ae60; }
.text-loss { color: #c0392b; }

.guild-button {
    background: var(--option-bg);
    color: white;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    cursor: pointer;
    font-size: 1.2rem;
    font-weight: bold;
    box-shadow: 0 4px 10px var(--option-shadow);
}
.guild-button:hover {
    transform: translateY(-3px);
}
.guild-favor-bar {
    width: 100%;
    height: 8px;
    background: rgba(0,0,0,0.2);
    border-radius: 4px;
    margin-top: 8px;
    overflow: hidden;
}
.guild-favor-fill {
    height: 100%;
    background: #f1c40f;
    border-radius: 4px;
}
.trading-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
    margin-top: 20px;
}
/* --- æ–°ç‰ˆ NPC ç¤¾äº¤å¡ç‰‡æ ·å¼ --- */
#npcDetailOverlay .overlay-card {
    max-width: 90%;
    width: 500px;
    padding: 0;
    background: transparent;
    border: none;
    box-shadow: none;
    overflow: visible; /* å…è®¸å·è½´è£…é¥°è¶…å‡ºè¾¹ç•Œ */
    /* ã€æ ¸å¿ƒä¿®æ”¹ã€‘è®©å¡ç‰‡åœ¨æ‰‹æœºä¸Šèƒ½è‡ªé€‚åº”é«˜åº¦ */
    display: flex;
    flex-direction: column;
    max-height: 90vh; /* æœ€å¤§é«˜åº¦ä¸è¶…è¿‡å±å¹•çš„90% */
}

.social-card-scroll {
    width: 100%;
    background-image: url('https://img.zcool.cn/community/01f66359e19a62a80120446342e472.jpg@1280w_1l_2o_100sh.jpg'); /* æ·¡é›…å®£çº¸çº¹ç† */
    background-size: cover;
    background-position: center;
    border: 2px solid #bda27e;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    padding: 25px;
    color: #4a3c2b;
    position: relative;
    border-radius: 5px;
    /* ã€æ ¸å¿ƒä¿®æ”¹ã€‘è®©å·è½´å†…å®¹åŒºå¯ä»¥æ»šåŠ¨ */
    overflow-y: auto; /* å½“å†…å®¹è¶…å‡ºæ—¶ï¼Œå‡ºç°å‚ç›´æ»šåŠ¨æ¡ */
    flex-grow: 1; /* å æ®æ‰€æœ‰å¯ç”¨ç©ºé—´ */
    -webkit-overflow-scrolling: touch; /* åœ¨iOSä¸Šå®ç°æµç•…æ»šåŠ¨ */
}
/* ã€æ–°å¢ã€‘ç¾åŒ–æ»šåŠ¨æ¡æ ·å¼ */
.social-card-scroll::-webkit-scrollbar {
    width: 6px;
}
.social-card-scroll::-webkit-scrollbar-track {
    background: transparent;
}
.social-card-scroll::-webkit-scrollbar-thumb {
    background-color: rgba(189, 162, 126, 0.5);
    border-radius: 10px;
}


/* å·è½´è£…é¥° */
.social-card-scroll::before, .social-card-scroll::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    height: 30px;
    background-image: url('https://www.transparentpng.com/thumb/scroll/KaUj4u-scroll-paper-clipart-transparent.png'); /* å·è½´å¤´å›¾ç‰‡ */
    background-size: 100% 100%;
    background-repeat: no-repeat;
    z-index: 10;
    flex-shrink: 0; /* é˜²æ­¢è£…é¥°è¢«å‹ç¼© */
}

.social-card-scroll::before { top: -31px; transform: rotate(180deg); }
.social-card-scroll::after { bottom: -31px; }

/* ä¸»é¢˜é€‚é…è£…é¥° */
.theme-decorator {
    position: absolute;
    width: 80px;
    height: 80px;
    background-size: contain;
    background-repeat: no-repeat;
    opacity: 0.15;
    pointer-events: none;
}
[data-theme="spring"] .theme-decorator { background-image: url('https://png.pngtree.com/png-vector/20220721/ourmid/pngtree-falling-sakura-petals-with-pink-background-png-image_6021509.png'); }
[data-theme="summer"] .theme-decorator { background-image: url('https://png.pngtree.com/png-vector/20220625/ourmid/pngtree-summer-green-lotus-leaf-decoration-png-image_5426177.png'); }
[data-theme="autumn"] .theme-decorator { background-image: url('https://png.pngtree.com/png-vector/20220516/ourmid/pngtree-beautiful-hand-painted-watercolor-maple-leaf-material-png-image_4682490.png'); }
[data-theme="winter"] .theme-decorator { background-image: url('https://png.pngtree.com/png-vector/20220921/ourmid/pngtree-simple-blue-six-petal-snowflake-png-image_6208351.png'); }
[data-theme="night"] .theme-decorator { background-image: url('https://png.pngtree.com/png-vector/20230303/ourmid/pngtree-gold-star-clipart-transparent-background-png-image_6629740.png'); }

.theme-decorator.top-right { top: 10px; right: 10px; transform: rotate(20deg); }
.theme-decorator.bottom-left { bottom: 10px; left: 10px; transform: rotate(-160deg); }


/* --- é¡¶éƒ¨åŒºåŸŸ --- */
.social-card-header {
    display: flex;
    gap: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(189, 162, 126, 0.4);
    margin-bottom: 15px;
    align-items: center;
}
.npc-avatar-container {
    position: relative;
    text-align: center;
    flex-shrink: 0;
}
.npc-avatar-frame {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    padding: 4px;
    background: linear-gradient(135deg, #e4d2b1, #bda27e); /* ç‰çŸ³/é‡‘è‰²æè¾¹ */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.npc-avatar-frame img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #fff;
}
.npc-avatar-halo {
    position: absolute;
    top: -5px; left: -5px; right: -5px; bottom: -5px;
    border-radius: 50%;
    z-index: -1;
}
.rarity-common { box-shadow: 0 0 15px 5px rgba(255, 255, 255, 0.7); }
.rarity-rare { box-shadow: 0 0 15px 5px rgba(173, 216, 230, 0.9); }
.rarity-legendary { box-shadow: 0 0 20px 8px rgba(255, 215, 0, 0.8); }

.npc-identity-tag {
    background-color: rgba(189, 162, 126, 0.8);
    color: white;
    font-size: 0.75rem;
    padding: 2px 8px;
    border-radius: 10px;
    margin-top: 8px;
    display: inline-block;
}

.npc-info-basic {
    flex-grow: 1;
}
.npc-info-basic .name {
    font-family: 'Ma Shan Zheng', cursive;
    font-size: 2rem;
    color: #3a2d1b;
    margin: 0;
}
.npc-info-basic .title {
    font-size: 0.9rem;
    color: #a1887f;
    margin-top: -5px;
    margin-bottom: 8px;
}
.npc-info-basic .description {
    font-size: 0.9rem;
    line-height: 1.5;
    margin-bottom: 10px;
}
.personality-tags { display: flex; gap: 6px; flex-wrap: wrap; }
.personality-tag {
    font-size: 0.75rem;
    padding: 3px 8px;
    border-radius: 4px;
    color: white;
}
.tag-æ¸©æŸ” { background: #ffc0cb; color: #5a2d52; }
.tag-æœæ•¢ { background: #e74c3c; }
.tag-èªæ…§ { background: #3498db; }
.tag-æ´»æ³¼ { background: #f1c40f; color: #5a2d52; }
.tag-å†…æ•› { background: #95a5a6; }

/* --- ä¸­éƒ¨åŒºåŸŸ --- */
.social-card-middle {
    display: flex;
    gap: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(189, 162, 126, 0.4);
    margin-bottom: 15px;
}
.attributes-vertical-container {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}
.attribute-vertical {
    display: flex;
    align-items: center;
    gap: 10px;
}
.attribute-vertical .name {
    writing-mode: vertical-lr;
    font-size: 0.9rem;
    letter-spacing: 2px;
}
.progress-bar-vertical-wrapper {
    height: 100px;
    width: 12px;
    background-color: rgba(0,0,0,0.08);
    border-radius: 6px;
    display: flex;
    flex-direction: column-reverse; /* ä»ä¸‹å¾€ä¸Šå¡«å…… */
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}
.progress-bar-vertical-fill {
    width: 100%;
    border-radius: 6px;
    background: var(--decorator-color);
    transition: height 0.5s ease-out;
}
.attribute-vertical .value {
    font-size: 1.1rem;
    font-weight: bold;
}

.relationship-container {
    flex-basis: 120px;
    text-align: center;
}
.relationship-container .heart-meter {
    font-size: 50px;
    color: #e57373; /* çˆ±å¿ƒé¢œè‰² */
    position: relative;
    display: inline-block;
    margin-bottom: 10px;
}
.heart-fill {
    position: absolute;
    top: 0; left: 0; width: 100%;
    background: currentColor;
    overflow: hidden;
    transition: height 0.5s ease-out;
}
.heart-icon { position: relative; z-index: 1; }

.relationship-tag { font-weight: bold; font-size: 1rem; margin-bottom: 5px; }
.relationship-trend i { font-size: 0.9rem; }
.trend-up { color: #27ae60; }
.trend-down { color: #c0392b; }
.trend-stable { color: #7f8c8d; }

.special-status-display {
    text-align: center;
    background: var(--event-bg);
    border-radius: 8px;
    padding: 8px;
    margin-top: 10px;
    font-size: 0.9rem;
    border: 1px solid var(--border-color);
}

/* --- åº•éƒ¨äº’åŠ¨åŒº --- */
.social-card-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 10px;
}
.action-button {
    background: linear-gradient(135deg, #c5a880, #a88a60);
    color: white;
    border: 1px solid #8e6e4a;
    border-radius: 12px;
    padding: 10px;
    cursor: pointer;
    text-align: center;
    box-shadow: 0 3px 8px rgba(100,80,50,0.2);
}
.action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 12px rgba(100,80,50,0.3);
}
.action-button i { display: block; font-size: 1.5rem; margin-bottom: 5px; }
.action-button.disabled {
    background: #ccc;
    color: #888;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}
.action-button.disabled i {
    position: relative;
}
.action-button.disabled i::after {
    content: "\f023"; /* fa-lock */
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.8rem;
    color: white;
    background: rgba(0,0,0,0.3);
    border-radius: 50%;
    padding: 4px;
}
/* --- éšè—é¢æ¿ --- */
.expand-info-toggle {
    text-align: center;
    padding: 8px;
    margin-top: 15px;
    background: rgba(189, 162, 126, 0.2);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    border-top: 1px solid rgba(189, 162, 126, 0.4);
}
.expand-info-toggle:hover {
    background: rgba(189, 162, 126, 0.4);
}

.expandable-panel {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.7s ease-in-out, padding 0.5s ease;
    padding: 0 10px;
}
.expandable-panel.active {
    max-height: 500px; /* è¶³å¤Ÿå¤§çš„å€¼ */
    padding: 15px 10px;
}
.expandable-panel h5 { margin-top: 10px; margin-bottom: 5px; color: var(--highlight-strong); }
.expandable-panel ul { list-style: none; padding-left: 10px; }
.expandable-panel li { padding: 3px 0; }
.expandable-panel li i { margin-right: 8px; }
/* ======================================================================= */
/* ===================== ã€æ–°åŠŸèƒ½ã€‘æ·±åº¦ç¤¾äº¤ & å°æ¸¸æˆ CSS =================== */
/* ======================================================================= */

/* --- é›…é›†èšä¼šåœºæ™¯ --- */
#gatheringOverlay {
    background-size: cover;
    background-position: center;
    transition: background-image 1s ease-in-out;
}
#gatheringOverlay::before {
    content: '';
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(2px);
}
.gathering-container {
    position: relative;
    width: 95%;
    height: 95%;
    max-width: 800px;
    max-height: 600px;
    color: white;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
}
.gathering-npc {
    position: absolute;
    text-align: center;
    cursor: pointer;
    transition: transform 0.3s ease;
}
.gathering-npc:hover {
    transform: scale(1.1);
}
.gathering-npc img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 3px solid rgba(255,255,255,0.8);
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
}
.gathering-npc .name {
    margin-top: 5px;
    background: rgba(0,0,0,0.5);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.9em;
}
.gathering-ui {
    position: absolute;
    bottom: 20px;
    left: 20px;
    right: 20px;
    background: rgba(0,0,0,0.6);
    border-radius: 15px;
    padding: 15px;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255,255,255,0.2);
}
.gathering-desc {
    margin-bottom: 15px;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    padding-bottom: 10px;
}
.gathering-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
}

/* --- å©šç¤¼åœºæ™¯ --- */
.wedding-stage {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
}
.wedding-guest {
    display: inline-block;
    text-align: center;
    margin: 10px;
    cursor: pointer;
}
.wedding-guest img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 2px solid var(--highlight-strong);
}

/* --- æ£‹å±€å°æ¸¸æˆ --- */
#goGameContainer {
    display: flex;
    justify-content: center;
    align-items: center;
}
.go-board {
    display: grid;
    grid-template-columns: repeat(5, 50px);
    grid-template-rows: repeat(5, 50px);
    border: 2px solid #6b4e3d;
    background-color: #e4d2b1;
}
.go-cell {
    width: 50px;
    height: 50px;
    border: 1px solid #bda27e;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 30px;
}
/* ======================================================================= */
/* ===================== ã€æ–°åŠŸèƒ½ã€‘ç‰¹æ®Šå…³ç³»ä¸“å±äº’åŠ¨æ ·å¼ ==================== */
/* ======================================================================= */

.special-actions-card {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid rgba(189, 162, 126, 0.4);
}

.special-actions-card .section-header {
    font-family: 'Ma Shan Zheng', cursive;
    font-size: 1.5rem;
    text-align: center;
    margin-bottom: 15px;
    border-bottom: none;
}

.special-actions-card .lover-header {
    color: #c0392b; /* çº¢è‰²ï¼Œä»£è¡¨æƒ…äºº */
}

.special-actions-card .sworn-header {
    color: #d35400; /* æ©™è‰²ï¼Œä»£è¡¨ç»“ä¹‰ */
}

.special-actions-card .comment {
    text-align: center;
    font-size: 0.9rem;
    margin-bottom: 15px;
    color: #a1887f;
}

/* ä½¿ç”¨ .social-card-actions æ ·å¼æ¥ç»Ÿä¸€æŒ‰é’®é£æ ¼ */
.special-actions-card .social-card-actions {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* è°ƒæ•´æŒ‰é’®å¸ƒå±€ */
}

/* ===================== ã€æ–°å¢ã€‘ç‰¹æ®Šäº’åŠ¨å¼¹çª—ä¸“å±æ ·å¼ ===================== */
#specialInteractionOverlay .overlay-card {
    background: linear-gradient(135deg, #fff0f5, #fdf6f9); /* æ·¡é›…çš„ç²‰è‰²æ¸å˜ */
    border: 2px solid var(--decorator-color);
    box-shadow: 0 8px 25px var(--shadow-color);
    max-width: 480px;
}

#specialInteractionOverlay .overlay-header {
    font-family: 'Ma Shan Zheng', cursive;
    color: var(--highlight-strong);
    text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
}

#specialInteractionOverlay .overlay-content {
    text-align: center;
    color: var(--text-color);
    font-size: 1rem;
    line-height: 1.7;
    margin-bottom: 20px;
}

/* ç‰¹æ®Šäº’åŠ¨é€‰é¡¹æŒ‰é’®çš„æ ·å¼ */
#specialInteractionOptions .option {
    background: var(--option-bg);
    transition: all 0.2s ease-in-out;
}
#specialInteractionOptions .option:hover {
    background: var(--highlight-strong);
    transform: scale(1.03);
}
/* ======================================================================= */
/* ===================== ã€æ–°å¢ã€‘ä¹‰ç»“é‡‘å…°ä»ªå¼ä¸“å±æ ·å¼ ===================== */
/* ======================================================================= */
#oathCeremonyOverlay .overlay-card {
    background-image: url('https://img.zcool.cn/community/01f66359e19a62a80120446342e472.jpg@1280w_1l_2o_100sh.jpg'); /* æ·¡é›…å®£çº¸çº¹ç† */
    background-size: cover;
    background-position: center;
    border: 2px solid #bda27e; /* å¤é“œè‰²è¾¹æ¡† */
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    color: #4a3c2b; /* æ·±è¤è‰²æ–‡å­— */
    max-width: 500px;
}

#oathCeremonyOverlay .overlay-header {
    font-family: 'Ma Shan Zheng', cursive;
    color: #8B4513; /* èµ­çŸ³è‰² */
    text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
}

#oathCeremonyOverlay blockquote {
    border-left: 3px solid #bda27e;
    padding-left: 15px;
    margin: 20px;
    font-style: italic;
    color: #6b4e3d;
    line-height: 2;
    text-align: center;
}
/* ======================================================================= */
/* ===================== [æ–°å¢] çº¢ç¬ºå¯„æƒ…ç³»ç»Ÿä¸“å±æ ·å¼ ====================== */
/* ======================================================================= */

/* --- æƒ…è¯—ç¼–è¾‘å™¨ --- */
#poetryEditorOverlay .overlay-card {
    background-image: url('https://img.zcool.cn/community/01f66359e19a62a80120446342e472.jpg@1280w_1l_2o_100sh.png');
    background-size: cover;
    border: 2px solid #bda27e;
    color: #4a3c2b;
    max-width: 600px;
    width: 95%;
}
.poetry-editor-container {
    display: flex;
    gap: 20px;
}
.poetry-scroll {
    flex: 1;
    border: 1px solid #d3c4a3;
    padding: 15px;
    height: 200px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 5px;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
}
.poetry-line {
    border-bottom: 1px dashed #bda27e;
    min-height: 30px;
    padding: 5px;
    cursor: grab;
    text-align: center;
    font-size: 1.1rem;
}
.poetry-line.filled {
    font-family: 'Ma Shan Zheng', cursive;
    font-weight: bold;
}
.poetry-fragments {
    flex: 1;
    max-height: 200px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.fragment {
    background: var(--suitor-bg);
    padding: 8px;
    border-radius: 5px;
    cursor: grab;
    border: 1px solid var(--suitor-border);
}
.self-compose-input {
    width: 100%;
    padding: 8px;
    margin-top: 10px;
    border-radius: 5px;
    border: 1px solid #bda27e;
    background: rgba(255,255,255,0.7);
}

/* --- ä¿¡ç‰©åˆ¶ä½œ --- */
.token-option {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    border: 1px solid var(--border-color-light);
}
.token-option:hover {
    background: var(--tab-hover-bg);
}
.token-option.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #eee;
}
.token-icon { font-size: 2rem; color: var(--highlight-strong); }
.token-details { flex-grow: 1; }
.token-details small { color: var(--text-comment); }

/* --- è¡¨ç™½åœºæ™¯ --- */
#confessionSceneOverlay {
    background-size: cover;
    background-position: center;
    transition: background-image 1s ease-in-out;
}
#confessionSceneOverlay::before {
    content: '';
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(2px);
}
#confessionSceneOverlay .overlay-card {
    background: rgba(0,0,0,0.5);
    color: white;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
    border-color: rgba(255,255,255,0.5);
}
.confession-animation {
    width: 100%;
    height: 150px; /* æ ¹æ®éœ€è¦è°ƒæ•´ */
    margin-bottom: 20px;
    /* å¯ç”¨äºåç»­æ·»åŠ åŠ¨ç”»æ•ˆæœ */
}
/* ======================================================================= */
/* ======================= ã€æ–°å¢ã€‘å…¨æ–°å©šç¤¼ç•Œé¢æ ·å¼ ======================== */
/* ======================================================================= */
#weddingOverlay .overlay-card {
    background: linear-gradient(135deg, #ffdde1 0%, #ee9ca7 100%);
    border-color: #c71585;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
.wedding-stage {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    text-align: center;
}
.wedding-couples {
    display: flex;
    gap: 20px;
    margin: 20px 0;
    align-items: flex-end;
}
.wedding-person {
    text-align: center;
}
.wedding-person .avatar-wrapper {
    width: 80px; height: 80px;
    border-color: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
.wedding-person .name {
    font-weight: bold;
    margin-top: 8px;
    font-size: 1.1rem;
    color: var(--header-color);
}
.wedding-guests {
    margin-top: 20px;
    border-top: 1px dashed var(--border-color-light);
    padding-top: 15px;
    width: 100%;
}
.wedding-guests h4 {
    margin-bottom: 10px;
}
.guest-list {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}
.wedding-guest {
    text-align: center;
    font-size: 0.9rem;
}
.wedding-guest .avatar-wrapper {
    width: 50px;
    height: 50px;
    border-width: 2px;
    margin: 0 auto 5px;
}
/* ======================================================================= */
/* ===================== ã€æ–°å¢ã€‘å¤©å‘½è½®å›å½•ä¸“å±æ ·å¼ ====================== */
/* ======================================================================= */
#dustyMirrorOverlay .overlay-card,
#inheritanceBookOverlay .overlay-card {
    background-image: url('https://img.zcool.cn/community/01f66359e19a62a80120446342e472.jpg@1280w_1l_2o_100sh.jpg');
    background-size: cover;
    border: 2px solid #4a3c2b;
    color: #4a3c2b;
    max-width: 95%;
    width: 600px;
    height: 90vh;
    padding: 25px;
    display: flex;
    flex-direction: column;
}

.mirror-title {
    font-family: 'Ma Shan Zheng', cursive;
    font-size: 2.5rem;
    color: #8B4513;
    text-align: center;
    margin-bottom: 10px;
}

.posthumous-title {
    text-align: center;
    font-size: 1.8rem;
    font-weight: bold;
    background: linear-gradient(to right, #bda27e, #8e6e4a);
    -webkit-background-clip: text;
    color: transparent;
    padding: 5px 15px;
    border: 1px solid #bda27e;
    border-radius: 10px;
    margin: 0 auto 15px;
    display: inline-block;
}

.mirror-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    overflow-y: auto;
    padding: 10px;
    flex-grow: 1;
}

.dimension-card {
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid #d3c4a3;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.dimension-header {
    margin-bottom: 10px;
}

.dimension-rating {
    font-size: 3rem;
    font-weight: bold;
    margin-bottom: 5px;
}
.rating-S { color: #ffd700; text-shadow: 0 0 10px #ffd700; }
.rating-A { color: #c0392b; }
.rating-B { color: #2980b9; }
.rating-C { color: #7f8c8d; }
.rating-D { color: #34495e; }

.dimension-name {
    font-size: 1.3rem;
    font-family: 'Ma Shan Zheng', cursive;
}

.dimension-comment {
    font-size: 0.9em;
    font-style: italic;
    color: #6b4e3d;
    line-height: 1.6;
    flex-grow: 1;
}

/* æ‰¿ä¸–ä¹¦æ ·å¼ */
#inheritanceBookOverlay .overlay-content-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.heir-selection-container {
    padding-bottom: 15px;
    border-bottom: 1px solid #d3c4a3;
    margin-bottom: 10px;
    text-align: center;
}

.heir-selection-container h4 { margin-bottom: 10px; }

.heir-list {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.heir-card {
    cursor: pointer;
    border: 2px solid transparent;
    border-radius: 10px;
    padding: 8px;
    transition: all 0.2s ease;
}
.heir-card:hover {
    border-color: #a88a60;
}
.heir-card.selected {
    border-color: #d35400;
    background: rgba(255, 235, 205, 0.7);
    transform: scale(1.05);
}

.talent-tree-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px;
}
.points-display {
    text-align: center;
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 15px;
}

.talent-branch {
    margin-bottom: 20px;
}
.talent-branch-header {
    font-size: 1.2rem;
    font-weight: bold;
    color: #8B4513;
    padding-bottom: 8px;
    border-bottom: 1px dashed #bda27e;
    margin-bottom: 10px;
}
.talent-tier {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    align-items: flex-start;
}

.talent-node {
    flex: 1;
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid #d3c4a3;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    min-width: 120px;
}
.talent-node strong {
    display: block;
    margin-bottom: 5px;
}
.talent-node small {
    display: block;
    color: #6b4e3d;
    line-height: 1.4;
    min-height: 40px;
}
.talent-node button {
    margin-top: 8px;
    width: 100%;
    padding: 6px;
    border: none;
    border-radius: 15px;
    color: white;
    cursor: pointer;
}
.talent-node .btn-buy { background-color: #27ae60; }
.talent-node .btn-bought { background-color: #7f8c8d; cursor: not-allowed; }
.talent-node .btn-locked { background-color: #bdc3c7; cursor: not-allowed; }

.relics-container {
    margin-top: 20px;
    border-top: 1px solid #d3c4a3;
    padding-top: 15px;
}
.relic-item {
    display: flex;
    gap: 15px;
    align-items: center;
    background: linear-gradient(135deg, #fff8e1, #ffecb3);
    padding: 10px;
    border-radius: 8px;
    border-left: 4px solid #ffa726;
}
.relic-icon { font-size: 1.5rem; color: #d35400; }
.relic-details { flex-grow: 1; }

</style>
</head>
<body data-theme="spring">
<audio id="bgm-fengqiuhaung" loop src="https://vgmdownloads.com/soundtracks/genshin-impact-the-stellar-moments-vol.-4/htumrpmgje/2-09.%20A%20Merry-Go-Round%20of%20Life.mp3"></audio>
<audio id="bgm-gaoshanliushui" loop src="https://vgmdownloads.com/soundtracks/genshin-impact-the-stellar-moments-vol.-4/xflqfglonm/2-04.%20Bard%27s%20Adventure.mp3"></audio>
<audio id="bgm-shimianmaifu" loop src="https://vgmdownloads.com/soundtracks/genshin-impact-the-stellar-moments-vol.-4/zofhmdkbsz/3-04.%20For%20Riddles%2C%20for%20Wonders.mp3"></audio>

<audio id="sfx-perfect-hit" src="https://opengameart.org/sites/default/files/audio_preview/OGA-135930030_1.mp3"></audio>
<audio id="sfx-good-hit" src="https://opengameart.org/sites/default/files/audio_preview/OGA-1031388880.mp3"></audio>
<audio id="sfx-miss" src="https://opengameart.org/sites/default/files/audio_preview/OGA-1294979155.mp3"></audio>

<div class="particle-container" id="particle-container"></div>
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div id="loadingText">âœ¨ ç½—ç»®è‡ªé£˜é¦™ï¼Œæœ±é—¨åˆæ·±è—â€¦â€¦ âœ¨</div>
</div>

<div class="toast" id="toast"></div>

<div id="genderSelectionOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">è¯·æ‹©æ±å‘½</div>
        <div class="overlay-animation">ğŸ­</div>
        <div class="overlay-content">
            å³å°†å¼€å§‹ä¸€æ®µå…¨æ–°çš„äººç”Ÿï¼Œä½ å¸Œæœ›ç”Ÿäºæ­¤ä¸–ï¼Œæ˜¯â€¦â€¦
        </div>
        <div class="options" style="flex-direction: row; justify-content: center; gap: 15px;">
            <button class="option" onclick="startNewGame('male')">
                <i class="fas fa-male"></i> ä¸–å®¶å…¬å­
            </button>
            <button class="option" onclick="startNewGame('female')">
                <i class="fas fa-female"></i> åé—¨é—ºç§€
            </button>
        </div>
    </div>
</div>

<div id="weddingOverlay" class="overlay">
    <div class="overlay-card" style="background: linear-gradient(135deg, #ffdde1 0%, #ee9ca7 100%); border-color: #c71585;">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸŒ¸ å¤§å©šä¹‹å–œ ğŸŒ¸</div>
        <div class="overlay-animation" style="animation: float 2.5s infinite ease-in-out; font-size: 4.5rem; text-shadow: 2px 2px 5px rgba(0,0,0,0.2);">å›</div>
        <div class="overlay-content-wrapper">
        <div class="overlay-content">
            çº¢çƒ›é«˜ç…§ï¼Œå–œæ°”ç›ˆé—¨ï¼Œä»Šæ—¥æ˜¯<span class="overlay-name" id="weddingGroom"></span>ä¸
            <span class="overlay-name" id="weddingBride"></span>å¤§å–œä¹‹æ—¥ã€‚<br>
            èŠ±è½¿ä¸´é—¨ï¼Œé¼“ä¹å–§å¤©ï¼Œæ–°äººæ‹œå ‚æˆäº²ï¼Œç»“ä¸ºç™¾å¹´ä¹‹å¥½ï¼Œä»æ­¤ç´ç‘Ÿå’Œé¸£ï¼Œå…±èµ´ç™½é¦–ã€‚
        </div>
        </div>
        <button class="control-btn" onclick="closeAllOverlays()" style="margin-top: 20px; background: linear-gradient(135deg, #d84381, #c71585);">
            <i class="fas fa-check"></i> å¼€å¯æ–°ç”Ÿæ´» âœ¨
        </button>
    </div>
</div>

<div id="inheritanceOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ•¯ï¸ ç”Ÿæ­»ç°¿ ğŸ•¯ï¸</div>
        <div class="overlay-animation">ğŸ“œ</div>
        <div class="overlay-content-wrapper">
            <div class="overlay-content" id="finalGameSummary"></div>
            <div id="heir-selection" class="options"></div>
        </div>
        <div class="decision-options">
            <button class="control-btn" onclick="startNewGame(gameState.player.gender, null)" style="background: linear-gradient(135deg, #fab1a0, #e17055);">
                <i class="fas fa-redo"></i> å¼€å¯å…¨æ–°äººç”Ÿ
            </button>
        </div>
    </div>
</div>

<div id="nameChildOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" id="closeBirthOverlayBtn" style="display:none;" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">å–œå¾—éºŸå„¿</div>
        <div class="overlay-content-wrapper">
            <div id="birthResultContent" class="overlay-content"></div>
            <div id="childNamingSection"></div>
            <div id="secretChildDecision" class="options" style="display:none; flex-direction:column;"></div>
        </div>
    </div>
</div>
<div id="renameChildOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">ä¸ºå­å—£æ›´å</div>
        <div class="overlay-content-wrapper">
            <div class="overlay-content" id="renameChildContent">
                <p>è¯·ä¸º<strong id="renameChildOldName"></strong>è¾“å…¥æ–°åï¼ˆä¸å«å§“æ°ï¼‰ï¼š</p>
                <div class="input-group">
                    <input type="text" id="renameChildInput" placeholder="è¯·è¾“å…¥æ–°å..." maxlength="3">
                </div>
            </div>
        </div>
        <div class="decision-options">
            <button class="control-btn" id="confirmRenameBtn" onclick="">
                <i class="fas fa-check"></i> ç¡®è®¤
            </button>
        </div>
    </div>
</div>
<div id="childRearingOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ‘¶ ç¨šå­æ•™å…» ğŸ‘¶</div>
        <div class="overlay-content-wrapper" id="childRearingContent"></div>
    </div>
</div>

<div id="assetsOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ  æˆ‘çš„èµ„äº§ ğŸ </div>
        <div class="overlay-content-wrapper" id="assetsContent"></div>
    </div>
</div>

<div id="rankingsOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header" id="rankingsHeader">ğŸ† äº¬åŸè´µå¥³æ¦œ ğŸ†</div>
        <div class="overlay-content-wrapper" id="rankingsContent"></div>
    </div>
</div>

<div id="guzhengGameOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header" id="guzheng-song-name">ä¸€æ›²å‡¤æ±‚å‡°</div>
        <div class="guzheng-game-container" id="guzheng-game-container">
            <div class="guzheng-perfect-zone"></div>
            <div class="guzheng-hit-line"></div>
            <div id="guzheng-feedback" class="guzheng-feedback"></div>
        </div>
        <div class="guzheng-hit-buttons-container" id="guzheng-hit-buttons-container">
            </div>
        <div id="guzheng-score-display" style="text-align:center; margin-top:15px; font-size: 1.2rem;">å¾—åˆ†: 0</div>
    </div>
</div>

<div id="tradeSimOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">äº¬åŸå•†ä¼š</div>
        <div class="overlay-content-wrapper" id="tradeSimContent">
            </div>
    </div>
</div>

<div id="merchantGuildOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ¤ å•†ä¼šç»è¥ ğŸ¤</div>
         <div class="overlay-content-wrapper" id="merchantGuildContent">
            
            <div id="miniGameContainer" style="display: none;">
                </div>

        </div>
    </div>
</div>

<div id="npcDetailOverlay" class="overlay">
    <div class="overlay-card" id="npc-card-container">
        </div>
</div>

<div id="dateSceneOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header" id="dateSceneHeader"></div>
        <div class="overlay-animation" id="dateSceneAnimation">ğŸ’–</div>
        <div class="overlay-content-wrapper">
            <div id="dateSceneContent" class="overlay-content"></div>
        </div>
        <button class="control-btn" onclick="closeAllOverlays()">
            <i class="fas fa-heart"></i> å¿ƒåŠ¨äº† ğŸ’–
        </button>
    </div>
</div>

<div id="marketOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ›’ ç³ç…å¸‚é›† ğŸ›’</div>
        <div class="overlay-content-wrapper" id="marketContent"></div>
    </div>
</div>

<div id="restaurantOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ» ç³ç…é£Ÿè‚† ğŸ»</div>
        <div class="overlay-content-wrapper" id="restaurantContent"></div>
    </div>
</div>

<div id="wishingWellOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸï¸ ä»™æ± ç§˜å¢ƒ ğŸï¸</div>
        <div class="overlay-animation">âœ¨</div>
        <div class="overlay-content-wrapper">
            <div id="wishingWellContent" class="overlay-content"></div>
        </div>
        <div id="wishingWellOptions" class="decision-options"></div>
    </div>
</div>

<div id="careerChallengeOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header" id="careerChallengeHeader"></div>
        <div class="overlay-animation" id="careerChallengeAnimation"></div>
        <div class="overlay-content-wrapper">
            <div class="overlay-content" id="careerChallengeContent"></div>
             <div class="options" id="careerChallengeOptions"></div>
        </div>
        <button class="control-btn" id="closeCareerChallengeResultBtn" style="display:none;" onclick="closeAllOverlays()"><i class="fas fa-check"></i> çŸ¥é“äº†</button>
    </div>
</div>

<div id="clinicOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ¥ ä»å¿ƒåŒ»é¦† ğŸ¥</div>
        <div class="overlay-content-wrapper" id="clinicContent"></div>
    </div>
</div>

<div id="debugOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">âš™ï¸ åˆ›ä¸–ä¸»æ¨¡å¼ âš™ï¸</div>
        <div class="overlay-content-wrapper" id="debugContent"></div>
        <button class="control-btn" onclick="applyDebugChanges()" style="margin-top:10px;">åº”ç”¨ä¿®æ”¹</button>
    </div>
</div>

<div id="saveLoadOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header" id="saveLoadHeader">ç®¡ç†å­˜æ¡£</div>
        <div class="overlay-content-wrapper" id="saveLoadContent"></div>
    </div>
</div>

<div id="fengYueJianOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ® é£æœˆé‰´ ğŸ®</div>
        <div class="overlay-content-wrapper" id="fengYueJianContent"></div>
    </div>
</div>

<div id="arrangedMarriageOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">â¤ï¸ é—¨å½“æˆ·å¯¹ â¤ï¸</div>
        <div class="overlay-content-wrapper" id="arrangedMarriageContent"></div>
    </div>
</div>

<div id="childMarriageOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ’ å­å¥³å©šäº‹ ğŸ’</div>
        <div class="overlay-content-wrapper" id="childMarriageContent"></div>
    </div>
</div>

<div id="eventCardOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header" id="eventCardHeader">äº‹ä»¶å‘ç”Ÿ</div>
        <div class="overlay-animation" id="eventCardAnimation">ğŸ‰</div>
        <div class="overlay-content-wrapper">
            <div id="eventCardContent" class="overlay-content"></div>
        </div>
        <button class="control-btn" onclick="closeAllOverlays()">
            <i class="fas fa-check"></i> çŸ¥æ™“äº†
        </button>
    </div>
</div>

<div id="decisionCardOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header" id="decisionCardHeader">è¯·å›å®šå¤º</div>
        <div class="overlay-animation" id="decisionCardAnimation">ğŸ¤”</div>
        <div class="overlay-content-wrapper">
            <div id="decisionCardContent" class="overlay-content"></div>
            <div id="decisionCardOptions" class="options" style="flex-direction:column;"></div>
        </div>
    </div>
</div>

<div id="newFriendEncounterOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header" id="newFriendEncounterHeader">èæ°´ç›¸é€¢</div>
        <div class="overlay-content-wrapper">
            <div id="newFriendEncounterContent" class="overlay-content"></div>
            <div id="newFriendEncounterOptions" class="options" style="flex-direction:column;"></div>
        </div>
    </div>
</div>

<div id="matchmakerOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ¤ é‡‘ç‰Œåª’å©† ğŸ¤</div>
         <div class="overlay-content-wrapper" id="matchmakerContent"></div>
    </div>
</div>

  <div id="apprenticeSystemOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">&times;</button>
        <div class="overlay-header">ğŸ‘¨â€ğŸ“ æ”¶å¾’ç³»ç»Ÿ ğŸ‘©â€ğŸ“</div>
        <div class="overlay-content-wrapper" id="apprenticeSystemContent"></div>
    </div>
</div>
<div class="container-wrapper">
    <div class="container" id="game-container">
        <!-- Game content is rendered here by JavaScript -->
    </div>
</div>

<div id="renameChildOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">ä¸ºå­å—£æ›´å</div>
        <div class="overlay-content-wrapper">
            <div class="overlay-content" id="renameChildContent">
                <p>è¯·ä¸º<strong id="renameChildOldName"></strong>è¾“å…¥æ–°åï¼ˆä¸å«å§“æ°ï¼‰ï¼š</p>
                <div class="input-group">
                    <input type="text" id="renameChildInput" placeholder="è¯·è¾“å…¥æ–°å..." maxlength="3">
                </div>
            </div>
        </div>
        <div class="decision-options">
            <button class="control-btn" id="confirmRenameBtn" onclick="">
                <i class="fas fa-check"></i> ç¡®è®¤
            </button>
        </div>
    </div>
</div>

<div id="specialInteractionOverlay" class="overlay">
    <div class="overlay-card" id="specialInteractionCard">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header" id="specialInteractionHeader"></div>
        <div class="overlay-content-wrapper">
            <div id="specialInteractionContent" class="overlay-content"></div>
            <div id="specialInteractionOptions" class="options" style="flex-direction:column;"></div>
        </div>
    </div>
</div>

<div id="poetryQuizOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">å¿ƒæœ‰çµçŠ€</div>
        <div class="overlay-content-wrapper">
            <div id="poetryQuizContent" class="overlay-content" style="text-align: center;">
                <p id="poetryQuestion" style="font-size: 1.2rem; margin-bottom: 20px;"></p>
                <div id="poetryOptions" class="options" style="flex-direction:column;"></div>
            </div>
        </div>
    </div>
</div>

<!-- æ”¾ç½®åœ¨æœ€åä¸€ä¸ª overlay ä¹‹å, </body> ä¹‹å‰ -->
<div id="tradingOverlay" class="overlay">
    <div class="overlay-card" id="tradingOverlayCard" style="text-align: left; max-width: 95%;">
        <!-- å†…å®¹å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
    </div>
</div>

<div id="gatheringOverlay" class="overlay">
    </div>

<div id="eventHubOverlay" class="overlay">
    <div class="overlay-card" style="max-width: 600px; width: 95%;">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">ğŸ’Œ ä¿¡æ¯ä¸­å¿ƒ ğŸ’Œ</div>
        <div id="event-hub-tracker" style="text-align: center; margin-bottom: 15px; font-size: 1.2rem;">
            </div>
        <div class="overlay-content-wrapper" id="eventHubContent" style="padding: 0;">
            </div>
    </div>
</div>

<div id="goGameOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">æ‰‹è°ˆå¯¹å¼ˆ</div>
        <div id="goGameContainer" class="overlay-content">
            </div>
        <p id="goGameStatus" style="text-align:center; margin-top:15px;"></p>
    </div>
</div>

<div id="oathCeremonyOverlay" class="overlay">
    <div class="overlay-card" id="oathCeremonyCard">
        <div class="overlay-header" id="oathCeremonyHeader">ä¹‰ç»“é‡‘å…°</div>
        <div class="overlay-animation" id="oathCeremonyAnimation">ğŸ¤</div>
        <div class="overlay-content-wrapper">
            <div id="oathCeremonyContent" class="overlay-content">
                </div>
            <div id="oathCeremonyOptions" class="options" style="flex-direction:column;">
                </div>
        </div>
        <button class="control-btn" id="oathCeremonyConfirmBtn" style="display:none;" onclick="completeOath()">
            <i class="fas fa-heart"></i> ç¤¼æˆ Â· æ­¤ç”Ÿä¸è´Ÿ
        </button>
    </div>
</div>
<div id="poetryEditorOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">ä¹¦å†™æƒ…è¯—</div>
        <div id="poetryEditorContent" class="overlay-content-wrapper">
            <!-- å†…å®¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>

<div id="tokenCraftingOverlay" class="overlay">
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">å‡†å¤‡ä¿¡ç‰©</div>
        <div id="tokenCraftingContent" class="overlay-content-wrapper">
            <!-- å†…å®¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>

<div id="confessionSceneOverlay" class="overlay">
    <div class="overlay-card">
         <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div id="confessionSceneContent" class="overlay-content-wrapper">
            <!-- å†…å®¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>

<div id="dustyMirrorOverlay" class="overlay">
    </div>

<div id="inheritanceBookOverlay" class="overlay">
    </div>

<script>
// =======================================================================
// ========================= GAME CORE & CONFIG ==========================
// =======================================================================
'use strict';
Object.defineProperty(window, 'gs', { get: function() { return gameState; } });
// --- DATA: Financial Tiers (As per detailed specification) ---
const financialTiers = [
    { level: 1, name: "èµ¤è´«å¦‚æ´—", threshold: 1000, expenses: { personal: 200, spouse: 100, concubine: 0, parent: 80, child_base: 60, child_edu: [{name: "æ— æ³•ä¸Šå­¦", cost: 0, effect: {etiquette: 1, wisdom: 1, talent: 1, virtue: 1, reputation: 1, martial: 1, health: 1}}] } },
    { level: 2, name: "å‹‰å¼ºåº¦æ—¥", threshold: 10000, expenses: { personal: 600, spouse: 300, concubine: 0, parent: 240, child_base: 180, child_edu: [{name: "æ‘å¡¾", cost: 300, effect: {etiquette: 2, wisdom: 2, talent: 2, virtue: 2, reputation: 2, martial: 2, health: 2}}, {name: "å…¬ç«‹å­¦å ‚", cost: 480, effect: {etiquette: 3, wisdom: 3, talent: 3, virtue: 3, reputation: 3, martial: 3, health: 3}}] } },
    { level: 3, name: "å°åº·ä¹‹å®¶", threshold: 50000, expenses: { personal: 1800, spouse: 900, concubine: 720, parent: 720, child_base: 540, child_edu: [{name: "ç§ç«‹ä¹¦é™¢", cost: 1440, effect: {etiquette: 5, wisdom: 5, talent: 5, virtue: 5, reputation: 5, martial: 5, health: 5}}, {name: "ä¸“é¡¹å­¦è‰º", cost: 900, effect: {etiquette: 4, wisdom: 4, talent: 4, virtue: 4, reputation: 4, martial: 4, health: 4}}] } },
    { level: 4, name: "æ®·å®å¯Œè¶³", threshold: 200000, expenses: { personal: 6000, spouse: 3000, concubine: 1800, parent: 2400, child_base: 1800, child_edu: [{name: "ç²¾è‹±å®¶å¡¾", cost: 4800, effect: {etiquette: 7, wisdom: 7, talent: 7, virtue: 7, reputation: 7, martial: 7, health: 7}}, {name: "è´µæ—æŠ€è‰º", cost: 3000, effect: {etiquette: 6, wisdom: 6, talent: 6, virtue: 6, reputation: 6, martial: 6, health: 6}}] } },
    { level: 5, name: "è±ªé—¨å·¨å¯Œ", threshold: 500000, expenses: { personal: 24000, spouse: 12000, concubine: 7200, parent: 9600, child_base: 7200, child_edu: [{name: "åå¸ˆä¸€å¯¹ä¸€", cost: 10000, effect: {etiquette: 9, wisdom: 9, talent: 9, virtue: 9, reputation: 9, martial: 9, health: 9}}, {name: "æ­¦å­¦å¤§å¸ˆ", cost: 8000, effect: {etiquette: 8, wisdom: 8, talent: 8, virtue: 8, reputation: 8, martial: 8, health: 8}}] } },
    { level: 6, name: "å¯Œå¯æ•Œå›½", threshold: 1000000, expenses: { personal: 50000, spouse: 25000, concubine: 15000, parent: 20000, child_base: 15000, child_edu: [{name: "è¿›å…¥å®«å­¦", cost: 25000, effect: {etiquette: 11, wisdom: 11, talent: 11, virtue: 11, reputation: 11, martial: 11, health: 11}}, {name: "æµ·å¤–æ¸¸å­¦", cost: 20000, effect: {etiquette: 10, wisdom: 10, talent: 10, virtue: 10, reputation: 10, martial: 10, health: 10}}] } },
    { level: 7, name: "çš‡å®¤å®—äº²", threshold: Infinity, expenses: { personal: 100000, spouse: 50000, concubine: 30000, parent: 40000, child_base: 30000, child_edu: [{name: "å¤ªå­ä¼´è¯»", cost: 50000, effect: {etiquette: 15, wisdom: 15, talent: 15, virtue: 15, reputation: 15, martial: 15, health: 15}}, {name: "å¾¡å‰ä¾å«", cost: 40000, effect: {etiquette: 13, wisdom: 13, talent: 13, virtue: 13, reputation: 13, martial: 13, health: 13}}] } }
];
let gameState = {};
let oathCeremonyState = {}; // ç”¨äºå­˜å‚¨ç»“æ‹œä»ªå¼çš„ä¸´æ—¶çŠ¶æ€
let isProcessing = false;
let avatarClickCount = 0;
let lastAvatarClickTime = 0;
const SAVE_SLOT_KEY_PREFIX = 'zhumenxiuhu_save_v10_slot_';
const TOTAL_SAVE_SLOTS = 5;
// ADD THESE NEW FUNCTIONS
// ADD THESE NEW FUNCTIONS
// â–¼â–¼â–¼ åœ¨è¿™é‡Œç²˜è´´å…¨æ–°çš„JSä»£ç  â–¼â–¼â–¼

// =======================================================================
// ========================= ã€æ–°åŠŸèƒ½ã€‘ä¿¡æ¯ä¸­å¿ƒæ ¸å¿ƒé€»è¾‘ ========================
// =======================================================================
let pendingEvents = [];

function addPendingEvent(eventData) {
    // eventData ç»“æ„: { title, icon, description, options }
    // options ç»“æ„: [{ htmlContent, disabled, callback, ... }]
    pendingEvents.push(eventData);
}

function openEventHub() {
    if (pendingEvents.length === 0) {
        showToast("å½“å‰æ²¡æœ‰éœ€è¦å¤„ç†çš„ä¿¡æ¯ã€‚");
        return;
    }
    renderEventHub();
    showOverlay('eventHubOverlay');
}
function openFengYueJian() {
    const content = document.getElementById('fengYueJianContent');
    let html = '<div class="options" style="flex-direction:column;">';

    if (gameState.player.gender === 'female') {
        const potentialLovers = Object.values(gameState.npcs).filter(npc =>
            npc.gender === 'male' &&
            !npc.isFamily &&
            npc.age > 16 &&
            !npc.isDead &&
            (gameState.social.relationships[npc.id]?.type !== 'lover' && gameState.social.relationships[npc.id]?.type !== 'spouse')
        );

        if (potentialLovers.length > 0) {
            potentialLovers.forEach(npc => {
                html += `
                    <div class.option" onclick="interactWithFengYueJianNpc('${npc.id}')">
                        <div class="suitor-details">
                            <div class="suitor-name">${npc.name} <span class="comment">(${npc.title})</span></div>
                            <div class="suitor-desc">å¥½æ„Ÿ: ${gameState.social.relationships[npc.id]?.favor || 0}</div>
                        </div>
                    </div>
                `;
            });
        } else {
            html += '<p class="comment">æš‚æ— åˆé€‚çš„äº¤å¾€äººé€‰ã€‚</p>';
        }
    } else { // **<-- æ–°å¢çš„ç”·æ€§ç©å®¶é€»è¾‘**
        const potentialConcubines = Object.values(gameState.npcs).filter(npc =>
            npc.gender === 'female' &&
            !npc.isFamily &&
            npc.age > 16 &&
            !npc.isDead &&
            npc.title.includes('æ­Œå§¬') || npc.title.includes('èˆå§¬')
        );

        if (potentialConcubines.length > 0) {
            potentialConcubines.forEach(npc => {
                const favor = gameState.social.relationships[npc.id]?.favor || 0;
                html += `
                    <div class="option" style="justify-content: space-between;">
                        <div class="suitor-details">
                            <div class="suitor-name">${npc.name} <span class="comment">(${npc.title})</span></div>
                            <div class="suitor-desc">å¥½æ„Ÿ: ${favor}</div>
                        </div>
                        <button class="control-btn" onclick="proposeToConcubine('${npc.id}')" ${favor < 100 ? 'disabled' : ''}>
                            <i class="fas fa-heart"></i> ${favor < 100 ? `å¥½æ„Ÿéœ€100` : 'çº³ä¸ºå¦¾å®¤'}
                        </button>
                    </div>
                `;
            });
        } else {
            html += '<p class="comment">é£æœˆåœºä¸­æš‚æ— åˆé€‚çš„å§‘å¨˜ã€‚</p>';
        }
    }

    html += '</div>';
    content.innerHTML = html;
    showOverlay('fengYueJianOverlay');
}
function renderEventHub() {
    const tracker = document.getElementById('event-hub-tracker');
    const content = document.getElementById('eventHubContent');

    // æ›´æ–°å¾…åŠäº‹ä»¶è®¡æ•°ï¼ˆæ˜Ÿæ˜Ÿï¼‰
    let starsHTML = '';
    for (let i = 0; i < pendingEvents.length; i++) {
        starsHTML += `<i class="fas fa-star" style="color: #f1c40f; margin: 0 2px;"></i>`;
    }
    tracker.innerHTML = `å¾…å¤„ç†ä¿¡æ¯: ${starsHTML}`;

    if (pendingEvents.length > 0) {
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†æ‰€æœ‰å¾…åŠäº‹ä»¶ä»¥åˆ—è¡¨å½¢å¼å±•ç¤º
        content.innerHTML = `
            <div class="inventory-container" style="padding: 10px;">
                ${pendingEvents.map((event, index) => `
                    <div class="inventory-item" style="cursor: pointer;" onclick="showHubEventDetails(${index})">
                        <div class="inventory-item-icon"><i class="fas ${event.icon || 'fa-info-circle'}"></i></div>
                        <div class="inventory-item-details">
                            <div class="inventory-item-name">${event.title}</div>
                            <div class="inventory-item-desc">${event.description.substring(0, 40)}...</div>
                        </div>
                        <div><i class="fas fa-chevron-right"></i></div>
                    </div>
                `).join('')}
            </div>
        `;
    } else {
        // æ‰€æœ‰äº‹ä»¶éƒ½å¤„ç†å®Œäº†
        tracker.innerHTML = `<i class="fas fa-check-circle" style="color: green;"></i> å…¨éƒ¨å¤„ç†å®Œæ¯•`;
        content.innerHTML = `<p class="comment" style="text-align:center; padding: 20px;">æ‰€æœ‰ä¿¡æ¯å‡å·²å¤„ç†å®Œæ¯•ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’å…³é—­ã€‚</p>`;
    }
}

/**
 * ã€å…¨æ–°å‡½æ•°ã€‘å½“ç©å®¶ç‚¹å‡»ä¿¡æ¯ä¸­å¿ƒåˆ—è¡¨ä¸­çš„æŸä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œå¼¹å‡ºè¯¥äº‹ä»¶çš„è¯¦ç»†å¤„ç†çª—å£
 * @param {number} eventIndex ç©å®¶ç‚¹å‡»çš„äº‹ä»¶åœ¨å¾…åŠé˜Ÿåˆ—ä¸­çš„ç´¢å¼•
 */
function showHubEventDetails(eventIndex) {
    const event = pendingEvents[eventIndex];
    if (!event) return;

    // ä¸ºå¼¹çª—çš„é€‰é¡¹æŒ‰é’®é‡æ–°åŒ…è£…å›è°ƒå‡½æ•°
    const decisionOptions = event.options.map((opt) => {
        return {
            htmlContent: opt.htmlContent,
            disabled: opt.disabled,
            callback: () => {
                // 1. å…ˆæ‰§è¡Œé€‰é¡¹æœ¬èº«çš„æ•ˆæœï¼ˆå¦‚åŠ å±æ€§ã€æ˜¾ç¤ºç»“æœç­‰ï¼‰
                if (opt.callback) {
                    opt.callback();
                }
                
                // 2. ä»å¾…åŠé˜Ÿåˆ—ä¸­ç§»é™¤è¿™ä¸ªå·²å¤„ç†çš„äº‹ä»¶
                //    å¿…é¡»åœ¨æ‰§è¡Œå®Œå›è°ƒåå†ç§»é™¤ï¼Œä»¥é˜²ç´¢å¼•é”™ä¹±
                const originalIndex = pendingEvents.findIndex(p => p === event);
                if (originalIndex !== -1) {
                    pendingEvents.splice(originalIndex, 1);
                }
                
                // 3. é‡æ–°æ¸²æŸ“ä¿¡æ¯ä¸­å¿ƒï¼Œåˆ—è¡¨å’Œæ˜Ÿæ˜Ÿä¼šéšä¹‹æ›´æ–°
                renderEventHub();

                // 4. å…³é—­å½“å‰çš„è¯¦ç»†äº‹ä»¶å¼¹çª—
                //    æ³¨æ„ï¼šshowEventCard æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¼¹çª—ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦å†æ‰‹åŠ¨å…³é—­
                //    å¦‚æœ opt.callback æ²¡æœ‰è°ƒç”¨ showEventCard, åˆ™éœ€è¦æ‰‹åŠ¨å…³é—­
                if (!opt.callback || !opt.callback.toString().includes('showEventCard')) {
                    closeAllOverlays();
                    // å¹¶ä¸”é‡æ–°æ‰“å¼€ä¿¡æ¯ä¸­å¿ƒï¼Œå› ä¸ºå¯èƒ½è¢«å…³é—­äº†
                    showOverlay('eventHubOverlay');
                }
            }
        };
    });

    // ä½¿ç”¨æ¸¸æˆå·²æœ‰çš„å†³ç­–å¼¹çª—æ¥æ˜¾ç¤ºäº‹ä»¶è¯¦æƒ…
    showDecisionCard(event.title, event.icon || 'fa-info-circle', event.description, decisionOptions);
}
function handleEventHubChoice(eventIndex, optionIndex) {
    const event = pendingEvents[eventIndex];
    const option = event.options[optionIndex];

    if (option.callback) {
        option.callback();
    }

    // ä»é˜Ÿåˆ—ä¸­ç§»é™¤å·²å¤„ç†çš„äº‹ä»¶
    pendingEvents.splice(eventIndex, 1);

    // åˆ·æ–°ä¿¡æ¯ä¸­å¿ƒï¼Œæ˜¾ç¤ºä¸‹ä¸€ä¸ªäº‹ä»¶æˆ–å®ŒæˆçŠ¶æ€
    renderEventHub();
}
// [æ›¿æ¢] HUB_EVENTS å¯¹è±¡
// [æ›¿æ¢] HUB_EVENTS å¯¹è±¡
const HUB_EVENTS = {
    // çˆ¶æ¯äº’åŠ¨äº‹ä»¶
    parent_health_concern: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && gs.npcs[gs.family.members.motherId] && !gs.npcs[gs.family.members.motherId].isDead,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "æ¯äº²çš„å˜±æ‰˜", icon: "fa-user-md", description: `æ¯äº²æä¿¡ç»™ä½ ï¼Œè¯´æœ€è¿‘å¤©æ°”è½¬å‡‰ï¼Œæ„Ÿè§‰èº«ä½“æœ‰äº›ä¸é€‚ï¼Œè®©ä½ å¤šæ³¨æ„èº«ä½“ï¼Œä¹Ÿç›¼ç€ä½ å›å®¶çœ‹çœ‹ã€‚`,
                options: [
                    { htmlContent: "ã€é€å»500ä¸¤é“¶ç¥¨ã€‘", disabled: gs.finances.wealth < 500, callback: () => {
                        applyEffects({ wealth: -500, relationship: { targetId: mother.id, favor: 10 }, attributes: { virtue: 5 } });
                        showEventCard("æ‹³æ‹³å­å¿ƒ", "fa-money-bill-wave", "ä½ é€å»é“¶ä¸¤ï¼Œæ¯äº²å¤¸ä½ å­é¡ºã€‚");
                    }},
                    { htmlContent: "ã€äº²è‡ªå›å®¶æ¢æœ›ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 15 }, attributes: { virtue: 8, health: 5 } });
                        showEventCard("æ‰¿æ¬¢è†ä¸‹", "fa-home", "ä½ çš„æ¢æœ›è®©æ¯äº²éå¸¸å¼€å¿ƒï¼Œä½ ä»¬å…±åº¦äº†ä¸€æ®µæ¸©é¦¨çš„æ—¶å…‰ã€‚");
                    }},
                    { htmlContent: "ã€å›ä¿¡é—®å€™ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 3 } });
                        showEventCard("çº¸çŸ­æƒ…é•¿", "fa-envelope", "ä½ å†™äº†ä¸€å°é•¿ä¿¡ï¼Œæ¯äº²è¯»åå€æ„Ÿæ¬£æ…°ã€‚");
                    }}
                ]
            };
        }
},
// ===================== ã€æ–°å¢20ä¸ªçˆ¶æ¯äº‹ä»¶ STARTã€‘ =====================
    parent_renovate_ancestral_home: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "ä¿®ç¼®ç¥–å®…", icon: "fa-tools", description: `çˆ¶äº²å°†ä½ å«åˆ°ä¹¦æˆ¿ï¼Œå‘Šè¯‰ä½ å®¶ä¸­ç¥–å®…å› å¹´ä¹…å¤±ä¿®ï¼Œéƒ¨åˆ†æ¢æœ¨å·²æœ½åï¼Œéœ€è¦ä¸€ç¬”èµ„é‡‘è¿›è¡Œä¿®ç¼®ä»¥æ…°ç¥–å…ˆä¹‹çµã€‚`,
                options: [
                    { htmlContent: "ã€æåŠ©5000ä¸¤ã€‘", disabled: gs.finances.wealth < 5000, callback: () => {
                        applyEffects({ wealth: -5000, reputation: 15, relationship: { targetId: father.id, favor: 10 } });
                        showEventCard("å­å¿ƒå¯å˜‰", "fa-hammer", "ä½ çš„æ…·æ…¨è§£å›Šè®©çˆ¶äº²å¤§ä¸ºæ¬£æ…°ï¼Œå®¶æ—å£°æœ›ä¹Ÿå› ä¿®ç¼®ç¥–å®…è€Œæå‡ã€‚");
                    }},
                    { htmlContent: "ã€å»ºè®®æš‚ç¼“ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: -5 } });
                        showEventCard("æ—¶æœºæœªåˆ°", "fa-clock", "ä½ è®¤ä¸ºç›®å‰å®¶æ—è´¢æ”¿ç´§å¼ ï¼Œåº”æš‚ç¼“æ­¤äº‹ã€‚çˆ¶äº²è™½æœªè¨€è¯­ï¼Œä½†ç•¥æ˜¾å¤±æœ›ã€‚");
                    }}
                ]
            };
        }
    },
    parent_dowry_discussion: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead && gs.player.age > 16 && !gs.marriage.isMarried,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "å«å¦†/è˜ç¤¼å•†è®®", icon: "fa-gem", description: `æ¯äº²ä¸ä½ å•†è®®ï¼Œä¸ºäº†ä½ æœªæ¥çš„å©šäº‹ï¼Œæ˜¯å¦åº”è¯¥ä»å®¶åº“ä¸­æ‹¨å‡ºä¸€ç¬”ä¸“æ¬¾ï¼Œä½œä¸ºä½ æœªæ¥çš„å«å¦†æˆ–è˜ç¤¼ï¼Œä»¥å¢æ·»ä½“é¢ã€‚`,
                options: [
                    { htmlContent: "ã€æ‹¨ä»˜10000ä¸¤ã€‘", disabled: gs.family.moneyChest < 10000, callback: () => {
                        gs.family.moneyChest -= 10000;
                        applyEffects({ privateAssets: 10000, relationship: { targetId: mother.id, favor: 8 } });
                        showEventCard("æœªé›¨ç»¸ç¼ª", "fa-box-open", "æ¯äº²æ¬£æ…°ä½ çš„è¿œè§ï¼Œä½ çš„ç§äº§å› æ­¤å¢åŠ ï¼Œæœªæ¥è®®äº²å°†æ›´æœ‰åº•æ°”ã€‚");
                    }},
                    { htmlContent: "ã€è®¤ä¸ºä¸ºæ—¶è¿‡æ—©ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 2 } });
                        showEventCard("å¾å¾å›¾ä¹‹", "fa-leaf", "ä½ è®¤ä¸ºçœ¼ä¸‹åº”ä»¥å‘å±•è‡ªèº«ä¸ºé‡ï¼Œæ¯äº²è§‰å¾—ä½ é¢‡æœ‰ä¸»è§ã€‚");
                    }}
                ]
            };
        }
    },
    parent_clan_dispute: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead && gs.player.age > 18,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "å®—æ—çº çº·", icon: "fa-users-cog", description: `ä¸¤ä½æ—å”å› ç”°äº§è¾¹ç•Œé—®é¢˜äº‰æ‰§ä¸ä¼‘ï¼Œé—¹åˆ°äº†èº«ä¸ºæ—é•¿çš„çˆ¶äº²é¢å‰ã€‚çˆ¶äº²è¯¢é—®ä½ çš„çœ‹æ³•ã€‚`,
                options: [
                    { htmlContent: "ã€å»ºè®®å…¬å¹³è£æ–­ã€‘", req: { wisdom: 70 }, callback: () => {
                        applyEffects({ attributes: { wisdom: 3 }, reputation: 5, relationship: { targetId: father.id, favor: 5 } });
                        showEventCard("å…¬æ­£ä¸¥æ˜", "fa-balance-scale", "ä½ çš„å»ºè®®å¸®åŠ©çˆ¶äº²å…¬æ­£åœ°è§£å†³äº†é—®é¢˜ï¼Œä½ åœ¨å®—æ—ä¸­çš„å£°æœ›æå‡äº†ã€‚");
                    }},
                    { htmlContent: "ã€å»ºè®®å„é€€ä¸€æ­¥ã€‘", req: { charm: 60 }, callback: () => {
                        applyEffects({ attributes: { charm: 3 }, relationship: { targetId: father.id, favor: 3 } });
                        showEventCard("å’Œäº‹ä½¬", "fa-handshake", "åœ¨ä½ çš„åŠè¯´ä¸‹ï¼ŒåŒæ–¹å„é€€ä¸€æ­¥ï¼Œæš‚æ—¶å¹³æ¯äº†çº·äº‰ã€‚");
                    }}
                ]
            };
        }
    },
    parent_charity_donation: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "å®¶æ—å–„å ‚", icon: "fa-hands-helping", description: `æ¯äº²å‘Šè¯‰ä½ ï¼Œå®¶æ—åä¸‹çš„å–„å ‚å…¥ä¸æ•·å‡ºï¼Œéš¾ä»¥ç»´ç³»ï¼Œå¸Œæœ›ä½ èƒ½å‡ºèµ„ç›¸åŠ©ï¼Œä¸ºå®¶æ—ç§¯æ”’ç¦æŠ¥ã€‚`,
                options: [
                    { htmlContent: "ã€æåŠ©2000ä¸¤ã€‘", disabled: gs.finances.wealth < 2000, callback: () => {
                        applyEffects({ wealth: -2000, attributes: { virtue: 10 }, reputation: 5 });
                        showEventCard("ä»å¿ƒå–„ä¸¾", "fa-seedling", "ä½ çš„å–„ä¸¾è®©å–„å ‚å¾—ä»¥ç»´ç³»ï¼Œå®¶æ—çš„ä»å–„ä¹‹åè¿œæ‰¬ã€‚");
                    }},
                    { htmlContent: "ã€è¡¨ç¤ºçˆ±è«èƒ½åŠ©ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -3 } });
                        showEventCard("å¿ƒæœ‰ä½™åŠ›ä¸è¶³", "fa-frown", "ä½ è¡¨ç¤ºè‡ªå·±ç›®å‰ä¹Ÿæœ‰éš¾å¤„ï¼Œæ¯äº²å¯¹æ­¤è¡¨ç¤ºç†è§£ï¼Œä½†ç•¥æ„Ÿå¤±æœ›ã€‚");
                    }}
                ]
            };
        }
    },
    parent_investment_opportunity: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead && gs.player.age > 16,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "å®¶æ—æŠ•èµ„", icon: "fa-chart-line", description: `çˆ¶äº²é€šè¿‡äººè„‰å¾—çŸ¥ï¼Œæœå»·å³å°†å¼€å‘åŸè¥¿çš„ä¸€ç‰‡åŒºåŸŸï¼Œä»–å»ºè®®å®¶æ—åº”æŠ¢å…ˆè´­ç½®ä¸€äº›åœ°å¥‘ä½œä¸ºæŠ•èµ„ã€‚æ­¤äº‹éœ€è¦ä¸€å¤§ç¬”èµ„é‡‘ã€‚`,
                options: [
                    { htmlContent: "ã€æ”¯æŒå¹¶æŠ•å…¥ç§äº§5000ä¸¤ã€‘", disabled: gs.player.privateAssets < 5000, callback: () => {
                        applyEffects({ privateAssets: -5000, familyMoneyChest: 15000 });
                        showEventCard("æŠ•èµ„æœªæ¥", "fa-city", "ä½ æŠ•å…¥äº†ç§äº§ï¼Œçˆ¶äº²æ¬£æ…°ä½ çš„é­„åŠ›ï¼Œå¹¶ä»å®¶åº“æ‹¨ä»˜äº†æ›´å¤šèµ„é‡‘ã€‚è¿™æ¬¡æŠ•èµ„å¾ˆå¯èƒ½åœ¨æœªæ¥å¸¦æ¥å·¨å¤§å›æŠ¥ã€‚");
                    }},
                    { htmlContent: "ã€è®¤ä¸ºé£é™©å¤ªé«˜ã€‘", req: { wisdom: 60 }, callback: () => {
                        applyEffects({ attributes: { wisdom: 2 } });
                        showEventCard("è°¨æ…è¡Œäº‹", "fa-shield-alt", "ä½ åˆ†æäº†å…¶ä¸­çš„é£é™©ï¼Œçˆ¶äº²è®¤ä¸ºä½ çš„é¡¾è™‘ä¹Ÿæœ‰é“ç†ï¼Œå†³å®šæš‚ç¼“æ­¤äº‹ã€‚");
                    }}
                ]
            };
        }
    },
    parent_rival_family_provocation: {
        type: 'parent',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å¯¹æ‰‹æŒ‘è¡…", icon: "fa-swords", description: `ä¸ä½ å®¶ç´ æ¥ä¸ç¦çš„å¯¹å¤´å®¶æ—ï¼Œåœ¨ä¸€æ¬¡å®´ä¼šä¸Šå…¬ç„¶å˜²è®½ä½ å®¶çš„å®¶é£ï¼Œè¨€è¯­ååˆ†åˆ»è–„ã€‚`,
                options: [
                    { htmlContent: "ã€å»ºè®®çˆ¶äº²éšå¿ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 3 } });
                        showEventCard("é™è§‚å…¶å˜", "fa-eye", "ä½ è®¤ä¸ºæ­¤æ—¶ä¸å®œå‘ç”Ÿå†²çªï¼Œçˆ¶äº²é‡‡çº³äº†ä½ çš„å»ºè®®ã€‚");
                    }},
                    { htmlContent: "ã€å»ºè®®å½“åœºå›å‡»ã€‘", callback: () => {
                        applyEffects({ reputation: -5 });
                        showEventCard("æ„æ°”ä¹‹äº‰", "fa-fist-raised", "çˆ¶äº²å½“åœºå‘ä½œï¼Œä¸¤å®¶é—¹å¾—ä¸æ¬¢è€Œæ•£ï¼Œä½ å®¶çš„å£°æœ›å› æ­¤ç•¥å—å½±å“ã€‚");
                    }}
                ]
            };
        }
    },
    parent_relative_help_request: {
        type: 'parent',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "äº²æ—è¯·æ‰˜", icon: "fa-user-friends", description: `ä½ çš„ä¸€ä½è¿œæˆ¿è¡¨äº²å‰æ¥æ±‚åŠ©ï¼Œå¸Œæœ›ä½ èƒ½åˆ©ç”¨ç°åœ¨çš„èŒä½ï¼Œä¸ºä»–çš„å„¿å­åœ¨è¡™é—¨é‡Œå®‰æ’ä¸€ä¸ªé—²å·®ã€‚`,
                options: [
                    { htmlContent: "ã€æ…¨ç„¶åº”å…ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: -8 }, career: { performance: 5 }, relationship: { targetId: mother.id, favor: 5 } });
                        showEventCard("ä»¥æƒè°‹ç§", "fa-user-check", "ä½ è½»æ¾åœ°å®‰æ’äº†æ­¤äº‹ï¼Œæ¯äº²å¯¹ä½ èƒ½å¸®è¡¬å¨˜å®¶æ„Ÿåˆ°æ»¡æ„ï¼Œä½†ä½ çš„å“å¾·æœ‰æ‰€äºæŸã€‚");
                    }},
                    { htmlContent: "ã€ä¸¥è¯æ‹’ç»ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 8 }, relationship: { targetId: mother.id, favor: -8 } });
                        showEventCard("é“é¢æ— ç§", "fa-gavel", "ä½ ä»¥â€œå…¬ç§åˆ†æ˜â€ä¸ºç”±æ‹’ç»äº†ï¼Œäº²æ—æ‚»æ‚»è€Œå»ï¼Œæ¯äº²ä¹Ÿè§‰å¾—ä½ ä¸è¿‘äººæƒ…ã€‚");
                    }}
                ]
            };
        }
    },
    parent_festival_celebration: {
        type: 'parent',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "ç­¹å¤‡å®¶å®´", icon: "fa-utensils", description: `ä¸´è¿‘ä¸­ç§‹ä½³èŠ‚ï¼Œæ¯äº²è®©ä½ è´Ÿè´£ç­¹å¤‡ä»Šå¹´çš„å®¶å®´ï¼Œå¹¶æ‹¨ç»™ä½ ä¸€ç¬”é¢„ç®—ã€‚`,
                options: [
                    { htmlContent: "ã€ç²¾æ‰“ç»†ç®—ï¼ŒèŠ‚çœå¼€æ”¯ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 2, virtue: 2 }, familyMoneyChest: 200 });
                        showEventCard("æŒå®¶æœ‰é“", "fa-calculator", "ä½ å°†å®¶å®´åŠå¾—å¦¥å¸–åˆå®æƒ ï¼Œå¹¶å°†èŠ‚çœä¸‹æ¥çš„200ä¸¤é“¶å­äº¤å›äº†å®¶åº“ï¼Œæ¯äº²å¯¹ä½ èµä¸ç»å£ã€‚");
                    }},
                    { htmlContent: "ã€å¤§æ“å¤§åŠï¼Œå½°æ˜¾ä½“é¢ã€‘", callback: () => {
                        applyEffects({ attributes: { charm: 2 }, reputation: 5 });
                        showEventCard("åœºé¢å®å¤§", "fa-glass-cheers", "ä¸€åœºç››å¤§çš„å®¶å®´è®©å®¶æ—éå¸¸æœ‰é¢å­ï¼Œä½ åœ¨äº²æ—ä¸­çš„å£°æœ›ä¹Ÿæå‡äº†ã€‚");
                    }}
                ]
            };
        }
    },
    parent_servant_loyalty_test: {
        type: 'parent',
        condition: (gs) => gs.player.age > 17,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "ç®¡äº‹ä¹‹æ‰", icon: "fa-user-tie", description: `çˆ¶äº²è®©ä½ è´Ÿè´£è€ƒå¯Ÿæ–°ææ‹”çš„å‡ ä½ç®¡äº‹ï¼Œä»¥åˆ¤æ–­ä»–ä»¬æ˜¯å¦å¿ å¿ƒå¯ç”¨ã€‚`,
                options: [
                    { htmlContent: "ã€æš—ä¸­è§‚å¯Ÿã€‘", req: { wisdom: 80 }, callback: () => {
                        applyEffects({ attributes: { wisdom: 3 } });
                        showEventCard("æ´è‹¥è§‚ç«", "fa-search", "ä½ é€šè¿‡å‡ ä»¶å°äº‹ï¼Œå‡†ç¡®åœ°åˆ¤æ–­å‡ºäº†å„ä½ç®¡äº‹çš„å“æ€§ä¸èƒ½åŠ›ï¼Œçˆ¶äº²å¯¹ä½ çš„è¯†äººä¹‹æ˜é¢‡ä¸ºèµè®¸ã€‚");
                    }},
                    { htmlContent: "ã€ç›´æ¥é—®è¯ã€‘", callback: () => {
                        showEventCard("æµäºè¡¨é¢", "fa-comments", "ä½ ä¸ç®¡äº‹ä»¬è¿›è¡Œäº†ä¸€ç•ªè°ˆè¯ï¼Œä½†å¹¶æœªå¾—åˆ°å¤ªå¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚");
                    }}
                ]
            };
        }
    },
    parent_marriage_alliance: {
        type: 'parent',
        condition: (gs) => gs.player.age > 18 && gs.family.reputation > 100,
        generate: (gs) => {
            return {
                title: "è”å§»ä¹‹è®®", icon: "fa-ring", description: `ä½ çš„çˆ¶æ¯æ­£åœ¨ä¸ºä½ çš„ä¸€ä½å ‚å¦¹/å ‚å¼Ÿç‰©è‰²ä¸€é—¨æœ‰åˆ©çš„å©šäº‹ï¼Œä»¥å·©å›ºå®¶æ—åœ°ä½ï¼Œä»–ä»¬æƒ³å¬å¬ä½ çš„å»ºè®®ã€‚`,
                options: [
                    { htmlContent: "ã€å»ºè®®ä¸æ­¦å°†ä¸–å®¶è”å§»ã€‘", callback: () => {
                        applyEffects({ reputation: 10 });
                        showEventCard("å¼ºå¼ºè”åˆ", "fa-shield-alt", "ä½ çš„å»ºè®®è¢«é‡‡çº³ï¼Œå®¶æ—æˆåŠŸä¸ä¸€æˆ·æ­¦å°†ä¸–å®¶è”å§»ï¼Œå½±å“åŠ›å¤§å¢ã€‚");
                    }},
                    { htmlContent: "ã€å»ºè®®ä¸ä¹¦é¦™é—¨ç¬¬è”å§»ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 5 } });
                        showEventCard("é—¨å½“æˆ·å¯¹", "fa-book-reader", "ä½ çš„å»ºè®®è¢«é‡‡çº³ï¼Œå®¶æ—çš„ä¹¦é¦™åæ°”æ›´ç››ã€‚");
                    }},
                    { htmlContent: "ã€å»ºè®®å°Šé‡å ‚å¦¹/å¼Ÿçš„æ„è§ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 3 } });
                        showEventCard("å„¿å¥³æƒ…é•¿", "fa-heart", "ä½ çš„æƒ³æ³•è™½å¥½ï¼Œä½†é•¿è¾ˆä»¬è®¤ä¸ºä½ æœ‰äº›ç†æƒ³åŒ–ã€‚");
                    }}
                ]
            };
        }
    },
    parent_land_yield_issue: {
        type: 'parent',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "ç”°åº„æ­‰æ”¶", icon: "fa-seedling", description: `å®¶æ—åä¸‹çš„ä¸€å¤„ç”°åº„ä»Šå¹´å› å¤©æ°”ä¸å¥½è€Œæ­‰æ”¶ï¼Œç®¡äº‹è¯·æ±‚å‡å…ä½ƒæˆ·çš„ç§Ÿå­ã€‚`,
                options: [
                    { htmlContent: "ã€åŒæ„å‡å…ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 5 }, reputation: 5 });
                        showEventCard("ä»å¾·ä¹‹å", "fa-thumbs-up", "ä½ çš„å†³å®šè®©ä½ƒæˆ·ä»¬æ„Ÿæ©æˆ´å¾·ï¼Œå®¶æ—çš„ä»å–„ä¹‹åè¿œæ’­ã€‚");
                    }},
                    { htmlContent: "ã€æŒ‰å¥‘çº¦åŠäº‹ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: -3 } });
                        showEventCard("å…¬äº‹å…¬åŠ", "fa-file-signature", "ä½ åšæŒæŒ‰å¥‘çº¦æ”¶ç§Ÿï¼Œè™½ä¿ä½äº†æ”¶å…¥ï¼Œå´å¤±äº†äººå¿ƒã€‚");
                    }}
                ]
            };
        }
    },
    parent_heir_concern: {
        type: 'parent',
        condition: (gs) => gs.player.age > 20 && gs.children.length === 0,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "å­å—£ä¹‹å¿§", icon: "fa-baby", description: `æ¯äº²å°†ä½ å«åˆ°æˆ¿ä¸­ï¼Œå¯¹ä½ æˆå©šè‡³ä»Šä»æ— å­å—£ä¸€äº‹è¡¨è¾¾äº†æ·±åˆ‡çš„æ‹…å¿§ï¼Œå¹¶ä¸ºä½ å¯»æ¥ä¸€å¼ æ±‚å­åæ–¹ã€‚`,
                options: [
                    { htmlContent: "ã€æ”¶ä¸‹åæ–¹ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 10 } });
                        // å¯ä»¥åœ¨æ­¤æ·»åŠ ä¸€ä¸ªä¸´æ—¶buffï¼Œç•¥å¾®æå‡æ€€å­•å‡ ç‡
                        showEventCard("èˆçŠŠæƒ…æ·±", "fa-hand-holding-heart", "ä½ æ”¶ä¸‹äº†åæ–¹ï¼Œæ¯äº²çš„æ‹…å¿§ä¹‹æƒ…æº¢äºè¨€è¡¨ã€‚");
                    }},
                    { htmlContent: "ã€è®¤ä¸ºç¼˜åˆ†æœªåˆ°ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -5 } });
                        showEventCard("ä¸ä»¥ä¸ºç„¶", "fa-comment-slash", "ä½ è®¤ä¸ºå­å—£ä¹‹äº‹åº”é¡ºå…¶è‡ªç„¶ï¼Œæ¯äº²æ— å¥ˆåœ°å¹äº†å£æ°”ã€‚");
                    }}
                ]
            };
        }
    },
    parent_business_slump: {
        type: 'parent',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "åº—é“ºäºæŸ", icon: "fa-chart-area", description: `å®¶æ—åä¸‹çš„ä¸€é—´ç»¸ç¼åº„è¿‘æ¥ç”Ÿæ„æƒ¨æ·¡ï¼ŒæŒç»­äºæŸï¼Œçˆ¶äº²è®©ä½ æ‹¿ä¸ªä¸»æ„ã€‚`,
                options: [
                    { htmlContent: "ã€å»ºè®®æ›´æ¢æŒæŸœã€‘", req: { wisdom: 60 }, callback: () => {
                        applyEffects({ attributes: { wisdom: 2 } });
                        showEventCard("äººäº‹è°ƒåŠ¨", "fa-user-cog", "ä½ è®¤ä¸ºé—®é¢˜å‡ºåœ¨ç®¡ç†ä¸Šï¼Œå»ºè®®æ›´æ¢æŒæŸœã€‚çˆ¶äº²è®¤ä¸ºå¯è¡Œã€‚");
                    }},
                    { htmlContent: "ã€å»ºè®®ä½ä»·å˜å–ã€‘", callback: () => {
                        applyEffects({ familyMoneyChest: 8000 });
                        showEventCard("åŠæ—¶æ­¢æŸ", "fa-dollar-sign", "ä½ è®¤ä¸ºæ­¤ä¹ƒæ— åº•æ´ï¼Œå»ºè®®å°½å¿«å‡ºæ‰‹ã€‚åº—é“ºå˜å–åï¼Œå®¶åº“å¢åŠ äº†8000ä¸¤ã€‚");
                    }},
                    { htmlContent: "ã€å»ºè®®æ³¨å…¥èµ„é‡‘ï¼Œé‡æ–°è£…ä¿®ã€‘", disabled: gs.family.moneyChest < 5000, callback: () => {
                        gs.family.moneyChest -= 5000;
                        showEventCard("ç ´é‡œæ²‰èˆŸ", "fa-hammer", "ä½ å†³å®šå†æä¸€æ¬¡ï¼Œä¸ºåº—é“ºæ³¨å…¥èµ„é‡‘è¿›è¡Œæ”¹é€ ã€‚æˆè´¥ä¸å¦ï¼Œå°šæ˜¯æœªçŸ¥ä¹‹æ•°ã€‚");
                    }}
                ]
            };
        }
    },
    parent_social_etiquette_error: {
        type: 'parent',
        condition: (gs) => gs.player.attributes.etiquette < 50,
        generate: (gs) => {
            return {
                title: "ç¤¼ä»ªå¤±å½“", icon: "fa-book-dead", description: `ä½ åœ¨ä¸€æ¬¡é‡è¦çš„ç¤¾äº¤åœºåˆå› ç¤¼ä»ªä¸å‘¨ï¼Œè¯´é”™äº†è¯ï¼Œè®©å®¶æ—å¤±äº†é¢œé¢ã€‚å›å®¶åï¼Œçˆ¶äº²å¤§å‘é›·éœ†ã€‚`,
                options: [
                    { htmlContent: "ã€è¯šæ³è®¤é”™ã€‘", callback: () => {
                        applyEffects({ attributes: { etiquette: 5 }, relationship: { targetId: 'father', favor: 5 } });
                        showEventCard("çŸ¥é”™èƒ½æ”¹", "fa-check", "ä½ çš„è¯šæ³æ€åº¦è®©çˆ¶äº²æ¶ˆäº†æ°”ï¼Œå¹¶äº²è‡ªæ•™å¯¼äº†ä½ æ­£ç¡®çš„ç¤¼ä»ªã€‚");
                    }},
                    { htmlContent: "ã€æ®ç†åŠ›äº‰ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: 'father', favor: -10 } });
                        showEventCard("å¼ºè¯å¤ºç†", "fa-angry", "ä½ è®¤ä¸ºè‡ªå·±æ²¡é”™ï¼Œä¸çˆ¶äº²å¤§åµä¸€æ¶ï¼Œä¸æ¬¢è€Œæ•£ã€‚");
                    }}
                ]
            };
        }
    },
    parent_ancestral_worship: {
        type: 'parent',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å®—ç¥ ç¥­ç¥–", icon: "fa-gopuram", description: `åˆåˆ°äº†ä¸€å¹´ä¸€åº¦çš„ç¥­ç¥–å¤§å…¸ï¼Œä½œä¸ºå®¶æ—çš„å«¡ç³»å­å­™ï¼Œä½ éœ€è¦è´Ÿè´£å…¶ä¸­ä¸€éƒ¨åˆ†äº‹åŠ¡ã€‚`,
                options: [
                    { htmlContent: "ã€è´Ÿè´£é‡‡ä¹°ç¥­å“ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 3 } });
                        showEventCard("æªå°½èŒå®ˆ", "fa-shopping-basket", "ä½ å°†ç¥­å“é‡‡ä¹°å¾—å¦¥å¦¥å½“å½“ï¼Œæ— ä¸€ç–æ¼ã€‚");
                    }},
                    { htmlContent: "ã€è´Ÿè´£æ’°å†™ç¥­æ–‡ã€‘", req: { talent: 70 }, callback: () => {
                        applyEffects({ attributes: { talent: 3 }, reputation: 5 });
                        showEventCard("æ–‡é‡‡æ–ç„¶", "fa-pen-fancy", "ä½ æ’°å†™çš„ç¥­æ–‡è¾è—»åç¾ï¼Œæƒ…çœŸæ„åˆ‡ï¼Œè·å¾—äº†æ—ä¸­é•¿è¾ˆçš„ä¸€è‡´å¥½è¯„ã€‚");
                    }}
                ]
            };
        }
    },
    parent_ask_about_friend: {
        type: 'parent',
        condition: (gs) => gs.social.friends.length > 0,
        generate: (gs) => {
            const friendId = getRandomElement(gs.social.friends);
            const friend = gs.npcs[friendId];
            return {
                title: "çˆ¶æ¯çš„å…³å¿ƒ", icon: "fa-question-circle", description: `ä½ çš„çˆ¶æ¯å‘ä½ é—®èµ·æœ€è¿‘ä¸ä½ èµ°å¾—å¾ˆè¿‘çš„æœ‹å‹ <strong class="highlight-npc">${friend.name}</strong> çš„æƒ…å†µï¼Œä¼¼ä¹åœ¨ä¸ºä½ çš„äººé™…äº¤å¾€æ“å¿ƒã€‚`,
                options: [
                    { htmlContent: "ã€è¯¦ç»†ä»‹ç»æœ‹å‹çš„ä¼˜ç‚¹ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: friend.id, favor: 5 } });
                        showEventCard("è·å¾—è®¤å¯", "fa-thumbs-up", "ä½ çš„ä»‹ç»è®©çˆ¶æ¯å¯¹ä½ çš„æœ‹å‹å°è±¡ä¸é”™ï¼ŒTAå¾—çŸ¥åä¹Ÿå¾ˆå¼€å¿ƒã€‚");
                    }},
                    { htmlContent: "ã€å«ç³Šå…¶è¾ã€‘", callback: () => {
                        showEventCard("ä¿æŠ¤éšç§", "fa-user-secret", "ä½ æ²¡æœ‰é€éœ²å¤ªå¤šï¼Œçˆ¶æ¯ä¹Ÿæœªå†è¿½é—®ã€‚");
                    }}
                ]
            };
        }
    },
    parent_family_heirloom_story: {
        type: 'parent',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "ä¼ å®¶å®çš„æ•…äº‹", icon: "fa-gem", description: `çˆ¶äº²/æ¯äº²å°†ä½ å¸¦åˆ°å¯†å®¤ï¼ŒæŒ‡ç€ä¸€ä»¶ä¼ å®¶å®ï¼Œå‘ä½ è®²è¿°äº†å®ƒèƒŒåé‚£æ®µå…³äºå®¶æ—å…´è¡°çš„å¾€äº‹ã€‚`,
                options: [
                    { htmlContent: "ã€è®¤çœŸå€¾å¬ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 5, virtue: 3 }, relationship: { targetId: 'father', favor: 5 } });
                        showEventCard("å®¶æ—çš„ä¼ æ‰¿", "fa-scroll", "è¿™æ®µå¾€äº‹è®©ä½ å¯¹å®¶æ—çš„è´£ä»»æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚");
                    }}
                ]
            };
        }
    },
    parent_arrange_meeting: {
        type: 'parent',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "çˆ¶äº²çš„å¼•è", icon: "fa-handshake", description: `ä½ çš„çˆ¶äº²åˆ©ç”¨è‡ªå·±çš„äººè„‰ï¼Œä¸ºä½ å®‰æ’äº†ä¸€æ¬¡ä¸æŸä½æœä¸­å¤§ä½¬çš„ä¼šé¢ï¼Œè¿™å¯¹ä½ çš„äº‹ä¸šå¤§æœ‰è£¨ç›Šã€‚`,
                options: [
                    { htmlContent: "ã€æ„Ÿæ¿€å¹¶å‰å¾€ã€‘", callback: () => {
                        applyEffects({ career: { performance: 20 }, relationship: { targetId: 'father', favor: 8 } });
                        showEventCard("å¹³æ­¥é’äº‘", "fa-arrow-up", "è¿™æ¬¡ä¼šé¢è®©ä½ è·ç›ŠåŒªæµ…ï¼Œä½ åœ¨äº‹ä¸šä¸Šçš„åŠŸç»©å¤§å¹…æå‡ã€‚");
                    }},
                    { htmlContent: "ã€è®¤ä¸ºåº”é è‡ªå·±ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: 'father', favor: -5 } });
                        showEventCard("é£éª¨", "fa-user-tie", "ä½ æ‹’ç»äº†çˆ¶äº²çš„å®‰æ’ï¼Œè®¤ä¸ºåº”å‡­è‡ªå·±çš„å®åŠ›æ‰“æ‹¼ã€‚çˆ¶äº²è™½æ¬£èµä½ çš„éª¨æ°”ï¼Œä½†ä¹Ÿè§‰å¾—ä½ ä¸çŸ¥å˜é€šã€‚");
                    }}
                ]
            };
        }
    },
    parent_financial_pressure: {
        type: 'parent',
        condition: (gs) => gs.finances.financialTier <= 2,
        generate: (gs) => {
            return {
                title: "è´¢æ”¿å‹åŠ›", icon: "fa-file-invoice-dollar", description: `å› å®¶æ—è´¢åŠ›ç­‰çº§é™è‡³â€œå‹‰å¼ºåº¦æ—¥â€ï¼Œä½ çš„çˆ¶æ¯å¿§å¿ƒå¿¡å¿¡ï¼Œä¸ä½ å•†è®®å¼€æºèŠ‚æµä¹‹æ³•ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸»åŠ¨æ‰¿æ‹…éƒ¨åˆ†å¼€é”€ã€‘", disabled: gs.player.privateAssets < 2000, callback: () => {
                        applyEffects({ privateAssets: -2000, familyMoneyChest: 2000, attributes: { virtue: 5 } });
                        showEventCard("å…±æ¸¡éš¾å…³", "fa-users", "ä½ æ‹¿å‡ºç§äº§è¡¥è´´å®¶ç”¨ï¼Œçˆ¶æ¯æ·±å—æ„ŸåŠ¨ã€‚");
                    }},
                    { htmlContent: "ã€æè®®å˜å–éƒ¨åˆ†èµ„äº§ã€‘", callback: () => {
                        showEventCard("æ–­è‡‚æ±‚ç”Ÿ", "fa-store-slash", "ä½ æè®®å˜å–éƒ¨åˆ†éæ ¸å¿ƒèµ„äº§ä»¥åº¦è¿‡éš¾å…³ï¼Œçˆ¶æ¯åŒæ„äº†ä½ çš„çœ‹æ³•ã€‚");
                    }}
                ]
            };
        }
    },
    parent_celebrate_success: {
        type: 'parent',
        condition: (gs) => gs.career.level > 3,
        generate: (gs) => {
            return {
                title: "ä¸ºä½ åº†è´º", icon: "fa-award", description: `ä½ åœ¨äº‹ä¸šä¸Šå–å¾—äº†ä¸å°çš„æˆå°±ï¼Œä½ çš„çˆ¶æ¯ç‰¹åœ°ä¸ºä½ ä¸¾åŠäº†ä¸€åœºå®¶å®´åº†è´ºï¼Œå¹¶å½“ä¼—ç§°èµä½ æ˜¯å®¶æ—çš„éª„å‚²ã€‚`,
                options: [
                    { htmlContent: "ã€è°¦è™šå›åº”ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 3 }, relationship: { targetId: 'father', favor: 10 } });
                        showEventCard("å…‰è€€é—¨æ¥£", "fa-trophy", "ä½ çš„è°¦é€Šå’Œæˆå°±è®©çˆ¶æ¯å€æ„Ÿæ¬£æ…°ï¼Œä¸€å®¶äººå…¶ä¹èèã€‚");
                    }}
                ]
            };
        }
    },
// ===================== ã€æ–°å¢20ä¸ªçˆ¶æ¯äº‹ä»¶ ENDã€‘ =====================
    father_career_advice: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && gs.npcs[gs.family.members.fatherId] && !gs.npcs[gs.family.members.fatherId].isDead && gs.career.path,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "çˆ¶äº²çš„æ•™è¯²", icon: "fa-gavel", description: `çˆ¶äº²å”¤ä½ å»ä¹¦æˆ¿ï¼Œè€ƒæ ¡ä½ æœ€è¿‘åœ¨äº‹ä¸šä¸Šçš„è¿›å±•ï¼Œå¹¶å¯¹ä½ æœªæ¥çš„é“è·¯æå‡ºäº†ä¸€äº›å»ºè®®ã€‚`,
                options: [
                    { htmlContent: "ã€è™šå¿ƒè¯·æ•™ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 10 }, attributes: { wisdom: 5 } });
                        gs.career.performance += 10;
                        showEventCard("å—ç›ŠåŒªæµ…", "fa-lightbulb", "çˆ¶äº²çš„ç»éªŒä¹‹è°ˆè®©ä½ èŒ…å¡é¡¿å¼€ã€‚");
                    }},
                    { htmlContent: "ã€ä¸ä»¥ä¸ºç„¶ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: -5 } });
                        showEventCard("å›ºæ‰§å·±è§", "fa-times-circle", "ä½ è§‰å¾—çˆ¶äº²çš„çœ‹æ³•å·²ç»è¿‡æ—¶ï¼Œçˆ¶äº²å¯¹ä½ çš„æ€åº¦æœ‰äº›å¤±æœ›ã€‚");
                    }},
                ]
            };
        }
},
    mother_teach_skill: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && gs.npcs[gs.family.members.motherId] && !gs.npcs[gs.family.members.motherId].isDead,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            const skill = gs.player.gender === 'female' ? 'åˆºç»£' : 'ä¸€é“å®¶ä¹¡èœ';
            return {
                title: "æ¯äº²çš„ä¼ æˆ", icon: "fa-hand-holding-heart", description: `æ¯äº²å°†ä½ å«åˆ°èº«è¾¹ï¼Œæ‰“ç®—å°†ä¸€é—¨å®¶ä¼ çš„${skill}æ‰‹è‰ºä¼ æˆç»™ä½ ã€‚`,
                options: [
                    { htmlContent: "ã€ç”¨å¿ƒå­¦ä¹ ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 10 }, attributes: { talent: 3 } });
                        showEventCard("æ‚‰å¿ƒå—æ•™", "fa-graduation-cap", `ä½ è®¤çœŸå­¦ä¹ ï¼Œå¾ˆå¿«ä¾¿æŒæ¡äº†çªé—¨ã€‚æ¯äº²å¯¹ä½ çš„èªæ…§å¾ˆæ˜¯æ»¡æ„ã€‚`);
                    }},
                    { htmlContent: "ã€å€Ÿå£æ¨è¾ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -5 } });
                        showEventCard("è¾œè´Ÿå¿ƒæ„", "fa-times-circle", `ä½ å¯¹æ­¤ä¸æ„Ÿå…´è¶£ï¼Œæ‰¾äº†ä¸ªå€Ÿå£æ¨è¾äº†ã€‚æ¯äº²çš„çœ¼ç¥æœ‰äº›å¤±æœ›ã€‚`);
                    }}
                ]
            };
        }
    },
    father_play_chess: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && gs.npcs[gs.family.members.fatherId] && !gs.npcs[gs.family.members.fatherId].isDead,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "çˆ¶äº²çš„æ£‹å±€", icon: "fa-chess", description: `çˆ¶äº²åœ¨ä¹¦æˆ¿æ‘†ä¸‹æ£‹å±€ï¼Œé‚€ä½ å¯¹å¼ˆä¸€å±€ï¼Œä¼¼ä¹æƒ³å€Ÿæ­¤è€ƒæ ¡ä½ çš„å¿ƒæ€§ã€‚`,
                options: [
                    { htmlContent: "ã€æ²‰ç€åº”å¯¹ã€‘", callback: () => {
                        if (gs.player.attributes.wisdom > 70) {
                            applyEffects({ relationship: { targetId: father.id, favor: 10 }, attributes: { wisdom: 3 } });
                            showEventCard("æ£‹é€¢å¯¹æ‰‹", "fa-lightbulb", `ä½ ä»¬çš„æ£‹å±€æœ‰æ¥æœ‰å›ï¼Œæœ€ç»ˆä½ é™©èƒœåŠå­ã€‚çˆ¶äº²å¯¹ä½ çš„æ™ºè°‹å¤§åŠ èµèµã€‚`);
                        } else {
                            applyEffects({ relationship: { targetId: father.id, favor: 5 }, attributes: { wisdom: 2 } });
                            showEventCard("å°šéœ€ç£¨ç»ƒ", "fa-book-reader", `è™½ç„¶è¾“äº†æ£‹ï¼Œä½†ä½ åœ¨æ£‹å±€ä¸­å±•ç°çš„éŸ§æ€§è®©çˆ¶äº²é¢‡ä¸ºæ¬£èµã€‚`);
                        }
                    }},
                    { htmlContent: "ã€æ•…æ„è¾“æ£‹ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 8 }, attributes: { charm: 2 } });
                        showEventCard("æ‰¿è®©", "fa-grin-wink", `ä½ æ•…æ„éœ²å‡ºç ´ç»½è¾“äº†æ£‹ï¼Œå¹¶ç§°èµçˆ¶äº²æ£‹è‰ºé«˜è¶…ï¼ŒæŠŠä»–å“„å¾—å¾ˆå¼€å¿ƒã€‚`);
                    }}
                ]
            };
        }
    },
    parents_ask_about_love_life: {
        type: 'parent',
        condition: (gs) => !gs.marriage.isMarried && gs.player.age >= 16 && gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "åŒäº²çš„å…³åˆ‡", icon: "fa-heart", description: `ä½ çš„çˆ¶æ¯æŠŠä½ å«åˆ°è·Ÿå‰ï¼Œæ—æ•²ä¾§å‡»åœ°è¯¢é—®ä½ æ˜¯å¦æœ‰å¿ƒä¸Šäººï¼Œè¨€è¯­é—´æ»¡æ˜¯ä¸ºä½ å©šäº‹æ“åŠ³ä¹‹æ„ã€‚`,
                options: [
                    { htmlContent: "ã€å¦ç™½å·²æœ‰æ„ä¸­äººã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 5 } });
                        showEventCard("å„¿å¥³å¿ƒäº‹", "fa-user-friends", `ä½ å«ç³Šåœ°é€éœ²äº†äº›è®¸ä¿¡æ¯ï¼Œçˆ¶æ¯è¡¨ç¤ºä¼šä¸ºä½ ç•™æ„ã€‚`);
                    }},
                    { htmlContent: "ã€è¡¨ç¤ºä¸€åˆ‡å‡­çˆ¶æ¯åšä¸»ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 10 }, attributes: { virtue: 3 } });
                        showEventCard("å­é¡ºä¹‹ä¸¾", "fa-child", `ä½ çš„é¡ºä»è®©çˆ¶æ¯éå¸¸æ»¡æ„ï¼Œä»–ä»¬å†³å®šä¸ºä½ ç‰©è‰²ä¸€é—¨å¥½äº²äº‹ã€‚`);
                    }},
                    { htmlContent: "ã€æ’ç§‘æ‰“è¯¨ï¼Œè’™æ··è¿‡å…³ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -3 } });
                        showEventCard("å›é¿", "fa-comment-slash", `ä½ ç”¨ç©ç¬‘è¯å²”å¼€äº†è¯é¢˜ï¼Œçˆ¶æ¯æ— å¥ˆåœ°å¹äº†å£æ°”ã€‚`);
                    }}
                ]
            };
        }
    },
    mother_gives_heirloom: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "æ…ˆæ¯æ‰‹ä¸­ç‰©", icon: "fa-gem", description: `æ¯äº²å°†ä½ æ‹‰åˆ°ä¸€æ—ï¼Œä»ä¸€ä¸ªç²¾è‡´çš„æœ¨åŒ£ä¸­å–å‡ºä¸€ä»¶ä¼ å®¶å®ï¼ˆç‰ä½©/ç é’—ï¼‰ï¼Œäº¤åˆ°ä½ çš„æ‰‹ä¸­ï¼Œå®å˜±ä½ è¦å¥½ç”Ÿä¿ç®¡ã€‚`,
                options: [
                    { htmlContent: "ã€éƒ‘é‡æ”¶ä¸‹ã€‘", callback: () => {
                        addItemToInventory('chuan_jia_yu_pei', 1);
                        applyEffects({ relationship: { targetId: mother.id, favor: 15 } });
                        showEventCard("ä¼ æ‰¿", "fa-hand-holding-heart", `ä½ æ”¶ä¸‹äº†è¿™ä»½æ²‰ç”¸ç”¸çš„ä¼ æ‰¿ï¼Œæ¯äº²æ¬£æ…°åœ°ç¬‘äº†ã€‚`);
                    }}
                ]
            };
        }
    },
    father_ask_political_view: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead && gs.player.age >= 18,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "çˆ¶äº²çš„è€ƒæ ¡", icon: "fa-landmark", description: `çˆ¶äº²ä¸ä½ è°ˆåŠæœ€è¿‘æœå ‚ä¸Šå…³äºâ€œå¼€æ”¾æµ·ç¦â€çš„äº‰è®®ï¼Œè¯¢é—®ä½ çš„çœ‹æ³•ã€‚`,
                options: [
                    { htmlContent: "ã€é™ˆè¿°åˆ©å¼Šï¼Œè§‚ç‚¹ä¸­ç«‹ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 8 }, attributes: { wisdom: 4 } });
                        showEventCard("å°‘å¹´è€æˆ", "fa-balance-scale", `ä½ å¯¹åˆ©å¼Šçš„åˆ†æé¢‡æœ‰è§åœ°ï¼Œçˆ¶äº²å¯¹ä½ çš„æˆç†Ÿç¨³é‡é¢‡ä¸ºæ¬£èµã€‚`);
                    }},
                    { htmlContent: "ã€æ¿€è¿›æ”¯æŒï¼Œè®¤ä¸ºæœ‰åˆ©å¯å›¾ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 3 } });
                        showEventCard("é”‹èŠ’æ¯•éœ²", "fa-lightbulb-on", `ä½ çš„è§‚ç‚¹è™½ç„¶æ¿€è¿›ï¼Œä½†ä¹Ÿå±•ç°äº†ä½ çš„é­„åŠ›ã€‚`);
                    }},
                    { htmlContent: "ã€ä¿å®ˆåå¯¹ï¼Œè®¤ä¸ºæœ‰ä¼¤å›½æœ¬ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 3 } });
                        showEventCard("æ€æƒ³ä¿å®ˆ", "fa-shield-alt", `ä½ çš„è§‚ç‚¹è™½ç„¶ä¿å®ˆï¼Œä½†ä¹Ÿä½“ç°äº†ä½ çš„è°¨æ…ã€‚`);
                    }}
                ]
            };
        }
    },
    parents_anniversary: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead && gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "åŒäº²çºªå¿µæ—¥", icon: "fa-gifts", description: `ä½ å¾—çŸ¥ä»Šæ—¥æ˜¯çˆ¶æ¯çš„æˆå©šçºªå¿µæ—¥ï¼Œä½ æ‰“ç®—å¦‚ä½•ä¸ºä»–ä»¬åº†ç¥ï¼Ÿ`,
                options: [
                    { htmlContent: "ã€ä¸¾åŠå®¶å®´ã€‘", disabled: gs.finances.wealth < 200, callback: () => {
                        applyEffects({ wealth: -200, relationship: { targetId: father.id, favor: 8 }, relationship: { targetId: mother.id, favor: 8 } });
                        showEventCard("é˜–å®¶æ¬¢ä¹", "fa-users", `ä¸€åœºæ¸©é¦¨çš„å®¶å®´è®©çˆ¶æ¯ç¬‘å¾—åˆä¸æ‹¢å˜´ã€‚`);
                    }},
                    { htmlContent: "ã€é€ä¸Šè´ºç¤¼ã€‘", disabled: gs.finances.wealth < 300, callback: () => {
                        applyEffects({ wealth: -300, relationship: { targetId: father.id, favor: 10 }, relationship: { targetId: mother.id, favor: 10 } });
                        showEventCard("è´´å¿ƒä¹‹ä¸¾", "fa-gift", `ä½ ç²¾å¿ƒæŒ‘é€‰çš„è´ºç¤¼è®©çˆ¶æ¯ååˆ†æƒŠå–œã€‚`);
                    }},
                    { htmlContent: "ã€å£å¤´ç¥ç¦ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 3 }, relationship: { targetId: mother.id, favor: 3 } });
                        showEventCard("è¨€è¯­æ…°è—‰", "fa-comment-dots", `ä½ çš„ç¥ç¦ä¹Ÿè®©çˆ¶æ¯æ„Ÿåˆ°æ¬£æ…°ã€‚`);
                    }}
                ]
            };
        }
    },
    mother_dislike_friend: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead && gs.social.friends.length > 0,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            const friend = gs.npcs[getRandomElement(gs.social.friends)];
            return {
                title: "æ¯äº²çš„æ„è§", icon: "fa-user-slash", description: `æ¯äº²å‘Šè¯‰ä½ ï¼Œå¥¹ä¸å¤ªå–œæ¬¢ä½ æ–°ç»“äº¤çš„æœ‹å‹ <strong class="highlight-npc">${friend.name}</strong>ï¼Œè®¤ä¸ºå¯¹æ–¹â€œå‡ºèº«ä½å¾®â€æˆ–â€œæ²¹è…”æ»‘è°ƒâ€ï¼ŒåŠä½ ä¸ä¹‹ç–è¿œã€‚`,
                options: [
                    { htmlContent: "ã€å¬ä»æ¯äº²ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 5 }, relationship: { targetId: friend.id, favor: -15 } });
                        showEventCard("ç–è¿œ", "fa-user-minus", `ä½ æ¸æ¸ç–è¿œäº†${friend.name}ï¼Œæ¯äº²å¯¹æ­¤å¾ˆæ»¡æ„ã€‚`);
                    }},
                    { htmlContent: "ã€ä¸ºæœ‹å‹è¾©è§£ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -8 }, relationship: { targetId: friend.id, favor: 5 } });
                        showEventCard("ä»—ä¹‰æ‰§è¨€", "fa-handshake", `ä½ ä¸ºæœ‹å‹è¾©è§£ï¼Œæ¯äº²è®¤ä¸ºä½ â€œè¯†äººä¸æ¸…â€ï¼Œä½†${friend.name}å¾—çŸ¥åå¾ˆæ„ŸåŠ¨ã€‚`);
                    }}
                ]
            };
        }
    },
    father_disappointed_career: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead && gs.career.path,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "çˆ¶äº²çš„å¤±æœ›", icon: "fa-chart-area", description: `çˆ¶äº²å°†ä½ å«åˆ°ä¹¦æˆ¿ï¼Œå¯¹ä½ è¿‘æ¥åœ¨äº‹ä¸šä¸Šçš„åœæ»ä¸å‰è¡¨ç¤ºå¤±æœ›ï¼Œè®¤ä¸ºä½ è¾œè´Ÿäº†ä»–çš„æœŸæœ›ã€‚`,
                options: [
                    { htmlContent: "ã€è™šå¿ƒæ¥å—æ‰¹è¯„ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 5 } });
                        gs.career.performance += 15;
                        showEventCard("çŸ¥è€»åå‹‡", "fa-arrow-up", `çˆ¶äº²çš„æ‰¹è¯„è®©ä½ å¹¡ç„¶é†’æ‚Ÿï¼Œå·¥ä½œæ›´åŠ åŠªåŠ›äº†ã€‚`);
                    }},
                    { htmlContent: "ã€æ®ç†åŠ›äº‰ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: -10 } });
                        showEventCard("çˆ¶å­éš”é˜‚", "fa-angry", `ä½ è®¤ä¸ºçˆ¶äº²ä¸ç†è§£ä½ çš„éš¾å¤„ï¼Œä½ ä»¬å¤§åµä¸€æ¶ï¼Œä¸æ¬¢è€Œæ•£ã€‚`);
                    }}
                ]
            };
        }
    },
    mother_managing_social_event: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead && gs.player.age >= 15,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "åç†å®¶äº‹", icon: "fa-users-cog", description: `æ¯äº²è¦ä¸¾åŠä¸€åœºé‡è¦çš„èŒ¶ä¼šï¼Œå®´è¯·äº¬ä¸­è´µå¦‡ï¼Œå¸Œæœ›ä½ èƒ½ä»æ—ååŠ©ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶åº”å…ã€‘", callback: () => {
                        if (gs.player.attributes.etiquette > 60) {
                            applyEffects({ relationship: { targetId: mother.id, favor: 10 }, attributes: { charm: 5, reputation: 5 } });
                            showEventCard("å¤§æ”¾å¼‚å½©", "fa-star", `ä½ åœ¨èŒ¶ä¼šä¸Šçš„è¡¨ç°æ— å¯æŒ‘å‰”ï¼Œä¸ºä½ å’Œå®¶æ—èµ¢å¾—äº†èµèª‰ã€‚`);
                        } else {
                            applyEffects({ relationship: { targetId: mother.id, favor: 2 }, attributes: { etiquette: 3 } });
                            showEventCard("ä»ä¸­å­¦ä¹ ", "fa-book-open", `è™½ç„¶å‡ºäº†äº›å°å·®é”™ï¼Œä½†ä½ ä¹Ÿä»ä¸­å­¦åˆ°äº†è®¸å¤šä¸»æŒå®´ä¼šçš„æŠ€å·§ã€‚`);
                        }
                    }},
                    { htmlContent: "ã€è¡¨ç¤ºä¸æ„Ÿå…´è¶£ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -6 } });
                        showEventCard("ä¸æ„¿äº¤é™…", "fa-comment-slash", `ä½ å¯¹è¿™ç§åº”é…¬åœºåˆæ„Ÿåˆ°åŒçƒ¦ï¼Œæ¯äº²åªå¥½å¦å¯»ä»–äººã€‚`);
                    }}
                ]
            };
        }
    },
    father_gives_book: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "çˆ¶äº²çš„èµ ç¤¼", icon: "fa-book-open", description: `çˆ¶äº²å°†ä¸€æœ¬ä»–çè—å¤šå¹´çš„å…µæ³•/ç»å­¦å­¤æœ¬èµ äºˆä½ ï¼Œå¸Œæœ›ä½ èƒ½ä»ä¸­è·ç›Šã€‚`,
                options: [
                    { htmlContent: "ã€æ„Ÿæ¿€æ”¶ä¸‹ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 12 }, attributes: { wisdom: 5, martial: 3 } });
                        showEventCard("å¦‚è·è‡³å®", "fa-gem", `ä½ ä»ä¹¦ä¸­è·ç›ŠåŒªæµ…ï¼Œçˆ¶äº²å¯¹ä½ çš„å¥½å­¦ååˆ†æ¬£æ…°ã€‚`);
                    }}
                ]
            };
        }
    },
    parents_sick: {
        type: 'parent',
        condition: (gs) => (gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead) || (gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead),
        generate: (gs) => {
            const parent = gs.npcs[gs.family.members.fatherId] || gs.npcs[gs.family.members.motherId];
            return {
                title: "äº²é•¿æŠ±æ™", icon: "fa-user-md", description: `ä½ çš„äº²é•¿(<strong class="highlight-npc">${parent.name}</strong>)è¿‘æ¥å§ç—…åœ¨åºŠï¼Œç²¾ç¥ä¸ä½³ã€‚`,
                options: [
                    { htmlContent: "ã€åºŠå‰ä¾ç–¾ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: parent.id, favor: 20 }, attributes: { virtue: 8, health: -5 } });
                        showEventCard("å­æ„ŸåŠ¨å¤©", "fa-hand-holding-heart", `ä½ è¡£ä¸è§£å¸¦åœ°åœ¨åºŠå‰ä¾å¥‰ï¼Œè™½ç„¶ç´¯åäº†è‡ªå·±ï¼Œä½†äº²é•¿æ·±å—æ„ŸåŠ¨ã€‚`);
                    }},
                    { htmlContent: "ã€éå¯»ååŒ»ã€‘(-500ä¸¤)", disabled: gs.finances.wealth < 500, callback: () => {
                        applyEffects({ wealth: -500, relationship: { targetId: parent.id, favor: 10 } });
                        showEventCard("é‡é‡‘æ±‚åŒ»", "fa-pills", `ä½ èŠ±è´¹é‡é‡‘è¯·æ¥ååŒ»ï¼Œäº²é•¿çš„ç—…æƒ…å¤§ä¸ºå¥½è½¬ã€‚`);
                    }}
                ]
            };
        }
    },
    father_family_matter: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead && gs.player.age >= 18,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "å®¶æ—çš„éš¾é¢˜", icon: "fa-users-cog", description: `ä¸€ä½è¿œæˆ¿æ—äº²åœ¨å¤–æƒ¹æ˜¯ç”Ÿéï¼Œè´¥åé—¨æ¥£ï¼Œçˆ¶äº²å°±æ­¤äº‹å¾æ±‚ä½ çš„æ„è§ã€‚`,
                options: [
                    { htmlContent: "ã€å»ºè®®ä¸¥æƒ©ï¼Œé€å‡ºå®¶é—¨ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 5 }, attributes: { virtue: -3 } });
                        showEventCard("é“é¢æ— ç§", "fa-gavel", `çˆ¶äº²é‡‡çº³äº†ä½ çš„å»ºè®®ï¼Œè®¤ä¸ºä½ å¤„äº‹æœå†³ï¼Œä½†ç•¥æ˜¾æ— æƒ…ã€‚`);
                    }},
                    { htmlContent: "ã€å»ºè®®ç§ä¸‹è§£å†³ï¼Œä¿å…¨é¢œé¢ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 8 }, attributes: { wisdom: 3 } });
                        showEventCard("é¡¾å…¨å¤§å±€", "fa-shield-alt", `çˆ¶äº²è®¤ä¸ºä½ çš„æ–¹æ³•æ›´ä¸ºå‘¨å…¨ï¼Œå¯¹ä½ çš„æ™ºæ…§é¢‡ä¸ºèµè®¸ã€‚`);
                    }}
                ]
            };
        }
    },
    mother_parenting_disagreement: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && !gs.npcs[gs.family.members.motherId].isDead && gs.children.some(c => !c.isDead && c.age < 16),
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age < 16));
            return {
                title: "æ•™å…»ä¹‹äº‰", icon: "fa-baby", description: `ä½ çš„æ¯äº²è®¤ä¸ºä½ å¯¹å­™è¾ˆ(<strong class="highlight-npc">${child.name}</strong>)çš„æ•™è‚²æ–¹å¼å¤ªè¿‡ä¸¥å‰/å®½æ¾ï¼Œä¸ä½ äº§ç”Ÿäº†åˆ†æ­§ã€‚`,
                options: [
                    { htmlContent: "ã€å¬ä»æ¯äº²çš„ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 8 } });
                        child.favor -= 3;
                        showEventCard("ç™¾å–„å­ä¸ºå…ˆ", "fa-hands", `ä½ å¬ä»äº†æ¯äº²çš„æ„è§ï¼Œå¥¹å¾ˆæ»¡æ„ï¼Œä½†ä½ çš„å­©å­ä¼¼ä¹æœ‰äº›ä¸å¼€å¿ƒã€‚`);
                    }},
                    { htmlContent: "ã€åšæŒè‡ªå·±çš„çœ‹æ³•ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -8 } });
                        child.favor += 5;
                        showEventCard("åšæŒå·±è§", "fa-chalkboard-teacher", `ä½ åšæŒè‡ªå·±çš„æ•™è‚²ç†å¿µï¼Œæ¯äº²è®¤ä¸ºä½ ä¸å°Šé‡é•¿è¾ˆï¼Œä½†ä½ çš„å­©å­è§‰å¾—ä½ ç†è§£TAã€‚`);
                    }}
                ]
            };
        }
    },
    parents_family_finance: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "å®¶æ—è´¢æ”¿", icon: "fa-file-invoice-dollar", description: `å®¶æ—åä¸‹æœ‰ä¸€å¤„é—²ç½®çš„è€å®…ï¼Œçˆ¶äº²å°±æ˜¯å¦è¦å°†å…¶å˜å–ä¸€äº‹ï¼Œæƒ³å¬å¬ä½ çš„æ„è§ã€‚`,
                options: [
                    { htmlContent: "ã€å»ºè®®å–æ‰ï¼Œç›˜æ´»èµ„é‡‘ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 5 }, attributes: { wisdom: 2 } });
                        gs.family.moneyChest = (gs.family.moneyChest || 0) + 5000;
                        showEventCard("ç›˜æ´»èµ„äº§", "fa-coins", `çˆ¶äº²å¬ä»ä½ çš„å»ºè®®å–æ‰äº†è€å®…ï¼Œå®¶æ—èµ„é‡‘å¢åŠ äº†5000ä¸¤ã€‚`);
                    }},
                    { htmlContent: "ã€å»ºè®®ä¿ç•™ï¼Œæ­¤ä¹ƒç¥–äº§ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 5 }, attributes: { virtue: 3 } });
                        showEventCard("æ•¬é‡ä¼ ç»Ÿ", "fa-landmark", `çˆ¶äº²å¯¹ä½ æ•¬é‡ç¥–äº§çš„æ€åº¦å¾ˆæ»¡æ„ã€‚`);
                    }}
                ]
            };
        }
    },
    parents_mediating_dispute: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && !gs.npcs[gs.family.members.fatherId].isDead && gs.player.age >= 18,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "è°ƒè§£çº çº·", icon: "fa-handshake", description: `ä¸¤ä½å¾·é«˜æœ›é‡çš„æ—å”å› ç”°äº§åˆ’åˆ†é—®é¢˜äº‰æ‰§ä¸ä¸‹ï¼Œçˆ¶äº²è®©ä½ å‡ºé¢è°ƒè§£ã€‚`,
                options: [
                    { htmlContent: "ã€ç€æ‰‹å¤„ç†ã€‘", callback: () => {
                        if (gs.player.attributes.charm > 70 && gs.player.attributes.wisdom > 70) {
                            applyEffects({ relationship: { targetId: father.id, favor: 12 }, reputation: 10 });
                            showEventCard("è°ƒè§£æˆåŠŸ", "fa-check", `ä½ å‡­å€Ÿå‡ºè‰²çš„å£æ‰å’Œæ™ºæ…§ï¼ŒæˆåŠŸåŒ–è§£äº†æ—å”çš„çŸ›ç›¾ï¼Œçˆ¶äº²å¯¹ä½ çš„èƒ½åŠ›å¤§åŠ èµèµã€‚`);
                        } else {
                            applyEffects({ relationship: { targetId: father.id, favor: -5 } });
                            showEventCard("è°ƒè§£å¤±è´¥", "fa-times", `ä½ æ²¡èƒ½è¯´æœåŒæ–¹ï¼Œåè€Œè®©çŸ›ç›¾æ¿€åŒ–äº†ã€‚`);
                        }
                    }}
                ]
            };
        }
    },
    parent_reminisce: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && gs.npcs[gs.family.members.fatherId] && !gs.npcs[gs.family.members.fatherId].isDead,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "è¿½å¿†å¾€æ˜”", icon: "fa-history", description: `çˆ¶äº²ä¸ä½ èŠèµ·ä»–å¹´è½»æ—¶çš„å…‰è¾‰å²æœˆï¼Œè¨€è¯­é—´é¢‡ä¸ºè‡ªè±ªã€‚`,
                options: [
                    { htmlContent: "ã€è®¤çœŸå€¾å¬ï¼Œè¡¨ç¤ºå´‡æ‹œã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: 10 } });
                        showEventCard("çˆ¶å­æƒ…æ·±", "fa-user-friends", "ä½ çš„å´‡æ‹œè®©çˆ¶äº²éå¸¸å—ç”¨ã€‚");
                    }},
                    { htmlContent: "ã€å¬å¾—ä¸è€çƒ¦ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: -5 } });
                        showEventCard("ä»£æ²Ÿ", "fa-meh", "ä½ è§‰å¾—è¿™äº›äº‹å·²ç»å¬è¿‡å¾ˆå¤šéäº†ã€‚");
                    }}
                ]
            };
        }
    },
    parent_investment_advice: {
        type: 'parent',
        condition: (gs) => gs.family.members.fatherId && gs.npcs[gs.family.members.fatherId] && !gs.npcs[gs.family.members.fatherId].isDead,
        generate: (gs) => {
            const father = gs.npcs[gs.family.members.fatherId];
            return {
                title: "çˆ¶äº²çš„æŠ•èµ„å»ºè®®", icon: "fa-chart-line", description: `çˆ¶äº²å‘Šè¯‰ä½ ï¼Œä»–æœ€è¿‘çœ‹å¥½åŸå—çš„ä¸€å¤„åœ°äº§ï¼Œå»ºè®®ä½ æŠ•èµ„ã€‚`,
                options: [
                    { htmlContent: "ã€å¬ä»å»ºè®®ï¼ŒæŠ•èµ„5000ä¸¤ã€‘", disabled: gs.finances.wealth < 5000, callback: () => {
                        applyEffects({ wealth: -5000 });
                        if (Math.random() < 0.6) {
                            applyEffects({ wealth: 7500 });
                            showEventCard("æŠ•èµ„æˆåŠŸ", "fa-arrow-up", "ä½ å¬ä»äº†çˆ¶äº²çš„å»ºè®®ï¼ŒæŠ•èµ„è·å¾—äº†ä¸°åšå›æŠ¥ï¼");
                        } else {
                            showEventCard("æŠ•èµ„å¤±è´¥", "fa-arrow-down", "ä¸å¹¸çš„æ˜¯ï¼Œé‚£å¤„åœ°äº§å¹¶æœªå¦‚é¢„æœŸèˆ¬å¢å€¼ã€‚");
                        }
                    }},
                    { htmlContent: "ã€å©‰è¨€è°¢ç»ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: father.id, favor: -3 } });
                        showEventCard("å¦æœ‰æ‰“ç®—", "fa-times", "ä½ è¡¨ç¤ºè‡ªå·±å¦æœ‰æŠ•èµ„è®¡åˆ’ï¼Œçˆ¶äº²ç•¥æ„Ÿå¤±æœ›ã€‚");
                    }}
                ]
            };
        }
    },
    parent_family_gossip: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && gs.npcs[gs.family.members.motherId] && !gs.npcs[gs.family.members.motherId].isDead,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "æ¯äº²çš„é—²è°ˆ", icon: "fa-comments", description: `æ¯äº²ä¸ä½ é—²èŠæ—¶ï¼Œè¯´èµ·ä¸€ä½è¿œæˆ¿è¡¨äº²çš„å©šäº‹ä¸é¡ºï¼Œè¨€è¯­é—´é¢‡ä¸ºæ„Ÿæ…¨ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸€åŒæ„Ÿæ…¨ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 5 }, attributes: { charm: 2 } });
                        showEventCard("æ„ŸåŒèº«å—", "fa-sad-tear", "ä½ ä¸æ¯äº²ä¸€åŒæ„Ÿæ…¨ä¸–äº‹æ— å¸¸ï¼Œä½ ä»¬çš„å…³ç³»æ›´è¿‘äº†ã€‚");
                    }},
                    { htmlContent: "ã€å‡ºè°‹åˆ’ç­–ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 8 }, attributes: { wisdom: 3 } });
                        showEventCard("è´¤å†…åŠ©", "fa-lightbulb", "ä½ ä¸ºè¡¨äº²çš„å©šäº‹å‡ºäº†äº›ä¸»æ„ï¼Œæ¯äº²å¤¸ä½ èªæ…§ã€‚");
                    }}
                ]
            };
        }
    },
    // å­å¥³äº’åŠ¨äº‹ä»¶
    child_education_progress: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 4 && c.age < 18),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 4 && c.age < 18));
            return {
                title: "å­å—£çš„å­¦ä¸š", icon: "fa-book-reader", description: `ä½ å­©å­çš„è€å¸ˆæ´¾äººä¼ è¯ï¼Œè¯´ <strong class="highlight-npc">${child.name}</strong> æœ€è¿‘åœ¨å­¦ä¸šä¸Šé‡åˆ°äº†ç“¶é¢ˆï¼Œå¸Œæœ›ä½ èƒ½å¤šåŠ å…³å¿ƒã€‚`,
                options: [
                    { htmlContent: "ã€äº²è‡ªè¾…å¯¼ã€‘", req: { wisdom: 60 }, callback: () => {
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 5;
                        child.favor = (child.favor || 50) + 10;
                        showEventCard("æ‚‰å¿ƒæ•™å¯¼", "fa-chalkboard-teacher", "åœ¨ä½ çš„å¸®åŠ©ä¸‹ï¼Œå­©å­å…‹æœäº†éš¾å…³ã€‚");
                    }},
                    { htmlContent: "ã€ä¸¥å‰æ–¥è´£ã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 10;
                        showEventCard("ä¸¥å‰çš„çˆ±", "fa-angry", "ä½ æ–¥è´£äº†å­©å­ï¼ŒTAçœ‹èµ·æ¥å¾ˆå§”å±ˆã€‚");
                    }},
                    { htmlContent: "ã€è¯·æ›´å¥½çš„è€å¸ˆã€‘", disabled: gs.finances.wealth < 1000, callback: () => {
                        applyEffects({ wealth: -1000 });
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 3;
                        showEventCard("é‡é‡‘æŠ•å…¥", "fa-money-check-alt", "ä½ èŠ±è´¹åƒé‡‘ä¸ºå­©å­è¯·äº†åå¸ˆã€‚");
                    }}
                ]
            };
        }
    },
    child_play_together: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 4),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 4));
            return {
                title: "äº²å­æ—¶å…‰", icon: "fa-puzzle-piece", description: `<strong class="highlight-npc">${child.name}</strong> æŠ±ç€ä¸€ä¸ªç©å…·ï¼Œçœ¼å·´å·´åœ°æœ›ç€ä½ ï¼Œå¸Œæœ›ä½ èƒ½é™ªTAç©ä¸€ä¼šå„¿ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶åŒæ„ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 15;
                        gs.player.health += 5;
                        showEventCard("å…¶ä¹èè", "fa-grin-hearts", "ä½ å’Œå­©å­åº¦è¿‡äº†ä¸€æ®µå¿«ä¹çš„æ—¶å…‰ï¼Œæ„Ÿè§‰èº«å¿ƒéƒ½æ”¾æ¾äº†ã€‚");
                    }},
                    { htmlContent: "ã€â€œä¸‹æ¬¡ä¸€å®šâ€ã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 5;
                        showEventCard("å¤±è½çš„çœ¼ç¥", "fa-sad-tear", "å­©å­å¤±æœ›åœ°èµ°å¼€äº†ã€‚");
                    }}
                ]
            };
        }
},
    child_peer_pressure: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 8 && c.age < 16),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 8 && c.age < 16));
            return {
                title: "é‚»å®¶çš„å­©å­", icon: "fa-user-friends", description: `ä½ æ”¶åˆ°ä¸€å°æ¥è‡ª <strong class="highlight-npc">${child.name}</strong> åŒçª—å®¶é•¿çš„ä¿¡ï¼Œä¿¡ä¸­ä¸ä¹ç‚«è€€ä¹‹è¯ï¼Œæš—ç¤ºTAçš„å­©å­åœ¨å„æ–¹é¢éƒ½æ›´èƒœä¸€ç­¹ã€‚`,
                options: [
                    { htmlContent: "ã€ä»¥æ­¤æ¿€åŠ±å­©å­ã€‘", callback: () => {
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 3;
                        child.favor = (child.favor || 50) - 5;
                        showEventCard("æœ›å­æˆé¾™", "fa-chart-line", `ä½ å°†æ­¤äº‹å‘ŠçŸ¥äº†${child.name}ï¼ŒTAæ„Ÿåˆ°äº†ä¸å°çš„å‹åŠ›ã€‚`);
                    }},
                    { htmlContent: "ã€å®‰æ…°å­©å­ï¼Œä¸å¿…ç†ä¼šã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 10;
                        applyEffects({ attributes: { virtue: 2 } });
                        showEventCard("æ…ˆæ¯ä¹‹å¿ƒ", "fa-heart", `ä½ å®‰æ…°${child.name}ä¸å¿…ä¸äººæ”€æ¯”ï¼Œåšæœ€å¥½çš„è‡ªå·±å³å¯ã€‚äº²å­å…³ç³»æ›´åŠ èæ´½ã€‚`);
                    }},
                    { htmlContent: "ã€å†™ä¸€å°æ›´â€œå‡¡å°”èµ›â€çš„ä¿¡ã€‘", callback: () => {
                        applyEffects({ attributes: { charm: 2, virtue: -2 } });
                        showEventCard("ä¸åŠ¨å£°è‰²", "fa-pen-fancy", `ä½ å›äº†ä¸€å°ä¿¡ï¼Œçœ‹ä¼¼è°¦è™šï¼Œå®åˆ™å°†è‡ªå®¶å­©å­çš„ä¼˜ç‚¹å¤¸ä¸Šäº†å¤©ï¼ŒæˆåŠŸåœ°æ‰³å›ä¸€åŸã€‚`);
                    }}
                ]
            };
        }
    },
    child_exam_success: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 7),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 7));
            return {
                title: "å­¦ä¸šæœ‰æˆ", icon: "fa-award", description: `å…ˆç”Ÿæ¥ä¿¡ï¼Œç§°èµ <strong class="highlight-npc">${child.name}</strong> åœ¨è¿‘æ¥çš„è€ƒè¾ƒä¸­ååˆ—å‰èŒ…ï¼Œæ˜¯å¯é€ ä¹‹æï¼`,
                options: [
                    { htmlContent: "ã€å…¬å¼€è¡¨æ‰¬ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 8;
                        child.attributes.reputation = (child.attributes.reputation || 0) + 5;
                        showEventCard("å®¶æ—ä¹‹å…‰", "fa-bullhorn", `ä½ å½“ä¼—è¡¨æ‰¬äº†${child.name}ï¼ŒTAçš„è‡ªä¿¡å¿ƒå¤§å¢ã€‚`);
                    }},
                    { htmlContent: "ã€ç‰©è´¨å¥–åŠ±ã€‘(-200ä¸¤)", disabled: gs.finances.wealth < 200, callback: () => {
                        applyEffects({ wealth: -200 });
                        child.favor = (child.favor || 50) + 12;
                        showEventCard("æŠ•å…¶æ‰€å¥½", "fa-gift", `ä½ ä¸º${child.name}ä¹°æ¥äº†TAå¿ƒä»ªå·²ä¹…çš„ç¤¼ç‰©ï¼ŒTAé«˜å…´æäº†ã€‚`);
                    }},
                    { htmlContent: "ã€å‘Šè¯«å…¶æˆ’éª„æˆ’èºã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 3;
                        showEventCard("è°†è°†æ•™è¯²", "fa-book", `ä½ å‘Šè¯«${child.name}è¦ç»§ç»­åŠªåŠ›ï¼ŒTAè™šå¿ƒå—æ•™ã€‚`);
                    }}
                ]
            };
        }
    },
    child_is_bullying: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 6 && c.age < 14),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 6 && c.age < 14));
            return {
                title: "å­¦å ‚éœ¸ç‹", icon: "fa-fist-raised", description: `å…ˆç”Ÿæ´¾äººå‰æ¥å‘ŠçŠ¶ï¼Œè¯´ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> åœ¨å­¦å ‚é‡Œä»—ç€å®¶ä¸–æ¬ºè´ŸåŒå­¦ï¼Œè¡Œå¾„æ¶åŠ£ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸¥åŠ ç®¡æ•™ï¼Œç½šå…¶ç¦è¶³ã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 5;
                        child.favor = (child.favor || 50) - 8;
                        showEventCard("ä¸¥çˆ¶ä¸¥æ¯", "fa-gavel", `ä½ ä¸¥å‰åœ°æƒ©ç½šäº†${child.name}ï¼Œå¸Œæœ›èƒ½å°†å…¶å¯¼å›æ­£é€”ã€‚`);
                    }},
                    { htmlContent: "ã€è®¤ä¸ºæ˜¯å°å­©å­æ‰“é—¹ã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) - 8;
                        applyEffects({ reputation: -5 });
                        showEventCard("æººçˆ±çºµå®¹", "fa-baby", `ä½ çš„ä¸ä»¥ä¸ºç„¶åŠ©é•¿äº†${child.name}çš„åš£å¼ æ°”ç„°ï¼Œå®¶æ—å£°èª‰ä¹Ÿå› æ­¤å—æŸã€‚`);
                    }},
                    { htmlContent: "ã€äº²è‡ªå¸¦å…¶ç™»é—¨é“æ­‰ã€‘", disabled: gs.finances.wealth < 100, callback: () => {
                        applyEffects({ wealth: -100 });
                        child.attributes.virtue = (child.attributes.virtue || 0) + 8;
                        child.favor = (child.favor || 50) + 5;
                        showEventCard("è¨€ä¼ èº«æ•™", "fa-hands-helping", `ä½ å¸¦ç€${child.name}ç™»é—¨é“æ­‰å¹¶èµ”å¿ï¼Œè®©TAæ˜ç™½äº†æ‹…å½“çš„æ„ä¹‰ã€‚`);
                    }}
                ]
            };
        }
    },
    child_artistic_talent: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 9),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 9));
            return {
                title: "å¤©èµ‹åˆæ˜¾", icon: "fa-paint-brush", description: `ä½ å‘ç° <strong class="highlight-npc">${child.name}</strong> è¿‘æ¥æ²‰è¿·äºä¹¦ç”»ï¼Œè™½æ— äººæ•™å¯¼ï¼Œç”»å‡ºçš„å±±æ°´å´é¢‡æœ‰å‡ åˆ†æ„å¢ƒã€‚`,
                options: [
                    { htmlContent: "ã€æ–¥å…¶ä¸åŠ¡æ­£ä¸šã€‘", callback: () => {
                        child.attributes.talent = (child.attributes.talent || 0) - 5;
                        child.favor = (child.favor || 50) - 10;
                        showEventCard("æ‰¼æ€å¤©æ€§", "fa-times-circle", `ä½ çš„æ–¥è´£è®©${child.name}å¾ˆä¼¤å¿ƒï¼ŒTAå¯èƒ½ä¼šå°±æ­¤æ”¾å¼ƒè¿™ä¸ªçˆ±å¥½ã€‚`);
                    }},
                    { htmlContent: "ã€ä¸ºTAè¯·ä½åå¸ˆã€‘(-1500ä¸¤)", disabled: gs.finances.wealth < 1500, callback: () => {
                        applyEffects({ wealth: -1500 });
                        child.attributes.talent = (child.attributes.talent || 0) + 15;
                        showEventCard("å› ææ–½æ•™", "fa-award", `åœ¨åå¸ˆçš„æŒ‡ç‚¹ä¸‹ï¼Œ${child.name}çš„æ‰æƒ…çªé£çŒ›è¿›ï¼`);
                    }},
                    { htmlContent: "ã€å£å¤´é¼“åŠ±ï¼Œé¡ºå…¶è‡ªç„¶ã€‘", callback: () => {
                        child.attributes.talent = (child.attributes.talent || 0) + 5;
                        showEventCard("é™å¾…èŠ±å¼€", "fa-seedling", `ä½ çš„é¼“åŠ±è®©${child.name}å¾ˆé«˜å…´ï¼ŒTAç»§ç»­ä¾é è‡ªå·±çš„å…´è¶£å‘å±•ã€‚`);
                    }}
                ]
            };
        }
    },
    child_skipping_class: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 10 && c.age < 17),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 10 && c.age < 17));
            return {
                title: "é€ƒå­¦é£æ³¢", icon: "fa-running", description: `ä½ å¶ç„¶åœ¨å¸‚é›†æ’è§æœ¬åº”åœ¨å­¦å ‚çš„ <strong class="highlight-npc">${child.name}</strong> æ­£åœ¨æ–—è›è›ï¼`,
                options: [
                    { htmlContent: "ã€å½“åœºæŠ“åŒ…ï¼Œä¸¥å‰è®­æ–¥ã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 12;
                        child.attributes.etiquette = (child.attributes.etiquette || 0) + 3;
                        showEventCard("æ— åœ°è‡ªå®¹", "fa-angry", `ä½ å½“ä¼—è®­æ–¥äº†${child.name}ï¼ŒTAæ„Ÿåˆ°æ— åœ°è‡ªå®¹ã€‚`);
                    }},
                    { htmlContent: "ã€ä¸åŠ¨å£°è‰²ï¼Œå›å®¶å†è®®ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 2 } });
                        showEventCard("æš—ä¸­è§‚å¯Ÿ", "fa-eye", `ä½ å†³å®šå…ˆä¸æ­ç©¿ï¼Œçœ‹çœ‹TAåˆ°åº•æƒ³åšä»€ä¹ˆã€‚`);
                    }},
                    { htmlContent: "ã€ä¸€èµ·åŠ å…¥ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 15;
                        child.attributes.virtue = (child.attributes.virtue || 0) - 5;
                        showEventCard("â€œåŒé“ä¸­äººâ€", "fa-hand-peace", `ä½ çš„åŠ å…¥è®©${child.name}å¤§åƒä¸€æƒŠï¼Œä½ ä»¬çš„å…³ç³»å˜å¾—åƒæœ‹å‹ä¸€æ ·ï¼Œä½†ä¹Ÿå¸¦åäº†å¤´ã€‚`);
                    }}
                ]
            };
        }
    },
    child_influential_friend: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 12),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 12));
            return {
                title: "ç»“äº¤è´µå‹", icon: "fa-user-tie", description: `ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> è¿‘æ—¥ä¸å®‰å›½å…¬åºœçš„å°ä¸–å­/å°éƒ¡ä¸»æˆäº†å¥½å‹ï¼Œå¯¹æ–¹é‚€è¯·TAè¿‡åºœä¸€å™ã€‚`,
                options: [
                    { htmlContent: "ã€å¤‡ä¸Šåšç¤¼ï¼Œæ¬£ç„¶åº”å…ã€‘", disabled: gs.finances.wealth < 300, callback: () => {
                        applyEffects({ wealth: -300, reputation: 5 });
                        child.attributes.charm = (child.attributes.charm || 0) + 5;
                        showEventCard("é«˜é—¨ä¹‹è°Š", "fa-handshake", `${child.name}åœ¨æƒè´µåœˆä¸­æ‰“å¼€äº†ç¤¾äº¤ï¼Œå®¶æ—å£°æœ›ä¹Ÿå› æ­¤å—ç›Šã€‚`);
                    }},
                    { htmlContent: "ã€å‘Šè¯«å…¶ä¸å¯æ”€é™„æƒè´µã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 4;
                        showEventCard("ä¿æŒæœ¬å¿ƒ", "fa-anchor", `ä½ å‘Šè¯«${child.name}è¦ä¿æŒå¹³å¸¸å¿ƒï¼ŒTAè‹¥æœ‰æ‰€æ€ã€‚`);
                    }},
                    { htmlContent: "ã€æ‹…å¿ƒå…¶è¢«å¸¦åï¼Œå©‰æ‹’é‚€çº¦ã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 5;
                        showEventCard("é”™å¤±è‰¯æœº", "fa-door-closed", `ä½ çš„æ‹’ç»è®©${child.name}æœ‰äº›ä¸è§£ï¼Œä¹Ÿé”™å¤±äº†æ‹“å±•äººè„‰çš„æœºä¼šã€‚`);
                    }}
                ]
            };
        }
    },
    child_cheating_accusation: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 10),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 10));
            return {
                title: "ä½œå¼Šç–‘äº‘", icon: "fa-question-circle", description: `<strong class="highlight-npc">${child.name}</strong> åœ¨ä¸€æ¬¡é‡è¦æµ‹éªŒåï¼Œè¢«åŒçª—ä¸¾æŠ¥å¤¹å¸¦å°æŠ„ä½œå¼Šï¼Œå…ˆç”Ÿè¯·ä½ è¿‡åºœä¸€è¶Ÿã€‚`,
                options: [
                    { htmlContent: "ã€ç›¸ä¿¡å­©å­ï¼Œæ®ç†åŠ›äº‰ã€‘", callback: () => {
                        if (Math.random() < (child.attributes.virtue / 100)) {
                            child.favor += 15;
                            showEventCard("æ²‰å†¤å¾—é›ª", "fa-check-circle", `äº‹å®è¯æ˜æ˜¯åŒçª—å«‰å¦’è€Œè¯¬å‘Šï¼Œä½ çš„ä¿¡ä»»è®©${child.name}æ— æ¯”æ„ŸåŠ¨ã€‚`);
                        } else {
                            child.favor -= 10;
                            showEventCard("è¯æ®ç¡®å‡¿", "fa-gavel", `å…ˆç”Ÿæ‹¿å‡ºäº†è¯æ®ï¼Œä½ æ„Ÿåˆ°é¢œé¢å°½å¤±ã€‚`);
                        }
                    }},
                    { htmlContent: "ã€ä¸é—®ç¼˜ç”±ï¼Œå…ˆè´£ç½šã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 15;
                        showEventCard("ä¸åˆ†é’çº¢çš‚ç™½", "fa-angry", `ä½ çš„ä¸ä¿¡ä»»æ·±æ·±ä¼¤å®³äº†${child.name}ã€‚`);
                    }}
                ]
            };
        }
    },
    child_school_trip: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 11),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 11));
            return {
                title: "è¯·æ±‚å‡ºæ¸¸", icon: "fa-map-signs", description: `ä¹¦é™¢è¦ç»„ç»‡ä¸€æ¬¡ä¸ºæœŸä¸‰æ—¥çš„éƒŠå¤–æ¸¸å­¦ï¼Œ<strong class="highlight-npc">${child.name}</strong> å¸Œæœ›èƒ½å‚åŠ ï¼Œéœ€è¦ç¼´çº³500ä¸¤è´¹ç”¨ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶åŒæ„ã€‘", disabled: gs.finances.wealth < 500, callback: () => {
                        applyEffects({ wealth: -500 });
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 4;
                        child.attributes.health = (child.attributes.health || 0) + 4;
                        showEventCard("è¯»ä¸‡å·ä¹¦è¡Œä¸‡é‡Œè·¯", "fa-hiking", `${child.name}åœ¨æ¸¸å­¦ä¸­å¢é•¿äº†è§é—»ï¼Œå¼€é˜”äº†çœ¼ç•Œã€‚`);
                    }},
                    { htmlContent: "ã€ä»¥å­¦ä¸šä¸ºé‡ï¼Œæ‹’ç»ã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 6;
                        showEventCard("å¤±æœ›", "fa-sad-tear", `${child.name}å¯¹ä½ çš„å†³å®šæ„Ÿåˆ°éå¸¸å¤±æœ›ã€‚`);
                    }}
                ]
            };
        }
    },
    child_losing_book: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 7),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 7));
            return {
                title: "ä¸¢å¤±çš„ä¹¦æœ¬", icon: "fa-book-dead", description: `<strong class="highlight-npc">${child.name}</strong> å“­ç€å‘Šè¯‰ä½ ï¼ŒTAä¸å°å¿ƒæŠŠä¸€æœ¬æ˜‚è´µçš„è¯¾æœ¬å¼„ä¸¢äº†ã€‚`,
                options: [
                    { htmlContent: "ã€å®‰æ…°TAå¹¶ä¹°ä¸€æœ¬æ–°çš„ã€‘(-150ä¸¤)", disabled: gs.finances.wealth < 150, callback: () => {
                        applyEffects({ wealth: -150 });
                        child.favor = (child.favor || 50) + 5;
                        showEventCard("æ…ˆçˆ±", "fa-hand-holding-heart", `ä½ æ²¡æœ‰è´£å¤‡${child.name}ï¼ŒTAæ¾äº†ä¸€å£æ°”ã€‚`);
                    }},
                    { htmlContent: "ã€è®©TAç”¨é›¶èŠ±é’±è‡ªå·±ä¹°ã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 2;
                        showEventCard("æ‰¿æ‹…è´£ä»»", "fa-piggy-bank", `ä½ è®©${child.name}è‡ªå·±æ‰¿æ‹…åæœï¼ŒTAå­¦ä¼šäº†è¦çˆ±æƒœç‰©å“ã€‚`);
                    }}
                ]
            };
        }
    },
    child_helping_classmate: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 8),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 8));
            return {
                title: "åŒçª—ä¹‹è°Š", icon: "fa-users", description: `å…ˆç”Ÿå¤¸å¥– <strong class="highlight-npc">${child.name}</strong>ï¼Œè¯´TAç»å¸¸ç‰ºç‰²è‡ªå·±çš„æ—¶é—´ï¼Œå¸®åŠ©ä¸€ä½åŠŸè¯¾è·Ÿä¸ä¸Šçš„åŒçª—ã€‚`,
                options: [
                    { htmlContent: "ã€èµæ‰¬TAçš„å–„è¡Œã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 5;
                        child.favor = (child.favor || 50) + 5;
                        showEventCard("ä¹äºåŠ©äºº", "fa-award", `ä½ çš„èµæ‰¬è®©${child.name}æ˜ç™½äº†åŠ©äººä¸ºä¹çš„é“ç†ã€‚`);
                    }},
                    { htmlContent: "ã€æé†’TAåˆ«è€½è¯¯è‡ªå·±ã€‘", callback: () => {
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 2;
                        showEventCard("æƒè¡¡åˆ©å¼Š", "fa-balance-scale", `ä½ æé†’${child.name}è¦å…ˆä¿è¯è‡ªå·±çš„å­¦ä¸šï¼ŒTAç‚¹äº†ç‚¹å¤´ã€‚`);
                    }}
                ]
            };
        }
    },
    child_argument_with_teacher: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 12),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 12));
            return {
                title: "é¡¶æ’å¸ˆé•¿", icon: "fa-chalkboard-teacher", description: `<strong class="highlight-npc">${child.name}</strong> åœ¨è¯¾å ‚ä¸Šå°±ä¸€ä¸ªå…¸æ•…çš„å‡ºå¤„ä¸å…ˆç”Ÿå‘ç”Ÿäº†äº‰æ‰§ï¼Œå…ˆç”Ÿè®¤ä¸ºTAç‹‚å¦„è‡ªå¤§ã€‚`,
                options: [
                    { htmlContent: "ã€æ”¯æŒå­©å­ï¼Œæ¢ç©¶çœŸç›¸ã€‘", callback: () => {
                        if (Math.random() < (child.attributes.wisdom / 100)) {
                            child.attributes.wisdom += 5;
                            showEventCard("çœŸç†è¶Šè¾©è¶Šæ˜", "fa-lightbulb", `ä½ å’Œ${child.name}æŸ¥é˜…å…¸ç±åå‘ç°ï¼Œç«Ÿæ˜¯å…ˆç”Ÿè®°é”™äº†ï¼TAçš„è‡ªä¿¡å¿ƒå¤§å¢ã€‚`);
                        } else {
                            child.attributes.etiquette -= 5;
                            showEventCard("å­¦è‰ºä¸ç²¾", "fa-face-frown", `äº‹å®è¯æ˜æ˜¯${child.name}è®°é”™äº†ï¼Œä½ åªå¾—å¸¦TAå‘å…ˆç”Ÿé“æ­‰ã€‚`);
                        }
                    }},
                    { htmlContent: "ã€è¦æ±‚å­©å­å‘å…ˆç”Ÿé“æ­‰ã€‘", callback: () => {
                        child.attributes.etiquette = (child.attributes.etiquette || 0) + 4;
                        child.favor = (child.favor || 50) - 5;
                        showEventCard("å°Šå¸ˆé‡é“", "fa-hands-helping", `ä½ æ•™å¯¼${child.name}è¦å°Šå¸ˆé‡é“ï¼ŒTAè™½ä¸æƒ…æ„¿ï¼Œä½†è¿˜æ˜¯é“äº†æ­‰ã€‚`);
                    }}
                ]
            };
        }
    },
    child_school_injury: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 6),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 6));
            return {
                title: "æ„å¤–å—ä¼¤", icon: "fa-user-injured", description: `<strong class="highlight-npc">${child.name}</strong> åœ¨å­¦å ‚çš„è¹´é æ´»åŠ¨ä¸­ä¸æ…æ‘”ä¼¤äº†è…¿ï¼Œéœ€è¦ä¼‘å…»ä¸€æ®µæ—¶é—´ã€‚`,
                options: [
                    { htmlContent: "ã€æ‚‰å¿ƒç…§æ–™ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 15;
                        child.attributes.health = (child.attributes.health || 0) + 5;
                        showEventCard("å…³æ€€å¤‡è‡³", "fa-heart", `åœ¨ä½ çš„æ‚‰å¿ƒç…§æ–™ä¸‹ï¼Œ${child.name}å¾ˆå¿«åº·å¤äº†ï¼Œå¹¶æ„Ÿå—åˆ°äº†æµ“æµ“çš„äº²æƒ…ã€‚`);
                    }},
                    { htmlContent: "ã€è®©TAå¸å–æ•™è®­ã€‘", callback: () => {
                        child.attributes.martial = (child.attributes.martial || 0) + 2;
                        showEventCard("åƒä¸€å ‘é•¿ä¸€æ™º", "fa-band-aid", `${child.name}åœ¨å…»ä¼¤æœŸé—´åæ€äº†è‡ªå·±é²è½çš„è¡Œä¸ºã€‚`);
                    }}
                ]
            };
        }
    },
    child_disinterest_studies: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 9),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 9));
            return {
                title: "åŒå­¦æƒ…ç»ª", icon: "fa-book-skull", description: `<strong class="highlight-npc">${child.name}</strong> å‘ä½ æŠ±æ€¨ï¼Œè¯´æ¯æ—¥è¯»åœ£è´¤ä¹¦å®åœ¨æ¯ç‡¥ä¹å‘³ï¼Œæä¸èµ·å…´è¶£ã€‚`,
                options: [
                    { htmlContent: "ã€å¸¦TAå»ä½“éªŒæ°‘é—´ç–¾è‹¦ã€‘", callback: () => {
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 5;
                        child.attributes.virtue = (child.attributes.virtue || 0) + 3;
                        showEventCard("äººé—´æ¸…é†’", "fa-seedling", `è§è¯†äº†æ°‘é—´ç–¾è‹¦åï¼Œ${child.name}æ˜ç™½äº†è¯»ä¹¦çš„æ„ä¹‰ï¼Œå­¦ä¹ æ€åº¦ç«¯æ­£äº†è®¸å¤šã€‚`);
                    }},
                    { htmlContent: "ã€å‡å°‘å­¦ä¸šï¼Œå¢åŠ ç©ä¹ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 8;
                        child.attributes.wisdom = (child.attributes.wisdom || 0) - 4;
                        showEventCard("åŠ³é€¸ç»“åˆ", "fa-gamepad", `ä½ ä¸º${child.name}å‡å°‘äº†è¯¾ä¸šï¼ŒTAå¾ˆå¼€å¿ƒï¼Œä½†å­¦ä¸šæœ‰æ‰€é€€æ­¥ã€‚`);
                    }}
                ]
            };
        }
    },
    child_request_pet: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 5 && c.age < 12),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 5 && c.age < 12));
            return {
                title: "è¯·æ±‚å…»å® ", icon: "fa-cat", description: `<strong class="highlight-npc">${child.name}</strong> æƒ³è¦å…»ä¸€åªé»„è‰²å‚è€³å°å…”å­ï¼Œå¹¶ä¿è¯ä¼šäº²è‡ªç…§æ–™ã€‚`,
                options: [
                    { htmlContent: "ã€åŒæ„ã€‘", disabled: gs.finances.wealth < 50, callback: () => {
                        applyEffects({ wealth: -50 });
                        child.attributes.virtue = (child.attributes.virtue || 0) + 2;
                        child.favor = (child.favor || 50) + 5;
                        showEventCard("æ–°çš„å®¶åº­æˆå‘˜", "fa-paw", `${child.name}å¯¹æ–°æ¥çš„å°å®¶ä¼™çˆ±ä¸é‡Šæ‰‹ï¼Œå…´å¥‹åœ°æŠŠå°å…”å­å–åå«é¥¼é¥¼ï¼ŒTAå­¦ä¼šäº†è´£ä»»ä¸çˆ±å¿ƒã€‚`);
                    }},
                    { htmlContent: "ã€æ‹’ç»ã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 4;
                        showEventCard("å¤±æœ›", "fa-sad-cry", `ä½ æ‹’ç»äº†${child.name}çš„è¯·æ±‚ï¼ŒTAæœ‰äº›é—·é—·ä¸ä¹ã€‚`);
                    }}
                ]
            };
        }
    },
    child_unfair_treatment: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 8),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 8));
            return {
                title: "ä¸å…¬çš„å¯¹å¾…", icon: "fa-balance-scale-left", description: `<strong class="highlight-npc">${child.name}</strong> å§”å±ˆåœ°å‘Šè¯‰ä½ ï¼Œå…ˆç”Ÿä¼¼ä¹æ€»æ˜¯åè¢’å¦ä¸€ä½å®¶ä¸–æ˜¾èµ«çš„åŒçª—ï¼Œå¯¹ä»–ååˆ†ä¸¥è‹›ã€‚`,
                options: [
                    { htmlContent: "ã€æ•™TAå¿è€å’Œå¼ºå¤§è‡ªèº«ã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 4;
                        showEventCard("å§è–ªå°èƒ†", "fa-book-reader", `ä½ æ•™å¯¼${child.name}ï¼Œå”¯æœ‰è‡ªèº«å¼ºå¤§æ‰æ˜¯æ ¹æœ¬ã€‚TAå°†å§”å±ˆåŒ–ä½œäº†å­¦ä¹ çš„åŠ¨åŠ›ã€‚`);
                    }},
                    { htmlContent: "ã€äº²è‡ªæ‹œè®¿å…ˆç”Ÿã€‘(-300ä¸¤)", disabled: gs.finances.wealth < 300, callback: () => {
                        applyEffects({ wealth: -300 });
                        showEventCard("æ‰“ç‚¹å…³ç³»", "fa-gift", `ä½ â€œæ‹œè®¿â€äº†å…ˆç”Ÿåï¼Œ${child.name}åœ¨å­¦å ‚çš„å¤„å¢ƒæœç„¶å¥½äº†å¾ˆå¤šã€‚`);
                    }}
                ]
            };
        }
    },
    child_found_money: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 6),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 6));
            return {
                title: "æ„å¤–ä¹‹è´¢", icon: "fa-money-bill-wave", description: `<strong class="highlight-npc">${child.name}</strong> åœ¨ä¸Šå­¦çš„è·¯ä¸Šæ¡åˆ°äº†ä¸€ä¸ªé’±è¢‹ï¼Œé‡Œé¢æœ‰100ä¸¤é“¶å­ã€‚`,
                options: [
                    { htmlContent: "ã€æ•™TAä¸Šäº¤å®˜åºœã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 6;
                        applyEffects({ reputation: 2 });
                        showEventCard("æ‹¾é‡‘ä¸æ˜§", "fa-award", `${child.name}çš„è¡Œä¸ºå¾—åˆ°äº†å®˜åºœçš„è¡¨æ‰¬ã€‚`);
                    }},
                    { htmlContent: "ã€è®©TAè‡ªå·±æ”¶ä¸‹ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 5;
                        child.attributes.virtue = (child.attributes.virtue || 0) - 4;
                        showEventCard("æ„å¤–ä¹‹å–œ", "fa-coins", `${child.name}ç”¨è¿™ç¬”é’±ç»™è‡ªå·±ä¹°äº†å¾ˆå¤šå¥½ä¸œè¥¿ã€‚`);
                    }}
                ]
            };
        }
    },
    child_bad_influence: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 13 && c.age < 18),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 13 && c.age < 18));
            return {
                title: "è¿‘å¢¨è€…é»‘", icon: "fa-user-ninja", description: `ä½ å‘ç° <strong class="highlight-npc">${child.name}</strong> æœ€è¿‘å’Œä¸€ç¾¤è¡—å¤´çš„æ··æ··èµ°å¾—å¾ˆè¿‘ï¼Œè¯´è¯ä¹Ÿå¼€å§‹æ²¹è…”æ»‘è°ƒã€‚`,
                options: [
                    { htmlContent: "ã€å¼ºè¡Œç¦æ­¢TAå†ä¸é‚£äº›äººæ¥å¾€ã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 8;
                        showEventCard("å¼ºåˆ¶éš”ç¦»", "fa-house-user", `ä½ çš„å¼ºç¡¬æ€åº¦å¼•èµ·äº†${child.name}çš„é€†åå¿ƒç†ã€‚`);
                    }},
                    { htmlContent: "ã€ä¸TAä¿ƒè†é•¿è°ˆã€‘", callback: () => {
                        if (Math.random() < (gs.player.attributes.charm / 100)) {
                            child.favor += 8;
                            child.attributes.virtue += 3;
                            showEventCard("è¿·é€”çŸ¥è¿”", "fa-check-circle", `ä½ çš„è€å¿ƒåŠè¯´è®©${child.name}æ„è¯†åˆ°äº†é”™è¯¯ã€‚`);
                        } else {
                            showEventCard("æ²Ÿé€šæ— æ•ˆ", "fa-times-circle", `${child.name}å¯¹ä½ çš„è¯å·¦è€³æœµè¿›å³è€³æœµå‡ºã€‚`);
                        }
                    }}
                ]
            };
        }
    },
    child_unrequited_love: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 14),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 14));
            return {
                title: "å°‘å¹´å¿ƒäº‹", icon: "fa-heart-broken", description: `ä½ å‘ç° <strong class="highlight-npc">${child.name}</strong> æš—æ‹ä¸€ä½åŒçª—ï¼Œä½†å¯¹æ–¹ä¼¼ä¹å¯¹ä»–/å¥¹å¹¶æ— æ„ï¼Œä¸ºæ­¤TAååˆ†è‹¦æ¼ã€‚`,
                options: [
                    { htmlContent: "ã€å®‰æ…°TAå¤©æ¶¯ä½•å¤„æ— èŠ³è‰ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 6;
                        child.attributes.charm = (child.attributes.charm || 0) + 2;
                        showEventCard("æˆé•¿çš„çƒ¦æ¼", "fa-comment-dots", `ä½ çš„å®‰æ…°è®©${child.name}å¥½å—äº†è®¸å¤šã€‚`);
                    }},
                    { htmlContent: "ã€é¼“åŠ±TAå¤§èƒ†è¿½æ±‚ã€‘", callback: () => {
                        child.attributes.charm = (child.attributes.charm || 0) + 4;
                        showEventCard("å‹‡äºå°è¯•", "fa-paper-plane", `åœ¨ä½ çš„é¼“åŠ±ä¸‹ï¼Œ${child.name}å†³å®šå‹‡æ•¢ä¸€æ¬¡ï¼Œæ— è®ºç»“æœå¦‚ä½•ã€‚`);
                    }}
                ]
            };
        }
    },
    child_financial_request: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 15),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 15));
            return {
                title: "ç”¨é’±ä¹‹é“", icon: "fa-hand-holding-usd", description: `<strong class="highlight-npc">${child.name}</strong> å‘ä½ ç´¢è¦ä¸€å¤§ç¬”é’±ï¼Œè¯´æ˜¯è¦å’Œæœ‹å‹åˆä¼™åšç”Ÿæ„ã€‚`,
                options: [
                    { htmlContent: "ã€ç»™äºˆæ”¯æŒã€‘(-2000ä¸¤)", disabled: gs.finances.wealth < 2000, callback: () => {
                        applyEffects({ wealth: -2000 });
                        if (Math.random() < (child.attributes.wisdom / 100)) {
                            child.attributes.wisdom += 10;
                            showEventCard("æŠ•èµ„æˆåŠŸ", "fa-chart-pie", `${child.name}çš„ç”Ÿæ„å¤§è·æˆåŠŸï¼Œå±•ç°äº†æƒŠäººçš„å•†ä¸šå¤´è„‘ï¼`);
                        } else {
                            showEventCard("æŠ•èµ„å¤±è´¥", "fa-sad-cry", `${child.name}çš„ç”Ÿæ„è¡€æœ¬æ— å½’ï¼Œä½†ä»–ä»ä¸­å¸å–äº†æ•™è®­ã€‚`);
                        }
                    }},
                    { htmlContent: "ã€è®¤ä¸ºTAä¸åŠ¡æ­£ä¸šã€‘", callback: () => {
                        child.favor = (child.favor || 50) - 7;
                        showEventCard("ä¿å®ˆçš„çˆ±", "fa-times", `ä½ æ‹’ç»äº†${child.name}çš„è¯·æ±‚ï¼Œè®¤ä¸ºTAåº”è¯¥ä¸“æ³¨äºå­¦ä¸šã€‚`);
                    }}
                ]
            };
        }
    },
    child_moral_choice_witness: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 12),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 12));
            return {
                title: "è‰°éš¾çš„æŠ‰æ‹©", icon: "fa-balance-scale", description: `<strong class="highlight-npc">${child.name}</strong> å‘Šè¯‰ä½ ï¼ŒTAæ— æ„ä¸­ç›®ç¹äº†ä¸€ä½åŒçª—å·çªƒäº†å¦ä¸€ä½å¯Œå®¶å­å¼Ÿçš„ç‰ä½©ã€‚`,
                options: [
                    { htmlContent: "ã€æ•™TAå‹‡æ•¢åœ°æ­å‘ã€‘", callback: () => {
                        child.attributes.virtue = (child.attributes.virtue || 0) + 6;
                        showEventCard("æ­£ä¹‰ä¹‹ä¸¾", "fa-gavel", `${child.name}æ­å‘äº†æ­¤äº‹ï¼Œè™½ç„¶å¯èƒ½å¾—ç½ªäººï¼Œä½†åšæŒäº†æ­£ä¹‰ã€‚`);
                    }},
                    { htmlContent: "ã€æ•™TAæ˜å“²ä¿èº«ã€‘", callback: () => {
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 4;
                        showEventCard("æƒè¡¡ä¹‹é“", "fa-user-shield", `ä½ æ•™å¯¼${child.name}ä¸è¦å·å…¥æ˜¯éï¼ŒTAå­¦ä¼šäº†å¦‚ä½•ä¿æŠ¤è‡ªå·±ã€‚`);
                    }}
                ]
            };
        }
    },
    child_fight: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 6),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 6));
            return {
                title: "å­©ç«¥çš„äº‰æ‰§", icon: "fa-fist-raised", description: `ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> ä¸é‚»å±…å®¶çš„å­©å­æ‰“æ¶äº†ï¼Œå¯¹æ–¹å®¶é•¿æ‰¾ä¸Šé—¨æ¥ã€‚`,
                options: [
                    { htmlContent: "ã€è¢’æŠ¤è‡ªå·±çš„å­©å­ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 10;
                        applyEffects({attributes: {virtue: -5}});
                        showEventCard("æŠ¤çŠŠæƒ…æ·±", "fa-shield-alt", "ä½ è¢’æŠ¤äº†å­©å­ï¼ŒTAè§‰å¾—ä½ å¾ˆä¼Ÿå¤§ã€‚");
                    }},
                    { htmlContent: "ã€èµ”ç¤¼é“æ­‰ã€‘", callback: () => {
                        applyEffects({wealth: -50, attributes: {virtue: 5}});
                        showEventCard("æ¯äº‹å®äºº", "fa-handshake", "ä½ èµ”å¿äº†å¯¹æ–¹ï¼Œå¹³æ¯äº†äº‹ç«¯ã€‚");
                    }},
                    { htmlContent: "ã€è®©å­©å­ä»¬è‡ªå·±è§£å†³ã€‘", callback: () => {
                        child.attributes.wisdom = (child.attributes.wisdom || 0) + 2;
                        showEventCard("é”»ç‚¼æˆé•¿", "fa-child", "ä½ è®©å­©å­è‡ªå·±é¢å¯¹ï¼Œè¿™å¯¹ä»–ä¹Ÿæ˜¯ä¸€ç§é”»ç‚¼ã€‚");
                    }}
                ]
            };
        }
    },
    child_illness: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead));
            return {
                title: "å­å—£æŠ±æ™", icon: "fa-thermometer", description: `ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> çªç„¶å‘èµ·é«˜çƒ§ï¼Œçœ‹èµ·æ¥å¾ˆéš¾å—ã€‚`,
                options: [
                    { htmlContent: "ã€äº²è‡ªç…§æ–™ã€‘", callback: () => {
                        child.favor += 20;
                        child.attributes.health += 10;
                        gs.player.health -= 5;
                        showEventCard("æ‚‰å¿ƒç…§æ–™", "fa-bed", "åœ¨ä½ çš„æ‚‰å¿ƒç…§æ–™ä¸‹ï¼Œå­©å­å¾ˆå¿«åº·å¤äº†ï¼Œä½†ä½ ä¹Ÿç´¯åäº†ã€‚");
                    }},
                    { htmlContent: "ã€è¯·ååŒ»ã€‘", disabled: gs.finances.wealth < 300, callback: () => {
                        applyEffects({ wealth: -300 });
                        child.attributes.health += 15;
                        showEventCard("è¯åˆ°ç—…é™¤", "fa-pills", "ä½ è¯·æ¥çš„ååŒ»å¾ˆå¿«æ²»å¥½äº†å­©å­ã€‚");
                    }}
                ]
            };
        }
    },
    child_found_item: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 8),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 8));
            return {
                title: "æ„å¤–çš„å‘ç°", icon: "fa-gem", description: `ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> åœ¨åé™¢ç©è€æ—¶ï¼ŒæŒ–å‡ºäº†ä¸€ä»¶çœ‹èµ·æ¥å¾ˆå€¼é’±çš„æ—§ç‰©ï¼Œå…´å†²å†²åœ°æ‹¿ç»™ä½ çœ‹ã€‚`,
                options: [
                    { htmlContent: "ã€æ”¶ä¸‹å¹¶è¡¨æ‰¬ã€‘", callback: () => {
                        applyEffects({ wealth: getRandomInt(100, 500) });
                        child.favor += 10;
                        showEventCard("æ„å¤–ä¹‹è´¢", "fa-coins", "ä½ æ”¶ä¸‹äº†è¿™ä»¶æ—§ç‰©ï¼Œå‘ç°ç«Ÿå€¼ä¸å°‘é’±ï¼Œå¹¶è¡¨æ‰¬äº†å­©å­ã€‚");
                    }},
                    { htmlContent: "ã€ç‰©å½’åŸä¸»ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 10 } });
                        child.attributes.virtue += 5;
                        showEventCard("æ‹¾é‡‘ä¸æ˜§", "fa-hand-holding-heart", "ä½ æ•™å¯¼å­©å­è¦æ‹¾é‡‘ä¸æ˜§ï¼Œå¹¶ä¸€åŒæ‰¾åˆ°äº†å¤±ä¸»ã€‚");
                    }}
                ]
            };
        }
},

    // æƒ…äººäº’åŠ¨äº‹ä»¶
    lover_secret_gift: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "ç§˜å¯†èµ ç¤¼", icon: "fa-gift", description: `ä½ çš„æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> æ‰˜äººç»™ä½ é€æ¥ä¸€ä»¶ç¤¼ç‰©ï¼Œå¹¶é™„ä¸Šä¸€å¼ çº¸æ¡ï¼šâ€œè§ç‰©å¦‚é¢â€ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶æ”¶ä¸‹ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 10 } });
                        if(Math.random() < 0.5) applyEffects({wealth: 200});
                        showEventCard("å¿ƒæœ‰çµçŠ€", "fa-heart", "ä¸€ä»½è´´å¿ƒçš„ç¤¼ç‰©è®©ä½ ä»¬çš„æƒ…æ„Ÿå‡æ¸©ã€‚");
                    }},
                    { htmlContent: "ã€æ‚„æ‚„é€€å›ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -5 } });
                        showEventCard("ä¿æŒè·ç¦»", "fa-hand-paper", "ä½ è®¤ä¸ºè¿‡äºé¢‘ç¹çš„ç¤¼ç‰©äº¤æ¢ä¼šå¢åŠ æš´éœ²çš„é£é™©ã€‚");
                    }}
                ]
            };
        }
},

    lover_festival_encounter: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "ç¯ä¼šçš„å¶é‡", icon: "fa-candy-cane", description: `å…ƒå®µç¯ä¼šï¼Œäººæ½®æ±¹æ¶Œã€‚ä½ æ— æ„é—´ä¸€ç¥ï¼Œç«Ÿåœ¨ä¸è¿œå¤„çœ‹åˆ°äº†ä½ çš„æƒ…äºº <strong class="highlight-npc">${lover.name}</strong>ã€‚TAä¹Ÿçœ‹åˆ°äº†ä½ ï¼Œçœ¼ä¸­é—ªè¿‡ä¸€ä¸æƒŠå–œã€‚`,
                options: [
                    { htmlContent: "ã€ç‚¹å¤´ç¤ºæ„ï¼Œæ“¦è‚©è€Œè¿‡ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 2 } });
                        showEventCard("å¿ƒç…§ä¸å®£", "fa-eye", "ä½ ä»¬äº¤æ¢äº†ä¸€ä¸ªåªæœ‰å½¼æ­¤æ‰æ‡‚çš„çœ¼ç¥ï¼Œéšåä¾¿èå…¥äººæµ·ã€‚");
                    }},
                    { htmlContent: "ã€å¯»æœºçŸ­æš‚äº¤è°ˆã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 8 } });
                        if (gs.marriage.isMarried && Math.random() < 0.1) {
                            const spouse = gs.npcs[gs.marriage.spouseId];
                            spouse.suspicionValue = (spouse.suspicionValue || 0) + 10;
                            showEventCard("æƒŠé™©", "fa-exclamation-triangle", `ä½ ä»¬çš„çŸ­æš‚äº¤è°ˆä¼¼ä¹è¢«ç†Ÿäººçœ‹åˆ°ï¼Œä½ é…å¶çš„ç–‘å¿ƒå¢åŠ äº†ã€‚`);
                        } else {
                            showEventCard("ç‰‡åˆ»æ¸©å­˜", "fa-comments", "ä½ ä»¬åœ¨ç¯å½±ä¸‹çŸ­æš‚äº¤è°ˆäº†å‡ å¥ï¼Œè™½æ˜¯ç‰‡åˆ»ï¼Œä¹Ÿå€æ„Ÿç”œèœœã€‚");
                        }
                    }}
                ]
            };
        }
    },
    lover_close_call: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0 && gs.marriage.isMarried,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "æƒŠé™©ä¸€åˆ»", icon: "fa-user-secret", description: `ä½ ä¸æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> åœ¨èŒ¶æ¥¼ç§ä¼šæ—¶ï¼Œä½™å…‰ç«Ÿç¥è§ä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> æ­£è¦ä¸Šæ¥¼ï¼`,
                options: [
                    { htmlContent: "ã€æ‹‰ç€TAä»åé—¨æºœèµ°ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 5 } });
                        showEventCard("æœ‰æƒŠæ— é™©", "fa-running", "ä½ ä»¬ç‹¼ç‹ˆåœ°ä»åé—¨æºœèµ°ï¼Œè™½ç„¶æƒŠé™©ï¼Œå´ä¹Ÿåˆºæ¿€ã€‚");
                    }},
                    { htmlContent: "ã€è®©TAå…ˆèº²èµ·æ¥ã€‘", req: { wisdom: 60 }, callback: () => {
                        spouse.suspicionValue = (spouse.suspicionValue || 0) - 5;
                        showEventCard("åº”å¯¹è‡ªå¦‚", "fa-check-circle", `ä½ è®©æƒ…äººèº²å¥½ï¼Œè‡ªå·±åˆ™ä»å®¹åœ°ä¸é…å¶å‘¨æ—‹ï¼Œå®Œç¾åœ°æ©é¥°äº†è¿‡å»ã€‚ä½ é…å¶çš„ç–‘å¿ƒç”šè‡³è¿˜é™ä½äº†ã€‚`);
                    }}
                ]
            };
        }
    },
    lover_future_pressure: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "æœªæ¥çš„æœŸç›¼", icon: "fa-ring", description: `â€œæˆ‘ä»¬...ä»¥åä¼šå¦‚ä½•ï¼Ÿâ€ æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> æœ›ç€è¿œæ–¹ï¼Œè½»å£°é—®ä½ ï¼Œçœ¼ä¸­å¸¦ç€æœŸç›¼ä¸ä¸å®‰ã€‚`,
                options: [
                    { htmlContent: "ã€è®¸ä¸‹æ‰¿è¯ºã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 15, devotion: 10 } });
                        showEventCard("æµ·èª“å±±ç›Ÿ", "fa-hand-holding-heart", "ä½ çš„æ‰¿è¯ºè®©TAæš‚æ—¶å®‰å¿ƒï¼Œå¯¹ä½ çš„ç—´æƒ…åº¦å¤§å¢ã€‚");
                    }},
                    { htmlContent: "ã€æ²‰é»˜ä¸è¯­ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -15 } });
                        showEventCard("æ— è¨€çš„ç»“å±€", "fa-heart-broken", "ä½ çš„æ²‰é»˜è®©TAçš„å¿ƒæ²‰äº†ä¸‹å»ï¼Œä½ ä»¬çš„å…³ç³»å‡ºç°äº†è£‚ç—•ã€‚");
                    }},
                    { htmlContent: "ã€é¡¾å·¦å³è€Œè¨€ä»–ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -8 } });
                        showEventCard("é€ƒé¿", "fa-meh", "ä½ å·§å¦™åœ°è½¬ç§»äº†è¯é¢˜ï¼Œä½†TAçœ¼ä¸­çš„å…‰èŠ’é»¯æ·¡äº†ä¸‹å»ã€‚");
                    }}
                ]
            };
        }
    },
    lover_sickness: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "ç—…ä¸­æ¢æœ›", icon: "fa-bed", description: `ä½ å¾—çŸ¥æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> æ‚£äº†é£å¯’ï¼Œå§ç—…åœ¨åºŠã€‚`,
                options: [
                    { htmlContent: "ã€å·å·å‰å»æ¢æœ›ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 20, devotion: 15 } });
                        showEventCard("é›ªä¸­é€ç‚­", "fa-hand-holding-medical", "ä½ å†’é™©çš„æ¢æœ›è®©TAåœ¨ç—…ä¸­æ„Ÿå—åˆ°äº†å·¨å¤§çš„æ¸©æš–ï¼Œå¯¹ä½ æ­»å¿ƒå¡Œåœ°ã€‚");
                    }},
                    { htmlContent: "ã€æ‰˜äººé€å»è¯æã€‘(-200ä¸¤)", disabled: gs.finances.wealth < 200, callback: () => {
                        applyEffects({ wealth: -200, relationship: { targetId: lover.id, favor: 8 } });
                        showEventCard("å…³æ€€å¤‡è‡³", "fa-pills", "ä½ é€å»çš„åè´µè¯æè®©TAå¾ˆæ„ŸåŠ¨ã€‚");
                    }}
                ]
            };
        }
    },
    lover_shared_memory: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "è¿½å¿†å¾€æ˜”", icon: "fa-history", description: `æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> ä¸ä½ èŠèµ·ä½ ä»¬åˆæ¬¡ç›¸é‡æ—¶çš„åœºæ™¯ï¼Œæ„Ÿæ…¨ä¸‡åƒã€‚`,
                options: [
                    { htmlContent: "ã€ä¸€åŒå›å¿†ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 10 } });
                        showEventCard("å¾€äº‹å¦‚æ˜¨", "fa-images", "ä½ ä»¬ä¸€åŒæ²‰æµ¸åœ¨ç¾å¥½çš„å›å¿†ä¸­ï¼Œæ„Ÿæƒ…å‡æ¸©ã€‚");
                    }},
                    { htmlContent: "ã€æ‰“è¶£TAå½“åˆçš„çª˜æ€ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 12 } });
                        showEventCard("ç”œèœœçš„ç©ç¬‘", "fa-grin-wink", "ä½ çš„æ‰“è¶£è®©TAåˆç¾åˆç¬‘ï¼Œæ°”æ°›ååˆ†æš§æ˜§ã€‚");
                    }}
                ]
            };
        }
    },
    lover_jealousy_provoke: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "æ—æ•²ä¾§å‡»", icon: "fa-user-secret", description: `æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> â€œæ— æ„â€ä¸­æèµ·ï¼Œæœ€è¿‘ä¼¼ä¹æœ‰ä½æ‰ä¿Š/ä½³äººæ­£åœ¨è¿½æ±‚TAã€‚`,
                options: [
                    { htmlContent: "ã€è¡¨ç°å‡ºå¼ºçƒˆçš„å æœ‰æ¬²ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 10 } });
                        showEventCard("ç”œèœœçš„éœ¸é“", "fa-kiss", "ä½ çš„é†‹æ„è®©TAæš—è‡ªçªƒå–œï¼ŒçŸ¥é“ä½ æ˜¯åœ¨ä¹TAçš„ã€‚");
                    }},
                    { htmlContent: "ã€å‡è£…ä¸åœ¨æ„ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -8 } });
                        showEventCard("æ•…ä½œå¤§æ–¹", "fa-meh", "ä½ çš„â€œå¤§æ–¹â€è®©TAæœ‰äº›å¤±æœ›ï¼Œä¸ç¡®å®šä½ æ˜¯å¦çœŸçš„åœ¨ä¹ã€‚");
                    }}
                ]
            };
        }
    },
    lover_public_awkwardness: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0 && gs.marriage.isMarried,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "ä¸æœŸè€Œé‡", icon: "fa-users", description: `ä½ æ­£ä¸é…å¶ <strong class="highlight-npc">${spouse.name}</strong> åœ¨è¡—ä¸Šæ•£æ­¥ï¼Œè¿é¢ç«Ÿæ’ä¸Šäº†ä½ çš„æƒ…äºº <strong class="highlight-npc">${lover.name}</strong>ï¼`,
                options: [
                    { htmlContent: "ã€ä»‹ç»ä¸ºâ€œè¿œæˆ¿äº²æˆšâ€ã€‘", req: { charm: 70 }, callback: () => {
                        showEventCard("åº”å¯¹å¾—ä½“", "fa-check", `ä½ é•‡å®šåœ°å°†${lover.name}ä»‹ç»ä¸ºè¿œæˆ¿äº²æˆšï¼Œä¸‰äººå¯’æš„å‡ å¥åä¾¿åˆ†å¼€äº†ï¼Œæœ‰æƒŠæ— é™©ã€‚`);
                    }},
                    { htmlContent: "ã€çœ¼ç¥ç¤ºæ„ï¼Œè®©å…¶ç¦»å¼€ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -5 } });
                        showEventCard("å¿ƒç…§ä¸å®£", "fa-eye-slash", `${lover.name}ä¼šæ„åœ°å…ˆè¡Œç¦»å¼€ï¼Œä½†å¿ƒä¸­ä¸å…æœ‰äº›å¤±è½ã€‚`);
                    }}
                ]
            };
        }
    },
    lover_special_gift: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "ç‰¹æ®Šçš„å¿ƒæ„", icon: "fa-hand-sparkles", description: `æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> ä¸ºä½ é€æ¥ä¸€ä»½äº²æ‰‹åˆ¶ä½œçš„ç¤¼ç‰©ï¼ˆç”»/å‰‘ç©—/é¦™å›Šï¼‰ï¼Œè™½ä¸è´µé‡ï¼Œå´é¥±å«å¿ƒæ„ã€‚`,
                options: [
                    { htmlContent: "ã€çè—èµ·æ¥ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 15, devotion: 10 } });
                        showEventCard("è§†è‹¥çå®", "fa-gem", "ä½ å°†ç¤¼ç‰©çè—èµ·æ¥ï¼Œå¯¹æ–¹è§ä½ å¦‚æ­¤çè§†ï¼Œæ„ŸåŠ¨ä¸å·²ã€‚");
                    }},
                    { htmlContent: "ã€å½“é¢ä½¿ç”¨ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 20, devotion: 5 } });
                        showEventCard("æœ€å¥½çš„å›åº”", "fa-grin-hearts", "ä½ ç«‹åˆ»å°±å°†ç¤¼ç‰©ä½©æˆ´/ä½¿ç”¨èµ·æ¥ï¼Œè¿™æ˜¯å¯¹TAå¿ƒæ„æœ€å¥½çš„å›åº”ã€‚");
                    }}
                ]
            };
        }
    },
    lover_sacrifice_marriage: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0 && gs.npcs[getRandomElement(gs.social.secretLovers)].favor > 80,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "ä¸ºçˆ±ç‰ºç‰²", icon: "fa-heart-crack", description: `ä½ å¾—çŸ¥ï¼Œæƒ…äºº <strong class="highlight-npc">${lover.name}</strong> ä¸ºäº†ç­‰ä½ ï¼Œæ‹’ç»äº†ä¸€é—¨å¯¹å…¶å®¶æ—ææœ‰åŠ©ç›Šçš„å©šäº‹ï¼Œå› æ­¤å¤‡å—å®¶æ—å‹åŠ›ã€‚`,
                options: [
                    { htmlContent: "ã€æ·±å—æ„ŸåŠ¨ï¼Œè®¸ä»¥é‡è¯ºã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 25, devotion: 20 } });
                        showEventCard("æ­¤ç”Ÿä¸è´Ÿ", "fa-ring", `TAçš„ç‰ºç‰²è®©ä½ æ·±å—æ„ŸåŠ¨ï¼Œä½ å‘TAè®¸ä¸‹é‡è¯ºï¼Œæ­¤ç”Ÿç»ä¸è´ŸTAã€‚`);
                    }},
                    { htmlContent: "ã€åŠTAä»¥å®¶æ—ä¸ºé‡ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -30, devotion: -20 } });
                        showEventCard("ç¼˜åˆ†å·²å°½", "fa-sad-cry", `ä½ çš„åŠè¯´è®©TAå½»åº•å¿ƒæ­»ï¼Œä½ ä»¬çš„å…³ç³»èµ°åˆ°äº†å°½å¤´ã€‚`);
                        // å…³ç³»ç ´è£‚é€»è¾‘
                        delete gs.social.relationships[lover.id];
                        gs.social.secretLovers = gs.social.secretLovers.filter(id => id !== lover.id);
                    }}
                ]
            };
        }
    },
    lover_joint_investment: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "ç§˜å¯†çš„åˆä½œ", icon: "fa-money-check-alt", description: `æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> å‘Šè¯‰ä½ ä¸€ä¸ªç§˜å¯†çš„èµšé’±æœºä¼šï¼Œé‚€è¯·ä½ ä¸€åŒæŠ•èµ„ï¼Œä½œä¸ºä½ ä»¬æœªæ¥çš„â€œå°é‡‘åº“â€ã€‚`,
                options: [
                    { htmlContent: "ã€æŠ•å…¥1000ä¸¤ã€‘", disabled: gs.finances.wealth < 1000, callback: () => {
                        applyEffects({ wealth: -1000 });
                        if (Math.random() < 0.7) {
                            applyEffects({ wealth: 1800 });
                            showEventCard("åˆä½œå…±èµ¢", "fa-chart-pie", "æŠ•èµ„æˆåŠŸï¼ä½ ä»¬çš„â€œå°é‡‘åº“â€æ›´åŠ å……è£•äº†ã€‚");
                        } else {
                            showEventCard("æŠ•èµ„å¤±åˆ©", "fa-chart-area", "ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ¬¡æŠ•èµ„å¤±è´¥äº†ã€‚");
                        }
                    }},
                    { htmlContent: "ã€è®¤ä¸ºé£é™©å¤ªå¤§ï¼Œæ‹’ç»ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -5 } });
                        showEventCard("è°¨æ…ä¸ºä¸Š", "fa-user-shield", `ä½ æ‹’ç»äº†è¿™æ¬¡æŠ•èµ„ï¼Œ${lover.name}è¡¨ç¤ºç†è§£ä½†æœ‰äº›å¤±æœ›ã€‚`);
                    }}
                ]
            };
        }
    },
spouse_gift: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "é…å¶çš„å¿ƒæ„", icon: "fa-gift",
                description: `ä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> è§ä½ è¿‘æ—¥è¾›åŠ³ï¼Œç‰¹åœ°ä¸ºä½ å‡†å¤‡äº†ä¸€ä»½ç¤¼ç‰©ã€‚`,
                options: [
                    { htmlContent: "æ¬£ç„¶æ”¶ä¸‹", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 10 } });
                        showEventCard("å¿ƒæœ‰çµçŠ€", "fa-heart", "ä¸€ä»½è´´å¿ƒçš„ç¤¼ç‰©è®©ä½ ä»¬çš„æƒ…æ„Ÿå‡æ¸©ã€‚");
                    }},
                    { htmlContent: "å›èµ ç¤¼ç‰© (-200ä¸¤)", disabled: gs.finances.wealth < 200, callback: () => {
                        applyEffects({ wealth: -200, relationship: { targetId: spouse.id, favor: 15 } });
                        showEventCard("ç¤¼å°šå¾€æ¥", "fa-gem", "ä½ çš„å›ç¤¼è®©å¯¹æ–¹æƒŠå–œä¸å·²ï¼Œä½ ä»¬çš„æ„Ÿæƒ…æ›´åŠ æ·±åšã€‚");
                    }}
                ]
            };
        }
    },
    spouse_career_concern: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.career.path,
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "æ•è¾¹ç»†è¯­", icon: "fa-comments",
                description: `å¤œæ·±äººé™ï¼Œä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> ä¸ä½ è°ˆåŠä½ æœ€è¿‘çš„äº‹ä¸šï¼Œè¨€è¯­é—´é¢‡ä¸ºå…³å¿ƒã€‚`,
                options: [
                    { htmlContent: "åˆ†äº«ä½ çš„è§„åˆ’", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 8 }, attributes: { wisdom: 2 } });
                        gs.career.performance += 5;
                        showEventCard("è´¤å†…åŠ©", "fa-lightbulb", "ä¸é…å¶çš„äº¤è°ˆè®©ä½ å¯¹æœªæ¥æœ‰äº†æ›´æ¸…æ™°çš„è§„åˆ’ã€‚");
                    }},
                    { htmlContent: "æŠ¥å–œä¸æŠ¥å¿§", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 3 } });
                        showEventCard("ä½“è´´", "fa-smile", "ä½ ä¸æƒ³è®©å¯¹æ–¹æ‹…å¿ƒï¼Œåªåˆ†äº«äº†å·¥ä½œä¸­çš„è¶£äº‹ã€‚");
                    }}
                ]
            };
        }
},
spouse_shared_hobby: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            const hobby = gs.player.gender === 'male' ? 'ä½œç”»' : 'å‚é’“';
            return {
                title: "é—²æƒ…é€¸è‡´", icon: "fa-paint-brush",
                description: `å¤©æ°”ç”šå¥½ï¼Œä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> é‚€è¯·ä½ ä¸€åŒå‰å¾€éƒŠå¤–${hobby}ï¼Œäº«å—éš¾å¾—çš„é—²æš‡æ—¶å…‰ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶åŒå¾€ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 10 }, attributes: { health: 5 } });
                        showEventCard("ç¥ä»™çœ·ä¾£", "fa-sun", `ä½ ä»¬åº¦è¿‡äº†ä¸€æ®µå®é™è€Œç¾å¥½çš„æ—¶å…‰ï¼Œèº«å¿ƒéƒ½å¾—åˆ°äº†æ”¾æ¾ã€‚`);
                    }},
                    { htmlContent: "ã€æ‰˜è¾æ‹’ç»ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: -5 } });
                        showEventCard("å…¬åŠ¡ç¹å¿™", "fa-briefcase", `ä½ ä»¥å…¬åŠ¡ç¹å¿™ä¸ºç”±æ‹’ç»äº†ï¼Œ${spouse.name}çœ¼ä¸­é—ªè¿‡ä¸€ä¸å¤±è½ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_prepare_meal: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "æ´—æ‰‹ä½œç¾¹æ±¤", icon: "fa-utensils",
                description: `ä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> äº²è‡ªä¸‹å¨ï¼Œä¸ºä½ åšäº†ä¸€æ¡Œä½ æœ€çˆ±åƒçš„èœè‚´ã€‚`,
                options: [
                    { htmlContent: "ã€å¤§åŠ ç§°èµã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 12 } });
                        showEventCard("äººé—´çƒŸç«æ°”", "fa-grin-hearts", `ä½ å¯¹TAçš„æ‰‹è‰ºèµä¸ç»å£ï¼Œå¯¹æ–¹ç¬‘é¥å¦‚èŠ±ã€‚`);
                    }},
                    { htmlContent: "ã€æå‡ºæ”¹è¿›æ„è§ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: -3 } });
                        showEventCard("ä¸è§£é£æƒ…", "fa-meh", `ä½ å–„æ„åœ°æå‡ºäº†å‡ ç‚¹æ”¹è¿›æ„è§ï¼Œä½†å¯¹æ–¹çš„çƒ­æƒ…ä¼¼ä¹è¢«æµ‡äº†ä¸€ç›†å†·æ°´ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_anniversary: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && (gs.date.year - (gs.marriage.weddingYear || gs.date.year)) > 0,
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "æˆå©šçºªå¿µ", icon: "fa-calendar-check",
                description: `ä»Šæ—¥æ˜¯ä½ ä»¬çš„æˆå©šçºªå¿µæ—¥ï¼Œ<strong class="highlight-npc">${spouse.name}</strong> ä¼¼ä¹åœ¨æœŸå¾…ç€ä»€ä¹ˆã€‚`,
                options: [
                    { htmlContent: "ã€å‡†å¤‡æƒŠå–œç¤¼ç‰©ã€‘", disabled: gs.finances.wealth < 500, callback: () => {
                        applyEffects({ wealth: -500, relationship: { targetId: spouse.id, favor: 20 } });
                        showEventCard("æƒŠå–œ", "fa-gift", `ä½ ç²¾å¿ƒå‡†å¤‡çš„ç¤¼ç‰©è®©å¯¹æ–¹æƒŠå–œä¸å·²ï¼Œä½ ä»¬é‡æ¸©äº†æ–°å©šæ—¶çš„ç”œèœœã€‚`);
                    }},
                    { htmlContent: "ã€å¹³æ·¡åº¦è¿‡ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: -8 } });
                        showEventCard("é—å¿˜", "fa-sad-tear", `ä½ ä¼¼ä¹å¿˜è®°äº†è¿™ä¸ªé‡è¦çš„æ—¥å­ï¼Œå¯¹æ–¹ä¸€æ•´å¤©éƒ½é—·é—·ä¸ä¹ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_decor_disagreement: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "å¸ƒç½®ä¹‹äº‰", icon: "fa-couch",
                description: `ä½ ä»¬å°±ä¹¦æˆ¿é‡Œæ˜¯è¯¥æŒ‚ä¸€å¹…å±±æ°´ç”»è¿˜æ˜¯ä¸€å¹…çŒ›è™å›¾äº§ç”Ÿäº†å°å°çš„åˆ†æ­§ã€‚`,
                options: [
                    { htmlContent: "ã€å¬ä»TAçš„ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 5 } });
                        showEventCard("ä»¥å’Œä¸ºè´µ", "fa-handshake", `ä½ é€‰æ‹©äº†é€€è®©ï¼Œ${spouse.name}å¯¹ä½ çš„ä½“è´´å¾ˆå—ç”¨ã€‚`);
                    }},
                    { htmlContent: "ã€åšæŒå·±è§ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: -2 } });
                        showEventCard("å¯¸æ­¥ä¸è®©", "fa-gavel", `ä½ ä»¬äº‰æ‰§äº†ä¸€ç•ªï¼Œæœ€ç»ˆè¿˜æ˜¯æŒ‰ä½ çš„æƒ³æ³•å¸ƒç½®äº†ï¼Œä½†æ°”æ°›æœ‰äº›å°´å°¬ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_caring_illness: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && gs.player.health < 60,
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "ç—…ä¸­ç…§æ–™", icon: "fa-bed",
                description: `ä½ è¿‘æ¥èº«ä½“æŠ±æ™ï¼Œä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> æ—¥å¤œå®ˆåœ¨åºŠå‰ï¼Œä¸ºä½ ç«¯èŒ¶é€è¯ï¼Œå…³æ€€å¤‡è‡³ã€‚`,
                options: [
                    { htmlContent: "ã€æ·±å—æ„ŸåŠ¨ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 15 }, attributes: { health: 10 } });
                        showEventCard("æ‚£éš¾è§çœŸæƒ…", "fa-heartbeat", `TAçš„æ‚‰å¿ƒç…§æ–™è®©ä½ æ¢å¤å¾—å¾ˆå¿«ï¼Œä½ ä»¬çš„æ„Ÿæƒ…ä¹Ÿæ„ˆåŠ æ·±åšã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_child_future: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && gs.children.some(c => !c.isDead && c.age >= 16),
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 16));
            return {
                title: "å­å—£å‰ç¨‹", icon: "fa-graduation-cap",
                description: `ä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> ä¸ä½ å•†è®®æˆå¹´å­å¥³ <strong class="highlight-npc">${child.name}</strong> çš„å©šäº‹æˆ–å‰ç¨‹ï¼Œæƒ³å¬å¬ä½ çš„çœ‹æ³•ã€‚`,
                options: [
                    { htmlContent: "ã€æ·±å…¥æ¢è®¨ï¼Œå…±åŒè§„åˆ’ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 8 }, attributes: { wisdom: 3 } });
                        showEventCard("æ·±è°‹è¿œè™‘", "fa-chess-board", `ä½ ä»¬ä¸ºå­©å­çš„æœªæ¥åˆ¶å®šäº†å‘¨è¯¦çš„è®¡åˆ’ï¼Œå±•ç°äº†ä¸ºäººçˆ¶æ¯çš„è´£ä»»æ„Ÿã€‚`);
                    }},
                    { htmlContent: "ã€è®©å­©å­è‡ªå·±å†³å®šã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 3 } });
                        showEventCard("å„¿å­™è‡ªæœ‰å„¿å­™ç¦", "fa-leaf", `ä½ ä»¬å†³å®šå°Šé‡å­©å­çš„é€‰æ‹©ï¼Œé¡ºå…¶è‡ªç„¶ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_inlaw_visit: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "äº²å®¶åˆ°è®¿", icon: "fa-users",
                description: `ä½ çš„çˆ¶æ¯å‰æ¥æ¢æœ›ï¼Œä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> äº²è‡ªå‡ºé¢æ¥å¾…ã€‚`,
                options: [
                    { htmlContent: "ã€è§‚å¯Ÿå…¶è¡¨ç°ã€‘", callback: () => {
                        if (spouse.attributes.etiquette > 70) {
                            applyEffects({ relationship: { targetId: spouse.id, favor: 10 }, reputation: 5 });
                            showEventCard("è´¤è‰¯æ·‘å¾·", "fa-thumbs-up", `${spouse.name}è¡¨ç°å¾—ä½“ï¼Œåº”å¯¹å‘¨åˆ°ï¼Œè®©ä½ çš„çˆ¶æ¯èµä¸ç»å£ã€‚`);
                        } else {
                            applyEffects({ relationship: { targetId: spouse.id, favor: -5 } });
                            showEventCard("ç•¥æœ‰å¤±ç¤¼", "fa-frown-open", `${spouse.name}åœ¨æ¥å¾…ä¸­æœ‰äº›è®¸å¤±ç¤¼ä¹‹å¤„ï¼Œè®©åœºé¢æœ‰äº›å°´å°¬ã€‚`);
                        }
                    }}
                ]
            };
        }
    },
    spouse_budget_dispute: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "é¢„ç®—åˆ†æ­§", icon: "fa-calculator",
                description: `ä½ æè®®åŠ¨ç”¨ä¸€ç¬”å¤§é¢å®¶åº“èµ„é‡‘ç”¨äºæŸé¡¹æŠ•èµ„/å¼€é”€ï¼Œä½†é…å¶ <strong class="highlight-npc">${spouse.name}</strong> è®¤ä¸ºæ­¤ä¸¾è¿‡äºæµªè´¹ï¼Œè¡¨ç¤ºåå¯¹ã€‚`,
                options: [
                    { htmlContent: "ã€è€å¿ƒè¯´æœã€‘", callback: () => {
                        if (gs.player.attributes.wisdom > spouse.attributes.wisdom) {
                             applyEffects({ relationship: { targetId: spouse.id, favor: 5 } });
                             showEventCard("è¾¾æˆå…±è¯†", "fa-check", `ä½ ç”¨å……åˆ†çš„ç†ç”±è¯´æœäº†å¯¹æ–¹ï¼ŒTAæœ€ç»ˆåŒæ„äº†ä½ çš„è®¡åˆ’ã€‚`);
                        } else {
                            applyEffects({ relationship: { targetId: spouse.id, favor: -5 } });
                            showEventCard("åšæŒå·±è§", "fa-times", `ä½ ä»¬æœªèƒ½è¾¾æˆå…±è¯†ï¼Œæ­¤äº‹ä¸äº†äº†ä¹‹ã€‚`);
                        }
                    }},
                    { htmlContent: "ã€åŠ¨ç”¨ç§äº§ã€‘", disabled: gs.finances.wealth < 1000, callback: () => {
                        applyEffects({ wealth: -1000, attributes: { virtue: 3 } });
                        showEventCard("è‡ªæè…°åŒ…", "fa-wallet", `ä½ å†³å®šåŠ¨ç”¨è‡ªå·±çš„ç§äº§æ¥å®Œæˆæ­¤äº‹ï¼Œé¿å…äº†å®¶åº­çŸ›ç›¾ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_praise_player: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && gs.children.some(c => !c.isDead && c.age >= 6),
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 6));
            return {
                title: "è€³è¾¹ä¹‹è¨€", icon: "fa-ear-listen",
                description: `ä½ æ— æ„ä¸­å¬åˆ°é…å¶ <strong class="highlight-npc">${spouse.name}</strong> æ­£åœ¨å‘å­©å­ <strong class="highlight-npc">${child.name}</strong> è®²è¿°ä½ çš„ä¼˜ç‚¹ï¼Œè®©å­©å­ä»¥ä½ ä¸ºæ¦œæ ·ã€‚`,
                options: [
                    { htmlContent: "ã€å¿ƒä¸­ä¸€æš–ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 15 } });
                        child.favor = (child.favor || 50) + 5;
                        showEventCard("å®¶åº­å’Œç¦", "fa-home", `æ­¤æƒ…æ­¤æ™¯è®©ä½ æ„Ÿåˆ°æ— æ¯”çš„å¹¸ç¦å’Œæ»¡è¶³ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_defend_reputation: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && gs.family.reputation < 50,
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "ç»´æŠ¤ä¹‹æƒ…", icon: "fa-shield-alt",
                description: `è¿‘æ¥æœ‰äº›å…³äºä½ çš„ä¸å®æµè¨€åœ¨åŠé—´ä¼ æ’­ï¼Œåœ¨ä½ å°šæœªå›åº”æ—¶ï¼Œä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> å·²åœ¨å…¬å¼€åœºåˆä¸ºä½ è¾©ç™½ï¼Œé©³æ–¥äº†è°£è¨€ã€‚`,
                options: [
                    { htmlContent: "ã€è¡¨ç¤ºæ„Ÿè°¢ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 18 } });
                        showEventCard("å¤«å¦»åŒå¿ƒ", "fa-hand-holding-heart", `TAçš„ç»´æŠ¤è®©ä½ ååˆ†æ„ŸåŠ¨ï¼Œä½ ä»¬çš„æ„Ÿæƒ…æ›´åŠ åšå›ºã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_sacrifice: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && gs.career.path,
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "é»˜é»˜çš„æ”¯æŒ", icon: "fa-gem",
                description: `ä½ ä¸ºäº†ä¸€é¡¹é‡è¦çš„äº‹ä¸šæŠ•èµ„è€Œèµ„é‡‘çŸ­ç¼ºï¼Œæ­£å‘æ„æ—¶ï¼Œå‘ç°é…å¶ <strong class="highlight-npc">${spouse.name}</strong> æ‚„æ‚„å˜å–äº†è‡ªå·±ççˆ±çš„é¦–é¥°/è—å“ï¼Œå°†é’±æ”¾åˆ°äº†ä½ çš„ä¹¦æ¡Œä¸Šã€‚`,
                options: [
                    { htmlContent: "ã€æ”¶ä¸‹è¿™ä»½å¿ƒæ„ã€‘", callback: () => {
                        applyEffects({ wealth: 1000, relationship: { targetId: spouse.id, favor: 25 } });
                        showEventCard("æƒ…æ¯”é‡‘åš", "fa-ring", `è¿™ä»½æ²‰ç”¸ç”¸çš„æ”¯æŒè®©ä½ æ— è¨€ä»¥å¯¹ï¼Œå”¯æœ‰åŠ å€åŠªåŠ›ä½œä¸ºå›æŠ¥ã€‚`);
                    }},
                    { htmlContent: "ã€æ‹’ç»å¹¶å®‰æ…°TAã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 15 }, attributes: { virtue: 5 } });
                        showEventCard("ç›¸æ¿¡ä»¥æ²«", "fa-users", `ä½ æ‹’ç»äº†TAçš„å¥½æ„ï¼Œè¡¨ç¤ºåŠæ³•æ€»æ¯”å›°éš¾å¤šã€‚ä½ ä»¬ç›¸è§†ä¸€ç¬‘ï¼Œå†³å®šå…±åŒé¢å¯¹ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_feeling_neglected: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && gs.marriage.favor < 40,
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "è¢«å†·è½çš„æ€¨æ°”", icon: "fa-cloud-moon-rain",
                description: `ä½ æœ€è¿‘è¿‡äºä¸“æ³¨äºäº‹ä¸š/ç¤¾äº¤ï¼Œå†·è½äº†é…å¶ <strong class="highlight-npc">${spouse.name}</strong>ã€‚TAå¯¹ä½ çš„æ€åº¦æ˜æ˜¾å†·æ·¡äº†è®¸å¤šã€‚`,
                options: [
                    { htmlContent: "ã€æŠ½å‡ºæ—¶é—´é™ªä¼´ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 15 } });
                        showEventCard("äº¡ç¾Šè¡¥ç‰¢", "fa-calendar-day", `ä½ æ¨æ‰æ‰€æœ‰åº”é…¬ï¼Œä¸“å¿ƒé™ªä¼´TAæ•°æ—¥ï¼ŒæˆåŠŸæŒ½å›äº†TAçš„å¿ƒã€‚`);
                    }},
                    { htmlContent: "ã€èµ é€ç¤¼ç‰©è¡¥å¿ã€‘", disabled: gs.finances.wealth < 300, callback: () => {
                        applyEffects({ wealth: -300, relationship: { targetId: spouse.id, favor: 8 } });
                        showEventCard("ç‰©è´¨è¡¥å¿", "fa-box-open", `ä½ é€ä¸Šçš„ç¤¼ç‰©è®©TAçš„å¿ƒæƒ…å¥½äº†äº›ï¼Œä½†ä¼¼ä¹ä»æœ‰èŠ¥è’‚ã€‚`);
                    }},
                    { htmlContent: "ã€ä¸ä»¥ä¸ºæ„ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: -10 } });
                        showEventCard("æ¸è¡Œæ¸è¿œ", "fa-shoe-prints", `ä½ çš„å¿½è§†è®©ä½ ä»¬çš„å…³ç³»é›ªä¸ŠåŠ éœœã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_secret_revealed: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId] && gs.marriage.favor > 80,
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "è¿‡å»çš„ç§˜å¯†", icon: "fa-book-dead",
                description: `åœ¨ä¸€æ¬¡å¤œè°ˆä¸­ï¼Œé…å¶ <strong class="highlight-npc">${spouse.name}</strong> å‘ä½ å¦ç™½äº†ä¸€ä»¶åœ¨ä¸ä½ æˆå©šå‰çš„ç§˜å¯†å¾€äº‹ã€‚`,
                options: [
                    { htmlContent: "ã€è¡¨ç¤ºç†è§£ä¸æ¥çº³ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 10 }, attributes: { virtue: 3 } });
                        showEventCard("å¦è¯šç›¸å¾…", "fa-heart", `ä½ çš„ç†è§£è®©TAæ”¾ä¸‹äº†å¿ƒä¸­çš„é‡æ‹…ï¼Œä½ ä»¬çš„å…³ç³»æ›´åŠ ç‰¢å›ºã€‚`);
                    }},
                    { htmlContent: "ã€å¿ƒç”ŸèŠ¥è’‚ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: -8 } });
                        showEventCard("å¿ƒæœ‰èŠ¥è’‚", "fa-user-secret", `ä½ è™½ç„¶è¡¨é¢å¹³é™ï¼Œä½†æ­¤äº‹åœ¨ä½ å¿ƒä¸­ç•™ä¸‹äº†ä¸€æ ¹åˆºã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_joint_investment: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "å…±åŒçš„æŠ•èµ„", icon: "fa-handshake",
                description: `é…å¶ <strong class="highlight-npc">${spouse.name}</strong> æè®®å°†ä½ ä»¬çš„ç§äº§åˆåœ¨ä¸€èµ·ï¼ŒæŠ•èµ„ä¸€é—´é“ºå­ï¼Œä½œä¸ºä½ ä»¬å…±åŒçš„äº§ä¸šã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶åŒæ„ã€‘", disabled: gs.finances.wealth < 500, callback: () => {
                        applyEffects({ wealth: -500, relationship: { targetId: spouse.id, favor: 8 } });
                        if (!gs.marriage.jointAssets) gs.marriage.jointAssets = 0;
                        gs.marriage.jointAssets += 1000;
                        showEventCard("å¤«å”±å¦‡éš", "fa-store-alt", `ä½ ä»¬å…±åŒæŠ•èµ„äº†ä¸€é—´é“ºå­ï¼Œè™½ç„¶åŠ¨ç”¨äº†ä½ çš„ç§äº§ï¼Œä½†ä½ ä»¬æœ‰äº†å…±åŒå¥‹æ–—çš„ç›®æ ‡ã€‚`);
                    }},
                    { htmlContent: "ã€è®¤ä¸ºåº”å½“å…¬ç§åˆ†æ˜ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: -6 } });
                        showEventCard("å…¬ç§åˆ†æ˜", "fa-balance-scale-right", `ä½ è®¤ä¸ºé’±è´¢è¿˜æ˜¯åˆ†å¼€ç®¡æ¯”è¾ƒå¥½ï¼Œå¯¹æ–¹ä¼¼ä¹å¯¹ä½ çš„ä¸ä¿¡ä»»æœ‰äº›å¤±æœ›ã€‚`);
                    }}
                ]
            };
        }
    },
    spouse_illness_scare: {
        type: 'spouse',
        condition: (gs) => gs.marriage.isMarried && gs.npcs[gs.marriage.spouseId],
        generate: (gs) => {
            const spouse = gs.npcs[gs.marriage.spouseId];
            return {
                title: "å¥åº·è­¦é’Ÿ", icon: "fa-heartbeat",
                description: `ä½ çš„é…å¶ <strong class="highlight-npc">${spouse.name}</strong> è¿‘æ—¥çªæ„Ÿå¿ƒæ‚¸ä¸é€‚ï¼Œå¤ªåŒ»è¯Šæ–­ä¸ºæ“åŠ³è¿‡åº¦ï¼Œéœ€é™å…»ã€‚`,
                options: [
                    { htmlContent: "ã€æ”¾ä¸‹äº‹åŠ¡ï¼Œä¸“å¿ƒç…§æ–™ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: spouse.id, favor: 15 } });
                        if (gs.career.path) gs.career.performance -= 5;
                        showEventCard("é™ªä¼´æ˜¯æœ€å¥½çš„è¯", "fa-user-md", `ä½ æ”¾ä¸‹æ‰‹å¤´äº‹åŠ¡ä¸“å¿ƒç…§æ–™ï¼Œå¯¹æ–¹å¤§ä¸ºæ„ŸåŠ¨ã€‚ä½†è¿™ç•¥å¾®å½±å“äº†ä½ çš„åŠŸç»©ã€‚`);
                    }},
                    { htmlContent: "ã€è˜è¯·ååŒ»ï¼Œè´­ä¹°è¡¥å“ã€‘", disabled: gs.finances.wealth < 800, callback: () => {
                        applyEffects({ wealth: -800, relationship: { targetId: spouse.id, favor: 8 } });
                        showEventCard("é‡é‡‘æ±‚åŒ»", "fa-pills", `ä½ èŠ±è´¹é‡é‡‘ä¸ºTAè°ƒç†èº«ä½“ï¼ŒTAçš„å¥åº·çŠ¶å†µå¥½è½¬ã€‚`);
                    }}
                ]
            };
        }
    },
    // â–²â–²â–² ã€æ–°å¢é…å¶äº‹ä»¶ç»“æŸã€‘ â–²â–²â–²

    // â–¼â–¼â–¼ ã€æ–°å¢æ›´å¤šå­å¥³äº‹ä»¶ã€‘ â–¼â–¼â–¼
    child_new_sickness: {
        type: 'child_new',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age > 2),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age > 2));
            return {
                title: "å­å—£æŠ±æ™", icon: "fa-thermometer-half",
                description: `ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> å¶æ„Ÿé£å¯’ï¼Œå§åºŠä¸èµ·ï¼Œçœ‹èµ·æ¥å¾ˆéš¾å—ã€‚`,
                options: [
                    { htmlContent: "ã€äº²è‡ªç…§æ–™ã€‘", callback: () => {
                        child.favor = (child.favor || 50) + 15;
                        child.attributes.health += 5;
                        applyEffects({ attributes: { health: -5 } });
                        showEventCard("æ‚‰å¿ƒç…§æ–™", "fa-bed", "åœ¨ä½ çš„ç…§æ–™ä¸‹ï¼Œå­©å­å¾ˆå¿«åº·å¤ï¼Œä½†ä½ ä¹Ÿç´¯åäº†ã€‚");
                    }},
                    { htmlContent: "ã€è¯·ååŒ» (-300ä¸¤)ã€‘", disabled: gs.finances.wealth < 300, callback: () => {
                        applyEffects({ wealth: -300 });
                        child.attributes.health += 10;
                        showEventCard("è¯åˆ°ç—…é™¤", "fa-pills", "ä½ è¯·æ¥çš„ååŒ»å¾ˆå¿«æ²»å¥½äº†å­©å­ã€‚");
                    }}
                ]
            };
        }
    },
    child_new_talent_show: {
        type: 'child_new',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 8),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 8));
            const talentType = getRandomElement(['talent', 'martial', 'wisdom']);
            const talentName = ATTR_MAP[talentType];
            return {
                title: "å¤©èµ‹åˆæ˜¾", icon: "fa-star",
                description: `ä½ å‘ç°å­©å­ <strong class="highlight-npc">${child.name}</strong> åœ¨${talentName}æ–¹é¢å±•ç°äº†è¿‡äººçš„å¤©èµ‹ï¼`,
                options: [
                    { htmlContent: `ã€é‡ç‚¹åŸ¹å…»ã€‘`, callback: () => {
                        child.attributes[talentType] += 10;
                        showEventCard("å› ææ–½æ•™", "fa-award", `ä½ çš„é‡ç‚¹åŸ¹å…»è®©${child.name}çš„${talentName}å¤©èµ‹å¾—åˆ°äº†æ›´å¥½çš„å‘å±•ã€‚`);
                    }},
                    { htmlContent: "ã€é¡ºå…¶è‡ªç„¶ã€‘", callback: () => {
                        child.attributes[talentType] += 3;
                        showEventCard("é™å¾…èŠ±å¼€", "fa-seedling", "ä½ å†³å®šè®©å­©å­é¡ºå…¶è‡ªç„¶åœ°å‘å±•ã€‚");
                    }}
                ]
            };
        }
    },
    // â–²â–²â–² ã€æ–°å¢å­å¥³äº‹ä»¶ç»“æŸã€‘ â–²â–²â–²

    // â–¼â–¼â–¼ ã€æ–°å¢å‡ºå¸ˆå¼Ÿå­äº‹ä»¶ã€‘ â–¼â–¼â–¼
    former_apprentice_gift: {
        type: 'former_apprentice',
        condition: (gs) => Object.values(gs.social.relationships).some(r => r.type === 'former_apprentice'),
        generate: (gs) => {
            const apprenticeRel = Object.entries(gs.social.relationships).find(([id, rel]) => rel.type === 'former_apprentice');
            const apprentice = gs.npcs[apprenticeRel[0]];
            const giftAmount = 100 + Math.floor(apprentice.favor * 2);
            return {
                title: "é«˜å¾’çš„å­æ•¬", icon: "fa-gift",
                description: `é€¢å¹´è¿‡èŠ‚ï¼Œä½ å·²å‡ºå¸ˆçš„å¼Ÿå­ <strong class="highlight-npc">${apprentice.name}</strong> å‰æ¥æ‹œæœ›ï¼Œå¹¶ä¸ºä½ å¸¦æ¥äº†ä»·å€¼çº¦ <span class="value">${giftAmount}</span> ä¸¤çš„èŠ‚ç¤¼ã€‚`,
                options: [
                    { htmlContent: "æ¬£ç„¶æ”¶ä¸‹", callback: () => {
                        applyEffects({ wealth: giftAmount, relationship: { targetId: apprentice.id, favor: 10 } });
                        showEventCard("å¸ˆå¾’æƒ…æ·±", "fa-handshake", "ä½ æ”¶ä¸‹äº†ç¤¼ç‰©ï¼Œå¹¶ä¸TAç›¸è°ˆç”šæ¬¢ã€‚");
                    }},
                    { htmlContent: "å‹‰åŠ±ä¸€ç•ª", callback: () => {
                        applyEffects({ relationship: { targetId: apprentice.id, favor: 15 }, attributes: { virtue: 5 } });
                        showEventCard("è°†è°†æ•™è¯²", "fa-chalkboard-teacher", "ä½ å‹‰åŠ±TAè¦ç»§ç»­åŠªåŠ›ï¼Œå¯¹æ–¹å¤‡å—é¼“èˆã€‚");
                    }}
                ]
            };
        }
    },
    former_apprentice_banquet: {
        type: 'former_apprentice',
        condition: (gs) => Object.values(gs.social.relationships).some(r => r.type === 'former_apprentice'),
        generate: (gs) => {
            const apprenticeRel = Object.entries(gs.social.relationships).find(([id, rel]) => rel.type === 'former_apprentice');
            const apprentice = gs.npcs[apprenticeRel[0]];
            return {
                title: "è°¢å¸ˆå®´", icon: "fa-utensils",
                description: `ä½ å·²å‡ºå¸ˆçš„å¼Ÿå­ <strong class="highlight-npc">${apprentice.name}</strong> åœ¨äº‹ä¸šä¸Šå°æœ‰æˆå°±ï¼Œç‰¹åœ¨äº¬åŸæœ€å¥½çš„é…’æ¥¼è®¾ä¸‹å®´å¸­ï¼Œä¸“é—¨æ„Ÿè°¢ä½ çš„æ ½åŸ¹ä¹‹æ©ã€‚`,
                options: [
                    { htmlContent: "æ¬£ç„¶èµ´å®´", callback: () => {
                        applyEffects({ relationship: { targetId: apprentice.id, favor: 20 }, reputation: 10 });
                        showEventCard("åå¸ˆé«˜å¾’", "fa-award", "ä½ åœ¨å®´å¸­ä¸Šå¤‡å—æ¨å´‡ï¼Œå¸ˆå¾’äºŒäººçš„äº‹è¿¹è¢«ä¼ ä¸ºä½³è¯ã€‚");
                    }},
                    { htmlContent: "æ‰˜æ•…æ¨è¾", callback: () => {
                        applyEffects({ relationship: { targetId: apprentice.id, favor: -5 } });
                        showEventCard("åˆ†èº«ä¹æœ¯", "fa-times", "ä½ å› æ•…æœªèƒ½èµ´çº¦ï¼Œå¯¹æ–¹è¡¨ç¤ºç†è§£ï¼Œä½†ç•¥æ„Ÿå¤±æœ›ã€‚");
                    }}
                ]
            };
        }
    },
    lover_jealousy: {
        type: 'lover',
        condition: (gs) => gs.marriage.isMarried && gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "æƒ…äººçš„é†‹æ„", icon: "fa-fire", description: `ä½ ä¸æ­£å¦»/å¤«å›ä¸€åŒå‡ºè¡Œçš„äº‹ä¼ åˆ°äº† <strong class="highlight-npc">${lover.name}</strong> çš„è€³ä¸­ï¼ŒTAä¼¼ä¹æœ‰äº›ä¸æ‚¦ã€‚`,
                options: [
                    { htmlContent: "ã€å†™ä¿¡å®‰æŠšã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 8 } });
                        showEventCard("ç”œè¨€èœœè¯­", "fa-pen-fancy", "ä½ çš„æƒ…ä¹¦åŒ–è§£äº†TAçš„é†‹æ„ã€‚");
                    }},
                    { htmlContent: "ã€èµ é€ç¤¼ç‰©ã€‘", disabled: gs.finances.wealth < 300, callback: () => {
                        applyEffects({ wealth: -300, relationship: { targetId: lover.id, favor: 12 } });
                        showEventCard("ç‰©è´¨è¡¥å¿", "fa-gem", "æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸€ä¸ªç¤¼ç‰©è§£å†³ä¸äº†çš„ã€‚");
                    }},
                    { htmlContent: "ã€ä¸äºˆç†ä¼šã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -10 } });
                        showEventCard("å…³ç³»å†·æ·¡", "fa-snowflake", "ä½ çš„å†·å¤„ç†è®©TAæ›´åŠ ä¼¤å¿ƒã€‚");
                    }}
                ]
            };
        }
    },
    lover_meet_secretly: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "å±é™©çš„é‚€çº¦", icon: "fa-mask", description: `<strong class="highlight-npc">${lover.name}</strong> é‚€ä½ åœ¨åŸå¤–ç ´åº™ç§ä¼šï¼Œæ­¤ä¸¾é¢‡ä¸ºå†’é™©ã€‚`,
                options: [
                    { htmlContent: "ã€èµ´çº¦ã€‘", callback: () => {
                        if (Math.random() > 0.1) {
                            applyEffects({ relationship: { targetId: lover.id, favor: 20 } });
                            showEventCard("æƒŠå¿ƒåŠ¨é­„", "fa-heartbeat", "ä½ ä»¬åº¦è¿‡äº†ä¸€ä¸ªåˆºæ¿€è€Œç¼ ç»µçš„å¤œæ™šã€‚");
                            if(gs.player.gender === 'female') triggerBirth(lover.id, true);
                        } else {
                            if(gs.marriage.isMarried) {
                                const spouse = gs.npcs[gs.marriage.spouseId];
                                spouse.suspicionValue = (spouse.suspicionValue || 0) + 30;
                                showEventCard("ä¸œçª—äº‹å‘", "fa-exclamation-circle", "ä½ ä»¬çš„ç§æƒ…è¢«å‘ç°äº†ï¼");
                            }
                        }
                    }},
                    { htmlContent: "ã€æ‹’ç»ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -8 } });
                        showEventCard("è°¨æ…ä¸ºä¸Š", "fa-user-shield", "ä½ æ‹’ç»äº†è¿™æ¬¡å±é™©çš„çº¦ä¼šã€‚");
                    }}
                ]
            };
        }
    },
    lover_dream: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "æ¢¦ä¸­çš„ä½ ", icon: "fa-cloud-moon", description: `ä½ çš„æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> å‘Šè¯‰ä½ ï¼Œæ˜¨å¤œæ¢¦åˆ°äº†ä½ ï¼Œæ¢¦é‡Œçš„ä½ ä»¬...`,
                options: [
                    { htmlContent: "ã€è¿½é—®æ¢¦å¢ƒç»†èŠ‚ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 10, devotion: 5 } });
                        showEventCard("æ¢¦å¢ƒä½è¯­", "fa-kiss", "TAåœ¨ä½ è€³è¾¹ä½è¯­äº†æ¢¦ä¸­çš„ç»†èŠ‚ï¼Œä½ ä»¬çš„å…³ç³»æ›´åŠ äº²å¯†ã€‚");
                    }},
                    { htmlContent: "ã€ä¸€ç¬‘ç½®ä¹‹ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 2 } });
                        showEventCard("æ—¥æœ‰æ‰€æ€", "fa-smile", "ä½ ç¬‘ç€è¯´è¿™ä¸è¿‡æ˜¯æ—¥æœ‰æ‰€æ€å¤œæœ‰æ‰€æ¢¦ç½¢äº†ã€‚");
                    }}
                ]
            };
        }
    },
    lover_family_pressure: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            return {
                title: "å®¶ä¸­çš„å‹åŠ›", icon: "fa-users", description: `æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> æœ€è¿‘çœ‹èµ·æ¥å¿ƒäº‹é‡é‡ï¼ŒåŸæ¥æ˜¯å®¶ä¸­æ­£åœ¨ä¸ºTAå®‰æ’å©šäº‹ã€‚`,
                options: [
                    { htmlContent: "ã€æ‰¿è¯ºä¼šç»™TAä¸€ä¸ªååˆ†ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: 15, devotion: 10 } });
                        showEventCard("æµ·èª“å±±ç›Ÿ", "fa-ring", "ä½ çš„æ‰¿è¯ºè®©TAæš‚æ—¶å®‰å¿ƒã€‚");
                    }},
                    { htmlContent: "ã€åŠTAä¸ºäº†å®¶æ—å¦¥åã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -20, devotion: -15 } });
                        showEventCard("æ— è¨€çš„ç»“å±€", "fa-heart-broken", "ä½ çš„åŠè¯´è®©TAå½»åº•å¿ƒç¢ï¼Œä½ ä»¬çš„å…³ç³»èµ°åˆ°äº†å°½å¤´ã€‚");
                        // å…³ç³»ç ´è£‚é€»è¾‘
                        delete gs.social.relationships[lover.id];
                        gs.social.secretLovers = gs.social.secretLovers.filter(id => id !== lover.id);
                    }}
                ]
            };
        }
    },
    // ç»“ä¹‰äº’åŠ¨
    sworn_sibling_drink: {
        type: 'sworn',
        condition: (gs) => gs.social.swornSiblings && gs.social.swornSiblings.length > 0,
        generate: (gs) => {
            const sibling = gs.npcs[getRandomElement(gs.social.swornSiblings)];
            return {
                title: "é‡‘å…°ä¹‹çº¦", icon: "fa-wine-glass-alt", description: `ä½ çš„ç»“ä¹‰å…„å¼Ÿ/å§å¦¹ <strong class="highlight-npc">${sibling.name}</strong> é‚€ä½ ä¸€åŒå»é…’æ¥¼ç—›é¥®ä¸€ç•ªã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶èµ´çº¦ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: sibling.id, favor: 10 }, attributes: { health: -2, charm: 2 } });
                        showEventCard("ä¸é†‰ä¸å½’", "fa-glass-cheers", "ä½ ä»¬ä¸€é†‰æ–¹ä¼‘ï¼Œè¯‰è¯´è¡·è‚ ã€‚");
                    }},
                    { htmlContent: "ã€å©‰è¨€è°¢ç»ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: sibling.id, favor: -3 } });
                        showEventCard("ä¸‹æ¬¡å†çº¦", "fa-times", "ä½ å› æ•…è°¢ç»ï¼Œå¯¹æ–¹è¡¨ç¤ºç†è§£ã€‚");
                    }}
                ]
            };
        }
    },
    sworn_sibling_trouble: {
        type: 'sworn',
        condition: (gs) => gs.social.swornSiblings && gs.social.swornSiblings.length > 0,
        generate: (gs) => {
            const sibling = gs.npcs[getRandomElement(gs.social.swornSiblings)];
            return {
                title: "ä¹‰å…„/å¦¹çš„éº»çƒ¦", icon: "fa-exclamation-triangle", description: `ä½ çš„ç»“ä¹‰å…„å¼Ÿ/å§å¦¹ <strong class="highlight-npc">${sibling.name}</strong> åœ¨å¤–æƒ¹äº†éº»çƒ¦ï¼Œè¢«ä»‡å®¶è¿½æ€ï¼Œå‘ä½ æ±‚åŠ©ã€‚`,
                options: [
                    { htmlContent: "ã€å€¾åŠ›ç›¸åŠ©ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: sibling.id, favor: 25, devotion: 15 }, attributes: { health: -10, martial: 5 } });
                        showEventCard("ä¸¤è‚‹æ’åˆ€", "fa-shield-alt", "ä½ ä¸ºå…„å¼Ÿ/å§å¦¹å‡ºå¤´ï¼Œè™½ç„¶å—äº†äº›ä¼¤ï¼Œä½†ä½ ä»¬çš„æƒ…è°Šæ›´åŠ æ·±åšã€‚");
                    }},
                    { htmlContent: "ã€å‡è£…ä¸çŸ¥ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: sibling.id, favor: -30, devotion: -20 } });
                        showEventCard("æ˜å“²ä¿èº«", "fa-user-shield", "ä½ é€‰æ‹©äº†è¢–æ‰‹æ—è§‚ï¼Œå¯¹æ–¹å¯¹ä½ å¤±æœ›é€é¡¶ã€‚");
                    }}
                ]
            };
        }
    },
    sworn_sibling_opportunity: {
        type: 'sworn',
        condition: (gs) => gs.social.swornSiblings && gs.social.swornSiblings.length > 0,
        generate: (gs) => {
            const sibling = gs.npcs[getRandomElement(gs.social.swornSiblings)];
            return {
                title: "å…±åŒçš„æœºé‡", icon: "fa-handshake", description: `ä½ çš„ç»“ä¹‰å…„å¼Ÿ/å§å¦¹ <strong class="highlight-npc">${sibling.name}</strong> å‘ç°äº†ä¸€ä¸ªå•†ä¸š/äº‹ä¸šä¸Šçš„å¥½æœºä¼šï¼Œé‚€è¯·ä½ ä¸€åŒå‚ä¸ã€‚`,
                options: [
                    { htmlContent: "ã€å…±åŒæŠ•èµ„ã€‘", disabled: gs.finances.wealth < 2000, callback: () => {
                        applyEffects({ wealth: -2000 });
                        if(Math.random() < 0.7) {
                            applyEffects({ wealth: 4000 });
                            showEventCard("åˆä½œå…±èµ¢", "fa-chart-pie", "ä½ ä»¬çš„åˆä½œéå¸¸æˆåŠŸï¼Œè·å¾—äº†åŒå€å›æŠ¥ï¼");
                        } else {
                            showEventCard("æŠ•èµ„å¤±åˆ©", "fa-chart-area", "ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ¬¡æŠ•èµ„å¤±è´¥äº†ã€‚");
                        }
                    }},
                    { htmlContent: "ã€è°¢ç»å¥½æ„ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: sibling.id, favor: -5 } });
                        showEventCard("é”™å¤±è‰¯æœº", "fa-times", "ä½ è°¢ç»äº†å¯¹æ–¹çš„å¥½æ„ã€‚");
                    }}
                ]
            };
        }
    },
    // NPC äº’åŠ¨
    npc_gift: {
        type: 'npc',
        condition: (gs) => Object.keys(gs.social.relationships).length > 0,
        generate: (gs) => {
            const friendId = getRandomElement(Object.keys(gs.social.relationships));
            const friend = gs.npcs[friendId];
            const giftAmount = 50 + Math.floor(friend.favor);
            return {
                title: "å‹äººèµ ç¤¼", icon: "fa-box-open", description: `ä½ çš„å‹äºº <strong class="highlight-npc">${friend.name}</strong> å‰æ¥æ‹œè®¿ï¼Œå¹¶ä¸ºä½ å¸¦æ¥ä¸€ä»½ä»·å€¼çº¦ <span class="value">${giftAmount}</span> ä¸¤çš„è–„ç¤¼ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶æ”¶ä¸‹ã€‘", callback: () => {
                        applyEffects({ wealth: giftAmount, relationship: { targetId: friend.id, favor: 5 } });
                        showEventCard("ç¤¼å°šå¾€æ¥", "fa-handshake", "ä½ æ”¶ä¸‹äº†ç¤¼ç‰©ï¼Œå¹¶ä¸å¯¹æ–¹ç›¸è°ˆç”šæ¬¢ã€‚");
                    }},
                    { htmlContent: "ã€å›èµ ç­‰ä»·ç¤¼ç‰©ã€‘", disabled: gs.finances.wealth < giftAmount, callback: () => {
                         applyEffects({ relationship: { targetId: friend.id, favor: 10 } });
                         showEventCard("å›å­ä¹‹äº¤", "fa-balance-scale", "ä½ çš„ä¸¾åŠ¨è®©å¯¹æ–¹é¢‡ä¸ºæ¬£èµã€‚");
                    }}
                ]
            };
        }
    },
    npc_invitation: {
        type: 'npc',
        condition: (gs) => Object.keys(gs.social.relationships).length > 1,
        generate: (gs) => {
            const friend = gs.npcs[getRandomElement(Object.keys(gs.social.relationships))];
            return {
                title: "å‹äººé‚€çº¦", icon: "fa-envelope-open-text", description: `å‹äºº <strong class="highlight-npc">${friend.name}</strong> é‚€è¯·ä½ å‚åŠ ä¸€åœºæ–‡ä¼šé›…é›†ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶èµ´çº¦ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: friend.id, favor: 5 }, attributes: { charm: 2, talent: 2 } });
                        showEventCard("é«˜æœ‹æ»¡åº§", "fa-users", "ä½ åœ¨é›…é›†ä¸Šç»“è¯†äº†æ–°æœ‹å‹ï¼Œæ”¶è·é¢‡ä¸°ã€‚");
                    }},
                    { htmlContent: "ã€æ‰˜æ•…æ¨è¾ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: friend.id, favor: -2 } });
                        showEventCard("åˆ†èº«ä¹æœ¯", "fa-bed", "ä½ å› æ•…æœªèƒ½èµ´çº¦ã€‚");
                    }}
                ]
            };
        }
    },
    npc_seek_help: {
        type: 'npc',
        condition: (gs) => gs.career.path && Object.keys(gs.social.relationships).length > 0,
        generate: (gs) => {
            const friend = gs.npcs[getRandomElement(Object.keys(gs.social.relationships))];
            return {
                title: "å‹äººæ±‚åŠ©", icon: "fa-question-circle", description: `ä½ çš„å‹äºº <strong class="highlight-npc">${friend.name}</strong> åœ¨äº‹ä¸šä¸Šé‡åˆ°äº†å›°éš¾ï¼Œå‰æ¥å‘ä½ æ±‚åŠ©ã€‚`,
                options: [
                    { htmlContent: "ã€å€¾å›Šç›¸åŠ©ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: friend.id, favor: 15, devotion: 10 }, attributes: { reputation: 5 } });
                        showEventCard("é›ªä¸­é€ç‚­", "fa-hands-helping", "ä½ å¸®åŠ©å‹äººæ¸¡è¿‡äº†éš¾å…³ï¼Œä½ ä»¬çš„å‹è°Šæ›´åŠ ç‰¢å›ºã€‚");
                    }},
                    { htmlContent: "ã€çˆ±è«èƒ½åŠ©ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: friend.id, favor: -8 } });
                        showEventCard("å¿ƒæœ‰ä½™åŠ›ä¸è¶³", "fa-times", "ä½ è¡¨ç¤ºæ— èƒ½ä¸ºåŠ›ï¼Œå¯¹æ–¹æœ‰äº›å¤±æœ›ã€‚");
                    }}
                ]
            };
        }
    },
    // èŒä¸šçªå‘äº‹ä»¶
     career_emergency: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level > 1,
        generate: (gs) => {
            const careerName = PROFESSION_DATA[gs.career.path].name;
            return {
                title: `${careerName}çªå‘äº‹ä»¶`, icon: "fa-exclamation-triangle", description: `ä½ çš„ä¸Šå¸äº¤ç»™ä½ ä¸€ä¸ªç´§æ€¥ä¸”æ£˜æ‰‹çš„ä»»åŠ¡ï¼Œè¦æ±‚ä½ åœ¨çŸ­æ—¶é—´å†…å®Œæˆï¼Œæ­¤äº‹å…³ç³»åˆ°ä½ çš„è€ƒè¯„ã€‚`,
                options: [
                    { htmlContent: "ã€å…¨åŠ›ä»¥èµ´ã€‘", callback: () => {
                        gs.career.performance += 30;
                        applyEffects({ attributes: { health: -5 } });
                        showEventCard("è¿éš¾è€Œä¸Š", "fa-chart-line", "ä½ å‡ºè‰²åœ°å®Œæˆäº†ä»»åŠ¡ï¼Œè·å¾—äº†ä¸Šå¸çš„èµèµã€‚");
                    }},
                    { htmlContent: "ã€å¯»æ±‚åŒåƒšå¸®åŠ©ã€‘", callback: () => {
                        gs.career.performance += 15;
                        showEventCard("å›¢é˜Ÿåˆä½œ", "fa-users", "åœ¨åŒåƒšçš„å¸®åŠ©ä¸‹ï¼Œä½ ä»¬é¡ºåˆ©å®Œæˆäº†ä»»åŠ¡ã€‚");
                    }},
                    { htmlContent: "ã€æ•·è¡äº†äº‹ã€‘", callback: () => {
                        gs.career.performance -= 20;
                        showEventCard("å¾—è¿‡ä¸”è¿‡", "fa-thumbs-down", "ä½ çš„æ•·è¡æ€åº¦è®©ä¸Šå¸éå¸¸ä¸æ»¡ã€‚");
                    }}
                ]
            };
        }
    },
    career_competition: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level > 2,
        generate: (gs) => {
            return {
                title: "èŒåœºç«äº‰", icon: "fa-user-tie", description: `ä¸€ä½åŒåƒšä¸ä½ ç«äº‰åŒä¸€ä¸ªæ™‹å‡åé¢ï¼Œå¯¹æ–¹ä¼¼ä¹åœ¨æš—ä¸­ç»™ä½ ä¸‹ç»Šå­ã€‚`,
                options: [
                    { htmlContent: "ã€ç”¨å®åŠ›è¯´è¯ã€‘", callback: () => {
                        gs.career.performance += 25;
                        showEventCard("å®åŠ›ç¢¾å‹", "fa-award", "ä½ ç”¨å‡ºè‰²çš„ä¸šç»©å›åº”äº†æ‰€æœ‰è´¨ç–‘ã€‚");
                    }},
                    { htmlContent: "ã€ä»¥ç‰™è¿˜ç‰™ã€‘", callback: () => {
                        if (gs.player.attributes.wisdom > 70) {
                            showEventCard("åå°†ä¸€å†›", "fa-chess-knight", "ä½ å·§å¦™åœ°è¯†ç ´å¹¶åå‡»äº†å¯¹æ–¹çš„è®¡è°‹ã€‚");
                        } else {
                            gs.career.performance -= 15;
                            showEventCard("å¼„å·§æˆæ‹™", "fa-frown", "ä½ çš„è®¡è°‹è¢«è¯†ç ´ï¼Œåè€Œè®©è‡ªå·±é™·å…¥è¢«åŠ¨ã€‚");
                        }
                    }}
                ]
            };
        }
    },
    career_windfall: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "æ„å¤–ä¹‹å–œ", icon: "fa-gift", description: `ä½ å› ä¸€é¡¹å‡ºè‰²çš„å·¥ä½œè¡¨ç°ï¼Œè·å¾—äº†ä¸Šå¸çš„é¢å¤–å˜‰å¥–ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶æ¥å—ã€‘", callback: () => {
                        applyEffects({ wealth: 500 });
                        gs.career.performance += 10;
                        showEventCard("å¤©é“é…¬å‹¤", "fa-money-bill", "ä½ è·å¾—äº†500ä¸¤çš„é¢å¤–å¥–èµã€‚");
                    }},
                    { htmlContent: "ã€ä¸å›¢é˜Ÿåˆ†äº«ã€‘", callback: () => {
                        applyEffects({ wealth: 250, attributes: { charm: 5, virtue: 5 } });
                        gs.career.performance += 10;
                        showEventCard("å›¢é˜Ÿç²¾ç¥", "fa-users", "ä½ å°†ä¸€åŠå¥–èµåˆ†ç»™äº†å›¢é˜Ÿï¼Œèµ¢å¾—äº†äººå¿ƒã€‚");
                    }}
                ]
            };
        }
    },

    // â–¼â–¼â–¼ ã€æ–°å¢20ä¸ªèŒä¸šç”Ÿæ¶¯äº‹ä»¶ã€‘ â–¼â–¼â–¼
    career_credit_thief: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 2,
        generate: (gs) => {
            return {
                title: "åŠŸåŠ³è¢«çªƒ", icon: "fa-user-ninja", description: `ä½ è¾›è‹¦å®Œæˆçš„ä¸€ä»½æ–‡ä¹¦/é¡¹ç›®ï¼Œè¢«ä¸€ä½åŒåƒšæŠ¢å…ˆä¸€æ­¥å‘ˆæŠ¥ç»™ä¸Šå¸ï¼Œå¹¶æš—ç¤ºè¿™æ˜¯ä»–ç‹¬ç«‹å®Œæˆçš„ã€‚`,
                options: [
                    { htmlContent: "ã€å½“ä¼—æ­ç©¿ã€‘", callback: () => {
                        if (gs.player.attributes.charm > 60) {
                            gs.career.performance += 20;
                            showEventCard("æ°´è½çŸ³å‡º", "fa-check-circle", "ä½ çš„è¨€è¾æ³åˆ‡ï¼Œä¸Šå¸é€‰æ‹©ç›¸ä¿¡ä½ ï¼Œå¹¶æ–¥è´£äº†å¯¹æ–¹ã€‚");
                        } else {
                            gs.career.performance -= 10;
                            showEventCard("åè¢«æŒ‡è´£", "fa-times-circle", "ä½ å› è¨€è¾ä¸å½“ï¼Œåè¢«ä¸Šå¸è®¤ä¸ºæ˜¯åœ¨å«‰å¦’åŒåƒšã€æ¬å¼„æ˜¯éã€‚");
                        }
                    }},
                    { htmlContent: "ã€ç§ä¸‹å‘ä¸Šå¸è¯´æ˜ã€‘", callback: () => {
                        gs.career.performance += 15;
                        showEventCard("ç§ä¸‹é™ˆæƒ…", "fa-envelope-open-text", "ä½ ç§ä¸‹å‘ä¸Šå¸è¯´æ˜äº†æƒ…å†µï¼Œä¸Šå¸è™½æœªæ˜è¨€ï¼Œä½†å¿ƒä¸­å·²æœ‰æ•°ã€‚");
                    }},
                    { htmlContent: "ã€éšå¿ä¸å‘ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 2 } });
                        showEventCard("å›å­æŠ¥ä»‡", "fa-book", "ä½ é€‰æ‹©éšå¿ï¼Œå›å­æŠ¥ä»‡ï¼Œåå¹´ä¸æ™šã€‚æ­¤äº‹è®©ä½ å¿ƒæ™ºæ›´ä¸ºæ²‰ç¨³ã€‚");
                    }}
                ]
            };
        }
    },
    career_spreading_rumors: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 3,
        generate: (gs) => {
            return {
                title: "æµè¨€èœšè¯­", icon: "fa-wind", description: `æœ‰ä¼ è¨€è¯´ä½ ç§ç”Ÿæ´»ä¸æ£€ç‚¹ï¼Œåˆ©ç”¨ä¸æ­£å½“å…³ç³»æ‰å¾—ä»¥æ™‹å‡ã€‚è¿™ä¸¥é‡å½±å“äº†ä½ çš„å£°èª‰ã€‚`,
                options: [
                    { htmlContent: "ã€æ¸…è€…è‡ªæ¸…ã€‘", callback: () => {
                        gs.career.performance -= 5;
                        showEventCard("æˆ‘è¡Œæˆ‘ç´ ", "fa-leaf", "ä½ å¯¹æ­¤ä¸å±‘ä¸€é¡¾ï¼Œä½†è¿™è®©æµè¨€æ„ˆæ¼”æ„ˆçƒˆï¼Œå½±å“äº†ä½ çš„è€ƒè¯„ã€‚");
                    }},
                    { htmlContent: "ã€è¿½æŸ¥æºå¤´ã€‘", req: { wisdom: 80 }, callback: () => {
                        applyEffects({ reputation: 10 });
                        showEventCard("æ°´è½çŸ³å‡º", "fa-search", "ä½ æŸ¥å‡ºæ˜¯ç«äº‰å¯¹æ‰‹åœ¨èƒŒåæé¬¼ï¼Œå¹¶æˆåŠŸæ¾„æ¸…äº†äº‹å®ï¼Œå£°æœ›ä¸é™åå‡ã€‚");
                    }}
                ]
            };
        }
    },
    career_faction_choice: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 4,
        generate: (gs) => {
            return {
                title: "æ´¾ç³»ä¹‹äº‰", icon: "fa-users-cog", description: `ä½ æ‰€åœ¨è¡™é—¨çš„ä¸¤ä½é«˜å®˜ç´ æ¥ä¸å’Œï¼Œè¿‘æ¥æ–—äº‰æ„ˆå‘æ¿€çƒˆï¼ŒåŒæ–¹éƒ½åœ¨æ‹‰æ‹¢ä½ ã€‚`,
                options: [
                    { htmlContent: "ã€é€‰æ‹©å®åŠ›æ›´å¼ºçš„ä¸€æ–¹ã€‘", callback: () => {
                        gs.career.performance += 20;
                        showEventCard("è‰¯ç¦½æ‹©æœ¨", "fa-sitemap", "ä½ é€‰æ‹©åŠ å…¥å¼ºåŠ¿ä¸€æ–¹ï¼ŒçŸ­æ—¶é—´å†…è·å¾—äº†ä¸å°‘å¥½å¤„ï¼Œä½†ä¹Ÿå¾—ç½ªäº†å¦ä¸€æ–¹ã€‚");
                    }},
                    { htmlContent: "ã€ä¿æŒä¸­ç«‹ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 3 } });
                        showEventCard("æ˜å“²ä¿èº«", "fa-user-shield", "ä½ é€‰æ‹©ä¿æŒä¸­ç«‹ï¼Œè™½ç„¶å®‰å…¨ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åŒæ–¹åŒæ—¶æ’æŒ¤ã€‚");
                    }}
                ]
            };
        }
    },
    career_scapegoat: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 3,
        generate: (gs) => {
            return {
                title: "ä»£äººå—è¿‡", icon: "fa-exclamation-triangle", description: `ä¸Šå¸çš„ä¸€ä¸ªå†³ç­–å¤±è¯¯å¯¼è‡´äº†é‡å¤§æŸå¤±ï¼Œä»–æš—ç¤ºä½ å°†æ­¤äº‹æ‰›ä¸‹æ¥ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸ºä¸Šå¸èƒŒé”…ã€‘", callback: () => {
                        gs.career.performance -= 30;
                        showEventCard("å¿è¾±è´Ÿé‡", "fa-user-secret", "ä½ æ‰›ä¸‹äº†æ‰€æœ‰è´£ä»»ï¼ŒåŠŸç»©å¤§é™ï¼Œä½†ä¸Šå¸å¯¹ä½ è®¸ä¸‹æ‰¿è¯ºï¼Œæ—¥åå¿…æœ‰é‡æŠ¥ã€‚");
                    }},
                    { htmlContent: "ã€æ‹’ç»èƒŒé”…ã€‘", callback: () => {
                        showEventCard("åšå®ˆåº•çº¿", "fa-gavel", "ä½ æ‹’ç»èƒŒé”…ï¼Œè™½ç„¶ä¿ä½äº†è‡ªå·±çš„æ¸…ç™½ï¼Œä½†ä¸ä¸Šå¸çš„å…³ç³»å½»åº•ç ´è£‚ã€‚");
                    }}
                ]
            };
        }
    },
    career_training_opportunity: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "æ·±é€ æœºä¼š", icon: "fa-graduation-cap", description: `æœå»·/è¡Œä¼šæä¾›äº†ä¸€ä¸ªå‰å¾€å¤–åœ°å­¦ä¹ å…ˆè¿›æŠ€æœ¯çš„æœºä¼šï¼Œä¸ºæœŸåŠå¹´ï¼Œä½†ä¼šæš‚æ—¶ç¦»å¼€æƒåŠ›ä¸­å¿ƒã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶å‰å¾€ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 5, talent: 5 } });
                        showEventCard("å­¦æˆå½’æ¥", "fa-book-reader", "åŠå¹´çš„å­¦ä¹ è®©ä½ å—ç›ŠåŒªæµ…ï¼Œè™½ç„¶è¿œç¦»äº†ä¸­å¿ƒï¼Œä½†ä½ çš„èƒ½åŠ›è·å¾—äº†å®è´¨æ€§çš„æå‡ã€‚");
                    }},
                    { htmlContent: "ã€æ”¾å¼ƒæœºä¼šã€‘", callback: () => {
                        showEventCard("å›ºå®ˆé˜µåœ°", "fa-anchor", "ä½ è®¤ä¸ºäººè„‰æ¯”æŠ€æœ¯æ›´é‡è¦ï¼Œé€‰æ‹©ç•™å®ˆäº¬åŸã€‚");
                    }}
                ]
            };
        }
    },
    career_cross_department_project: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 4,
        generate: (gs) => {
            return {
                title: "è·¨éƒ¨åˆä½œ", icon: "fa-handshake", description: `ä¸€ä¸ªç”±å·¥éƒ¨å’Œç¤¼éƒ¨è”åˆä¸¾åŠçš„é‡è¦é¡¹ç›®æ­£åœ¨æ‹›å‹Ÿäººæ‰‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå±•ç¤ºèƒ½åŠ›çš„å¥½æœºä¼šã€‚`,
                options: [
                    { htmlContent: "ã€ä¸»åŠ¨è¯·ç¼¨ã€‘", callback: () => {
                        gs.career.performance += 25;
                        applyEffects({ reputation: 10 });
                        showEventCard("å´­éœ²å¤´è§’", "fa-star", "ä½ åœ¨é¡¹ç›®ä¸­çš„å‡ºè‰²è¡¨ç°è·å¾—äº†å¤šæ–¹èµèµï¼Œå£°æœ›å’ŒåŠŸç»©éƒ½å¤§å¹…æå‡ã€‚");
                    }},
                    { htmlContent: "ã€ä¿æŒè§‚æœ›ã€‘", callback: () => {
                        showEventCard("è°¨æ…è¡Œäº‹", "fa-eye", "ä½ è®¤ä¸ºæ­¤äº‹ç‰µæ¶‰è¿‡å¹¿ï¼Œå†³å®šé™è§‚å…¶å˜ã€‚");
                    }}
                ]
            };
        }
    },
    career_mentor_junior: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 5,
        generate: (gs) => {
            return {
                title: "æŒ‡å¯¼æ–°äºº", icon: "fa-chalkboard-teacher", description: `ä¸Šå¸è®©ä½ å¸¦ä¸€å¸¦æ–°æ¥çš„åŒåƒšï¼Œæ­¤äººè™½æœ‰æ‰åä½†æƒæ‰å‚²ç‰©ï¼Œååˆ†éš¾å¸¦ã€‚`,
                options: [
                    { htmlContent: "ã€æ‚‰å¿ƒæ•™å¯¼ã€‘", callback: () => {
                        if (gs.player.attributes.charm > 80) {
                            applyEffects({ attributes: { virtue: 5 } });
                            showEventCard("æ¡ƒæä¸è¨€", "fa-user-plus", "ä½ çš„è€å¿ƒå’Œèƒ½åŠ›æœ€ç»ˆæŠ˜æœäº†æ–°äººï¼ŒTAæ—¥åæˆä¸ºäº†ä½ åœ¨è¡™é—¨çš„ä¸€å¤§åŠ©åŠ›ã€‚");
                        } else {
                            showEventCard("ä¸è¢«é¢†æƒ…", "fa-user-alt-slash", "ä½ çš„æ•™å¯¼è¢«å¯¹æ–¹è®¤ä¸ºæ˜¯å¤šç®¡é—²äº‹ï¼ŒåƒåŠ›ä¸è®¨å¥½ã€‚");
                        }
                    }},
                    { htmlContent: "ã€ä»»å…¶è‡ªç”Ÿè‡ªç­ã€‘", callback: () => {
                        showEventCard("æ”¾ä»»è‡ªæµ", "fa-times", "ä½ æ²¡æœ‰åœ¨ä»–èº«ä¸Šæµªè´¹æ—¶é—´ã€‚");
                    }}
                ]
            };
        }
    },
    career_networking_banquet: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "é‡è¦å®´å¸­", icon: "fa-glass-cheers", description: `ä¸€ä½æƒè´µä¸¾åŠå®´å¸­ï¼Œå¹¿é‚€å®¾å®¢ï¼Œè¿™æ˜¯ç»“äº¤äººè„‰çš„ç»ä½³æœºä¼šã€‚`,
                options: [
                    { htmlContent: "ã€ç››è£…å‡ºå¸­ã€‘", disabled: gs.finances.wealth < 200, callback: () => {
                        applyEffects({ wealth: -200, attributes: { charm: 4, reputation: 5 } });
                        showEventCard("é«˜æœ‹æ»¡åº§", "fa-users", "ä½ åœ¨å®´å¸­ä¸Šç»“è¯†äº†å‡ ä½æœ‰åˆ†é‡çš„äººç‰©ï¼Œæ‹“å±•äº†äººè„‰ã€‚");
                    }},
                    { htmlContent: "ã€ç§°ç—…ä¸å»ã€‘", callback: () => {
                        showEventCard("é”™å¤±è‰¯æœº", "fa-bed", "ä½ å› æ•…æœªèƒ½èµ´çº¦ã€‚");
                    }}
                ]
            };
        }
    },
    career_solve_old_problem: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 3,
        generate: (gs) => {
            return {
                title: "é™ˆå¹´æ—§æ¡ˆ", icon: "fa-folder-open", description: `ä½ åœ¨æ•´ç†å·å®—æ—¶ï¼Œå‘ç°äº†ä¸€æ¡©å›°æ‰°è¡™é—¨å¤šå¹´çš„æ‚¬æ¡ˆ/éš¾é¢˜ï¼Œä¼¼ä¹æœ‰æ–°çš„çªç ´å£ã€‚`,
                options: [
                    { htmlContent: "ã€æŠ•å…¥ç²¾åŠ›ç ”ç©¶ã€‘", callback: () => {
                        if (gs.player.attributes.wisdom > 90) {
                            gs.career.performance += 40;
                            showEventCard("ä¸€é¸£æƒŠäºº", "fa-lightbulb-on", "ä½ ç«Ÿç„¶çœŸçš„è§£å†³äº†è¿™ä¸ªéš¾é¢˜ï¼ä¸Šå¸å¯¹ä½ åˆ®ç›®ç›¸çœ‹ï¼ŒåŠŸç»©æš´æ¶¨ï¼");
                        } else {
                            showEventCard("æ¯«æ— å¤´ç»ª", "fa-brain", "ä½ ç ”ç©¶äº†åŠå¤©ï¼Œè¿˜æ˜¯ä¸€æ— æ‰€è·ã€‚");
                        }
                    }}
                ]
            };
        }
    },
    career_moral_compromise: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "é“å¾·å›°å¢ƒ", icon: "fa-balance-scale-left", description: `ä¸Šå¸è¦æ±‚ä½ åœ¨ä¸€ä»½é‡è¦çš„æŠ¥å‘Šä¸­ï¼Œä¸ºä»–çš„ä¸€ä½äº²ä¿¡â€œç¾è¨€å‡ å¥â€ï¼Œä½†è¿™æœ‰è¿äº‹å®ã€‚`,
                options: [
                    { htmlContent: "ã€éµä»ä¸Šæ„ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: -10 } });
                        gs.career.performance += 10;
                        showEventCard("å·¦å³é€¢æº", "fa-user-check", "ä½ å·§å¦™åœ°å®Œæˆäº†ä»»åŠ¡ï¼Œä¸Šå¸å¾ˆæ»¡æ„ï¼Œä½†ä½ çš„å“å¾·æœ‰æ‰€äºæŸã€‚");
                    }},
                    { htmlContent: "ã€ä¸¥è¯æ‹’ç»ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 10 } });
                        gs.career.performance -= 10;
                        showEventCard("é£éª¨", "fa-gavel", "ä½ åšå®ˆäº†åŸåˆ™ï¼Œä½†å› æ­¤å¾—ç½ªäº†ä¸Šå¸ã€‚");
                    }}
                ]
            };
        }
    },
    career_bribe_offered: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 2,
        generate: (gs) => {
            return {
                title: "ç³–è¡£ç‚®å¼¹", icon: "fa-money-bill-wave", description: `ä¸€ä½å¯Œå•†ç§ä¸‹æ‹œè®¿ï¼Œé€ä¸Šä¸€ä»½åšç¤¼ï¼ˆä»·å€¼2000ä¸¤ï¼‰ï¼Œå¸Œæœ›ä½ èƒ½åœ¨è¿‘æœŸçš„æ‹›æ ‡/å®¡æ‰¹ä¸­è¡Œä¸ªæ–¹ä¾¿ã€‚`,
                options: [
                    { htmlContent: "ã€æ¬£ç„¶æ”¶ä¸‹ã€‘", callback: () => {
                        applyEffects({ wealth: 2000, attributes: { virtue: -15 } });
                        showEventCard("ä¸€å¿µä¹‹å·®", "fa-exclamation-circle", "ä½ æ”¶ä¸‹äº†è¿™ä»½åšç¤¼ã€‚æ­¤äº‹è‹¥è´¥éœ²ï¼Œåæœä¸å ªè®¾æƒ³ã€‚");
                    }},
                    { htmlContent: "ã€é€€å›å¹¶è­¦å‘Šã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 10 } });
                        showEventCard("ä¹‰æ­£è¾ä¸¥", "fa-shield-alt", "ä½ å°†ç¤¼ç‰©é€€å›å¹¶ä¸¥å‰è­¦å‘Šäº†å¯¹æ–¹ï¼Œç»´æŠ¤äº†å®˜å£°ã€‚");
                    }}
                ]
            };
        }
    },
    career_witness_corruption: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "ç›®ç¹ä¸æ³•", icon: "fa-eye", description: `ä½ æ— æ„ä¸­æ’è§ä¸€ä½åŒåƒšæ­£åœ¨æ¥å—è´¿èµ‚ã€‚`,
                options: [
                    { htmlContent: "ã€å‡è£…æ²¡çœ‹è§ã€‘", callback: () => {
                        showEventCard("æ˜å“²ä¿èº«", "fa-user-shield", "ä½ é€‰æ‹©å¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹ã€‚");
                    }},
                    { htmlContent: "ã€åŒ¿åä¸¾æŠ¥ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 5 } });
                        showEventCard("æš—ä¸­è¡Œäº‹", "fa-user-secret", "ä½ åŒ¿åä¸¾æŠ¥äº†æ­¤äº‹ï¼Œé™å¾…ç»“æœã€‚");
                    }}
                ]
            };
        }
    },
    career_family_vs_work: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            const familyMember = gs.npcs[gs.family.members.motherId] || gs.npcs[gs.family.members.fatherId];
            return {
                title: "å¿ å­ä¸¤éš¾", icon: "fa-house-user", description: `å®¶ä¸­çš„äº²äºº(<strong class="highlight-npc">${familyMember.name}</strong>)çªç„¶ç—…é‡ï¼Œè€Œä½ æ‰‹å¤´æ­£æœ‰ä¸€é¡¹åä¸‡ç«æ€¥çš„å…¬åŠ¡ã€‚`,
                options: [
                    { htmlContent: "ã€å›å®¶ä¾ç–¾ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: familyMember.id, favor: 15 }, attributes: { virtue: 5 } });
                        gs.career.performance -= 15;
                        showEventCard("äº²æƒ…ä¸ºé‡", "fa-heart", "ä½ é€‰æ‹©äº†å®¶äººï¼Œä½†è€½è¯¯äº†å…¬åŠ¡ï¼ŒåŠŸç»©ä¸‹é™ã€‚");
                    }},
                    { htmlContent: "ã€ä»¥å…¬åŠ¡ä¸ºé‡ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: familyMember.id, favor: -10 } });
                        gs.career.performance += 15;
                        showEventCard("å¤§å…¬æ— ç§", "fa-briefcase", "ä½ é€‰æ‹©äº†å…¬åŠ¡ï¼Œè™½ç„¶å®Œæˆäº†ä»»åŠ¡ï¼Œä½†äº²äººå¯¹ä½ é¢‡æœ‰æ€¨è¨€ã€‚");
                    }}
                ]
            };
        }
    },
    career_subordinate_mistake: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 4,
        generate: (gs) => {
            return {
                title: "ä¸‹å±çš„å¤±è¯¯", icon: "fa-user-cog", description: `ä½ çš„ä¸€ä½ä¸‹å±çŠ¯äº†ä¸¥é‡é”™è¯¯ï¼Œå¯èƒ½å½±å“æ•´ä¸ªéƒ¨é—¨çš„è€ƒè¯„ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸ºå…¶æ‰¿æ‹…è´£ä»»ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 5, charm: 3 } });
                        gs.career.performance -= 10;
                        showEventCard("å¾¡ä¸‹æœ‰é“", "fa-users", "ä½ ä¸ºä¸‹å±æ‰¿æ‹…äº†è´£ä»»ï¼Œè™½ç„¶åŠŸç»©å—æŸï¼Œå´èµ¢å¾—äº†æ‰€æœ‰ä¸‹å±çš„å¿ å¿ƒã€‚");
                    }},
                    { htmlContent: "ã€è®©å…¶è‡ªè¡Œæ‰¿æ‹…ã€‘", callback: () => {
                        showEventCard("å…¬äº‹å…¬åŠ", "fa-gavel", "ä½ è®©çŠ¯é”™çš„ä¸‹å±è‡ªå·±æ‰¿æ‹…äº†åæœã€‚");
                    }}
                ]
            };
        }
    },
    career_superior_personal_request: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "ä¸Šå¸çš„ç§äº‹", icon: "fa-user-tie", description: `ä½ çš„ä¸Šå¸ç§ä¸‹æ‰¾åˆ°ä½ ï¼Œå¸Œæœ›ä½ èƒ½å¸®ä»–å¤„ç†ä¸€ä»¶ä¸å…¬åŠ¡æ— å…³çš„ç§äº‹ã€‚`,
                options: [
                    { htmlContent: "ã€æ…¨ç„¶åº”å…ã€‘", callback: () => {
                        showEventCard("é›ªä¸­é€ç‚­", "fa-hands-helping", "ä½ å¸®ä¸Šå¸è§£å†³äº†ç§äº‹ï¼Œä»–æ¬ äº†ä½ ä¸€ä»½äººæƒ…ã€‚");
                    }},
                    { htmlContent: "ã€å©‰è¨€æ‹’ç»ã€‘", callback: () => {
                        showEventCard("å…¬ç§åˆ†æ˜", "fa-balance-scale-right", "ä½ ä»¥â€œå…¬ç§åˆ†æ˜â€ä¸ºç”±æ‹’ç»äº†ï¼Œä¸Šå¸è™½æœªå¤šè¨€ï¼Œä½†æ˜¾ç„¶ä¸æ‚¦ã€‚");
                    }}
                ]
            };
        }
    },
    career_unpopular_task: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 2,
        generate: (gs) => {
            return {
                title: "çƒ«æ‰‹å±±èŠ‹", icon: "fa-bomb", description: `è¡™é—¨é‡Œæœ‰ä¸€é¡¹è´¹åŠ›ä¸è®¨å¥½çš„å·®äº‹ï¼Œæ— äººæ„¿æ„æ¥æ‰‹ï¼Œä¸Šå¸è¯¢é—®ä½ çš„æ„è§ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸»åŠ¨æ¥ä¸‹ã€‘", callback: () => {
                        gs.career.performance += 20;
                        applyEffects({ attributes: { health: -5 } });
                        showEventCard("è¿éš¾è€Œä¸Š", "fa-award", "ä½ å•ƒä¸‹äº†è¿™å—ç¡¬éª¨å¤´ï¼Œè™½ç„¶è¾›è‹¦ï¼Œå´è·å¾—äº†ä¸Šå¸çš„èµè¯†å’Œé¢å¤–çš„åŠŸç»©ã€‚");
                    }},
                    { htmlContent: "ã€å’Œå…¶ä»–äººä¸€æ ·æ¨è¯¿ã€‘", callback: () => {
                        showEventCard("éšæ³¢é€æµ", "fa-meh", "ä½ å’Œå…¶ä»–äººä¸€æ ·ï¼Œå¯¹æ­¤äº‹é¿ä¹‹ä¸åŠã€‚");
                    }}
                ]
            };
        }
    },
    career_inherit_failing_project: {
        type: 'career',
        condition: (gs) => gs.career.path,
        generate: (gs) => {
            return {
                title: "çƒ‚æ‘Šå­", icon: "fa-recycle", description: `å‰ä»»åŒåƒšå› æ•…è°ƒç¦»ï¼Œç•™ä¸‹ä¸€ä¸ªæ¿’ä¸´å¤±è´¥çš„é¡¹ç›®ï¼Œä¸Šå¸è®©ä½ æ¥æ‰‹ã€‚`,
                options: [
                    { htmlContent: "ã€å°è¯•æŒ½æ•‘ã€‘", callback: () => {
                        if (gs.player.attributes.wisdom > 80 && Math.random() < 0.5) {
                            gs.career.performance += 35;
                            showEventCard("å¦™æ‰‹å›æ˜¥", "fa-magic", "ä½ ç«Ÿç„¶å¥‡è¿¹èˆ¬åœ°ç›˜æ´»äº†è¿™ä¸ªé¡¹ç›®ï¼Œèƒ½åŠ›å¾—åˆ°äº†æ‰€æœ‰äººçš„è®¤å¯ï¼");
                        } else {
                            gs.career.performance -= 10;
                            showEventCard("æ— åŠ›å›å¤©", "fa-sync-alt", "ä½ å°½åŠ›äº†ï¼Œä½†é¡¹ç›®æœ€ç»ˆè¿˜æ˜¯å¤±è´¥äº†ã€‚");
                        }
                    }},
                    { htmlContent: "ã€ç›´æ¥ç”³è¯·ç»ˆæ­¢é¡¹ç›®ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 2 } });
                        showEventCard("åŠæ—¶æ­¢æŸ", "fa-hand-paper", "ä½ å‘ä¸Šå¸é™ˆæ˜åˆ©å®³ï¼Œç”³è¯·ç»ˆæ­¢äº†é¡¹ç›®ï¼Œé¿å…äº†æ›´å¤§çš„æŸå¤±ã€‚");
                    }}
                ]
            };
        }
    },
    career_budget_cuts: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 5,
        generate: (gs) => {
            return {
                title: "å‰Šå‡é¢„ç®—", icon: "fa-cut", description: `å› å›½åº“ç´§å¼ ï¼Œæœå»·ä¸‹ä»¤å‰Šå‡å„éƒ¨é—¨é¢„ç®—ï¼Œä½ å¿…é¡»å†³å®šä»å“ªé‡Œå¼€åˆ€ã€‚`,
                options: [
                    { htmlContent: "ã€å‰Šå‡ä¸‹å±ç¦åˆ©ã€‘", callback: () => {
                        gs.career.performance += 5;
                        showEventCard("ä¸å¾—äººå¿ƒ", "fa-users-slash", "ä½ ä¿ä½äº†é¡¹ç›®ï¼Œä½†ç‰ºç‰²äº†ä¸‹å±çš„ç¦åˆ©ï¼Œå¤±å»äº†äººå¿ƒã€‚");
                    }},
                    { htmlContent: "ã€å‘ä¸Šå¸å“­ç©·ã€‘", req: { charm: 80 }, callback: () => {
                        gs.career.performance += 10;
                        showEventCard("èƒ½è¨€å–„è¾©", "fa-comments", "ä½ å£°æ³ªä¿±ä¸‹åœ°å‘ä¸Šå¸é™ˆæƒ…ï¼ŒæˆåŠŸä¿ä½äº†å¤§éƒ¨åˆ†é¢„ç®—ã€‚");
                    }}
                ]
            };
        }
    },
    career_inspection_tour: {
        type: 'career',
        condition: (gs) => gs.career.path && gs.career.level >= 6,
        generate: (gs) => {
            return {
                title: "å¤–æ´¾å·¡æŸ¥", icon: "fa-route", description: `æœå»·æ´¾ä½ å‰å¾€åœ°æ–¹å·¡æŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‘ç«‹æƒå¨çš„æœºä¼šï¼Œä½†ä¹Ÿå¯èƒ½é­é‡åœ°æ–¹åŠ¿åŠ›çš„æŠµæŠ—ã€‚`,
                options: [
                    { htmlContent: "ã€é›·å‰é£è¡Œï¼Œä¸¥æŸ¥ä¸è´·ã€‘", callback: () => {
                        applyEffects({ attributes: { virtue: 8, reputation: 10 } });
                        showEventCard("é“é¢å¾¡å²", "fa-gavel", "ä½ çš„ä¸¥æŸ¥æªå‡ºäº†ä¸å°‘è´ªå®˜æ±¡åï¼Œåœ¨æ°‘é—´è·å¾—äº†æé«˜çš„å£°æœ›ã€‚");
                    }},
                    { htmlContent: "ã€çä¸€åªçœ¼é—­ä¸€åªçœ¼ã€‘", disabled: gs.finances.wealth < 1000, callback: () => {
                        applyEffects({ wealth: 1000, attributes: { virtue: -8 } });
                        showEventCard("â€œå†°æ•¬ç‚­æ•¬â€", "fa-gifts", "åœ°æ–¹å®˜å‘˜é€ä¸Šäº†ä¸°åšçš„â€œç¨‹ä»ªâ€ï¼Œä½ é»˜å¥‘åœ°æ”¶ä¸‹äº†ã€‚");
                    }}
                ]
            };
        }
    },
    // ä¿®èº«äº‹ä»¶
self_cultivation_book: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "ä¿®èº«å…»æ€§", icon: "fa-book", description: `é—²æš‡ä¹‹æ—¶ï¼Œä½ å¾—åˆ°ä¸€æœ¬å¤ç±ï¼Œä¼¼ä¹è•´å«ç€æ·±åˆ»çš„æ™ºæ…§ã€‚`,
                options: [
                    { htmlContent: "ã€æ½œå¿ƒç ”è¯»ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 3, talent: 1 } });
                        showEventCard("å¼€å·æœ‰ç›Š", "fa-lightbulb", "ä¹¦ä¸­æ™ºæ…§è®©ä½ è·ç›ŠåŒªæµ…ã€‚");
                    }},
                    { htmlContent: "ã€ä¸€ç›®åè¡Œã€‘", callback: () => {
                         applyEffects({ attributes: { wisdom: 1 } });
                         showEventCard("å›«å›µåæ£", "fa-glasses", "ä½ å¿«é€Ÿç¿»é˜…äº†ä¸€éã€‚");
                    }}
                ]
            };
        }
    },
    self_reflection: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "é™å¤œåæ€", icon: "fa-moon", description: "å¤œæ·±äººé™ï¼Œä½ å›é¡¾æœ€è¿‘çš„å¾—å¤±ï¼Œå¯¹è‡ªå·±çš„äººç”Ÿæœ‰äº†æ–°çš„æ€è€ƒã€‚",
                options: [
                    { htmlContent: "ã€åæ€äººé™…å…³ç³»ã€‘", callback: () => {
                        applyEffects({ attributes: { charm: 2, wisdom: 1 } });
                        showEventCard("äººæƒ…ç»ƒè¾¾", "fa-users", "ä½ å¯¹äººæƒ…ä¸–æ•…çš„ç†è§£æ›´æ·±äº†ã€‚");
                    }},
                    { htmlContent: "ã€åæ€äº‹ä¸šè§„åˆ’ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 3 } });
                        gs.career.performance += 5;
                        showEventCard("è¿ç­¹å¸·å¹„", "fa-chess", "ä½ å¯¹æœªæ¥çš„äº‹ä¸šé“è·¯æ›´åŠ æ¸…æ™°ã€‚");
                    }},
                    { htmlContent: "ã€æ”¾ç©ºè‡ªå·±ã€‘", callback: () => {
                        applyEffects({ attributes: { health: 5 } });
                        showEventCard("æ— äº‹å°ç¥ä»™", "fa-leaf", "ä»€ä¹ˆéƒ½ä¸æƒ³ï¼Œä¹Ÿæ˜¯ä¸€ç§ä¿®è¡Œã€‚");
                    }}
                ]
            };
        }
    },
    self_encounter_master: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å¶é‡é«˜äºº", icon: "fa-user-ninja", description: "ä½ åœ¨å±±ä¸­å¶é‡ä¸€ä½ä»™é£é“éª¨çš„é«˜äººï¼Œå¯¹æ–¹ä¼¼ä¹æ„¿æ„æŒ‡ç‚¹ä½ ä¸€äºŒã€‚",
                options: [
                    { htmlContent: "ã€è¯·æ•™æ­¦å­¦ã€‘", callback: () => {
                        applyEffects({ attributes: { martial: 8 } });
                        showEventCard("æ­¦å­¦ç²¾è¿›", "fa-khanda", "é«˜äººæŒ‡ç‚¹äº†ä½ å‡ æ‹›ï¼Œä½ çš„æ­¦å­¦å¤§æœ‰é•¿è¿›ã€‚");
                    }},
                    { htmlContent: "ã€è¯·æ•™æ£‹è‰ºã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 8 } });
                        showEventCard("æ£‹åŠ›å¤§å¢", "fa-chess-board", "ä¸é«˜äººå¯¹å¼ˆä¸€å±€ï¼Œä½ çš„æ™ºæ…§å’Œæ£‹åŠ›éƒ½æå‡äº†ã€‚");
                    }}
                ]
            };
        }
    },

    // â–¼â–¼â–¼ ã€æ–°å¢16ä¸ªä¿®èº«äº‹ä»¶ã€‘ â–¼â–¼â–¼
    self_attend_opera: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "æ¢¨å›­å¬æˆ", icon: "fa-theater-masks", description: `äº¬åŸæœ€æœ‰åçš„æˆç­ä»Šæ—¥ä¸Šæ¼”ä¸€å‡ºã€Šç‰¡ä¸¹äº­ã€‹ï¼Œä½ å†³å®šå‰å»è§‚èµã€‚`,
                options: [
                    { htmlContent: "ã€æ²‰æµ¸å…¶ä¸­ã€‘", callback: () => {
                        applyEffects({ attributes: { talent: 3, charm: 2 } });
                        showEventCard("å¦‚ç—´å¦‚é†‰", "fa-star", "ä½ ä¸ºæˆä¸­äººçš„å‘½è¿æ„Ÿå¹ï¼Œå¯¹è‰ºæœ¯çš„ç†è§£æ›´æ·±äº†ä¸€å±‚ã€‚");
                    }},
                    { htmlContent: "ã€ç»“äº¤ç¥¨å‹ã€‘", callback: () => {
                        applyEffects({ attributes: { charm: 3 } });
                        showEventCard("ä»¥æˆä¼šå‹", "fa-users", "ä½ ä¸é‚»åº§çš„ç¥¨å‹ç›¸è°ˆç”šæ¬¢ï¼ŒæˆåŠŸç»“è¯†äº†ä¸€ä½æ–°æœ‹å‹ã€‚");
                    }}
                ]
            };
        }
    },
    self_practice_calligraphy: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "ä¸´æ‘¹å­—å¸–", icon: "fa-pen-nib", description: `ä½ å¾—åˆ°ä¸€æœ¬å‰æœä¹¦æ³•å¤§å®¶çš„å­—å¸–ï¼Œå†³å®šé™ä¸‹å¿ƒæ¥ä¸´æ‘¹ä¸€ç•ªã€‚`,
                options: [
                    { htmlContent: "ã€æ½œå¿ƒç»ƒä¹ ã€‘", callback: () => {
                        applyEffects({ attributes: { talent: 4, virtue: 1 } });
                        showEventCard("ç¬”åŠ›æ¸è¿›", "fa-paint-brush", "ç»ƒä¹ ä¹¦æ³•ä¸ä»…è®©ä½ çš„å­—è¶Šæ¥è¶Šå¥½ï¼Œå¿ƒæ€§ä¹Ÿæ›´åŠ æ²‰ç¨³ã€‚");
                    }}
                ]
            };
        }
    },
    self_fishing: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "æºªè¾¹å‚é’“", icon: "fa-fish", description: `ä½ å¸¦ç€æ¸”å…·æ¥åˆ°åŸéƒŠçš„æºªè¾¹ï¼Œäº«å—ä¸€ä¸ªä¸‹åˆçš„å®é™ã€‚`,
                options: [
                    { htmlContent: "ã€é™å¿ƒå‚é’“ã€‘", callback: () => {
                        if (Math.random() < 0.6) {
                            applyEffects({ attributes: { health: 5, wisdom: 1 } });
                            showEventCard("æ»¡è½½è€Œå½’", "fa-fish", "ä½ é’“ä¸Šäº†å‡ å°¾è‚¥ç¾çš„é²œé±¼ï¼Œå¿ƒæƒ…èˆ’ç•…ã€‚");
                        } else {
                            applyEffects({ attributes: { health: 4 } });
                            showEventCard("äº«å—è¿‡ç¨‹", "fa-leaf", "è™½ç„¶ä¸€æ— æ‰€è·ï¼Œä½†å·å¾—æµ®ç”ŸåŠæ—¥é—²ï¼Œä¹Ÿæ˜¯ä¸€ç§äº«å—ã€‚");
                        }
                    }}
                ]
            };
        }
    },
    self_meditation: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å¤å¯ºå†¥æƒ³", icon: "fa-om", description: `ä½ æ¥åˆ°å¤å¯ºï¼Œåœ¨ç¦…æˆ¿ä¸­ç›˜è†è€Œåï¼Œå°è¯•é€šè¿‡å†¥æƒ³æ¥æ”¾ç©ºè‡ªå·±ã€‚`,
                options: [
                    { htmlContent: "ã€å¼€å§‹å†¥æƒ³ã€‘", callback: () => {
                        applyEffects({ attributes: { health: 6, wisdom: 2, virtue: 1 } });
                        showEventCard("èº«å¿ƒåˆä¸€", "fa-spa", "ä½ æ‘’é™¤äº†æ‚å¿µï¼Œæ„Ÿåˆ°å‰æ‰€æœªæœ‰çš„å¹³é™ï¼Œèº«å¿ƒéƒ½å¾—åˆ°äº†å‡€åŒ–ã€‚");
                    }}
                ]
            };
        }
    },
    self_debate_philosophy: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "èŒ¶æ¥¼è¾©é“", icon: "fa-comments", description: `ä½ åœ¨èŒ¶æ¥¼é‡åˆ°ä¸€ä½å­¦è€…ï¼Œå°±â€œçŸ¥ä¸è¡Œâ€çš„é—®é¢˜ä¸ä»–å±•å¼€äº†è¾©è®ºã€‚`,
                options: [
                    { htmlContent: "ã€å‚ä¸è¾©è®ºã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 5 } });
                        showEventCard("æ€æƒ³çš„ç¢°æ’", "fa-lightbulb", "ä¸€åœºæ¿€çƒˆçš„è¾©è®ºè®©ä½ å¯¹è®¸å¤šé—®é¢˜æœ‰äº†æ–°çš„çœ‹æ³•ã€‚");
                    }}
                ]
            };
        }
    },
    self_volunteering: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "è¡Œå–„ç§¯å¾·", icon: "fa-hands-helping", description: `åŸä¸­çš„æ…ˆå¹¼å±€ç¼ºå°‘äººæ‰‹ï¼Œä½ å†³å®šå‰å»å¸®å¿™ã€‚`,
                options: [
                    { htmlContent: "ã€å¸®å¿™ç…§æ–™å­©ç«¥ã€‘", disabled: gs.finances.wealth < 50, callback: () => {
                        applyEffects({ wealth: -50, attributes: { virtue: 8, charm: 2 } });
                        showEventCard("ä»å¿ƒå–„ä¸¾", "fa-child", "ä½ ä¸ä»…å¸®å¿™ç…§æ–™äº†å­©ç«¥ï¼Œè¿˜è‡ªæè…°åŒ…ä¸ºä»–ä»¬ä¹°äº†äº›é›¶é£Ÿã€‚ä½ çš„å–„ä¸¾è®©ä½ æ”¶è·äº†å°Šæ•¬ã€‚");
                    }}
                ]
            };
        }
    },
    self_solve_riddle: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "ç ´è§£æ®‹å±€", icon: "fa-puzzle-piece", description: `ä½ åœ¨å¸‚é›†ä¸Šçœ‹åˆ°ä¸€åˆ™æ‚¬èµï¼Œæœ‰äººæ‘†ä¸‹äº†ä¸€ç›˜æ®ä¼ æ— äººèƒ½è§£çš„è±¡æ£‹æ®‹å±€ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸Šå‰ä¸€è¯•ã€‘", callback: () => {
                        if (gs.player.attributes.wisdom > 80 && Math.random() < 0.5) {
                            applyEffects({ wealth: 500, attributes: { wisdom: 5, reputation: 5 } });
                            showEventCard("ä¸€ä¸¾æˆå", "fa-trophy", "ä½ è‹¦æ€å†¥æƒ³åï¼Œç«ŸçœŸçš„ç ´è§£äº†æ­¤å±€ï¼ä¸ä»…èµ¢å¾—èµé‡‘ï¼Œè¿˜è·å¾—äº†â€œæ£‹åœ£â€çš„é›…å·ã€‚");
                        } else {
                            applyEffects({ attributes: { wisdom: 2 } });
                            showEventCard("è™½è´¥çŠ¹è£", "fa-frown", "è™½ç„¶æœªèƒ½ç ´è§£ï¼Œä½†ä½ åœ¨æ€è€ƒä¸­ä¹Ÿé¢‡æœ‰æ‰€å¾—ã€‚");
                        }
                    }}
                ]
            };
        }
    },
    self_write_journal: {
        type: 'self',
        condition: (gs) => gs.player.age > 20,
        generate: (gs) => {
            return {
                title: "æ’°å†™å›å¿†", icon: "fa-pen-alt", description: `å¤œæ·±äººé™ï¼Œä½ å†³å®šæç¬”å†™ä¸‹è‡ªå·±çš„è¿‡å¾€ï¼Œè®°å½•ä¸‹äººç”Ÿçš„ç‚¹æ»´ã€‚`,
                options: [
                    { htmlContent: "ã€å¼€å§‹åŠ¨ç¬”ã€‘", callback: () => {
                        applyEffects({ attributes: { wisdom: 3, virtue: 1 } });
                        showEventCard("å›é¦–å¾€äº‹", "fa-scroll", "åœ¨å›å¿†ä¸ä¹¦å†™ä¸­ï¼Œä½ å¯¹è‡ªå·±çš„è¿‡å¾€æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ã€‚");
                    }}
                ]
            };
        }
    },
    self_tame_horse: {
        type: 'self',
        condition: (gs) => gs.player.gender === 'male',
        generate: (gs) => {
            return {
                title: "é©¯æœçƒˆé©¬", icon: "fa-horse-head", description: `é©¬åœºæ–°åˆ°ä¸€åŒ¹è¥¿åŸŸçƒˆé©¬ï¼Œæ€§æƒ…æš´èºï¼Œæ— äººèƒ½é©¯æœã€‚`,
                options: [
                    { htmlContent: "ã€å°è¯•é©¯æœã€‘", callback: () => {
                        if (gs.player.attributes.martial > 70 && gs.player.attributes.health > 70) {
                            applyEffects({ attributes: { martial: 5, reputation: 5 } });
                            showEventCard("äººé©¬åˆä¸€", "fa-award", "ç»è¿‡ä¸€ç•ªææ–—ï¼Œä½ æˆåŠŸé©¯æœäº†çƒˆé©¬ï¼Œèµ¢å¾—äº†ä¼—äººçš„å–å½©ï¼");
                        } else {
                            applyEffects({ attributes: { health: -10 } });
                            showEventCard("æŒ‘æˆ˜å¤±è´¥", "fa-user-injured", "ä½ è¢«çƒˆé©¬ç‹ ç‹ åœ°æ‘”äº†ä¸‹æ¥ï¼Œå—äº†äº›ä¼¤ã€‚");
                        }
                    }}
                ]
            };
        }
    },
    self_learn_language: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å­¦ä¹ å¤–è¯­", icon: "fa-language", description: `ä¸€ä½æ¥è‡ªæ³¢æ–¯çš„å•†äººæ­£åœ¨æ‹›å‹Ÿæœ¬åœ°äººå­¦ä¹ è¯­è¨€ï¼Œä»¥ä¾¿æ›´å¥½åœ°åšç”Ÿæ„ã€‚`,
                options: [
                    { htmlContent: "ã€æŠ¥åå­¦ä¹ ã€‘", disabled: gs.finances.wealth < 200, callback: () => {
                        applyEffects({ wealth: -200, attributes: { wisdom: 4, charm: 2 } });
                        showEventCard("å¼€é˜”çœ¼ç•Œ", "fa-globe-asia", "å­¦ä¹ å¤–è¯­è®©ä½ äº†è§£åˆ°äº†ä¸åŒçš„æ–‡åŒ–ï¼Œçœ¼ç•Œå¤§å¼€ã€‚");
                    }}
                ]
            };
        }
    },
    self_archery_contest: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å°„ç®­æ¯”èµ›", icon: "fa-bullseye", description: `åŸä¸­ä¸¾åŠäº†ä¸€åœºå°„ç®­æ¯”èµ›ï¼Œä½ å†³å®šå»å‡‘ä¸ªçƒ­é—¹ã€‚`,
                options: [
                    { htmlContent: "ã€æŠ¥åå‚èµ›ã€‘", callback: () => {
                        if (gs.player.attributes.martial > 60 && Math.random() < 0.4) {
                            applyEffects({ wealth: 300, attributes: { martial: 3, reputation: 3 } });
                            showEventCard("ç™¾æ­¥ç©¿æ¨", "fa-trophy", "ä½ ç®­æ— è™šå‘ï¼Œèµ¢å¾—äº†æ¯”èµ›å’Œèµé‡‘ï¼");
                        } else {
                            applyEffects({ attributes: { martial: 1 } });
                            showEventCard("é‡åœ¨å‚ä¸", "fa-smile", "è™½ç„¶æœªèƒ½å¤ºé­ï¼Œä½†ä¹Ÿé”»ç‚¼äº†æŠ€è‰ºã€‚");
                        }
                    }}
                ]
            };
        }
    },
    self_gardening: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å›­è‰ºé›…è¶£", icon: "fa-leaf", description: `ä½ å¯¹å›­è‰ºäº§ç”Ÿäº†å…´è¶£ï¼Œæ‰“ç®—åœ¨åé™¢å¼€è¾Ÿä¸€å°å—åœ°ï¼Œç§ç§èŠ±è‰ã€‚`,
                options: [
                    { htmlContent: "ã€æ‰“ç†èŠ±å›­ã€‘", callback: () => {
                        applyEffects({ attributes: { talent: 2, health: 3 } });
                        showEventCard("æ€¡ç„¶è‡ªå¾—", "fa-seedling", "ä¾å¼„èŠ±è‰è®©ä½ å¿ƒæ—·ç¥æ€¡ï¼Œèº«ä½“ä¹Ÿå¾—åˆ°äº†é”»ç‚¼ã€‚");
                    }}
                ]
            };
        }
    },
    self_learn_instrument: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å­¦ä¹ ä¹å™¨", icon: "fa-music", description: `ä½ è¢«è¡—è¾¹è‰ºäººå¹å¥çš„æ´ç®«å£°æ‰€å¸å¼•ï¼Œä¹Ÿæƒ³å­¦ä¸€é—¨ä¹å™¨ã€‚`,
                options: [
                    { htmlContent: "ã€è´­ä¹°æ´ç®«å¹¶ç»ƒä¹ ã€‘", disabled: gs.finances.wealth < 150, callback: () => {
                        applyEffects({ wealth: -150, attributes: { talent: 4 } });
                        showEventCard("åˆçª¥é—¨å¾„", "fa-book-music", "è™½ç„¶å¹å¾—æ–­æ–­ç»­ç»­ï¼Œä½†ä½ å·²ç»æŒæ¡äº†åŸºæœ¬çš„æŒ‡æ³•ã€‚");
                    }}
                ]
            };
        }
    },
    self_visit_exhibition: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "å‚è§‚ç”»å±•", icon: "fa-image", description: `ä¸€ä½æ±Ÿå—åå®¶çš„ç”»å±•æ­£åœ¨äº¬ä¸­å±•å‡ºï¼Œä½ é—»è®¯å‰å»è§‚èµã€‚`,
                options: [
                    { htmlContent: "ã€ä»”ç»†å“å‘³ã€‘", callback: () => {
                        applyEffects({ attributes: { talent: 3, wisdom: 1 } });
                        showEventCard("å¤§å¼€çœ¼ç•Œ", "fa-star", "ç”»ä¸­é«˜è¶…çš„æŠ€è‰ºå’Œæ„å¢ƒè®©ä½ æ·±å—å¯å‘ã€‚");
                    }}
                ]
            };
        }
    },
    self_learn_herbalism: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "è¯·æ•™é“å£«", icon: "fa-mortar-pestle", description: `ä½ åœ¨å±±ä¸­é‡åˆ°ä¸€ä½é‡‡è¯çš„é“å£«ï¼Œä¾¿å‘ä»–è¯·æ•™ä¸€äº›å…»ç”Ÿå’Œè‰è¯çš„çŸ¥è¯†ã€‚`,
                options: [
                    { htmlContent: "ã€è™šå¿ƒæ±‚æ•™ã€‘", callback: () => {
                        applyEffects({ attributes: { health: 4, wisdom: 2 } });
                        showEventCard("å…»ç”Ÿä¹‹é“", "fa-hand-holding-medical", "é“å£«å‘ä½ ä¼ æˆäº†å‡ ä¸ªé£Ÿè¡¥çš„æ–¹å­ï¼Œä½ æ„Ÿè§‰å—ç›ŠåŒªæµ…ã€‚");
                    }}
                ]
            };
        }
    },
    self_long_hike: {
        type: 'self',
        condition: (gs) => true,
        generate: (gs) => {
            return {
                title: "ç™»å±±è¿œè¶³", icon: "fa-hiking", description: `ä½ å†³å®šèŠ±ä¸Šä¸€å¤©æ—¶é—´ï¼Œå»æ”€ç™»äº¬éƒŠæœ€é«˜çš„è¥¿å±±ã€‚`,
                options: [
                    { htmlContent: "ã€ç™»é¡¶è¿œçœºã€‘", callback: () => {
                        applyEffects({ attributes: { health: 8, martial: 1 } });
                        showEventCard("å¿ƒèƒ¸å¼€é˜”", "fa-mountain", "ç™»é«˜æœ›è¿œï¼Œä½ æ„Ÿåˆ°èƒ¸ä¸­çš„æµŠæ°”ä¸€æ‰«è€Œç©ºï¼Œä½“é­„ä¹Ÿå¾—åˆ°äº†æå¤§çš„é”»ç‚¼ã€‚");
                    }}
                ]
            };
        }
},
    // ============= æ–°å¢äº‹ä»¶ START ===============
    parent_marriage_suggestion: {
        type: 'parent',
        condition: (gs) => gs.family.members.motherId && !gs.marriage.isMarried && gs.player.age >= 16,
        generate: (gs) => {
            const mother = gs.npcs[gs.family.members.motherId];
            return {
                title: "æ¯äº²çš„å®‰æ’", icon: "fa-ring", description: `æ¯äº²çœ‹ä½ å·²åˆ°é€‚å©šå¹´é¾„ï¼Œç‰¹åœ°ä¸ºä½ ç‰©è‰²äº†ä¸€é—¨äº²äº‹ï¼Œå¯¹æ–¹æ˜¯ <strong class="highlight-npc">åéƒ¨ä¾éƒå®¶çš„å…¬å­/åƒé‡‘</strong>ï¼Œå®¶ä¸–äººå“ä¿±ä½³ã€‚`,
                options: [
                    { htmlContent: "ã€åŒæ„ç›¸çœ‹ã€‘", callback: () => {
                        const partnerGender = gs.player.gender === 'male' ? 'female' : 'male';
                        const newSuitor = generateNPC({
                            gender: partnerGender,
                            age: gs.player.age + 1,
                            attributes: { family: 75, charm: 70, etiquette: 75, wisdom: 65 },
                            title: `åéƒ¨ä¾éƒå®¶çš„${partnerGender === 'male' ? 'å…¬å­' : 'åƒé‡‘'}`,
                            role: 'ç›¸äº²å¯¹è±¡'
                        });
                        gs.suitors.push(newSuitor.id);
                        applyEffects({ relationship: { targetId: mother.id, favor: 10 } });
                        showEventCard("å¬ä»å®‰æ’", "fa-handshake", `ä½ åŒæ„äº†æ¯äº²çš„å®‰æ’ï¼Œä¸ä¹…åä¾¿è§åˆ°äº†${newSuitor.name}ï¼Œå¯¹æ–¹ä¼¼ä¹å¯¹ä½ å°è±¡ä¸é”™ã€‚`);
                    }},
                    { htmlContent: "ã€å©‰è¨€è°¢ç»ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: -5 } });
                        showEventCard("è‡ªç”±çš„å‘å¾€", "fa-dove", "ä½ è¡¨ç¤ºè‡ªå·±çš„å©šäº‹æƒ³è‡ªå·±åšä¸»ï¼Œæ¯äº²è™½ç„¶æœ‰äº›å¤±æœ›ï¼Œä½†ä¹Ÿå°Šé‡ä½ çš„æƒ³æ³•ã€‚");
                    }}
                ]
            };
        }
    },
    child_special_talent: {
        type: 'child',
        condition: (gs) => gs.children.some(c => !c.isDead && c.age >= 8 && c.age < 15),
        generate: (gs) => {
            const child = getRandomElement(gs.children.filter(c => !c.isDead && c.age >= 8 && c.age < 15));
            const talentType = Math.random() < 0.5 ? 'martial' : 'talent';
            const talentName = talentType === 'martial' ? 'æ­¦å­¦' : 'è‰ºæœ¯';
            const cost = 2000;
            return {
                title: "å­å—£çš„å¤©èµ‹", icon: "fa-star", description: `ä½ å‘ç°ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> åœ¨ <strong class="value">${talentName}</strong> æ–¹é¢å±•ç°å‡ºäº†æƒŠäººçš„å¤©èµ‹ï¼Œè¿œè¶…åŒé¾„äººã€‚`,
                options: [
                    { htmlContent: `ã€èŠ±è´¹${cost}ä¸¤ï¼Œè¯·åå¸ˆæŒ‡å¯¼ã€‘`, disabled: gs.finances.wealth < cost, callback: () => {
                        applyEffects({ wealth: -cost });
                        child.attributes[talentType] += 15;
                        child.favor += 10;
                        showEventCard("å› ææ–½æ•™", "fa-award", `åœ¨åå¸ˆçš„æŒ‡å¯¼ä¸‹ï¼Œ${child.name}çš„å¤©èµ‹å¾—åˆ°äº†æå¤§çš„å‘å±•ï¼`);
                    }},
                    { htmlContent: "ã€é¡ºå…¶è‡ªç„¶ã€‘", callback: () => {
                        child.attributes[talentType] += 5;
                        showEventCard("é™å¾…èŠ±å¼€", "fa-seedling", `${child.name}ç»§ç»­ä¾é è‡ªå·±çš„å…´è¶£å‘å±•ï¼Œä¹Ÿå°æœ‰æˆå°±ã€‚`);
                    }}
                ]
            };
        }
    },
    lover_in_trouble: {
        type: 'lover',
        condition: (gs) => gs.social.secretLovers.length > 0,
        generate: (gs) => {
            const lover = gs.npcs[getRandomElement(gs.social.secretLovers)];
            const cost = 1000;
            return {
                title: "æƒ…äººçš„æ±‚åŠ©", icon: "fa-hand-holding-usd", description: `ä½ çš„æƒ…äºº <strong class="highlight-npc">${lover.name}</strong> ä¼¼ä¹é‡åˆ°äº†éº»çƒ¦ï¼Œæ€¥éœ€ <span class="value">${cost}</span> ä¸¤é“¶å­å‘¨è½¬ï¼Œå‘ä½ å¼€å£æ±‚åŠ©ã€‚`,
                options: [
                    { htmlContent: "ã€æ…·æ…¨è§£å›Šã€‘", disabled: gs.finances.wealth < cost, callback: () => {
                        applyEffects({ wealth: -cost, relationship: { targetId: lover.id, favor: 15, devotion: 10 } });
                        showEventCard("é›ªä¸­é€ç‚­", "fa-hand-holding-heart", "ä½ å¸®åŠ©TAæ¸¡è¿‡äº†éš¾å…³ï¼ŒTAå¯¹ä½ æ„Ÿæ¿€ä¸å°½ï¼Œæ›´åŠ å€¾å¿ƒã€‚");
                    }},
                    { htmlContent: "ã€è¡¨ç¤ºæ— èƒ½ä¸ºåŠ›ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: lover.id, favor: -15 } });
                        showEventCard("çˆ±è«èƒ½åŠ©", "fa-times", "ä½ çš„æ‹’ç»è®©TAæ„Ÿåˆ°å¤±æœ›ï¼Œä½ ä»¬çš„å…³ç³»å‡ºç°äº†è£‚ç—•ã€‚");
                    }}
                ]
            };
        }
    },
    sworn_sibling_share_treasure: {
        type: 'sworn',
        condition: (gs) => gs.social.swornSiblings && gs.social.swornSiblings.length > 0,
        generate: (gs) => {
            const sibling = gs.npcs[getRandomElement(gs.social.swornSiblings)];
            const treasure = Math.random() < 0.5 ? { id: 'gu_ji_shan_ben', name: 'å¤ç±å–„æœ¬' } : { id: 'cang_bao_tu_can_pian', name: 'è—å®å›¾æ®‹ç‰‡' };
            return {
                title: "ç¦ç¥¸ä¸å…±", icon: "fa-gem", description: `ä½ çš„ç»“ä¹‰å…„å¼Ÿ/å§å¦¹ <strong class="highlight-npc">${sibling.name}</strong> å¾—åˆ°äº†ä¸€ä»¶å®ç‰©ï¼Œç‰¹åœ°å‰æ¥ä¸ä½ åˆ†äº«ã€‚`,
                options: [
                    { htmlContent: "ã€ä¸€åŒç ”ç©¶ã€‘", callback: () => {
                        addItemToInventory(treasure.id, 1);
                        applyEffects({ relationship: { targetId: sibling.id, favor: 10 } });
                        showEventCard("æœ‰ç¦åŒäº«", "fa-box-open", `ä½ ä»¬ä¸€åŒç ”ç©¶äº†è¿™ä»¶ã€${treasure.name}ã€‘ï¼Œå¹¶å°†å…¶å¦¥å–„ä¿ç®¡ã€‚`);
                    }},
                    { htmlContent: "ã€è®©TAç‹¬äº«ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: sibling.id, favor: 5 }, attributes: { virtue: 3 } });
                        showEventCard("é«˜é£äº®èŠ‚", "fa-user-check", "ä½ è®¤ä¸ºå®ç‰©åº”ç”±TAç‹¬äº«ï¼Œè¿™ä»½æ°”åº¦è®©TAæ›´åŠ æ•¬é‡ä½ ã€‚");
                    }}
                ]
            };
        }
    },
    npc_farewell: {
        type: 'npc',
        condition: (gs) => {
            const friends = (gs.social.friends || []).map(id => gs.npcs[id]).filter(f => f && !f.isDead);
            return friends.length > 0;
        },
        generate: (gs) => {
            const friends = (gs.social.friends || []).map(id => gs.npcs[id]).filter(f => f && !f.isDead);
            const friend = getRandomElement(friends);
            return {
                title: "å‹äººè¿œè¡Œ", icon: "fa-map-signs", description: `ä½ çš„å‹äºº <strong class="highlight-npc">${friend.name}</strong> å› æ•…éœ€è¦è¿œè¡Œä¸€å¹´ï¼Œç‰¹åœ°å‰æ¥å‘ä½ è¾è¡Œã€‚`,
                options: [
                    { htmlContent: "ã€ä¸ºå…¶è®¾å®´è·µè¡Œã€‘", cost: { wealth: 100 }, callback: () => {
                        applyEffects({ wealth: -100, relationship: { targetId: friend.id, favor: 10 } });
                        showEventCard("é•¿äº­é€åˆ«", "fa-wine-glass-alt", "ä½ ä»¬åœ¨é…’å®´ä¸Šä¾ä¾æƒœåˆ«ï¼Œçº¦å®šä¸€å¹´åå†ä¼šã€‚");
                    }},
                    { htmlContent: "ã€èµ é€ç›˜ç¼ ã€‘", cost: { wealth: 300 }, callback: () => {
                        applyEffects({ wealth: -300, relationship: { targetId: friend.id, favor: 15, devotion: 5 } });
                        showEventCard("æƒ…æ·±ä¹‰é‡", "fa-money-bill-wave", "ä½ èµ é€çš„ç›˜ç¼ è®©TAåœ¨å¼‚ä¹¡ä¹Ÿèƒ½æ„Ÿå—åˆ°æ¸©æš–ã€‚");
                    }},
                    { htmlContent: "ã€ç®€å•é“åˆ«ã€‘", callback: () => {
                        applyEffects({ relationship: { targetId: friend.id, favor: 2 } });
                        showEventCard("åä¼šæœ‰æœŸ", "fa-hand-paper", "ä½ å‘TAç®€å•é“åˆ«ï¼Œç¥å…¶ä¸€è·¯é¡ºé£ã€‚");
                    }}
                ]
            };
        }
    }
    // ============= æ–°å¢äº‹ä»¶ END =================
};

// [æ–°å¢æ­¤å¯¹è±¡]
const CAREER_CORE_STATS = {
    civilian: ['wisdom', 'virtue'],
    warrior: ['martial', 'health'],
    merchant: ['wisdom', 'charm'],
    scholar: ['talent', 'charm'],
    ranger: ['martial', 'virtue'],
    matron: ['etiquette', 'virtue'],
    embroiderer: ['talent', 'charm'],
    doctor: ['wisdom', 'virtue'],
    spy_master: ['scheming', 'wisdom']
};
// ã€ä¿®å¤æ ¸å¿ƒã€‘å®šä¹‰ ATTR_MAP, ç”¨äºå°†å±æ€§è‹±æ–‡åè½¬ä¸ºä¸­æ–‡
const ATTR_MAP = {talent:"æ‰æƒ…", wisdom:"æ™ºæ…§", health:"å¥åº·", virtue:"å“å¾·", charm:"é­…åŠ›", etiquette:"ç¤¼ä»ª", martial:"æ­¦å­¦", reputation:"å£°æœ›", scheming:"å¿ƒè®¡", strategy:"æƒè°‹", prestige:"å®¶å¨"};

const ITEM_DATA = {
    // æ–‡å®˜ç‰©å“
    'ming_shi_qing_jian': { name: 'åå£«çš„è¯·æŸ¬', type: 'æ¶ˆè€—', icon: 'fa-envelope', desc: 'ä¸€å¼ ç”±äº¬åŸåå£«ç­¾å‘çš„è¯·æŸ¬ï¼Œå¯ç”¨äºæ‹œè®¿ä¸€ä½é«˜é˜¶æ–‡å®˜ã€‚', performance_boost: 20 },
    'shi_zheng_xin_de': { name: 'æ–½æ”¿å¿ƒå¾—', type: 'æ–‡ä¹¦', icon: 'fa-book-open', desc: 'å‰æœæŸä½å®°ç›¸çš„æ–½æ”¿å¿ƒå¾—æ‰‹ç¨¿ï¼Œè•´å«ç€é«˜æ·±çš„æ”¿æ²»æ™ºæ…§ã€‚', performance_boost: 50 },
    'tan_fu_xian_suo': { name: 'è´ªè…çº¿ç´¢', type: 'æ–‡ä¹¦', icon: 'fa-file-invoice-dollar', desc: 'ä¸€ä»½è®°å½•ç€æŸä½å®˜å‘˜è´ªè…è¡Œä¸ºçš„å…³é”®çº¿ç´¢ã€‚', performance_boost: 30 },
    'yu_ci_wen_fang_si_bao': { name: 'å¾¡èµæ–‡æˆ¿å››å®', type: 'çå“', icon: 'fa-gem', desc: 'çš‡å¸äº²èµçš„æ–‡æˆ¿å››å®ï¼Œæ˜¯æ— ä¸Šçš„è£è€€ã€‚æŒæœ‰æ­¤ç‰©ï¼Œæ¯å¹´ä¼šè‡ªåŠ¨æå‡æ‰æƒ…ä¸å£°æœ›ã€‚' },
    'qing_bao_si_sheng_huo': { name: 'æƒ…æŠ¥ï¼šç§ç”Ÿæ´»', type: 'æ–‡ä¹¦', icon: 'fa-mask', desc: 'ä¸€ä»½å…³äºæŸä½å¤§è‡£ç§ç”Ÿæ´»çš„ç§˜å¯†æƒ…æŠ¥ã€‚' },
    'qing_bao_cai_wu': { name: 'æƒ…æŠ¥ï¼šè´¢åŠ¡é—®é¢˜', type: 'æ–‡ä¹¦', icon: 'fa-mask', desc: 'ä¸€ä»½å…³äºæŸä½å¤§è‡£è´¢åŠ¡é—®é¢˜çš„ç§˜å¯†æƒ…æŠ¥ã€‚' },
    // æ­¦å°†ç‰©å“
    'bai_lian_bu_ren_jia': { name: 'ç™¾ç‚¼æ­¥äººç”²', type: 'çå“', icon: 'fa-shield-alt', desc: 'åšé‡çš„æ­¥å…µé‡ç”²ï¼Œèƒ½æå¤§æå‡æˆ˜åœºç”Ÿå­˜ç‡ã€‚', performance_boost: 20 },
    'ji_feng_chi_hou_jia': { name: 'ç–¾é£æ–¥å€™ç”²', type: 'çå“', icon: 'fa-shield-alt', desc: 'è½»ä¾¿çš„çš®ç”²ï¼Œæå‡æˆ˜åœºç§»åŠ¨åŠ›å’Œä¾¦æŸ¥æˆåŠŸç‡ã€‚' },
    'bai_fu_chang_pei_dao': { name: 'ç™¾å¤«é•¿çš„ä½©åˆ€', type: 'çå“', icon: 'fa-khanda', desc: 'ä¸€æŠŠè·Ÿéšç™¾å¤«é•¿å¤šå¹´çš„æ—§ä½©åˆ€ï¼Œé”‹åˆ©å¼‚å¸¸ã€‚', performance_boost: 25 },
    'mi_lin_di_xing_tu': { name: 'å¯†æ—åœ°å½¢å›¾', type: 'æ–‡ä¹¦', icon: 'fa-map-marked-alt', desc: 'è®°å½•äº†å¯ä»¥ç»•åˆ°æ•Œäººåæ–¹çš„ç§˜å¯†å°è·¯ã€‚', performance_boost: 40 },
    'shen_jun_zhan_ma': { name: 'ç¥éªçš„æˆ˜é©¬', type: 'çå“', icon: 'fa-horse', desc: 'ä¸€åŒ¹ç™¾é‡ŒæŒ‘ä¸€çš„è‰¯é©¹ï¼Œèƒ½å¢å¼ºæˆ˜åœºçªå‡»èƒ½åŠ›ã€‚' },
    'chi_dian': { name: 'èµ¤ç”µ', type: 'çå“', icon: 'fa-horse-head', desc: 'ä¼ è¯´ä¸­æœ‰â€œæ±—è¡€â€è¡€ç»Ÿçš„å®é©¬ï¼Œç¥éªéå‡¡ã€‚' },
    'xiao_wei_tie_fu': { name: 'æ ¡å°‰çš„é“ç¬¦', type: 'çå“', icon: 'fa-id-card-alt', desc: 'ç”¨äºè°ƒåŠ¨ç™¾äººé˜Ÿä»¥ä¸‹å£«å…µçš„ä¿¡ç‰©ã€‚', performance_boost: 20 },
    'shuai_yin': { name: 'å¸…å°', type: 'çå“', icon: 'fa-stamp', desc: 'è­·åœ‹å°‡è»çš„å¸¥å°ï¼Œèƒ½å¤§å¹…æå‡éƒ¨éšŠå£«æ°£å’Œä½ çš„å¨æœ›ã€‚' },
    'wu_mu_bing_fa': { name: 'æ­¦ç©†å…µæ³•', type: 'çå“', icon: 'fa-book', desc: 'ä½ è¦ªæ‰‹æ’°å¯«çš„æ› ä¸–å…µæ›¸ï¼Œå¯è¢«å­å—£ç¹¼æ‰¿ã€‚' },
    // å•†è´¾ç‰©å“
    'shang_deng_cha_ye': { name: 'ä¸Šç­‰èŒ¶å¶', type: 'çå“', icon: 'fa-leaf', desc: 'äº§è‡ªæ±Ÿå—çš„ä¸Šç­‰èŒ¶å¶ï¼Œæ˜¯èµ ç¤¼ä½³å“ã€‚' },
    'jiang_nan_gong_huo_shang': { name: 'æ±Ÿå—ä¾›è´§å•†åå½•', type: 'æ–‡ä¹¦', icon: 'fa-address-book', desc: 'è®°å½•äº†ä¸€æ¡éšè—çš„ä½ä»·è¿›è´§æ¸ é“ã€‚', performance_boost: 30 },
    'si_chou_zhi_lu_can_pian': { name: 'ä¸ç»¸ä¹‹è·¯åœ°å›¾æ®‹ç‰‡', type: 'æ–‡ä¹¦', icon: 'fa-map', desc: 'é€šå¾€ä¼ è¯´ä¸­éåœ°é»„é‡‘çš„è¥¿åŸŸä¹‹è·¯çš„çº¿ç´¢ã€‚', performance_boost: 20 },
    'yu_ci_le_shan_hao_shi': { name: 'å¾¡èµâ€œä¹å–„å¥½æ–½â€ç‰ŒåŒ¾', type: 'çå“', icon: 'fa-award', desc: 'çš‡å¸å¾¡èµçš„ç‰ŒåŒ¾ï¼Œæ˜¯èº«ä»½å’Œå£°æœ›çš„è±¡å¾ã€‚' },
    'liang_huai_yan_yin': { name: 'ä¸¤æ·®ç›å¼•ï¼ˆäº”å¹´ï¼‰', type: 'æ–‡ä¹¦', icon: 'fa-file-signature', desc: 'æœªæ¥äº”å¹´ä¸¤æ·®åœ°åŒºçš„é£Ÿç›ç‹¬å®¶ç»è¥æƒï¼Œä»·å€¼è¿åŸã€‚', performance_boost: 20 },
    'hai_dao_cang_bao_tu': { name: 'æµ·ç›—çš„è—å®å›¾', type: 'æ–‡ä¹¦', icon: 'fa-treasure-chest', desc: 'ä¸€å¼ æç»˜äº†æµ·å¤–æŸå¤„å·¨å¤§å®è—çš„åœ°å›¾ã€‚' },
    'hong_ding_shang_ren_guan_mao': { name: 'çº¢é¡¶å•†äººå®˜å¸½', type: 'çå“', icon: 'fa-user-tie', desc: 'å®˜å±…ä¸€å“çš„è¯æ˜ï¼Œå•†äººçš„è‡³é«˜è£èª‰ã€‚' },
    // æ–‡äººå¢¨å®¢ç‰©å“
    'chuan_jia_yu_pei': { name: 'ä¼ å®¶ç‰ä½©', type: 'çå“', icon: 'fa-gem', desc: 'å®¶æ—æµä¼ ä¸‹æ¥çš„ç‰ä½©ï¼Œä»·å€¼ä¸è²ä½†æ„ä¹‰éå‡¡ã€‚' },
    'hu_zhou_bi_hui_zhou_mo': { name: 'æ¹–å·ç¬”ã€å¾½å·å¢¨', type: 'çå“', icon: 'fa-paint-brush', desc: 'ä¸€å¥—é¡¶çº§çš„æ–‡æˆ¿å››å®ï¼Œèƒ½æå‡åˆ›ä½œè´¨é‡ã€‚' },
    'yan_hui_qing_jian': { name: 'å®´ä¼šè¯·æŸ¬', type: 'æ¶ˆè€—', icon: 'fa-envelope-open-text', desc: 'äº¬ä¸­æƒè´µä¸¾åŠå®´ä¼šçš„è¯·æŸ¬ã€‚', performance_boost: 15 },
    'wen_cai_feng_liu_pai_bian': { name: 'å¾¡èµâ€œæ–‡é‡‡é£æµâ€ç‰ŒåŒ¾', type: 'çå“', icon: 'fa-award', desc: 'çš‡å¸å¯¹ä½ æ‰åçš„æœ€é«˜è®¤å¯ã€‚', performance_boost: 30 },
    'gu_ji_shan_ben': { name: 'å¤ç±å–„æœ¬', type: 'çå“', icon: 'fa-book-reader', desc: 'ä¸€æœ¬çç¨€çš„å¤ä»£ä¹¦ç±åˆ»æœ¬ã€‚', performance_boost: 35 },
    'chuan_shi_zhi_zuo': { name: 'ä¼ ä¸–ä¹‹ä½œ', type: 'çå“', icon: 'fa-scroll', desc: 'ä½ å‘•å¿ƒæ²¥è¡€åˆ›ä½œå‡ºçš„ä¸æœ½åä½œã€‚' },
    // æ±Ÿæ¹–æ¸¸ä¾ ç‰©å“
    'tong_ji_fan_xing_zong': { name: 'é€šç¼‰çŠ¯çš„è¡Œè¸ª', type: 'æ–‡ä¹¦', icon: 'fa-user-secret', desc: 'ä¸€ä»½è®°å½•äº†æŸä¸ªé«˜é¢æ‚¬èµé€šç¼‰çŠ¯ä½ç½®çš„æƒ…æŠ¥ã€‚', performance_boost: 30 },
    'cang_bao_tu_can_pian': { name: 'è—å®å›¾æ®‹ç‰‡', type: 'æ–‡ä¹¦', icon: 'fa-map', desc: 'æŒ‡å‘å‰æœå¤§å°†å†›å®è—çš„åœ°å›¾ç¢ç‰‡ã€‚' },
    'zhai_zhu_gui_tou_dao': { name: 'å¯¨ä¸»çš„é¬¼å¤´åˆ€', type: 'çå“', icon: 'fa-khanda', desc: 'é»‘é£å¯¨æ€»å¯¨ä¸»çš„æ­¦å™¨ï¼ŒåŠ¿å¤§åŠ›æ²‰ã€‚' },
    'jiu_yang_can_ye': { name: 'ã€Šä¹é˜³ç¥åŠŸã€‹æ®‹é¡µ', type: 'æ–‡ä¹¦', icon: 'fa-book-dead', desc: 'ä¼ è¯´ä¸­çš„é¡¶çº§å†…åŠŸå¿ƒæ³•æ®‹é¡µï¼Œä¼šå¼•æ¥æ— æ•°äººçš„è§Šè§ã€‚' },
    'shen_bing': { name: 'ç¥å…µ', type: 'çå“', icon: 'fa-meteor', desc: 'ç”±å¤©å¤–é™¨é“ä¸ºä½ é‡èº«æ‰“é€ çš„ç‹¬ä¸€æ— äºŒçš„ç¥å…µåˆ©å™¨ã€‚' },
    'tian_xia_di_yi_xin_wu': { name: 'å¤©ä¸‹ç¬¬ä¸€çš„ä¿¡ç‰©', type: 'çå“', icon: 'fa-crown', desc: 'åå±±è®ºå‰‘èƒœè€…çš„ä¿¡ç‰©ï¼Œæ˜¯æ­¦æ—è‡³å°Šçš„è±¡å¾ã€‚' },
    // ä¸»æ¯ç‰©å“
    'zi_bu_tang_pin': { name: 'æ»‹è¡¥æ±¤å“', type: 'æ¶ˆè€—', icon: 'fa-utensil-spoon', desc: 'äº²æ‰‹åˆ¶ä½œçš„æ»‹è¡¥æ±¤å“ï¼Œæ˜¯è¡¨è¾¾å­å¿ƒçš„å¥½æ–¹æ³•ã€‚', performance_boost: 10 },
    'mu_qin_ti_ji_shou_shi': { name: 'æ¯äº²çš„ä½“å·±é¦–é¥°', type: 'çå“', icon: 'fa-ring', desc: 'æ¯äº²åœ¨ä½ å›é—¨æ—¶æ‚„æ‚„å¡ç»™ä½ çš„ç§æˆ¿é¦–é¥°ã€‚' },
    'fu_ku_yao_chi': { name: 'åºœåº“çš„é’¥åŒ™', type: 'çå“', icon: 'fa-key', desc: 'è±¡å¾ä¸»æ¯æƒåŠ›çš„åºœåº“é’¥åŒ™ã€‚', performance_boost: 20 },
    'huang_hou_shang_ci_zhu_chai': { name: 'çš‡åèµèµçš„ç é’—', type: 'çå“', icon: 'fa-gem', desc: 'çš‡åå¨˜å¨˜äº²æ‰‹èµèµçš„ç é’—ï¼Œåœ¨è´µå¦‡åœˆä¸­æ˜¯åœ°ä½çš„è±¡å¾ã€‚' },
    'chuan_jia_jia_xun': { name: 'ä¼ å®¶å®¶è®­', type: 'çå“', icon: 'fa-scroll', desc: 'ä½ ä¸€ç”Ÿæ²»å®¶ç»éªŒçš„ç»“æ™¶ï¼Œå¯è¢«åä»£ç»§æ‰¿ã€‚' },
    // ç»£å¨˜ç‰©å“
    'jing_zhi_he_bao': { name: 'ç²¾è‡´è·åŒ…', type: 'æ¶ˆè€—', icon: 'fa-wallet', desc: 'ä½ äº²æ‰‹ç¼åˆ¶çš„è·åŒ…ï¼Œæ˜¯åŒ–è§£é‚»é‡ŒçŸ›ç›¾çš„å°ç¤¼ç‰©ã€‚', performance_boost: 10 },
    'gui_fu_ren_xin_wu': { name: 'è´µå¤«äººçš„ä¿¡ç‰©', type: 'çå“', icon: 'fa-stamp', desc: 'å®‰å›½å…¬å¤«äººçš„ä¿¡ç‰©ï¼Œæ˜¯ä½ è¿›å…¥ä¸Šæµç¤¾ä¼šçš„æ•²é—¨ç –ã€‚' },
    'chu_ru_gong_jin_jin_pai': { name: 'å‡ºå…¥å®«ç¦é‡‘ç‰Œ', type: 'çå“', icon: 'fa-id-badge', desc: 'æ‹¥æœ‰æ­¤é‡‘ç‰Œï¼Œä½ å¯ä»¥è‡ªç”±å‡ºå…¥åå®«ï¼Œé¢è§å«”å¦ƒã€‚' },
    // å¥³åŒ»ç‰©å“
    'yi_zhong_cao_yao': { name: 'å¼‚ç§è‰è¯', type: 'ææ–™', icon: 'fa-leaf', desc: 'ä¸€ç§æœªè¢«åŒ»ä¹¦è®°è½½çš„å¥‡ç‰¹è‰è¯ï¼Œä¹Ÿè®¸æœ‰ç‰¹æ®ŠåŠŸæ•ˆã€‚', performance_boost: 20 },
    'du_jia_yao_fang': { name: 'ç‹¬å®¶è¯æ–¹', type: 'æ–‡ä¹¦', icon: 'fa-file-medical', desc: 'ä½ ç‹¬åˆ›çš„ä¸“æ²»é£æ¹¿çš„åæ–¹ã€‚', performance_boost: 40 },
    'bai_nian_ling_zhi': { name: 'ç™¾å¹´çµèŠ', type: 'ææ–™', icon: 'fa-magic', desc: 'æä¸ºç½•è§çš„çç¨€è¯æï¼Œæ˜¯ç‚¼åˆ¶é«˜çº§ä¸¹è¯çš„ä¸»æ–™ã€‚' },
    'nan_hai_zhen_zhu': { name: 'å—æµ·çç ', type: 'çå“', icon: 'fa-gem', desc: 'ä¾¯çˆµå¤«äººèµ äºˆçš„è°¢ç¤¼ï¼Œåœ†æ¶¦é¥±æ»¡ï¼Œä»·å€¼è¿åŸã€‚' },
    'yang_yan_dan': { name: 'å…»é¢œä¸¹', type: 'æ¶ˆè€—', icon: 'fa-pills', desc: 'ä½ ç ”åˆ¶çš„ç‹¬å®¶ä¸¹è¯ï¼Œèƒ½è®©å®¹é¢œç„•å‘ã€‚' },
    'xu_ming_wan': { name: 'ç»­å‘½ä¸¸', type: 'æ¶ˆè€—', icon: 'fa-capsules', desc: 'èƒ½åœ¨å±æ€¥æ—¶åˆ»åŠä½æ€§å‘½çš„ä¿å‘½ä¹‹ç‰©ã€‚' },
    'xing_lin_yi_an': { name: 'ææ—åŒ»æ¡ˆ', type: 'çå“', icon: 'fa-book-medical', desc: 'ä½ ä¸€ç”Ÿè¡ŒåŒ»ç»éªŒçš„ç»“æ™¶ï¼Œå¯è¢«å­å—£ç»§æ‰¿ã€‚' },
    'tai_yi_yuan_jin_pai': { name: 'å¤ªåŒ»é™¢é‡‘ç‰Œ', type: 'çå“', icon: 'fa-id-badge', desc: 'ä½œä¸ºå¤ªåŒ»é™¢ç¬¬ä¸€ä½å¥³åŒ»å®˜çš„èº«ä»½è±¡å¾ã€‚', performance_boost: 10 },
    // æƒ…æŠ¥é¦–é¢†ç‰©å“
    'mi_ma_ben': { name: 'å¯†ç æœ¬', type: 'æ–‡ä¹¦', icon: 'fa-key', desc: 'ä¸€ç§æ— äººèƒ½ç ´çš„å¯†ç æœ¯ï¼Œèƒ½æå¤§æå‡æƒ…æŠ¥çš„å®‰å…¨æ€§ã€‚', performance_boost: 45 },
    'ming_shi_bian_e': { name: 'åå¸ˆåŒ¾é¢', type: 'çå“', icon: 'fa-award', desc: 'ç”±å‡ºå¸ˆé«˜å¾’æ‰€èµ ï¼Œæ˜¯ä½ æ¡ƒææ»¡å¤©ä¸‹çš„è¯æ˜ã€‚æŒæœ‰æ­¤ç‰©ï¼Œå£°æœ›ä¼šæ½œç§»é»˜åŒ–åœ°æå‡ã€‚' },
    'huang_di_mi_mi_xin_wu': { name: 'çš‡å¸çš„ç§˜å¯†ä¿¡ç‰©', type: 'çå“', icon: 'fa-dragon', desc: 'æ–°çš‡ç™»åŸºåäº¤ç»™ä½ çš„ä¿¡ç‰©ï¼Œè§æ­¤ç‰©å¦‚è§çš‡å¸æœ¬äººã€‚' },
    'oath_bamboo_slip': { id: 'oath_bamboo_slip', name: 'ç›Ÿèª“ç«¹ç®€', icon: 'fa-scroll', type: 'ææ–™', desc: 'æ–‡å®˜å¤„ç†å…¬åŠ¡æ—¶ç”¨ä»¥è®°å½•ç›Ÿèª“çš„ç«¹ç®€ï¼Œè´¨åœ°åšéŸ§ï¼Œè±¡å¾ç€ä¸å˜çš„æ‰¿è¯ºã€‚' },
    'battle_worn_tassel': { id: 'battle_worn_tassel', name: 'å†æˆ˜å‰‘ç©—', icon: 'fa-khanda', type: 'ææ–™', desc: 'ä»ç™¾æˆ˜ä¸æŒ çš„ä½©å‰‘ä¸Šå–ä¸‹çš„å‰‘ç©—ï¼Œæµ¸æŸ“ç€æ²™åœºè±ªæƒ…ä¸å®ˆæŠ¤ä¹‹æ„ã€‚' },
    'abacus_bead_bracelet': { id: 'abacus_bead_bracelet', name: 'ç²ç‘ç®—ç›˜ç ', icon: 'fa-calculator', type: 'ææ–™', desc: 'å•†è´¾ä»¬ç”¨æœ€åè´µçš„æœ¨æ–™æ‰“ç£¨çš„ç®—ç›˜ç ï¼Œè±¡å¾ç€ç²¾æ‰“ç»†ç®—çš„çˆ±æ„ã€‚' },
    'ink_heart_stone': { id: 'ink_heart_stone', name: 'å¢¨å¿ƒçŸ³', icon: 'fa-paint-brush', type: 'ææ–™', desc: 'æ–‡äººå¢¨å®¢è§†è‹¥çå®çš„çŸ³ç šï¼Œç£¨å‡ºçš„å¢¨å¸¦æœ‰å¥‡é¦™ï¼Œç”¨ä»¥ä¹¦å†™æƒ…è¯—æœ€ä½³ã€‚' },
    'heroic_wine_gourd': { id: 'heroic_wine_gourd', name: 'ä¾ ä¹‰é…’è‘«', icon: 'fa-wine-bottle', type: 'ææ–™', desc: 'æ±Ÿæ¹–æ¸¸ä¾ éšèº«æºå¸¦çš„é…’è‘«èŠ¦ï¼Œè£…è¿‡æœ€çƒˆçš„é…’ï¼Œä¹Ÿè£…ç€æœ€çœŸçš„æƒ…ã€‚' },
    'seven_ingenuity_thread': { id: 'seven_ingenuity_thread', name: 'ä¸ƒå·§ä¸çº¿', icon: 'fa-ribbon', type: 'ææ–™', desc: 'ä¸»æ¯åœ¨ä¹å·§èŠ‚æ—¶æ±‚å¾—çš„ä¸ƒå½©ä¸çº¿ï¼Œæ®è¯´èƒ½ç¼–ç»‡å‡ºä¸–ä¸Šæœ€ç‰¢å›ºçš„åŒå¿ƒç»“ã€‚' },
    'phoenix_tail_pin': { id: 'phoenix_tail_pin', name: 'å‡¤å°¾é‡‘é’ˆ', icon: 'fa-cut', type: 'ææ–™', desc: 'ç»£å¨˜æ¢¦å¯ä»¥æ±‚çš„å¾¡èµé‡‘é’ˆï¼Œèƒ½ç»£å‡ºæ ©æ ©å¦‚ç”Ÿçš„å‡¤å‡°ï¼Œè±¡å¾ç€è‡³é«˜æ— ä¸Šçš„çˆ±ã€‚' },
    'longevity_herb': { id: 'longevity_herb', name: 'é•¿ç”Ÿè‰', icon: 'fa-leaf', type: 'ææ–™', desc: 'å¥³åŒ»è¸éåƒå±±å¯»å¾—çš„çç¨€è‰è¯ï¼Œè™½ä¸èƒ½é•¿ç”Ÿï¼Œå´ä»£è¡¨ç€æ„¿å¯¹æ–¹ä¸€ä¸–å®‰åº·çš„å¿ƒæ„ã€‚' },
'invisible_ink': { id: 'invisible_ink', name: 'æ— è¿¹å¢¨', icon: 'fa-feather-alt', type: 'ææ–™', desc: 'æƒ…æŠ¥é¦–é¢†ç”¨ç‹¬é—¨ç§˜æ³•è°ƒåˆ¶çš„å¢¨æ°´ï¼Œå†™ä¸‹çš„æƒ…ä¹¦å”¯æœ‰çœŸçˆ±ä¹‹äººå¯è§ã€‚' },
'wan_min_san': { id: 'wan_min_san', name: 'ä¸‡æ°‘ä¼', type: 'çå“', icon: 'fa-umbrella', desc: 'æŒæœ‰è€…å“å¾·æ¯æœˆè‡ªåŠ¨+1ï¼Œä¸”åœ¨ä»»ä½•åœ°åŒºéƒ½ä¸ä¼šè¢«åœ°ç—éªšæ‰°ã€‚' },
'xian_bei_yin_xin': { id: 'xian_bei_yin_xin', name: 'å…ˆè¾ˆå°ä¿¡', type: 'çå“', icon: 'fa-stamp', desc: 'æ ¹æ®ä¸Šä¸€ä»£çš„èŒä¸šï¼Œæä¾›å¼ºå¤§çš„è¢«åŠ¨åŠ æˆã€‚' },
'zhi_jiao_ming_lu': { id: 'zhi_jiao_ming_lu', name: 'çŸ¥äº¤åå½•', type: 'æ–‡ä¹¦', icon: 'fa-address-book', desc: 'å¿…å®šè§¦å‘â€œæ—§æ—¶ç›¸è¯†â€äº‹ä»¶ï¼Œä¸”ä¸æ•…äººä¹‹å­ï¼ˆæœ€å¤š3ä½ï¼‰åˆå§‹å…³ç³»ä¸ºâ€œæƒºæƒºç›¸æƒœâ€ã€‚' },
'wu_zi_tian_shu': { id: 'wu_zi_tian_shu', name: 'æ— å­—å¤©ä¹¦', type: 'çå“', icon: 'fa-book-dead', desc: 'æ¯å›åˆå¯è¿›è¡Œä¸€æ¬¡â€œå‚æ‚Ÿâ€ï¼Œéšæœºæå‡ä¸€é¡¹åŸºç¡€å±æ€§5-10ç‚¹ã€‚' },
// [é‡è¦] æ­¤å¤„ç”¨â€œæ—·ä¸–é—ç‰©â€ç‰ˆæœ¬è¦†ç›–åŸæœ‰çš„æ™®é€šâ€œä¼ å®¶ç‰ä½©â€
'chuan_jia_yu_pei': { id: 'chuan_jia_yu_pei', name: 'ä¼ å®¶ç‰ä½©', type: 'çå“', icon: 'fa-gem', desc: 'ä½©æˆ´è€…é­…åŠ›+15, ç¤¼ä»ª+15ï¼Œä¸”å­å—£è¯ç”Ÿæ—¶ï¼Œæœ‰æ›´é«˜å‡ ç‡è·å¾—æ­£é¢æ€§æ ¼ç‰¹è´¨ã€‚' }
};

const APPRENTICE_GRADUATION_REQUIREMENTS = {
    'civilian': { wisdom: 80, etiquette: 70, virtue: 70, desc: "æˆä¸ºæ ‹æ¢ä¹‹æ‰ (éœ€æ™ºæ…§ã€ç¤¼ä»ªã€å“å¾·è¾¾æ ‡)" },
    'warrior': { martial: 80, health: 90, virtue: 60, desc: "æˆä¸ºå‹‡æ­¦ä¹‹å°† (éœ€æ­¦å­¦ã€å¥åº·ã€å“å¾·è¾¾æ ‡)" },
    'merchant': { wisdom: 80, charm: 70, desc: "æˆä¸ºå•†ç•Œå¥‡æ‰ (éœ€æ™ºæ…§ã€é­…åŠ›è¾¾æ ‡)" },
    'scholar': { talent: 90, charm: 70, reputation: 60, desc: "æˆä¸ºä¸€ä»£åå£« (éœ€æ‰æƒ…ã€é­…åŠ›ã€å£°æœ›è¾¾æ ‡)" },
    'ranger': { martial: 90, virtue: 70, health: 80, desc: "æˆä¸ºæ±Ÿæ¹–å¤§ä¾  (éœ€æ­¦å­¦ã€å“å¾·ã€å¥åº·è¾¾æ ‡)" },
    'matron': { etiquette: 80, virtue: 80, wisdom: 60, desc: "æˆä¸ºæŒå®¶å…¸èŒƒ (éœ€ç¤¼ä»ªã€å“å¾·ã€æ™ºæ…§è¾¾æ ‡)" },
    'embroiderer': { talent: 90, charm: 70, etiquette: 60, desc: "æˆä¸ºç»‡é€ å¤§å®¶ (éœ€æ‰æƒ…ã€é­…åŠ›ã€ç¤¼ä»ªè¾¾æ ‡)" },
    'doctor': { wisdom: 80, virtue: 80, talent: 60, desc: "æˆä¸ºææ—åœ£æ‰‹ (éœ€æ™ºæ…§ã€åŒ»å¾·ã€æ‰æƒ…è¾¾æ ‡)" },
    'spy_master': { wisdom: 90, charm: 80, desc: "æˆä¸ºæš—å½±ä¹‹ä¸» (éœ€æ™ºæ…§ã€é­…åŠ›è¾¾æ ‡)" },
    'default': { wisdom: 60, talent: 60, desc: "å­¦æœ‰æ‰€æˆ (éœ€æ™ºæ…§ã€æ‰æƒ…è¾¾æ ‡)" } // å¸ˆå‚…æ— èŒä¸šæ—¶çš„å¤‡ç”¨æ¡ä»¶
};
// =======================================================================
// ===================== ã€æ–°å¢ã€‘ä¹‰ç»“é‡‘å…°ä¸“å±äº‹ä»¶åº“ =====================
// =======================================================================
const SWORN_SIBLING_EVENTS = {
    'teach_skill': [
        {
            title: "ä¼ æˆæŠ€è‰º",
            desc: "ä½ ä¸ä¹‰å…„/å¦¹åˆ‡ç£‹æ­¦è‰ºåï¼Œå¯¹æ–¹è§ä½ äºæŸä¸€æ‹›å¼ä¸Šé¢‡æœ‰çª’ç¢ï¼Œä¸»åŠ¨æå‡ºä¸ºä½ æŒ‡ç‚¹ä¸€äºŒã€‚",
            options: [
                { text: "è™šå¿ƒæ±‚æ•™", effects: { attributes: { martial: 10 } }, log: "åœ¨TAçš„æŒ‡ç‚¹ä¸‹ï¼Œä½ èŒ…å¡é¡¿å¼€ï¼Œæ­¦å­¦å¤§è¿›ï¼" },
                { text: "æ¢è®¨äº¤æµ", effects: { attributes: { martial: 5, wisdom: 5 } }, log: "ä½ ä»¬äº’ç›¸å°è¯ï¼Œå„æœ‰æ”¶è·ã€‚" },
                { text: "å¿ƒé«˜æ°”å‚²", effects: { relationship: { favor: -10 } }, log: "ä½ è®¤ä¸ºè‡ªå·±çš„æ­¦å­¦åˆ«å…·ä¸€æ ¼ï¼Œå©‰æ‹’äº†å¯¹æ–¹çš„å¥½æ„ã€‚" }
            ]
        },
        {
            title: "äººç”Ÿç»éªŒ",
            desc: "è§ä½ è¿‘æ—¥ä¸ºæŸäº‹çƒ¦å¿§ï¼Œä½ çš„ä¹‰å…„/å¦¹ä¸ä½ æœˆä¸‹å°é…Œï¼Œå‘ä½ ä¼ æˆäº†TAè¡Œèµ°æ±Ÿæ¹–å¤šå¹´çš„ç»éªŒã€‚",
            options: [
                { text: "è®¤çœŸå€¾å¬", effects: { attributes: { wisdom: 8, charm: 5 } }, log: "TAçš„ç»éªŒä¹‹è°ˆè®©ä½ å—ç›ŠåŒªæµ…ï¼Œä½ çœ‹å¾…é—®é¢˜çš„æ–¹å¼ä¹Ÿæ›´æˆç†Ÿäº†ã€‚" },
                { text: "ä¸ä»¥ä¸ºç„¶", effects: { relationship: { favor: -8 } }, log: "ä½ è§‰å¾—TAçš„ç»éªŒå·²ç»è¿‡æ—¶ï¼Œå¯¹æ–¹è§ä½ å¬ä¸è¿›å»ï¼Œä¾¿ä¸å†å¤šè¨€ã€‚" },
                { text: "åè¿‡æ¥å®‰æ…°TA", effects: { relationship: { favor: 10 } }, log: "ä½ è¡¨ç¤ºè‡ªå·±å¹¶æ— å¤§ç¢ï¼Œåè¿‡æ¥å®‰æ…°TAä¸è¦ä¸ºä½ æ‹…å¿ƒï¼Œå¯¹æ–¹å¯¹ä½ çš„ä½“è´´å¾ˆå—ç”¨ã€‚" }
            ]
        }
    ],
    'overcome_difficulty': [
        {
            title: "å…±æ¸¡éš¾å…³ï¼šæµè¨€èœšè¯­",
            desc: "æœ€è¿‘äº¬åŸä¸­å‡ºç°äº†ä¸€äº›å¯¹ä½ ä¸åˆ©çš„æµè¨€ï¼Œè®©ä½ å£°æœ›å—æŸã€‚ä½ çš„ä¹‰å…„/å¦¹å¾—çŸ¥åï¼Œç«‹åˆ»å‰æ¥å¯»ä½ å•†è®®å¯¹ç­–ã€‚",
            options: [
                { text: "è¯·TAå¸®å¿™è°ƒæŸ¥æºå¤´", effects: { reputation: 10 }, log: "TAåŠ¨ç”¨è‡ªå·±çš„äººè„‰ï¼Œå¾ˆå¿«å¸®ä½ æŸ¥æ¸…äº†æµè¨€æºå¤´ï¼Œå¹¶åŠ©ä½ æ¾„æ¸…äº†äº‹å®ã€‚" },
                { text: "ä¸€åŒå€Ÿé…’æ¶ˆæ„", effects: { relationship: { favor: 10 }, attributes: { health: -5 } }, log: "ä½ ä»¬ç—›é¥®ä¸€ç•ªï¼Œè™½æ— ç›Šäºäº‹ï¼Œä½†è¿™ä»½æƒ…è°Šè®©ä½ å€æ„Ÿæ¸©æš–ã€‚" },
                { text: "è¡¨ç¤ºæ— éœ€æ‹…å¿ƒ", effects: { attributes: { virtue: 5 } }, log: "ä½ è¡¨ç¤ºæ¸…è€…è‡ªæ¸…ï¼Œè¿™ä»½å¦è¡è®©TAé¢‡ä¸ºæ¬£èµã€‚" }
            ]
        },
        {
            title: "å…±æ¸¡éš¾å…³ï¼šè´¢åŠ¡å±æœº",
            desc: "ä½ å› ä¸€ç¬”æŠ•èµ„å¤±è´¥ï¼Œé™·å…¥äº†è´¢åŠ¡å±æœºã€‚å¯¹æ–¹å¾—çŸ¥åï¼ŒäºŒè¯ä¸è¯´å¸¦ç€ä¸€ç®±é“¶ä¸¤å‰æ¥ã€‚",
            options: [
                { text: "æ„Ÿæ¿€æ”¶ä¸‹", effects: { wealth: 5000, relationship: { favor: 20 } }, log: "â€œä½ æˆ‘ä¹‹é—´ï¼Œä½•é¡»è¨€è°¢ï¼â€TAä¸ºä½ é›ªä¸­é€ç‚­ï¼Œè§£äº†ä½ çš„ç‡ƒçœ‰ä¹‹æ€¥ã€‚" },
                { text: "åªå€Ÿä¸€éƒ¨åˆ†", effects: { wealth: 1000, relationship: { favor: 10 }, attributes: { virtue: 5 } }, log: "ä½ åªå€Ÿäº†ä¸€éƒ¨åˆ†åº”æ€¥ï¼Œè¿™ä»½é£éª¨è®©TAæ›´åŠ æ•¬é‡ã€‚" },
                { text: "å©‰è¨€è°¢ç»", effects: { relationship: { favor: -10, devotion: -15 } }, log: "ä½ ä¸æƒ³å› ä¸ºé‡‘é’±è®©è¿™ä»½æƒ…è°Šè’™å°˜ï¼Œä½†ä½ çš„æ‹’ç»ä¹Ÿè®©TAè§‰å¾—ä½ å¤ªè¿‡è§å¤–ã€‚" }
            ]
        }
    ],
    'ask_help': [
        {
            title: "ä¸¤è‚‹æ’åˆ€ï¼šå¯»äºº",
            desc: "ä½ éœ€è¦å¯»æ‰¾ä¸€ä½å¤±æ•£å¤šå¹´çš„æ•…äººï¼Œä½†æ¯«æ— å¤´ç»ªï¼Œåªå¥½æ±‚åŠ©äºäººè„‰å¹¿é˜”çš„ä¹‰å…„/å¦¹ã€‚",
            options: [
                { text: "è¯·æ±‚å¸®åŠ©", effects: { reputation: 5 }, log: "ä¸å‡ºåŠæœˆï¼ŒTAä¾¿å¸®ä½ æ‰¾åˆ°äº†é‚£äººï¼Œè®©ä½ äº†å´äº†ä¸€æ¡©å¿ƒäº‹ã€‚" },
                { text: "æä¾›é…¬é‡‘", effects: { wealth: -500, reputation: 5 }, log: "ä½ åšæŒæ”¯ä»˜é…¬é‡‘ï¼Œå¯¹æ–¹è™½ä¸æƒ…æ„¿ï¼Œä½†è¿˜æ˜¯æ”¶ä¸‹äº†ã€‚" },
                { text: "è¿˜æ˜¯ç®—äº†", effects: {}, log: "ä½ è§‰å¾—æ­¤äº‹å¤ªè¿‡éº»çƒ¦ï¼Œæœ€ç»ˆæ²¡æœ‰å¼€å£ã€‚" }
            ]
        },
        {
            title: "ä¸¤è‚‹æ’åˆ€ï¼šå¯»ç‰©",
            desc: "ä½ éœ€è¦ä¸€å‘³çç¨€è¯ææ•‘æ€¥ï¼Œå¬é—»ä½ çš„ä¹‰å…„/å¦¹æ°å¥½çŸ¥æ™“å…¶ä¸‹è½ã€‚",
            options: [
                { text: "å¼€å£æ±‚åŠ©", effects: { item: { id: 'bai_nian_ling_zhi', amount: 1 } }, log: "TAå¬é—»åç«‹åˆ»å°†è‡ªå·±çš„çè—èµ äºˆä½ ï¼Œå¹¶ç¥ä½ æ¸¡è¿‡éš¾å…³ã€‚" },
                { text: "é«˜ä»·æ±‚è´­", effects: { wealth: -1000, item: { id: 'bai_nian_ling_zhi', amount: 1 } }, log: "ä½ èŠ±è´¹é‡é‡‘ä»TAæ‰‹ä¸­è´­å¾—æ­¤ç‰©ï¼Œè™½è§£äº†ç‡ƒçœ‰ä¹‹æ€¥ï¼Œä½†å…³ç³»ç•¥æ˜¾ç”Ÿåˆ†ã€‚" },
                { text: "å¦å¯»ä»–æ³•", effects: { relationship: { favor: -5 } }, log: "ä½ æ²¡æœ‰å‘TAæ±‚åŠ©ï¼ŒTAäº‹åå¾—çŸ¥ï¼Œè§‰å¾—ä½ ä¿¡ä¸è¿‡TAã€‚" }
            ]
        }
    ],
    'discuss_plan': [
        {
            title: "å…±å•†å¤§äº‹ï¼šäº‹ä¸šè§„åˆ’",
            desc: "ä½ å¯¹æœªæ¥çš„äº‹ä¸šå‘å±•æœ‰äº›è¿·èŒ«ï¼Œä¾¿æ‰¾æ¥ä¹‰å…„/å¦¹ä¸€åŒå•†è®®ã€‚",
            options: [
                { text: "å¬å–TAçš„å»ºè®®", effects: { career_performance: 20, wisdom: 5 }, log: "TAçš„å»ºè®®ä¸€é’ˆè§è¡€ï¼Œä¸ºä½ çš„äº‹ä¸šæŒ‡æ˜äº†æ–¹å‘ã€‚" },
                { text: "å„æŠ’å·±è§", effects: { wisdom: 8 }, log: "ä½ ä»¬çš„è®¨è®ºæ¿€å‘äº†å½¼æ­¤çš„çµæ„Ÿï¼Œå¯¹æœªæ¥éƒ½æœ‰äº†æ›´æ¸…æ™°çš„è§„åˆ’ã€‚" },
                { text: "æœ€ç»ˆè¿˜æ˜¯è‡ªå·±å†³å®š", effects: { relationship: { favor: -5 } }, log: "ä½ å¬äº†ä¸€åœˆï¼Œæœ€åè¿˜æ˜¯å†³å®šæŒ‰è‡ªå·±çš„æƒ³æ³•æ¥ï¼Œè®©TAè§‰å¾—ç™½è´¹äº†ä¸€ç•ªå£èˆŒã€‚" }
            ]
        },
        {
            title: "å…±å•†å¤§äº‹ï¼šå­å¥³å©šäº‹",
            desc: "ä½ æ­£åœ¨ä¸ºå­å¥³çš„å©šäº‹å‘æ„ï¼Œä¾¿è¯·ä¹‰å…„/å¦¹æ¥å¸®å¿™å‚è¯¦ã€‚",
            options: [
                { text: "è¯·TAå¸®å¿™ç‰©è‰²", effects: {}, log: "TAæ‹èƒ¸è„¯ä¿è¯ï¼Œæ­¤äº‹åŒ…åœ¨TAèº«ä¸Šã€‚ä¸ä¹…åä¾¿ä¸ºä½ å¼•èäº†ä¸€ä½ä¸é”™çš„å€™é€‰äººã€‚" },
                { text: "åªæ˜¯ååè‹¦æ°´", effects: { relationship: { favor: 5 } }, log: "ä½ åªæ˜¯æƒ³æ‰¾ä¸ªäººå€¾è¯‰ï¼ŒTAè®¤çœŸåœ°å¬ä½ æŠ±æ€¨äº†ä¸€ä¸‹åˆã€‚" }
            ]
        }
    ],
    'borrow_money': [
        {
            title: "å€¾å›Šç›¸åŠ©ï¼šå€Ÿé’±",
            desc: "ä½ æœ€è¿‘æ‰‹å¤´æ‹®æ®ï¼Œæƒ³å‘ä¹‰å…„/å¦¹å€Ÿä¸€ç¬”é’±å‘¨è½¬ã€‚",
            options: [
                { text: "å€Ÿ500ä¸¤", effects: { wealth: 500, relationship: { favor: -2 } }, log: "TAå¾ˆçˆ½å¿«åœ°å€Ÿç»™äº†ä½ ã€‚" },
                { text: "å€Ÿ2000ä¸¤", effects: { wealth: 2000, relationship: { favor: -8 } }, log: "TAè™½ç„¶æœ‰äº›ä¸ºéš¾ï¼Œä½†è¿˜æ˜¯å‡‘äº†é’±ç»™ä½ ã€‚" },
                { text: "ç®—äº†ï¼Œä¸å¼€å£äº†", effects: {}, log: "ä½ æœ€ç»ˆè¿˜æ˜¯æ²¡èƒ½æ‹‰ä¸‹è„¸ã€‚" }
            ]
        },
        {
            title: "å€¾å›Šç›¸åŠ©ï¼šè¿˜é’±",
            desc: "ä½ å‡†å¤‡å¥½äº†ä¸€ç¬”é’±ï¼Œæ‰“ç®—è¿˜ç»™ä¹‹å‰èµ„åŠ©è¿‡ä½ çš„ä¹‰å…„/å¦¹ã€‚",
            options: [
                { text: "è¿æœ¬å¸¦åˆ©è¿˜", effects: { wealth: -600, relationship: { favor: 10 } }, log: "TAå¯¹ä½ çš„ä¿¡ä¹‰èµä¸ç»å£ã€‚" },
                { text: "åªè¿˜æœ¬é‡‘", effects: { wealth: -500 }, log: "ä½ è¿˜æ¸…äº†æ¬ æ¬¾ï¼Œä½ ä»¬çš„å¸ä¸¤æ¸…äº†ã€‚" },
                { text: "è¯·æ±‚å®½é™å‡ æ—¥", effects: { relationship: { favor: -15 } }, log: "TAè™½ç„¶åŒæ„äº†ï¼Œä½†çœ¼ç¥ä¸­éš¾æ©å¤±æœ›ã€‚" }
            ]
        }
    ]
};
// =======================================================================
// [æ›¿æ¢] è¯·ç”¨è¿™ä¸ªå®Œæ•´çš„ä»£ç å—æ›¿æ¢æ‚¨æ–‡ä»¶ä¸­ç°æœ‰çš„ CHILDHOOD_SWEETHEART_EVENTS_FEMALE_PERSPECTIVE å¯¹è±¡
const CHILDHOOD_SWEETHEART_EVENTS_FEMALE_PERSPECTIVE = {
    'event_1_kite': {
        id: 'event_1_kite',
        age_range: [12, 13], // ä¿®å¤ç‚¹ï¼šå¹´é¾„ä»10-12å²æ”¹ä¸º12-13å²
        description: "æ˜¥æ—¥åˆåï¼Œé£å’Œæ—¥ä¸½ï¼Œä½ çš„é’æ¢…ç«¹é©¬ä¸ºä½ æ”¾é£ä¸€åªä»–äº²æ‰‹æ‰çš„çº¸é¸¢ã€‚å¯æƒœé£å¤ªå¤§ï¼Œçº¸é¸¢çš„çº¿æ–­äº†ï¼ŒæŒ‚åœ¨äº†é«˜é«˜çš„æ ‘æ¢¢ä¸Šã€‚",
        options: [
            { text: "ã€ä»–å¥‹åŠ›çˆ¬æ ‘ã€‘", req: { martial: 20 }, effects: { bond: 5 }, log: "ä»–ä¸‰ä¸¤ä¸‹å°±çˆ¬ä¸Šæ ‘ä¸ºä½ å–å›äº†çº¸é¸¢ï¼Œä½ çœ‹åœ¨çœ¼é‡Œï¼Œè§‰å¾—ä»–è‹±å‹‡å¯é ã€‚" },
            { text: "ã€å®‰æ…°å¤±è½çš„ä»–ã€‘", req: {}, effects: { bond: 8 }, log: "ä»–æ²¡èƒ½å–å›çº¸é¸¢ï¼Œååˆ†æ²®ä¸§ã€‚ä½ å®‰æ…°ä»–è¯´çº¸é¸¢ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å¿ƒæ„ï¼Œä»–å¬åå¾ˆå—ç”¨ã€‚" },
            { text: "ã€ä½ æè®®ä¸€èµ·æƒ³åŠæ³•ã€‘", req: {}, effects: { bond: 10 }, log: "ä½ ä»¬æ‰¾æ¥é•¿é•¿çš„ç«¹ç«¿ï¼Œæœ€ç»ˆåˆåŠ›å°†çº¸é¸¢å–äº†ä¸‹æ¥ã€‚è¿™æ¬¡å°å°çš„åˆä½œï¼Œè®©ä½ ä»¬çš„å¿ƒè´´å¾—æ›´è¿‘ã€‚" }
        ]
    },
    'event_2_bookstore': {
        id: 'event_2_bookstore',
        age_range: [14, 15], // ä¿®å¤ç‚¹ï¼šå¾®è°ƒå¹´é¾„èŒƒå›´
        description: "ä½ ä¸ä»–ç›¸çº¦é€›ä¹¦å±€ã€‚ä½ åœ¨ä¸€æœ¬æ˜‚è´µçš„è¯—é›†å‰æµè¿è®¸ä¹…ï¼Œè™½å–œçˆ±å´èˆä¸å¾—ä¹°ã€‚",
        options: [
            { text: "ã€ä»–æ‚„æ‚„ä¹°ä¸‹é€ä½ ã€‘", req: {}, effects: { bond: 12, favor: 10 }, log: "åˆ†åˆ«æ—¶ï¼Œä»–å°†é‚£æœ¬è¯—é›†å¡åˆ°ä½ æ‰‹ä¸­ï¼Œè¯´æ˜¯ç»™ä½ çš„ç¤¼ç‰©ã€‚ä½ åˆæƒŠåˆå–œï¼Œæ„ŸåŠ¨ä¸å·²ã€‚" },
            { text: "ã€çº¦å®šå°†æ¥ä¸€èµ·ä¹°ã€‘", req: {}, effects: { bond: 8 }, log: "ä½ ä»¬çº¦å®šï¼Œç­‰å°†æ¥ä»–åŠŸæˆåå°±ï¼Œå†æ¥ä¹°ä¸‹è¿™æœ¬ä¹¦ï¼Œä¸€ä¸ªå…±åŒçš„çº¦å®šè®©ä½ ä»¬å¯¹æœªæ¥å……æ»¡æœŸå¾…ã€‚" },
            { text: "ã€ä½ æœ€ç»ˆæ²¡æœ‰ä¹°ã€‘", req: {}, effects: { bond: -3 }, log: "ä½ æœ€ç»ˆè¿˜æ˜¯æ”¾ä¸‹äº†ä¹¦ï¼Œä»–çœ‹åœ¨çœ¼é‡Œï¼Œä¹Ÿæœªå¤šè¨€ï¼Œæ°”æ°›æœ‰äº›æ²‰é—·ã€‚" }
        ]
    },
    'event_3_defend': {
        id: 'event_3_defend',
        age_range: [15, 16], // ä¿®å¤ç‚¹ï¼šå¾®è°ƒå¹´é¾„èŒƒå›´
        description: "å‡ ä¸ªçº¨ç»”å­å¼Ÿåœ¨è¡—ä¸Šå¯¹ä½ è¨€è¯­è½»è–„ï¼Œä»–æ€’ä¸å¯éï¼Œå†²ä¸Šå»ä¸å¯¹æ–¹ç†è®ºï¼Œç”šè‡³åŠ¨äº†æ‰‹ã€‚",
        options: [
            { text: "ã€ä¸ºä»–åŠ©å¨ã€‘", req: {}, effects: { bond: 15 }, log: "ä½ è§‰å¾—ä»–ä¸ºä½ æŒºèº«è€Œå‡ºçš„æ ·å­å¸…æäº†ï¼Œä½ ä»¬çš„å…³ç³»å› æ­¤é£é€Ÿå‡æ¸©ã€‚" },
            { text: "ã€æ‹‰ä½ä»–ï¼ŒåŠä»–å†·é™ã€‘", req: {}, effects: { bond: 8, favor: 5 }, log: "ä½ æ‹…å¿ƒä»–åƒäºï¼ŒåŠæ—¶æ‹‰ä½äº†ä»–ã€‚ä»–è™½æœ‰ä¸ç”˜ï¼Œä½†å¾ˆå¬ä½ çš„è¯ï¼Œè¿™è®©ä½ æ„Ÿåˆ°å®‰å¿ƒã€‚" },
            { text: "ã€ä¸ºä»–åŒ…æ‰ä¼¤å£ã€‘", req: {}, effects: { bond: 10, health: -5 }, log: "ä»–å—äº†äº›è½»ä¼¤ï¼Œä½ å¿ƒç–¼åœ°ä¸ºä»–åŒ…æ‰ï¼Œä»–ä¸è§‰å¾—ç–¼ï¼Œåè€Œå¾ˆå¼€å¿ƒã€‚" }
        ]
    },
    'event_4_sachet': {
        id: 'event_4_sachet',
        age_range: [16, 17], // ä¿®å¤ç‚¹ï¼šå¾®è°ƒå¹´é¾„èŒƒå›´
        description: "ä½ å‘ç°ï¼Œå¦ä¸€ä½åé—¨é—ºç§€é€äº†ä»–ä¸€ä¸ªäº²æ‰‹ç¼åˆ¶çš„é¦™å›Šï¼Œä»–ä¼¼ä¹å¹¶æœªæ‹’ç»ã€‚",
        options: [
            { text: "ã€å‡è£…ä¸çŸ¥ã€‘", req: {}, effects: { bond: -5 }, log: "ä½ é€‰æ‹©å°Šé‡ä»–çš„é€‰æ‹©ï¼Œå†…å¿ƒå´äº”å‘³æ‚é™ˆï¼Œä½ ä»¬çš„å…³ç³»å¯èƒ½å› æ­¤ç–è¿œã€‚" },
            { text: "ã€è´¨é—®ä»–ã€‘", req: {}, effects: { random: [{ chance: 0.6, bond: -8, log: "ä»–è§‰å¾—ä½ æ— ç†å–é—¹ï¼ŒäºŒäººä¸æ¬¢è€Œæ•£ã€‚" }, { chance: 0.4, bond: 5, log: "ä»–æ€¥å¿™è§£é‡Šï¼Œå¹¶è¡¨ç¤ºå¿ƒé‡Œåªæœ‰ä½ ï¼Œè®©ä½ çªƒå–œã€‚" }] } },
            { text: "ã€ç¼ä¸€ä¸ªæ›´å¥½çš„é¦™å›Šã€‘", req: { talent: 60 }, effects: { bond: 10, attributes: { talent: 2 } }, log: "ä½ è¿å¤œç¼åˆ¶äº†ä¸€ä¸ªæ›´ç²¾è‡´çš„é¦™å›Šé€ç»™ä»–ï¼Œä»–ç«‹åˆ»æ¢ä¸Šäº†ä½ çš„ã€‚ä½ çš„æ‰æƒ…å’Œå¿ƒæ„éƒ½èµ¢äº†ã€‚" }
        ]
    },
    'event_5_promise': {
        id: 'event_5_promise',
        age_range: [17, 18],
        description: "ä½ ä»¬åœ¨å±±é¡¶çœ‹æ—¥å‡ºï¼Œè°ˆåŠæœªæ¥ï¼Œä½ æœ‰äº›è¿·èŒ«åœ°é—®ä»–ï¼Œä»¥åä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚",
        options: [
            { text: "ã€ä»–è®¸ä¸‹æ‰¿è¯ºã€‘", req: {}, effects: { bond: 20, flag: 'proposal_bonus' }, log: "â€œæ— è®ºæœªæ¥å¦‚ä½•ï¼Œæˆ‘éƒ½ä¼šåœ¨ä½ èº«è¾¹ã€‚â€ä»–åšå®šçš„æ‰¿è¯ºï¼Œè®©ä½ å¯¹æœªæ¥å……æ»¡ä¿¡å¿ƒï¼Œå¹¶è§£é”äº†æäº²æˆåŠŸç‡åŠ æˆã€‚" },
            { text: "ã€ä»–è°ˆè®ºäº‹ä¸šã€‘", req: {}, effects: { bond: 3 }, log: "ä»–æ„æ°”é£å‘åœ°æè¿°è‡ªå·±æœªæ¥çš„äº‹ä¸šè“å›¾ã€‚ä½ æ¬£èµä»–çš„å¿—å‘ï¼Œä½†å†…å¿ƒæœ‰ä¸€ä¸å¤±è½ã€‚" },
            { text: "ã€ä»–æ²‰é»˜äº†ã€‘", req: {}, effects: { bond: -10 }, log: "ä»–çš„æ²‰é»˜è®©ä½ æ„Ÿåˆ°ä¸å®‰ã€‚" }
        ]
    }
};

const CHILDHOOD_SWEETHEART_EVENTS = {
    'event_1_fishing': {
        id: 'event_1_fishing',
        age_range: [12, 13], // ä¿®å¤ç‚¹ï¼šå¹´é¾„ä»10-12å²æ”¹ä¸º12-13å²
        description: "æ˜¥æ—¥åˆåï¼Œä½ ä¸é’æ¢…ç«¹é©¬åœ¨åå±±çš„å°æºªè¾¹ç©è€ã€‚å¥¹æè®®æ¯”èµ›æ•é±¼ï¼Œçœ‹è°æŠ“å¾—åˆå¤šåˆå¿«ã€‚",
        options: [
            { text: "ã€ä¸€å±•èº«æ‰‹ã€‘", req: { martial: 20 }, effects: { bond: 5 }, log: "ä½ è½»æ¾åœ°æŠ“äº†å¥½å‡ æ¡é±¼ï¼Œå¼•å¾—å¥¹æ‹æ‰‹ç§°èµï¼Œå¯¹ä½ çš„å´‡æ‹œä¹‹æƒ…æº¢äºè¨€è¡¨ã€‚" },
            { text: "ã€æ•…æ„è®©ç€å¥¹ã€‘", req: {}, effects: { bond: 8 }, log: "ä½ å‡è£…å¤±æ‰‹ï¼Œè®©å¥¹èµ¢å¾—äº†æ¯”èµ›ï¼Œçœ‹å¥¹å¼€å¿ƒçš„æ ·å­ï¼Œä½ è§‰å¾—å¾ˆæ»¡è¶³ã€‚" },
            { text: "ã€ä¸æ…æ»‘å€’ã€‘", req: {}, effects: { bond: 10 }, log: "ä½ ä¸å°å¿ƒè„šä¸‹ä¸€æ»‘ï¼Œæ‘”è¿›äº†æ°´é‡Œï¼Œæ ·å­ååˆ†ç‹¼ç‹ˆã€‚å¥¹æ€¥å¿™æ‹‰ä½ ä¸Šæ¥ï¼Œç”¨æ‰‹å¸•ä¸ºä½ æ“¦æ‹­ï¼Œä¸€æ¬¡å°å°çš„æ„å¤–ï¼Œå´è®©ä½ ä»¬çš„å¿ƒè´´å¾—æ›´è¿‘ã€‚" }
        ]
    },
    'event_2_lantern': {
        id: 'event_2_lantern',
        age_range: [14, 15], // ä¿®å¤ç‚¹ï¼šå¾®è°ƒå¹´é¾„èŒƒå›´
        description: "å…ƒå®µä½³èŠ‚ï¼Œä½ ä¸å¥¹ç›¸çº¦é€›ç¯ä¼šã€‚äººæ½®æ±¹æ¶Œä¸­ï¼Œä½ ä»¬ä¸æ…èµ°æ•£ã€‚",
        options: [
            { text: "ã€åœ¨åŸåœ°ç­‰å¥¹ã€‘", req: {}, effects: { random: [{ chance: 0.5, bond: 5, log: "å¥¹å¾ˆå¿«æ‰¾åˆ°äº†ä½ ï¼Œä½ ä»¬ç›¸è§†ä¸€ç¬‘ã€‚" }, { chance: 0.5, bond: -3, log: "ä½ ä»¬é”™è¿‡äº†å½¼æ­¤ï¼Œæ„Ÿåˆ°å¤±è½ã€‚" }] } },
            { text: "ã€å»çŒœç¯è°œèµ¢èŠ±ç¯ã€‘", req: { talent: 40 }, effects: { bond: 12 }, log: "ä½ æˆåŠŸèµ¢å¾—å¥¹æœ€å–œæ¬¢çš„é‚£ç›èµ°é©¬ç¯ï¼Œå¹¶é€ç»™äº†å¥¹ï¼Œå¥¹æ„ŸåŠ¨ä¸å·²ã€‚" },
            { text: "ã€å»çº¦å®šåœ°ç‚¹ã€‘", req: { wisdom: 30 }, effects: { bond: 10 }, log: "ä½ ä»¬æ›¾æˆè¨€ï¼Œè‹¥èµ°æ•£äº†å°±åœ¨æ¹–è¾¹çš„æŸ³æ ‘ä¸‹ç¢°å¤´ã€‚ä½ åœ¨æŸ³æ ‘ä¸‹æ‰¾åˆ°äº†åŒæ ·ç„¦æ€¥çš„å¥¹ï¼Œé»˜å¥‘æ²¹ç„¶è€Œç”Ÿã€‚" }
        ]
    },
    'event_3_blame': {
        id: 'event_3_blame',
        age_range: [15, 16], // ä¿®å¤ç‚¹ï¼šå¾®è°ƒå¹´é¾„èŒƒå›´
        description: "å¥¹å› ä¸€ä»¶å°äº‹è¢«é•¿è¾ˆè¯¯ä¼šå¹¶è´£ç½šï¼Œç‹¬è‡ªåœ¨èŠ±å›­å‚æ³ªã€‚",
        options: [
            { text: "ã€ä¸ºå¥¹è¾©è§£ã€‘", req: {}, effects: { bond: 15, attributes: { health: -5 } }, log: "ä½ å°†è´£ä»»æ½åˆ°è‡ªå·±èº«ä¸Šï¼Œå¯èƒ½å› æ­¤å—åˆ°æƒ©ç½šï¼Œä½†å¥¹è§†ä½ ä¸ºå”¯ä¸€çš„ä¾é ã€‚" },
            { text: "ã€é»˜é»˜é™ªä¼´ã€‘", req: {}, effects: { bond: 8 }, log: "æ— å£°çš„é™ªä¼´ç»™äº†å¥¹æœ€å¤§çš„å®‰æ…°ã€‚" },
            { text: "ã€å¸¦å¥¹å»åƒå¥½åƒçš„ã€‘", req: {}, effects: { bond: 6 }, log: "ä½ å·å·ä»å¨æˆ¿æ‹¿æ¥å¥¹æœ€çˆ±çš„æ¡‚èŠ±ç³•ï¼Œå¥¹ç ´æ¶•ä¸ºç¬‘ï¼Œè§‰å¾—æœ‰ä½ åœ¨çœŸå¥½ã€‚" }
        ]
    },
    'event_4_loveletter': {
        id: 'event_4_loveletter',
        age_range: [16, 17], // ä¿®å¤ç‚¹ï¼šå¾®è°ƒå¹´é¾„èŒƒå›´
        description: "ä½ æ— æ„ä¸­å‘ç°ï¼Œå¦ä¸€ä½ä¸–å®¶å­å¼Ÿæ­£åœ¨çƒ­çƒˆåœ°è¿½æ±‚å¥¹ï¼Œç”šè‡³é€æ¥äº†æƒ…è¯—ã€‚",
        options: [
            { text: "ã€å‡è£…ä¸çŸ¥ã€‘", req: {}, effects: { bond: -5 }, log: "ä½ é€‰æ‹©å°Šé‡å¥¹çš„é€‰æ‹©ï¼Œå†…å¿ƒå´äº”å‘³æ‚é™ˆï¼Œä½ ä»¬çš„å…³ç³»å¯èƒ½å› æ­¤ç–è¿œã€‚" },
            { text: "ã€è´¨é—®å¥¹ã€‘", req: {}, effects: { random: [{ chance: 0.6, bond: -8, log: "å¥¹å¯¹ä½ çš„éœ¸é“æ„Ÿåˆ°ä¸æ»¡ã€‚" }, { chance: 0.4, bond: 5, log: "å¥¹çªƒå–œä½ çš„åœ¨ä¹ã€‚" }] } },
            { text: "ã€å†™ä¸€é¦–æ›´å¥½çš„è¯—ã€‘", req: { talent: 60 }, effects: { bond: 10, attributes: { talent: 2 } }, log: "ä½ å†™äº†ä¸€é¦–è¿œèƒœå¯¹æ–¹çš„è¯—ä½œåŒ¿åé€ç»™å¥¹ï¼Œå¥¹å†…å¿ƒå¯¹ä½ æ›´åŠ å€¾æ…•ã€‚" }
        ]
    },
    'event_5_promise': {
        id: 'event_5_promise',
        age_range: [17, 18],
        description: "ä½ ä»¬åœ¨å±±é¡¶çœ‹æ—¥å‡ºï¼Œè°ˆåŠæœªæ¥ï¼Œå¥¹æœ‰äº›è¿·èŒ«åœ°é—®ä½ ï¼Œä»¥åä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚",
        options: [
            { text: "ã€è®¸ä¸‹æ‰¿è¯ºã€‘", req: {}, effects: { bond: 20, flag: 'proposal_bonus' }, log: "â€œæ— è®ºæœªæ¥å¦‚ä½•ï¼Œæˆ‘éƒ½ä¼šåœ¨ä½ èº«è¾¹ã€‚â€ä¸€ä¸ªåšå®šçš„æ‰¿è¯ºï¼Œè®©å¥¹å¯¹æœªæ¥å……æ»¡ä¿¡å¿ƒï¼Œå¹¶è§£é”äº†æäº²æˆåŠŸç‡åŠ æˆã€‚" },
            { text: "ã€è°ˆè®ºäº‹ä¸šã€‘", req: {}, effects: { bond: 3 }, log: "ä½ æ„æ°”é£å‘åœ°æè¿°è‡ªå·±æœªæ¥çš„äº‹ä¸šè“å›¾ã€‚å¥¹æ¬£èµä½ çš„å¿—å‘ï¼Œä½†å†…å¿ƒæœ‰ä¸€ä¸å¤±è½ã€‚" },
            { text: "ã€æ²‰é»˜ã€‘", req: {}, effects: { bond: -10 }, log: "ä½ çš„æ²‰é»˜è®©å¥¹æ„Ÿåˆ°ä¸å®‰ã€‚" }
        ]
    },
    'event_6_visit': {
        id: 'event_6_visit',
        age_range: [12, 18], // ä¿®å¤ç‚¹ï¼šå¹´é¾„ä»10-18å²æ”¹ä¸º12-18å²
        is_random: true,
        description: "ä½ ç”Ÿäº†ä¸€åœºå°ç—…ï¼Œå§åºŠä¼‘å…»ã€‚å¥¹å¾—çŸ¥åï¼Œå¸¦ç€äº²æ‰‹ç†¬çš„æ±¤è¯å‰æ¥æ¢æœ›ã€‚",
        options: [
            { text: "ã€é€å¼ºè¯´æ— äº‹ã€‘", req: {}, effects: { bond: 7 }, log: "å¥¹çœ‹ç©¿äº†ä½ çš„é€å¼ºï¼Œæœ‰äº›å¿ƒç–¼ã€‚" },
            { text: "ã€å¦ç„¶æ¥å—ç…§é¡¾ã€‘", req: {}, effects: { bond: 10, attributes: { health: 5 } }, log: "ç—…ä¸­çš„è„†å¼±è®©ä½ ä»¬çš„æƒ…æ„Ÿè¿…é€Ÿå‡æ¸©ã€‚" }
        ]
    },
    'event_7_secret': {
        id: 'event_7_secret',
        age_range: [12, 18], // ä¿®å¤ç‚¹ï¼šå¹´é¾„ä»10-18å²æ”¹ä¸º12-18å²
        is_random: true,
        description: "ä½ åœ¨ä¸æœ‹å‹é—²èŠæ—¶ï¼Œå¾—çŸ¥ä»–çŸ¥é“ä¸€ä¸ªå…³äºä½ å’Œé’æ¢…ç«¹é©¬å°æ—¶å€™çš„ç³—äº‹ï¼Œå¹¶ä»¥æ­¤å–ç¬‘ä½ ä»¬ã€‚",
        options: [
            { text: "ã€è”æ‰‹å›å‡»ã€‘", req: {}, effects: { bond: 8, attributes: { charm: 1 } }, log: "ä½ å’Œå¥¹é»˜å¥‘åœ°å¯¹è§†ä¸€çœ¼ï¼Œç”¨å¦ä¸€ä¸ªæ›´å¤§çš„ç§˜å¯†å›å‡»äº†æœ‹å‹ï¼Œå…±åŒçš„ç§˜å¯†é˜µçº¿è®©ä½ ä»¬å…³ç³»æ›´é“ã€‚" },
            { text: "ã€ä¸€ç¬‘ç½®ä¹‹ã€‘", req: {}, effects: { bond: 5 }, log: "ä½ ä»¬å¹¶ä¸åœ¨æ„ï¼Œåè€Œè§‰å¾—è¿™æ®µå›å¿†å¾ˆæœ‰è¶£ã€‚" }
        ]
    },
    'event_8_gift': {
        id: 'event_8_gift',
        age_range: [16, 18], // è¿œè¡Œæ—¶è§¦å‘
        is_career_related: true,
        description: "ä½ å› äº‹ä¸šéœ€è¦å³å°†è¿œè¡Œï¼Œå¥¹è¿å¤œä¸ºä½ ç¼åˆ¶äº†ä¸€ä¸ªå¹³å®‰ç¬¦ã€‚",
        options: [
            { text: "ã€è´´èº«æ”¶è—ã€‘", req: {}, effects: { bond: 12, item: { id: 'talisman_sweetheart', name: 'è´´èº«çš„å¹³å®‰ç¬¦', desc: 'é’æ¢…ç«¹é©¬ä¸ºä½ ç¼åˆ¶çš„å¹³å®‰ç¬¦ï¼Œèƒ½åœ¨éšæœºè´Ÿé¢äº‹ä»¶ä¸­è±å…ä¸€æ¬¡ã€‚', type: 'çå“', icon: 'fa-shield-alt' } }, log: "ä½ éƒ‘é‡åœ°å°†å¹³å®‰ç¬¦æ”¾å…¥æ€€ä¸­ï¼Œæ‰¿è¯ºä¸€å®šä¼šæˆ´ç€å®ƒå›æ¥ã€‚" },
            { text: "ã€å›èµ ç¤¼ç‰©ã€‘", req: {}, effects: { bond: 10, wealth: -100 }, log: "ä½ å°†ä¸€æ”¯åè´µçš„å‘ç°ªå›èµ ç»™å¥¹ä½œä¸ºå¿µæƒ³ï¼ŒèŠ±è´¹äº†100ä¸¤ã€‚" }
        ]
    },
    'event_9_family': {
        id: 'event_9_family',
        age_range: [17, 18],
        bond_req: 60,
        description: "ä½ çš„æ¯äº²åœ¨é—²èŠæ—¶æèµ·å¥¹ï¼Œè¨€è¯­é—´é¢‡ä¸ºèµè®¸ï¼Œå¹¶è¯¢é—®ä½ çš„æƒ³æ³•ã€‚",
        options: [
            { text: "ã€è¡¨æ˜å¿ƒæ„ã€‘", req: {}, effects: { bond: 15, flag: 'mother_support' }, log: "â€œæ¯äº²ï¼Œå­©å„¿éå¥¹ä¸å¨¶ã€‚â€ä½ è·å¾—äº†æ¯äº²çš„æ”¯æŒï¼Œæå¤§æå‡äº†æäº²äº‹ä»¶çš„æˆåŠŸç‡ã€‚" },
            { text: "ã€å«ç³Šå…¶è¾ã€‘", req: {}, effects: { bond: -8 }, log: "â€œæˆ‘ä»¬åªæ˜¯ä»å°ä¸€èµ·é•¿å¤§ç½¢äº†ã€‚â€æ¯äº²æœ‰äº›å¤±æœ›ï¼Œå¥¹è‹¥å¾—çŸ¥æ­¤äº‹ï¼Œä¹Ÿä¼šä¼¤å¿ƒã€‚" }
        ]
    },
    'event_10_choice': {
        id: 'event_10_choice',
        age_range: [18, 19],
        is_final: true,
        description: "å¥¹å·²å¹´æ»¡18ï¼Œå¾…å­—é—ºä¸­ã€‚å¥¹çš„å®¶äººä¹Ÿå¼€å§‹ä¸ºå¥¹ç‰©è‰²äººå®¶ã€‚è¿™æ˜¯ä½ å¿…é¡»åšå‡ºé€‰æ‹©çš„æ—¶åˆ»äº†ã€‚",
        options: [] // é€‰é¡¹åŠ¨æ€ç”Ÿæˆ
    }
};
const GOSSIP_DATA = [
    "å¬è¯´å®‰å›½å…¬æœ€è¿‘åœ¨æœå ‚ä¸Šå’Œç¤¼éƒ¨å°šä¹¦ä¸ºäº†ä¸€ç‚¹å°äº‹åµå¾—ä¸å¯å¼€äº¤ã€‚",
    "åŸè¥¿çš„å¼ å± å¤«ï¼ŒåŸæ¥æ˜¯äºŒåå¹´å‰é€€éšæ±Ÿæ¹–çš„â€˜è¡€æ‰‹äººå± â€™ï¼",
    "æ®è¯´å¿ æ­¦å°†å†›å®¶çš„å°å„¿å­ï¼Œå·å·çˆ±æ…•ç€ç¿°æ—å­¦å£«å®¶çš„åƒé‡‘ã€‚",
    "æœ€è¿‘å¸‚é¢ä¸Šçš„æ±Ÿå—ä¸ç»¸ä»·æ ¼ç–¯æ¶¨ï¼Œå¥½åƒæ˜¯è¿æ²³å‡ºäº†é—®é¢˜ã€‚",
    "çš‡ä¸Šæœ€è¿‘é¾™ä½“æ¬ å®‰ï¼Œå¥½å‡ ä½çš‡å­éƒ½åœ¨æš—ä¸­æ´»åŠ¨å‘¢ã€‚",
    "å¤§ç†å¯ºå¿ç§¦å¤§äººé“é¢æ— ç§ï¼Œè¿è‡ªå·±å¤«äººçš„å¨˜å®¶äº²æˆšçŠ¯äº†æ³•éƒ½ç…§æŠ“ä¸è¯¯ã€‚",

    "ä½ å¯çŸ¥æ™“ï¼Œé‚£â€˜é†‰ä»™æ¥¼â€™çš„å¤´ç‰Œèœâ€˜ä½›è·³å¢™â€™ï¼Œç§˜æ–¹ç«Ÿæ˜¯å®«é‡Œä¼ å‡ºæ¥çš„ã€‚",
    "å‰æœæœ‰ä½å…¬ä¸»çš„é™µå¢“ï¼Œæ®è¯´å°±åœ¨äº¬åŸè¥¿éƒŠçš„æŸä¸ªå±±è°·é‡Œï¼Œè—ç€æ— æ•°çå®ã€‚",
    "é£æœˆé‰´çš„æŸ³æ‹‚è¡£å§‘å¨˜ï¼Œå¥½åƒä¸æ˜¯æ™®é€šäººå®¶çš„å¥³å„¿ï¼Œæœ‰å¤§æ¥å¤´ã€‚",
    "æœ€è¿‘äº¬åŸå¤œé‡Œä¸å¤ªå¹³ï¼Œå¥½å‡ å®¶å¯Œæˆ·éƒ½è¢«ä¸€ä¸ªå«â€˜ä¸€é˜µé£â€™çš„é£è´¼å…‰é¡¾äº†ã€‚",
    "å…µéƒ¨æ­£åœ¨ç§˜å¯†æ‹›å‹Ÿä¸€æ‰¹æ­¦æ—é«˜æ‰‹ï¼Œä¸çŸ¥è¦å»åšä»€ä¹ˆå¤§äº‹ã€‚",
    "å¬é—»æµ·å¤–æ¥äº†ä½¿è‡£ï¼Œå¸¦çš„è´¡å“é‡Œæœ‰ä¼šè‡ªå·±æŠ¥æ—¶çš„è¥¿æ´‹é’Ÿï¼Œç¨€å¥‡å¾—å¾ˆã€‚",

    "åŸå—çš„â€˜æµä¸–å ‚â€™è¯é“ºï¼Œæœ€è¿‘ç ”åˆ¶å‡ºä¸€ç§æ–°è¯ï¼Œå¯¹é£æ¹¿æœ‰å¥‡æ•ˆã€‚",
    "ä¸Šæ¬¡ç§‘ä¸¾çš„çŠ¶å…ƒéƒï¼Œæ‰åæ˜¯æœ‰ï¼Œä½†å¬è¯´ç§ä¸‹é‡Œå“è¡Œä¸å¤ªç«¯æ­£ã€‚",
    "å›½å­ç›‘æœ€è¿‘åœ¨æ•´é¡¿å­¦é£ï¼Œå¥½å‡ ä¸ªä¸å­¦æ— æœ¯çš„ä¸–å®¶å­å¼Ÿéƒ½è¢«æ–¥é€€äº†ã€‚",
    "è¥¿åŸŸæ¥çš„å•†é˜Ÿï¼Œè¿™æ¬¡å¸¦æ¥äº†ä¸€æ‰¹ä¸Šå¥½çš„å’Œç”°ç‰ï¼Œä»·æ ¼ä¸è²ã€‚",
    "åéƒ¨ä¾éƒå®¶æ­£åœ¨ä¸ºå¥³å„¿çš„å©šäº‹å‘æ„ï¼Œé—¨æ§›éƒ½å¿«è¢«åª’å©†è¸ç ´äº†ã€‚",
    "æ®è¯´çš‡å¸æƒ³åœ¨äº¬éƒŠæ–°å»ºä¸€åº§çš‡å®¶å›­æ—ï¼Œæˆ·éƒ¨æ­£ä¸ºé’±çš„äº‹å¤´ç–¼å‘¢ã€‚",

    "æœ‰äººåœ¨åŸå¤–çš„ç ´åº™é‡Œè§è¿‡ä¸€é“å‰‘å…‰ï¼Œå¿«å¦‚é—ªç”µï¼Œç–‘æœ‰ç»ä¸–é«˜æ‰‹éšå±…ã€‚",
    "æœ€è¿‘æ¼•è¿æ€»ç£æ¢äº†äººï¼Œäº¬åŸçš„ç±³ä»·éƒ½è·Ÿç€æ¶¨äº†ä¸‰åˆ†ã€‚",
    "â€˜éœ“è£³åŠâ€™çš„è€æ¿ï¼Œæœ€è¿‘å’Œâ€˜é”¦ç»£é˜â€™ä¸ºäº†æŠ¢ä¸€ä¸ªå¤§å®¢æˆ·ï¼Œéƒ½å¿«æ‰“èµ·æ¥äº†ã€‚",
    "æ®è¯´å¤ªåŒ»é™¢çš„é™¢é¦–ï¼Œæ­£åœ¨å¯»æ‰¾ä¸€å‘³å«â€˜é¾™æ¶é¦™â€™çš„çç¨€è¯æã€‚",
    "åŒ—å¢ƒä¼ æ¥æ¶ˆæ¯ï¼Œå¥½åƒå’Œè›®æ—åˆæœ‰äº†äº›å°æ‘©æ“¦ã€‚",
    "é•¿å…¬ä¸»çš„é©¸é©¬ï¼Œè¡¨é¢ä¸Šä¸å…¬ä¸»æ©çˆ±ï¼Œç§ä¸‹é‡Œå´å…»ç€å¤–å®¤ã€‚",

    "æœ€è¿‘äº¬ä¸­æµè¡Œä¸€ç§æ–°çš„å‘é«»æ ·å¼ï¼Œæ®è¯´æ˜¯ä»å®«é‡Œä¸€ä½è´µå¦ƒé‚£å„¿ä¼ å‡ºæ¥çš„ã€‚",
    "æœ‰ä¸ªç–¯ç–¯ç™«ç™«çš„é“å£«åœ¨è¡—ä¸Šè¯´ï¼Œåå¹´åäº¬åŸä¼šæœ‰ä¸€åœºå¤§åŠ«ã€‚",
    "â€˜æŒ¯è¿œé•–å±€â€™çš„æ€»é•–å¤´ï¼Œå¹´è½»æ—¶æ›¾æ˜¯å¾¡å‰ä¾å«ï¼Œæ­¦åŠŸæ·±ä¸å¯æµ‹ã€‚",
    "å·¥éƒ¨åœ¨ä¿®ç¼®åŸå¢™æ—¶ï¼ŒæŒ–å‡ºäº†ä¸€å—å‰æœçš„çŸ³ç¢‘ï¼Œä¸Šé¢åˆ»ç€äº›çœ‹ä¸æ‡‚çš„æ–‡å­—ã€‚",
    "å¬è¯´æœ‰ä½çš‡å­åœ¨æ°‘é—´å¯»è®¿ä¸€ä½å¤±æ•£å¤šå¹´çš„å¦¹å¦¹ã€‚",
    "åŸä¸œé¦–å¯Œç‹å‘˜å¤–ï¼Œæœ€è¿‘åœ¨ä½ä»·æ”¶è´­åŸéƒŠçš„è’åœ°ï¼Œä¸çŸ¥æ‰“çš„ä»€ä¹ˆç®—ç›˜ã€‚",
    "â€˜é£æœˆé‰´â€™çš„è‹åˆå§‘å¨˜ï¼Œå¥½åƒå’Œå‡ ä¸ªå•†ç•Œå¤§äº¨å…³ç³»åŒªæµ…ã€‚",
    "å¤ªå‚…å¤§äººçœ‹ä¼¼æ¸…å»‰ï¼Œä½†å¬è¯´ä»–æ”¶è—çš„å¤ç©å­—ç”»ï¼Œä»·å€¼è¿åŸã€‚"
];
// =======================================================================
// ===================== ã€æ–°åŠŸèƒ½ã€‘å®…æ–—ç³»ç»Ÿæ•°æ® START ======================
// =======================================================================

// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
// [æ›¿æ¢] INNER_COURT_STRUGGLES æ•°æ®å¯¹è±¡
const INNER_COURT_STRUGGLES = {
male: {
'allowance_dispute': {
            title: "æœˆä¾‹ä¹‹äº‰",
            trigger: (gs) => {
                if (gs.marriage.familyHarmony > 70) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 50);
                if (concubines.length < 1) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter],
                    description: `å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> å‘ä½ å“­è¯‰ï¼Œç§°è‡ªå·±çš„æœˆä¾‹ä»½ä¾‹è¢«å…‹æ‰£ï¼Œæ—¥å­è¿‡å¾—è‰°éš¾ï¼Œè¨€è¯­é—´æš—ç¤ºæ˜¯æŒäº‹è€…ï¼ˆä½ çš„æ¯äº²æˆ–æ­£å¦»ï¼‰æ‰€ä¸ºã€‚`
                };
            },
            options: [
                {
                    text: "ã€å®‰æŠšå¹¶å¢åŠ å…¶æœˆä¾‹ã€‘",
                    req: (player) => gs.finances.wealth > 500,
                    action: (involved) => {
                        const [plotter] = involved;
                        applyEffects({ wealth: -500, relationship: { targetId: plotter.id, favor: 10 } });
                        plotter.ambition = (plotter.ambition || 0) + 5;
                        return `ä½ è‡ªæè…°åŒ…å¢åŠ äº†å¥¹çš„æœˆä¾‹ï¼Œå¥¹å°åˆ°äº†ç”œå¤´ï¼Œé‡å¿ƒæœ‰æ‰€å¢é•¿ã€‚`;
                    }
                },
                {
                    text: "ã€ç›¸ä¿¡æŒäº‹è€…ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: -8 } });
                        return `ä½ ç›¸ä¿¡æ¯äº²/æ­£å¦»çš„å…¬æ­£ï¼Œæ–¥è´£äº†${plotter.name}æ¬å¼„æ˜¯éã€‚`;
                    }
                }
            ]
        },
        'servant_bullying': {
            title: "è‹›å¾…ä¸‹äºº",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && !c.personality.includes('å–„è‰¯') && c.jealousy > 60);
                if (concubines.length === 0) return false;
                const bully = getRandomElement(concubines);
                return {
                    involved: [bully],
                    description: `ä¸€ä½è€å®çš„ä¸‹äººå‘ä½ å“­è¯‰ï¼Œè¯´ <strong class="highlight-npc">${bully.name}</strong> å› ä¸€ç‚¹å°äº‹ä¾¿å¯¹å…¶è‚†æ„æ‰“éª‚ï¼Œè‹¦ä¸å ªè¨€ã€‚`
                };
            },
            options: [
                {
                    text: "ã€ä¸¥å‰æ–¥è´£ã€‘",
                    req: (player) => player.attributes.virtue > 60,
                    action: (involved) => {
                        const [bully] = involved;
                        applyEffects({ relationship: { targetId: bully.id, favor: -10 } });
                        gs.marriage.familyHarmony += 3;
                        return `ä½ ä¸¥å‰æ–¥è´£äº†${bully.name}ï¼Œå¹¶å®‰æŠšäº†ä¸‹äººï¼Œåå®…é£æ°”ä¸ºä¹‹ä¸€è‚ƒã€‚`;
                    }
                },
                {
                    text: "ã€è®¤ä¸ºæ˜¯å°é¢˜å¤§åšã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [bully] = involved;
                        applyEffects({ attributes: { virtue: -5 } });
                        gs.marriage.familyHarmony -= 5;
                        return `ä½ è®¤ä¸ºè¿™æ˜¯ä¸‹äººé—´çš„çäº‹ï¼Œä¸äºˆç†ä¼šã€‚${bully.name}çš„æ°”ç„°æ›´åŠ åš£å¼ ã€‚`;
                    }
                }
            ]
        },
        'currying_favor_with_mother': {
            title: "è®¨å¥½å©†æ¯",
            trigger: (gs) => {
                const mother = gs.npcs[gs.family.members.motherId];
                if (!mother || mother.isDead) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 60);
                if (concubines.length === 0) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter, mother],
                    description: `ä½ å‘ç°å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> è¿‘æ—¥å¸¸å¸¸å»ä½ æ¯äº²é¢å‰çŒ®æ®·å‹¤ï¼Œé€æ±¤é€æ°´ï¼Œå°†è€äººå®¶å“„å¾—ååˆ†å¼€å¿ƒã€‚`
                };
            },
            options: [
                {
                    text: "ã€å¤¸å¥¹å­é¡ºã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, mother] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: 5 }, relationship: { targetId: mother.id, favor: 2 } });
                        return `ä½ å¤¸èµäº†å¥¹çš„å­å¿ƒï¼Œé˜–å®¶æ¬¢ä¹ã€‚`;
                    }
                },
                {
                    text: "ã€æé†’æ¯äº²æé˜²ã€‘",
                    req: (player) => player.attributes.strategy > 50,
                    action: (involved) => {
                        const [plotter, mother] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: -5 } });
                        return `ä½ ç§ä¸‹æé†’æ¯äº²æ­¤äººé¢‡æœ‰å¿ƒè®¡ï¼Œæ¯äº²å¯¹ä½ è¨€å¬è®¡ä»ï¼Œå¼€å§‹ç–è¿œå¥¹ã€‚`;
                    }
                }
            ]
        },
        'concubine_alliance': {
            title: "å¦¾å®¤ç»“ç›Ÿ",
            trigger: (gs) => {
                if (gs.marriage.familyHarmony > 60) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 50);
                if (concubines.length < 2) return false;
                const alliance = [concubines[0], concubines[1]];
                return {
                    involved: alliance,
                    description: `ä½ å‘ç° <strong class="highlight-npc">${alliance[0].name}</strong> å’Œ <strong class="highlight-npc">${alliance[1].name}</strong> æœ€è¿‘ä¼¼ä¹èµ°å¾—å¾ˆè¿‘ï¼Œéšéšæœ‰è”æ‰‹ä¹‹åŠ¿ï¼Œå…±åŒé’ˆå¯¹å…¶ä»–å—å® çš„å§å¦¹ã€‚`
                };
            },
            options: [
                {
                    text: "ã€åˆ†åŒ–ç“¦è§£ã€‘",
                    req: (player) => player.attributes.strategy > 70,
                    action: (involved) => {
                        const [p1, p2] = involved;
                        applyEffects({ relationship: { targetId: p1.id, favor: -8 }, relationship: { targetId: p2.id, favor: -8 } });
                        gs.marriage.familyHarmony += 5;
                        return `ä½ ç•¥æ–½å°è®¡ï¼Œä¾¿è®©å¥¹ä»¬ä¹‹é—´äº§ç”Ÿå«Œéš™ï¼Œè”ç›Ÿä¸æ”»è‡ªç ´ã€‚`;
                    }
                },
                {
                    text: "ã€é™è§‚å…¶å˜ã€‘",
                    req: () => true,
                    action: (involved) => {
                        gs.marriage.familyHarmony -= 8;
                        return `ä½ é€‰æ‹©é™è§‚å…¶å˜ï¼Œåå®…çš„äº‰æ–—æ„ˆå‘æ¿€çƒˆï¼Œå®¶å®…ä¸å®ã€‚`;
                    }
                }
            ]
        },
        'mistreating_child': {
            title: "è‹›å¾…åº¶å­",
            trigger: (gs) => {
                const wife = gs.npcs[gs.marriage.spouseId];
                if (!wife || wife.isDead) return false;
                const concubinesWithChildren = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && gs.children.some(child => child.motherId === c.id));
                if (concubinesWithChildren.length === 0) return false;
                const victimMother = getRandomElement(concubinesWithChildren);
                const victimChild = gs.children.find(c => c.motherId === victimMother.id);
                return {
                    involved: [wife, victimMother, victimChild],
                    description: `å¦¾å®¤ <strong class="highlight-npc">${victimMother.name}</strong> å‘ä½ å“­è¯‰ï¼Œç§°æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> è‹›å¾…å¥¹çš„å­©å­ <strong class="highlight-npc">${victimChild.name}</strong>ï¼Œä¸ä»…å…‹æ‰£ç”¨åº¦ï¼Œè¿˜æ—¶å¸¸å¯¹å…¶å†·è¨€å†·è¯­ã€‚`
                };
            },
            options: [
                {
                    text: "ã€ç»´æŠ¤æ­£å¦»ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [wife, victimMother] = involved;
                        applyEffects({ relationship: { targetId: victimMother.id, favor: -10 } });
                        return `ä½ è®¤ä¸ºè¿™æ˜¯å¦¾å®¤åœ¨æ¬å¼„æ˜¯éï¼Œæ–¥è´£äº†${victimMother.name}ã€‚`;
                    }
                },
                {
                    text: "ã€å®‰æŠšå¦¾å®¤ï¼Œè­¦å‘Šæ­£å¦»ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [wife, victimMother] = involved;
                        applyEffects({ relationship: { targetId: wife.id, favor: -8 }, relationship: { targetId: victimMother.id, favor: 5 } });
                        wife.suspicionValue = (wife.suspicionValue || 0) + 5;
                        return `ä½ è­¦å‘Šäº†æ­£å¦»ï¼Œå¹¶å®‰æŠšäº†å¦¾å®¤ã€‚å¤«å¦»å…³ç³»å› æ­¤å‡ºç°è£‚ç—•ã€‚`;
                    }
                }
            ]
        },
        'showing_off_family_background': {
            title: "ç‚«è€€å®¶ä¸–",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.baseData && c.baseData.family > 60);
                if (concubines.length === 0) return false;
                const showOff = getRandomElement(concubines);
                return {
                    involved: [showOff],
                    description: `å®¶ä¸–æ˜¾èµ«çš„å¦¾å®¤ <strong class="highlight-npc">${showOff.name}</strong> åœ¨å®¶å®´ä¸Šï¼Œæ€»æœ‰æ„æ— æ„åœ°æèµ·è‡ªå·±å¨˜å®¶çš„æƒåŠ¿ï¼Œè¨€è¯­é—´é¢‡ä¸ºè‡ªå¾—ï¼Œå¼•å¾—å…¶ä»–å‡ºèº«å¹³å¹³çš„å¦¾å®¤ä¸æ»¡ã€‚`
                };
            },
            options: [
                {
                    text: "ã€è®¤ä¸ºç†æ‰€åº”å½“ã€‘",
                    req: () => true,
                    action: (involved) => {
                        gs.marriage.familyHarmony -= 4;
                        return `ä½ è®¤ä¸ºå®¶ä¸–ä¹Ÿæ˜¯å®åŠ›çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶æœªåˆ¶æ­¢ï¼ŒåŠ å‰§äº†åå®…çš„çŸ›ç›¾ã€‚`;
                    }
                },
                {
                    text: "ã€å·§å¦™è½¬ç§»è¯é¢˜ã€‘",
                    req: (player) => player.attributes.charm > 60,
                    action: (involved) => {
                        gs.marriage.familyHarmony += 2;
                        return `ä½ ç”¨ä¸€ä¸ªæœ‰è¶£çš„ç¬‘è¯å·§å¦™åœ°è½¬ç§»äº†è¯é¢˜ï¼ŒåŒ–è§£äº†å°´å°¬ã€‚`;
                    }
                }
            ]
        },
        'requesting_family_help': {
            title: "ä¸ºå¨˜å®¶æ±‚å®˜",
            trigger: (gs) => {
                if (!gs.career.path || gs.career.level < 5) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 65);
                if (concubines.length === 0) return false;
                const requester = getRandomElement(concubines);
                return {
                    involved: [requester],
                    description: `å¦¾å®¤ <strong class="highlight-npc">${requester.name}</strong> å‘ä½ å¹æ•è¾¹é£ï¼Œå¸Œæœ›ä½ èƒ½ä¸ºå¥¹ä¸å­¦æ— æœ¯çš„å…„å¼Ÿåœ¨è¡™é—¨é‡Œå®‰æ’ä¸€ä¸ªèŒä½ã€‚`
                };
            },
            options: [
                {
                    text: "ã€åŒæ„ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [requester] = involved;
                        applyEffects({ attributes: { virtue: -10 }, relationship: { targetId: requester.id, favor: 12 } });
                        gs.career.performance -= 10;
                        return `ä½ ç­”åº”äº†å¥¹çš„è¯·æ±‚ï¼Œè™½èµ¢å¾—äº†ç¾äººå¿ƒï¼Œä½†ä½ çš„å“å¾·å’ŒåŠŸç»©éƒ½å› æ­¤å—æŸã€‚`;
                    }
                },
                {
                    text: "ã€æ‹’ç»ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [requester] = involved;
                        applyEffects({ relationship: { targetId: requester.id, favor: -10 } });
                        return `ä½ ä¸¥è¯æ‹’ç»äº†å¥¹ï¼Œå¥¹å¯¹ä½ å¿ƒç”Ÿæ€¨æ€¼ã€‚`;
                    }
                }
            ]
        },
        'managing_talent': {
            title: "å±•ç°æ‰èƒ½",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.attributes.wisdom > 70 && c.ambition > 60);
                if (concubines.length === 0) return false;
                const talented = getRandomElement(concubines);
                return {
                    involved: [talented],
                    description: `ä½ å‘ç°å¦¾å®¤ <strong class="highlight-npc">${talented.name}</strong> åœ¨ååŠ©æ­£å¦»å¤„ç†è´¦ç›®æ—¶ï¼Œå±•ç°å‡ºäº†æƒŠäººçš„ç†è´¢æ‰èƒ½ï¼Œç”šè‡³æ¯”æ­£å¦»åšå¾—è¿˜å¥½ã€‚`
                };
            },
            options: [
                {
                    text: "ã€ææ‹”å¥¹åç†å®¶äº‹ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [talented] = involved;
                        applyEffects({ relationship: { targetId: talented.id, favor: 10 } });
                        talented.ambition += 10;
                        if (gs.marriage.isMarried) applyEffects({ relationship: { targetId: gs.marriage.spouseId, favor: -5 } });
                        return `ä½ ææ‹”äº†å¥¹ï¼Œå¥¹çš„é‡å¿ƒå¤§å¢ï¼Œæ­£å¦»å¯¹æ­¤æ„Ÿåˆ°å¨èƒã€‚`;
                    }
                },
                {
                    text: "ã€åªåšå¤¸å¥–ï¼Œä¸äºˆé‡ç”¨ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [talented] = involved;
                        applyEffects({ relationship: { targetId: talented.id, favor: 2 } });
                        return `ä½ å¤¸å¥–äº†å¥¹ä¸€ç•ªï¼Œä½†å¹¶æœªç»™å¥¹å®æƒã€‚`;
                    }
                }
            ]
        },
        'spreading_rumors_abroad': {
            title: "å¤–æ‰¬å®¶ä¸‘",
            trigger: (gs) => {
                if (gs.family.reputation < 50) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.favor < 20);
                if (concubines.length === 0) return false;
                const gossiper = getRandomElement(concubines);
                return {
                    involved: [gossiper],
                    description: `ä½ å¬é—»ï¼Œå¤±å® çš„å¦¾å®¤ <strong class="highlight-npc">${gossiper.name}</strong> åœ¨å¤–ä¸æ‰‹å¸•äº¤æŠ±æ€¨ä½ åœ¨å®¶ä¸­å¦‚ä½•åå¿ƒï¼Œå¯¼è‡´å¤–ç•Œå¯¹ä½ çš„å®¶é£é¢‡æœ‰å¾®è¯ã€‚`
                };
            },
            options: [
                {
                    text: "ã€ç¦è¶³åŠå¹´ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [gossiper] = involved;
                        gossiper.isGrounded = true;
                        gossiper.groundedTurns = 1;
                        applyEffects({ reputation: -5, relationship: { targetId: gossiper.id, favor: -15 } });
                        return `ä½ å°†å¥¹ç¦è¶³ï¼Œä½†å®¶æ—å£°æœ›å·²ç„¶å—æŸã€‚`;
                    }
                },
                {
                    text: "ã€ä»¥ç‰™è¿˜ç‰™ã€‘",
                    req: (player) => player.attributes.strategy > 60,
                    action: (involved) => {
                        const [gossiper] = involved;
                        applyEffects({ reputation: 5 });
                        return `ä½ æ•£æ’­äº†æ›´æœ‰åˆ©äºä½ çš„â€œçœŸç›¸â€ï¼ŒæˆåŠŸæ‰­è½¬äº†èˆ†è®ºã€‚`;
                    }
                }
            ]
        },
        'fake_miscarriage': {
            title: "ä¼ªé€ å°äº§",
            trigger: (gs) => {
                const wife = gs.npcs[gs.marriage.spouseId];
                if (!wife || wife.isDead) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 80 && !c.isPregnant);
                if (concubines.length === 0) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter, wife],
                    description: `åœ¨ä¸€æ¬¡ä¸æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> çš„äº‰æ‰§åï¼Œå¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> çªç„¶â€œå°äº§â€å¹¶è¡€æµä¸æ­¢ï¼Œå¥¹çš„ä¸«é¬ŸæŒ‡è®¤æ˜¯æ­£å¦»æ‰€ä¸ºï¼`
                };
            },
            options: [
                {
                    text: "ã€ç›¸ä¿¡å¦¾å®¤ï¼Œæƒ©ç½šæ­£å¦»ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, wife] = involved;
                        applyEffects({ relationship: { targetId: wife.id, favor: -30 } });
                        wife.suspicionValue = 0; // ä¿¡ä»»å´©å¡Œ
                        return `ä½ æƒ©ç½šäº†æ­£å¦»ï¼Œå¤«å¦»å…³ç³»é™è‡³å†°ç‚¹ã€‚äº‹åä½ æ‰å‘ç°ï¼Œè¿™ç«Ÿæ˜¯ä¸€åœºè‹¦è‚‰è®¡ï¼`;
                    }
                },
                {
                    text: "ã€ç›¸ä¿¡æ­£å¦»ï¼Œå½»æŸ¥æ­¤äº‹ã€‘",
                    req: (player) => player.attributes.strategy > 80,
                    action: (involved) => {
                        const [plotter, wife] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: -20 } });
                        return `ä½ æŸ¥å‡ºæ­¤äº‹ä¹ƒæ˜¯æ ½èµƒé™·å®³ï¼Œè¿˜äº†æ­£å¦»æ¸…ç™½ï¼Œå¹¶ä¸¥æƒ©äº†${plotter.name}ã€‚`;
                    }
                }
            ]
        },
        'intercepting_gift': {
            title: "æˆªèƒ¡ç¤¼ç‰©",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 60);
                if (concubines.length < 2) return false;
                const plotter = concubines[0];
                const victim = concubines[1];
                return {
                    involved: [plotter, victim],
                    description: `ä½ é€ç»™ <strong class="highlight-npc">${victim.name}</strong> çš„ä¸€æ”¯å‘ç°ªï¼Œä¸çŸ¥ä¸ºä½•ç«Ÿå‡ºç°åœ¨äº† <strong class="highlight-npc">${plotter.name}</strong> çš„å¤´ä¸Šã€‚`
                };
            },
            options: [
                {
                    text: "ã€è¿½é—®ç¼˜ç”±ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, victim] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: -8 } });
                        return `${plotter.name}è¾©ç§°æ˜¯${victim.name}èµ äºˆå¥¹çš„ï¼Œä½ è™½ä¸ä¿¡ï¼Œä½†ä¹Ÿæ— è¯æ®ã€‚`;
                    }
                },
                {
                    text: "ã€å†ä¹°ä¸€æ”¯æ›´å¥½çš„ç»™å—å®³è€…ã€‘",
                    req: (player) => gs.finances.wealth > 300,
                    action: (involved) => {
                        const [plotter, victim] = involved;
                        applyEffects({ wealth: -300, relationship: { targetId: victim.id, favor: 10 } });
                        return `ä½ åˆä¹°äº†ä¸€æ”¯æ›´å¥½çš„å‘ç°ªç»™${victim.name}ï¼Œè®©å¥¹ç ´æ¶•ä¸ºç¬‘ã€‚`;
                    }
                }
            ]
        },
        'isolating_newcomer': {
            title: "å­¤ç«‹æ–°äºº",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead);
                if (concubines.length < 2) return false;
                const newcomer = concubines.find(c => c.age < 20); // å‡è®¾æ–°äººå¹´é¾„å°
                const oldtimer = concubines.find(c => c.age > 25 && c.jealousy > 50);
                if (!newcomer || !oldtimer) return false;
                return {
                    involved: [oldtimer, newcomer],
                    description: `ä½ å‘ç°åºœä¸­çš„â€œè€äººâ€ <strong class="highlight-npc">${oldtimer.name}</strong> æ­£åœ¨è”åˆå…¶ä»–å§å¦¹ï¼Œå­¤ç«‹æ–°æ¥çš„ <strong class="highlight-npc">${newcomer.name}</strong>ã€‚`
                };
            },
            options: [
                {
                    text: "ã€å‡ºé¢åˆ¶æ­¢ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [oldtimer] = involved;
                        applyEffects({ relationship: { targetId: oldtimer.id, favor: -5 } });
                        gs.marriage.familyHarmony += 5;
                        return `ä½ å‡ºé¢åˆ¶æ­¢äº†å­¤ç«‹è¡Œä¸ºï¼Œç»´æŠ¤äº†åå®…çš„ç§©åºã€‚`;
                    }
                },
                {
                    text: "ã€è®¤ä¸ºè¿™æ˜¯ç”Ÿå­˜æ³•åˆ™ã€‘",
                    req: () => true,
                    action: (involved) => {
                        gs.marriage.familyHarmony -= 6;
                        return `ä½ é€‰æ‹©é™è§‚å…¶å˜ï¼Œæ–°äººè‹¥ä¸èƒ½è‡ªå·±ç«‹è¶³ï¼Œä¾¿ä¼šè¢«æ·˜æ±°ã€‚`;
                    }
                }
            ]
        },
        'claiming_illness_on_festival': {
            title: "ä½³èŠ‚ç§°ç—…",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.jealousy > 70);
                if (concubines.length === 0) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter],
                    description: `ä¸­ç§‹å®¶å®´ï¼Œæœ¬æ˜¯é˜–å®¶å›¢åœ†çš„æ—¥å­ï¼Œå¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> å´ç§°ç—…ä¸å‡ºå¸­ï¼Œå¼•å¾—ä½ æ¯äº²ä¸å¿«ã€‚`
                };
            },
            options: [
                {
                    text: "ã€äº²è‡ªæ¢æœ›ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: 5 } });
                        return `ä½ äº²è‡ªæ¢æœ›ï¼Œå¥¹è§ä½ å‰æ¥ï¼Œç—…ä¼¼ä¹å¥½äº†ä¸€åŠã€‚`;
                    }
                },
                {
                    text: "ã€äº‹åæƒ©ç½šã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: -8 } });
                        return `ä½ è®¤ä¸ºå¥¹æ˜¯æœ‰æ„ä¸ºä¹‹ï¼Œäº‹åç½šå¥¹æŠ„å†™å¥³åˆ™ã€‚`;
                    }
                }
            ]
        },
        'pawning_items': {
            title: "å…¸å½“ç§ç‰©",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 50);
                if (concubines.length === 0) return false;
                const pawner = getRandomElement(concubines);
                return {
                    involved: [pawner],
                    description: `ä½ æ— æ„ä¸­å‘ç°ï¼Œå¦¾å®¤ <strong class="highlight-npc">${pawner.name}</strong> ç«Ÿå·å·å°†ä½ èµèµç»™å¥¹çš„ä¸€ä»¶æ‘†è®¾æ‹¿å»å…¸å½“ï¼Œæ¢äº†ç§æˆ¿é’±ã€‚`
                };
            },
            options: [
                {
                    text: "ã€å…¬å¼€æ­¤äº‹ï¼Œä¸¥æƒ©ä¸è´·ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [pawner] = involved;
                        applyEffects({ relationship: { targetId: pawner.id, favor: -15 } });
                        return `ä½ ä¸¥æƒ©äº†å¥¹ï¼Œæ•´é¡¿äº†å†…å®…é£æ°”ã€‚`;
                    }
                },
                {
                    text: "ã€ä»¥æ­¤ä¸ºæŠŠæŸ„ï¼Œæ”¶ä¸ºå·±ç”¨ã€‘",
                    req: (player) => player.attributes.strategy > 80,
                    action: (involved) => {
                        const [pawner] = involved;
                        pawner.loyalty = (pawner.loyalty || 0) + 20; // å‡è®¾æœ‰å¿ è¯šåº¦
                        return `ä½ ç§ä¸‹ä¸å¥¹å¯¹è´¨ï¼Œå¥¹æƒ§æ€•è¢«æ­å‘ï¼Œä»æ­¤å¯¹ä½ è¨€å¬è®¡ä»ã€‚`;
                    }
                }
            ]
        },
        'unexpected_kindness': {
            title: "æ„å¤–çš„ç¤ºå¥½",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 60 && c.personality.includes('è…¹é»‘'));
                if (concubines.length === 0) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter],
                    description: `ä¸€å‘ä¸æ­£å¦»ä¸ç¦çš„å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong>ï¼Œä»Šæ—¥ç«Ÿä¸»åŠ¨ä¸ºæ­£å¦»é€å»å¥¹äº²æ‰‹åšçš„ç‚¹å¿ƒã€‚`
                };
            },
            options: [
                {
                    text: "ã€è®¤ä¸ºæ˜¯å’Œè§£ä¿¡å·ã€‘",
                    req: () => true,
                    action: (involved) => {
                        gs.marriage.familyHarmony += 2;
                        return `ä½ è®¤ä¸ºè¿™æ˜¯åå®…å’Œç¦çš„ä¿¡å·ï¼Œé¢‡ä¸ºæ¬£æ…°ã€‚`;
                    }
                },
                {
                    text: "ã€æ€€ç–‘æœ‰è¯ˆã€‘",
                    req: (player) => player.attributes.strategy > 60,
                    action: (involved) => {
                        return `ä½ æ€€ç–‘è¿™èƒŒåå¦æœ‰å›¾è°‹ï¼Œå†³å®šæš—ä¸­è§‚å¯Ÿã€‚`;
                    }
                }
            ]
        },
        'slandering_child': {
            title: "æ„é™·å­å—£",
            trigger: (gs) => {
                const wife = gs.npcs[gs.marriage.spouseId];
                if (!wife) return false;
                const heir = gs.children.find(c => c.motherId === wife.id && !c.isDead);
                if (!heir) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.jealousy > 80);
                if (concubines.length === 0) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter, heir],
                    description: `å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> åœ¨ä½ é¢å‰å“­è¯‰ï¼Œè¯´ä½ çš„å«¡å­ <strong class="highlight-npc">${heir.name}</strong> å°†å…¶æ¨å€’åœ¨åœ°ã€‚`
                };
            },
            options: [
                {
                    text: "ã€ç›¸ä¿¡å«¡å­ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: -10 } });
                        return `ä½ ç›¸ä¿¡è‡ªå·±çš„å­©å­ï¼Œæ–¥è´£äº†å¦¾å®¤ã€‚`;
                    }
                },
                {
                    text: "ã€æƒ©ç½šå«¡å­ï¼Œä»¥å¹³æ¯äº‹ç«¯ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, heir] = involved;
                        heir.favor = (heir.favor || 50) - 10;
                        applyEffects({ relationship: { targetId: gs.marriage.spouseId, favor: -5 } });
                        return `ä½ æƒ©ç½šäº†å­©å­ï¼Œè™½ç„¶å¹³æ¯äº†äº‹ç«¯ï¼Œä½†å­©å­å’Œæ­£å¦»å¯¹ä½ æ„Ÿåˆ°å¤±æœ›ã€‚`;
                    }
                }
            ]
        },
        'competing_for_childs_favor': {
            title: "äº‰å¤ºå­å—£å–œçˆ±",
            trigger: (gs) => {
                const wife = gs.npcs[gs.marriage.spouseId];
                if (!wife) return false;
                const heir = gs.children.find(c => c.motherId === wife.id && !c.isDead && c.age < 12);
                if (!heir) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 50);
                if (concubines.length === 0) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter, heir],
                    description: `å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> æ€»æ˜¯ç»™ä½ çš„å«¡å­ <strong class="highlight-npc">${heir.name}</strong> é€å»æ–°å¥‡çš„ç©å…·ï¼Œå…³ç³»ä¼¼ä¹æ¯”ä¸äº²ç”Ÿæ¯äº²è¿˜äº²è¿‘ã€‚`
                };
            },
            options: [
                {
                    text: "ã€è®¤ä¸ºå¥¹çœŸå¿ƒå–œçˆ±å­©å­ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: 5 } });
                        return `ä½ è®¤ä¸ºå¥¹çœŸå¿ƒå–œçˆ±å­©å­ï¼Œå¯¹å¥¹å°è±¡ä¸é”™ã€‚`;
                    }
                },
                {
                    text: "ã€è­¦å‘Šå¥¹å®‰å®ˆæœ¬åˆ†ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter] = involved;
                        applyEffects({ relationship: { targetId: plotter.id, favor: -8 } });
                        return `ä½ è­¦å‘Šå¥¹ä¸è¦å¯¹å«¡å­åŠ¨æ­ªå¿ƒæ€ã€‚`;
                    }
                }
            ]
        },
        'revealing_background': {
            title: "æ­éœ²èº«ä¸–",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead);
                if (concubines.length < 2) return false;
                const plotter = concubines.find(c => c.personality.includes('è…¹é»‘'));
                const victim = concubines.find(c => c.id !== plotter?.id && c.baseData.family < 40);
                if (!plotter || !victim) return false;
                return {
                    involved: [plotter, victim],
                    description: `åœ¨å®¶å®´ä¸Šï¼Œ<strong class="highlight-npc">${plotter.name}</strong> â€œæ— æ„â€ä¸­æ­éœ²äº† <strong class="highlight-npc">${victim.name}</strong> å…¶å®æ˜¯ç½ªè‡£ä¹‹åï¼Œä¸ºå¥´ä¸ºå©¢çš„è¿‡å¾€ï¼Œä»¤å…¶å½“ä¼—éš¾å ªã€‚`
                };
            },
            options: [
                {
                    text: "ã€ç»´æŠ¤å—å®³è€…ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, victim] = involved;
                        applyEffects({ relationship: { targetId: victim.id, favor: 10 }, relationship: { targetId: plotter.id, favor: -10 } });
                        return `ä½ ç»´æŠ¤äº†${victim.name}ï¼Œå¹¶æ–¥è´£äº†${plotter.name}ï¼Œå½°æ˜¾äº†å®¶ä¸»çš„æ°”åº¦ã€‚`;
                    }
                },
                {
                    text: "ã€è®¤ä¸ºè¡€ç»Ÿä¸æ´ï¼Œå†·è½å—å®³è€…ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, victim] = involved;
                        applyEffects({ relationship: { targetId: victim.id, favor: -15 } });
                        return `ä½ å¼€å§‹å†·è½${victim.name}ï¼Œè¿™æ­£ä¸­${plotter.name}ä¸‹æ€€ã€‚`;
                    }
                }
            ]
        },
        'secret_meeting_with_outsider': {
            title: "ç§ä¼šå¤–ç”·",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.favor < 20);
                if (concubines.length === 0) return false;
                const plotter = getRandomElement(concubines);
                return {
                    involved: [plotter],
                    description: `ä½ çš„å¿ƒè…¹æ’è§å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> æ­£åœ¨ä¸ä¸€ä½é™Œç”Ÿç”·å­åœ¨åé—¨å·å·è§é¢ï¼`
                };
            },
            options: [
                {
                    text: "ã€å½“åœºæŠ“è·ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [plotter] = involved;
                        plotter.isDead = true; // å‡è®¾æ²‰å¡˜
                        gs.marriage.concubines = gs.marriage.concubines.filter(id => id !== plotter.id);
                        return `ä½ å½“åœºæŠ“è·ï¼Œäººèµƒå¹¶è·ã€‚ä¸ºæ­£å®¶é£ï¼Œä½ ä¸‹ä»¤å°†å…¶æ²‰å¡˜ã€‚`;
                    }
                },
                {
                    text: "ã€è°ƒæŸ¥ç”·å­èº«ä»½ã€‘",
                    req: (player) => player.attributes.strategy > 70,
                    action: (involved) => {
                        return `ä½ å‘ç°ç”·å­æ˜¯å¥¹å¤±æ•£å¤šå¹´çš„å…„é•¿ã€‚ä½ é€‰æ‹©èµ„åŠ©ä»–ä»¬ï¼Œè¯¥å¦¾å®¤ä»æ­¤å¯¹ä½ æ­»å¿ƒå¡Œåœ°ã€‚`;
                    }
                }
            ]
        },
        'dowry_competition': {
            title: "å«å¦†ä¹‹äº‰",
            trigger: (gs) => {
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead);
                if (concubines.length < 2) return false;
                const richOne = concubines.find(c => c.baseData.family > 70);
                const poorOne = concubines.find(c => c.baseData.family < 40);
                if (!richOne || !poorOne) return false;
                return {
                    involved: [richOne, poorOne],
                    description: `å®¶ä¸–å¯Œè£•çš„ <strong class="highlight-npc">${richOne.name}</strong> æ·»ç½®äº†ä¸€å¥—åè´µçš„å¤´é¢ï¼Œå¹¶åœ¨æ— æ„ä¸­å‘å«å¦†å•è–„çš„ <strong class="highlight-npc">${poorOne.name}</strong> ç‚«è€€ï¼Œæƒ¹å¾—å¯¹æ–¹æš—è‡ªå‚æ³ªã€‚`
                };
            },
            options: [
                {
                    text: "ã€å®‰æŠšå¹¶èµ ç¤¼ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [richOne, poorOne] = involved;
                        applyEffects({ wealth: -200, relationship: { targetId: poorOne.id, favor: 8 } });
                        return `ä½ ç§ä¸‹èµ äºˆ${poorOne.name}ä¸€äº›é¦–é¥°ï¼Œå®‰æŠšäº†å¥¹çš„æƒ…ç»ªã€‚`;
                    }
                },
                {
                    text: "ã€å‘Šè¯«ç‚«è€€è€…ã€‘",
                    req: () => true,
                    action: (involved) => {
                        const [richOne] = involved;
                        applyEffects({ relationship: { targetId: richOne.id, favor: -5 } });
                        return `ä½ å‘Šè¯«${richOne.name}è¦æ‡‚å¾—æ”¶æ•›ï¼Œå¥¹æœ‰äº›ä¸æœæ°”ã€‚`;
  }
                }
            ]
        },

        // ... (æ‚¨åŸæœ‰çš„æ‰€æœ‰ç”·æ€§å®…æ–—äº‹ä»¶éƒ½å®Œæ•´ä¿ç•™åœ¨è¿™é‡Œï¼Œæ— éœ€æ‹…å¿ƒ) ...
        'jealousy': {
            title: "äº‰é£åƒé†‹",
            trigger: (gs) => {
                if (gs.marriage.familyHarmony > 60) return false;
                const concubines = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.jealousy > 40);
                if (concubines.length < 2) return false;
                concubines.sort((a, b) => b.jealousy - a.jealousy);
                const involved = [concubines[0], concubines[1]];
                return {
                    involved: involved,
                    description: `ä½ çš„ä¸¤ä½å¦¾å®¤ <strong class="highlight-npc">${involved[0].name}</strong> å’Œ <strong class="highlight-npc">${involved[1].name}</strong> å› ä¸€ä»¶é¦–é¥°å‘ç”Ÿæ¿€çƒˆäº‰åµï¼Œé—¹åˆ°ä½ é¢å‰è®©ä½ è¯„ç†ã€‚`
                };
            },
            options: [
                {
                    text: "å„æ‰“äº”åå¤§æ¿",
                    req: (player) => player.attributes.prestige > 50,
                    action: (involved) => {
                        applyEffects({ relationship: { targetId: involved[0].id, favor: -5 } });
                        applyEffects({ relationship: { targetId: involved[1].id, favor: -5 } });
                        gameState.marriage.familyHarmony -= 5;
                        return `ä½ æš‚æ—¶å‹åˆ¶äº†äº‹æ€ï¼Œä½†ä¸¤äººå¯¹ä½ çš„å¥½æ„Ÿå‡ä¸‹é™äº†ã€‚`;
                    }
                },
                {
                    text: "åè¢’å—å® ä¸€æ–¹",
                    req: () => true,
                    action: (involved) => {
                        const favored = involved[0].favor > involved[1].favor ? involved[0] : involved[1];
                        const unfavored = favored === involved[0] ? involved[1] : involved[0];
                        applyEffects({ relationship: { targetId: favored.id, favor: 5 } });
                        applyEffects({ relationship: { targetId: unfavored.id, favor: -15 } });
                        unfavored.jealousy = (unfavored.jealousy || 0) + 20;
                        unfavored.ambition = (unfavored.ambition || 0) + 10;
                        gameState.marriage.familyHarmony -= 10;
                        return `ä½ åè¢’äº†${favored.name}ï¼Œå¥¹çš„å¥½æ„Ÿæå‡ï¼Œä½†${unfavored.name}çš„å«‰å¦’ä¸é‡å¿ƒå¤§å¹…æå‡ã€‚`;
                    }
                },
                {
                    text: "è®²é“ç†ï¼ŒæŸ¥æ˜çœŸç›¸",
                    req: (player) => player.attributes.strategy > 40,
                    action: (involved) => {
                        const instigator = Math.random() < 0.5 ? involved[0] : involved[1];
                        const victim = instigator === involved[0] ? involved[1] : involved[0];
                        applyEffects({ relationship: { targetId: victim.id, favor: 10 } });
                        applyEffects({ relationship: { targetId: instigator.id, favor: -10 } });
                        gameState.marriage.familyHarmony += 3;
                        return `ä½ é€šè¿‡è¯¢é—®ä¸‹äººï¼Œå‘ç°æ˜¯${instigator.name}å…ˆæŒ‘è¡…ã€‚ä½ æƒ©ç½šäº†å¥¹ï¼Œå®‰æŠšäº†${victim.name}ï¼Œå½°æ˜¾äº†ä½ çš„å…¬æ­£ã€‚`;
                    }
                },
                {
                    text: "äº¤ç”±æ­£å¦»å¤„ç†",
                    req: () => gameState.marriage.isMarried && gameState.npcs[gameState.marriage.spouseId],
                    action: (involved) => {
                        const wife = gameState.npcs[gameState.marriage.spouseId];
                        if ((wife.attributes.virtue || 50) > 70 && (wife.attributes.wisdom || 50) > 60) {
                            gameState.marriage.familyHarmony += 5;
                            return `ä½ çš„æ­£å¦»å¤„ç†å¾—å½“ï¼Œåå®…å’Œè°åº¦æå‡ã€‚`;
                        } else {
                            gameState.marriage.familyHarmony -= 8;
                            return `ä½ çš„æ­£å¦»åè¢’ä¸€æ–¹ï¼Œæ¿€åŒ–äº†çŸ›ç›¾ã€‚`;
                        }
                    }
                }
            ]
        },
        'framing': {
            title: "æ„é™·æ ½èµƒ",
            trigger: (gs) => {
                if (gs.marriage.familyHarmony > 50) return false;
                const plotters = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 60 && c.jealousy > 50);
                const victims = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.favor > 50 && plotters.every(p => p.id !== c.id));
                if (plotters.length === 0 || victims.length === 0) return false;
                const plotter = getRandomElement(plotters);
                const victim = getRandomElement(victims);
                return {
                    involved: [plotter, victim],
                    description: `å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> çªç„¶å“­è¯‰ï¼Œè¯´å¥¹ççˆ±çš„å® ç‰©çŒ«è¢«å—å® çš„ <strong class="highlight-npc">${victim.name}</strong> æ¯’æ­»äº†ï¼Œå¹¶æ‹¿å‡ºäº†â€œè¯æ®â€ã€‚`
                };
            },
            options: [
                {
                    text: "å‹ƒç„¶å¤§æ€’ï¼Œç«‹åˆ»æƒ©ç½š",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, victim] = involved;
                        applyEffects({ relationship: { targetId: victim.id, favor: -30 } });
                        gameState.marriage.familyHarmony -= 15;
                        gameState.family.reputation -= 10;
                        return `ä½ æƒ©ç½šäº†å«å†¤çš„${victim.name}ï¼Œå¥¹å¯¹ä½ å¥½æ„Ÿéª¤é™ï¼Œå¹¶å‘èª“æŠ¥å¤ã€‚äº‹åä½ å‘ç°æ˜¯${plotter.name}æ ½èµƒï¼Œä½ çš„å£°æœ›ä¹Ÿå› æ­¤å—æŸã€‚`;
                    }
                },
                {
                    text: "æ€€ç–‘æ­¤äº‹æœ‰è¯ˆï¼Œæš—ä¸­è°ƒæŸ¥",
                    req: (player) => player.attributes.strategy > 60,
                    action: (involved) => {
                        const [plotter, victim] = involved;
                        applyEffects({ attributes: { strategy: 3 } });
                        plotter.ambition = Math.max(0, plotter.ambition - 10);
                        return `ä½ æ´¾å¿ƒè…¹æŸ¥æ˜çœŸç›¸ï¼Œæœç„¶æ˜¯${plotter.name}æ ½èµƒã€‚ä½ æŒæ¡äº†è¿™ä¸ªæŠŠæŸ„ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶å¥¹ã€‚`;
                    }
                },
                {
                    text: "ç”¨é’±å®‰æŠšï¼Œæ¯äº‹å®äºº",
                    req: (player) => gameState.finances.wealth > 1000,
                    action: (involved) => {
                        const [plotter, victim] = involved;
                        applyEffects({ wealth: -1000, relationship: { targetId: victim.id, favor: -5 } });
                        plotter.ambition += 5;
                        gameState.marriage.familyHarmony -= 5;
                        return `ä½ ç”¨é’±å®‰æŠšäº†${plotter.name}ï¼Œå¥¹å°åˆ°äº†ç”œå¤´ï¼Œæœªæ¥å¯èƒ½æ•…æŠ€é‡æ–½ã€‚${victim.name}å¯¹ä½ çš„ä¸ä½œä¸ºæ„Ÿåˆ°å¤±æœ›ã€‚`;
                    }
                }
            ]
        },
        'heir_struggle': {
            title: "å¤ºå«¡ä¹‹äº‰",
            trigger: (gs) => {
                const wife = gs.npcs[gs.marriage.spouseId];
                if (!wife || !gs.children.some(c => c.motherId === wife.id)) return false; // Must have a legitimate heir
                const ambitiousMothers = gs.marriage.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 70 && gs.children.some(child => child.motherId === c.id));
                if (ambitiousMothers.length === 0) return false;
                const plotter = getRandomElement(ambitiousMothers);
                return {
                    involved: [plotter, wife],
                    description: `å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> ä¸ºäº†è®©è‡ªå·±çš„å„¿å­è·å¾—ä½ æ›´å¤šçš„å…³æ³¨ï¼Œåœ¨èƒŒåæ•£æ’­æ­£å¦»å«¡å­çš„è°£è¨€ï¼Œç§°å…¶â€œèµ„è´¨å¹³åº¸ï¼Œä¸å ªä¸ºç»§â€ã€‚`
                };
            },
            options: [
                {
                    text: "ä¸¥å‰è­¦å‘Š",
                    req: (player) => player.attributes.prestige > 80,
                    action: (involved) => {
                        const [plotter] = involved;
                        plotter.ambition = Math.max(0, plotter.ambition - 20);
                        return `ä½ å½“ä¼—æ–¥è´£äº†${plotter.name}ï¼Œå¥¹çš„é‡å¿ƒè¢«æš‚æ—¶å‹åˆ¶ï¼Œä½†å¯¹ä½ çš„å«¡å­æ€€æ¨åœ¨å¿ƒã€‚`;
                    }
                },
                {
                    text: "è€ƒæ ¡æ‰€æœ‰å­å—£",
                    req: () => true,
                    action: (involved) => {
                        const [plotter, wife] = involved;
                        if (Math.random() < 0.6) {
                             applyEffects({ attributes: { prestige: 5 } });
                             return `ä½ ä¸¾åŠäº†ä¸€åœºå®¶åº­è€ƒæ ¸ï¼Œå«¡å­è¡¨ç°å‡ºè‰²ï¼Œè°£è¨€ä¸æ”»è‡ªç ´ï¼Œå®¶å¨æå‡ã€‚`;
                        } else {
                            applyEffects({ relationship: { targetId: wife.id, favor: -10 } });
                            return `è€ƒæ ¸ä¸­ï¼Œ${plotter.name}çš„å„¿å­è¡¨ç°æ›´ä¼˜ï¼Œå¥¹çš„æ°”ç„°æ›´åŠ åš£å¼ ï¼Œæ­£å¦»å¯¹ä½ æ„Ÿåˆ°ä¸æ»¡ã€‚`;
                        }
                    }
                },
                {
                    text: "å°†è®¡å°±è®¡ï¼Œè€ƒéªŒå«¡å­",
                    req: (player) => player.attributes.strategy > 70,
                    action: (involved) => {
                        return `ä½ å‡è£…ç›¸ä¿¡è°£è¨€ï¼Œæ•…æ„å†·è½å«¡å­ï¼Œè§‚å¯Ÿä»–çš„ååº”ã€‚è¿™æˆ–è®¸èƒ½ç£¨ç»ƒå‡ºä¸€ä½å¿ƒæ€§åšéŸ§çš„ç»§æ‰¿äººï¼Œä¹Ÿå¯èƒ½è®©ä½ ä»¬çˆ¶å­äº§ç”Ÿéš”é˜‚ã€‚`;
                    }
                }
            ]
        }
    },
    female: {
    // â–¼â–¼â–¼ ã€æ–°å¢5ä¸ªå®…æ–—äº‹ä»¶ã€‘ â–¼â–¼â–¼
    'flattery_trap': {
        title: "æ§æ€ä¹‹è®¡",
        trigger: (gs) => {
            // æ¡ä»¶ï¼šåˆšè¿›é—¨ä¸ä¹…(æŒå®¶æƒä½)ï¼Œä¸”æœ‰è…¹é»‘æˆ–é‡å¿ƒé«˜çš„å¦¾å®¤
            if (gs.marriage.householdAuthority.progress >= 20) return false;
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines || husband.concubines.length === 0) return false;
            const plotter = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && ((c.personality && c.personality.includes('è…¹é»‘')) || c.ambition > 60));
            return plotter ? { involved: [plotter], description: `ä½ åˆšè¿‡é—¨ä¸ä¹…ï¼Œå¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> ä¾¿åœ¨ä½ å‘å©†å©†è¯·å®‰æ—¶ï¼Œå½“ä¼—å¤§è‚†å¤¸èµä½ çš„å«å¦†ä½•ç­‰ä¸°åšï¼Œè¨€è¯­é—´æš—ç¤ºä½ â€œè´¢å¤§æ°”ç²—ï¼Œä¸ä¹ èŠ‚ä¿­â€ã€‚` } : false;
        },
        options: [
            { text: "é¡ºç€å¥¹çš„è¯è‡ªå¤¸", action: () => { 
                applyEffects({relationship: { targetId: 'mother_in_law', favor: -10 }, attributes: {scheming: -2}});
                return 'å©†å©†æœç„¶å¯¹ä½ äº§ç”Ÿäº†ä¸å–œä¹‹å¿ƒï¼Œè®¤ä¸ºä½ ä¸å¤Ÿè°¦é€Šã€‚';
             } },
            { text: "è°¦è™šå¹¶å›æ§å©†å©†", req: (p) => p.attributes.scheming > 50, action: (involved) => { 
                applyEffects({relationship: { targetId: 'mother_in_law', favor: 5 }, relationship: { targetId: involved[0].id, favor: -5 }, attributes: {scheming: 2}});
                return `ä½ è°¦è™šåœ°è¡¨ç¤ºå«å¦†çš†æ˜¯çˆ¶æ¯æ©èµï¼Œå¹¶ç§°èµå©†å©†æŒå®¶æœ‰é“æ‰æ˜¯ä½ çš„æ¦œæ ·ã€‚å©†å©†å¯¹ä½ é¢‡ä¸ºæ»¡æ„ï¼Œ${involved[0].name}çš„è®¡è°‹è½ç©ºã€‚`;
            } },
            { text: "è½¬ç§»è¯é¢˜ï¼ŒæåŠå®¶ä¹¡è¶£é—»", req: (p) => p.attributes.charm > 60, action: () => { 
                applyEffects({relationship: { targetId: 'mother_in_law', favor: 2 }, attributes: {charm: 1}});
                return 'ä½ å·§å¦™åœ°ç”¨å®¶ä¹¡è¶£é—»å¼•å¼€äº†è¯é¢˜ï¼ŒæˆåŠŸåŒ–è§£äº†å°´å°¬ã€‚';
            } }
        ]
    },
    'stolen_pin': {
        title: "å¤±çªƒçš„ç é’—",
        trigger: (gs) => {
            // æ¡ä»¶ï¼šä½ æ¯”å…¶ä»–å¦¾å®¤æ›´å—å® ï¼Œä¸”æœ‰è‡³å°‘ä¸¤ä½é‡å¿ƒé«˜çš„å¦¾å®¤
            if (gs.marriage.favor <= 40) return false;
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines || husband.concubines.length < 2) return false;
            const plotters = husband.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.favor < gs.marriage.favor && c.ambition > 50);
            if (plotters.length < 2) return false;
            const mainPlotter = plotters.sort((a,b) => b.ambition - a.ambition)[0];
            const accomplice = plotters.find(p => p.id !== mainPlotter.id);
            return mainPlotter && accomplice ? { involved: [mainPlotter, accomplice], description: `ä¸ˆå¤«èµèµç»™ä½ ä¸€æ”¯åè´µçš„å—æµ·çç é’—ã€‚æ¬¡æ—¥ï¼Œ<strong class="highlight-npc">${mainPlotter.name}</strong> çš„ä¸«é¬Ÿçªç„¶å¸¦äººå†²è¿›ä½ çš„é™¢å­ï¼Œå£°ç§°æ˜¯ä½ çš„ä¸«é¬Ÿå·äº†å¥¹çš„ç é’—ï¼Œå¹¶â€œæœâ€å‡ºäº†ä¸€æ¨¡ä¸€æ ·çš„é’—å­ã€‚` } : false;
        },
        options: [
            { text: "ç™¾å£è«è¾©ï¼Œè¯·æ±‚ä¸ˆå¤«è£å†³", action: (involved) => {
                applyEffects({marriage: {favor: -15}});
                return 'ä¸ˆå¤«è§åé™¢ä¸å®ï¼Œå¿ƒç”Ÿçƒ¦é—·ï¼Œå¯¹ä½ å¥½æ„Ÿä¸‹é™ã€‚æ­¤äº‹æœ€ç»ˆä¸äº†äº†ä¹‹ã€‚';
             } },
            { text: "æŒ‡å‡ºç ´ç»½ï¼Œè¦æ±‚å¯¹è´¨", req: (p) => p.attributes.scheming > 70, action: (involved) => {
                const [mainPlotter, accomplice] = involved;
                applyEffects({ attributes: { scheming: 5 }, marriage: { favor: 15 } });
                return `ä½ æŒ‡å‡ºâ€œè¿™é’—å­æˆ‘æ˜¨å¤œè¿˜è§å¤«å›èµç»™äº†${accomplice.name}ä¸€æ”¯â€ï¼Œ${mainPlotter.name}å’Œ${accomplice.name}è„¸è‰²å¤§å˜ã€‚ä½ æˆåŠŸè¯†ç ´äº†å¥¹ä»¬çš„è”åˆé™·å®³ï¼Œä¸ˆå¤«å¯¹ä½ çš„æ™ºæ…§åˆ®ç›®ç›¸çœ‹ã€‚`;
            }},
            { text: "ä¸»åŠ¨è®¤ç½šï¼Œå±•ç°å¤§åº¦", action: (involved) => { 
                applyEffects({attributes: {virtue: 5}, marriage: {favor: 5}});
                return 'ä½ ä¸»åŠ¨æ‰¿æ‹…äº†â€œç®¡æ•™ä¸‹äººä¸ä¸¥â€çš„è´£ä»»ï¼Œå¹¶è‡ªç½šæœˆé’±ã€‚ä½ çš„å¤§åº¦è®©ä¸ˆå¤«é¢‡ä¸ºæ¬£èµï¼Œä½†å¦¾å®¤ä»¬å¯èƒ½è§‰å¾—ä½ è½¯å¼±å¯æ¬ºã€‚';
            } }
        ]
    },
    'poisoned_soup': {
        title: "ä¸€ç¢—ç‡•çª",
        trigger: (gs) => {
            // æ¡ä»¶ï¼šä½ æ€€å­•äº†ï¼Œä¸”æœ‰è…¹é»‘+é‡å¿ƒé«˜çš„å¦¾å®¤
            if (!gs.player.isPregnant) return false;
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const plotter = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.ambition > 80 && c.personality.includes('è…¹é»‘'));
            return plotter ? { involved: [plotter], description: `ä½ æ€€å­•åï¼Œ<strong class="highlight-npc">${plotter.name}</strong> æ¯æ—¥äº²æ‰‹ä¸ºä½ ç‚–ç‡•çªé€æ¥ï¼Œä»Šæ—¥çš„ç‡•çªä¼¼ä¹é¢œè‰²æœ‰äº›ä¸å¯¹...` } : false;
        },
        options: [
            { text: "ä¿¡ä»»å¥¹ï¼Œç›´æ¥å–ä¸‹", action: (involved) => { 
                applyEffects({attributes: {health: -20}});
                gameState.player.miscarriageChance = (gameState.player.miscarriageChance || 0) + 0.3;
                return 'å–ä¸‹åä½ è…¹ç—›ä¸æ­¢ï¼Œé™©äº›æµäº§ï¼å¥åº·å¤§å¹…ä¸‹é™ã€‚';
            } },
            { text: "ä¸åŠ¨å£°è‰²ï¼Œè¯·åŒ»éªŒè¯", req: (p) => p.career.path === 'doctor' || p.attributes.wisdom > 80, action: (involved) => {
                const [plotter] = involved;
                gameState.flags.hasConcubineEvidence = plotter.id;
                return `ä½ æ‰˜æ•…ç•™ä¸‹ç‡•çªï¼ŒæŸ¥å‡ºå…¶ä¸­å«æœ‰å°‘é‡çº¢èŠ±ã€‚ä½ æŒæ¡äº†${plotter.name}çš„è‡´å‘½æŠŠæŸ„ï¼Œå¯ä»¥åœ¨å¤«å›é¢å‰æ­å‘å¥¹ã€‚`;
            }},
            { text: "å€ŸèŠ±çŒ®ä½›ï¼Œè½¬èµ å¥¹äºº", req: (p) => p.attributes.scheming > 80, action: (involved) => {
                const husband = gameState.npcs[gameState.marriage.spouseId];
                const otherConcubine = husband.concubines.map(id => gameState.npcs[id]).find(c => c && !c.isDead && c.id !== involved[0].id);
                if (otherConcubine) {
                    applyEffects({relationship: {targetId: otherConcubine.id, favor: -30}});
                    return `ä½ å°†ç‡•çªè½¬é€ç»™${otherConcubine.name}ï¼Œå¼•å‘äº†å¥¹ä¸${involved[0].name}çš„ç«å¹¶ï¼Œä½ å¯åå±±è§‚è™æ–—ã€‚`;
                }
                return "åºœä¸Šæš‚æ— å…¶ä»–å¦¾å®¤å¯è½¬èµ ã€‚";
            }}
        ]
    },
    'sowing_discord': {
        title: "æŒ‘æ‹¨ç¦»é—´",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const plotter = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.ambition > 65 && c.personality.includes('è…¹é»‘'));
            return plotter ? { involved: [plotter], description: `å¦¾å®¤ <strong class="highlight-npc">${plotter.name}</strong> åœ¨ä½ å¤«å›é¢å‰â€œæ— æ„â€ä¸­æèµ·ï¼Œè¯´çœ‹åˆ°ä½ ä¸ä¸€ä½é™Œç”Ÿç”·å­åœ¨è¡—è§’äº¤è°ˆï¼Œè¨€è¯­äº²å¯†ã€‚` } : false;
        },
        options: [
            { text: "ä¸å¤«å›å¯¹è´¨", action: () => {
                if (gs.marriage.favor > 70) {
                    applyEffects({ marriage: { favor: 5 } });
                    return 'å¤«å›å…¨ç„¶ä¸ä¿¡æ­¤ç­‰æ‹™åŠ£è°è¨€ï¼Œåè€Œæ›´æ€œæƒœä½ ã€‚';
                } else {
                    applyEffects({ marriage: { favor: -10 } });
                    return 'å¤«å›åŠä¿¡åŠç–‘ï¼Œä½ ä»¬ä¹‹é—´äº§ç”Ÿäº†éš”é˜‚ã€‚';
                }
            }},
            { text: "ç§ä¸‹è­¦å‘Šå¦¾å®¤", req: (p) => p.attributes.scheming > 60, action: (involved) => {
                involved[0].ambition = Math.max(0, (involved[0].ambition || 0) - 10);
                return 'ä½ ç§ä¸‹è­¦å‘Šäº†å¥¹ï¼Œä½ çš„æ°”åœºè®©å¥¹ä¸æ•¢å†è½»ä¸¾å¦„åŠ¨ã€‚';
            }}
        ]
},
 'concubine_requests_help': {
        title: "å¦¾å®¤çš„æ±‚åŠ©",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines || husband.concubines.length < 2) return false;
            const plotters = husband.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.ambition > 60);
            const victims = husband.concubines.map(id => gs.npcs[id]).filter(c => c && !c.isDead && c.favor < 40);
            if (plotters.length === 0 || victims.length === 0) return false;
            return { involved: [getRandomElement(victims), getRandomElement(plotters)], description: `ä¸€ä½ä¸å—å® çš„å¦¾å®¤<strong class="highlight-npc">${victims[0].name}</strong>å“­ç€å‘ä½ æ±‚åŠ©ï¼Œè¯´å¥¹è¢«<strong class="highlight-npc">${plotters[0].name}</strong>æ¬ºè´Ÿï¼Œå…‹æ‰£äº†ä»½ä¾‹ã€‚` };
        },
        options: [
            { text: "ä¸ºå¥¹å‡ºå¤´ï¼Œå½°æ˜¾å…¬æ­£", req: (p) => p.attributes.virtue > 70, action: (involved) => {
                applyEffects({marriage: {familyHarmony: 5}});
                return 'ä½ ç§‰å…¬å¤„ç†ï¼Œä¸ºä½ èµ¢å¾—äº†åå®…çš„äººå¿ƒï¼Œå®¶å®…å’Œè°åº¦æå‡ã€‚';
            }},
            { text: "å€Ÿæœºæ‰“å‹å—å® å¦¾å®¤", req: (p) => p.attributes.scheming > 60, action: (involved) => {
                applyEffects({relationship: { targetId: involved[1].id, favor: -10 }});
                return `ä½ å€Ÿé¢˜å‘æŒ¥ï¼Œä¸ä»…è§£å†³äº†é—®é¢˜ï¼Œè¿˜æˆåŠŸæ‰“å‹äº†${involved[1].name}çš„æ°”ç„°ã€‚`;
            }},
            { text: "è®©å¥¹å¿è€", action: () => 'ä½ åŠå¥¹ä»¥å’Œä¸ºè´µï¼Œå¥¹å¤±æœ›åœ°ç¦»å¼€äº†ã€‚' }
        ]
    },
    'concubine_family_visit': {
        title: "å¦¾å®¤å®¶äººæ¥è®¿",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const target = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && Math.random() < 0.1);
            return target ? { involved: [target], description: `å¦¾å®¤<strong class="highlight-npc">${target.name}</strong>çš„å®¶äººå‰æ¥æ¢æœ›ï¼Œè¨€è¡Œç²—é„™ï¼Œè®©ä½ å¤«å®¶å¤±äº†é¢œé¢ã€‚` } : false;
        },
        options: [
            { text: "å¥½è¨€æ¬¾å¾…ï¼Œä»¥ç¤¼ç›¸å¾…", req: (p) => p.attributes.etiquette > 80, action: (involved) => {
                applyEffects({relationship: { targetId: involved[0].id, favor: 5 }, attributes: {virtue: 2}});
                return `ä½ çš„å¤§åº¦å¾—ä½“è®©${involved[0].name}å¿ƒå­˜æ„Ÿæ¿€ï¼Œä¹Ÿç»´æŠ¤äº†å®¶æ—çš„ä½“é¢ã€‚`;
            }},
            { text: "å‘½ä¸‹äººå°†å…¶â€œè¯·â€å‡ºå»", req: (p) => p.attributes.prestige > 60, action: (involved) => {
                applyEffects({relationship: { targetId: involved[0].id, favor: -15 }});
                return `ä½ å¼ºç¡¬åœ°å¤„ç†äº†æ­¤äº‹ï¼Œä½†ä¸${involved[0].name}ç»“ä¸‹äº†æ¢å­ã€‚`;
            }}
        ]
    },
    'shared_enemy': {
        title: "å…±åŒçš„æ•Œäºº",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const newFavored = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.favor > 80 && c.age < 20);
            const oldOne = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.favor < 50 && c.ambition > 50);
            return newFavored && oldOne ? { involved: [oldOne, newFavored], description: `å¤«å›æ–°çº³çš„å® å¦¾<strong class="highlight-npc">${newFavored.name}</strong>é£å¤´æ­£ç››ï¼Œå¨èƒåˆ°äº†ä½ åœ¨å†…çš„æ‰€æœ‰äººã€‚å¤±å® çš„<strong class="highlight-npc">${oldOne.name}</strong>ç§ä¸‹æ‰¾åˆ°ä½ ï¼Œå¸Œæœ›ä¸ä½ è”æ‰‹ã€‚` } : false;
        },
        options: [
            { text: "åŒæ„è”æ‰‹ï¼Œåˆ†åŒ–å…¶æ©å® ", req: (p) => p.attributes.scheming > 70, action: (involved) => {
                applyEffects({relationship: { targetId: involved[0].id, favor: 10 }});
                return `ä½ ä»¬è¾¾æˆåŒç›Ÿï¼Œå†³å®šä¸€åŒå¯¹ä»˜æ–°æ¥çš„å® å¦¾ã€‚`;
            }},
            { text: "æ‹’ç»ï¼Œå¹¶æ•²æ‰“å¯¹æ–¹", action: () => 'ä½ æ‹’ç»äº†å¥¹çš„æè®®ï¼Œå¹¶è­¦å‘Šå¥¹ä¸è¦åŠ¨æ­ªå¿ƒæ€ã€‚' }
        ]
    },
    'concubine_imitation': {
        title: "åˆ»æ„æ¨¡ä»¿",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const imitator = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.ambition > 60 && Math.random() < 0.15);
            return imitator ? { involved: [imitator], description: `ä½ å‘ç°å¦¾å®¤<strong class="highlight-npc">${imitator.name}</strong>æœ€è¿‘æ€»åœ¨æ¨¡ä»¿ä½ çš„ç©¿ç€æ‰“æ‰®å’Œè¨€è¡Œä¸¾æ­¢ï¼Œæ„å›¾åšå–å¤«å›çš„æ¬¢å¿ƒã€‚` } : false;
        },
        options: [
            { text: "ä¸åŠ¨å£°è‰²ï¼Œçªç„¶æ”¹å˜é£æ ¼", req: (p) => p.attributes.charm > 80, action: () => 'ä½ çªç„¶æ”¹å˜é£æ ¼ï¼Œè®©å¥¹ä¸œæ–½æ•ˆé¢¦ï¼Œæ²¦ä¸ºç¬‘æŸ„ã€‚' },
            { text: "å…¬å¼€ç‚¹ç ´ï¼Œä»¤å…¶éš¾å ª", action: () => 'ä½ åœ¨ä¼—äººé¢å‰ç‚¹ç ´äº†å¥¹çš„å¿ƒæ€ï¼Œè®©å¥¹ç¾æ„§éš¾å½“ã€‚' }
        ]
    },
    'feigning_illness': {
        title: "ç§°ç—…äº‰å® ",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const target = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.jealousy > 70 && Math.random() < 0.2);
            return target ? { involved: [target], description: `åœ¨ä½ æ­£éœ€è¦å¤«å›é™ªä¼´æ—¶ï¼Œå¦¾å®¤<strong class="highlight-npc">${target.name}</strong>çªç„¶â€œç—…å€’â€äº†ï¼Œå¼•å¾—å¤«å›å‰å»æ¢æœ›ã€‚` } : false;
        },
        options: [
            { text: "æ´¾äººé€å»åè´µè¡¥å“", req: (p) => p.attributes.virtue > 60, action: () => 'ä½ çš„å¤§åº¦è®©å¤«å›è§‰å¾—ä½ å¾ˆè´¤æƒ ï¼Œä½†å¦¾å®¤è®¡è°‹å¾—é€ã€‚' },
            { text: "è¯·å¤ªåŒ»å‰å»â€œç»†ç»†â€è¯Šæ²»", req: (p) => p.attributes.scheming > 70, action: (involved) => {
                applyEffects({relationship: { targetId: involved[0].id, favor: -10 }});
                return `å¤ªåŒ»å›æŠ¥å¹¶æ— å¤§ç¢ï¼Œå¤«å›å¯Ÿè§‰åˆ°${involved[0].name}åœ¨è£…ç—…ï¼Œå¯¹å¥¹å¿ƒç”Ÿä¸æ‚¦ã€‚`;
            }}
        ]
    },
    'secret_pawn': {
        title: "å…¸å½“ç§ç‰©",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const target = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.ambition > 50 && Math.random() < 0.1);
            return target ? { involved: [target], description: `ä½ å‘ç°å¦¾å®¤<strong class="highlight-npc">${target.name}</strong>å·å·å°†åºœä¸­çš„ä¸€ä»¶æ‘†è®¾æ‹¿å»å…¸å½“ï¼Œæ¢äº†ç§æˆ¿é’±ã€‚` } : false;
        },
        options: [
            { text: "å…¬å¼€æ­¤äº‹ï¼Œä¸¥æƒ©ä¸è´·", action: () => 'ä½ ä¸¥æƒ©äº†å¥¹ï¼Œæ•´é¡¿äº†å†…å®…é£æ°”ã€‚' },
            { text: "ä»¥æ­¤ä¸ºæŠŠæŸ„ï¼Œæ”¶ä¸ºå·±ç”¨", req: (p) => p.attributes.scheming > 80, action: (involved) => {
                applyEffects({relationship: { targetId: involved[0].id, favor: 15 }});
                return `ä½ ç§ä¸‹ä¸${involved[0].name}å¯¹è´¨ï¼Œå¥¹æƒ§æ€•è¢«æ­å‘ï¼Œä»æ­¤å¯¹ä½ è¨€å¬è®¡ä»ã€‚`;
            }}
        ]
    },
    'concubine_gift': {
        title: "æ„å¤–çš„ç¤ºå¥½",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const target = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.ambition > 60 && Math.random() < 0.15);
            return target ? { involved: [target], description: `ä¸€å‘ä¸ä½ ä¸ç¦çš„å¦¾å®¤<strong class="highlight-npc">${target.name}</strong>ï¼Œä»Šæ—¥ç«Ÿä¸»åŠ¨ä¸ºä½ é€æ¥å¥¹äº²æ‰‹åšçš„ç‚¹å¿ƒã€‚` } : false;
        },
        options: [
            { text: "æ¬£ç„¶æ”¶ä¸‹ï¼Œè®¤ä¸ºæ˜¯å’Œè§£ä¿¡å·", action: (involved) => {
                applyEffects({relationship: { targetId: involved[0].id, favor: 5 }});
                return `ä½ æ”¶ä¸‹äº†ç‚¹å¿ƒï¼Œä½ ä»¬çš„å…³ç³»æœ‰æ‰€ç¼“å’Œã€‚`;
            }},
            { text: "æ€€ç–‘æœ‰è¯ˆï¼Œè®©é“¶é’ˆè¯•æ¯’", req: (p) => p.attributes.scheming > 70, action: () => 'é“¶é’ˆå¹¶æœªå˜é»‘ï¼Œæˆ–è®¸æ˜¯ä½ æƒ³å¤šäº†ï¼Œä½†ä¹Ÿå¯èƒ½å¯¹æ–¹çš„æ‰‹æ®µæ›´é«˜æ˜ã€‚' }
        ]
    },
    'child_slander': {
        title: "æ„é™·å­å—£",
        trigger: (gs) => {
            const myChild = gs.children.find(c => !c.isDead && c.motherId === 'player');
            if (!myChild) return false;
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const plotter = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.jealousy > 80);
            return plotter ? { involved: [plotter], description: `å¦¾å®¤<strong class="highlight-npc">${plotter.name}</strong>åœ¨å¤«å›é¢å‰å“­è¯‰ï¼Œè¯´ä½ çš„å­©å­<strong class="highlight-npc">${myChild.name}</strong>å°†å…¶æ¨å€’åœ¨åœ°ã€‚` } : false;
        },
        options: [
            { text: "ç›¸ä¿¡å­©å­ï¼Œä¸å¤«å›å¯¹è´¨", action: () => {
                if(gs.marriage.favor > 70) {
                    return 'å¤«å›é€‰æ‹©ç›¸ä¿¡ä½ å’Œå­©å­ï¼Œæ–¥è´£äº†å¦¾å®¤ã€‚';
                } else {
                    return 'å¤«å›è®¤ä¸ºä½ æŠ¤çŸ­ï¼Œå¯¹ä½ å¿ƒç”Ÿä¸æ»¡ã€‚';
                }
            }},
            { text: "æƒ©ç½šå­©å­ï¼Œä»¥å¹³æ¯äº‹ç«¯", action: () => 'ä½ æƒ©ç½šäº†å­©å­ï¼Œè™½ç„¶å¹³æ¯äº†äº‹ç«¯ï¼Œä½†å­©å­å¯¹ä½ æ„Ÿåˆ°å¤±æœ›ã€‚' }
        ]
    },
    'concubine_miscarriage': {
        title: "å°äº§é£æ³¢",
        trigger: (gs) => {
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const target = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.isPregnant && Math.random() < 0.2);
            return target ? { involved: [target], description: `æ€€å­•çš„å¦¾å®¤<strong class="highlight-npc">${target.name}</strong>çªç„¶å°äº§ï¼Œå¥¹çš„ä¸«é¬Ÿå´æŒ‡è®¤åœ¨äº‹å‘å‰æ›¾è§ä½ çš„å¿ƒè…¹å‡ºç°åœ¨é™„è¿‘ï¼` } : false;
        },
        options: [
            { text: "å½»æŸ¥æ­¤äº‹ï¼Œè‡ªè¯æ¸…ç™½", req: (p) => p.attributes.wisdom > 80, action: () => 'ç»è¿‡è°ƒæŸ¥ï¼Œä½ å‘ç°æ­¤äº‹ä¹ƒæ˜¯å¥¹è‡ªå¯¼è‡ªæ¼”çš„è‹¦è‚‰è®¡ï¼' },
            { text: "ç™¾å£è«è¾©ï¼Œè¢«å¤«å›åŒå¼ƒ", action: () => {
                applyEffects({marriage: {favor: -25}});
                return 'ä½ æ‹¿ä¸å‡ºè¯æ®ï¼Œå¤«å›å¯¹ä½ å¤±æœ›é€é¡¶ï¼Œæ©çˆ±å€¼å¤§é™ã€‚';
            }}
        ]
    },
    'usurp_power': {
        title: "è§Šè§æŒå®¶æƒ",
        trigger: (gs) => {
            if(gs.marriage.householdAuthority.progress < 80) return false;
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const target = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && c.ambition > 80 && Math.random() < 0.2);
            return target ? { involved: [target], description: `å¦¾å®¤<strong class="highlight-npc">${target.name}</strong>åœ¨å©†å©†é¢å‰è¡¨ç°å¾—æä¸ºè´¤æƒ ï¼Œå¹¶æš—ç¤ºä½ ç®¡å®¶å¤ªè¿‡é“ºå¼ æµªè´¹ã€‚` } : false;
        },
        options: [
            { text: "å½“é¢åå‡»ï¼Œæ­ç©¿å…¶ç”¨å¿ƒ", req: (p) => p.attributes.scheming > 80, action: () => 'ä½ å½“åœºæ‹¿å‡ºè´¦æœ¬è‡ªè¯ï¼Œå¹¶æŒ‡å‡ºäº†å¥¹çš„æ¼æ´ï¼Œè®©å¥¹æ— åœ°è‡ªå®¹ã€‚' },
            { text: "è¢«å©†å©†è®­æ–¥", action: () => {
                applyEffects({relationship: { targetId: 'mother_in_law', favor: -10 }});
                return 'å©†å©†ä¿¡äº†å¥¹çš„è¯ï¼Œå°†ä½ è®­æ–¥äº†ä¸€ç•ªã€‚';
            }}
        ]
    },
    'child_conflict': {
        title: "å­å—£äº‰ç«¯",
        trigger: (gs) => {
            const myChild = gs.children.find(c => !c.isDead && c.motherId === 'player');
            if (!myChild) return false;
            const husband = gs.npcs[gs.marriage.spouseId];
            if (!husband || !husband.concubines) return false;
            const otherChildsMother = husband.concubines.map(id => gs.npcs[id]).find(c => c && !c.isDead && gs.children.some(child => child.motherId === c.id));
            return otherChildsMother ? { involved: [otherChildsMother], description: `ä½ çš„å«¡å­ä¸å¦¾å®¤ <strong class="highlight-npc">${otherChildsMother.name}</strong> çš„åº¶å­å› ä¸€ä»¶ç©å…·æ‰“äº†èµ·æ¥ï¼Œä¸¤ä¸ªå­©å­éƒ½å“­ç€æ¥æ‰¾ä½ ã€‚` } : false;
        },
        options: [
            { text: "è¢’æŠ¤å«¡å­ï¼Œè´£ç½šåº¶å­", action: (involved) => {
                applyEffects({ attributes: { virtue: -5 }, marriage: { favor: 5 } });
                return 'ä½ è¢’æŠ¤äº†è‡ªå·±çš„å­©å­ã€‚å¤«å›è®¤ä¸ºå«¡åº¶æœ‰åˆ«ï¼Œå¹¶æœªå¤šè¨€ï¼Œä½†å¦¾å®¤å¿ƒæ€€æ€¨æ¨ã€‚';
            }},
            { text: "å…¬å¹³å¤„ç†ï¼Œå„æ‰“äº”åå¤§æ¿", req: (p) => p.attributes.virtue > 60, action: () => {
                applyEffects({ attributes: { virtue: 5 } });
                return 'ä½ çš„å…¬æ­£èµ¢å¾—äº†ä¸‹äººçš„å°Šé‡ï¼Œä½†ä½ çš„å­©å­æ„Ÿåˆ°å§”å±ˆã€‚';
            }},
            { text: "åˆ©ç”¨æ­¤äº‹æ•²æ‰“å¦¾å®¤", req: (p) => p.attributes.scheming > 70, action: (involved) => {
                applyEffects({ attributes: { scheming: 3 } });
                involved[0].favor -= 10;
                return 'ä½ å€Ÿé¢˜å‘æŒ¥ï¼Œä¸ä»…å®‰æŠšäº†å­©å­ï¼Œè¿˜å€Ÿæœºæ•²æ‰“äº†å¦¾å®¤ä¸€ç•ªã€‚';
            }}
        ]
    }
    // æ‚¨åŸæœ‰çš„äº‹ä»¶ä¼šä¿ç•™åœ¨è¿™é‡Œ
    }
};
// [æ›¿æ¢] HOUSEHOLD_TASKS_EVENTS æ•°æ®å¯¹è±¡
const HOUSEHOLD_TASKS_EVENTS = {
    procurement: [
        {
            title: 'é‡‡åŠå¸ƒæ–™',
            desc: 'åºœä¸­éœ€è¦ä¸ºä¸‹äººæ·»ç½®å››å­£è¡£ç‰©ï¼Œä½ å»å¸ƒåº„é‡‡ä¹°å¸ƒæ–™ã€‚',
            options: [
                { text: 'é€‰æ‹©è€ç£¨çš„ç²—æ£‰å¸ƒ', effects: { finance: 5, wisdom: 1 }, result: 'ä½ ä¸ºåºœä¸­èŠ‚çœäº†å¼€æ”¯ï¼Œå©†å©†ç§°èµä½ ç²¾æ‰“ç»†ç®—ã€‚' },
                { text: 'é€‰æ‹©ä½“é¢çš„ç»†æ£‰å¸ƒ', effects: { procurement: 3, charm: 1 }, result: 'ä¸‹äººä»¬ç©¿ä¸Šæ–°è¡£ååˆ†ä½“é¢ï¼Œå¤«å®¶è„¸ä¸Šæœ‰å…‰ã€‚' },
                { text: 'å¬ä¿¡å¸ƒåº„è€æ¿æ¨è', effects: { procurement: -5, scheming: -1 }, result: 'ä½ ä¹°å›çš„å¸ƒæ–™çœ‹ä¼¼å…‰é²œï¼Œä¸€æ´—æ°´å°±ç¼©äº†ï¼Œè¢«å©†å©†è´£å¤‡ã€‚' }
            ]
        },
        {
            title: 'å¹´èŠ‚ç¤¼å“',
            desc: 'ä¸´è¿‘å¹´èŠ‚ï¼Œéœ€è¦å‡†å¤‡é€å¾€å„å®¶äº²å‹çš„ç¤¼å“ã€‚',
            options: [
                { text: 'äº²è‡ªæŒ‘é€‰ï¼Œå„ä¸ç›¸åŒ', effects: { procurement: 8, etiquette: 2 }, result: 'ä½ æ ¹æ®å„å®¶å–œå¥½å‡†å¤‡äº†ç¤¼ç‰©ï¼Œäººäººéƒ½ç§°èµä½ å¿ƒæ€ç²ç‘ã€‚' },
                { text: 'ç»Ÿä¸€é‡‡ä¹°ï¼Œçœæ—¶çœåŠ›', effects: { finance: 3 }, result: 'è™½ç„¶ç¤¼ç‰©ä¸å‡ºå½©ï¼Œä½†ä¹ŸæŒ‘ä¸å‡ºé”™å¤„ï¼Œè¿˜èŠ‚çœäº†å¼€æ”¯ã€‚' },
                { text: 'è®©ç®¡äº‹ä»£åŠ', effects: { personnel: 2, scheming: -1 }, result: 'ä½ å°†æ­¤äº‹äº¤ç”±ç®¡äº‹ï¼Œé”»ç‚¼äº†ä¸‹äººï¼Œä½†å¯èƒ½å‡ºç°ç–æ¼ã€‚' }
            ]
        },
        // â–¼â–¼â–¼ ã€æ–°å¢5ä¸ªé‡‡åŠäº‹ä»¶ã€‘ â–¼â–¼â–¼
        {
            title: 'é‡‡åŠè¯æ',
            desc: 'å©†å©†è¿‘æ¥èº«ä½“å¾®æ™ï¼Œéœ€è¦ä¸€äº›æ¸©è¡¥çš„è¯æè°ƒç†ã€‚',
            options: [
                { text: 'å»äº¬åŸæœ€å¤§çš„â€œæµä¸–å ‚â€', effects: { finance: -5, virtue: 2, procurement: 5 }, result: 'è¯æè™½è´µï¼Œä½†å“è´¨ä¸Šä¹˜ï¼Œå©†å©†æœç”¨åå¤§ä¸ºå¥½è½¬ï¼Œç§°èµä½ å­é¡ºã€‚' },
                { text: 'å»è¡—è§’çš„å°è¯é“º', effects: { finance: 2, procurement: -3 }, result: 'ä½ èŠ‚çœäº†å¼€æ”¯ï¼Œä½†è¯æä¼¼ä¹è¯æ€§ä¸è¶³ï¼Œæ•ˆæœå¹³å¹³ã€‚' },
                { text: 'åŠ¨ç”¨è‡ªå·±çš„ç§è—è¯æ', effects: { privateAssets: -100, virtue: 5, favor_mil: 10 }, result: 'ä½ å°†è‡ªå·±çè—çš„è¡¥å“çŒ®ä¸Šï¼Œå©†å©†å¤§ä¸ºæ„ŸåŠ¨ï¼Œå¯¹ä½ æ›´åŠ äº²è¿‘ã€‚' }
            ]
        },
        {
            title: 'æ·»ç½®å®¶å…·',
            desc: 'å¤«å›ä¹¦æˆ¿çš„æ¤…å­æ—§äº†ï¼Œä½ æ‰“ç®—ä¸ºå…¶æ·»ç½®ä¸€å¼ æ–°çš„ã€‚',
            options: [
                { text: 'æŒ‘é€‰åè´µèŠ±æ¢¨æœ¨æ¤…', effects: { finance: -8, favor: 5 }, result: 'å¤«å›å¯¹ä½ ä¸ºä»–è€ƒè™‘å¦‚æ­¤å‘¨åˆ°æ„Ÿåˆ°é«˜å…´ï¼Œå¤«å¦»æ©çˆ±å€¼æå‡ã€‚' },
                { text: 'æŒ‘é€‰æœ´ç´ è€ç”¨çš„æ¦†æœ¨æ¤…', effects: { finance: 3, virtue: 2 }, result: 'ä½ çš„å‹¤ä¿­æŒå®¶è®©å¤«å›é¢‡ä¸ºæ¬£èµã€‚' },
                { text: 'è®©å¤«å›è‡ªå·±æŒ‘é€‰', effects: { charm: -1, favor: 2 }, result: 'è™½ç„¶å¤«å›é€‰åˆ°äº†åˆå¿ƒæ„çš„ï¼Œä½†ä¼¼ä¹è§‰å¾—ä½ ä¸å¤Ÿä½“è´´ã€‚' }
            ]
        },
        {
            title: 'æ›´æ¢å¨å…·',
            desc: 'å¨æˆ¿çš„ä¸€å£å¤§é”…è£‚äº†ï¼Œéœ€è¦é‡‡ä¹°æ–°çš„å¨å…·ã€‚',
            options: [
                { text: 'é‡‡ä¹°ä¸€å¥—æ˜‚è´µçš„é“œå™¨', effects: { finance: -6, procurement: 4 }, result: 'æ–°å¨å…·è®©å¨æˆ¿ç„•ç„¶ä¸€æ–°ï¼Œèœå“çš„å‘³é“ä¼¼ä¹éƒ½å¥½äº†å‡ åˆ†ã€‚' },
                { text: 'åªä¹°ä¸€å£æ™®é€šçš„é“é”…', effects: { finance: 4 }, result: 'ä½ åªè§£å†³äº†å½“ä¸‹çš„é—®é¢˜ï¼Œä¸€åˆ‡ç…§æ—§ã€‚' },
                { text: 'è¶æœºå½»æŸ¥å¨æˆ¿åº“å­˜', effects: { wisdom: 2, procurement: 2, personnel: 2 }, result: 'ä½ å‘ç°å¨æˆ¿é‡‡ä¹°ç§¯å¼Šå·²ä¹…ï¼Œè¶æœºæ•´é¡¿äº†ä¸€ç•ªï¼Œæ›´æ¢äº†ç®¡äº‹ã€‚' }
            ]
        },
        {
            title: 'è´­ç½®ä¹¦ç±',
            desc: 'åˆåˆ°äº†å¼€è’™çš„å­£èŠ‚ï¼Œä½ éœ€è¦ä¸ºå®¶ä¸­å­¦å ‚æ·»ç½®ä¸€æ‰¹æ–°çš„è’™å­¦ä¹¦ç±ã€‚',
            options: [
                { text: 'è´­ä¹°æœ€åŸºç¡€çš„ã€Šä¸‰å­—ç»ã€‹', effects: { finance: 2 }, result: 'ä½ å®Œæˆäº†ä»»åŠ¡ï¼Œä½†æ¯«æ— æ–°æ„ã€‚' },
                { text: 'é¢å¤–è´­ä¹°ä¸€äº›è¶£å‘³å›¾æœ¬', effects: { procurement: 3, charm: 1 }, result: 'å­©å­ä»¬å¯¹å›¾æœ¬çˆ±ä¸é‡Šæ‰‹ï¼Œå­¦ä¹ çš„å…´è¶£éƒ½æé«˜äº†ã€‚' },
                { text: 'æ‰˜å…³ç³»å¯»æ¥ä¸€å¥—å­¤æœ¬', effects: { finance: -5, procurement: 6, reputation: 5 }, result: 'ä½ çš„èƒ½åŠ›è®©å¤«å®¶å¯¹ä½ åˆ®ç›®ç›¸çœ‹ï¼Œå®¶æ—å£°æœ›ä¹Ÿå› æ­¤æå‡ã€‚' }
            ]
        },
        {
            title: 'åº”å­£é²œæœ',
            desc: 'å¸‚é›†ä¸Šè¿æ¥äº†ä¸€æ‰¹æ–°é²œçš„å—æ–¹è”æï¼Œä»·æ ¼ä¸è²ã€‚',
            options: [
                { text: 'é‡é‡‘ä¹°ä¸‹ï¼Œå…¨å®¶å“å°', effects: { finance: -4, favor: 3 }, result: 'å…¨å®¶éƒ½å“å°äº†è¿™éš¾å¾—çš„ç¾å‘³ï¼Œå®¶åº­æ°”æ°›èæ´½ã€‚' },
                { text: 'åªä¹°ä¸€äº›ç»™å…¬å©†å’Œå¤«å›', effects: { finance: -2, virtue: 2 }, result: 'ä½ çš„å­å¿ƒå’Œä½“è´´å¾—åˆ°äº†é•¿è¾ˆçš„è®¤å¯ã€‚' },
                { text: 'è®¤ä¸ºè¿‡äºå¥¢é¡ï¼Œä¸äºˆè´­ä¹°', effects: { finance: 5 }, result: 'ä½ èŠ‚çœäº†å¼€æ”¯ï¼Œä½†å®¶ä¸­çš„å°è¾ˆä»¬ä¼¼ä¹æœ‰äº›å¤±æœ›ã€‚' }
            ]
        }
    ],
    personnel: [
        {
            title: 'ä¸«é¬Ÿäº‰æ‰§',
            desc: 'ä¸¤ä¸ªä¸€ç­‰ä¸«é¬Ÿä¸ºäº†è°èƒ½å»ä¼ºå€™å«¡å­è€Œèµ·äº†äº‰æ‰§ï¼Œé—¹åˆ°ä½ é¢å‰ã€‚',
            options: [
                { text: 'å„æ‰“äº”åå¤§æ¿', effects: { personnel: -5, virtue: -1 }, result: 'ä½ è™½å¹³æ¯äº†äº‰åµï¼Œä½†ä¸¤ä¸ªä¸«é¬Ÿéƒ½å¿ƒæœ‰æ€¨è¨€ã€‚' },
                { text: 'è€ƒå¯Ÿèƒ½åŠ›ï¼Œæ‹©ä¼˜è€Œç”¨', effects: { personnel: 8, wisdom: 2 }, result: 'ä½ è®¾ä¸‹è€ƒéªŒï¼Œé€‰å‡ºæ›´åˆé€‚çš„äººé€‰ï¼Œä¼—äººå¿ƒæœå£æœã€‚' },
                { text: 'å®‰æŠšå¹¶å¦ä½œå®‰æ’', effects: { personnel: 5, charm: 1 }, result: 'ä½ å®‰æŠšäº†äºŒäººï¼Œå¹¶ä¸ºå¦ä¸€äººå®‰æ’äº†åŒæ ·ä½“é¢çš„å·®äº‹ï¼Œçš†å¤§æ¬¢å–œã€‚' }
            ]
        },
        {
            title: 'è€ä»†å‘Šè€',
            desc: 'ä¸€ä½åœ¨åºœä¸­ä¼ºå€™å¤šå¹´çš„è€å¦ˆå¦ˆæƒ³è¦å‘Šè€è¿˜ä¹¡ã€‚',
            options: [
                { text: 'ç»™äºˆä¸°åšèµé’±', effects: { personnel: 5, virtue: 2 }, result: 'ä½ åšèµäº†è€å¦ˆå¦ˆï¼Œåºœé‡Œçš„ä¸‹äººçœ‹åˆ°éƒ½è§‰å¾—å¿ƒé‡Œå®‰ç¨³ã€‚' },
                { text: 'å®‰æ’å…¶å®¶äººå…¥åºœå½“å·®', effects: { personnel: 7 }, result: 'ä½ å–äº†ä¸ªäººæƒ…ï¼Œä¸ä»…å®‰æŠšäº†è€ä»†ï¼Œè¿˜è§£å†³äº†äººæ‰‹é—®é¢˜ã€‚' },
                { text: 'æŒ‰è§„çŸ©åŠäº‹', effects: { personnel: -3, finance: 2 }, result: 'ä½ æŒ‰è§„çŸ©ç»™äº†èµé’±ï¼Œè™½åˆæƒ…ç†ï¼Œä½†ç•¥æ˜¾å‡‰è–„ã€‚' }
            ]
        },
        // â–¼â–¼â–¼ ã€æ–°å¢5ä¸ªäººäº‹äº‹ä»¶ã€‘ â–¼â–¼â–¼
        {
            title: 'ä¸‹äººå·çªƒ',
            desc: 'ä½ å‘ç°åº“æˆ¿å°‘äº†ä¸€ä»¶é“¶å™¨ï¼Œä¸€ä¸ªç²—ä½¿ä¸«é¬Ÿå«Œç–‘æœ€å¤§ã€‚',
            options: [
                { text: 'å…¬å¼€æƒ©å¤„ï¼Œä»¥å„†æ•ˆå°¤', effects: { personnel: 5, virtue: -2 }, result: 'ä½ ä¸¥æƒ©äº†è¯¥ä¸«é¬Ÿï¼Œåºœå†…é£æ°”ä¸ºä¹‹ä¸€è‚ƒï¼Œä½†æ˜¾å¾—æœ‰äº›ä¸è¿‘äººæƒ…ã€‚' },
                { text: 'ç§ä¸‹è¯¢é—®ï¼Œäº†è§£ç¼˜ç”±', effects: { wisdom: 2, personnel: 7 }, result: 'ä½ å¾—çŸ¥å¥¹æ˜¯ä¸ºäº†ç»™æ¯äº²æ²»ç—…ã€‚ä½ ä¸ºå…¶å«ä»˜äº†è¯è´¹ï¼Œè®©å¥¹ä»¥å·¥æŠµå€ºï¼Œå¥¹å¯¹ä½ æ„Ÿæ©æˆ´å¾·ï¼Œæˆä¸ºä½ çš„å¿ƒè…¹ã€‚' },
                { text: 'æ‚„æ‚„å‘å–ï¼Œä¸éœ²å£°è‰²', effects: { personnel: -5, scheming: 2 }, result: 'ä½ æ²¡æœ‰å£°å¼ ï¼Œæ‚„æ‚„å°†äººå–äº†å‡ºå»ï¼Œé¿å…äº†å®¶ä¸‘å¤–æ‰¬ã€‚' }
            ]
        },
        {
            title: 'ä»†å½¹è¯·å‡',
            desc: 'ä¸€ä¸ªè´Ÿè´£é‡‡ä¹°çš„ä»†å½¹å£°ç§°è€å®¶æ¯äº²ç—…é‡ï¼Œæƒ³è¯·é•¿å‡å¹¶é¢„æ”¯å·¥é’±ã€‚',
            options: [
                { text: 'å‡†å‡å¹¶é¢„æ”¯å·¥é’±', effects: { personnel: 3, virtue: 3 }, result: 'æ— è®ºçœŸå‡ï¼Œä½ çš„ä»æ…ˆéƒ½è®©ä¸‹äººä»¬ä¿¡æœã€‚' },
                { text: 'æ´¾äººæ ¸å®æƒ…å†µ', effects: { wisdom: 1, personnel: 1 }, result: 'æ ¸å®åç¡®æœ‰å…¶äº‹ï¼Œä½ å‡†äº†å‡ã€‚ä½ çš„è°¨æ…è®©äººæ•¬ä½©ã€‚' },
                { text: 'ä¸¥è¯æ‹’ç»', effects: { personnel: -4, virtue: -1 }, result: 'ä½ è®¤ä¸ºè¿™æ˜¯åˆå¥´çš„å€Ÿå£ï¼Œä¸¥è¯æ‹’ç»ï¼Œä¸‹äººä»¬éƒ½è§‰å¾—ä½ å¤ªè¿‡è‹›åˆ»ã€‚' }
            ]
        },
        {
            title: 'å¨æˆ¿çº·äº‰',
            desc: 'å¨æˆ¿çš„ç‹å¤§å¨å’Œæå¤§å¨ä¸ºäº†äº‰å¤ºå®¶å®´ä¸»å¨ä¹‹ä½ï¼Œäº’ç›¸åœ¨èœé‡Œâ€œä¸‹æ–™â€ï¼Œå·®ç‚¹å‡ºäº†å²”å­ã€‚',
            options: [
                { text: 'å°†ä¸¤äººå…¨éƒ¨èµ¶å‡ºåºœ', effects: { personnel: -6 }, result: 'ä½ è™½æ¸…é™¤äº†å®³ç¾¤ä¹‹é©¬ï¼Œä½†ä¹Ÿè®©åºœä¸­ä¸€æ—¶é—´æ²¡äº†å¯ç”¨çš„å¤§å¨ã€‚' },
                { text: 'ç½šæ²¡ä¸¤äººåŠå¹´å·¥é’±', effects: { personnel: 4, finance: 2 }, result: 'ä½ ä¸¥æƒ©äº†äºŒäººï¼Œå¹¶è®©ä»–ä»¬äº’ç›¸ç›‘ç£ï¼Œæš‚æ—¶ç¨³ä½äº†å±€é¢ã€‚' },
                { text: 'ä¸¾åŠå¨è‰ºæ¯”èµ›å®šä¸»å¨', effects: { personnel: 6, charm: 2 }, result: 'ä½ ç”¨ä¸€åœºå…¬å¹³çš„æ¯”èµ›è§£å†³äº†çº·äº‰ï¼Œå¹¶æ¿€å‘äº†å¨æˆ¿çš„ç«äº‰æ°›å›´ã€‚' }
            ]
        },
        {
            title: 'æ‹›å‹Ÿæ–°ä¸',
            desc: 'åºœé‡Œäººæ‰‹ä¸è¶³ï¼Œéœ€è¦æ‹›å‹Ÿä¸€æ‰¹æ–°çš„ä¸‹äººã€‚',
            options: [
                { text: 'ä»äººç‰™å­å¤„ä¹°ç°æˆçš„', effects: { finance: -2, personnel: 3 }, result: 'çœæ—¶çœåŠ›ï¼Œä½†ä¹°æ¥çš„äººåº•ç»†ä¸æ˜ï¼Œå¯èƒ½å­˜åœ¨éšæ‚£ã€‚' },
                { text: 'ä»å®¶ç”Ÿå­ä¸­ææ‹”', effects: { personnel: 5 }, result: 'å®¶ç”Ÿå­å¿ å¿ƒè€¿è€¿ï¼Œä½†å¯èƒ½èƒ½åŠ›å¹³å¹³ã€‚' },
                { text: 'å¼ æ¦œæ‹›å‹Ÿæœ‰æ‰è‰ºçš„', effects: { procurement: 2, personnel: 7 }, result: 'ä½ æ‹›æ¥äº†ä¸€ä½ä¼šç®—è´¦çš„ã€ä¸€ä½ä¼šå›­è‰ºçš„ï¼Œå¤§å¤§æå‡äº†å†…å®…çš„ç®¡ç†æ•ˆç‡ã€‚' }
            ]
        },
        {
            title: 'æµè¨€èœšè¯­',
            desc: 'ä¸‹äººä¹‹é—´åœ¨ç§ä¸‹è®®è®ºä½ å¨˜å®¶çš„é—²è¯ï¼Œè¨€è¾é¢‡ä¸ºä¸æ•¬ã€‚',
            options: [
                { text: 'æ‰¾å‡ºæºå¤´ï¼Œä¸¥æƒ©ä¸è´·', effects: { personnel: 6, scheming: 1 }, result: 'ä½ è¿…é€Ÿå¹³æ¯äº†æµè¨€ï¼Œä½†æ˜¾å¾—æœ‰äº›å°é¢˜å¤§åšã€‚' },
                { text: 'ç½®ä¹‹ä¸ç†', effects: { personnel: -4 }, result: 'ä½ çš„æ”¾ä»»è®©æµè¨€æ„ˆæ¼”æ„ˆçƒˆï¼Œå½±å“äº†ä½ çš„å¨ä¿¡ã€‚' },
                { text: 'â€œæ— æ„ä¸­â€è®©å¤«å›å¬åˆ°', effects: { favor: 3, scheming: 3 }, result: 'å¤«å›ä¸ºä½ å‡ºå¤´æƒ©æ²»äº†ä¸‹äººï¼Œä½ ä»¬çš„æ„Ÿæƒ…æ›´è¿‘äº†ã€‚' }
            ]
        }
    ],
    finance: [
        {
            title: 'ç”°åº„æ”¶ç§Ÿ',
            desc: 'åˆåˆ°äº†ä¸€å¹´ç”°åº„æ”¶ç§Ÿçš„æ—¥å­ï¼Œç®¡äº‹å°†è´¦æœ¬å‘ˆäº†ä¸Šæ¥ã€‚',
            options: [
                { text: 'ä»”ç»†æ ¸å¯¹è´¦ç›®', effects: { finance: 8, wisdom: 1 }, result: 'ä½ å‘ç°ä¸€å¤„ä¸æ˜“å¯Ÿè§‰çš„é”™æ¼ï¼Œä¸ºåºœä¸­æŒ½å›äº†æŸå¤±ã€‚' },
                { text: 'è¯¢é—®æ”¶æˆæƒ…å†µ', effects: { finance: 3, virtue: 1 }, result: 'ä½ å…³å¿ƒä½ƒæˆ·çš„æ”¶æˆï¼Œå¹¶é…Œæƒ…å‡å…äº†éƒ¨åˆ†ç§Ÿå­ï¼Œè·å¾—äº†ä»å–„çš„åå£°ã€‚' },
                { text: 'å…¨æƒäº¤äºˆç®¡äº‹', effects: { personnel: 3, finance: -2 }, result: 'ä½ ä¿¡ä»»ç®¡äº‹ï¼Œä½†ä¹Ÿç»™äº†ä»–å¯ä¹˜ä¹‹æœºã€‚' }
            ]
        },
        {
            title: 'æ„å¤–å¼€é”€',
            desc: 'åºœä¸­èŠ±å›­çš„æ± å¡˜æ¼æ°´ï¼Œéœ€è¦ä¸€ç¬”ä¸å°çš„å¼€æ”¯è¿›è¡Œä¿®ç¼®ã€‚',
            options: [
                { text: 'ä»è´¦ä¸Šæ”¯å–', effects: { finance: -5 }, result: 'å…¬äº‹å…¬åŠï¼Œä½†è´¦é¢ä¸Šçš„å¼€æ”¯å˜å¤§äº†ã€‚' },
                { text: 'åŠ¨ç”¨è‡ªå·±çš„ç§äº§è¡¥è´´', effects: { finance: 10, favor: 5, privateAssets: -200 }, result: 'ä½ ç”¨ç§äº§è¡¥è´´äº†å®¶ç”¨ï¼Œå©†å©†å’Œä¸ˆå¤«éƒ½å¯¹ä½ å¦çœ¼ç›¸çœ‹ã€‚' },
                { text: 'æƒ³åŠæ³•èŠ‚çœå¼€æ”¯', effects: { finance: 3, wisdom: 1 }, result: 'ä½ è´§æ¯”ä¸‰å®¶ï¼Œæ‰¾åˆ°äº†æ›´å®æƒ çš„å·¥åŒ ï¼ŒèŠ‚çœäº†å¼€æ”¯ã€‚' }
            ]
        },
        // â–¼â–¼â–¼ ã€æ–°å¢5ä¸ªè´¢åŠ¡äº‹ä»¶ã€‘ â–¼â–¼â–¼
        {
            title: 'äº²æ—å€Ÿè´·',
            desc: 'ä¸€ä½ä¸ç®—å¤ªäº²è¿‘çš„å¨˜å®¶äº²æˆšä¸Šé—¨ï¼Œå£°ç§°ç”Ÿæ„å‘¨è½¬ä¸çµï¼Œæƒ³å€Ÿ500ä¸¤é“¶å­ã€‚',
            options: [
                { text: 'ä»å®¶åº“ä¸­æ”¯å–', effects: { finance: -10, favor_mil: -5 }, result: 'ä½ åŠ¨ç”¨äº†å®¶åº“çš„é’±ï¼Œè™½ç„¶å¸®äº†äº²æˆšï¼Œä½†å©†å©†å¯¹æ­¤é¢‡æœ‰å¾®è¯ã€‚' },
                { text: 'ç”¨è‡ªå·±çš„ç§äº§å€Ÿå‡º', effects: { finance: 0, privateAssets: -500, virtue: 3 }, result: 'ä½ ç”¨è‡ªå·±çš„ä½“å·±é’±è§£å†³äº†é—®é¢˜ï¼Œå½°æ˜¾äº†ä½ çš„æƒ…åˆ†ä¸èƒ½åŠ›ã€‚' },
                { text: 'å©‰è¨€è°¢ç»', effects: { virtue: -2 }, result: 'ä½ æ‹’ç»äº†äº²æˆšï¼Œè™½ä¿å…¨äº†å®¶è´¢ï¼Œä½†æ˜¾å¾—ä¸è¿‘äººæƒ…ã€‚' }
            ]
        },
        {
            title: 'å°å‹æŠ•èµ„æœºä¼š',
            desc: 'ä½ é™ªå«çš„é“ºå­æŒæŸœæ¥æŠ¥ï¼Œè¯´åŸå—æœ‰ä¸€å¤„åœ°æ®µæä½³çš„é“ºé¢æ­£åœ¨ä½ä»·è½¬è®©ã€‚',
            options: [
                { text: 'ç”¨ç§äº§æŠ•èµ„', effects: { privateAssets: -1000, finance: 8 }, result: 'ä½ æœæ–­å‡ºæ‰‹ï¼Œä¸ºè‡ªå·±åˆæ·»äº†ä¸€ä»½äº§ä¸šï¼Œæœªæ¥å°†æœ‰æŒç»­çš„ç§æˆ¿é’±æ”¶å…¥ã€‚' },
                { text: 'è¯´æœå¤«å›ç”¨å®¶åº“æŠ•èµ„', effects: { favor: 3, finance: 6 }, result: 'ä½ æˆåŠŸè¯´æœå¤«å›ï¼Œä¸ºå®¶æ—æ·»ç½®äº†äº§ä¸šï¼Œä½†æœªæ¥çš„æ”¶ç›Šå½’å…¬ã€‚' },
                { text: 'è®¤ä¸ºé£é™©å¤ªé«˜ï¼Œæ”¾å¼ƒ', effects: { wisdom: -2 }, result: 'ä½ é”™å¤±äº†ä¸€æ¬¡ç»ä½³çš„æŠ•èµ„æœºä¼šã€‚' }
            ]
        },
        {
            title: 'åº†å…¸é¢„ç®—',
            desc: 'å«¡å­å³å°†æ»¡å‘¨å²ï¼Œä½ éœ€è¦ä¸ºâ€œæŠ“å‘¨â€åº†å…¸å‡†å¤‡ä¸€ä»½é¢„ç®—ã€‚',
            options: [
                { text: 'å¤§æ“å¤§åŠï¼Œå½°æ˜¾åœ°ä½', effects: { finance: -8, reputation: 5 }, result: 'ä¸€åœºç››å¤§çš„åº†å…¸è®©å®¶æ—éå¸¸æœ‰é¢å­ï¼Œä½ çš„å£°æœ›ä¹Ÿæå‡äº†ã€‚' },
                { text: 'æ¸©é¦¨å®¶å®´ï¼Œä¸€åˆ‡ä»ç®€', effects: { finance: 3, virtue: 2 }, result: 'ä½ åªé‚€è¯·äº†è‡³äº²ï¼Œåœºé¢æ¸©é¦¨ï¼Œè¿˜èŠ‚çœäº†å¼€æ”¯ã€‚' },
                { text: 'å°†é¢„ç®—ç”¨äºæ…ˆå–„', effects: { finance: 0, virtue: 8, reputation: 3 }, result: 'ä½ å°†åº†å…¸çš„é’±ç”¨äºæ–½ç²¥ï¼Œä¸ºä½ å’Œå­©å­ç§¯æ”’äº†ç¦æŠ¥ã€‚' }
            ]
        },
        {
            title: 'æ„å¤–ä¹‹è´¢',
            desc: 'ä½ åœ¨æ•´ç†å¤«å›ä¸€ä»¶æ—§è¡£æ—¶ï¼Œä»å¤¹å±‚é‡Œå‘ç°äº†ä¸€å¼ è¢«é—å¿˜çš„500ä¸¤é“¶ç¥¨ã€‚',
            options: [
                { text: 'çº³å…¥è‡ªå·±çš„ç§äº§', effects: { privateAssets: 500, virtue: -3 }, result: 'ä½ æ‚„æ‚„æ”¶èµ·äº†è¿™ç¬”é’±ï¼Œæ— äººçŸ¥æ™“ã€‚' },
                { text: 'äº¤ç»™å¤«å›', effects: { favor: 5 }, result: 'å¤«å›å¯¹ä½ çš„è¯šå®ååˆ†èµèµï¼Œå¹¶å°†é“¶ç¥¨äº¤äºˆä½ ä¿ç®¡ã€‚' },
                { text: 'å……å…¥å®¶åº“', effects: { finance: 5, virtue: 2 }, result: 'ä½ å°†é“¶ç¥¨å……å…¥å…¬ä¸­ï¼Œå±•ç°äº†ä½ çš„å¤§å…¬æ— ç§ã€‚' }
            ]
        },
        {
            title: 'è´¦ç›®æ ¸å¯¹',
            desc: 'åœ¨æ ¸å¯¹ä¸Šä¸ªæœˆçš„é‡‡ä¹°è´¦ç›®æ—¶ï¼Œä½ å‘ç°ä¸€ç¬”è´­ä¹°ç‡•çªçš„æ”¯å‡ºä¼¼ä¹æ¯”å¹³æ—¶é«˜äº†ä¸å°‘ã€‚',
            options: [
                { text: 'è®¤ä¸ºæ˜¯æ­£å¸¸ä»·æ ¼æ³¢åŠ¨', effects: { wisdom: -2 }, result: 'ä½ æ²¡æœ‰æ·±ç©¶ï¼Œå¯èƒ½é”™è¿‡äº†å‘ç°é—®é¢˜çš„æœºä¼šã€‚' },
                { text: 'æ•²æ‰“é‡‡ä¹°ç®¡äº‹', effects: { personnel: 3, scheming: 2 }, result: 'ä½ æ—æ•²ä¾§å‡»åœ°æ•²æ‰“äº†ç®¡äº‹ï¼Œä»–ç«‹åˆ»â€œæ‡‚äº‹â€åœ°è¡¥ä¸Šäº†å·®é¢ã€‚' },
                { text: 'å½»æŸ¥åˆ°åº•', effects: { wisdom: 3, finance: 6 }, result: 'ä½ æŸ¥å‡ºæ˜¯é‡‡ä¹°ä¸åº—å®¶å‹¾ç»“è™šæŠ¥ä»·æ ¼ï¼Œä½ ä¸¥æƒ©äº†åˆå¥´ï¼Œä¸ºå®¶åº“æŒ½å›äº†æŸå¤±ã€‚' }
            ]
        }
    ]
};
// ===================== ã€æ–°åŠŸèƒ½ã€‘å®…æ–—ç³»ç»Ÿæ•°æ® END =======================

const PROFESSION_DATA = {
    'civilian': {
        name: "æ–‡å®˜",
        icon: "fa-feather-alt",
        gender: "male",
        core_resources: ["zheng_sheng", "men_sheng", "qing_bao"],
        dashboard_name: "æˆ‘çš„æ¡ˆç‰",
        acts: [
            {
                title: "ç¬¬ä¸€å¹•ï¼šå´­éœ²å¤´è§’",
                level_range: [1, 4],
                goal: "ç§¯ç´¯å­¦è¯†ï¼Œé‡‘æ¦œé¢˜åï¼Œè·å¾—å…¥åœºåˆ¸ï¼Œå¹¶å¯»æ‰¾ä¸€ä½å¯é çš„æ”¿æ²»å¼•è·¯äººã€‚",
                events: [
                    {
                        title: "åŒçª—çš„è¯·æ‰˜",
                        desc: "ä¸€ä½å®¶å¢ƒè´«å¯’ä½†æ‰åæ¨ªæº¢çš„åŒçª—ï¼Œå› å‡‘ä¸é½ç›˜ç¼ ï¼Œè¯·æ±‚ä½ èµ„åŠ©ä»–å‚åŠ ä¹¡è¯•ã€‚",
                        options: [
                            { text: "ã€å€¾å›Šç›¸åŠ©ã€‘", cost: { wealth: 200 }, effects: { attributes: { virtue: 5 }, npc_relationship: { npc_key: 'poor_classmate', favor: 50, type: 'ally' } }, result_text: "ä»–å¯¹ä½ æ„Ÿæ¿€æ¶•é›¶ï¼Œè§†ä½ ä¸ºè‡³äº¤ã€‚ä»–è‹¥ä¸­ä¸¾ï¼Œæœªæ¥å°†æˆä¸ºä½ åœ¨æœå ‚ä¸Šçš„ä¸€å¤§åŠ©åŠ›ã€‚" },
                            { text: "ã€å©‰è¨€æ‹’ç»ã€‘", effects: { npc_relationship: { npc_key: 'poor_classmate', favor: -20 } }, result_text: "ä½ ä»¬çš„å…³ç³»å˜å¾—å†·æ·¡ã€‚ä»–è‹¥é è‡ªå·±å¦å¯»ä»–æ³•ä¸­ä¸¾ï¼Œæœªæ¥å¯èƒ½ä¼šåœ¨å®˜åœºä¸Šä¸ä½ ä½œå¯¹ã€‚" }
                        ]
                    },
                    {
                        title: "æ©å¸ˆçš„è€ƒéªŒ",
                        desc: "ä½ çš„æˆä¸šæ©å¸ˆé—®ä½ å¯¹â€œä¸ºæ”¿ä»¥å¾·â€çš„çœ‹æ³•ã€‚",
                        options: [
                            { text: "ã€é˜è¿°å¾·æ”¿çš„é‡è¦æ€§ã€‘", requirements: { virtue: 50 }, effects: { core_resources: { zheng_sheng: 10 }, npc_relationship: { npc_key: 'mentor', favor: 15 } }, result_text: "æ©å¸ˆå¯¹ä½ çš„è§è§£å¤§åŠ èµèµã€‚" },
                            { text: "ã€è®ºè¿°æ³•ç†ä¸æƒæœ¯çš„å¿…è¦æ€§ã€‘", requirements: { wisdom: 50 }, effects: { attributes: { wisdom: 2 }, npc_relationship: { npc_key: 'mentor', favor: -5 } }, result_text: "æ©å¸ˆè®¤ä¸ºä½ è™½æœ‰æ‰æ™ºä½†ç•¥æ˜¾åˆ»è–„ã€‚" }
                        ]
                    },
                    {
                        title: "ä¹¦é™¢çš„é›…é›†",
                        desc: "äº¬åŸæœ€å¤§çš„â€œå…°äº­ä¹¦é™¢â€ä¸¾åŠé›…é›†ï¼Œæ–‡äººäº‘é›†ã€‚",
                        options: [
                            { text: "ã€èµ‹è¯—ä¸€é¦–ï¼ŒæŠ€æƒŠå››åº§ã€‘", requirements: { talent: 70 }, effects: { attributes: { talent: 3, reputation: 10 }, item: { id: 'ming_shi_qing_jian', amount: 1 } }, result_text: "ä½ çš„è¯—ä½œæˆä¸ºäº†å…¨åœºç„¦ç‚¹ï¼Œå¹¶è·å¾—äº†ä¸€å¼ [åå£«çš„è¯·æŸ¬]ã€‚" },
                            { text: "ã€ä½è°ƒè¡Œäº‹ï¼Œç»“äº¤æ–°å‹ã€‘", effects: { social: 'expand' }, result_text: "ä½ æˆåŠŸç»“è¯†äº†ä¸€ä¸¤ä½æœ‰æ½œåŠ›çš„åŒè¾ˆï¼Œäººè„‰å›¾è°±å¾—åˆ°æ‰©å¼ ï¼Œä½†æœªèƒ½åœ¨åå£«ä¸­ç•™ä¸‹å°è±¡ã€‚" }
                        ]
                    },
                    {
                        title: "å¤ç±åº—çš„å¥‡é‡",
                        desc: "ä½ åœ¨ä¸€å®¶æ—§ä¹¦åº—å‘ç°ä¸€æœ¬è’™å°˜çš„å¤ç±ã€‚",
                        options: [
                            {
                                text: "ã€èŠ±è´¹500ä¸¤ä¹°ä¸‹ã€‘", cost: { wealth: 500 },
                                getOutcome: (gs) => {
                                    if (Math.random() < 0.5) {
                                        return { text: "ä¹¦ä¸­å¤¹ç€å‰æœæŸä½å®°ç›¸çš„[æ–½æ”¿å¿ƒå¾—]ï¼", effects: { attributes: { wisdom: 10 }, core_resources: { zheng_sheng: 20 }, item: { id: 'shi_zheng_xin_de', amount: 1 } } };
                                    } else {
                                        return { text: "åªæ˜¯ä¸€æœ¬æ™®é€šçš„å¤ä¹¦ï¼Œä½ ç™½èŠ±äº†é’±ã€‚", effects: {} };
                                    }
                                }
                            },
                            { text: "ã€è®¤ä¸ºä¸å€¼ï¼Œè½¬èº«ç¦»å¼€ã€‘", effects: {}, result_text: "æ— äº‹å‘ç”Ÿï¼Œä½†ä¹Ÿé”™å¤±äº†æœºé‡ã€‚" }
                        ]
                    },
                    {
                        title: "è´«æ°‘çš„æ±‚åŠ©",
                        desc: "ä¸€ä½è€å¦‡æ‹¦ä½ä½ ï¼Œå“­è¯‰å¥¹çš„å„¿å­è¢«æ¶éœ¸å†¤æ‰å…¥ç‹±ã€‚",
                        options: [
                            { text: "ã€ä»—ä¹‰æ‰§è¨€ï¼Œä¸ºå…¶å†™çŠ¶çº¸ã€‘", requirements: { virtue: 40 }, effects: { attributes: { virtue: 10, reputation: 5 } }, result_text: "ä½ çš„çŠ¶çº¸å¼•èµ·äº†å®˜åºœçš„æ³¨æ„ï¼Œæœ€ç»ˆæ²‰å†¤å¾—é›ªã€‚ä½ è·å¾—äº†åŸä¸­å¹³æ°‘çš„çˆ±æˆ´ã€‚" },
                            { text: "ã€çˆ±è«èƒ½åŠ©ï¼Œèµ äºˆé“¶ä¸¤ã€‘", cost: { wealth: 50 }, effects: { attributes: { virtue: 2 } }, result_text: "ä½ ç»™äº†å¥¹ä¸€äº›é’±ï¼Œå¥¹æ„Ÿè°¢ä½ çš„å–„è‰¯ï¼Œä½†å¥¹çš„å„¿å­ä»åœ¨ç‹±ä¸­ã€‚" }
                        ]
                    },
                    {
                        title: "æ•´ç†å†…é˜æ—§æ¡£",
                        desc: "ä½ è¢«å®‰æ’å»æ•´ç†å°˜å°å·²ä¹…çš„å†…é˜æ—§æ¡£ï¼Œå·¥ä½œæ¯ç‡¥ä¸”çœ‹ä¸åˆ°å‰é€”ã€‚",
                        options: [
                            { text: "ã€è€å¿ƒæ•´ç†ï¼Œå¯»æ‰¾ä»·å€¼ã€‘", requirements: { wisdom: 40 }, effects: { attributes: { wisdom: 3 }, core_resources: { qing_bao: 5 } }, result_text: "ä½ åœ¨æ•…çº¸å †ä¸­å‘ç°äº†å‰æœçš„ä¸€äº›æ–½æ”¿å¾—å¤±è®°å½•ï¼Œå¯¹ä¸ºå®˜ä¹‹é“æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚" },
                            { text: "ã€æŠ±æ€¨å·®äº‹ï¼Œæ•·è¡äº†äº‹ã€‘", effects: { npc_relationship: { npc_key: 'supervisor', favor: -10 } }, result_text: "ä½ çš„æŠ±æ€¨è¢«ä¸Šå¸å¬åˆ°ï¼Œç»™ä½ ç•™ä¸‹äº†ä¸å¥½çš„å°è±¡ã€‚" }
                        ]
                    },
                    {
                        title: "æ—å¬å¤§ç†å¯ºå®¡æ¡ˆ",
                        desc: "ä½ è·å¾—äº†ä¸€ä¸ªæ—å¬å¤§ç†å¯ºå®¡ç†è¦æ¡ˆçš„æœºä¼šã€‚",
                        options: [
                            { text: "ã€è®¤çœŸè§‚æ‘©ï¼Œå­¦ä¹ æ–­æ¡ˆæŠ€å·§ã€‘", effects: { attributes: { wisdom: 5 } }, result_text: "å¤§ç†å¯ºå¿çš„å®¡æ¡ˆé€»è¾‘è®©ä½ å¤§å¼€çœ¼ç•Œï¼Œæ™ºæ…§æœ‰æ‰€æå‡ã€‚" },
                            { text: "ã€ç»“äº¤åˆ‘åå¸ˆçˆ·ã€‘", requirements: { charm: 50 }, effects: { social: 'expand' }, result_text: "ä½ ä¸ä¸€ä½ç»éªŒä¸°å¯Œçš„åˆ‘åå¸ˆçˆ·æ”€è°ˆèµ·æ¥ï¼Œä¸ºè‡ªå·±å¢æ·»äº†ä¸€æ¡ç‰¹æ®Šçš„äººè„‰ã€‚" }
                        ]
                    },
                    {
                        title: "ä¹¡ç»…çš„è¯·å®´",
                        desc: "ä¸€ä½æœ¬åœ°çš„ä¹¡ç»…å¬é—»ä½ çš„æ‰åï¼Œè®¾å®´æ¬¾å¾…ï¼Œå¸­é—´ä»–å¯¹ä½ å¤§åŠ èµèµï¼Œå¹¶æš—ç¤ºå¸Œæœ›ä½ èƒ½ä¸ºä»–çš„å®¶æ—åœ¨ä¹¡é‡Œè¡Œäº›æ–¹ä¾¿ã€‚",
                        options: [
                            { text: "ã€ä¹‰æ­£è¾ä¸¥ï¼Œå½“åœºæ‹’ç»ã€‘", effects: { attributes: { virtue: 5 }, core_resources: { zheng_sheng: 5 } }, result_text: "ä½ ç»´æŠ¤äº†å®˜å£°ï¼Œä½†ä¹Ÿå¾—ç½ªäº†è¿™ä½åœ¨åœ°æ–¹ä¸Šé¢‡æœ‰åŠ¿åŠ›çš„ä¹¡ç»…ã€‚" },
                            { text: "ã€å«ç³Šå…¶è¾ï¼Œä¸ç½®å¯å¦ã€‘", effects: { attributes: { wisdom: 2 } }, result_text: "ä½ ç”¨å¤ªææ¨æ‰‹åº”ä»˜äº†è¿‡å»ï¼Œå¯¹æ–¹æ²¡è®¨åˆ°å¥½å¤„ï¼Œä½†ä¹Ÿæœªä¸ä½ äº¤æ¶ã€‚" },
                            { text: "ã€å¿ƒé¢†ç¥ä¼šï¼Œæ”¶ä¸‹ç¤¼é‡‘ã€‘", effects: { wealth: 1000, attributes: { virtue: -10 } }, result_text: "ä½ æ”¶ä¸‹äº†ä¹¡ç»…çš„â€œå¿ƒæ„â€ï¼Œæ­¤äº‹å¯èƒ½æˆä¸ºä½ æœªæ¥çš„éšæ‚£ã€‚" }
                        ]
                    },
                    {
                        title: "å‚åŠ â€œæ›²æ°´æµè§â€",
                        desc: "äº¬éƒŠä¸¾åŠäº†ä¸€åœºâ€œæ›²æ°´æµè§â€çš„æ–‡äººé›…é›†ï¼Œå‚ä¸è€…éå¯Œå³è´µã€‚",
                        options: [
                            { text: "ã€ä»¥æ–‡ä¼šå‹ã€‘", requirements: { talent: 60 }, effects: { attributes: { talent: 2, reputation: 5 } }, result_text: "ä½ çš„æ–‡é‡‡è·å¾—äº†ä¸€äº›èµèª‰ï¼Œå¹¶ç»“è¯†äº†ä¸€ä½åéƒ¨å®˜å‘˜çš„å„¿å­ã€‚" },
                            { text: "ã€ä»¥é…’ä¼šå‹ã€‘", requirements: { health: 60 }, effects: { attributes: { charm: 2 }, social: 'expand' }, result_text: "ä½ é…’é‡è¿‡äººï¼Œä¸ºäººè±ªçˆ½ï¼Œç»“äº¤äº†å‡ ä½æ­¦å°†å­å¼Ÿã€‚" }
                        ]
                    },
                    {
                        title: "çš‡å¸å‡ºå·¡",
                        desc: "çš‡å¸å‰å¾€å¤ªåº™ç¥­ç¥€ï¼Œä½ ä½œä¸ºéšè¡Œçš„å°å®˜ï¼Œæœ‰æœºä¼šè¿‘è·ç¦»è§‚å¯Ÿå¤©é¢œã€‚",
                        options: [
                            { text: "ã€æªå°½èŒå®ˆï¼Œä¸å‡ºå·®é”™ã€‘", effects: { npc_relationship: { npc_key: 'supervisor', favor: 5 } }, result_text: "ä½ åœ†æ»¡åœ°å®Œæˆäº†ä»»åŠ¡ï¼Œè™½ç„¶æœªå¼•èµ·çš‡å¸æ³¨æ„ï¼Œä½†è·å¾—äº†ä¸Šå¸çš„å¥½è¯„ã€‚" },
                            { text: "ã€å¯»æ‰¾æœºä¼šï¼Œå±•ç°è‡ªå·±ã€‘", getOutcome: (gs) => {
                                if (gs.player.attributes.charm > 80 && Math.random() < 0.3) {
                                    return { text: "ä½ çš„ä»ªè¡¨å ‚å ‚å¼•èµ·äº†çš‡å¸çš„æ³¨æ„ï¼Œä»–éšå£é—®äº†ä½ çš„åå­—ã€‚", effects: { npc_relationship: { npc_key: 'emperor', favor: 5 }, attributes: { reputation: 10 } } };
                                }
                                return { text: "ä½ çš„ä¸¾åŠ¨è¢«è§†ä¸ºå†’å¤±ï¼Œé­åˆ°äº†ä¾å«çš„å‘µæ–¥ã€‚", effects: { attributes: { reputation: -5 } } };
                            }}
                        ]
                    }
                ],
                milestone_event: {
                    title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šç§‘ä¸¾å¤§è€ƒ",
                    trigger: { career_level: 2, text_desc: "å®˜é˜¶è¾¾åˆ°ä¸¾äººï¼Œä¸”â€œæ‰æƒ…â€ä¸â€œæ™ºæ…§â€æ€»å’Œ > 100", condition: (gs) => (gs.player.attributes.talent + gs.player.attributes.wisdom) > 100 },
                    desc: "è´¡é™¢å¤§é—¨ç¼“ç¼“æ‰“å¼€ï¼Œæ•°åƒåè€ƒç”Ÿè‚ƒç„¶è¿›å…¥ã€‚è€ƒåœºå†…ï¼Œå·è§’å£°é•¿é¸£ï¼Œæ°”æ°›åº„ä¸¥è‚ƒç©†ã€‚ä½ ååœ¨ç‹­å°çš„å·æˆ¿å†…ï¼Œé¢å¯¹ç€å†³å®šä½ ä¸€ç”Ÿå‘½è¿çš„è€ƒå·ã€‚",
                    success: { text: "é‡‘æ¦œé¢˜åï¼çš‡å¸äº²è‡ªæ¥è§ï¼Œæ ¹æ®ä½ çš„æ®¿è¯•æ’åèµèµå®˜èŒã€åºœé‚¸å’Œ[å¾¡èµæ–‡æˆ¿å››å®]ã€‚", effects: { career_level_set: 3, wealth: 5000, item: {id: 'yu_ci_wen_fang_si_bao', amount: 1} } },
                    failure: { text: "åè½å­™å±±ï¼Œå£°æœ›å¤§è·Œã€‚ä½ éœ€è¦å†ç­‰ä¸‰å¹´ï¼Œæˆ–å¦å¯»å‡ºè·¯ã€‚", effects: { attributes: { reputation: -20 } } }
                }
            },
            {
                title: "ç¬¬äºŒå¹•ï¼šä¸­æµç ¥æŸ±",
                level_range: [5, 7],
                goal: "åœ¨å…·ä½“çš„æ”¿åŠ¡ä¸­åšå‡ºæˆç»©ï¼Œå·§å¦™åœ°è¿›è¡Œæ´¾ç³»ç«™é˜Ÿï¼Œæˆä¸ºæœå ‚ä¸Šä¸å¯å¿½è§†çš„æ–°ç”ŸåŠ›é‡ã€‚",
                events: [
                    {
                        title: "å¤„ç†ç§¯å‹å·å®—",
                        desc: "ä½ çš„æ¡ˆç‰ä¸Šå †æ»¡äº†å‰ä»»ç•™ä¸‹çš„é™ˆå¹´æ—§æ¡ˆï¼Œæ¯ç‡¥ä¹å‘³ã€‚",
                        options: [
                            {
                                text: "ã€èŠ±è´¹æ•°æ—¥ï¼Œä»”ç»†å®¡é˜…ã€‘",
                                getOutcome: (gs) => {
                                    if (Math.random() < 0.2) {
                                        return { text: "ä½ åœ¨å·å®—çš„è››ä¸é©¬è¿¹ä¸­ï¼Œå‘ç°äº†å‰ä»»ä¸æŸä½é«˜å®˜å‹¾ç»“çš„[è´ªè…çº¿ç´¢]ï¼è¿™æ˜¯æ‰³å€’æ”¿æ•Œçš„ç»ä½³æ­¦å™¨ã€‚", effects: { item: { id: 'tan_fu_xian_suo', amount: 1 } } };
                                    } else {
                                        return { text: "æ— äº‹å‘ç”Ÿï¼Œä½†ä½ è·å¾—äº†ä¸Šå¸çš„èµè¯†ï¼Œè®¤ä¸ºä½ è¸å®è‚¯å¹²ã€‚", effects: { core_resources: { zheng_sheng: 5 } } };
                                    }
                                }
                            },
                            { text: "ã€æ•·è¡äº†äº‹ï¼Œç›´æ¥å½’æ¡£ã€‘", effects: { attributes: { reputation: -5 } }, result_text: "èŠ‚çœäº†æ—¶é—´ï¼Œä½†ä¸Šå¸å¯¹ä½ çš„è¯„ä»·é™ä½ï¼Œä¸”æœ‰å‡ ç‡å› å¤„ç†ä¸å½“å¯¼è‡´æ°‘æ€¨ã€‚" }
                        ]
                    },
                    {
                        title: "åŒåƒšçš„â€œååŠ©â€è¯·æ±‚",
                        desc: "ä¸€ä½åŒåƒšè´Ÿè´£çš„é¡¹ç›®é‡åˆ°å›°éš¾ï¼Œè¯·æ±‚ä½ â€œååŠ©â€ï¼Œä½†åŠŸåŠ³å¯èƒ½å…¨å½’ä»–ã€‚",
                        options: [
                             { text: "ã€æ…¨ç„¶åº”å…ã€‘", effects: { npc_relationship: { npc_key: 'requesting_colleague', favor: 30, type: 'ally' }, core_resources: { zheng_sheng: 10 } }, result_text: "ä½ æ¶ˆè€—äº†å¤§é‡ç²¾åŠ›ï¼Œé¡¹ç›®æˆåŠŸäº†ã€‚è¯¥åŒåƒšå¯¹ä½ éå¸¸æ„Ÿæ¿€ï¼Œæˆä¸ºä½ çš„ç›Ÿå‹ã€‚" },
                             { text: "ã€è¦æ±‚å¹³åˆ†åŠŸåŠ³ã€‘", effects: { core_resources: { zheng_sheng: 25 }, npc_relationship: { npc_key: 'requesting_colleague', favor: 5 } }, result_text: "å¯¹æ–¹åŒæ„äº†ï¼Œä½ ä»¬å…±åŒå®Œæˆäº†é¡¹ç›®ã€‚ä½ è·å¾—äº†ä¸é”™çš„æ”¿å£°ï¼Œä½†å¯¹æ–¹è§‰å¾—ä½ æ–¤æ–¤è®¡è¾ƒã€‚" },
                             { text: "ã€å€Ÿæ•…æ¨è¾ã€‘", effects: { npc_relationship: { npc_key: 'requesting_colleague', favor: -25 } }, result_text: "ä½ ä¸è¯¥åŒåƒšå…³ç³»æ¶åŒ–ï¼Œä»–å¯èƒ½ä¼šåœ¨æœªæ¥ç»™ä½ ä¸‹ç»Šå­ã€‚" }
                        ]
                    },
                    {
                        title: "ä¸Šå¸çš„è¯•æ¢",
                        desc: "ä½ çš„ä¸Šå¸åœ¨ä¸€æ¬¡ç§ä¸‹è°ˆè¯ä¸­ï¼Œè¯¢é—®ä½ å¯¹â€œå¤ªå­â€å’Œâ€œé›ç‹â€çš„çœ‹æ³•ã€‚",
                        options: [
                            { text: "ã€æ——å¸œé²œæ˜åœ°æ”¯æŒå¤ªå­ã€‘", getOutcome: (gs) => ({ text: "ä½ çš„é€‰æ‹©å°†å†³å®šä½ åœ¨æ´¾ç³»æ–—äº‰ä¸­çš„ä½ç½®ã€‚", effects: { political_event: { type: 'align', faction: 'prince' } } }) },
                            { text: "ã€éšæ™¦åœ°è¡¨è¾¾å¯¹é›ç‹çš„å¥½æ„Ÿã€‘", getOutcome: (gs) => ({ text: "ä½ çš„é€‰æ‹©å°†å†³å®šä½ åœ¨æ´¾ç³»æ–—äº‰ä¸­çš„ä½ç½®ã€‚", effects: { political_event: { type: 'align', faction: 'yong_wang' } } }) },
                            { text: "ã€æ»´æ°´ä¸æ¼åœ°å›ç­”â€œåªå¿ äºçš‡ä¸Šâ€ã€‘", effects: {}, result_text: "ä¸€ä¸ªå®‰å…¨ä½†å¹³åº¸çš„å›ç­”ã€‚ä¸Šå¸è®¤ä¸ºä½ åŸåºœå¾ˆæ·±ï¼Œä½†ä½ æš‚æ—¶æ²¡æœ‰è¢«å·å…¥æ®‹é…·çš„æ´¾ç³»æ–—äº‰ã€‚" }
                        ]
                    },
                    {
                        title: "åœ°æ–¹å®˜å‘˜çš„â€œå†°æ•¬ç‚­æ•¬â€",
                        desc: "ä¸€ä½æ¥äº¬è¿°èŒçš„åœ°æ–¹å®˜ï¼Œç§ä¸‹ç»™ä½ é€æ¥ä¸€ä¸ªæ²‰ç”¸ç”¸çš„ç¤¼ç›’ã€‚",
                        options: [
                             { text: "ã€æ¬£ç„¶æ”¶ä¸‹ã€‘", effects: { wealth: 5000, attributes: { virtue: -15 } }, result_text: "æ‰“å¼€åæ˜¯äº”åƒä¸¤é“¶ç¥¨ã€‚æ­¤äº‹æœ‰å‡ ç‡æˆä¸ºæ”¿æ•Œæ”»å‡»ä½ çš„æŠŠæŸ„ã€‚" },
                             { text: "ã€ä¸¥è¯æ‹’ç»å¹¶ä¸ŠæŠ¥ã€‘", effects: { attributes: { virtue: 10 }, core_resources: { zheng_sheng: 10 } }, result_text: "ä½ ç»´æŠ¤äº†æ¸…å»‰ï¼Œä½†ä¹Ÿå¾—ç½ªäº†è¿™ä½å®˜å‘˜å’Œä»–èƒŒåçš„åŠ¿åŠ›ã€‚" },
                             { text: "ã€é€€å›ç¤¼ç‰©ï¼Œä½†æš—ç¤ºæœªæ¥å¯ä»¥åˆä½œã€‘", requirements: { charm: 70 }, effects: { npc_relationship: { npc_key: 'local_official', favor: 10, type: 'neutral' } }, result_text: "ä½ æ—¢ä¿ä½äº†æ¸…åï¼Œåˆä¸ºè‡ªå·±ç•™äº†æ¡åè·¯ã€‚" }
                        ]
                    },
                    {
                        title: "æ¥è‡ªé£æœˆé‰´çš„æƒ…æŠ¥",
                        desc: "å¦‚æœä½ åœ¨é£æœˆé‰´æœ‰äººè„‰ï¼Œä¸€ä½çº¢é¢œçŸ¥å·±ä¼šå‘ä½ é€éœ²ä¸€ä¸ªç§˜å¯†ã€‚",
                        options: [
                            { text: "ã€ä»”ç»†è†å¬ã€‘", requirements: { has_fyj_contact: true }, getOutcome: (gs) => {
                                const infoType = Math.random() < 0.5 ? 'si_sheng_huo' : 'cai_wu';
                                return { text: "ä½ è·å¾—äº†ä¸€ä»½å…³äºæŸä½å¤§è‡£çš„ç§˜å¯†æƒ…æŠ¥ã€‚", effects: { item: { id: `qing_bao_${infoType}`, amount: 1 } } }
                            }}
                        ]
                    },
                    {
                        title: "ä¸»æŒä¹¡è¯•",
                        desc: "ä½ è¢«ä»»å‘½ä¸ºä¹¡è¯•çš„å‰¯è€ƒå®˜ï¼Œè¿™æ˜¯ä¸€ä¸ªè‚¥å·®ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªçƒ«æ‰‹å±±èŠ‹ã€‚",
                        options: [
                            { text: "ã€ç§‰å…¬é€‰æ‹”ï¼Œä¸å¾‡ç§æƒ…ã€‘", effects: { attributes: { virtue: 10, reputation: 10 }, core_resources: { men_sheng: 5 } }, result_text: "ä½ é€‰æ‹”äº†å‡ ä½çœŸæ­£çš„æœ‰æ‰ä¹‹å£«ï¼Œä»–ä»¬å¯¹ä½ æ„Ÿæ©æˆ´å¾·ï¼Œæˆä¸ºäº†ä½ çš„é—¨ç”Ÿã€‚" },
                            { text: "ã€æ”¶å—â€œå…³èŠ‚â€é“¶ã€‘", cost: { wealth: -5000 }, effects: { attributes: { virtue: -15 }, core_resources: { men_sheng: 2 } }, result_text: "ä½ å½•å–äº†å‡ ä¸ªä¸–å®¶å­å¼Ÿï¼Œè·å¾—äº†å¤§ç¬”é’±è´¢ï¼Œä½†ä¹Ÿç•™ä¸‹äº†æŠŠæŸ„ã€‚" },
                            { text: "ã€ææ‹”å¯’é—¨å¼Ÿå­ã€‘", requirements: { virtue: 60 }, effects: { attributes: { virtue: 15 }, core_resources: { men_sheng: 10 } }, result_text: "ä½ çš„ä¸¾åŠ¨èµ¢å¾—äº†æ¸…æµçš„èµèª‰ï¼Œå¹¶æ”¶è·äº†ä¸€æ‰¹å¿ è¯šçš„å¯’é—¨é—¨ç”Ÿã€‚" }
                        ]
                    },
                    {
                        title: "åˆ¶å®šæ–°ç¨æ³•",
                        desc: "æˆ·éƒ¨å°šä¹¦å‘½ä½ å‚ä¸åˆ¶å®šä¸€é¡¹æ–°çš„ç¨æ³•ï¼Œå¯èƒ½ä¼šè§¦åŠå¤šæ–¹åˆ©ç›Šã€‚",
                        options: [
                            { text: "ã€ä¸ºå†œæ°‘å‡è´Ÿã€‘", effects: { core_resources: { zheng_sheng: 15 }, political_event: { type: 'offend', faction: 'landowners' } }, result_text: "æ–°ç¨æ³•è·å¾—äº†æ°‘ä¼—çš„æ”¯æŒï¼Œä½†ä½ å¾—ç½ªäº†åœ°ä¸»é˜¶å±‚ã€‚" },
                            { text: "ã€ä¸ºå•†äººå‡è´Ÿã€‘", effects: { wealth: 3000, political_event: { type: 'offend', faction: 'nobles' } }, result_text: "ä½ è·å¾—äº†å•†äººä»¬çš„æ”¿æ²»çŒ®é‡‘ï¼Œä½†å¾—ç½ªäº†ä¿å®ˆçš„è´µæ—ã€‚" },
                            { text: "ã€ç»´æŒç°çŠ¶ï¼Œå°ä¿®å°è¡¥ã€‘", effects: {}, result_text: "ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©ï¼Œä½†ä¹Ÿæ¯«æ— å»ºæ ‘ã€‚" }
                        ]
                    },
                    {
                        title: "ä¸‹æ”¾åœ°æ–¹",
                        desc: "æœå»·æä¾›äº†ä¸€ä¸ªå¤–æ”¾åœ°æ–¹ï¼Œæ‹…ä»»çŸ¥åºœçš„æœºä¼šã€‚",
                        options: [
                            { text: "ã€å‰å¾€å¯Œåº¶çš„æ±Ÿå—ã€‘", effects: { flag: 'go_to_jiangnan' }, result_text: "ä½ å°†è·å¾—æ›´å¤šçš„è´¢æ”¿æ”¶å…¥ï¼Œä½†ä¹Ÿè¿œç¦»äº†æƒåŠ›ä¸­å¿ƒã€‚" },
                            { text: "ã€å‰å¾€è´«ç˜ çš„è¥¿åŒ—ã€‘", effects: { flag: 'go_to_xibei' }, result_text: "è¿™æ˜¯ä¸€ä¸ªè‰°è‹¦ä½†å®¹æ˜“å‡ºæ”¿ç»©çš„åœ°æ–¹ã€‚" },
                            { text: "ã€ç•™åœ¨äº¬åŸã€‘", effects: {}, result_text: "ä½ é€‰æ‹©ç•™åœ¨äº¬åŸï¼Œç»§ç»­åœ¨æƒåŠ›çš„æ¼©æ¶¡ä¸­åšå¼ˆã€‚" }
                        ]
                    },
                    {
                        title: "ç¼–æ’°å²ä¹¦",
                        desc: "ä½ è¢«æŠ½è°ƒå»å‚ä¸ç¼–æ’°æœ¬æœçš„å²ä¹¦ã€‚",
                        options: [
                            { text: "ã€ç§‰ç¬”ç›´ä¹¦ã€‘", getOutcome: (gs) => {
                                if (gs.player.attributes.virtue > 100) {
                                    return { text: "ä½ çš„æ­£ç›´è·å¾—äº†å²å®˜ä»¬çš„å°Šæ•¬ï¼Œæ”¿å£°+10ã€‚", effects: { core_resources: { zheng_sheng: 10 } } };
                                }
                                return { text: "ä½ çš„ç›´ç¬”å¾—ç½ªäº†æŸä½æƒè´µï¼Œä¸ºä½ æ ‘ç«‹äº†æ•Œäººã€‚", effects: { political_event: { type: 'offend', faction: 'powerful_minister' } } };
                            }},
                            { text: "ã€ä¸ºå°Šè€…è®³ã€‘", effects: { npc_relationship: { npc_key: 'emperor', favor: 5 } }, result_text: "ä½ çš„â€œæ‡‚äº‹â€è·å¾—äº†çš‡å¸çš„äº›è®¸å¥½æ„Ÿã€‚" }
                        ]
                    },
                    {
                        title: "çš‡å­ä»¬çš„ç¤ºå¥½",
                        desc: "å¤ªå­ä¸é›ç‹éƒ½æ´¾äººç§ä¸‹é€æ¥åè´µçš„ç¤¼ç‰©ï¼Œå‘ä½ ç¤ºå¥½ã€‚",
                        options: [
                            { text: "ã€æ”¶ä¸‹å¤ªå­çš„ç¤¼ç‰©ã€‘", effects: { political_event: { type: 'align', faction: 'prince' }, wealth: 1500 }, result_text: "ä½ æ¥å—äº†å¤ªå­çš„ç¤ºå¥½ï¼Œä»æ­¤è¢«è´´ä¸Šäº†â€œå¤ªå­å…šâ€çš„æ ‡ç­¾ã€‚" },
                            { text: "ã€æ”¶ä¸‹é›ç‹çš„ç¤¼ç‰©ã€‘", effects: { political_event: { type: 'align', faction: 'yong_wang' }, wealth: 1500 }, result_text: "ä½ æ¥å—äº†é›ç‹çš„ç¤ºå¥½ï¼Œä»æ­¤è¢«è§†ä¸ºâ€œé›ç‹å…šâ€çš„ä¸€å‘˜ã€‚" },
                            { text: "ã€å…¨éƒ¨é€€å›ã€‘", effects: {}, result_text: "ä½ ä¿æŒäº†ä¸­ç«‹ï¼Œä½†ä¹Ÿå¯èƒ½è¢«åŒæ–¹éƒ½è§†ä¸ºä¸è¯†æŠ¬ä¸¾ã€‚" }
                        ]
                    }
                ],
                milestone_event: {
                    title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šä¸»ç†é»„æ²³å¤§æ¡ˆ",
                    trigger: { career_level: 6, text_desc: "å®˜é˜¶è¾¾åˆ°ä¾éƒï¼Œä¸”æ”¿å£° > 150", condition: (gs) => (gs.career.core_resources.zheng_sheng || 0) > 150 },
                    desc: "é»„æ²³å†³å ¤ï¼Œåœ£ä¸Šå‘½ä½ å½»æŸ¥æ­¤æ¡ˆï¼ŒèƒŒåå¯èƒ½æ¶‰åŠå·¥éƒ¨ä¸åœ°æ–¹å®˜å‘˜çš„æƒŠå¤©è´ªè…ç½‘ç»œã€‚",
                    success: { text: "ä½ æˆåŠŸæŸ¥æ˜çœŸç›¸ï¼Œæƒ©æ²»äº†è´ªå®˜ï¼Œå®‰æŠšäº†ç¾æ°‘ï¼Œæ”¿å£°è¾¾åˆ°é¡¶å³°ï¼", effects: { career_level_set: 7, core_resources: { zheng_sheng: 100 }, attributes: { reputation: 50 } } },
                    failure: { text: "è°ƒæŸ¥å—é˜»ï¼Œä½ åé­è¯¬é™·ï¼Œè¢«è´¬æ–¥ç¦»äº¬ã€‚", effects: { career_level_set: 5, core_resources: { zheng_sheng: -50 } } }
                }
            },
            {
                title: "ç¬¬ä¸‰å¹•ï¼šç™»å³°é€ æ",
                level_range: [8, 10],
                goal: "æˆä¸ºæ´¾ç³»é¢†è¢–æˆ–å­¤è‡£ï¼Œå·¦å³å›½ç­–ï¼Œå®ç°è‡ªå·±çš„æ”¿æ²»æŠ±è´Ÿã€‚",
                events: [
                    {
                        title: "é—¨ç”Ÿçš„èƒŒå›",
                        desc: "ä½ æœ€ä¿¡ä»»çš„ä¸€ä½é—¨ç”Ÿï¼Œè¢«æ”¿æ•Œç”¨é«˜å®˜åšç¦„æ”¶ä¹°ï¼ŒæŒæ¡äº†ä½ çš„ä¸€ä¸ªè‡´å‘½æŠŠæŸ„ã€‚",
                        options: [
                            { text: "ã€å…ˆå‘åˆ¶äººï¼Œå°†å…¶ç­å£ã€‘", requirements: { virtue: -50 }, effects: { attributes: { virtue: -50 }, end_game_risk: 0.1 }, result_text: "ä½ è§£å†³äº†åæ‚£ï¼Œä½†å†…å¿ƒè¢«é»‘æš—åå™¬ï¼Œæ­¤äº‹è‹¥è´¥éœ²ï¼Œä¸‡åŠ«ä¸å¤ã€‚" },
                            { text: "ã€åŠ¨ä¹‹ä»¥æƒ…ï¼Œè¯•å›¾æŒ½å›ã€‘", getOutcome: (gs) => {
                                if ((gs.npcs['trusted_protege']?.favor || 0) > 80) {
                                    return { text: "ä»–å¹¡ç„¶é†’æ‚Ÿï¼Œå›åˆ°ä½ çš„é˜µè¥ï¼Œå¹¶ä¸ºä½ æä¾›äº†æ”¿æ•Œçš„åå‘æƒ…æŠ¥ï¼", effects: { item: { id: 'qing_bao_cai_wu', amount: 1 } } };
                                } else {
                                    return { text: "ä»–é“äº†å¿ƒèƒŒå›ä½ ï¼Œå°†åœ¨ä¸‹æ¬¡å¤§æœä¼šä¸Šåæˆˆä¸€å‡»ï¼", effects: { flag: 'protege_betrayal_pending' } };
                                }
                            }},
                            { text: "ã€å£®å£«æ–­è…•ï¼Œè‡ªæˆ‘ç‰ºç‰²ã€‘", effects: { core_resources: { zheng_sheng: -100 }, attributes: { reputation: 50 } }, result_text: "ä½ ä¸»åŠ¨å‘çš‡å¸è¯·ç½ªï¼Œæ‰¿æ‹…éƒ¨åˆ†è´£ä»»ï¼Œè™½è¢«é™èŒï¼Œä½†ä¿å…¨äº†æ•´ä¸ªæ´¾ç³»ï¼Œæ´¾ç³»å†…å£°æœ›è¾¾åˆ°é¡¶å³°ã€‚" }
                        ]
                    },
                    {
                        title: "çš‡å¸çš„çŒœå¿Œ",
                        desc: "ä½ æƒåŠ¿è¿‡å¤§ï¼Œçš‡å¸å¼€å§‹å¯¹ä½ å¿ƒç”Ÿå¿Œæƒ®ï¼Œåœ¨ä¸€æ¬¡è°ˆè¯ä¸­è¯¢é—®ä½ â€œæ˜¯å¦æƒ³å‘Šè€è¿˜ä¹¡â€ã€‚",
                        options: [
                            { text: "ã€ç«‹åˆ»ä¸Šè¡¨è¯·æ±‚è¾å®˜ã€‘", effects: { career_status: 'retired' }, result_text: "çš‡å¸çš„ç–‘å¿ƒæ‰“æ¶ˆã€‚ä½ æš‚æ—¶é€€éšï¼Œä½†ä¿ç•™äº†æ‰€æœ‰äººè„‰ï¼Œæ•°å¹´åå¯èƒ½è¢«é‡æ–°å¯ç”¨ã€‚" },
                            { text: "ã€çŒ®ä¸Šé‡å®ã€‘", effects: { inventory_prompt: 'present_treasure' }, result_text: "ä½ ä»ç™¾å®é˜ä¸­çŒ®ä¸Šä¸€ä»¶ä»·å€¼è¿åŸçš„çå“ï¼Œçš‡å¸é¾™é¢œå¤§æ‚¦ï¼Œæš‚æ—¶å¿˜è®°äº†çŒœå¿Œã€‚" },
                            { text: "ã€æ¨èæ”¿æ•Œæ‹…ä»»è¦èŒã€‘", requirements: { wisdom: 150 }, effects: { attributes: { wisdom: 5 } }, result_text: "ä¸€æ‹›æˆåŠŸçš„â€œç¥¸æ°´ä¸œå¼•â€ï¼Œè½¬ç§»äº†çš‡å¸çš„æ³¨æ„åŠ›ã€‚ä½†é£é™©æé«˜ã€‚" }
                        ]
                    },
                    {
                        title: "å¤–æˆšå¹²æ”¿",
                        desc: "çš‡åçš„å¨˜å®¶åŠ¿åŠ›æ—¥ç›Šåºå¤§ï¼Œå¼€å§‹æ’æ‰‹æœæ”¿ï¼Œä¸ä½ æ‰€åœ¨çš„æ–‡å®˜é›†å›¢äº§ç”Ÿæ¿€çƒˆå†²çªã€‚",
                        options: [
                             { text: "ã€è”åˆæ–‡å®˜é›†å›¢ï¼Œæ­£é¢ç¡¬åˆšã€‘", effects: { flag: 'war_with_consort_clan' }, result_text: "ä¸€åœºæŒç»­æ•°å¹´çš„â€œæœå ‚å†…æˆ˜â€å¼€å¯äº†ã€‚" },
                             { text: "ã€ä¸å¤–æˆšè”å§»æˆ–åˆä½œã€‘", effects: { attributes: { virtue: -30 } }, result_text: "çŸ­æœŸå†…ä½ çš„æƒåŠ¿ä¼šæ›´åŠ å·©å›ºï¼Œä½†ä¼šå¤±å»æ¸…æµæ–‡å®˜çš„æ”¯æŒã€‚" }
                        ]
                    },
                    {
                        title: "å‚¨å›çš„è¯·æ±‚",
                        desc: "ä½ æ”¯æŒçš„å¤ªå­/çš‡å­ï¼Œç§ä¸‹è¯·æ±‚ä½ å¸®ä»–å¤„ç†ä¸€ä¸ªâ€œä¸å…‰å½©â€çš„ç§äººé—®é¢˜ã€‚",
                        options: [
                            { text: "ã€ä»£ä¸ºå¤„ç†ã€‘", effects: { npc_relationship: { npc_key: 'crown_prince', favor: 50 } }, result_text: "ä½ æˆåŠŸåï¼Œå°†æˆä¸ºå‚¨å›æœªæ¥çš„â€œç¬¬ä¸€å¿ƒè…¹â€ï¼Œä½†ä»–ä¹Ÿä¼šæ°¸è¿œæŒæ¡ä½ çš„è¿™ä¸ªæŠŠæŸ„ã€‚" },
                            { text: "ã€åŠè°å‚¨å›ã€‘", effects: { npc_relationship: { npc_key: 'crown_prince', favor: -10 }, attributes: { virtue: 10 } }, result_text: "å‚¨å›å¯èƒ½å¬ä»ï¼Œä¹Ÿå¯èƒ½è®¤ä¸ºä½ è¿‚è…è€Œç–è¿œä½ ã€‚" }
                        ]
                    },
                    {
                        title: "å¤©ç¾ä¸æ°‘æ„",
                        desc: "å›½å†…å‘ç”Ÿå¤§é¢ç§¯å¤©ç¾ï¼Œæ°‘æ€¨æ²¸è…¾ï¼Œæµè¨€ç›´æŒ‡å½“æœå®°è¾…ï¼ˆä¹Ÿå°±æ˜¯ä½ ï¼‰â€œå¾·ä¸é…ä½â€ã€‚",
                        options: [
                             { text: "ã€ä¸‹ä»¤å¼ºåŠ›èµˆç¾ï¼Œå¹¶è‡ªè¯·é™ç½ªã€‘", effects: { attributes: { reputation: 100, virtue: 20 }, core_resources: { zheng_sheng: 50 } }, result_text: "ä½ ä»¥é€€ä¸ºè¿›ï¼Œèµ¢å¾—äº†å¤©ä¸‹æ°‘å¿ƒå’Œçš‡å¸çš„å€šé‡ã€‚" },
                             { text: "ã€å°†è´£ä»»æ¨ç»™ä¸‹çº§æˆ–æ”¿æ•Œã€‘", effects: { attributes: { reputation: -50, virtue: -20 } }, result_text: "ä½ æš‚æ—¶ä¿ä½äº†ç›¸ä½ï¼Œä½†å¤±å»äº†æ°‘å¿ƒã€‚" }
                        ]
                    },
                    {
                        title: "æ¨è¡Œæ–°æ”¿",
                        desc: "ä½ å¸Œæœ›æ¨è¡Œä¸€é¡¹æ·±åˆ»çš„ç¤¾ä¼šæ”¹é©ï¼ˆå¦‚â€œä¸€æ¡é­æ³•â€ï¼‰ï¼Œä½†å¿…ç„¶ä¼šè§¦åŠ¨æ—§åŠ¿åŠ›çš„åˆ©ç›Šã€‚",
                        options: [
                            { text: "ã€è”åˆæ–°é”å®˜å‘˜ï¼Œå¼ºåŠ›æ¨è¡Œã€‘", requirements: { men_sheng: 50 }, effects: { flag: 'major_reform_started' }, result_text: "æ”¹é©å¼€å§‹äº†ï¼Œè¿™æ˜¯ä¸€åœºä½ æ­»æˆ‘æ´»çš„æ”¿æ²»æ–—äº‰ã€‚è‹¥æˆåŠŸï¼Œä½ å°†åç•™é’å²ï¼›è‹¥å¤±è´¥ï¼Œä½ å°†ä¸‡åŠ«ä¸å¤ã€‚" },
                            { text: "ã€å¯»æ±‚çš‡å¸çš„ç»å¯¹æ”¯æŒã€‘", requirements: { 'npc_favor_above': {'npc_key': 'emperor', favor: 80} }, effects: { flag: 'major_reform_started_easy' }, result_text: "æœ‰äº†çš‡å¸çš„æ”¯æŒï¼Œä½ çš„æ”¹é©é˜»åŠ›å¤§å‡ã€‚" },
                            { text: "ã€æ—¶æœºæœªåˆ°ï¼Œæš‚ç¼“æ¨è¡Œã€‘", effects: {}, result_text: "ä½ é€‰æ‹©äº†ç¨³å¦¥ï¼Œä½†ä¹Ÿé”™è¿‡äº†æœ€ä½³çš„æ”¹é©æ—¶æœºã€‚" }
                        ]
                    },
                    {
                        title: "ä¿®å»ºç§å®¶å›­æ—",
                        desc: "ä½ ä½æäººè‡£ï¼Œæ‰“ç®—ä¿®å»ºä¸€åº§å½°æ˜¾èº«ä»½çš„ç§å®¶å›­æ—ã€‚",
                        options: [
                            { text: "ã€è€—è´¹å·¨èµ„ï¼Œæå°½å¥¢åã€‘", cost: { wealth: 50000 }, effects: { attributes: { reputation: 10, virtue: -10 } }, result_text: "ä½ çš„å›­æ—å† ç»äº¬åŸï¼Œä½†ä¹Ÿå¼•æ¥äº†â€œç”Ÿæ´»å¥¢é¡â€çš„æ‰¹è¯„ã€‚" },
                            { text: "ã€ä¿®å»ºä¸€åº§ç®€æœ´çš„ä¹¦é™¢å¼å›­æ—ã€‘", cost: { wealth: 10000 }, effects: { attributes: { reputation: 5, virtue: 5 } }, result_text: "ä½ çš„å›­æ—æ¸…é›…è„±ä¿—ï¼Œè¢«èª‰ä¸ºâ€œæ–‡äººé£éª¨â€çš„å…¸èŒƒã€‚" }
                        ]
                    },
                    {
                        title: "é«˜ä¸½ä½¿è‡£æ¥è®¿",
                        desc: "é«˜ä¸½ä½¿è‡£å‰æ¥æœè´¡ï¼Œä½†åœ¨æ®¿ä¸Šè¨€è¯­å€¨å‚²ï¼Œä¼¼æœ‰è½»è§†ä¹‹æ„ã€‚",
                        options: [
                            { text: "ã€ä»¥å¾·æœäººï¼Œå±•ç°å¤©æœæ°”åº¦ã€‘", requirements: { etiquette: 120 }, effects: { attributes: { reputation: 10 } }, result_text: "ä½ çš„æ°”åº¦æŠ˜æœäº†å¯¹æ–¹ï¼Œä¸å‘ä¸äº¢åœ°ç»´æŠ¤äº†å›½ä½“ã€‚" },
                            { text: "ã€é’ˆé”‹ç›¸å¯¹ï¼Œå¯¸æ­¥ä¸è®©ã€‘", requirements: { wisdom: 120 }, effects: { attributes: { reputation: 5 }, core_resources: { zheng_sheng: 10 } }, result_text: "ä½ ç”¨çŠ€åˆ©çš„è¨€è¾é©³å¾—å¯¹æ–¹å“‘å£æ— è¨€ï¼Œå¤§æŒ¯å›½å¨ã€‚" }
                        ]
                    },
                    {
                        title: "è¾å®˜å½’éšçš„åŒåƒš",
                        desc: "ä¸€ä½ä¸ä½ å…³ç³»ä¸é”™çš„åŒåƒšï¼Œå› çœ‹ç ´å®˜åœºé»‘æš—ï¼Œå†³å®šè¾å®˜å½’éšã€‚ä»–å‰æ¥å‘ä½ è¾è¡Œã€‚",
                        options: [
                            { text: "ã€è®¾å®´é€åˆ«ã€‘", effects: { npc_relationship: { npc_key: 'retired_colleague', favor: 10 }, attributes: { virtue: 2 } }, result_text: "ä½ ä»¬ç—›é¥®ä¸€ç•ªï¼Œç›¸çº¦æ±Ÿæ¹–å†è§ã€‚ä½ ä¿ç•™äº†è¿™ä»½å‹è°Šã€‚" },
                            { text: "ã€åŠä»–ç•™ä¸‹ã€‘", effects: { npc_relationship: { npc_key: 'retired_colleague', favor: 5 } }, result_text: "ä½ åŠä»–ç•™ä¸‹ï¼Œä½†ä»–å»æ„å·²å†³ã€‚" },
                            { text: "ã€åˆ’æ¸…ç•Œé™ã€‘", effects: { npc_relationship: { npc_key: 'retired_colleague', favor: -20 } }, result_text: "ä½ æ‹…å¿ƒå—åˆ°ç‰µè¿ï¼Œä¸ä»–åˆ’æ¸…äº†ç•Œé™ã€‚" }
                        ]
                    },
                    {
                        title: "çš‡å¸çš„å®¶äº‹",
                        desc: "çš‡å¸å°±ä¸€ä½çš‡å­çš„å©šäº‹é—®é¢˜ï¼Œç§ä¸‹å¾æ±‚ä½ çš„æ„è§ã€‚",
                        options: [
                            { text: "ã€ä»æ”¿æ²»è§’åº¦åˆ†æåˆ©å¼Šã€‘", requirements: { wisdom: 150 }, effects: { npc_relationship: { npc_key: 'emperor', favor: 10 } }, result_text: "ä½ çš„åˆ†ææ·±å¾—å¸å¿ƒï¼Œçš‡å¸è®¤ä¸ºä½ å ªä¸ºå›½ä¹‹æŸ±çŸ³ã€‚" },
                            { text: "ã€ä»äººä¼¦è§’åº¦åŠè¯´ã€‘", requirements: { virtue: 120 }, effects: { npc_relationship: { npc_key: 'emperor', favor: 5 }, attributes: { virtue: 5 } }, result_text: "ä½ çš„å»ºè®®å……æ»¡äº†äººæƒ…å‘³ï¼Œçš‡å¸è™½æœªé‡‡çº³ï¼Œä½†å¯¹ä½ çš„äººå“é¢‡ä¸ºèµè®¸ã€‚" }
                        ]
                    }
                ],
                milestone_event: {
                    title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šå›½æœ¬ä¹‹äº‰",
                    trigger: { career_level: 9, text_desc: "å®˜å±…å°šä¹¦ï¼Œä¸”æ´¾ç³»æ–—äº‰ç™½çƒ­åŒ–", condition: (gs) => (gs.flags.faction_conflict_level > 80) },
                    desc: "çš‡å¸ç—…é‡ï¼Œå¤ªå­ä¸é›ç‹å¯¹å‚¨ä½çš„äº‰å¤ºå·²åˆ°å›¾ç©·åŒ•è§çš„æ—¶åˆ»ã€‚ä½ ä½œä¸ºä¸€æ–¹åŠ¿åŠ›çš„æ ¸å¿ƒï¼Œä½ çš„æ¯ä¸€ä¸ªå†³ç­–éƒ½å°†å†³å®šå¸å›½çš„æœªæ¥ã€‚",
                    success: { text: "ä½ æ”¯æŒçš„çš‡å­æˆåŠŸç™»åŸºï¼ä½ è¢«å°Šä¸ºå¸å¸ˆï¼Œæ‹œä¸ºå†…é˜é¦–è¾…ï¼Œæƒå€¾æœé‡ï¼Œå®ç°äº†æ–‡å®˜çš„ç»ˆææŠ±è´Ÿï¼", effects: { career_level_set: 10, end_game_title: "ä¸€ä»£åç›¸" } },
                    failure: { text: "ä½ ç«™é”™äº†é˜Ÿï¼Œåœ¨æ–°çš‡ç™»åŸºåè¢«æ¸…ç®—ï¼Œæˆ–æŠ„å®¶æµæ”¾ï¼Œæˆ–èº«é¦–å¼‚å¤„ã€‚", effects: { end_game: 'execution' } }
                }
            }
        ]
},
'warrior': {
    name: "æ­¦å°†",
    icon: "fa-shield-alt",
    gender: "male",
    core_resources: ["bing_yuan", "liang_cao", "jing_rui_du", "shi_qi", "wei_wang"],
    dashboard_name: "å†›åŠ¡æ²™ç›˜",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šæµ´è¡€æ–°å…µ",
            level_range: [1, 4],
            goal: "åœ¨æ®‹é…·çš„å†›è¥ä¸­æ´»ä¸‹æ¥ï¼Œè¯æ˜æ‚¨å¹¶éå¼±ä¸ç¦é£çš„ä¸–å®¶å­å¼Ÿï¼Œé€šè¿‡å®åŠ›å’Œæ™ºæ…§èµ¢å¾—å°Šé‡ï¼Œå¹¶ä¸ºè‡ªå·±äº‰å–åˆ°ç¬¬ä¸€æ”¯å¯ä»¥æŒ‡æŒ¥çš„éƒ¨é˜Ÿã€‚",
            events: [
                {
                    title: "æ–°å…µè¥çš„ç«‹å¨",
                    desc: "æ–°å…µè¥ä¸­é±¼é¾™æ··æ‚ï¼Œæ‚¨éœ€è¦å°½å¿«ç¡®ç«‹è‡ªå·±çš„åœ°ä½ã€‚",
                    options: [
                        { 
                            text: "ã€æŒ‘æˆ˜æœ€å¼ºçš„åˆºå¤´å…µç—ã€‘", 
                            requirements: { martial: 30 },
                            getOutcome: (gs) => {
                                if(gs.player.attributes.martial > 50 || Math.random() < 0.7) {
                                    return { text: "ä½ å¹²å‡€åˆ©è½åœ°å°†ä»–å‡»å€’åœ¨åœ°ã€‚å…¨è¥æ–°å…µå¯¹ä½ å¿ƒç”Ÿæ•¬ç•ã€‚", effects: { core_resources: { wei_wang: 10 }, attributes: { martial: 2 } } };
                                } else {
                                    return { text: "ä½ è¢«å¯¹æ–¹è½»æ¾å‡»è´¥ï¼Œæ²¦ä¸ºç¬‘æŸ„ã€‚", effects: { core_resources: { wei_wang: -5 }, attributes: { health: -5 } } };
                                }
                            }
                        },
                        { text: "ã€åˆ†äº«ä½ çš„å®¶ä¿¡å’Œé£Ÿç²®ã€‘", effects: { attributes: { virtue: 3 }, core_resources: { shi_qi: 5 } }, result_text: "ä½ çš„å–„ä¸¾èµ¢å¾—äº†äººå¿ƒï¼Œç»“è¯†äº†2-3åâ€œè¢æ³½â€ï¼ˆå¿ è¯šçš„æˆ˜å‹ï¼‰ï¼Œä»–ä»¬æœªæ¥å¯èƒ½æˆä¸ºä½ å¿ƒè…¹å‰¯å°†çš„å€™é€‰äººã€‚" },
                        { text: "ã€åœ¨æ“ç»ƒä¸­è¡¨ç°çªå‡ºã€‘", requirements: { health: 80 }, effects: { npc_relationship: { npc_key: 'sergeant', favor: 15 } }, result_text: "ä½ æƒŠäººçš„è€åŠ›å’ŒæŠ€å·§å¼•èµ·äº†ç™¾å¤«é•¿çš„æ³¨æ„ï¼Œä»–å¯èƒ½ä¼šåœ¨ã€å¤ºæ——å¤§æ¯”æ­¦ã€‘ä¸­ç»™ä½ ä¸€ä¸ªæœ‰åˆ©çš„ä½ç½®ã€‚" }
                    ]
                },
                {
                    title: "å†›æ¢°åº“çš„æŠ‰æ‹©",
                    desc: "ç™¾å¤«é•¿å…è®¸ä½ ä»å†›æ¢°åº“ä¸ºè‡ªå·±æŒ‘é€‰ä¸€å¥—è£…å¤‡ã€‚",
                    options: [
                        { text: "ã€é€‰æ‹©åšé‡çš„æ­¥å…µé‡ç”²ã€‘", effects: { item: { id: 'bai_lian_bu_ren_jia', amount: 1 } }, result_text: "ä½ è·å¾—[ç™¾ç‚¼æ­¥äººç”²]ï¼Œè£…å¤‡åå¥åº·ä¸Šé™+10ï¼Œæˆ˜åœºç”Ÿå­˜ç‡æå‡ï¼Œä½†ä¸ªäººçªå‡»èƒ½åŠ›ä¸‹é™ã€‚" },
                        { text: "ã€é€‰æ‹©è½»ä¾¿çš„æ–¥å€™çš®ç”²ã€‘", effects: { item: { id: 'ji_feng_chi_hou_jia', amount: 1 } }, result_text: "ä½ è·å¾—[ç–¾é£æ–¥å€™ç”²]ï¼Œè£…å¤‡åæˆ˜åœºç§»åŠ¨åŠ›æå‡ï¼Œçªè¢­/ä¾¦æŸ¥æˆåŠŸç‡æå‡ï¼Œä½†é˜²å¾¡åŠ›è¾ƒå¼±ã€‚" },
                        { text: "ã€è¯·æ±‚ä¸€æŠŠä¸Šå¥½çš„æ­¦å™¨ã€‘", getOutcome: (gs) => {
                            if ((gs.npcs['sergeant']?.favor || 0) > 30) {
                                return { text: "ä»–å°†è‡ªå·±çš„æ—§ä½©åˆ€èµ äºˆä½ ï¼Œè£…å¤‡åæ­¦å­¦+3ã€‚", effects: { item: { id: 'bai_fu_chang_pei_dao', amount: 1 } } };
                            }
                            return { text: "ç™¾å¤«é•¿è¡¨ç¤ºæ­¦å™¨éœ€æŒ‰å†›åŠŸåˆ†é…ï¼Œæ‹’ç»äº†ä½ çš„è¯·æ±‚ã€‚", effects: {} };
                        }}
                    ]
                },
                {
                    title: "æ–¥å€™ä»»åŠ¡çš„é£é™©",
                    desc: "ä½ è¢«æ´¾å»ä¾¦æŸ¥ä¸€ç‰‡ä»æœªæ¶‰è¶³è¿‡çš„å¯†æ—ã€‚",
                    options: [
                        { text: "ã€é€‰æ‹©å®‰å…¨çš„å®˜é“è·¯çº¿ã€‘", effects: { core_resources: { wei_wang: 2 } }, result_text: "ä½ å®‰å…¨è¿”å›ï¼Œå¸¦å›äº†æ™®é€šçš„æƒ…æŠ¥ï¼Œè·å¾—äº†å°‘é‡æˆ˜åŠŸã€‚" },
                        { text: "ã€é€‰æ‹©å±é™©çš„æ—ä¸­å°å¾„ã€‘", requirements: { wisdom: 40 }, getOutcome: (gs) => {
                            if(Math.random() > 0.4){
                                return { text: "ä½ å‘ç°äº†ä¸€æ¡å¯ä»¥ç»•åˆ°æ•Œäººåæ–¹çš„ç§˜å¯†å°è·¯ï¼", effects: { item: { id: 'mi_lin_di_xing_tu', amount: 1 } } };
                            }
                            return { text: "ä½ é­é‡äº†é‡å…½æˆ–é™·é˜±ï¼Œè´Ÿä¼¤è€Œå½’ã€‚", effects: { attributes: { health: -10 } } };
                        }}
                    ]
                },
                {
                    title: "æˆ˜é©¬çš„æŒ‘é€‰",
                    desc: "ä¸€æ‰¹æ–°çš„æˆ˜é©¬è¿æŠµå†›è¥ï¼Œä½ æœ‰ä¼˜å…ˆæŒ‘é€‰æƒã€‚",
                    options: [
                        { text: "ã€å‡­æ„Ÿè§‰æŒ‘é€‰ä¸€åŒ¹ã€‘", getOutcome: (gs) => {
                            if(Math.random() < 0.3){
                                 return { text: "ä½ è¿æ°”ä¸é”™ï¼ŒæŒ‘åˆ°ä¸€åŒ¹è‰¯é©¹[ç¥éªçš„æˆ˜é©¬]ï¼", effects: { item: { id: 'shen_jun_zhan_ma', amount: 1 } } };
                            }
                            return { text: "ä½ æŒ‘äº†ä¸€åŒ¹æ™®é€šçš„æˆ˜é©¬ï¼Œæ— äº‹å‘ç”Ÿã€‚", effects: {}}
                        }},
                        { text: "ã€å‘é©¬å¤«è¯·æ•™å¹¶èµ ç¤¼ã€‘", cost: { wealth: 100 }, effects: { item: { id: 'shen_jun_zhan_ma', amount: 1 } }, result_text: "é©¬å¤«å¯¹ä½ è¡¨ç¤ºæ„Ÿè°¢ï¼Œå¹¶ä¸ºä½ æŒ‘é€‰äº†ä¸€åŒ¹ä¸Šå¥½çš„æˆ˜é©¬ã€‚" },
                        { text: "ã€ä½¿ç”¨[ç›¸é©¬ç»]æŒ‘é€‰ã€‘", requirements: { has_item: 'xiang_ma_jing' }, effects: { item: { id: 'chi_dian', amount: 1 } }, result_text: "ä½ è¿ç”¨çŸ¥è¯†ï¼Œç«Ÿåœ¨é©¬ç¾¤ä¸­å‘ç°äº†ä¸€åŒ¹æœ‰â€œæ±—è¡€â€è¡€ç»Ÿçš„å®é©¬[èµ¤ç”µ]ï¼" }
                    ]
                },
                {
                    title: "é¦–æ¬¡é¢†å–å†›é¥·",
                    desc: "å†›éœ€å®˜â€œä¸å°å¿ƒâ€å¤šç»™äº†ä½ ä¸€ä»½å†›é¥·ã€‚",
                    options: [
                         { text: "ã€å½“åœºé€€è¿˜ã€‘", effects: { attributes: { virtue: 5 }, npc_relationship: { npc_key: 'quartermaster', favor: 20 } }, result_text: "å†›éœ€å®˜å¯¹ä½ çš„è¯šå®å°è±¡æ·±åˆ»ï¼Œè¿™å¯¹ä½ æœªæ¥çš„ç²®è‰è¡¥ç»™æ•ˆç‡è‡³å…³é‡è¦ã€‚" },
                         { text: "ã€ä¸åŠ¨å£°è‰²åœ°æ”¶ä¸‹ã€‘", effects: { wealth: 200, attributes: { virtue: -5 } }, result_text: "ä½ é¢å¤–è·å¾—äº†200ä¸¤ã€‚ä½†å†›éœ€å®˜å¯èƒ½æ˜¯åœ¨è¯•æ¢ä½ ï¼Œè‹¥å¦‚æ­¤ï¼Œä»–å¯¹ä½ çš„è¯„ä»·ä¼šé™ä½ã€‚" },
                         { text: "ã€ç”¨å¤šä½™çš„é’±è¯·å…¨é˜Ÿå–é…’ã€‘", effects: { core_resources: { shi_qi: 10, wei_wang: 5 }, attributes: { virtue: -2 } }, result_text: "ä½ åœ¨é˜Ÿé‡Œçš„å¨ä¿¡å¤§å¢ï¼Œå£«æ°”é«˜æ¶¨ã€‚" }
                    ]
                },
                {
                    title: "è¾¹å¢ƒæ‘©æ“¦",
                    desc: "ä¸€å°è‚¡æ•Œå†›è¶Šè¿‡è¾¹å¢ƒè¿›è¡Œéªšæ‰°ï¼Œç™¾å¤«é•¿å‘½ä½ å¸¦ä¸€é˜Ÿäººå‰å»é©±é€ã€‚",
                    options: [
                        { text: "ã€å¥‹å‹‡å½“å…ˆï¼Œæ–©è·é¦–çº§ã€‘", requirements: { martial: 40 }, effects: { core_resources: { wei_wang: 5 }, attributes: { martial: 1 } }, result_text: "ä½ æˆåŠŸé©±é€æ•Œå†›å¹¶å°æœ‰æ–©è·ï¼Œè·å¾—äº†ç¬¬ä¸€æ¬¡å†›åŠŸã€‚" },
                        { text: "ã€ç¨³å¦¥ä¸ºä¸Šï¼Œé©±é€å³å¯ã€‘", effects: { core_resources: { wei_wang: 2 } }, result_text: "ä½ æˆåŠŸå®Œæˆäº†ä»»åŠ¡ï¼Œä½†è¡¨ç°å¹³å¹³ã€‚" },
                        { text: "ã€è¿½å‡»è¿‡æ·±ï¼Œé­é‡åŸ‹ä¼ã€‘", effects: { attributes: { health: -15 }, core_resources: { wei_wang: -5 } }, result_text: "ä½ å› è´ªåŠŸè€Œå†’è¿›ï¼Œå¯¼è‡´å°é˜Ÿå—æŸï¼Œè‡ªå·±ä¹Ÿå—äº†ä¼¤ã€‚" }
                    ]
                },
                {
                    title: "è€å…µçš„åˆéš¾",
                    desc: "ä¸€ä½çœ‹ä¸èµ·ä½ ä¸–å®¶å­å¼Ÿèº«ä»½çš„è€å…µï¼Œåœ¨è®­ç»ƒæ—¶å¤„å¤„ç»™ä½ ä½¿ç»Šå­ã€‚",
                    options: [
                        { text: "ã€å¿æ°”åå£°ã€‘", effects: { attributes: { health: -2 } }, result_text: "ä½ é€‰æ‹©å¿è€ï¼Œä½†è¿™è®©å¯¹æ–¹æ›´åŠ å˜æœ¬åŠ å‰ã€‚" },
                        { text: "ã€å‘ç™¾å¤«é•¿æŠ¥å‘Šã€‘", effects: { npc_relationship: { npc_key: 'veteran_soldier', favor: -15 } }, result_text: "ç™¾å¤«é•¿è®­æ–¥äº†è€å…µï¼Œä½†ä»–ä»æ­¤æ¨ä¸Šäº†ä½ ã€‚" },
                        { text: "ã€ç”¨å®åŠ›è¯´è¯ã€‘", requirements: { martial: 50 }, effects: { npc_relationship: { npc_key: 'veteran_soldier', favor: 20 } }, result_text: "ä½ åœ¨ä¸€æ¬¡å¯¹ç»ƒä¸­å ‚å ‚æ­£æ­£åœ°å‡»è´¥äº†ä»–ï¼Œèµ¢å¾—äº†ä»–çš„å°Šé‡ã€‚" }
                    ]
                },
                {
                    title: "å­¦ä¹ å…µæ³•",
                    desc: "å†›ä¸­è—ä¹¦å®¤æœ‰ä¸€äº›åŸºç¡€å…µæ³•å¯ä¾›é˜…è¯»ã€‚",
                    options: [
                        { text: "ã€ç ”è¯»ã€Šå­™å­å…µæ³•ã€‹ã€‘", effects: { attributes: { wisdom: 3 } }, result_text: "ä½ å¯¹æˆ˜äº‰çš„å®è§‚ç­–ç•¥æœ‰äº†åˆæ­¥äº†è§£ã€‚" },
                        { text: "ã€å­¦ä¹ ã€Šç»ƒå…µå®çºªã€‹ã€‘", effects: { core_resources: { jing_rui_du: 1 } }, result_text: "ä½ å­¦ä¹ äº†å¦‚ä½•æ›´æœ‰æ•ˆåœ°è®­ç»ƒå£«å…µã€‚" }
                    ]
                },
                {
                    title: "å®¶ä¹¦ä¸åŒ…è£¹",
                    desc: "ä½ æ”¶åˆ°äº†å®¶äººå¯„æ¥çš„åŒ…è£¹ï¼Œé‡Œé¢æœ‰ä¸€äº›å®¶ä¹¡ç‰¹äº§å’Œä¸€å°å˜˜å¯’é—®æš–çš„ä¿¡ã€‚",
                    options: [
                        { text: "ã€ä¸è¢æ³½åˆ†äº«ã€‘", effects: { core_resources: { shi_qi: 8 }, attributes: { virtue: 2 } }, result_text: "ä½ çš„åˆ†äº«è®©æ•´ä¸ªå°é˜Ÿéƒ½æ„Ÿå—åˆ°äº†æ¸©æš–ï¼Œå£«æ°”æå‡ã€‚" },
                        { text: "ã€ç‹¬è‡ªäº«ç”¨ã€‘", effects: {}, result_text: "ä½ æ„Ÿå—åˆ°äº†å®¶äººçš„å…³çˆ±ï¼Œç¼“è§£äº†æ€ä¹¡ä¹‹æƒ…ã€‚" }
                    ]
                },
                {
                    title: "ä¿®è¡¥ç›”ç”²",
                    desc: "ä½ çš„ç›”ç”²åœ¨ä¸Šæ¬¡è®­ç»ƒä¸­æœ‰äº›ç ´æŸã€‚",
                    options: [
                        { text: "ã€å‘å†›éœ€å®˜ç”³è¯·æ–°çš„ã€‘", getOutcome: (gs) => {
                            if ((gs.npcs['quartermaster']?.favor || 0) > 10) {
                                return { text: "å†›éœ€å®˜çˆ½å¿«åœ°ä¸ºä½ æ›´æ¢äº†æ›´å¥½çš„ç›”ç”²ã€‚", effects: {} };
                            }
                            return { text: "å†›éœ€å®˜ä»¥ç‰©èµ„ç´§å¼ ä¸ºç”±æ‹’ç»äº†ä½ ã€‚", effects: {} };
                        }},
                        { text: "ã€è‡ªå·±åŠ¨æ‰‹ä¿®è¡¥ã€‘", effects: { attributes: { health: 1 } }, result_text: "è™½ç„¶è¾›è‹¦ï¼Œä½†ä½ å¯¹è‡ªå·±çš„è£…å¤‡æ›´åŠ äº†è§£ï¼Œä¹Ÿé”»ç‚¼äº†åŠ¨æ‰‹èƒ½åŠ›ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šæ²™åœºå¤ºå¸…",
                trigger: { career_level: 3, text_desc: "æ­¦ä¸¾äºº, æ­¦å­¦>80, å¨æœ›>50", condition: (gs) => gs.player.attributes.martial > 80 && (gs.career.core_resources.wei_wang || 0) > 50 },
                desc: "å°˜åœŸé£æ‰¬çš„å·¨å¤§æ¼”æ­¦åœºä¸Šï¼Œä¸¤ä¸ªç™¾äººé˜Ÿåˆ†åˆ—ä¸¤ç«¯ã€‚ä½ èº«å¤„é˜µå‰ï¼Œå¯¹é¢æ˜¯ä½ çš„ç«äº‰å¯¹æ‰‹ã€‚è¿™ä¸æ˜¯ä¸ªäººæ¯”æ­¦ï¼Œè€Œæ˜¯ä½ ä½œä¸ºæŒ‡æŒ¥å®˜çš„ç¬¬ä¸€æ¬¡å¤§è€ƒã€‚",
                success: { text: "ä½ èµ¢å¾—äº†æ¼”æ­¦ï¼è¢«å°†å†›å½“ä¼—ææ‹”ä¸ºâ€œæ ¡å°‰â€ï¼Œæ­£å¼æˆä¸ºå†›å®˜ï¼Œè·å¾—å…µæƒï¼Œå¯ä»¥æŒ‡æŒ¥ä¸€æ”¯ç™¾äººé˜Ÿï¼Œå¹¶è·å¾—[æ ¡å°‰çš„é“ç¬¦]ï¼", effects: { career_level_set: 4, item: { id: 'xiao_wei_tie_fu', amount: 1 } } },
                failure: { text: "æ¼”æ­¦å¤±è´¥ï¼Œä½ å¤±å»äº†æ™‹å‡æœºä¼šï¼Œè¢«è°ƒå¾€åå‹¤éƒ¨é˜Ÿä¸€å¹´ï¼Œç«äº‰å¯¹æ‰‹æˆä¸ºä½ çš„ä¸Šå¸ã€‚", effects: { career_level_set: 3 } }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šç™¾æˆ˜ä¹‹å°†",
            level_range: [5, 8],
            goal: "çœŸæ­£æŒ‡æŒ¥ä¸€åœºæˆ˜å½¹ï¼Œå­¦ä¼šåå‹¤ä¸æˆ˜æœ¯çš„ç»“åˆï¼Œèµ¢å¾—ä¸€åœºå†³å®šæ€§çš„èƒœåˆ©ï¼Œå¹¶å»ºç«‹è‡ªå·±çš„å¨æœ›ã€‚",
            events: [
                {
                    title: "å†›ä¸­èµŒå±€",
                    desc: "ä½ å‘ç°ä½ çš„å£«å…µåœ¨ç§ä¸‹èšèµŒï¼Œå£«æ°”é«˜æ˜‚ä½†å†›çºªæ¶£æ•£ã€‚",
                    options: [
                        { text: "ã€ä¸¥å‰ç¦æ­¢å¹¶æƒ©ç½šã€‘", effects: { core_resources: { jing_rui_du: 2, shi_qi: -10 } }, result_text: "å†›çºªå¾—åˆ°æ•´è‚ƒï¼Œéƒ¨é˜Ÿç²¾é”åº¦å¾®å‡ã€‚ä½†å£«æ°”ä¸‹é™ï¼Œä½ ä¸éƒ¨åˆ†å£«å…µå…³ç³»ä¸‹é™ã€‚" },
                        { text: "ã€çä¸€åªçœ¼é—­ä¸€åªçœ¼ã€‘", effects: { core_resources: { shi_qi: 5 } }, result_text: "å£«æ°”ä¸Šå‡ï¼Œä½†æœ‰å‡ ç‡è§¦å‘â€œå£«å…µå› èµŒå€ºå†…æ–—â€çš„è´Ÿé¢äº‹ä»¶ã€‚" },
                        { text: "ã€äº²è‡ªä¸‹åœºï¼Œèµ¢å…‰ä»–ä»¬çš„é’±å†è¿˜ç»™ä»–ä»¬ã€‘", requirements: { wisdom: 90, charm: 80 }, effects: { core_resources: { wei_wang: 15, shi_qi: 10 } }, result_text: "ä½ ç”¨é«˜è¶…çš„æŠ€å·§éœ‡æ…‘äº†æ‰€æœ‰äººï¼Œåˆç”¨ä»ä¹‰æ”¶ä¹°äº†äººå¿ƒã€‚éƒ¨é˜Ÿå¿ è¯šåº¦å¤§å¹…æå‡ã€‚" }
                    ]
                },
                {
                    title: "æ”»åŸå™¨æ¢°çš„ç­¹å¤‡",
                    desc: "ä¸ºå‡†å¤‡ä¸‹ä¸€æ¬¡æ”»åŸæˆ˜ï¼Œä½ éœ€è¦å»ºé€ æ”»åŸå™¨æ¢°ã€‚",
                    options: [
                        { text: "ã€ä½¿ç”¨æ ‡å‡†å›¾çº¸å’Œææ–™ã€‘", cost: { wealth: 2000 }, effects: {}, result_text: "ä½ æ­£å¸¸å®Œæˆäº†ä»»åŠ¡ã€‚" },
                        { text: "ã€ä½¿ç”¨[å¢¨å®¶å›¾çº¸]ã€‘", requirements: { has_item: 'mo_jia_tu_zhi' }, cost: { wealth: 10000 }, effects: { flag: 'super_weapon_ready' }, result_text: "ä½ å»ºé€ å‡ºå¨åŠ›å·¨å¤§çš„â€œç¥æœºå¼©è½¦â€ï¼åœ¨ä¸‹æ¬¡æ”»åŸæˆ˜ä¸­ï¼Œä½ å°†è·å¾—å·¨å¤§çš„ä¼˜åŠ¿ã€‚" },
                        { text: "ã€å¼ºå¾æ°‘å¤«ï¼ŒåŠ é€Ÿå»ºé€ ã€‘", effects: { attributes: { virtue: -10 }, flag: 'civilian_resentment' }, result_text: "å»ºé€ é€Ÿåº¦æå‡ï¼Œä½†å½“åœ°æ°‘æ€¨æ²¸è…¾ï¼Œæœ‰å‡ ç‡åœ¨æˆ˜æ—¶é­é‡åå‹¤è¡¥ç»™çº¿è¢«ç ´åçš„äº‹ä»¶ã€‚" }
                    ]
                },
                {
                    title: "å®¡é—®é«˜çº§æˆ˜ä¿˜",
                    desc: "ä½ ä¿˜è™äº†ä¸€åæ•Œå†›çš„ç™¾å¤«é•¿ã€‚",
                    options: [
                        { text: "ã€ä»¥å…¶å®¶äººæ€§å‘½ç›¸å¨èƒã€‘", effects: { attributes: { virtue: -15, wei_wang: -5 } }, result_text: "ä½ è·å¾—äº†æƒ…æŠ¥ï¼Œä½†æ‰‹æ®µä¸ºäººä¸é½¿ã€‚" },
                        { text: "ã€è®¸è¯ºé«˜å®˜åšç¦„è¿›è¡Œç­–åã€‘", requirements: { charm: 90 }, cost: { wealth: 1000 }, getOutcome: (gs) => {
                            if (gs.player.attributes.charm > 100 || Math.random() < 0.6) {
                                return { text: "ä»–è¢«ä½ è¯´åŠ¨ï¼ŒåŒæ„æˆä¸ºä½ å®‰æ’åœ¨æ•Œå†›ä¸­çš„é—´è°ã€‚", effects: { flag: 'enemy_spy_planted' } };
                            }
                            return { text: "å¯¹æ–¹ä¸ä¸ºæ‰€åŠ¨ï¼Œåœ¨ä½ è½¬èº«åè‡ªå°½ï¼Œä½ ä¸€æ— æ‰€è·ã€‚", effects: {} };
                        }},
                        { text: "ã€ä»¥ç¤¼ç›¸å¾…ï¼Œæ™“ä»¥å¤§ä¹‰ã€‘", requirements: { virtue: 100 }, effects: { attributes: { virtue: 5 } }, result_text: "ä»–è¢«ä½ çš„æ°”åº¦æŠ˜æœï¼Œåéœ²äº†éƒ¨åˆ†æƒ…æŠ¥ã€‚" }
                    ]
                },
                {
                    title: "å¤œå·¡è¥åœ°",
                    desc: "æ·±å¤œï¼Œä½ å†³å®šäº²è‡ªå·¡è§†è¥åœ°ã€‚",
                    options: [
                        { text: "ã€å¼€å§‹å·¡è§†ã€‘", getOutcome: (gs) => {
                            const rand = Math.random();
                            if(rand < 0.33) return { text: "ä½ å‘ç°å“¨å…µåœ¨æ‰“çŒç¡ã€‚ä½ é€‰æ‹©ä¸¥æƒ©ï¼Œå†›çºªæå‡ï¼Œä½†è¯¥å“¨å…µæ†æ¨ä½ ã€‚", effects: { core_resources: { jing_rui_du: 1 } } };
                            if(rand < 0.66) return { text: "ä½ å¬åˆ°å‡ ä¸ªå£«å…µåœ¨è®¨è®ºå®¶ä¹¡ï¼Œæ€ä¹¡æƒ…åˆ‡ã€‚ä½ ä¸Šå‰å®‰æ…°äº†å‡ å¥ï¼Œå£«æ°”æœ‰æ‰€å›å‡ã€‚", effects: { core_resources: { shi_qi: 5 } } };
                            return { text: "ä½ æ’è§ä½ çš„å¿ƒè…¹å‰¯å°†åœ¨ç‹¬è‡ªåŠ ç»ƒï¼Œä½ å¾ˆæ¬£æ…°ã€‚", effects: { npc_relationship: { npc_key: 'deputy', favor: 10 }, attributes: { martial: 2 } } };
                        }}
                    ]
                },
                {
                    title: "æœå»·çš„ä½¿è€…",
                    desc: "çš‡å¸æ´¾æ¥çš„ä½¿è€…ï¼ˆç›‘å†›ï¼‰æŠµè¾¾ä½ çš„å†›è¥ï¼Œä¼ è¾¾â€œåœ£æ„â€ã€‚",
                    options: [
                         { text: "ã€ç››æƒ…æ¬¾å¾…ï¼Œé‡é‡‘è´¿èµ‚ã€‘", cost: { wealth: 3000 }, effects: { flag: 'imperial_court_impressed' }, result_text: "ç›‘å†›åœ¨ç»™çš‡å¸çš„æŠ¥å‘Šä¸­å¯¹ä½ å¤§åŠ èµèµï¼Œä½ åœ¨æœä¸­çš„è¯„ä»·æå‡ã€‚" },
                         { text: "ã€å±•ç¤ºå†›å¨ï¼Œå¼ºè°ƒå†›æƒ…ç´§æ€¥ã€‘", effects: { core_resources: { wei_wang: 10 } }, result_text: "ç›‘å†›è¢«ä½ çš„å†›å¨éœ‡æ…‘ï¼Œä¸æ•¢è¿‡å¤šå¹²æ¶‰ä½ çš„å†›åŠ¡ã€‚" },
                         { text: "ã€å“­è¯‰è‰°éš¾ï¼Œè¯·æ±‚è¡¥ç»™ã€‘", getOutcome: (gs) => {
                             if(gs.player.attributes.charm > 80){
                                 return {text: "ç›‘å†›æ·±è¡¨åŒæƒ…ï¼Œå›äº¬åä¼šä¸ºä½ äº‰å–æ›´å¤šçš„å…µæºå’Œç²®è‰ã€‚", effects: {}}
                             }
                             return {text: "ç›‘å†›è®¤ä¸ºä½ æ˜¯åœ¨å¤¸å¤§å…¶è¯ï¼Œæ¨è„±è´£ä»»ï¼Œå¯¹ä½ å°è±¡å˜å·®ã€‚", effects: {}}
                         }}
                    ]
                },
                {
                    title: "ç²®è‰å‘Šæ€¥",
                    desc: "å› å¤§é›¨å†²æ¯é“è·¯ï¼Œä½ çš„ç²®è‰è¡¥ç»™çº¿è¢«åˆ‡æ–­ï¼Œå†›ä¸­æ–­ç²®ä¸‰æ—¥ã€‚",
                    options: [
                        { text: "ã€å¼€ä»“æ”¾ç²®ï¼Œä¸å£«å’åŒé£Ÿã€‘", requirements: { virtue: 80 }, effects: { core_resources: { shi_qi: 20, wei_wang: 10 }, attributes: { health: -5 } }, result_text: "ä½ çš„ä¸¾åŠ¨æå¤§é¼“èˆäº†å£«æ°”ï¼Œå£«å…µä»¬æ„¿ä¸ºä½ æ­»æˆ˜ã€‚" },
                        { text: "ã€æ´¾å…µåŠ«æ é™„è¿‘æ‘åº„ã€‘", effects: { core_resources: { liang_cao: 50 }, attributes: { virtue: -20 }, flag: 'civilian_hate' }, result_text: "ä½ è§£å†³äº†ç‡ƒçœ‰ä¹‹æ€¥ï¼Œä½†å¤±å»äº†æ°‘å¿ƒï¼Œå“å¾·å¤§é™ã€‚" },
                        { text: "ã€æ´¾æ•¢æ­»é˜Ÿå¼ºè¡Œæ‰“é€šè¡¥ç»™çº¿ã€‘", effects: { core_resources: { bing_yuan: -10 } }, result_text: "ä½ æŸå¤±äº†ä¸€éƒ¨åˆ†å£«å…µï¼Œä½†æˆåŠŸæ¢å¤äº†è¡¥ç»™ã€‚" }
                    ]
                },
                {
                    title: "æ•Œå°†çš„æŒ‘æˆ˜ä¿¡",
                    desc: "æ•Œæ–¹ä¸»å°†æ´¾äººé€æ¥æŒ‘æˆ˜ä¿¡ï¼Œçº¦ä½ ä¸‰æ—¥ååœ¨é˜µå‰å•æŒ‘ã€‚",
                    options: [
                        { text: "ã€æ¬£ç„¶åº”æˆ˜ã€‘", requirements: { martial: 120 }, effects: { flag: 'duel_pending' }, result_text: "ä¸€åœºå†³å®šä¸¤å†›å£«æ°”çš„å†³æ–—å³å°†å±•å¼€ã€‚" },
                        { text: "ã€ç§°ç—…ä¸å‡ºã€‘", effects: { core_resources: { shi_qi: -15, wei_wang: -10 } }, result_text: "ä½ çš„é¿æˆ˜è¡Œä¸ºè®©å…¨å†›å£«æ°”å¤§è·Œã€‚" },
                        { text: "ã€è®¾ä¸‹åŸ‹ä¼ã€‘", requirements: { wisdom: 100 }, effects: { attributes: { virtue: -10 } }, result_text: "ä½ è®¡åˆ’åœ¨å†³æ–—åœ°ç‚¹è®¾ä¸‹åŸ‹ä¼ï¼Œæ­¤ä¸¾è™½ä¸å…‰å½©ä½†æˆ–è®¸æœ‰æ•ˆã€‚" }
                    ]
                },
                {
                    title: "ç˜Ÿç–«çš„è”“å»¶",
                    desc: "å†›ä¸­å¼€å§‹è”“å»¶ä¸€ç§å¯æ€•çš„ç–¾ç—…ï¼Œç—…å€’çš„å£«å…µè¶Šæ¥è¶Šå¤šã€‚",
                    options: [
                        { text: "ã€éš”ç¦»ç—…æ‚£ï¼Œç„šçƒ§å°¸ä½“ã€‘", requirements: { virtue: 50 }, effects: { core_resources: { bing_yuan: -20 }, attributes: { health: -10 } }, result_text: "ä½ æœæ–­çš„æªæ–½æ§åˆ¶äº†ç˜Ÿç–«ï¼Œä½†æŸå¤±äº†éƒ¨åˆ†å…µå‘˜ã€‚" },
                        { text: "ã€å‘æœå»·è¯·æ±‚ååŒ»ã€‘", effects: {}, result_text: "æœå»·å¯èƒ½ä¼šæ´¾æ¥åŒ»å®˜ï¼Œä½†è¿™éœ€è¦æ—¶é—´ã€‚" },
                        { text: "ã€éšç’ä¸æŠ¥ã€‘", effects: { core_resources: { bing_yuan: -50, shi_qi: -20 } }, result_text: "ç˜Ÿç–«å½»åº•å¤±æ§ï¼Œä½ çš„å†›é˜Ÿæˆ˜æ–—åŠ›å¤§å‡ã€‚" }
                    ]
                },
                {
                    title: "éƒ¨å°†çš„çŸ›ç›¾",
                    desc: "ä½ çš„ä¸¤ä½å¿ƒè…¹éƒ¨å°†å› æˆ˜åŠŸåˆ†é…é—®é¢˜äº§ç”Ÿæ¿€çƒˆçŸ›ç›¾ï¼Œå‡ è¿‘ç«å¹¶ã€‚",
                    options: [
                        { text: "ã€å„æ‰“äº”åå¤§æ¿ã€‘", effects: { core_resources: { shi_qi: -5 } }, result_text: "ä½ æš‚æ—¶å‹åˆ¶äº†çŸ›ç›¾ï¼Œä½†ä¸¤äººå¿ƒä¸­éƒ½æœ‰æ€¨æ°”ã€‚" },
                        { text: "ã€æŸ¥æ˜çœŸç›¸ï¼Œå…¬æ­£è£å†³ã€‘", requirements: { wisdom: 90 }, effects: { core_resources: { wei_wang: 5 } }, result_text: "ä½ çš„å…¬æ­£èµ¢å¾—äº†å…¨å†›çš„å°Šé‡ã€‚" },
                        { text: "ã€åè¢’ä¸€æ–¹ã€‘", effects: { npc_relationship: { npc_key: 'unfavored_deputy', favor: -30 } }, result_text: "ä½ å®‰æŠšäº†ä¸€æ–¹ï¼Œå´å½»åº•å¤±å»äº†å¦ä¸€ä½éƒ¨å°†çš„å¿ å¿ƒã€‚" }
                    ]
                },
                {
                    title: "å‘ç°æ•Œå†›é—´è°",
                    desc: "ä½ é€šè¿‡è››ä¸é©¬è¿¹ï¼Œå‘ç°å†›ä¸­è—æœ‰æ•Œå†›çš„é—´è°ã€‚",
                    options: [
                        { text: "ã€å…¬å¼€å¤„å†³ã€‘", effects: { core_resources: { jing_rui_du: 2 } }, result_text: "ä½ ç”¨é›·éœ†æ‰‹æ®µéœ‡æ…‘äº†å…¨å†›ï¼Œå†›çºªå¾—åˆ°æå‡ã€‚" },
                        { text: "ã€å°†è®¡å°±è®¡ï¼Œä¼ é€’å‡æƒ…æŠ¥ã€‘", requirements: { wisdom: 110 }, effects: { flag: 'false_intel_sent' }, result_text: "ä½ å¼€å§‹åˆ©ç”¨è¿™åé—´è°ï¼Œä¸ºä¸‹ä¸€æ¬¡å¤§æˆ˜å¸ƒå±€ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šå›ºå®ˆå­¤åŸ",
                trigger: { career_level: 7, text_desc: "å®˜é˜¶è¾¾åˆ°éƒ½å¸ï¼Œå¨æœ›>400", condition: (gs) => (gs.career.core_resources.wei_wang || 0) > 400 },
                desc: "ä¹Œäº‘è”½æ—¥ï¼Œé£é›ªäº¤åŠ ã€‚ä½ ç«™åœ¨å­¤åŸçš„åŸæ¥¼ä¸Šï¼Œå…³å¤–æ˜¯é»‘å‹å‹ä¸€ç‰‡ã€æœ›ä¸åˆ°å°½å¤´çš„æ•Œå›½å¤§å†›ã€‚è¿™æ˜¯å†³å®šå¸å›½åŒ—å¢ƒå‘½è¿çš„è¡€æˆ˜ã€‚",
                success: { text: "ä½ å¥‡è¿¹èˆ¬åœ°å®ˆä½äº†å­¤åŸï¼ä¸€æˆ˜æˆåï¼Œè¢«å†Œå°ä¸ºâ€œæŠ¤å›½å°†å†›â€ï¼Œå®˜é˜¶å‡ä¸ºæ€»å…µï¼Œå¹¶è·èµ[å¸…å°]ï¼", effects: { career_level_set: 8, item: { id: 'shuai_yin', amount: 1 }, attributes: { reputation: 100 } } },
                failure: { text: "å®ˆåŸå¤±è´¥ï¼ŒåŒ—å¢ƒé—¨æˆ·å¤§å¼€ï¼Œä½ è¢«å®šç½ªï¼Œæµæ”¾ä¸‰åƒé‡Œã€‚æ­¦å°†ç”Ÿæ¶¯åŸºæœ¬ç»“æŸã€‚", effects: { end_game: 'exile' } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šå¸å›½ä¹‹å£",
            level_range: [9, 10],
            goal: "æˆä¸ºå¸å›½å†›é­‚ï¼Œä½ çš„åå­—èƒ½ä»¤æ•Œå†›é—»é£ä¸§èƒ†ï¼Œä½ çš„å†³ç­–ä¸ä»…å…³ä¹æˆ˜äº‰èƒœè´Ÿï¼Œæ›´å…³ä¹å›½å®¶å‘½è¿å’ŒæƒåŠ›æ›´è¿­ã€‚",
            events: [
                {
                    title: "è®¾ç«‹ç§å±å«é˜Ÿ",
                    desc: "ä½ çš„åœ°ä½æ˜¾èµ«ï¼Œéœ€è¦ä¸€æ”¯ç»å¯¹å¿ äºä½ ä¸ªäººçš„å«é˜Ÿã€‚",
                    options: [
                        { text: "ã€ä»è¿½éšä½ å¤šå¹´çš„è€å…µä¸­é€‰æ‹”ã€‘", requirements: { wei_wang: 800 }, effects: { core_resources: { jing_rui_du: 20 }, flag: 'imperial_court_suspicion' }, result_text: "ä½ ç»„å»ºäº†ä¸€æ”¯å¿ è¯šåº¦æé«˜çš„â€œç™¾æˆ˜æ­»å£«â€ï¼Œä½†æ­¤äº‹ä¼šå¼•èµ·æœå»·çš„çŒœå¿Œã€‚" },
                        { text: "ã€ä»æ±Ÿæ¹–ä¸Šæ‹›å‹Ÿäº¡å‘½ä¹‹å¾’ã€‘", cost: { wealth: 10000 }, effects: { attributes: { virtue: -10 } }, result_text: "ä½ è·å¾—äº†ä¸€æ”¯æˆ˜æ–—åŠ›æå¼ºä½†çºªå¾‹æ¶£æ•£çš„â€œæ±Ÿæ¹–å®¢å¿â€ï¼Œä»–ä»¬èƒ½å¸®ä½ å¤„ç†ä¸€äº›â€œè„æ´»â€ã€‚" }
                    ]
                },
                {
                    title: "å¼‚æ—å…¬ä¸»çš„å’Œäº²",
                    desc: "ä¸ºäº†è¾¹å¢ƒçš„é•¿æœŸå’Œå¹³ï¼Œæœå»·å¸Œæœ›ä½ è¿å¨¶æ›¾æ˜¯æ•Œå¯¹éƒ¨è½çš„å…¬ä¸»ã€‚",
                    options: [
                        { text: "ã€ä¸ºäº†å›½å®¶ï¼Œæ¥å—è”å§»ã€‘", effects: { flag: 'horde_alliance', npc_relationship: { npc_key: 'spouse', favor: -50 } }, result_text: "ä½ ä¸è¯¥éƒ¨è½å…³ç³»å˜ä¸ºâ€œç›Ÿå‹â€ï¼Œåœ¨æœªæ¥çš„å›½æˆ˜ä¸­å¯å¬å”¤ä»–ä»¬ä½œä¸ºæ´å†›ã€‚ä½†ä½ çš„æ­£å¦»å¥½æ„Ÿå¤§é™ã€‚" },
                        { text: "ã€ä»¥å·²æœ‰å®¶å®¤ä¸ºç”±ï¼Œæ–­ç„¶æ‹’ç»ã€‘", effects: { npc_relationship: { npc_key: 'spouse', favor: 30 } }, result_text: "ä½ çš„å¿ è´èµ¢å¾—äº†å®¶äººçš„èµèµï¼Œä½†å’Œè°ˆç ´è£‚ï¼Œè¾¹å¢ƒæˆ˜ç«é‡ç‡ƒã€‚" },
                        { text: "ã€æ¨èä½ çš„å¿ƒè…¹å‰¯å°†è¿å¨¶ã€‘", effects: {}, result_text: "ä¸€ä¸ªä¸¤å…¨å…¶ç¾çš„æ–¹æ¡ˆï¼Œä½†è¯¥å‰¯å°†å°†æˆä¸ºè¯¥éƒ¨è½åœ¨å†›ä¸­çš„ä»£è¨€äººï¼Œæœªæ¥å¯èƒ½æˆä¸ºä½ çš„æ½œåœ¨å¨èƒã€‚" }
                    ]
                },
                {
                    title: "æˆ˜åŠŸå°èµçš„åˆ†é…",
                    desc: "ä¸€åœºå¤§èƒœåï¼Œæœå»·èµä¸‹å¤§ç‰‡å°åœ°å’Œçˆµä½ï¼Œç”±ä½ æ¥åˆ†é…ã€‚",
                    options: [
                        { text: "ã€ä¼˜å…ˆå°èµå¿ƒè…¹å°†é¢†ã€‘", effects: { core_resources: { shi_qi: -5 } }, result_text: "ä½ çš„æ ¸å¿ƒå›¢é˜Ÿå¿ è¯šåº¦çˆ†è¡¨ï¼Œæˆä¸ºç‰¢ä¸å¯ç ´çš„å†›äº‹é›†å›¢ã€‚ä½†æ™®é€šå£«å…µä¼šæ„Ÿåˆ°ä¸å…¬ã€‚" },
                        { text: "ã€å°†å¤§éƒ¨åˆ†åœŸåœ°åˆ†ç»™é˜µäº¡å£«å…µå®¶å±ã€‘", effects: { core_resources: { wei_wang: 50, shi_qi: 20 }, attributes: { virtue: 20 } }, result_text: "ä½ åœ¨å†›ä¸­è¢«èª‰ä¸ºâ€œä»å¸…â€ï¼Œå¨æœ›å’Œå“å¾·è¾¾åˆ°é¡¶å³°ï¼Œå…¨å†›å£«æ°”é«˜æ¶¨ã€‚ä½†ä½ çš„å¿ƒè…¹å°†é¢†ä¼šè§‰å¾—ä½ â€œä¸å¤Ÿæ„æ€â€ã€‚" },
                        { text: "ã€ä¸ºè‡ªå·±çš„å®¶æ—è°‹å–æœ€å¤§åˆ©ç›Šã€‘", effects: { core_resources: { wei_wang: -30 }, attributes: { virtue: -20 } }, result_text: "ä½ çš„å®¶æ—è·å¾—å¤§é‡åœŸåœ°å’Œè´¢å¯Œï¼Œä½†ä½ åœ¨å†›ä¸­çš„å¨æœ›å’Œå“å¾·å¤§å¹…ä¸‹é™ã€‚" }
                    ]
                },
                {
                    title: "æ¥è‡ªäº¬åŸçš„â€œæ©èµâ€",
                    desc: "çš‡å¸æ´¾äººé€æ¥ç¾é…’ä½³è‚´ï¼Œå¹¶â€œå…³å¿ƒâ€åœ°è¯¢é—®ä½ çš„å¥åº·çŠ¶å†µã€‚",
                    options: [
                         { text: "ã€ç«‹åˆ»ä¸Šè¡¨ç§°ç—…ï¼Œè¯·æ±‚å›äº¬ä¼‘å…»ã€‘", effects: { career_status: 'retired' }, result_text: "è¿™æ˜¯â€œæ¯é…’é‡Šå…µæƒâ€çš„ä¿¡å·ã€‚ä½ é€‰æ‹©æ”¾æƒï¼Œä¿å…¨äº†å¯Œè´µã€‚æ­¦å°†ç”Ÿæ¶¯ç»“æŸï¼Œè¿›å…¥åŠé€€ä¼‘çŠ¶æ€ã€‚" },
                         { text: "ã€å›ä¿¡ç§°å°†åœ¨å¤–å›å‘½æœ‰æ‰€ä¸å—ã€‘", effects: { flag: 'imperial_rebellion_imminent' }, result_text: "ä½ ä¸çš‡å¸çš„å…³ç³»å½»åº•ç ´è£‚ï¼Œè¿›å…¥é«˜åº¦ç´§å¼ çŠ¶æ€ï¼Œäººç”Ÿè½¬æŠ˜ç‚¹å°†è¢«ç«‹åˆ»è§¦å‘ã€‚" }
                    ]
                },
                {
                    title: "å…µä¹¦çš„æ’°å†™",
                    desc: "æˆé©¬ä¸€ç”Ÿï¼Œä½ å†³å®šå°†è‡ªå·±çš„ç”¨å…µå¿ƒå¾—è‘—ä¹¦ç«‹è¯´ã€‚",
                    options: [
                        { text: "ã€èŠ±è´¹ä¸€å¹´æ—¶é—´ï¼Œå€¾å¿ƒæ’°å†™ã€‘", getOutcome: (gs) => {
                            if(gs.player.attributes.wisdom > 120 && gs.player.attributes.martial > 150) {
                                return {text: "ä½ æˆåŠŸå†™å‡ºäº†æ—·ä¸–å…µä¹¦ï¼", effects: {item: {id:'wu_mu_bing_fa', amount: 1}}};
                            }
                            return {text: "ä½ å†™çš„å…µä¹¦æ¼æ´ç™¾å‡ºï¼Œè¢«å…µå®¶è€»ç¬‘ã€‚", effects: {core_resources: {wei_wang: -20}}};
                        }}
                    ]
                },
                {
                    title: "å…”æ­»ç‹—çƒ¹",
                    desc: "å¤©ä¸‹å¤ªå¹³ï¼Œçš‡å¸å¼€å§‹è£æ’¤å†›é˜Ÿï¼Œä½ çš„å…µæƒè¢«å¤§å¹…å‰Šå‡ã€‚",
                    options: [
                        { text: "ã€ä¸»åŠ¨ä¸Šäº¤å…µæƒã€‘", effects: { career_status: 'retired' }, result_text: "ä½ ä»¥é€€ä¸ºè¿›ï¼Œæ‰“æ¶ˆäº†çš‡å¸çš„ç–‘å¿ƒï¼Œè¢«å°ä¸ºè™šèŒå›½å…¬ï¼Œå®‰äº«æ™šå¹´ã€‚" },
                        { text: "ã€æš—ä¸­æŠµåˆ¶ï¼Œä¿ç•™å®åŠ›ã€‘", effects: { flag: 'military_tension' }, result_text: "ä½ ä¸æœå»·çš„å…³ç³»å˜å¾—ç´§å¼ ï¼Œçš‡å¸å¯¹ä½ çš„çŒœå¿Œä¸æ—¥ä¿±å¢ã€‚" }
                    ]
                },
                {
                    title: "è¾¹æ‚£å†èµ·",
                    desc: "å·²ç»å½’éšçš„ä½ ï¼Œå¬é—»è¾¹å…³å†æ¬¡ç‡ƒèµ·æˆ˜ç«ï¼Œæœä¸­æ— äººèƒ½æ•Œã€‚",
                    options: [
                        { text: "ã€ä¸Šä¹¦è¯·æ±‚æŒ‚å¸…å‡ºå¾ã€‘", getOutcome: (gs) => {
                            if ((gs.npcs['emperor']?.favor || 0) > 30) {
                                return { text: "çš‡å¸å‡†å¥ï¼Œä½ å°†å†æ¬¡æŠ«ç”²ä¸Šé˜µï¼", effects: { career_status: 'active' } };
                            }
                            return { text: "çš‡å¸é©³å›äº†ä½ çš„è¯·æ±‚ï¼Œå®æ„¿å‰²åœ°èµ”æ¬¾ä¹Ÿä¸æ„¿å†è®©ä½ æ‰‹æ¡å…µæƒã€‚", effects: {} };
                        }}
                    ]
                },
                {
                    title: "å…»å­ä¸äº²å­",
                    desc: "ä½ å‹‡çŒ›çš„å…»å­ä¸ä½ æ‰åæ¨ªæº¢çš„äº²ç”Ÿå„¿å­ï¼Œéƒ½å¸Œæœ›èƒ½æˆä¸ºä½ çš„ç»§æ‰¿äººã€‚",
                    options: [
                        { text: "ã€ç«‹äº²ç”Ÿå„¿å­ä¸ºç»§æ‰¿äººã€‘", effects: { npc_relationship: { npc_key: 'adopted_son', favor: -50 } }, result_text: "ä½ çš„å…»å­æ„Ÿåˆ°æ— æ¯”å¤±æœ›ï¼Œå¯èƒ½ä¼šç¦»å¼€ä½ ã€‚" },
                        { text: "ã€ç«‹å…»å­ä¸ºç»§æ‰¿äººã€‘", effects: { npc_relationship: { npc_key: 'biological_son', favor: -50 } }, result_text: "ä½ çš„äº²ç”Ÿå„¿å­æ„Ÿåˆ°è¢«æŠ›å¼ƒï¼Œä¸ä½ äº§ç”Ÿéš”é˜‚ã€‚" },
                        { text: "ã€è®©ä»–ä»¬å…¬å¹³ç«äº‰ã€‘", effects: {}, result_text: "ä¸€ä¸ªè€ƒéªŒä½ æ™ºæ…§çš„é•¿æœŸæŒ‘æˆ˜å¼€å§‹äº†ã€‚" }
                    ]
                },
                {
                    title: "æœ€åçš„ç»ƒå…µ",
                    desc: "ä½ å°†è‡ªå·±æœ€åçš„å¿ƒå¾—ä¼ æˆç»™ä½ æœ€ç²¾é”çš„éƒ¨é˜Ÿã€‚",
                    options: [
                        { text: "ã€ä¼ æˆâ€œé™·é˜µä¹‹å¿—â€ã€‘", effects: { core_resources: { jing_rui_du: 10, shi_qi: 5 } }, result_text: "ä½ çš„éƒ¨é˜Ÿè·å¾—äº†â€œé™·é˜µâ€ç‰¹æ€§ï¼Œåœ¨æ”»åŸæˆ˜ä¸­æ‹¥æœ‰å·¨å¤§ä¼˜åŠ¿ã€‚" },
                        { text: "ã€ä¼ æˆâ€œä¸åŠ¨å¦‚å±±â€ã€‘", effects: { core_resources: { jing_rui_du: 10, shi_qi: 5 } }, result_text: "ä½ çš„éƒ¨é˜Ÿè·å¾—äº†â€œä¸åŠ¨â€ç‰¹æ€§ï¼Œåœ¨å®ˆåŸæˆ˜ä¸­åšä¸å¯æ‘§ã€‚" }
                    ]
                },
                {
                    title: "æ•…äººæ¥è®¿",
                    desc: "ä¸€ä½æ—©å·²è§£ç”²å½’ç”°çš„è€éƒ¨ä¸‹ï¼Œä¸è¿œåƒé‡Œå‰æ¥æ¢æœ›ä½ ã€‚",
                    options: [
                        { text: "ã€ä¸å…¶å½»å¤œé•¿è°ˆã€‘", effects: { core_resources: { wei_wang: 10 }, attributes: { virtue: 5 } }, result_text: "ä½ ä»¬å›å¿†å¾€æ˜”å³¥åµ˜å²æœˆï¼Œæ„Ÿæ…¨ä¸‡åƒã€‚ä½ ä»ä¹‰å¾…äººçš„åå£°å†æ¬¡è¿œæ’­ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šé¾™æ¤…ä¹‹å‰",
                trigger: { career_level: 10, text_desc: "å®˜é˜¶è¾¾åˆ°å¤§éƒ½ç£ï¼Œä¸”ä¸çš‡å¸å…³ç³»ç ´è£‚", condition: (gs) => (gs.flags.imperial_rebellion_imminent) },
                desc: "åŠŸé«˜éœ‡ä¸»ï¼Œé¸Ÿå°½å¼“è—ã€‚ä½ æ‰‹æ¡å¸å›½æœ€ç²¾é”çš„å†›é˜Ÿï¼Œæ˜¯é€‰æ‹©æˆä¸ºæ‹¯æ•‘ç‹æœçš„å¿ è‡£ï¼Œè¿˜æ˜¯å¼€åˆ›è‡ªå·±ç‹æœçš„æ­é›„ï¼Ÿ",
                success: { text: "ä½ é€‰æ‹©äº†â€œæ¸…å›ä¾§â€ï¼Œé»„è¢åŠ èº«ï¼Œç™»åŸºä¸ºå¸ï¼Œå¼€åˆ›äº†æ–°çš„ç‹æœï¼", effects: { end_game: 'emperor' } },
                failure: { text: "ä½ é€‰æ‹©æ”¾ä¸‹å…µæƒï¼Œä»¥æ¢å–çš‡å¸çš„ä¿¡ä»»ã€‚ä½ è¢«å°ä¸ºå¼‚å§“ç‹ï¼Œä½†ä»æ­¤è¿œç¦»æƒåŠ›ä¸­å¿ƒï¼Œåšä¸€ä¸ªå¯Œè´µé—²äººã€‚", effects: { end_game: 'peaceful_retirement' } }
            }
        }
    ]
},
'merchant': {
    name: "å•†è´¾",
    icon: "fa-store-alt",
    gender: "male",
    core_resources: ["ben_jin", "xin_yu", "shang_lu", "qing_bao"],
    dashboard_name: "å•†è¡Œè´¦æœ¬",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šå´­éœ²å¤´è§’",
            level_range: [1, 4],
            goal: "å­¦ä¼šç»å•†çš„åŸºæœ¬æ‰‹è…•ï¼Œç§¯ç´¯ç¬¬ä¸€æ¡¶é‡‘ï¼Œåœ¨äº¬åŸå•†åœˆä¸­å»ºç«‹æœ€åˆçš„â€œä¿¡èª‰â€ã€‚",
            events: [
                {
                    title: "åœ°ç—çš„â€œä¿æŠ¤è´¹â€",
                    desc: "ä½ çš„å°åº—é“ºå¼€å¼ ä¸ä¹…ï¼Œå‡ ä¸ªåœ°ç—æµæ°“å‰æ¥æ”¶å–â€œä¿æŠ¤è´¹â€ã€‚",
                    options: [
                        { text: "ã€ç ´è´¢æ¶ˆç¾ã€‘", cost: { wealth: 300 }, effects: { core_resources: { xin_yu: -5 } }, result_text: "ä½ æš‚æ—¶è·å¾—äº†å®‰å®ï¼Œä½†æ­¤äº‹ä¼ å¼€ï¼Œäººäººéƒ½è§‰å¾—ä½ å¥½æ¬ºè´Ÿã€‚ä¸‹ä¸ªå­£åº¦ä»–ä»¬ä¼šè¦æ±‚æ›´å¤šã€‚" },
                        { 
                            text: "ã€æŠ¥å®˜å¤„ç†ã€‘", 
                            getOutcome: (gs) => {
                                // å‡è®¾å­˜åœ¨ä¸€ä¸ªä¸å®˜åºœçš„å…³ç³»å€¼
                                if ((gs.social.government_favor || 0) > 10) {
                                    return { text: "å®˜åºœæ´¾äººé©±é€äº†åœ°ç—ï¼Œä½ ä¸è¯¥åŒºåŸŸè¡™å½¹å¥½æ„Ÿ+10ã€‚", effects: { social_favor: { group: 'constables', change: 10 } } };
                                } else {
                                    return { text: "å®˜åºœæ•·è¡äº†äº‹ï¼Œåœ°ç—çš„æŠ¥å¤å˜æœ¬åŠ å‰ï¼Œä½ çš„åº—é“ºè¢«éªšæ‰°ï¼ŒæŸå¤±äº†200ä¸¤ã€‚", effects: { wealth: -200 } };
                                }
                            }
                        },
                        { text: "ã€é›‡ä½£æ‰“æ‰‹ã€‘", cost: { wealth: 500 }, effects: { }, result_text: "ä½ é›‡ä½£çš„æ‰“æ‰‹å°†åœ°ç—æ‰“è·‘ï¼Œä¸€åŠ³è€Œé€¸ã€‚ä½ è·å¾—â€œæ‰‹æ®µå¼ºç¡¬â€çš„åå£°ï¼Œè¯¥åŒºåŸŸæ— äººå†æ•¢éªšæ‰°ã€‚" }
                    ]
                },
                {
                    title: "æ”¶åˆ°ä¼ªé€ çš„é“¶ç¥¨",
                    desc: "åœ¨ä¸€æ¬¡ç¹å¿™çš„äº¤æ˜“ä¸­ï¼Œä½ æ”¶åˆ°äº†ä¸€å¼ éš¾ä»¥åˆ†è¾¨çœŸä¼ªçš„å¤§é¢é“¶ç¥¨ã€‚",
                    options: [
                        { text: "ã€è‡ªè®¤å€’éœ‰ï¼Œé”€æ¯é“¶ç¥¨ã€‘", effects: { wealth: -500, core_resources: { xin_yu: 10 }, attributes: { virtue: 5 } }, result_text: "ä½ æŸå¤±äº†è¿™ç¬”é’±ï¼Œä½†ä¿ä½äº†åå£°ã€‚" },
                        { 
                            text: "ã€æƒ³åŠæ³•èŠ±å‡ºå»ã€‘", 
                            getOutcome: (gs) => {
                                if (gs.player.attributes.wisdom > 60 || (gs.player.attributes.wisdom > 40 && Math.random() < 0.5)) {
                                    return { text: "ä½ æˆåŠŸåœ°å°†ä¼ªé’ç”¨åœ¨äº†åŸæ–™é‡‡è´­ä¸Šï¼Œæ— äººå‘è§‰ã€‚", effects: { attributes: { wisdom: 2, virtue: -10 } } };
                                } else {
                                    return { text: "è¢«å½“åœºè¯†ç ´ï¼Œä½ çš„åº—é“ºè¢«è®¤ä¸ºâ€œå”®å‡â€ï¼Œä¿¡èª‰å¤§è·Œã€‚", effects: { core_resources: { xin_yu: -30 }, attributes: { reputation: -10 } } };
                                }
                            }
                        }
                    ]
                },
                {
                    title: "è€æŒæŸœçš„æç‚¹",
                    desc: "ä¸€ä½ç»éªŒä¸°å¯Œçš„è€æŒæŸœï¼Œåœ¨èŒ¶é¦†é‡Œå¯¹ä½ æœ€è¿‘çš„å‡ ç¬”ç”Ÿæ„è¿›è¡Œäº†ç‚¹è¯„ã€‚",
                    options: [
                        { text: "ã€è™šå¿ƒè¯·æ•™ã€‘", effects: { flag: 'unlock_skill_careful_storage', npc_relationship: { npc_key: 'old_manager', favor: 20 } }, result_text: "è€æŒæŸœå¯¹ä½ çš„è°¦é€Šé¢‡ä¸ºæ¬£èµï¼Œå‘ä½ ä¼ æˆäº†â€œè´§ç‰©å‚¨å­˜â€çš„è¯€çªï¼ˆæ°¸ä¹…è¢«åŠ¨ï¼šå•†å“æŸè€—ç‡é™ä½5%ï¼‰ã€‚" },
                        { text: "ã€èµ é€[ä¸Šç­‰èŒ¶å¶]ã€‘", requirements: { has_item: 'shang_deng_cha_ye' }, effects: { item: { id: 'jiang_nan_gong_huo_shang', amount: 1 } }, result_text: "è€æŒæŸœéå¸¸é«˜å…´ï¼Œä¸ä»…ä¼ æˆä½ ç»éªŒï¼Œè¿˜ä¸ºä½ ä»‹ç»äº†ä¸€ä¸ªæ–°çš„[æ±Ÿå—ä¾›è´§å•†åå½•]ï¼Œè§£é”äº†éšè—çš„ä½ä»·è¿›è´§æ¸ é“ã€‚" }
                    ]
                },
                {
                    title: "å‘ç°æ–°çš„è´§æº",
                    desc: "ä¸€ä½æ¥è‡ªèœ€åœ°çš„è¡Œè„šå•†å‘ä½ å…œå”®ä¸€æ‰¹è´¨åœ°æ–°é¢–çš„èœ€é”¦ï¼Œä½†ä»·æ ¼ä¸è²ã€‚",
                    options: [
                        { text: "ã€æŠ•å…¥æœ¬é‡‘ï¼Œå…¨éƒ¨åƒä¸‹ã€‘", cost: { wealth: 1000 }, effects: { wealth: 1500, flag: 'shudi_trader_contact' }, result_text: "è¿™æ‰¹èœ€é”¦åœ¨äº¬åŸå¤§å—æ¬¢è¿ï¼Œä½ å¤§èµšä¸€ç¬”ã€‚ä½ ä¸è¿™ä½è¡Œè„šå•†å»ºç«‹äº†è”ç³»ï¼Œæœ‰å‡ ç‡åœ¨æœªæ¥å¼€å¯â€œèœ€åœ°å•†è·¯â€ã€‚" },
                        { text: "ã€è°¨æ…è¯•æ¢ï¼Œåªä¹°æ ·å“ã€‘", cost: { wealth: 100 }, effects: { wealth: 50 }, result_text: "æ ·å“è®©ä½ å°èµšä¸€ç¬”ï¼Œä½†ä¹Ÿé”™è¿‡äº†æœ€å¤§çš„åˆ©æ¶¦ã€‚" }
                    ]
                },
                {
                    title: "ç¬¬ä¸€æ¬¡é•¿é€”è¿è´§",
                    desc: "ä½ éœ€è¦äº²è‡ªæŠ¼é€ä¸€æ‰¹è´§ç‰©åˆ°é‚»è¿‘çš„å·åºœã€‚",
                    options: [
                        { text: "ã€é›‡ä½£æœ€ä¾¿å®œçš„é•–å±€ã€‘", getOutcome: (gs) => {
                            if (Math.random() < 0.5) {
                                return { text: "è·¯ä¸Šé­é‡åŠ«åŒªï¼Œä½ çš„è´§ç‰©å’Œæœ¬é‡‘å…¨éƒ¨æŸå¤±ï¼", effects: { wealth: -gs.finances.wealth } }; // å‡è®¾æŸå¤±å…¨éƒ¨
                            }
                            return { text: "è™½ç„¶ä¸€è·¯æå¿ƒåŠèƒ†ï¼Œä½†æ€»ç®—å®‰å…¨æŠµè¾¾ã€‚", effects: {} };
                        }},
                        { text: "ã€é›‡ä½£æœ€è´µçš„[æŒ¯è¿œé•–å±€]ã€‘", cost: { wealth: 500 }, effects: { core_resources: { xin_yu: 5 } }, result_text: "è·¯ä¸Šç»å¯¹å®‰å…¨ï¼Œä½†åˆ©æ¶¦ä¹Ÿç›¸åº”é™ä½ã€‚" },
                        { text: "ã€è·Ÿéšå…¶ä»–å¤§å•†é˜Ÿä¸€èµ·èµ°ã€‘", requirements: { npc_favor_above: { npc_key: 'merchant_friend', favor: 30 } }, effects: { npc_relationship: { npc_key: 'merchant_friend', favor: 10 } }, result_text: "ä½ å®‰å…¨æŠµè¾¾ï¼Œå¹¶åŠ æ·±äº†ä¸è¯¥å•†äººçš„å…³ç³»ã€‚" }
                    ]
                },
                {
                    title: "å›¤ç§¯å±…å¥‡",
                    desc: "å› å¤©æ°”åŸå› ï¼ŒåŸä¸­çš„ç±³ä»·å¼€å§‹ä¸Šæ¶¨ï¼Œä½ ä»“åº“é‡Œè¿˜æœ‰ä¸€æ‰¹é™ˆç±³ã€‚",
                    options: [
                        { text: "ã€ç«‹å³å¹³ä»·å‡ºå”®ã€‘", effects: { wealth: 100, core_resources: { xin_yu: 10 }, attributes: { virtue: 5 } }, result_text: "ä½ è·å¾—äº†å¾®è–„çš„åˆ©æ¶¦å’Œè‰¯å¥½çš„ä¿¡èª‰ã€‚" },
                        { text: "ã€ç­‰å¾…ä»·æ ¼æœ€é«˜ç‚¹å†å‡ºå”®ã€‘", getOutcome: (gs) => {
                            if (Math.random() < 0.7) {
                                return { text: "ä½ èµŒå¯¹äº†æ—¶æœºï¼Œå¤§èµšä¸€ç¬”ï¼", effects: { wealth: 1000, attributes: { virtue: -5 } } };
                            }
                            return { text: "å®˜åºœçªç„¶å¼€ä»“æ”¾ç²®ï¼Œç±³ä»·æš´è·Œï¼Œä½ è¡€æœ¬æ— å½’ã€‚", effects: { wealth: -300 } };
                        }}
                    ]
                },
                {
                    title: "å­¦å¾’çš„å»ºè®®",
                    desc: "ä½ åº—é‡Œçš„ä¸€ä¸ªå°å­¦å¾’ï¼Œå‘ä½ æå‡ºäº†ä¸€ä¸ªå…³äºåº—é“ºé™ˆåˆ—çš„å»ºè®®ã€‚",
                    options: [
                        { text: "ã€é‡‡çº³å¹¶å¥–åŠ±ã€‘", effects: { core_resources: { xin_yu: 5 }, attributes: { charm: 2 } }, result_text: "æ–°çš„é™ˆåˆ—æ–¹å¼æœç„¶å¸å¼•äº†æ›´å¤šé¡¾å®¢ã€‚ä½ çš„å¼€æ˜è®©å­¦å¾’ä»¬æ›´åŠ å¿ å¿ƒã€‚" },
                        { text: "ã€ä¸äºˆç†ä¼šã€‘", effects: {}, result_text: "ä½ è®¤ä¸ºä¸€ä¸ªå­¦å¾’æ‡‚ä»€ä¹ˆï¼Œé”™å¤±äº†ä¸€ä¸ªæ”¹è¿›çš„æœºä¼šã€‚" }
                    ]
                },
                {
                    title: "å•†ä¼šå…¥é—¨",
                    desc: "æœ¬åœ°å•†ä¼šé‚€è¯·ä½ å‚åŠ å…¥ä¼šæ™šå®´ï¼Œä½ éœ€è¦ç¼´çº³ä¼šè´¹ã€‚",
                    options: [
                        { text: "ã€ç¼´çº³ä¼šè´¹ï¼Œæ­£å¼å…¥ä¼šã€‘", cost: { wealth: 500 }, effects: { flag: 'guild_member', social: 'expand' }, result_text: "ä½ æˆåŠŸåŠ å…¥å•†ä¼šï¼Œè·å¾—äº†æ›´å¤šçš„äººè„‰å’Œæƒ…æŠ¥æ¥æºã€‚" },
                        { text: "ã€è®¤ä¸ºä¸å€¼ï¼Œæ‹’ç»åŠ å…¥ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©å•æ‰“ç‹¬æ–—ï¼Œä½†ä¹Ÿå¤±å»äº†åº‡æŠ¤å’Œæœºä¼šã€‚" }
                    ]
                },
                {
                    title: "ç¬¬ä¸€ç¬”è´·æ¬¾",
                    desc: "ä½ çœ‹åˆ°äº†ä¸€ä¸ªæå¥½çš„æœºä¼šï¼Œä½†æœ¬é‡‘ä¸è¶³ï¼Œéœ€è¦å‘é’±åº„è´·æ¬¾ã€‚",
                    options: [
                        { text: "ã€è´·æ¬¾ä¸€åƒä¸¤ã€‘", effects: { wealth: 1000, flag: 'debt_1000' }, result_text: "ä½ è·å¾—äº†èµ„é‡‘ï¼Œä½†éœ€è¦åœ¨å¹´åº•å‰è¿æœ¬å¸¦åˆ©å¿è¿˜ã€‚" },
                        { text: "ã€æ”¾å¼ƒæœºä¼šã€‘", effects: {}, result_text: "ä½ é€‰æ‹©äº†ç¨³å¦¥ï¼Œä½†ä¹Ÿé”™å¤±äº†å‘å±•çš„è‰¯æœºã€‚" }
                    ]
                },
                {
                    title: "ç«äº‰å¯¹æ‰‹çš„æŒ‘è¡…",
                    desc: "å¯¹å®¶åº—é“ºçš„æŒæŸœåœ¨é…’æ¥¼é‡Œå…¬ç„¶å˜²è®½ä½ çš„ç”Ÿæ„â€œå°æ‰“å°é—¹â€ã€‚",
                    options: [
                        { text: "ã€ä¸€ç¬‘ç½®ä¹‹ã€‘", effects: { attributes: { wisdom: 2 } }, result_text: "ä½ çš„æ°”åº¦è®©æ—è§‚è€…æš—è‡ªç‚¹å¤´ã€‚" },
                        { text: "ã€å”‡æªèˆŒå‰‘ï¼Œå½“åœºåå‡»ã€‘", requirements: { charm: 50 }, effects: { core_resources: { xin_yu: 5 } }, result_text: "ä½ å·§å¦™åœ°åå‡»ï¼Œæ—¢ç»´æŠ¤äº†è‡ªå®¶å£°èª‰ï¼Œåˆè®©å¯¹æ–¹ä¸‹ä¸æ¥å°ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šé¦–æ¬¡ç‹¬ç«‹è¡Œå•†",
                trigger: { career_level: 3, text_desc: "æˆä¸ºæŒæŸœ, æœ¬é‡‘>5000, ä¿¡èª‰>50", condition: (gs) => (gs.career.core_resources.ben_jin || gs.finances.wealth) > 5000 && (gs.career.core_resources.xin_yu || 0) > 50 },
                desc: "ä½ ç«™åœ¨ç å¤´ä¸Šï¼Œèº«åæ˜¯æ»¡è½½è´§ç‰©çš„éª¡é©¬é˜Ÿã€‚æ±Ÿå—çš„å¯Œåº¶åœ¨å¬å”¤ä½ ï¼Œä½†å‰è·¯æ¼«æ¼«ï¼Œå……æ»¡äº†æœªçŸ¥çš„é£é™©ã€‚è¿™æ˜¯ä½ ä»â€œåå•†â€åˆ°â€œè¡Œå•†â€çš„ç¬¬ä¸€æ¬¡èœ•å˜ã€‚",
                success: { text: "ä½ æˆåŠŸå®Œæˆé¦–æ¬¡è¡Œå•†ï¼Œåˆ©æ¶¦ä¸°åšï¼æœ€é‡è¦çš„æ˜¯ï¼Œä½ æ‰“é€šäº†å…³ç³»ï¼Œæ­£å¼è§£é”äº†ã€å•†è·¯ã€‘ç³»ç»Ÿï¼è·å¾—ç¬¬ä¸€æ¡[å•†è·¯]ï¼šäº¬åŸ-æ±Ÿå—ã€‚", effects: { wealth: 3000, flag: 'unlock_trade_routes', core_resources: { shang_lu: 1 } } },
                failure: { text: "è´§ç‰©æŸå¤±æƒ¨é‡ï¼Œæœ¬é‡‘å¤§äºï¼Œä½ å‡ ä¹ç ´äº§ã€‚", effects: { wealth: -4000 } }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šä¸­æµç ¥æŸ±",
            level_range: [5, 7],
            goal: "æ‰©å¤§å•†ä¸šç‰ˆå›¾ï¼Œé€šè¿‡ä¿¡æ¯å’Œèµ„æœ¬ä¼˜åŠ¿å‡»è´¥ç«äº‰å¯¹æ‰‹ï¼Œå¼€å§‹å°†å•†ä¸šå½±å“åŠ›è½¬åŒ–ä¸ºç¤¾ä¼šåœ°ä½ã€‚",
            events: [
                {
                    title: "å¯¹æ‰‹çš„æ¶æ„ç«äº‰",
                    desc: "ä½ çš„å®¿æ•Œã€å››æµ·å•†è¡Œã€‘åœ¨ä½ çš„åº—é“ºå¯¹é¢å¼€äº†ä¸€å®¶åˆ†åº—ï¼Œå¹¶ä»¥ä½äºä½ æˆæœ¬ä»·çš„ä»·æ ¼å€¾é”€åŒç±»å•†å“ï¼",
                    options: [
                        { text: "ã€è·Ÿè¿›ä»·æ ¼æˆ˜ï¼Œè¡€æ‹¼åˆ°åº•ã€‘", cost: { wealth: 10000 }, getOutcome: (gs) => {
                            // å‡è®¾å››æµ·å•†è¡Œè´¢åŠ›ä¸º15000
                            if (gs.finances.wealth > 15000) {
                                return { text: "ä½ çš„è´¢åŠ›æ›´èƒœä¸€ç­¹ï¼Œã€å››æµ·å•†è¡Œã€‘èµ„é‡‘æ–­è£‚ï¼Œå®£å‘Šç ´äº§ï¼ä½ å¤§è·å…¨èƒœã€‚", effects: { wealth: 5000, attributes: { reputation: 20 } } };
                            }
                            return { text: "ä»·æ ¼æˆ˜è€—å°½äº†ä½ çš„èµ„é‡‘ï¼Œä½ è¢«è¿«å®£å‘Šç ´äº§...", effects: { end_game: 'bankruptcy' } };
                        }},
                        { text: "ã€æ¨å‡ºç‹¬å®¶æ–°å“ã€‘", requirements: { has_item_type: 'ææ–™' }, effects: { attributes: { reputation: 30 } }, result_text: "ä½ ç”¨â€œäººæ— æˆ‘æœ‰â€çš„å•†å“å¸å¼•äº†æ‰€æœ‰é«˜ç«¯å®¢æˆ·ï¼Œã€å››æµ·å•†è¡Œã€‘çš„ä½ä»·ç­–ç•¥æ— äººé—®æ´¥ã€‚ä½ å¤§è·å…¨èƒœï¼" },
                        { text: "ã€é‡œåº•æŠ½è–ªï¼Œä¹°æ–­å…¶ä¾›è´§æºã€‘", cost: { wealth: 8000 }, effects: {}, result_text: "ä½ æˆåŠŸä¹°æ–­äº†ä»–ä»¬çš„è´§æºï¼Œã€å››æµ·å•†è¡Œã€‘æ— è´§å¯å–ï¼Œä¸æˆ˜è‡ªè´¥ã€‚ä½ æˆåŠŸåœ°æ•´åˆäº†äº§ä¸šé“¾ã€‚" }
                    ]
                },
                {
                    title: "å•†è·¯é‡é™©",
                    desc: "ä½ æœ€é‡è¦çš„[äº¬åŸ-æ±Ÿå—]å•†è·¯ï¼Œå› æ²¿é€”çˆ†å‘åŒªä¹±è€Œä¸­æ–­ã€‚",
                    options: [
                         { text: "ã€èŠ±è´¹é‡é‡‘ï¼Œè¯·æ±‚å®˜åºœå‰¿åŒªã€‘", cost: { wealth: 5000 }, effects: { social_favor: { group: 'government', change: 10 } }, result_text: "æ•°æœˆåå•†è·¯æ¢å¤ï¼Œä½ ä»˜å‡ºäº†å·¨å¤§çš„é‡‘é’±æˆæœ¬ï¼Œä½†è·å¾—äº†å®˜åºœäººè„‰ã€‚" },
                         { text: "ã€ä¸åŒªé¦–è°ˆåˆ¤ï¼Œäº¤ä¹°è·¯é’±ã€‘", cost: { wealth: 2000 }, effects: { attributes: { virtue: -10 } }, result_text: "ä½ ç”¨é’±æ¢å–äº†æš‚æ—¶çš„å’Œå¹³ï¼Œå•†è·¯æ¢å¤ã€‚ä½†åŒªé¦–æœªæ¥ä¼šä¸æ–­å‹’ç´¢ã€‚" },
                         { text: "ã€äº²è‡ªæ‹›å‹ŸæŠ¤å«ï¼Œæ‰“é€šå•†è·¯ã€‘", cost: { wealth: 6000 }, effects: { core_resources: { wei_wang: 20 }, flag: 'unlock_private_escort' }, result_text: "ä½ å»ºç«‹äº†è‡ªå·±çš„ç§äººæ­¦è£…ï¼Œä¸ä»…æ‰“é€šäº†å•†è·¯ï¼Œè¿˜è·å¾—äº†å‘¨è¾¹å•†æˆ·çš„å°Šæ•¬ï¼Œè§£é”äº†â€œç§äººé•–å±€â€ä¸šåŠ¡ã€‚" }
                    ]
                },
                {
                    title: "ä¸è¥¿åŸŸå•†äººçš„äº¤æ˜“",
                    desc: "ä¸€ä½æ»¡è„¸é£éœœçš„è¥¿åŸŸå•†äººï¼Œå¸¦æ¥ä¸€æ‰¹é—»æ‰€æœªé—»çš„è´§ç‰©ï¼Œæ¯”å¦‚â€œç‰ç’ƒâ€å’Œâ€œé¦™æ–™â€ã€‚",
                    options: [
                        { text: "ã€è§†å…¶ä¸ºéª—å­ï¼Œèµ¶èµ°ã€‘", effects: {}, result_text: "ä½ å°†ä»–èµ¶èµ°ï¼Œæ— äº‹å‘ç”Ÿã€‚" },
                        { text: "ã€è°¨æ…åœ°äº¤æ˜“å°‘é‡è´§ç‰©ã€‘", cost: { wealth: 500 }, effects: { wealth: 800 }, result_text: "è¿™æ‰¹è´§ç‰©åœ¨äº¬åŸå¤§å—æ¬¢è¿ï¼Œä½ èµšäº†ä¸€ç¬”ï¼Œå¹¶ä¸è¥¿åŸŸå•†äººå»ºç«‹äº†åˆæ­¥è”ç³»ã€‚" },
                        { text: "ã€æ‹›å¾…è¯¥å•†äººï¼Œæ¢å¬è¥¿åŸŸæƒ…æŠ¥ã€‘", requirements: { charm: 100 }, cost: { wealth: 200 }, effects: { item: { id: 'si_chou_zhi_lu_can_pian', amount: 1 } }, result_text: "ä½ ä¸ä»…è·å¾—äº†ç‹¬å®¶è´§æºï¼Œè¿˜ä»ä»–å£ä¸­å¾—çŸ¥äº†[ä¸ç»¸ä¹‹è·¯åœ°å›¾æ®‹ç‰‡]ï¼Œå¼€å¯äº†é€šå¾€è¥¿åŸŸçš„å²è¯—ä»»åŠ¡çº¿ã€‚" }
                    ]
                },
                {
                    title: "æŠ•èµ„æ–°çš„å‘æ˜",
                    desc: "ä¸€ä½è½é­„çš„å·¥åŒ å‘ä½ å±•ç¤ºäº†ä»–æ”¹è‰¯çš„â€œæ–°å¼çººè½¦â€ï¼Œå£°ç§°èƒ½è®©ç»‡å¸ƒæ•ˆç‡æå‡ä¸‰å€ï¼Œå¸Œæœ›è·å¾—ä½ çš„æŠ•èµ„ã€‚",
                    options: [
                        { text: "ã€è®¤ä¸ºä¸åˆ‡å®é™…ï¼Œæ‹’ç»æŠ•èµ„ã€‘", effects: { flag: 'missed_spinning_jenny' }, result_text: "ä½ æ‹’ç»äº†ä»–ã€‚æ•°å¹´åï¼Œä½ çš„å¯¹æ‰‹ã€å››æµ·å•†è¡Œã€‘å‡­å€Ÿæ­¤æŠ€æœ¯å°†ä½ å½»åº•å‡»è´¥ã€‚" },
                        { text: "ã€æŠ•èµ„å°‘é‡èµ„é‡‘ã€‘", cost: { wealth: 1000 }, effects: { flag: 'partial_spinning_jenny' }, result_text: "ä½ è·å¾—äº†æ–°çººè½¦çš„éƒ¨åˆ†ä½¿ç”¨æƒï¼Œä½ çš„ä¸ç»¸ç”Ÿæ„æˆæœ¬é™ä½ã€‚" },
                        { text: "ã€ä¹°æ–­å‘æ˜ï¼Œå¹¶ä¸ºå…¶å»ºç«‹å·¥åŠã€‘", cost: { wealth: 10000 }, effects: { flag: 'monopolize_spinning_jenny' }, result_text: "ä½ å„æ–­äº†è¿™é¡¹æŠ€æœ¯ï¼Œä½ çš„ä¸ç»¸æˆæœ¬é™è‡³å…¨è¡Œä¸šæœ€ä½ï¼ä½ è·å¾—äº†æŒç»­çš„å·¨å¤§ç«äº‰ä¼˜åŠ¿ã€‚" }
                    ]
                },
                {
                    title: "å®˜åºœçš„â€œåŠæâ€",
                    desc: "æˆ·éƒ¨ä»¥â€œä¿®ç¼®å®«æ®¿â€ä¸ºç”±ï¼Œå‘äº¬åŸå„å¤§å•†å·â€œåŠæâ€ï¼ŒæŒ‡æ ‡æ˜¯5ä¸‡ä¸¤ã€‚",
                    options: [
                         { text: "ã€è¶³é¢æèµ ã€‘", cost: { wealth: 50000 }, effects: { item: { id: 'yu_ci_le_shan_hao_shi', amount: 1 }, attributes: { reputation: 20 } }, result_text: "ä½ æ…·æ…¨è§£å›Šï¼Œè·å¾—[å¾¡èµâ€œä¹å–„å¥½æ–½â€ç‰ŒåŒ¾]ï¼Œå£°æœ›å¤§å¢ã€‚" },
                         { text: "ã€å“­ç©·ï¼Œåªæ1ä¸‡ä¸¤ã€‘", cost: { wealth: 10000 }, getOutcome: (gs) => {
                             if(gs.player.attributes.charm > 90){
                                 return { text: "ä½ å£°æ³ªä¿±ä¸‹åœ°å“­è¯‰ç”Ÿæ„è‰°éš¾ï¼Œæˆ·éƒ¨å®˜å‘˜ç«Ÿä¹Ÿä¿¡äº†ï¼ŒæˆåŠŸè¿‡å…³ã€‚", effects: {} };
                             }
                             return { text: "ä½ çš„å“­ç©·è¢«è§†ä¸ºä¸æ•¬ï¼Œæˆ·éƒ¨å°†åœ¨æœªæ¥ä¸€å¹´å¯¹ä½ çš„å•†è¡Œè¿›è¡Œâ€œç¨åŠ¡ç¨½æŸ¥â€ï¼Œå¯¼è‡´ä½ æŒç»­äºæŸã€‚", effects: { flag: 'tax_audit_debuff' } };
                         }}
                    ]
                },
                {
                    title: "åˆè‚¡ç”Ÿæ„",
                    desc: "å¦ä¸€ä½ä¸ä½ å®åŠ›ç›¸å½“çš„å•†äººï¼Œæè®®ä¸ä½ åˆè‚¡åšä¸€ç¬”è·¨å›½çš„å¤§ç”Ÿæ„ã€‚",
                    options: [
                        { text: "ã€åŒæ„åˆä½œã€‘", effects: { flag: 'joint_venture' }, result_text: "ä½ ä»¬çš„åˆä½œå°†å¸¦æ¥å·¨å¤§çš„åˆ©æ¶¦ï¼Œä½†ä¹Ÿå¯èƒ½å› åˆ©ç›Šåˆ†é…ä¸å‡è€Œäº§ç”ŸçŸ›ç›¾ã€‚" },
                        { text: "ã€è¶æœºåå¹¶å¯¹æ–¹ã€‘", requirements: { wisdom: 120 }, effects: { wealth: 10000 }, result_text: "ä½ åˆ©ç”¨è°ˆåˆ¤çš„æœºä¼šï¼Œæ‘¸æ¸…äº†å¯¹æ–¹çš„åº•ç»†ï¼Œå¹¶æˆåŠŸå°†å…¶åå¹¶ï¼Œä½ çš„å•†ä¸šç‰ˆå›¾å¤§å¤§æ‰©å¼ ã€‚" },
                        { text: "ã€æ‹’ç»åˆä½œã€‘", effects: {}, result_text: "ä½ è®¤ä¸ºç‹¬å åˆ©æ¶¦æ›´å¥½ï¼Œæ‹’ç»äº†å¯¹æ–¹ã€‚" }
                    ]
                },
                {
                    title: "å®¶æ—å­å¼Ÿçš„è¯·æ±‚",
                    desc: "ä½ çš„ä¸€ä½ä¸æˆå™¨çš„å®¶æ—å­å¼Ÿï¼Œè¯·æ±‚ä½ è®©ä»–åœ¨ä½ çš„å•†è¡Œé‡Œå½“ä¸€ä¸ªç®¡äº‹ã€‚",
                    options: [
                        { text: "ã€åŒæ„ã€‘", effects: { core_resources: { xin_yu: -10 }, npc_relationship: { npc_key: 'family_elder', favor: 10 } }, result_text: "ä½ è·å¾—äº†å®¶æ—é•¿è¾ˆçš„å¥½æ„Ÿï¼Œä½†è¿™ä½å­å¼Ÿå¯èƒ½ä¼šæç ¸ä½ çš„ç”Ÿæ„ã€‚" },
                        { text: "ã€æ‹’ç»ã€‘", effects: { npc_relationship: { npc_key: 'family_elder', favor: -10 } }, result_text: "ä½ å¾—ç½ªäº†å®¶æ—çš„é•¿è¾ˆã€‚" }
                    ]
                },
                {
                    title: "åŸ¹å…»æ¥ç­äºº",
                    desc: "ä½ çš„é•¿å­å¯¹ç»å•†è¡¨ç°å‡ºæµ“åšçš„å…´è¶£ã€‚",
                    options: [
                        { text: "ã€äº²è‡ªæ•™å¯¼ã€‘", effects: { npc_relationship: { npc_key: 'son', favor: 20 }, attributes: { wisdom: 2 } }, result_text: "ä½ å°†æ¯•ç”Ÿæ‰€å­¦å€¾å›Šç›¸æˆï¼Œçˆ¶å­å…³ç³»æ›´åŠ äº²å¯†ã€‚" },
                        { text: "ã€è®©ä»–ä»å­¦å¾’åšèµ·ã€‘", effects: { npc_relationship: { npc_key: 'son', favor: -5 } }, result_text: "ä¸€ä¸ªç£¨ç»ƒä»–å¿ƒæ€§çš„å†³å®šï¼Œä½†ä»–å¯èƒ½è§‰å¾—ä½ å¯¹ä»–ä¸å¤Ÿå…³çˆ±ã€‚" }
                    ]
                },
                {
                    title: "å¼€è®¾ç¥¨å·",
                    desc: "éšç€ç”Ÿæ„è¶Šåšè¶Šå¤§ï¼Œä½ è§‰å¾—éœ€è¦å¼€è®¾è‡ªå·±çš„ç¥¨å·ï¼ˆå¤ä»£é“¶è¡Œï¼‰æ¥æ–¹ä¾¿èµ„é‡‘æµè½¬ã€‚",
                    options: [
                        { text: "ã€æŠ•å…¥å·¨èµ„å¼€è®¾ã€‘", cost: { wealth: 50000 }, effects: { flag: 'bank_opened' }, result_text: "ä½ å¼€å¯äº†é‡‘èä¸šåŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„åˆ©æ¶¦å¢é•¿ç‚¹ï¼Œä½†ä¹Ÿä¼´éšç€å·¨å¤§çš„é£é™©ã€‚" },
                        { text: "ã€æ—¶æœºæœªåˆ°ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©äº†è°¨æ…ã€‚" }
                    ]
                },
                {
                    title: "è´­ä¹°å®˜çˆµ",
                    desc: "æœå»·ä¸ºäº†ç­¹æ¬¾ï¼Œå¼€å§‹å–å®˜é¬»çˆµã€‚ä½ å¯ä»¥æä¸€ä¸ªâ€œå‘˜å¤–éƒâ€çš„è™šè¡”ã€‚",
                    options: [
                        { text: "ã€æé’±ä¹°å®˜ã€‘", cost: { wealth: 30000 }, effects: { attributes: { reputation: 20 }, flag: 'official_rank' }, result_text: "ä½ è·å¾—äº†å®˜èº«ï¼Œç¤¾ä¼šåœ°ä½å¤§å¤§æå‡ï¼Œä¸å®˜åºœæ‰“äº¤é“ä¹Ÿæ›´æ–¹ä¾¿äº†ã€‚" },
                        { text: "ã€è®¤ä¸ºä¸å€¼ã€‘", effects: {}, result_text: "ä½ è§‰å¾—è¿™æ˜¯ä¸ªäºæœ¬ä¹°å–ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šä¸¤æ·®ç›å¼•",
                trigger: { career_level: 6, text_desc: "æˆä¸ºæ€»è¡Œä¸œå®¶, æœ¬é‡‘>10ä¸‡, ä¿¡èª‰>300", condition: (gs) => (gs.career.core_resources.ben_jin || gs.finances.wealth) > 100000 && (gs.career.core_resources.xin_yu || 0) > 300 },
                desc: "ä½ ååœ¨ä¸€é—´è¢«é‡å…µæŠŠå®ˆçš„å·¨å¤§å…å ‚å†…ï¼Œä¸å…¨å›½æœ€å¯Œæœ‰çš„å•†äººä»¬ç«å¤ºæœªæ¥äº”å¹´â€œä¸¤æ·®åœ°åŒºâ€çš„é£Ÿç›ç‹¬å®¶ç»è¥æƒã€‚",
                success: { text: "ä½ æˆåŠŸè·å¾—äº†[ä¸¤æ·®ç›å¼•ï¼ˆäº”å¹´ï¼‰]ï¼è¿™æ˜¯å…¨æ¸¸æˆæœ€èµšé’±çš„èµ„äº§ä¹‹ä¸€ï¼Œå°†åœ¨äº”å¹´å†…ä¸ºä½ å¸¦æ¥æµ·å•¸èˆ¬çš„è´¢å¯Œã€‚ä½ çš„ç¤¾ä¼šåœ°ä½å‘ç”Ÿè´¨å˜ï¼", effects: { item: { id: 'liang_huai_yan_yin', amount: 1 }, attributes: { reputation: 100 } } },
                failure: { text: "ç«æ ‡å¤±è´¥ï¼Œä½ æŠ•å…¥çš„ä¿è¯é‡‘è¢«æ²¡æ”¶ã€‚", effects: { wealth: -10000 } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šç™»å³°é€ æ",
            level_range: [8, 10],
            goal: "ä½ çš„è´¢å¯Œå·²æˆä¸ºä¸€ç§åŠ›é‡ã€‚ä½ éœ€è¦ç”¨è¿™ç§åŠ›é‡å»æ”¹å˜è§„åˆ™ã€æŠ•èµ„æœªæ¥ï¼Œå¹¶ä¸ºä½ çš„å•†ä¸šå¸å›½å¯»æ‰¾ä¸€ä½åˆæ ¼çš„ç»§æ‰¿äººã€‚",
            events: [
                {
                    title: "å»ºç«‹ç§äººç¥¨å·",
                    desc: "ä½ çš„ç”Ÿæ„éå¸ƒå…¨å›½ï¼Œèµ„é‡‘æµè½¬æˆäº†å¤§é—®é¢˜ã€‚ä½ å†³å®šå»ºç«‹è‡ªå·±çš„é‡‘èç½‘ç»œã€‚",
                    options: [
                        { text: "ã€æŠ•å…¥å·¨èµ„ï¼Œå»ºç«‹[è‡ªå®¶å§“æ°]ç¥¨å·ã€‘", cost: { wealth: 100000 }, effects: { flag: 'unlock_banking_system' }, result_text: "ä½ å¼€å¯äº†å…¨æ–°çš„é‡‘èç©æ³•ã€‚ä½ å¯ä»¥æ”¾è´·ç»™å…¶ä»–NPCã€è¿›è¡Œæ±‡å…‘ä¸šåŠ¡ï¼Œä½†ä¹Ÿæ‰¿æ‹…äº†â€œåè´¦â€çš„é£é™©ã€‚" },
                        { text: "ã€ä¸[æ™‹é˜³ç¥¨å·]æ·±åº¦åˆä½œã€‘", cost: { wealth: 50000 }, effects: { flag: 'jinyang_partnership' }, result_text: "ä½ æˆä¸ºã€æ™‹é˜³ç¥¨å·ã€‘çš„æœ€å¤§è‚¡ä¸œï¼Œå®‰å…¨ç¨³å®šï¼Œä½†åˆ©æ¶¦éœ€è¦åˆ†æˆã€‚" }
                    ]
                },
                {
                    title: "èµ„åŠ©å¤ºå«¡çš‡å­",
                    desc: "ä¸€ä½å¤±åŠ¿çš„çš‡å­ç§˜å¯†ä¸ä½ æ¥è§¦ï¼Œå¸Œæœ›è·å¾—ä½ çš„èµ„é‡‘æ”¯æŒï¼Œå¹¶è®¸è¯ºæˆåŠŸåè®©ä½ æˆä¸ºâ€œå›½å•†â€ã€‚",
                    options: [
                        { text: "ã€è¿™æ˜¯ä¸€åœºè±ªèµŒï¼Œæˆ‘æŠ•äº†ï¼ã€‘", cost: { wealth: 50000 }, effects: { flag: 'support_prince_rebellion' }, result_text: "ä½ ä¸è¯¥çš‡å­æ·±åº¦ç»‘å®šã€‚ä»–è‹¥æˆåŠŸï¼Œä½ çš„å®¶æ—å°†è¿æ¥ç™¾å¹´å¯Œè´µï¼›ä»–è‹¥å¤±è´¥ï¼Œä½ å°†è¢«æ»¡é—¨æŠ„æ–©ã€‚" },
                        { text: "ã€é£é™©å¤ªå¤§ï¼Œå©‰è¨€æ‹’ç»ã€‘", effects: { npc_relationship: { npc_key: 'rebel_prince', favor: -30 } }, result_text: "ä½ ä¿æŒäº†ä¸­ç«‹å’Œå®‰å…¨ï¼Œä½†ä¹Ÿå¾—ç½ªäº†è¿™ä½çš‡å­ã€‚" }
                    ]
                },
                {
                    title: "é­é‡æµ·å¤–å·¨èˆ¶æµ·ç›—",
                    desc: "ä½ çš„è¿œæ´‹è´¸æ˜“èˆ¹é˜Ÿï¼Œåœ¨æµ·å¤–é­é‡äº†è£…å¤‡ç²¾è‰¯ã€æ•°é‡åºå¤§çš„æµ·ç›—èˆ°é˜Ÿã€‚",
                    options: [
                        { text: "ã€æˆæƒèˆ¹é•¿ï¼Œä¸æƒœä¸€åˆ‡ä»£ä»·ä½œæˆ˜ã€‘", getOutcome: (gs) => {
                            if (Math.random() < 0.3) {
                                return { text: "ä¸€åœºæƒ¨èƒœï¼ä½ ç¼´è·äº†[æµ·ç›—çš„è—å®å›¾]ï¼", effects: { wealth: -20000, item: { id: 'hai_dao_cang_bao_tu', amount: 1 } } };
                            }
                            return { text: "ä½ çš„èˆ¹é˜Ÿå…¨å†›è¦†æ²¡...", effects: { wealth: -50000, flag: 'trade_route_destroyed' } };
                        }},
                        { text: "ã€ç¼´çº³èµé‡‘ã€‘", cost: { wealth: 30000 }, effects: {}, result_text: "ä½ æŸå¤±äº†å·¨é¢æœ¬é‡‘ï¼Œä½†ä¿ä½äº†èˆ¹é˜Ÿå’Œå•†è·¯ã€‚" }
                    ]
                },
                {
                    title: "ç»„ç»‡æ…ˆå–„ï¼Œåç•™é’å²",
                    desc: "å›½å†…å‘ç”Ÿå¤§é¥¥è’ï¼Œä½ å†³å®šæŒºèº«è€Œå‡ºã€‚",
                    options: [
                        { text: "ã€å¼€è®¾ç²¥æ£šï¼Œæ•‘æµç¾æ°‘ã€‘", cost: { wealth: 50000 }, effects: { attributes: { reputation: 100, virtue: 50 } }, result_text: "ä½ çš„å£°æœ›å’Œå“å¾·è¾¾åˆ°é¡¶å³°ï¼Œè¢«ç™¾å§“èª‰ä¸ºâ€œå¤§å–„äººâ€ã€‚" },
                        { text: "ã€ä»¥å·¥ä»£èµˆï¼Œå…´ä¿®æ°´åˆ©ã€‘", cost: { wealth: 80000 }, effects: { attributes: { reputation: 80, virtue: 40, wisdom: 10 } }, result_text: "ä¸ä»…æ•‘äº†ç¾ï¼Œè¿˜ä¸ºè‡ªå·±æœªæ¥çš„ç”Ÿæ„ç–é€šäº†æ²³é“ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚" }
                    ]
                },
                {
                    title: "å®¶æ—å†…æ–—ï¼Œäº‰å¤ºå®¶äº§",
                    desc: "ä½ çš„å‡ ä½äº²æ—/å­å—£ï¼Œä¸ºäº†äº‰å¤ºä½ åºå¤§äº§ä¸šçš„ç»§æ‰¿æƒï¼Œåœ¨æš—ä¸­äº’ç›¸æ”»å‡»ã€‚",
                    options: [
                         { text: "ã€é“è…•æ‰‹æ®µï¼Œç½¢é»œæ‰€æœ‰ä¸å¿ è€…ã€‘", effects: {}, result_text: "ä½ å·©å›ºäº†è‡ªå·±çš„æƒå¨ï¼Œä½†å®¶æ—å…³ç³»ç ´è£‚ã€‚" },
                         { text: "ã€è®¾ç«‹[å®¶æ—ä¿¡æ‰˜]ï¼Œæ˜ç¡®åˆ†é…è§„åˆ™ã€‘", requirements: { wisdom: 150 }, effects: { flag: 'family_trust_established' }, result_text: "ä½ ç”¨ç°ä»£å•†ä¸šçš„æ™ºæ…§è§£å†³äº†ç»§æ‰¿é—®é¢˜ï¼Œç¡®ä¿äº†å®¶æ—çš„é•¿ç››ä¸è¡°ã€‚" },
                         { text: "ã€é€‰æ‹©ä¸€ä½æœ€ä¼˜ç§€çš„ç»§æ‰¿äººã€‘", effects: { flag: 'start_heir_training' }, result_text: "ä½ å°†å¼€å¯â€œç»§æ‰¿äººåŸ¹å…»â€æ¨¡å¼ï¼Œä½ çš„éƒ¨åˆ†æ“ä½œå°†ç”±ä½ å’Œä½ çš„ç»§æ‰¿äººå…±åŒå®Œæˆã€‚" }
                    ]
                },
                {
                    title: "æ¥è‡ªåŒè¡Œçš„æ‹œè®¿",
                    desc: "å¦ä¸€ä½å·¨å•†å‰æ¥æ‹œè®¿ï¼Œå¸Œæœ›ä¸ä½ è”æ‰‹ï¼Œå„æ–­å…¨å›½çš„ä¸ç»¸å¸‚åœºã€‚",
                    options: [
                        { text: "ã€åŒæ„è”æ‰‹ã€‘", effects: { flag: 'silk_monopoly' }, result_text: "ä½ ä»¬æˆåŠŸå„æ–­äº†å¸‚åœºï¼Œè·å¾—äº†å·¨å¤§çš„åˆ©æ¶¦ï¼Œä½†ä¹Ÿå¼•èµ·äº†å®˜åºœçš„è­¦æƒ•ã€‚" },
                        { text: "ã€æ‹’ç»å¹¶å‘å®˜åºœä¸¾æŠ¥ã€‘", effects: { attributes: { virtue: 10 }, npc_relationship: { npc_key: 'government', favor: 20 } }, result_text: "ä½ è·å¾—äº†å®˜åºœçš„èµè¯†ï¼Œä½†ä¸æ•´ä¸ªå•†ç•Œä¸ºæ•Œã€‚" }
                    ]
                },
                {
                    title: "èµ„åŠ©ç§‘å­¦ç ”ç©¶",
                    desc: "ä¸€ä½è¥¿æ´‹ä¼ æ•™å£«å‘ä½ å±•ç¤ºäº†è’¸æ±½æœºçš„æ¨¡å‹ï¼Œå¸Œæœ›èƒ½è·å¾—ä½ çš„èµ„åŠ©è¿›è¡Œç ”ç©¶ã€‚",
                    options: [
                        { text: "ã€è¿›è¡ŒæŠ•èµ„ã€‘", cost: { wealth: 100000 }, effects: { flag: 'industrial_revolution_seed' }, result_text: "è¿™æ˜¯ä¸€é¡¹çœ‹ä¸æ¸…æœªæ¥çš„é•¿è¿œæŠ•èµ„ï¼Œä½†å¦‚æœæˆåŠŸï¼Œä½ å°†æ”¹å˜æ•´ä¸ªä¸–ç•Œã€‚" },
                        { text: "ã€è®¤ä¸ºè¿™æ˜¯å¥‡æŠ€æ·«å·§ã€‘", effects: {}, result_text: "ä½ é”™è¿‡äº†å¼€å¯ä¸€ä¸ªæ–°æ—¶ä»£çš„æœºä¼šã€‚" }
                    ]
                },
                {
                    title: "çš‡å¸çš„å€Ÿæ¬¾",
                    desc: "çš‡å¸å› å›½åº“ç©ºè™šï¼Œç§ä¸‹å‘ä½ â€œå€Ÿâ€ä¸€ç¬”å·¨æ¬¾ç”¨äºä¿®å»ºçš‡å®¶å›­æ—ã€‚",
                    options: [
                        { text: "ã€æ…·æ…¨è§£å›Šã€‘", cost: { wealth: 200000 }, effects: { npc_relationship: { npc_key: 'emperor', favor: 50 } }, result_text: "çš‡å¸å¯¹ä½ éå¸¸æ»¡æ„ï¼Œä½ æˆä¸ºäº†çš‡å¸çš„â€œé’±è¢‹å­â€ï¼ŒæƒåŠ¿æ»”å¤©ã€‚" },
                        { text: "ã€å“­ç©·å©‰æ‹’ã€‘", effects: { npc_relationship: { npc_key: 'emperor', favor: -30 } }, result_text: "çš‡å¸å¯¹ä½ éå¸¸ä¸æ»¡ï¼Œä½ çš„ç”Ÿæ„æœªæ¥å¯èƒ½ä¼šå—åˆ°æ‰“å‹ã€‚" }
                    ]
                },
                {
                    title: "å½±å“å›½ç­–",
                    desc: "ä½ å¦‚ä»Šæœ‰è¶³å¤Ÿçš„å½±å“åŠ›ï¼Œå¯ä»¥å‘æœå»·æè®®æŸé¡¹å¯¹ä½ æœ‰åˆ©çš„æ”¿ç­–ã€‚",
                    options: [
                        { text: "ã€æè®®é™ä½å•†ç¨ã€‘", effects: { flag: 'tax_reform' }, result_text: "ä½ çš„æè®®å°†åœ¨æœå ‚ä¸Šå¼•èµ·å·¨å¤§äº‰è®®ã€‚" },
                        { text: "ã€æè®®é‡å¼€ä¸ç»¸ä¹‹è·¯ã€‘", effects: { flag: 'reopen_silk_road' }, result_text: "è¿™å°†ä¸ºä½ å¸¦æ¥å·¨å¤§çš„å•†æœºï¼Œä½†ä¹Ÿä¼´éšç€å·¨å¤§çš„é£é™©ã€‚" }
                    ]
                },
                {
                    title: "å¯Œå¯æ•Œå›½çš„çƒ¦æ¼",
                    desc: "ä½ çš„è´¢å¯Œå·²ç»å¤šåˆ°æ— æ³•è®¡ç®—ï¼Œä½ å¼€å§‹æ€è€ƒé‡‘é’±çš„æ„ä¹‰ã€‚",
                    options: [
                        { text: "ã€å»ºç«‹æ…ˆå–„åŸºé‡‘ã€‘", cost: { wealth: 500000 }, effects: { attributes: { virtue: 100 } }, result_text: "ä½ å°†è´¢å¯Œç”¨äºå›é¦ˆç¤¾ä¼šï¼Œè·å¾—äº†ä¸‡æ°‘æ•¬ä»°ã€‚" },
                        { text: "ã€è¿½æ±‚é•¿ç”Ÿä¸è€ã€‘", cost: { wealth: 500000 }, effects: { attributes: { health: 10 } }, result_text: "ä½ ç”¨é‡‘é’±æ¢æ¥äº†å„ç§çç¨€è¯æï¼Œå¥åº·è·å¾—æå‡ï¼Œä½†é•¿ç”Ÿç»ˆç©¶æ˜¯è™šå¦„ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šå¼€æµ·ç¦ä¹‹è®®",
                trigger: { career_level: 7, text_desc: "æˆä¸ºçš‡å•†, è´¢å¯Œ/ä¿¡èª‰/å£°æœ›è¾¾åˆ°é¡¶å³°", condition: (gs) => (gs.finances.wealth > 1000000 && (gs.career.core_resources.xin_yu || 0) > 800 && gs.player.attributes.reputation > 500) },
                desc: "ä½ ä½œä¸ºâ€œå¤©ä¸‹ç¬¬ä¸€å¯Œå•†â€è¢«è¯·å…¥çš‡å®«çš„è®®æ”¿æ®¿ã€‚ä½ é¢å¯¹çš„æ˜¯æ•´ä¸ªå¸å›½çš„æ–‡æ­¦ç™¾å®˜ï¼Œä½ çš„æ¯ä¸€å¥è¯ï¼Œéƒ½å¯èƒ½å¼€å¯ä¸€ä¸ªå…¨æ–°çš„å¤§èˆªæµ·æ—¶ä»£ã€‚",
                success: { text: "çš‡å¸è¢«ä½ è¯´æœï¼Œä¸‹æ—¨â€œå¼€å…³é€šå•†â€ï¼ä½ è¢«å†Œå°ä¸ºå²æ— å‰ä¾‹çš„â€œçº¢é¡¶å•†äººâ€ï¼Œå®˜å±…ä¸€å“ï¼Œæ€»é¢†å¤©ä¸‹å¸‚èˆ¶å¸ã€‚ä½ çš„äººç”Ÿï¼Œå·²æ˜¯ä¼ å¥‡ã€‚", effects: { item: { id: 'hong_ding_shang_ren_guan_mao', amount: 1 }, flag: 'unlock_global_trade', end_game_title: 'çº¢é¡¶å•†äºº' } },
                failure: { text: "ä½ çš„æè®®è¢«è§†ä¸ºâ€œè›Šæƒ‘å›å¿ƒï¼Œå”¯åˆ©æ˜¯å›¾â€ï¼Œä½ çš„æ‰€æœ‰æµ·å¤–èµ„äº§è¢«æŸ¥æŠ„ï¼Œä½ è¢«ç¦æ­¢å†è¿›è¡Œè¿œæ´‹è´¸æ˜“ã€‚", effects: { wealth: -100000, flag: 'banned_from_sea_trade' } }
            }
        }
    ]
},
'scholar': {
    name: "æ–‡äººå¢¨å®¢",
    icon: "fa-paint-brush",
    gender: "male",
    core_resources: ["ling_gan", "reputation", "xin_jing"],
    dashboard_name: "æˆ‘çš„ä¹¦æ–‹",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šå£°åæœªæ˜¾",
            level_range: [1, 4],
            goal: "è§£å†³ç”Ÿè®¡é—®é¢˜ï¼Œç£¨ç»ƒåŸºç¡€æŠ€è‰ºï¼Œåˆ›ä½œå‡ºç¬¬ä¸€éƒ¨èƒ½è®©è‡ªå·±åœ¨æœ¬åœ°æ–‡äººåœˆä¸­è·å¾—è®¤å¯çš„ä½œå“ã€‚",
            events: [
                {
                    title: "ä¸ºäººä»£ç¬”",
                    desc: "ä¸€ä½é™„åº¸é£é›…çš„å¯Œå®¶å­å¼Ÿï¼Œç§ä¸‹è¯·ä½ ä¸ºä»–ä»£ç¬”ä¸€é¦–è¯—ï¼Œç”¨äºåœ¨è¯—ä¼šä¸Šåšå–åå£°ã€‚",
                    options: [
                        { text: "ã€æ…¨ç„¶åº”å…ï¼Œå°½å±•æ‰åã€‘", cost: { core_resources: { ling_gan: 20 } }, effects: { wealth: 500, attributes: { reputation: -5 }, core_resources: { xin_jing: 'æ‚²éƒ' } }, result_text: "ä½ å†™å‡ºä¸€é¦–ä¸Šä½³ä¹‹ä½œï¼Œè·å¾—500ä¸¤ã€‚æ­¤äº‹è‹¥ä¼ å‡ºæœ‰æŸä½ çš„é£éª¨ï¼Œå¿ƒå¢ƒå˜ä¸ºâ€œæ‚²éƒâ€ã€‚" },
                        { text: "ã€æ•·è¡äº†äº‹ï¼Œç•¥ä½œåº”ä»˜ã€‘", cost: { core_resources: { ling_gan: 5 } }, effects: { wealth: 100 }, result_text: "ä½ äº¤å‡ºä¸€é¦–å¹³åº¸ä¹‹ä½œï¼Œè·å¾—100ä¸¤ã€‚è¯¥å­å¼Ÿè™½ä¸æ»¡æ„ï¼Œä½†ä¹Ÿæ— æ³•æŒ‡è´£ä½ ã€‚" },
                        { text: "ã€ä¸¥è¯æ‹’ç»ï¼ŒæŒå®ˆé£éª¨ã€‘", effects: { attributes: { virtue: 5 }, core_resources: { xin_jing: 'æ¿€æ˜‚' } }, result_text: "ä½ ä¿ä½äº†æ–‡äººçš„æ°”èŠ‚ï¼Œå¿ƒå¢ƒå˜ä¸ºâ€œæ¿€æ˜‚â€ï¼Œä½†ä¹Ÿå¾—ç½ªäº†è¿™ä½å¯Œå®¶å­å¼Ÿã€‚" }
                    ]
                },
                {
                    title: "çŸ¥éŸ³éš¾è§…",
                    desc: "ä½ æºæ–°ä½œæ‹œè®¿ä¸€ä½ç•¥æœ‰åæ°”çš„å‰è¾ˆï¼Œå¸Œæœ›å¾—åˆ°ç‚¹è¯„ã€‚",
                    options: [
                        { text: "ã€è™šå¿ƒè¯·æ•™å…¶ç”»ä½œä¹‹é“ã€‘", effects: { npc_relationship: { npc_key: 'senior_artist', favor: 15 }, attributes: { talent: 2 } }, result_text: "ä½ çš„è°¦é€Šèµ¢å¾—äº†å¯¹æ–¹çš„å¥½æ„Ÿï¼Œä»–æŒ‡ç‚¹äº†ä½ å‡ å¤„å…³é”®çš„ç¬”æ³•ã€‚" },
                        { text: "ã€æ„æ°”é£å‘ï¼Œä¸å…¶è¾©è®ºè‰ºæœ¯è§è§£ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.talent > 60) {
                                return { text: "ä½ çš„ç‹¬åˆ°è§è§£ä»¤å¯¹æ–¹åˆ®ç›®ç›¸çœ‹ï¼Œä½ ä»¬çš„å…³ç³»å˜ä¸ºâ€œäº¦æ•Œäº¦å‹â€ã€‚", effects: { attributes: { reputation: 10 } } };
                            }
                            return { text: "å¯¹æ–¹è®¤ä¸ºä½ ç‹‚å¦„è‡ªå¤§ï¼Œä¸æ¬¢è€Œæ•£ã€‚", effects: { npc_relationship: { npc_key: 'senior_artist', favor: -20 } } };
                        }}
                    ]
                },
                {
                    title: "å…¸å½“å®¶äº§",
                    desc: "ä¸ºäº†è´­ä¹°ä¸€å¥—åè´µçš„[æ–‡æˆ¿å››å®]ä»¥æå‡åˆ›ä½œè´¨é‡ï¼Œä½ çš„é’±ä¸å¤Ÿäº†ã€‚",
                    options: [
                        { text: "ã€å…¸å½“[ä¼ å®¶ç‰ä½©]ã€‘", requirements: { has_item: 'chuan_jia_yu_pei' }, cost: { item: 'chuan_jia_yu_pei' }, effects: { wealth: 1000, item: { id: 'hu_zhou_bi_hui_zhou_mo', amount: 1 }, attributes: { virtue: -5 }, core_resources: { xin_jing: 'æ‚²éƒ' } }, result_text: "ä½ è·å¾—1000ä¸¤ï¼ŒæˆåŠŸè´­å¾—[æ¹–å·ç¬”ã€å¾½å·å¢¨]ã€‚ä½†å˜å–ç¥–äº§è®©ä½ å†…å¿ƒä¸å®‰ã€‚" },
                        { text: "ã€å”®å–è‡ªå·±ä¸å¤Ÿæ»¡æ„çš„å‡ å¹…æ—§ä½œã€‘", effects: { wealth: 300 }, result_text: "ä½ è·å¾—300ä¸¤ã€‚è™½ç„¶æ¯æ°´è½¦è–ªï¼Œä½†ä½ ä¿ä½äº†æœ€é‡è¦çš„ä¸œè¥¿ã€‚" }
                    ]
                },
                {
                    title: "å‚åŠ å°å‹æ–‡ä¼š",
                    desc: "åŸä¸­ä¸¾åŠäº†ä¸€åœºæ™®é€šçš„æ–‡äººèšä¼šï¼Œé±¼é¾™æ··æ‚ã€‚",
                    options: [
                        { text: "ã€å¯»æ‰¾æœºä¼šï¼Œæœ—è¯µæ–°ä½œã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.charm > 50) {
                                return { text: "ä½ çš„ä½œå“è·å¾—äº†ä¸€äº›èµèª‰ã€‚", effects: { attributes: { reputation: 5 }, core_resources: { ling_gan: 10 } } };
                            }
                            return { text: "æ— äººç†ä¼šä½ çš„ä½œå“ï¼Œåœºé¢ååˆ†å°´å°¬ã€‚", effects: { attributes: { charm: -1 } } };
                        }},
                        { text: "ã€ç»“äº¤æ–°å‹ï¼Œæ‹“å±•äººè„‰ã€‘", effects: { social: 'expand' }, result_text: "ä½ æˆåŠŸç»“è¯†äº†ä¸€ä½è½é­„ä½†æœ‰æ‰çš„ç”»å¸ˆå’Œä¸€ä½å®¶å¢ƒæ®·å®çš„ç§€æ‰ã€‚" }
                    ]
                },
                {
                    title: "ä¸ç”»èˆ«æ­Œå¦“å¯¹è¯—",
                    desc: "ç§¦æ·®æ²³ä¸Šçš„ç”»èˆ«ä¸­ï¼Œå½“çº¢æ­Œå¦“å¼¹å”±ä¸€æ›²åï¼Œé‚€è¯·å®¢äººå¯¹è¯—åŠ©å…´ã€‚",
                    options: [
                        { text: "ã€ä¸Šå‰åº”å¯¹ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.talent > 65) {
                                return { text: "ä½ å³å…´åˆ›ä½œçš„è¯—å¥ä¸ä¹æ›²å®Œç¾å¥‘åˆï¼ŒæŠ€æƒŠå››åº§ã€‚è¯¥æ­Œå¦“å¯¹ä½ é’çœ¼æœ‰åŠ ï¼Œæˆä¸ºä½ çš„çº¢é¢œçŸ¥å·±ã€‚", effects: { attributes: { reputation: 10, charm: 3 }, npc_relationship: { npc_key: 'courtesan_poet', favor: 30, type: 'confidante' } } };
                            }
                            return { text: "ä½ çš„è¯—ä½œå¹³å¹³ï¼Œè´»ç¬‘å¤§æ–¹ã€‚", effects: { attributes: { reputation: -5 } } };
                        }}
                    ]
                },
                {
                    title: "ä¹¦ç”»æ‘Šçš„æœºé‡",
                    desc: "ä½ ä¸ºäº†ç”Ÿè®¡ï¼Œåœ¨è¡—è¾¹æ‘†æ‘Šå”®å–è‡ªå·±çš„ä¹¦ç”»ã€‚",
                    options: [
                        { text: "ã€åšæŒé£æ ¼ï¼Œç­‰å¾…çŸ¥éŸ³ã€‘", getOutcome: (gs) => {
                            if (Math.random() < 0.2) {
                                return { text: "ä¸€ä½å¾®æœç§è®¿çš„ç‹çˆ·ä¹°èµ°äº†ä½ çš„ä¸€å¹…ç”»ï¼Œå¹¶å¯¹ä½ å¤§åŠ èµèµï¼", effects: { wealth: 1000, attributes: { reputation: 15 }, npc_relationship: { npc_key: 'prince_patron', favor: 30 } } };
                            }
                            return { text: "ä¸€æ•´å¤©æ— äººé—®æ´¥ï¼Œä½ å¯¹è‡ªå·±çš„æ‰èƒ½äº§ç”Ÿäº†æ€€ç–‘ã€‚", effects: { core_resources: { xin_jing: 'æ‚²éƒ' } } };
                        }},
                        { text: "ã€ç”»ä¸€äº›è¿åˆå¸‚åœºçš„ä½œå“ã€‘", effects: { wealth: 200 }, result_text: "ä½ ç”»çš„â€œç¦ç¦„å¯¿â€å›¾å¾ˆå—æ¬¢è¿ï¼Œèµšäº†äº›é’±ï¼Œä½†æ„Ÿè§‰å¤±å»äº†è‰ºæœ¯è¿½æ±‚ã€‚" }
                    ]
                },
                {
                    title: "çµæ„Ÿæ¥æº",
                    desc: "ä½ æ„Ÿåˆ°çµæ„Ÿæ¯ç«­ï¼Œæ— æ³•åˆ›ä½œã€‚",
                    options: [
                        { text: "ã€æ¸¸å†åå±±å¤§å·ã€‘", cost: { wealth: 300 }, effects: { core_resources: { ling_gan: 50 }, attributes: { health: 5 } }, result_text: "å£®ä¸½çš„è‡ªç„¶é£å…‰æ¿€å‘äº†ä½ çš„åˆ›ä½œçµæ„Ÿã€‚" },
                        { text: "ã€åœ¨å¸‚äº•ä¸­è§‚å¯Ÿç”Ÿæ´»ã€‘", effects: { core_resources: { ling_gan: 30 }, attributes: { wisdom: 2 } }, result_text: "å¸‚äº•ç™¾æ€è®©ä½ å¯¹äººç”Ÿæœ‰äº†æ–°çš„æ„Ÿæ‚Ÿã€‚" }
                    ]
                },
                {
                    title: "è—ä¹¦æ¥¼çš„å¶é‡",
                    desc: "ä½ åœ¨è—ä¹¦æ¥¼æŸ¥é˜…èµ„æ–™æ—¶ï¼Œä¸ä¸€ä½åŒæ ·åœ¨æ­¤è¯»ä¹¦çš„å§‘å¨˜å› ä¸€æœ¬å¤ç±ç›¸è¯†ã€‚",
                    options: [
                        { text: "ã€ä¸å¥¹æ¢è®¨å­¦é—®ã€‘", requirements: { talent: 50 }, effects: { npc_relationship: { npc_key: 'scholar_lady', favor: 20, type: 'friend' } }, result_text: "ä½ ä»¬ç›¸è°ˆç”šæ¬¢ï¼Œäº’ç›¸å¼•ä¸ºçŸ¥å·±ã€‚" },
                        { text: "ã€é»˜é»˜è°¦è®©ã€‘", effects: { attributes: { virtue: 3 } }, result_text: "ä½ çš„é£åº¦ç»™å¯¹æ–¹ç•™ä¸‹äº†ä¸é”™çš„å°è±¡ã€‚" }
                    ]
                },
                {
                    title: "ç¬”å¢¨çš„é€‰æ‹©",
                    desc: "å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ä½ éœ€è¦ä¸€å¥—å¥½çš„ç¬”å¢¨çº¸ç šã€‚",
                    options: [
                        { text: "ã€èŠ±è´¹é‡é‡‘è´­ä¹°ã€‘", cost: { wealth: 800 }, effects: { item: { id: 'hu_zhou_bi_hui_zhou_mo', amount: 1 } }, result_text: "ä½ è´­å¾—ä¸€å¥—[æ¹–å·ç¬”ã€å¾½å·å¢¨]ï¼Œåˆ›ä½œæ•ˆç‡æå‡ã€‚" },
                        { text: "ã€è‡ªå·±åŠ¨æ‰‹åˆ¶ä½œã€‘", requirements: { wisdom: 50 }, effects: { attributes: { talent: 2 } }, result_text: "è™½ç„¶ç²—ç³™ï¼Œä½†ä½ ä»ä¸­é¢†æ‚Ÿåˆ°äº†åˆ¶ç¬”çš„è¯€çªã€‚" }
                    ]
                },
                {
                    title: "é†‰é…’åçš„åˆ›ä½œ",
                    desc: "ä½ åœ¨ä¸€æ¬¡å¤§é†‰åï¼ŒæŒ¥æ¯«æ³¼å¢¨ï¼Œé†’æ¥åå‘ç°äº†ä¸€å¹…è‡ªå·±éƒ½ä¸è®¤è¯†çš„ä½œå“ã€‚",
                    options: [
                        { text: "ã€å°†å…¶å±•ç¤ºç»™æœ‹å‹ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.talent > 70) {
                                return { text: "æ­¤ä½œç«Ÿæ˜¯ä½ å¹³ç”Ÿæœªæœ‰ä¹‹ä½³ä½œï¼æœ‹å‹ä»¬æƒŠä¸ºå¤©äººï¼", effects: { core_resources: { ling_gan: 30, reputation: 10 } } };
                            }
                            return { text: "æœ‹å‹ä»¬è¡¨ç¤ºçœ‹ä¸æ‡‚ä½ ç”»çš„/å†™çš„æ˜¯ä»€ä¹ˆã€‚", effects: {} };
                        }},
                        { text: "ã€è®¤ä¸ºä¸æˆä½“ç»Ÿï¼Œå°†å…¶çƒ§æ¯ã€‘", effects: {}, result_text: "ä½ é”€æ¯äº†è¿™å¹…ä½œå“ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šé‡‘é™µè¯—ä¼š",
                trigger: { career_level: 3, text_desc: "æˆä¸ºçŸ¥åä¹¦ç”Ÿ, æ‰æƒ…>80, å£°æœ›>50", condition: (gs) => gs.player.attributes.talent > 80 && gs.player.attributes.reputation > 50 },
                desc: "é‡‘é™µå¤«å­åº™å‰ï¼Œäººå±±äººæµ·ï¼Œå½©æ——é£˜æ‰¬ã€‚æ±Ÿå—æ‰€æœ‰çš„å¤§å„’ã€åå£«ã€æ‰å­ä½³äººé½èšä¸€å ‚ã€‚è¿™æ˜¯ä½ é²¤é±¼è·ƒé¾™é—¨çš„ç¬¬ä¸€é“å…³å¡ã€‚",
                success: { text: "ä½ åœ¨æ­¤æ¬¡è¯—ä¼šä¸­å¤ºå¾—é­é¦–ï¼Œè¢«èª‰ä¸ºâ€œé‡‘é™µæ‰å­â€ï¼å£°æœ›æš´æ¶¨ï¼Œå¹¶è¢«ä¸€ä½å¤§å„’æ”¶ä¸ºå…¥å®¤å¼Ÿå­ï¼Œæ­£å¼è¿›å…¥äº¬åŸæ ¸å¿ƒæ–‡åŒ–åœˆã€‚", effects: { career_level_set: 4, attributes: { reputation: 100, talent: 10 }, item: { id: 'wen_cai_feng_liu_pai_bian', amount: 1 } } },
                failure: { text: "é»˜é»˜æ— é—»ï¼Œä½ çš„ä½œå“è¢«æ·¹æ²¡åœ¨äººæµ·ä¸­ï¼Œçµæ„Ÿè€—å°½ï¼Œå¿ƒå¢ƒå˜ä¸ºâ€œæ‚²éƒâ€ï¼ŒæŒç»­æ•°æœˆã€‚", effects: { core_resources: { ling_gan: -50, xin_jing: 'æ‚²éƒ' } } }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šååŠ¨äº¬å",
            level_range: [5, 7],
            goal: "ç¡®ç«‹è‡ªå·±ç‹¬ä¸€æ— äºŒçš„è‰ºæœ¯é£æ ¼ï¼Œç»“äº¤æ›´é«˜å±‚æ¬¡çš„æƒè´µä¸åå£«ï¼Œå¹¶åˆ›ä½œå‡ºç¬¬ä¸€éƒ¨çœŸæ­£æ„ä¹‰ä¸Šçš„é‡è¦ä½œå“ã€‚",
            events: [
                {
                    title: "æƒè´µçš„é‚€çº¦",
                    desc: "åéƒ¨ä¾éƒè¯·ä½ ä¸ºå…¶èŠ±å›­ä½œä¸€å¹…ç”»ï¼Œå¹¶æš—ç¤ºé…¬åŠ³ä¸°åšã€‚",
                    options: [
                        { text: "ã€æŒ‰å…¶è¦æ±‚ï¼Œç”»ä¸€å¹…å¯Œè´µç‰¡ä¸¹å›¾ã€‘", effects: { wealth: 2000, npc_relationship: { npc_key: 'shi_lang', favor: 20 }, attributes: { reputation: -5 } }, result_text: "ä¾éƒéå¸¸æ»¡æ„ï¼Œä½†åœˆå†…äººè®¤ä¸ºä½ çš„ç”»â€œåŒ æ°”æœ‰ä½™ï¼Œçµæ°”ä¸è¶³â€ã€‚" },
                        { text: "ã€åšæŒæœ¬å¿ƒï¼Œç”»ä¸€å¹…é›¨åèŠ­è•‰å›¾ã€‘", effects: { wealth: 500, npc_relationship: { npc_key: 'shi_lang', favor: 5 }, attributes: { reputation: 15 } }, result_text: "ä¾éƒè™½ä¸æ‚¦ï¼Œä½†è¢«ä½ çš„è‰ºæœ¯é£éª¨æŠ˜æœã€‚ä½ çš„ç”»åœ¨åå£«åœˆä¸­å¤§å—å¥½è¯„ã€‚" }
                    ]
                },
                {
                    title: "ä¸åå®¶è¾©è‰º",
                    desc: "åœ¨ä¸€æ¬¡é›…é›†ä¸­ï¼Œä½ ä¸ä¸€ä½æˆåå·²ä¹…çš„ä¹¦æ³•å®¶åœ¨â€œç¬”æ³•â€ä¸Šäº§ç”Ÿäº†åˆ†æ­§ã€‚",
                    options: [
                        { text: "ã€é”‹èŠ’æ¯•éœ²ï¼Œä¸å…¶å…¬å¼€è¾©è®ºã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.wisdom > 100 && gs.player.attributes.talent > 100) {
                                return { text: "ä½ çš„ç†è®ºæ›´èƒœä¸€ç­¹ï¼Œå£°æœ›å¤§å¢ï¼Œä½†ä¹Ÿå½»åº•å¾—ç½ªäº†è¿™ä½åå®¶ã€‚", effects: { attributes: { reputation: 20 }, npc_relationship: { npc_key: 'master_calligrapher', favor: -40 } } };
                            }
                            return { text: "ä½ è¢«é©³å¾—ä½“æ— å®Œè‚¤ï¼Œæ²¦ä¸ºç¬‘æŸ„ã€‚", effects: { attributes: { reputation: -10 } } };
                        }},
                        { text: "ã€ç§ä¸‹äº¤æµï¼Œç‚¹åˆ°ä¸ºæ­¢ã€‘", effects: { attributes: { talent: 2, wisdom: 2 }, npc_relationship: { npc_key: 'master_calligrapher', favor: 10 } }, result_text: "ä½ ä»¬äº’ç›¸äº¤æµï¼Œå„æœ‰æ”¶è·ã€‚" }
                    ]
                },
                {
                    title: "å¼€è®¾ç§å¡¾æˆè¯¾",
                    desc: "ä½ çš„åæ°”å¸å¼•äº†ä¸€äº›å¹´è½»äººå‰æ¥æ‹œå¸ˆã€‚",
                    options: [
                        { text: "ã€æŸè„©ç™¾ä¸¤ï¼Œå€¾å›Šç›¸æˆã€‘", effects: { wealth: 100, flag: 'start_private_school' }, result_text: "ä½ è·å¾—ç¨³å®šçš„é“¶ä¸¤æ”¶å…¥ã€‚ä½ æ•™å¯¼çš„å­¦ç”Ÿä¸­ï¼Œæœ‰å‡ ç‡å‡ºç°â€œå¤©æ‰â€ï¼Œæœªæ¥ä¼šä¸ºä½ å¸¦æ¥å·¨å¤§çš„å£°æœ›å›æŠ¥ã€‚" },
                        { text: "ã€åˆ†æ–‡ä¸å–ï¼Œåªæ•™æœ‰ç¼˜äººã€‘", effects: { attributes: { virtue: 10, reputation: 10 }, flag: 'start_free_school' }, result_text: "ä½ çš„é«˜æ´ä¹‹åè¿œæ‰¬ï¼Œä½ çš„å­¦ç”Ÿå¯¹ä½ ç»å¯¹å¿ è¯šã€‚" }
                    ]
                },
                {
                    title: "é­é‡â€œæ–‡è´¼â€",
                    desc: "ä½ å‘ç°ä½ æœªå‘è¡¨çš„ä¸€é¦–è¯—ï¼Œè¢«ä¸€ä¸ªæ— è€»æ–‡äººå‰½çªƒï¼Œå¹¶å‡­æ­¤è¯—è·å¾—äº†èµèª‰ã€‚",
                    options: [
                        { text: "ã€æ‹¿å‡º[æ‰‹ç¨¿]ï¼Œå½“ä¼—æ­å‘ã€‘", requirements: { has_item: 'poem_manuscript' }, effects: { attributes: { reputation: 15 } }, result_text: "ä½ æˆåŠŸæ­éœ²äº†å¯¹æ–¹ï¼Œå£°æœ›æå‡ï¼Œä½†ä¹Ÿé™·å…¥äº†æ— ä¼‘æ­¢çš„éª‚æˆ˜ã€‚" },
                        { text: "ã€ç§ä¸‹è­¦å‘Šï¼Œä»¤å…¶è‡´æ­‰ã€‘", effects: { wealth: 1000 }, result_text: "å¯¹æ–¹ç§ä¸‹èµ”å¿ä½ 1000ä¸¤ï¼Œå¹¶æ‰¿è¯ºä¸å†çŠ¯ã€‚" },
                        { text: "ã€ä¸€ç¬‘ç½®ä¹‹ï¼Œå†ä½œä¸€é¦–æ›´å¥½çš„ã€‘", requirements: { xin_jing: 'æ¬æ·¡', talent: 120 }, effects: { attributes: { reputation: 20 } }, result_text: "ä½ çš„æ°”åº¦è¢«ä¼ ä¸ºä½³è¯ï¼Œå¹¶æ¶ˆè€—çµæ„Ÿç«‹å³åˆ›ä½œå‡ºä¸€é¦–å“è´¨æ›´é«˜çš„ä½œå“ã€‚" }
                    ]
                },
                {
                    title: "å—é‚€å“é‰´å¤ç©",
                    desc: "ä¸€ä½å¤§æ”¶è—å®¶è¯·ä½ å¸®å¿™é‰´å®šä¸€ä»¶æ–°å¾—çš„å¤è‘£ã€‚",
                    options: [
                        { text: "ã€å‡­å€Ÿå­¦è¯†è¿›è¡Œé‰´å®šã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.wisdom > 110) {
                                return { text: "ä½ å‡†ç¡®åœ°é‰´å®šå‡ºæ­¤ä¹ƒçœŸå“ï¼Œä»¤æ”¶è—å®¶å¤§ä¸ºèµèµã€‚", effects: { npc_relationship: { npc_key: 'collector', favor: 20 }, item: { id: 'gu_ji_shan_ben', amount: 1 } } };
                            }
                            return { text: "ä½ åˆ¤æ–­å¤±è¯¯ï¼Œé¢œé¢å°½å¤±ã€‚", effects: { attributes: { reputation: -10 } } };
                        }},
                        { text: "ã€ä½¿ç”¨[é‰´å®šç§˜ç±]ã€‘", requirements: { has_item: 'jian_ding_mi_ji' }, effects: { npc_relationship: { npc_key: 'collector', favor: 40 } }, result_text: "ä½ 100%é‰´å®šæˆåŠŸï¼Œå¹¶èƒ½è¯´å‡ºå…¶èƒŒåä¸ä¸ºäººçŸ¥çš„å…¸æ•…ï¼Œä»¤æ”¶è—å®¶å¤§ä¸ºæƒŠå¹ã€‚" }
                    ]
                },
                {
                    title: "é£æ ¼çš„ç“¶é¢ˆ",
                    desc: "ä½ çš„åˆ›ä½œé£æ ¼å¹¿ä¸ºäººçŸ¥ï¼Œä½†ä¹Ÿå¼€å§‹è¢«äººæ‰¹è¯„â€œä¸€æˆä¸å˜â€ã€‚",
                    options: [
                        { text: "ã€é—­å…³å¯»æ±‚çªç ´ã€‘", effects: { flag: 'seclusion_for_art' }, result_text: "ä½ å†³å®šé—­å…³ä¸€å¹´ï¼Œå¯»æ±‚è‰ºæœ¯ä¸Šçš„çªç ´ã€‚æˆåŠŸåˆ™é£æ ¼å¤§æˆï¼Œå¤±è´¥åˆ™å¯èƒ½èµ°ç«å…¥é­”ã€‚" },
                        { text: "ã€ä¸å…¶ä»–è‰ºæœ¯å®¶äº¤æµã€‘", effects: { core_resources: { ling_gan: 20 }, attributes: { talent: 5 } }, result_text: "ä¸ä¸åŒæµæ´¾çš„è‰ºæœ¯å®¶äº¤æµè®©ä½ è·å¾—äº†æ–°çš„çµæ„Ÿã€‚" }
                    ]
                },
                {
                    title: "æˆä¸ºçš‡å­ä¹‹å¸ˆ",
                    desc: "ä¸€ä½çš‡å­å¬é—»ä½ çš„æ‰åï¼Œå¸Œæœ›æ‹œä½ ä¸ºå¸ˆï¼Œå­¦ä¹ ä¹¦ç”»ã€‚",
                    options: [
                        { text: "ã€æ¥å—ã€‘", effects: { npc_relationship: { npc_key: 'prince_student', favor: 50 }, political_event: { type: 'align', faction: 'prince_student' } }, result_text: "ä½ æˆä¸ºäº†çš‡å­ä¹‹å¸ˆï¼Œä»æ­¤ä¸çš‡å®¶æ‰¯ä¸Šå…³ç³»ï¼Œè¿™æ˜¯ä¸€ä»½è£è€€ï¼Œä¹Ÿæ˜¯ä¸€ä»½å±é™©ã€‚" },
                        { text: "ã€å©‰æ‹’ã€‘", effects: {}, result_text: "ä½ ä»¥â€œé—²äº‘é‡é¹¤â€ä¸ºç”±å©‰æ‹’äº†ï¼Œä¿æŒäº†è‡ªç”±èº«ã€‚" }
                    ]
                },
                {
                    title: "ä½œå“è¢«ç¦",
                    desc: "ä½ çš„ä¸€éƒ¨ä½œå“å› é’ˆç ­æ—¶å¼Šï¼Œè¢«å®˜åºœåˆ—ä¸ºç¦ä¹¦ã€‚",
                    options: [
                        { text: "ã€ä¸Šä¹¦ç”³è¾©ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.virtue > 100) {
                                return { text: "ä½ çš„ç”³è¾©å¼•èµ·äº†æ¸…æµå®˜å‘˜çš„å…±é¸£ï¼Œç¦ä»¤æœ€ç»ˆè¢«è§£é™¤ã€‚", effects: { attributes: { reputation: 20 } } };
                            }
                            return { text: "ä½ çš„ç”³è¾©è¢«é©³å›ï¼Œå¹¶è¢«å®˜åºœè­¦å‘Šã€‚", effects: {} };
                        }},
                        { text: "ã€è®©ä½œå“åœ¨åœ°ä¸‹æµä¼ ã€‘", effects: { attributes: { reputation: 30, virtue: -5 } }, result_text: "ä½ çš„ä½œå“åœ¨æ°‘é—´è·å¾—äº†æ›´å¤§çš„å£°æœ›ï¼Œä½†ä¹Ÿè®©ä½ æˆä¸ºäº†æœå»·çš„çœ¼ä¸­é’‰ã€‚" }
                    ]
                },
                {
                    title: "ä¿®å¤å¤ç”»",
                    desc: "ä¸€å¹…ä»·å€¼è¿åŸçš„å‰æœå¤ç”»å—æŸï¼Œæ— äººèƒ½ä¿®ã€‚ä½ å†³å®šå°è¯•ä¸€ä¸‹ã€‚",
                    options: [
                        { text: "ã€è€—è´¹å¿ƒåŠ›è¿›è¡Œä¿®å¤ã€‘", requirements: { talent: 130, wisdom: 110 }, getOutcome: (gs) => {
                            if (Math.random() < 0.8) {
                                return { text: "ä½ æˆåŠŸä¿®å¤äº†å¤ç”»ï¼ŒæŠ€è‰ºéœ‡åŠ¨äº¬åŸï¼", effects: { attributes: { reputation: 50, talent: 10 } } };
                            }
                            return { text: "ä¿®å¤å¤±è´¥ï¼Œå¤ç”»å½»åº•æŸæ¯ï¼Œä½ å°†é¢ä¸´å·¨é¢èµ”å¿ã€‚", effects: { wealth: -10000 } };
                        }}
                    ]
                },
                {
                    title: "çº¢é¢œçŸ¥å·±çš„è¯·æ±‚",
                    desc: "ä½ çš„çº¢é¢œçŸ¥å·±ï¼ˆå¦‚ç”»èˆ«æ­Œå¦“ï¼‰é™·å…¥å›°å¢ƒï¼Œå‘ä½ æ±‚åŠ©ã€‚",
                    options: [
                        { text: "ã€ä¸ºå¥¹èµèº«ã€‘", cost: { wealth: 5000 }, effects: { npc_relationship: { npc_key: 'confidante', favor: 100 } }, result_text: "ä½ ä¸ºå¥¹èµèº«ï¼Œå¥¹å¯¹ä½ æ­»å¿ƒå¡Œåœ°ï¼Œä½ ä»¬çš„å…³ç³»æ›´è¿›ä¸€æ­¥ã€‚" },
                        { text: "ã€ä¸ºå¥¹å†™ä¸€é¦–è¯ã€‘", requirements: { talent: 120 }, effects: { npc_relationship: { npc_key: 'confidante', favor: 30 } }, result_text: "ä½ ä¸ºå¥¹å†™çš„è¯ä¼ éäº¬åŸï¼Œä»¤å¥¹èº«ä»·å€å¢ï¼Œæš‚æ—¶æ‘†è„±äº†å›°å¢ƒã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šå‘•å¿ƒæ²¥è¡€",
                trigger: { career_level: 6, text_desc: "ååŠ¨äº¬å, çµæ„Ÿ>500, æ‰æƒ…>150", condition: (gs) => (gs.career.core_resources.ling_gan || 0) > 500 && gs.player.attributes.talent > 150 },
                desc: "ä½ å†³å®šå°†æ¯•ç”Ÿæ‰€å­¦å€¾æ³¨äºä¸€éƒ¨ä½œå“ä¹‹ä¸Šã€‚ä½ å…³é—­ä¹¦æ–‹ï¼Œè°¢ç»æ‰€æœ‰è®¿å®¢ã€‚æ—¥å¤ä¸€æ—¥ï¼Œä½ åºŸå¯å¿˜é£Ÿï¼Œä¸ç¬”å¢¨ä¸ºä¼´ï¼Œä¸å­¤ç‹¬ä¸ºä¼ã€‚",
                success: { text: "ä½ åˆ›ä½œå‡ºäº†ä¸€éƒ¨[ä¼ ä¸–ä¹‹ä½œ]ï¼å®ƒä¸ºä½ æä¾›äº†å·¨é¢çš„æŒç»­å£°æœ›åŠ æˆã€‚ä½ å¯ä»¥é€‰æ‹©çŒ®ç»™çš‡å¸ã€é«˜ä»·å‡ºå”®æˆ–è‡ªå·±çè—ã€‚ä½ çš„ç§°å·å˜ä¸ºâ€œå¤§å®¶â€ã€‚", effects: { item: { id: 'chuan_shi_zhi_zuo', amount: 1 }, attributes: { reputation: 200 } } },
                failure: { text: "çµæ„Ÿæˆ–å¥åº·è€—å°½ï¼Œåˆ›ä½œå¤±è´¥ã€‚ä½ å¿ƒåŠ›äº¤ç˜ï¼Œå¤§ç—…ä¸€åœºï¼Œå¥åº·ä¸Šé™æ°¸ä¹…-10ã€‚", effects: { attributes: { health: -20, health_max: -10 } } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šä¸€ä»£å®—å¸ˆ",
            level_range: [8, 10],
            goal: "ä½ çš„ä½œå“å·²ç»ä¸æœ½ï¼Œç°åœ¨ä½ è¦è®©ä½ çš„æ€æƒ³å’Œé£æ ¼ä¼ æ‰¿ä¸‹å»ï¼Œæˆä¸ºä¸€ä¸ªæ—¶ä»£çš„æ–‡åŒ–ç¬¦å·ã€‚",
            events: [
                {
                    title: "å—çš‡å‘½ç¼–æ’°å…¸ç±",
                    desc: "çš‡å¸ä¸‹ä»¤ç¼–æ’°ä¸€éƒ¨ã€ŠXXå¤§å…¸ã€‹ï¼Œå¹¶ä»»å‘½ä½ ä¸ºå‰¯ä¸»ç¼–ã€‚",
                    options: [
                        { text: "ã€æ¬£ç„¶é¢†å‘½ã€‘", effects: { attributes: { reputation: 50 }, flag: 'imperial_editor_duty' }, result_text: "ä½ è¿›å…¥äº†å®˜æ–¹å­¦æœ¯ä½“ç³»ï¼Œå£°æœ›å’Œæ”¿æ²»å½±å“åŠ›å¤§å¢ã€‚ä½†ä½ å°†é•¿æœŸè¢«ç¹æ‚çš„å…¬åŠ¡ç¼ èº«ï¼Œå‡ ä¹æ²¡æœ‰æ—¶é—´è¿›è¡Œä¸ªäººåˆ›ä½œã€‚" },
                        { text: "ã€ä»¥â€œæ½œå¿ƒè‰ºæœ¯â€ä¸ºç”±å©‰æ‹’ã€‘", effects: { npc_relationship: { npc_key: 'emperor', favor: -10 } }, result_text: "ä½ ä¿æŒäº†æ–‡äººçš„ç‹¬ç«‹æ€§ï¼Œä½†å¯èƒ½è§¦æ€’çš‡å¸ã€‚" }
                    ]
                },
                {
                    title: "è¯„ä»·æ—¶æ”¿",
                    desc: "æœå»·æ¨è¡Œä¸€é¡¹æ–°æ”¿ï¼Œæ°‘é—´è®®è®ºçº·çº·ï¼Œä¸€ä»½æœ‰å½±å“åŠ›çš„æŠ¥åˆŠå‘ä½ çº¦ç¨¿ã€‚",
                    options: [
                        { text: "ã€æ’°æ–‡æ”¯æŒæ–°æ”¿ã€‘", effects: { flag: 'support_new_policy' }, result_text: "ä½ è·å¾—å½“æƒæ´¾çš„èµè¯†ã€‚è‹¥æ–°æ”¿æˆåŠŸï¼Œä½ å£°æœ›å¤§æ¶¨ã€‚è‹¥å¤±è´¥ï¼Œä½ åˆ™ä¼šä¸€åŒè¢«æ‰¹è¯„ã€‚" },
                        { text: "ã€æ’°æ–‡æ‰¹è¯„æ–°æ”¿ã€‘", effects: { attributes: { virtue: 15, reputation: 20 }, flag: 'criticize_new_policy' }, result_text: "ä½ æˆä¸ºç™¾å§“å’Œæ¸…æµçš„ä»£è¨€äººï¼Œä½†è¢«å½“æƒæ´¾è§†ä¸ºçœ¼ä¸­é’‰ã€‚" }
                    ]
                },
                {
                    title: "å¼€å®—ç«‹æ´¾",
                    desc: "ä½ çš„è‰ºæœ¯é£æ ¼å·²ç»æˆç†Ÿï¼Œè¿½éšè€…ä¼—å¤šã€‚",
                    options: [
                        { text: "ã€åˆ›ç«‹[è‡ªå®¶å§“æ°]æµæ´¾ã€‘", effects: { attributes: { reputation: 100 }, flag: 'school_founded' }, result_text: "ä½ æ­£å¼å¼€å®—ç«‹æ´¾ï¼ä½ çš„å£°æœ›è¾¾åˆ°é¡¶å³°ã€‚ä½ çš„â€œé—¨ç”Ÿâ€å°†éå¸ƒå¤©ä¸‹ï¼Œåœ¨æ–‡åŒ–ç•Œå½¢æˆä¸€è‚¡å·¨å¤§çš„åŠ¿åŠ›ã€‚" },
                        { text: "ã€è®¤ä¸ºä¸ºæ—¶å°šæ—©ã€‘", effects: {}, result_text: "ä½ é”™å¤±äº†è‰¯æœºï¼Œä½ çš„å‡ ä½å¤©æ‰å¼Ÿå­å¯èƒ½ä¼šè‡ªç«‹é—¨æˆ·ã€‚" }
                    ]
                },
                {
                    title: "æ‹’ç»å…¥ä»•é‚€è¯·",
                    desc: "å®°ç›¸äº²è‡ªç™»é—¨ï¼Œè®¸ä»¥â€œç¤¼éƒ¨å°šä¹¦â€ä¹‹ä½ï¼Œé‚€è¯·ä½ å…¥ä»•ã€‚",
                    options: [
                        { text: "ã€æ¥å—é‚€è¯·ï¼Œç”±æ–‡è½¬å®˜ã€‘", effects: { change_profession: 'civilian', start_level: 8 }, result_text: "ä½ çš„èŒä¸šè·¯å¾„å‘ç”Ÿæ”¹å˜ï¼Œè½¬ä¸ºã€æ–‡å®˜ã€‘è·¯çº¿ï¼Œç›´æ¥ä»é«˜çº§å®˜å‘˜å¼€å§‹ã€‚" },
                        { text: "ã€æ„Ÿè°¢åšçˆ±ï¼Œä½†å¿—ä¸åœ¨æ­¤ã€‘", effects: { attributes: { virtue: 30, reputation: 50 } }, result_text: "ä½ çš„é£éª¨è¢«å¤©ä¸‹ä¼ é¢‚ï¼Œå“å¾·å’Œå£°æœ›è¾¾åˆ°é¡¶å³°ã€‚" }
                    ]
                },
                {
                    title: "å¯»è®¿æ•…äºº",
                    desc: "åŠŸæˆåå°±åï¼Œä½ æ„Ÿåˆ°ä¸€ä¸ç–²æƒ«ï¼Œæƒ³èµ·äº†å¹´è½»æ—¶çš„çŸ¥å·±ã€‚",
                    options: [
                        { text: "ã€æ”¾ä¸‹ä¸€åˆ‡ï¼Œå‰å»å¯»è®¿ã€‘", effects: { core_resources: { xin_jing: 'æ¬æ·¡' }, attributes: { health: 20 } }, result_text: "ä½ ä¸æ•…å‹åœ¨å±±æ°´é—´é‡é€¢ï¼Œå¯¹é…Œé•¿è°ˆã€‚ä½ çš„å¿ƒå¢ƒæ°¸ä¹…å˜ä¸ºâ€œæ¬æ·¡â€ï¼Œå¥åº·ä¸Šé™+20ï¼Œè¿›å…¥åŠéšé€€çŠ¶æ€ã€‚" },
                        { text: "ã€ä¿—äº‹ç¼ èº«ï¼Œæ— æ³•è„±èº«ã€‘", effects: {}, result_text: "ä½ ç»§ç»­ç•™åœ¨ååˆ©åœºä¸­ï¼Œä½†å†…å¿ƒæ„Ÿåˆ°ä¸€ä¸å¤±è½ã€‚" }
                    ]
                },
                {
                    title: "ä½œå“çš„äº‰è®®",
                    desc: "ä½ çš„[ä¼ ä¸–ä¹‹ä½œ]å¼•å‘äº†å·¨å¤§çš„äº‰è®®ï¼Œä¿å®ˆæ´¾è®¤ä¸ºå…¶â€œæƒŠä¸–éª‡ä¿—â€ï¼Œæ”¹é©æ´¾åˆ™å¥‰ä¸ºåœ­è‡¬ã€‚",
                    options: [
                        { text: "ã€ä¸ä¿å®ˆæ´¾å…¬å¼€è¾©è®ºã€‘", effects: {}, result_text: "ä¸€åœºå¸­å·æ•´ä¸ªæ–‡åŒ–ç•Œçš„â€œæ–°æ—§ä¹‹äº‰â€å¼€å§‹äº†ã€‚" },
                        { text: "ã€ä¿æŒæ²‰é»˜ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©è®©ä½œå“è‡ªå·±è¯´è¯ã€‚" }
                    ]
                },
                {
                    title: "çš‡å¸çš„å¢¨å®",
                    desc: "çš‡å¸é‚€è¯·ä½ å…¥å®«ï¼Œä¸ä½ æ¢è®¨ä¹¦æ³•ï¼Œå¹¶å¸Œæœ›ä½ ä¸ºä»–æ–°å¾—çš„ä¸€å¹…ç”»é¢˜è·‹ã€‚",
                    options: [
                        { text: "ã€æ¬£ç„¶é¢˜è·‹ã€‘", requirements: { talent: 180 }, effects: { npc_relationship: { npc_key: 'emperor', favor: 20 } }, result_text: "ä½ çš„ä¹¦æ³•ä¸å¤ç”»ç›¸å¾—ç›Šå½°ï¼Œé¾™é¢œå¤§æ‚¦ã€‚" },
                        { text: "ã€å€ŸæœºåŠè°ã€‘", requirements: { virtue: 150 }, effects: { npc_relationship: { npc_key: 'emperor', favor: -10 } }, result_text: "ä½ å€Ÿé¢˜è·‹çš„æœºä¼šåŠè°çš‡å¸ï¼Œçš‡å¸è™½ä¸æ‚¦ï¼Œä½†å¯¹ä½ çš„èƒ†è¯†å°è±¡æ·±åˆ»ã€‚" }
                    ]
                },
                {
                    title: "å¼Ÿå­çš„æˆå°±",
                    desc: "ä½ æœ€å¾—æ„çš„ä¸€ä½å¼Ÿå­ï¼Œåœ¨ç§‘ä¸¾ä¸­é«˜ä¸­çŠ¶å…ƒã€‚",
                    options: [
                        { text: "ã€ä¸ºå…¶è®¾å®´åº†ç¥ã€‘", effects: { attributes: { reputation: 30 }, core_resources: { men_sheng: 1 } }, result_text: "â€œåå¸ˆå‡ºé«˜å¾’â€çš„ä½³è¯ä¼ éäº¬åŸï¼Œä½ çš„å£°æœ›å¤§æ¶¨ï¼Œå¹¶æ­£å¼æ”¶è·ä¸€ä½å®˜åœºé—¨ç”Ÿã€‚" }
                    ]
                },
                {
                    title: "æµ·å¤–çš„çŸ¥éŸ³",
                    desc: "ä¸€ä½ä¸œç€›æ¥çš„å­¦è€…ï¼Œæºå¸¦ä½ çš„ä½œå“æ‘¹æœ¬ï¼Œå‰æ¥å‘ä½ è¯·æ•™ã€‚",
                    options: [
                        { text: "ã€ä¸ä¹‹äº¤æµã€‘", effects: { flag: 'overseas_fame' }, result_text: "ä½ çš„æ€æƒ³å’Œè‰ºæœ¯å¼€å§‹åœ¨æµ·å¤–ä¼ æ’­ï¼Œå½±å“åŠ›è¿›ä¸€æ­¥æ‰©å¤§ã€‚" }
                    ]
                },
                {
                    title: "æœ€åçš„ç”»å·",
                    desc: "ä½ æ„Ÿåˆ°ç”Ÿå‘½å°†å°½ï¼Œå†³å®šç”»ä¸‹æœ€åä¸€å¹…ç”»ã€‚",
                    options: [
                        { text: "ã€ç”»ä¸‹æ•…ä¹¡çš„å±±æ°´ã€‘", effects: { core_resources: { xin_jing: 'æ¬æ·¡' } }, result_text: "è½å¶å½’æ ¹ï¼Œä½ çš„å¿ƒå¢ƒå½’äºå¹³é™ã€‚" },
                        { text: "ã€ç”»ä¸‹è‡ªå·±çš„è‡ªç”»åƒã€‘", effects: { core_resources: { xin_jing: 'æ¿€æ˜‚' } }, result_text: "ä½ å°†è‡ªå·±ä¸€ç”Ÿçš„ç²¾æ°”ç¥éƒ½èå…¥äº†ç”»ä¸­ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šå—å°â€œæ–‡å®—â€",
                trigger: { career_level: 9, text_desc: "å£°æœ›é¡¶å³°, æœ‰ä¼ ä¸–ä¹‹ä½œ, ä¸”æœ‰å­¦ç”Ÿé«˜ä¸­", condition: (gs) => gs.player.attributes.reputation > 1000 && gs.flags.has_masterpiece && gs.flags.student_is_successful },
                desc: "çš‡å®«å¤ªå’Œæ®¿å‰ï¼Œä¸¾è¡Œäº†å²æ— å‰ä¾‹çš„ç››å¤§ä»ªå¼ã€‚çš‡å¸äº²è‡ªä¸ºä½ èµä¸‹â€œæ–‡å®—â€çš„å°å·ã€‚ä½ çš„å­¦ç”Ÿä»¬â€”â€”å¦‚ä»Šå·²æ˜¯æœå»·æ ‹æ¢æˆ–è‰ºå›åå®¶â€”â€”é›†ä½“å‘ä½ è·ªæ‹œè¡Œç¤¼ã€‚",
                success: { text: "ä½ è¾¾åˆ°äº†æ–‡äººå¢¨å®¢èŒä¸šçš„ç»ˆç‚¹ï¼Œæˆä¸ºä¸æœ½çš„ä¼ å¥‡ï¼è§£é”ç‰¹æ®Šèƒ½åŠ›ã€ä¸¾èã€‘ï¼Œå¯ä»¥å‘çš‡å¸æ¨èäººæ‰ã€‚ä½ çš„å®¶æ—ä¹Ÿå› æ­¤è¢«å°ä¸ºâ€œä¹¦é¦™é—¨ç¬¬â€ã€‚", effects: { flag: 'unlock_recommendation_ability', end_game_title: 'ä¸€ä»£æ–‡å®—' } },
                failure: { text: "", effects: {} } // è¾¾æˆå‹ï¼Œæ— å¤±è´¥
            }
        }
    ]
},
'ranger': {
    name: "æ±Ÿæ¹–æ¸¸ä¾ ",
    icon: "fa-khanda",
    gender: "male",
    core_resources: ["xia_yi_zhi", "reputation", "nei_li"],
    dashboard_name: "æ±Ÿæ¹–èˆ†å›¾",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šåˆå‡ºèŒ…åº",
            level_range: [1, 4],
            goal: "å­¦ä¼šæ±Ÿæ¹–çš„ç”Ÿå­˜æ³•åˆ™ï¼Œå®Œæˆå‡ æ¬¡æœ‰å½±å“åŠ›çš„äº‹ä»¶ï¼Œç»“äº¤ç¬¬ä¸€æ‰¹æœ‹å‹ä¸æ•Œäººï¼Œä¸ºè‡ªå·±èµ¢å¾—ä¸€ä¸ªè¡Œèµ°æ±Ÿæ¹–çš„åˆæ­¥åå·ã€‚",
            events: [
                {
                    title: "è·¯è§ä¸å¹³",
                    desc: "ä¸€ä¼™åœ°ç—æ­£åœ¨å‘ä¸€ä¸ªè¡Œå•†ç´¢è¦é’±è´¢ã€‚",
                    location: ["å®˜é“", "ä¹¡é‡"],
                    options: [
                        { text: "ã€æ‹”åˆ€ç›¸åŠ©ï¼Œæ•™è®­åœ°ç—ã€‘", effects: { core_resources: { xia_yi_zhi: 10 }, attributes: { reputation: 5 }, wealth: 300 }, result_text: "ä¸€åœºç®€å•çš„æˆ˜æ–—åï¼Œä½ æ•™è®­äº†åœ°ç—ã€‚å•†äººæ„Ÿæ¿€ä½ ï¼Œèµ äºˆä½ 300ä¸¤ã€‚" },
                        { text: "ã€æš—ä¸­å‡ºæ‰‹ï¼ŒæƒŠèµ°åœ°ç—ã€‘", requirements: { wisdom: 50 }, effects: { core_resources: { xia_yi_zhi: 5 }, attributes: { wisdom: 2 } }, result_text: "ä½ ç”¨çŸ³å­ç­‰æŠ€å·§ï¼Œåˆ¶é€ æ··ä¹±å“è·‘äº†åœ°ç—ï¼Œå…µä¸è¡€åˆƒã€‚" },
                        { text: "ã€ä¸åœ°ç—è®²â€œé“ç†â€ã€‘", requirements: { charm: 60 }, effects: { attributes: { charm: 2, reputation: 5 } }, result_text: "ä½ ç”¨è¨€è¯­éœ‡æ…‘äº†å¯¹æ–¹ï¼Œè®©ä»–ä»¬çŸ¥éš¾è€Œé€€ã€‚" }
                    ]
                },
                {
                    title: "é»‘åº—é£æ³¢",
                    desc: "ä½ å–äº†ä¸€å£èŒ¶ï¼Œæ„Ÿè§‰å¤´æ™•ç›®çœ©ï¼Œç«‹åˆ»æ„è¯†åˆ°èŒ¶é‡Œæœ‰è’™æ±—è¯ã€‚",
                    location: ["é¾™é—¨å®¢æ ˆ"],
                    options: [
                        { text: "ã€å°†è®¡å°±è®¡ï¼Œå‡è£…æ™•å€’ã€‘", effects: { core_resources: { xia_yi_zhi: 5 }, attributes: { wisdom: 2 }, wealth: 1000, item: { id: 'tong_ji_fan_xing_zong', amount: 1 } }, result_text: "åœ¨åº—å®¶æœåˆ®ä½ è´¢ç‰©æ—¶ï¼Œä½ æš´èµ·å‘éš¾ï¼Œå°†ä¹‹ä¸€ç½‘æ‰“å°½ã€‚ä½ ç¼´è·1000ä¸¤å’Œä¸€å¼ [é€šç¼‰çŠ¯çš„è¡Œè¸ª]ã€‚" },
                        { text: "ã€è¿åŠŸé€¼å‡ºè¯ç‰©ï¼Œç›´æ¥æ€æ¡Œã€‘", cost: { core_resources: { nei_li: 50 } }, effects: { attributes: { health: -10 } }, result_text: "ä½ é™·å…¥äº†å›´æ”»ï¼Œè™½ç„¶æœ€ç»ˆè·èƒœï¼Œä½†ä¹Ÿæ¶ˆè€—å·¨å¤§ï¼Œå†…åŠ›è€—å°½ã€‚" }
                    ]
                },
                {
                    title: "å¬ä¹¦äººçš„æ•…äº‹",
                    desc: "èŒ¶é¦†é‡Œçš„è¯´ä¹¦äººæ­£åœ¨è®²ä¸€æ®µå…³äºâ€œå‰æœå¤§å°†å†›å®è—â€çš„è¯„ä¹¦ã€‚",
                    location: ["æ‰¬å·åŸ", "èŒ¶é¦†"],
                    options: [
                        { text: "ã€æ‰“èµ100ä¸¤ï¼Œç§ä¸‹è¯¢é—®ç»†èŠ‚ã€‘", cost: { wealth: 100 }, effects: { item: { id: 'cang_bao_tu_can_pian', amount: 1 }, flag: 'treasure_hunt_quest_started' }, result_text: "ä½ è·å¾—äº†[è—å®å›¾æ®‹ç‰‡ä¸€]ã€‚è¯´ä¹¦äººå‘Šè¯‰ä½ ï¼Œå¦å¤–çš„æ®‹ç‰‡å¯èƒ½åœ¨â€œä¸å¸®â€å’Œâ€œæŸä¸ªå¤å¢“â€é‡Œã€‚" },
                        { text: "ã€è®¤ä¸ºæ— ç¨½ä¹‹è°ˆï¼Œä¸€ç¬‘äº†ä¹‹ã€‘", effects: {}, result_text: "æ— äº‹å‘ç”Ÿï¼Œé”™å¤±äº†å¼€å¯å²è¯—ä»»åŠ¡çš„æœºä¼šã€‚" }
                    ]
                },
                {
                    title: "åˆ‡ç£‹æ­¦è‰º",
                    desc: "å½“åœ°æ­¦é¦†çš„é¦†ä¸»å¬é—»ä½ çš„åå£°ï¼Œå¸Œæœ›ä¸ä½ åˆ‡ç£‹ã€‚",
                    location: ["åŸé•‡æ­¦é¦†"],
                    options: [
                        { text: "ã€æ¬£ç„¶åº”å…ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.martial > 60) {
                                // èƒœåˆ©åçš„å­é€‰é¡¹
                                return {
                                    sub_decision: {
                                        desc: "ä½ è½»æ¾å–èƒœï¼Œé¦†ä¸»å¯¹ä½ æŠ±æ‹³è®¤è¾“ã€‚ä½ æ‰“ç®—...",
                                        options: [
                                            { text: "ã€ç‚¹åˆ°ä¸ºæ­¢ã€‘", effects: { npc_relationship: { npc_key: 'gym_master', favor: 20 }, attributes: { martial: 2 } }, result_text: "ä½ çš„æ°”åº¦èµ¢å¾—äº†é¦†ä¸»çš„å°Šæ•¬ã€‚" },
                                            { text: "ã€å°†å…¶é‡åˆ›ã€‘", effects: { core_resources: { xia_yi_zhi: -15 }, attributes: { reputation: 5 } }, result_text: "ä½ çš„æ‰‹æ®µç‹ è¾£ï¼Œä»¤äººç•æƒ§ï¼Œä¸è¯¥æ­¦é¦†ç»“ä»‡ã€‚" }
                                        ]
                                    }
                                };
                            }
                            return { text: "ä½ å­¦è‰ºä¸ç²¾ï¼Œè´¥ä¸‹é˜µæ¥ã€‚", effects: { attributes: { health: -5 } } };
                        }}
                    ]
                },
                {
                    title: "æ‚¬èµæ¦œ",
                    desc: "åŸé—¨å£è´´ç€å®˜åºœå’Œæ±Ÿæ¹–é—¨æ´¾çš„æ‚¬èµä»¤ã€‚",
                    location: ["ä»»æ„åŸé•‡"],
                    options: [
                        { text: "ã€æ¥å–â€œå‰¿ç­é‡ç‹¼å¸®â€ã€‘", effects: { flag: 'start_quest_wolf_gang' }, result_text: "ä½ æ¥ä¸‹äº†ä»»åŠ¡ï¼Œå¼€å¯äº†ä¸€æ®µæˆ˜æ–—ä»»åŠ¡ã€‚" },
                        { text: "ã€æ¥å–â€œå¯»å›ã€Šå…°äº­åºã€‹â€ã€‘", effects: { flag: 'start_quest_lanting_scroll' }, result_text: "ä½ æ¥ä¸‹äº†ä»»åŠ¡ï¼Œå¼€å¯äº†ä¸€æ®µéœ€è¦æ™ºæ…§å’Œäººè„‰çš„ä¾¦æŸ¥ä»»åŠ¡ã€‚" }
                    ]
                },
                {
                    title: "æ·±å±±å¥‡é‡",
                    desc: "ä½ åœ¨æ·±å±±ä¸­è¿·è·¯ï¼Œæ— æ„é—´å‘ç°ä¸€ä¸ªéšç§˜çš„å±±æ´ã€‚",
                    options: [
                        { text: "ã€è¿›å…¥å±±æ´æ¢ç´¢ã€‘", getOutcome: (gs) => {
                            if (Math.random() < 0.3) {
                                return { text: "å±±æ´ä¸­ç«Ÿæœ‰å‰äººç•™ä¸‹çš„æ­¦åŠŸç§˜ç±ï¼ä½ è·å¾—äº†[ã€ŠåŸºç¡€å†…åŠŸã€‹]ã€‚", effects: { item: { id: 'basic_neigong', amount: 1 }, core_resources: { nei_li: 10 } } };
                            } else if (Math.random() < 0.6) {
                                return { text: "ä½ åœ¨å±±æ´ä¸­å‘ç°äº†ä¸€æ ªçç¨€çš„è¯è‰ã€‚", effects: { item: { id: 'rare_herb', amount: 1 } } };
                            }
                            return { text: "å±±æ´é‡Œç©ºæ— ä¸€ç‰©ã€‚", effects: {} };
                        }}
                    ]
                },
                {
                    title: "ç»“è¯†ä¸€ä½æ•å¿«",
                    desc: "ä½ å› ä¸€æ¬¡è§ä¹‰å‹‡ä¸ºï¼Œç»“è¯†äº†ä¸€ä½å®˜åºœçš„æ•å¿«ã€‚",
                    options: [
                        { text: "ã€ä¸å…¶ç»“äº¤ã€‘", effects: { social: 'expand' }, result_text: "ä½ ä¸å®˜åºœå»ºç«‹åˆæ­¥è”ç³»ï¼Œæœªæ¥æˆ–è®¸èƒ½è·å¾—ä¸€äº›å¸®åŠ©ã€‚" },
                        { text: "ã€ä¿æŒè·ç¦»ã€‘", effects: {}, result_text: "ä½ è®¤ä¸ºâ€œæ±Ÿæ¹–æœå ‚ï¼Œä¸¤ä¸ç›¸å¹²â€ã€‚" }
                    ]
                },
                {
                    title: "é…’é¦†é‡Œçš„å†²çª",
                    desc: "é…’é¦†é‡Œï¼Œä¸¤ä¸ªæ±Ÿæ¹–é—¨æ´¾çš„å¼Ÿå­å› å£è§’å°†è¦åŠ¨æ‰‹ã€‚",
                    options: [
                        { text: "ã€å‡ºé¢è°ƒè§£ã€‘", requirements: { charm: 60 }, effects: { core_resources: { xia_yi_zhi: 5 }, attributes: { reputation: 5 } }, result_text: "ä½ çš„è°ƒè§£å¹³æ¯äº†çº·äº‰ï¼ŒåŒæ–¹éƒ½å¯¹ä½ å¿ƒå­˜æ„Ÿæ¿€ã€‚" },
                        { text: "ã€å¸®åŠ©å¼±åŠ¿ä¸€æ–¹ã€‘", effects: { core_resources: { xia_yi_zhi: 10 } }, result_text: "ä½ è¡Œä¾ ä»—ä¹‰ï¼Œä½†å¾—ç½ªäº†å¦ä¸€ä¸ªé—¨æ´¾ã€‚" },
                        { text: "ã€åå±±è§‚è™æ–—ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©ä¸ä»‹å…¥ï¼Œå†·çœ¼æ—è§‚ã€‚" }
                    ]
                },
                {
                    title: "ä¼ªè£…ä¸æ½œè¡Œ",
                    desc: "ä¸ºäº†æ¢å¬ä¸€ä¸ªå±±å¯¨çš„æƒ…æŠ¥ï¼Œä½ éœ€è¦ä¼ªè£…æ½œå…¥ã€‚",
                    options: [
                        { text: "ã€ä¼ªè£…æˆä¼™å¤«ã€‘", requirements: { wisdom: 50 }, getOutcome: (gs) => {
                            if (Math.random() < 0.8) {
                                return { text: "ä½ æˆåŠŸæ½œå…¥ï¼Œå¹¶æ¢å¬åˆ°äº†å±±å¯¨çš„å¸ƒé˜²å›¾ã€‚", effects: { core_resources: { qing_bao: 10 } } };
                            }
                            return { text: "ä½ çš„ä¼ªè£…è¢«è¯†ç ´ï¼Œä¸€ç•ªè‹¦æˆ˜åæ‰å¾—ä»¥è„±èº«ã€‚", effects: { attributes: { health: -10 } } };
                        }}
                    ]
                },
                {
                    title: "è´­ä¹°å…µå™¨",
                    desc: "ä½ éœ€è¦ä¸€æŠŠè¶æ‰‹çš„å…µå™¨ã€‚",
                    options: [
                        { text: "ã€åœ¨é“åŒ é“ºè´­ä¹°ã€‘", cost: { wealth: 300 }, effects: { item: { id: 'good_sword', amount: 1 } }, result_text: "ä½ è·å¾—äº†ä¸€æŠŠä¸é”™çš„é’¢å‰‘ã€‚" },
                        { text: "ã€å¯»æ‰¾ä¼ è¯´ä¸­çš„é“¸å‰‘å¸ˆã€‘", effects: { flag: 'quest_for_master_smith' }, result_text: "ä½ å¼€å¯äº†ä¸€æ¡å¯»æ‰¾ä¼ è¯´é“¸å‰‘å¸ˆçš„ä»»åŠ¡çº¿ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šè¡€æˆ˜é»‘é£å¯¨",
                trigger: { career_level: 3, text_desc: "æ­¦å­¦>100, ä¾ ä¹‰å€¼>50", condition: (gs) => gs.player.attributes.martial > 100 && (gs.career.core_resources.xia_yi_zhi || 0) > 50 },
                desc: "é»‘é£å¯¨ç›˜è¸é™©å±±ï¼Œä¸ºç¥¸ä¸€æ–¹ã€‚ä½ å†³å®šè”ç»œæœ¬åœ°ä¹¡å‹‡ï¼Œäº²è‡ªå¯¼æ¼”ä¸€åœºä»¥å¼±èƒœå¼ºçš„ç»å…¸æˆ˜å½¹ã€‚",
                success: { text: "ä½ æˆä¸ºäº†æ–¹åœ†ç™¾é‡Œçš„è‹±é›„ï¼å£°æœ›æš´æ¶¨ï¼Œè·å¾—æ±Ÿæ¹–åå·â€œé»‘é£å…‹æ˜Ÿâ€ï¼Œå¹¶ä»å±±å¯¨å®åº“ä¸­è·å¾—å¤§é‡é“¶ä¸¤å’Œ[å¯¨ä¸»çš„é¬¼å¤´åˆ€]ï¼", effects: { career_level_set: 4, attributes: { reputation: 150 }, core_resources: { xia_yi_zhi: 50 }, wealth: 5000, item: { id: 'zhai_zhu_gui_tou_dao', amount: 1 } } },
                failure: { text: "å‰¿åŒªå¤±è´¥ï¼Œä½ é‡ä¼¤è€Œå½’ï¼Œè”ç»œçš„ä¹¡å‹‡æ­»ä¼¤æƒ¨é‡ï¼Œä½ åœ¨å½“åœ°çš„å£°èª‰ä¸€è½åƒä¸ˆã€‚", effects: { attributes: { reputation: -20, health_max: -5 } } }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šååŠ¨ä¸€æ–¹",
            level_range: [5, 7],
            goal: "ä½ çš„åå­—å¼€å§‹åœ¨æ±Ÿæ¹–æµä¼ ã€‚ä½ éœ€è¦ç»“äº¤åé—¨æ­£æ´¾ï¼ŒæŒ‘æˆ˜æˆåé«˜æ‰‹ï¼Œå·å…¥æ›´æ·±å±‚æ¬¡çš„æ±Ÿæ¹–æ©æ€¨ï¼Œå¹¶å¯»æ‰¾å±äºè‡ªå·±çš„ç¥å…µæˆ–ç§˜ç±ã€‚",
            events: [
                {
                    title: "é—¨æ´¾çš„é‚€è¯·",
                    desc: "æ­¦å½“æ´¾å¬é—»ä½ çš„ä¾ åï¼ŒæŒé—¨äº²ä¹¦ä¸€å°ï¼Œé‚€è¯·ä½ ä¸Šå±±åšå®¢ã€‚",
                    options: [
                        { text: "ã€æ¬£ç„¶èµ´çº¦ã€‘", effects: { attributes: { wisdom: 5 }, core_resources: { nei_li: 10 } }, result_text: "ä½ åœ¨æ­¦å½“å±±ç›˜æ¡“æ•°æœˆï¼Œä¸é“é•¿ä»¬è®ºé“è°ˆæ­¦ï¼Œå†…åŠ›ä¸Šé™å¢åŠ ã€‚" },
                        { text: "ã€èµ é€åšç¤¼å¹¶èµ´çº¦ã€‘", cost: { wealth: 1000 }, effects: { flag: 'wudang_skill_learned' }, result_text: "æŒé—¨å¤§æ‚¦ï¼Œç”šè‡³å…è®¸ä½ è¿›å…¥è—ç»é˜é˜…è¯»ï¼Œä½ æœ‰å‡ ç‡å­¦åˆ°æ­¦å½“æ´¾çš„ä¸€æ‹›å¼ºåŠ›æŠ€èƒ½ã€‚" },
                        { text: "ã€å©‰è¨€è°¢ç»ã€‘", effects: {}, result_text: "ä½ ä¿æŒäº†ç‹¬è¡Œä¾ çš„èº«ä»½ï¼Œä½†ä¹Ÿé”™å¤±äº†ä¸åé—¨æ­£æ´¾ç»“äº¤çš„æœ€å¥½æœºä¼šã€‚" }
                    ]
                },
                {
                    title: "è‹±é›„å¤§ä¼š",
                    desc: "ä¸å¸®å¹¿å‘è‹±é›„å¸–ï¼Œäºå›å±±å¬å¼€è‹±é›„å¤§ä¼šï¼Œå…±å•†æ±Ÿæ¹–å¤§äº‹ã€‚",
                    options: [
                        { text: "ã€é«˜è°ƒå‚ä¸ï¼Œç«é€‰èŒä½ã€‘", requirements: { reputation: 300 }, getOutcome: (gs) => {
                            if(gs.player.attributes.charm > 100 && (gs.career.core_resources.wei_wang || 0) > 100) {
                                return { text: "ä½ æˆåŠŸå½“é€‰ä¸ºâ€œå‰¯èˆµä¸»â€ï¼Œè·å¾—è°ƒåŠ¨éƒ¨åˆ†ä¸å¸®å¼Ÿå­çš„èƒ½åŠ›ã€‚", effects: { attributes: { reputation: 50 } } };
                            }
                            return { text: "ä½ ä¸è‡ªé‡åŠ›ï¼Œé­åˆ°ç¾¤é›„è€»ç¬‘ã€‚", effects: {} };
                        }},
                        { text: "ã€å¹¿äº¤æœ‹å‹ï¼Œæ‰“æ¢æ¶ˆæ¯ã€‘", effects: { social: 'expand', item: {id: 'qing_bao_si_sheng_huo', amount: 1} }, result_text: "ä½ ç»“è¯†äº†æ•°ä½æ±Ÿæ¹–è±ªæ°ï¼Œäººè„‰å›¾è°±æå¤§æ‰©å¼ ï¼Œå¹¶è·å¾—ä¸€ä»½å…³äºé­”æ•™åŠ¨å‘çš„æƒ…æŠ¥ã€‚" }
                    ]
                },
                {
                    title: "ç§˜ç±çš„æ®‹é¡µ",
                    desc: "ä½ ä»ä¸€ä¸ªæ¿’æ­»çš„æ¶è´¼èº«ä¸Šï¼Œæœåˆ°äº†ä¸€å¼ [ã€Šä¹é˜³ç¥åŠŸã€‹æ®‹é¡µ]ï¼",
                    options: [
                        { text: "ã€æ¶ˆæ¯æ³„éœ²ï¼Œè¢«ä¼—äººè¿½æ€ã€‘", effects: { flag: 'hunted_for_scroll' }, result_text: "åœ¨æ¥ä¸‹æ¥çš„æ¸¸å†ä¸­ï¼Œä½ ä¼šä¸æ–­é­åˆ°å„è·¯é«˜æ‰‹çš„è¿½æ€ï¼Œä½†è‹¥èƒ½å…¨éƒ¨å‡»è´¥ï¼Œæ­¦å­¦å°†é£é€Ÿæˆé•¿ã€‚" },
                        { text: "ã€å¯»æ‰¾éšç§˜ä¹‹åœ°ï¼Œæ½œå¿ƒä¿®ç‚¼ã€‘", effects: { flag: 'player_in_seclusion_2_years' }, result_text: "ä½ å°†é—­å…³ä¸¤å¹´ã€‚æˆåŠŸåï¼Œå†…åŠ›å¤§å¢ï¼Œå¹¶å­¦ä¼šéƒ¨åˆ†ç¥åŠŸã€‚" }
                    ]
                },
                {
                    title: "ç¥å…µçš„çº¿ç´¢",
                    desc: "ä½ åœ¨æ¢è®¿â€œé“¸å‰‘å±±åº„â€æ—¶ï¼Œå¬é—»åº„ä¸»æ­£åœ¨ä¸ºå¯»è®¿å¤©å¤–é™¨é“è€Œçƒ¦æ¼ã€‚",
                    options: [
                        { text: "ã€åŠ©å…¶å¯»è®¿é™¨é“ã€‘", effects: { flag: 'start_quest_divine_weapon' }, result_text: "ä½ å¼€å¯äº†ä¸€æ¡è‰°éš¾çš„å¯»ç‰©ä»»åŠ¡ã€‚å®Œæˆåï¼Œåº„ä¸»ä¼šä¸ºä½ é”»é€ ä¸€æŸ„ç‹¬ä¸€æ— äºŒçš„ç¥å…µã€‚" },
                        { text: "ã€è¯•å›¾ç›—å–å±±åº„çš„å®å‰‘ã€‘", getOutcome: (gs) => {
                            if(gs.player.attributes.wisdom > 100 && gs.player.attributes.health > 80) {
                                return { text: "ä½ æˆåŠŸç›—å–ä¸€æŠŠå®å‰‘ï¼Œä½†ä¸é“¸å‰‘å±±åº„ç»“ä¸ºæ­»æ•Œã€‚", effects: { item: { id: 'fine_sword', amount: 1 } } };
                            }
                            return { text: "ä½ è¢«å‘ç°ï¼Œé‡ä¼¤é€ƒèµ°ã€‚", effects: { attributes: { health: -20 } } };
                        }}
                    ]
                },
                {
                    title: "æ¥è‡ªæœå»·çš„å…³æ³¨",
                    desc: "ä½ æ‰€åœ¨åœ°çš„çŸ¥åºœï¼Œæ´¾äººè¯·ä½ å»åºœè¡™ä¸€å™ã€‚",
                    options: [
                        { text: "ã€å‰å¾€èµ´å®´ï¼Œæ¢å…¶è™šå®ã€‘", getOutcome: (gs) => ({
                            sub_decision: {
                                desc: "çŸ¥åºœå¯¹ä½ è¿›è¡Œâ€œæ‹›å®‰â€ï¼Œè®¸è¯ºç»™ä½ â€œéƒ½å°‰â€ä¹‹èŒã€‚ä½ æ˜¯å¦æ¥å—ï¼Ÿ",
                                options: [
                                    { text: "ã€æ¥å—æ‹›å®‰ã€‘", effects: { change_profession: 'warrior', start_level: 5 }, result_text: "ä½ çš„äººç”Ÿè½¨è¿¹æ”¹å˜ï¼Œæˆä¸ºäº†ä¸€åæ­¦å°†ã€‚" },
                                    { text: "ã€å©‰è¨€æ‹’ç»ã€‘", effects: {}, result_text: "ä½ æ‹’ç»äº†çŸ¥åºœï¼Œä¸å®˜åºœå…³ç³»å˜å¾—ç´§å¼ ã€‚" }
                                ]
                            }
                        })},
                        { text: "ã€è®¤ä¸ºè¿™æ˜¯é™·é˜±ï¼Œæ‹’ä¸å‰å¾€ã€‘", effects: { flag: 'government_wanted' }, result_text: "çŸ¥åºœè®¤ä¸ºä½ è—è§†æœå»·ï¼Œå°†ä½ åˆ—ä¸ºâ€œä¸å®‰å®šåˆ†å­â€ï¼Œä½ åœ¨è¯¥åœ°åŒºçš„è¡ŒåŠ¨ä¼šå—åˆ°å®˜åºœçš„ç›‘è§†å’Œé˜»æŒ ã€‚" }
                    ]
                },
                {
                    title: "é­”æ•™çš„è¸ªè¿¹",
                    desc: "ä½ å‘ç°æœ‰é­”æ•™ä¸­äººåœ¨é™„è¿‘æ´»åŠ¨ï¼Œè¡Œè¸ªè¯¡ç§˜ã€‚",
                    options: [
                        { text: "ã€é€šæŠ¥æ­£é“é—¨æ´¾ã€‘", effects: { npc_relationship: { npc_key: 'wudang_master', favor: 10 } }, result_text: "ä½ è·å¾—äº†æ­£é“é—¨æ´¾çš„æ„Ÿè°¢ã€‚" },
                        { text: "ã€ç‹¬è‡ªè·Ÿè¸ªã€‘", requirements: { wisdom: 100 }, effects: { core_resources: { qing_bao: 20 } }, result_text: "ä½ è‰ºé«˜äººèƒ†å¤§ï¼ŒæˆåŠŸæ¢å¬åˆ°äº†é­”æ•™çš„ä¸€ä¸ªç§˜å¯†æ®ç‚¹ã€‚" }
                    ]
                },
                {
                    title: "æ‹¯æ•‘è¢«åŠ«é•–é“¶",
                    desc: "æŒ¯è¿œé•–å±€çš„ä¸€è¶Ÿé•–è¢«åŠ«ï¼Œä½ å†³å®šå‡ºæ‰‹ç›¸åŠ©ã€‚",
                    options: [
                        { text: "ã€è¿½å›é•–é“¶ã€‘", requirements: { martial: 130 }, effects: { wealth: 2000, core_resources: { xia_yi_zhi: 20 }, npc_relationship: { npc_key: 'biao_ju_master', favor: 30 } }, result_text: "ä½ æˆåŠŸè¿½å›é•–é“¶ï¼Œè·å¾—äº†ä¸°åšçš„æŠ¥é…¬å’ŒæŒ¯è¿œé•–å±€çš„å‹è°Šã€‚" }
                    ]
                },
                {
                    title: "å¤å¢“æ¢é™©",
                    desc: "ä½ æ ¹æ®[è—å®å›¾æ®‹ç‰‡]çš„çº¿ç´¢ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå‰æœå°†å†›çš„é™µå¢“ã€‚",
                    options: [
                        { text: "ã€è¿›å…¥æ¢é™©ã€‘", effects: { flag: 'tomb_raiding' }, result_text: "é™µå¢“ä¸­æœºå…³é‡é‡ï¼Œä½†ä¹Ÿå¯èƒ½è—æœ‰ç»ä¸–çå®ã€‚" }
                    ]
                },
                {
                    title: "ååŒ»çš„æ±‚åŠ©",
                    desc: "ä¸€ä½ååŒ»éœ€è¦ä¸€å‘³ç”Ÿé•¿åœ¨æ‚¬å´–å³­å£ä¸Šçš„çç¨€è¯æï¼Œå¸Œæœ›ä½ èƒ½å¸®å¿™é‡‡æ‘˜ã€‚",
                    options: [
                        { text: "ã€æ…¨ç„¶ç›¸åŠ©ã€‘", requirements: { health: 120 }, effects: { core_resources: { xia_yi_zhi: 15 }, item: { id: 'rare_medicine', amount: 1 }, npc_relationship: { npc_key: 'famous_doctor', favor: 40 } }, result_text: "ä½ æˆåŠŸé‡‡å›è¯æï¼Œä¸ä»…è·å¾—äº†ååŒ»çš„å‹è°Šï¼Œè¿˜å¾—åˆ°äº†ä¸€äº›ä¿å‘½ä¸¹è¯ã€‚" }
                    ]
                },
                {
                    title: "æ—§å‹çš„èƒŒå›",
                    desc: "ä¸€ä½ä½ æ›¾ç»ä¿¡ä»»çš„æœ‹å‹ï¼Œä¸ºäº†åˆ©ç›Šå‡ºå–äº†ä½ ï¼Œå°†ä½ çš„è¡Œè¸ªæ³„éœ²ç»™äº†ä½ çš„ä»‡å®¶ã€‚",
                    options: [
                        { text: "ã€æ¸…ç†é—¨æˆ·ã€‘", effects: { core_resources: { xia_yi_zhi: -10 }, attributes: { virtue: -10 } }, result_text: "ä½ æ€æ­»äº†èƒŒå›è€…ï¼Œä½†ä¹Ÿè®©ä½ çš„åå£°æŸ“ä¸Šäº†è¡€è…¥ã€‚" },
                        { text: "ã€ä¸ä¹‹ä¸€åˆ€ä¸¤æ–­ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©ä¸ä»–æ©æ–­ä¹‰ç»ï¼Œä»æ­¤æ±Ÿæ¹–ä¸è§ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šæ³°å±±ä¹‹å·…",
                trigger: { career_level: 6, text_desc: "ååŠ¨ä¸€æ–¹, å£°æœ›>500, æœ‰é«˜çº§æ­¦å­¦", condition: (gs) => gs.player.attributes.reputation > 500 && gs.flags.has_advanced_skill },
                desc: "æ³°å±±ä¹‹å·…ï¼Œäº‘æµ·ç¿»æ¶Œã€‚ä½ ä¸æˆåå·²ä¹…çš„â€œåµ©å±±å‰‘æ´¾æŒé—¨â€ç›¸å¯¹è€Œç«‹ã€‚å±±ä¸‹ï¼Œæ— æ•°æ±Ÿæ¹–äººå£«å‰æ¥è§‚æˆ˜ã€‚è¿™ä¸€æˆ˜ï¼Œå°†å†³å®šè°æ‰æ˜¯ä¸­åŸå‰‘æœ¯çš„ç¿˜æ¥šã€‚",
                success: { text: "ä½ èµ¢äº†ï¼æ­£å¼è·»èº«æ±Ÿæ¹–ä¸€æµé«˜æ‰‹çš„è¡Œåˆ—ï¼Œåå·å˜å¾—æ›´åŠ å“äº®ã€‚", effects: { career_level_set: 7, attributes: { reputation: 100 }, core_resources: { xia_yi_zhi: 30 } } },
                failure: { text: "ä½ è´¥äº†ã€‚é‡ä¼¤é€€éšåŠå¹´ï¼Œæ­¦å­¦å’Œå£°æœ›å¤§å¹…ä¸‹é™ã€‚", effects: { attributes: { reputation: -50, martial: -10 } } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šæ­¦æ—ç¥è¯",
            level_range: [8, 10],
            goal: "ä½ çš„å­˜åœ¨æœ¬èº«å°±æ˜¯ä¸€æ®µä¼ å¥‡ã€‚ä½ è¦ä¹ˆæˆä¸ºç»´ç³»æ­¦æ—ç§©åºçš„æ³°å±±åŒ—æ–—ï¼Œè¦ä¹ˆæˆä¸ºé¢ è¦†ä¸€åˆ‡çš„ç»ä¸–æ­é›„ã€‚",
            events: [
                {
                    title: "ç»„å»ºè‡ªå·±çš„åŠ¿åŠ›",
                    desc: "è¿½éšä½ çš„æ±Ÿæ¹–è±ªæ°è¶Šæ¥è¶Šå¤šï¼Œä½ å¯ä»¥é€‰æ‹©å»ºç«‹è‡ªå·±çš„é—¨æ´¾ã€‚",
                    options: [
                        { text: "ã€åœ¨[é»‘é£å¯¨]æ—§å€ï¼Œåˆ›ç«‹[ä½ çš„å§“æ°]é—¨ã€‘", cost: { wealth: 20000 }, effects: { flag: 'unlock_sect_management' }, result_text: "ä½ å¼€å¯äº†â€œé—¨æ´¾ç»è¥â€ç©æ³•ï¼Œéœ€è¦ç®¡ç†é—¨æ´¾èµ„æºã€æ‹›å‹Ÿå¼Ÿå­ã€åº”å¯¹å…¶ä»–é—¨æ´¾çš„æŒ‘æˆ˜ã€‚" },
                        { text: "ã€ä¿æŒç°çŠ¶ï¼Œç»§ç»­ç‹¬è¡Œã€‘", effects: {}, result_text: "ä½ ä¿æŒäº†è‡ªç”±ï¼Œä½†ä¹Ÿå¤±å»äº†ä¸€è‚¡å¯ä»¥ä¾é çš„åŠ¿åŠ›ã€‚" }
                    ]
                },
                {
                    title: "å¤–æ—å…¥ä¾µï¼Œä¾ ä¹‹å¤§è€…",
                    desc: "å¤–æ—å¤§ä¸¾å…¥ä¾µï¼Œå›½å®¶é™·å…¥å±æœºï¼Œæœå»·å†›é˜ŸèŠ‚èŠ‚è´¥é€€ã€‚",
                    options: [
                        { text: "ã€æŒ¯è‡‚ä¸€å‘¼ï¼Œå…±å¾¡å¤–æ•Œã€‘", requirements: { xia_yi_zhi: 500 }, effects: { attributes: { reputation: 200 }, core_resources: { xia_yi_zhi: 100 } }, result_text: "ä½ ç»„ç»‡äº†ä¸€æ”¯ä¹‰å†›ï¼Œåœ¨æ•Œåå±•å¼€æ¸¸å‡»ï¼Œä¸ºæœå»·äº‰å–äº†å®è´µçš„æ—¶é—´ã€‚ä½ è¢«å°Šä¸ºâ€œå¤§ä¾ â€ã€‚" },
                        { text: "ã€è®¤ä¸ºè¿™æ˜¯æœå»·çš„äº‹ï¼Œæ±Ÿæ¹–ä¸åº”æ’æ‰‹ã€‘", effects: { attributes: { reputation: -50 } }, result_text: "ä½ åœ¨æ±Ÿæ¹–ä¸­çš„å£°æœ›ä¼šå› â€œç¼ºä¹æ°‘æ—å¤§ä¹‰â€è€Œå—æŸã€‚" }
                    ]
                },
                {
                    title: "æ­¦æ—æµ©åŠ«çš„é˜´è°‹",
                    desc: "ä½ å‘ç°ä¸€ä¸ªç¥ç§˜çš„â€œå¤©ç†æ•™â€æ­£åœ¨æš—ä¸­æŒ‘æ‹¨å„å¤§é—¨æ´¾ï¼Œå¹¶è¯•å›¾ç”¨æ¯’è¯æ§åˆ¶æ•´ä¸ªæ­¦æ—ã€‚",
                    options: [
                        { text: "ã€è”åˆå„å¤§é—¨æ´¾ï¼Œå…±åŒå¯¹æŠ—ã€‘", effects: { flag: 'start_quest_wulin_holocaust' }, result_text: "ä½ å¼€å¯äº†ä¸€æ¡å²è¯—ä»»åŠ¡é“¾ï¼Œéœ€è¦ç©¿æ¢­äºå„å¤§é—¨æ´¾ä¹‹é—´ï¼ŒåŒ–è§£æ©æ€¨ï¼Œè¯´æœä»–ä»¬è”æ‰‹ã€‚" },
                        { text: "ã€å•æªåŒ¹é©¬ï¼Œç›´æ£é»„é¾™ã€‘", effects: { flag: 'start_quest_solo_holocaust' }, result_text: "ä½ é€‰æ‹©äº†ä¸€æ¡æåº¦å±é™©ä½†å……æ»¡ä¸ªäººè‹±é›„ä¸»ä¹‰çš„è·¯çº¿ã€‚" }
                    ]
                },
                {
                    title: "é‡‘ç›†æ´—æ‰‹",
                    desc: "åŒå€¦äº†æ±Ÿæ¹–çº·äº‰ï¼Œä½ å†³å®šé€€éšã€‚",
                    options: [
                        { text: "ã€ä¸¾åŠé‡‘ç›†æ´—æ‰‹å¤§ä¼šã€‘", effects: { career_status: 'retired' }, result_text: "åœ¨å¤§ä¼šä¸Šï¼Œä½ çš„æ‰€æœ‰æœ‹å‹å’Œå®¿æ•Œéƒ½ä¼šå‰æ¥ã€‚è¿™æ˜¯ä½ æ±Ÿæ¹–ç”Ÿæ¶¯çš„æœ€ç»ˆæ€»ç»“ã€‚ä¹‹åï¼Œä½ å°†è¿›å…¥â€œéšé€€â€çŠ¶æ€ã€‚" },
                        { text: "ã€æ‚„ç„¶ç¦»å»ï¼Œä¸å‘Šè€Œåˆ«ã€‘", effects: { career_status: 'vanished' }, result_text: "ä½ æ¶ˆå¤±åœ¨æ±Ÿæ¹–ä¸­ï¼Œæˆä¸ºä¸€ä¸ªçœŸæ­£çš„ä¼ è¯´ã€‚" }
                    ]
                },
                {
                    title: "å¤©å±±å¯»é“",
                    desc: "ä½ å¬é—»å¤©å±±ä¹‹å·…æœ‰â€œæ­¦é“ä¹‹æâ€ï¼Œå¯ä»¥è®©äººè¶…å‡¡å…¥åœ£ã€‚",
                    options: [
                        { text: "ã€æ”¾å¼ƒä¸€åˆ‡ï¼Œå‰å¾€å¤©å±±ã€‘", effects: { end_game: 'ascended' }, result_text: "è¿™æ˜¯ä¸€åœºæ¼«é•¿è€Œå­¤ç‹¬çš„æ—…ç¨‹ã€‚æˆåŠŸåï¼Œä½ çš„æ­¦å­¦å’Œå†…åŠ›å°†çªç ´å‡¡äººæé™ï¼Œè§£é”â€œç ´ç¢è™šç©ºâ€çš„ä¼ è¯´ç»“å±€ã€‚" }
                    ]
                },
                {
                    title: "äº‰å¤ºæ­¦æ—ç›Ÿä¸»",
                    desc: "æ­¦æ—å¤§ä¼šå†æ¬¡å¬å¼€ï¼Œä½ å†³å®šäº‰å¤ºæ­¦æ—ç›Ÿä¸»ä¹‹ä½ã€‚",
                    options: [
                        { text: "ã€ä»¥æ­¦æœäººã€‘", requirements: { martial: 200 }, effects: { flag: 'wulin_leader' }, result_text: "ä½ å‡»è´¥äº†æ‰€æœ‰æŒ‘æˆ˜è€…ï¼Œæˆä¸ºäº†æ–°çš„æ­¦æ—ç›Ÿä¸»ã€‚" },
                        { text: "ã€ä»¥å¾·æœäººã€‘", requirements: { virtue: 180, reputation: 1000 }, effects: { flag: 'wulin_leader' }, result_text: "ä½ çš„å¾·è¡Œå’Œå£°æœ›è®©ä½ ä¼—æœ›æ‰€å½’ï¼Œè¢«æ¨ä¸¾ä¸ºæ­¦æ—ç›Ÿä¸»ã€‚" }
                    ]
                },
                {
                    title: "æœå»·çš„åˆºæ€",
                    desc: "ä½ çš„å­˜åœ¨è®©çš‡å¸æ„Ÿåˆ°ä¸å®‰ï¼Œä»–æ´¾å‡ºäº†å¤§å†…é«˜æ‰‹å‰æ¥åˆºæ€ä½ ã€‚",
                    options: [
                        { text: "ã€æ­£é¢è¿æˆ˜ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.martial > 220) {
                                return { text: "ä½ å‡»é€€äº†æ‰€æœ‰åˆºå®¢ï¼Œä»æ­¤ä¸æœå»·å½»åº•å†³è£‚ã€‚", effects: { flag: 'court_enemy' } };
                            }
                            return { text: "ä½ æ­»äºå›´æ”»ä¹‹ä¸‹ã€‚", effects: { end_game: 'assassinated' } };
                        }}
                    ]
                },
                {
                    title: "ä¼ æ‰¿ä½ çš„æ­¦å­¦",
                    desc: "ä½ å†³å®šå°†è‡ªå·±çš„æ­¦å­¦ä¼ æ‰¿ä¸‹å»ã€‚",
                    options: [
                        { text: "ã€å†™å…¥ç§˜ç±ï¼Œæµä¼ åä¸–ã€‘", effects: { item: { id: 'your_martial_arts_book', amount: 1 } }, result_text: "ä½ å°†è‡ªå·±çš„æ­¦å­¦å¿ƒå¾—å†™æˆä¹¦ï¼Œæ­¤ä¹¦å°†æˆä¸ºæ±Ÿæ¹–ä¸­äººäººéƒ½æƒ³å¾—åˆ°çš„å®ç‰©ã€‚" },
                        { text: "ã€åªä¼ ç»™ä½ çš„äº²ä¼ å¼Ÿå­ã€‘", effects: { flag: 'heir_training' }, result_text: "ä½ å¼€å§‹æ‚‰å¿ƒæ•™å¯¼ä½ çš„ç»§æ‰¿äººã€‚" }
                    ]
                },
                {
                    title: "æµ·å¤–çš„æŒ‘æˆ˜è€…",
                    desc: "ä¸€ä½æ¥è‡ªä¸œç€›çš„å‰‘å®¢ï¼Œå·ç§°â€œå‰‘åœ£â€ï¼Œå‰æ¥æŒ‘æˆ˜ä¸­åŸæ­¦æ—ã€‚",
                    options: [
                        { text: "ã€æ¥å—æŒ‘æˆ˜ã€‘", effects: { flag: 'duel_with_kensai' }, result_text: "ä¸€åœºèµŒä¸Šä¸¤å›½æ­¦æœ¯å°Šä¸¥çš„å¯¹å†³å¼€å§‹äº†ã€‚" }
                    ]
                },
                {
                    title: "å½’éšå±±æ—",
                    desc: "ä½ æœ€ç»ˆçœ‹ç ´çº¢å°˜ï¼Œå†³å®šå½’éšå±±æ—ï¼Œä¸é—®ä¸–äº‹ã€‚",
                    options: [
                        { text: "ã€é€‰æ‹©å½’éšã€‘", effects: { end_game: 'hermit' }, result_text: "ä½ æ‰¾åˆ°ä¸€å¤„å±±æ¸…æ°´ç§€ä¹‹åœ°ï¼Œä»æ­¤ä¸å±±æ—ä¸ºä¼´ï¼Œåº¦è¿‡ä½™ç”Ÿã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šåå±±è®ºå‰‘",
                trigger: { career_level: 9, text_desc: "æ­¦æ—ç¥è¯, å£°æœ›é¡¶å³°, å‡»è´¥è¿‡3ä½é«˜æ‰‹", condition: (gs) => gs.player.attributes.reputation > 1500 && (gs.flags.defeated_masters || 0) >= 3 },
                desc: "åå±±ä¹‹å·…ï¼Œé›ªèŠ±çº·é£ã€‚å½“ä¸–æœ€å¼ºçš„äº”ä½æ­¦æ—ç¥è¯äººç‰©ï¼ˆåŒ…æ‹¬ä½ ï¼‰é½èšäºæ­¤ï¼Œä¸ºè‡ªå·±ã€ä¸ºæ­¦é“è€Œæˆ˜çš„å·…å³°å¯¹å†³ã€‚",
                success: { text: "ä½ å‡»è´¥äº†æ‰€æœ‰å¯¹æ‰‹ï¼Œè¢«å…¬è®¤ä¸ºâ€œå¤©ä¸‹ç¬¬ä¸€â€ï¼Œå¹¶æˆä¸ºæ–°çš„â€œæ­¦æ—ç›Ÿä¸»â€ï¼ä½ è·å¾—äº†å†³å®šæ•´ä¸ªæ±Ÿæ¹–å‘½è¿çš„æƒåŠ›ï¼Œä½ çš„åå­—æˆä¸ºä¸æœ½çš„ç¥è¯ã€‚", effects: { end_game_title: 'å¤©ä¸‹ç¬¬ä¸€', item: {id: 'tian_xia_di_yi_xin_wu', amount: 1} } },
                failure: { text: "æŠ€ä¸å¦‚äººï¼Œä½†èƒ½ä¸å½“ä¸–æœ€å¼ºè€…äº¤æ‰‹äº¦æ— æ†¾ã€‚ä½ è™½è´¥çŠ¹è£ï¼Œä»æ˜¯æ±Ÿæ¹–ä¸­å—äººæ•¬ä»°çš„å®—å¸ˆã€‚", effects: {} }
            }
        }
    ]
},

'matron': {
    name: "ä¸»æ¯",
    icon: "fa-chess-queen",
    gender: "female",
    core_resources: ["nei_ku_zi_jin", "jia_zu_sheng_wang", "ren_qing", "dang_jia_quan"],
    dashboard_name: "å†…åŠ¡åºœåå†Œ",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šæ·±é—ºæ–°å¦‡",
            level_range: [1, 4],
            goal: "åœ¨å¤æ‚çš„å¤«å®¶ç«™ç¨³è„šè·Ÿï¼Œèµ¢å¾—ä¸ˆå¤«çš„çˆ±ä¸ä¿¡ä»»ï¼Œåœ¨ä¸å©†å©†çš„æƒåŠ›äº¤æ¥ä¸­å–å¾—ä¸Šé£ï¼Œå¹¶è¯ä¸‹å«¡ç³»å­å—£ä»¥å·©å›ºè‡ªå·±çš„æ ¸å¿ƒåœ°ä½ã€‚",
            events: [
                {
                    title: "æ™¨æ˜å®šçœ",
                    desc: "æ¯æ—¥å‘å…¬å©†è¯·å®‰æ˜¯ä½ èº«ä¸ºæ–°å¦‡çš„å¿…ä¿®è¯¾ã€‚",
                    options: [
                        { text: "ã€è¨€è°ˆæ­æ•¬ï¼Œä¸¾æ­¢å¾—ä½“ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.etiquette > 50 || (gs.player.attributes.etiquette > 30 && Math.random() < 0.7)) {
                                return { text: "å©†å©†å¯¹ä½ çš„çŸ¥ä¹¦è¾¾ç†é¢‡ä¸ºæ»¡æ„ã€‚", effects: { npc_relationship: { npc_key: 'mother_in_law', favor: 5 } } };
                            }
                            return { text: "ä½ åœ¨ç»†èŠ‚ä¸Šå‡ºäº†å·®é”™ï¼Œè¢«å©†å©†å½“ä¼—æç‚¹ï¼Œè®¤ä¸ºä½ â€œå°å®¶å­æ°”â€ã€‚", effects: { npc_relationship: { npc_key: 'mother_in_law', favor: -5 }, attributes: { etiquette: 1 } } };
                        }},
                        { text: "ã€äº²æ‰‹åˆ¶ä½œæ»‹è¡¥æ±¤å“å­æ•¬ã€‘", effects: { npc_relationship: { npc_key: 'mother_in_law', favor: 10 }, attributes: { virtue: 2 } }, result_text: "ä½ çš„å­å¿ƒè®©å…¬å©†éå¸¸æ„ŸåŠ¨ã€‚" }
                    ]
                },
                {
                    title: "å¦¾å®¤çš„è¯·å®‰",
                    desc: "ä¸ˆå¤«çš„ä¸€ä½å¦¾å®¤å‰æ¥å‘ä½ è¯·å®‰ï¼Œè¨€è¯­é—´ä¼¼æœ‰è¯•æ¢ä¹‹æ„ã€‚",
                    options: [
                        { text: "ã€æ¸©å’Œå®‰æŠšï¼Œå½°æ˜¾å¤§åº¦ã€‘", effects: { core_resources: { jia_zu_sheng_wang: 5 }, npc_relationship: { npc_key: 'concubine_A', favor: 5 } }, result_text: "ä½ å±•ç°äº†æ­£å¦»çš„æ°”åº¦ï¼Œä¸‹äººä»¬å¯¹ä½ é¢‡ä¸ºæ•¬ä½©ã€‚" },
                        { text: "ã€æ•²å±±éœ‡è™ï¼Œç«‹ä¸‹è§„çŸ©ã€‘", requirements: { etiquette: 60 }, effects: {}, result_text: "ä½ ç”¨æ»´æ°´ä¸æ¼çš„è¯æœ¯ç¡®ç«‹äº†ä¸»æ¬¡ã€‚è¯¥å¦¾å®¤è¢«ä½ çš„å¨ä¸¥éœ‡æ…‘ï¼ŒçŸ­æ—¶é—´å†…ä¸æ•¢é€ æ¬¡ã€‚" },
                        { text: "ã€èµèµé¦–é¥°ï¼Œæ”¶ä¹°äººå¿ƒã€‘", cost: { wealth: 200 }, effects: { npc_relationship: { npc_key: 'concubine_A', favor: 15 } }, result_text: "å¦¾å®¤å¯¹ä½ æ„Ÿæ¿€æ¶•é›¶ã€‚ä½†æ­¤ä¸¾å¯èƒ½è®©å¥¹æ°”ç„°æ›´ç››ã€‚" }
                    ]
                },
                    {
                        title: "åˆè§ç®¡äº‹",
                        desc: "åºœä¸­çš„å¼ ç®¡äº‹å€šè€å–è€ï¼Œåœ¨åˆ†é…æœˆä¾‹æ—¶ï¼Œè¨€è¯­é—´å¯¹ä½ è¿™ä½æ–°å¦‡é¢‡æœ‰è½»è§†ã€‚",
                        options: [
                            { text: "ã€æ¸©å’Œæ•²æ‰“ã€‘", requirements: { etiquette: 50 }, effects: { attributes: { virtue: 3 }, core_resources: { dang_jia_quan: 2 } }, result_text: "ä½ ç”¨æ»´æ°´ä¸æ¼çš„è¯æœ¯ç‚¹æ˜äº†ä¸»æ¬¡ï¼Œå¼ ç®¡äº‹ä¸æ•¢å†å°è§‘ä½ ã€‚" },
                            { text: "ã€æš‚ä¸”éšå¿ã€‘", effects: { attributes: { scheming: 2 } }, result_text: "ä½ é€‰æ‹©æš‚é¿é”‹èŠ’ï¼Œå¿ƒä¸­å·²æš—æš—è®°ä¸‹æ­¤äº‹ã€‚" },
                            { text: "ã€å‘å©†å©†æ±‚åŠ©ã€‘", effects: { npc_relationship: { npc_key: 'mother_in_law', favor: 5 } }, result_text: "å©†å©†ä¸ºä½ æ’‘äº†è…°ï¼Œä½†ä¹Ÿä¼šè§‰å¾—ä½ æ— æ³•ç‹¬å½“ä¸€é¢ã€‚" }
                        ]
                    },
                    {
                        title: "ä¸«é¬Ÿçš„ç§å¿ƒ",
                        desc: "ä½ å‘ç°é™ªå«ä¸«é¬Ÿä¸­çš„ä¸€äººï¼Œä¼¼ä¹åœ¨æš—ä¸­ä¸å¤«å®¶çš„ä¸‹äººä¼ é€’å…³äºä½ å¨˜å®¶çš„æ¶ˆæ¯ã€‚",
                        options: [
                            { text: "ã€ä¸¥å‰æƒ©å¤„ï¼Œä»¥å„†æ•ˆå°¤ã€‘", effects: { attributes: { prestige: 5 } }, result_text: "ä½ ä¸¥æƒ©äº†è¯¥ä¸«é¬Ÿï¼Œä¸‹äººä»¬éƒ½çœ‹åˆ°äº†ä½ çš„æ²»å®¶æ‰‹è…•ã€‚" },
                            { text: "ã€ç§ä¸‹è°ˆè¯ï¼Œäº†è§£ç¼˜ç”±ã€‘", requirements: { wisdom: 50 }, effects: { npc_relationship: { npc_key: 'traitor_maid', favor: 20, type: 'ally' } }, result_text: "åŸæ¥å¥¹æ˜¯ä¸ºå®¶äººæ‰€è¿«ã€‚ä½ å¸®å¥¹è§£å†³äº†å›°éš¾ï¼Œä»æ­¤å¥¹å¯¹ä½ æ­»å¿ƒå¡Œåœ°ï¼Œæˆä¸ºä½ çš„å¿ƒè…¹ã€‚" },
                            { text: "ã€å°†è®¡å°±è®¡ï¼Œä¼ é€’å‡æ¶ˆæ¯ã€‘", requirements: { scheming: 60 }, effects: { attributes: { scheming: 5 } }, result_text: "ä½ åˆ©ç”¨å¥¹ä¼ é€’äº†ä¸€äº›æ— å…³ç—›ç—’çš„å‡æ¶ˆæ¯ï¼Œæš‚æ—¶ç¨³ä½äº†å±€é¢ã€‚" }
                        ]
                    },
                    {
                        title: "å¤«å›çš„æ—§ç‰©",
                        desc: "ä½ åœ¨æ•´ç†å¤«å›ä¹¦æˆ¿æ—¶ï¼Œå‘ç°äº†ä¸€åªåšå·¥ç²¾è‡´å´ç•¥æ˜¾é™ˆæ—§çš„è·åŒ…ï¼Œä¼¼ä¹æ˜¯å¥³å­æ‰€èµ ã€‚",
                        options: [
                            { text: "ã€ä¸åŠ¨å£°è‰²æ”¾å›åŸå¤„ã€‘", effects: { attributes: { virtue: 5 } }, result_text: "ä½ é€‰æ‹©ç›¸ä¿¡å¤«å›ï¼Œæ­¤äº‹å¹¶æœªåœ¨ä½ å¿ƒä¸­ç•™ä¸‹èŠ¥è’‚ã€‚" },
                            { text: "ã€æ—æ•²ä¾§å‡»åœ°è¯¢é—®ã€‘", requirements: { charm: 60 }, effects: { npc_relationship: { npc_key: 'spouse', favor: 5 } }, result_text: "åŸæ¥æ˜¯å¤«å›å·²æ•…çš„å¦¹å¦¹æ‰€èµ ï¼Œä½ çš„å…³å¿ƒè®©ä»–å¾ˆå—ç”¨ï¼Œå¤«å¦»æ„Ÿæƒ…åŠ æ·±ã€‚" },
                            { text: "ã€å¿ƒä¸­ç”Ÿç–‘ã€‘", effects: { npc_relationship: { npc_key: 'spouse', favor: -5 } }, result_text: "ä½ å¿ƒä¸­ç§ä¸‹äº†æ€€ç–‘çš„ç§å­ï¼Œå¤«å¦»æ„Ÿæƒ…ç•¥æœ‰è£‚ç—•ã€‚" }
                        ]
                    },
                    {
                        title: "å­¦ä¹ æ’èŠ±",
                        desc: "ä¸ºäº†é™¶å†¶æƒ…æ“å¹¶è£…ç‚¹å†…å®¤ï¼Œä½ å†³å®šå­¦ä¹ æ’èŠ±è‰ºæœ¯ã€‚",
                        options: [
                            { text: "ã€è¯·å®«é‡Œçš„èŠ±åŒ æŒ‡ç‚¹ã€‘", cost: { wealth: 300 }, effects: { attributes: { talent: 5, charm: 3 } }, result_text: "ä½ çš„æ’èŠ±æŠ€è‰ºå¤§æœ‰é•¿è¿›ï¼Œå¤«å›å›å®¶çœ‹åˆ°æˆ¿ä¸­æ¸…é›…çš„é™ˆè®¾ï¼Œå¿ƒæƒ…ä¹Ÿå¥½äº†è®¸å¤šã€‚" },
                            { text: "ã€è‡ªè¡Œé’»ç ”ã€‘", effects: { attributes: { talent: 2 } }, result_text: "è™½æ— äººæŒ‡ç‚¹ï¼Œä½†å‡­ä½ çš„èªæ…§ï¼Œä¹Ÿæ‘¸ç´¢å‡ºäº†ä¸€äº›é—¨é“ã€‚" }
                        ]
                    },
                    {
                        title: "äº²æ—çš„æ‹œè®¿",
                        desc: "å¤«å®¶ä¸€ä½è¿œæˆ¿è¡¨å§‘å‰æ¥æ‹œè®¿ï¼Œè¨€è¯­é—´æ€»æ˜¯åœ¨æ‰“æ¢ä½ çš„å«å¦†å‡ ä½•ã€‚",
                        options: [
                            { text: "ã€å·§å¦™åº”å¯¹ï¼Œæ»´æ°´ä¸æ¼ã€‘", requirements: { etiquette: 60 }, effects: { attributes: { reputation: 5 } }, result_text: "ä½ åº”å¯¹å¾—ä½“ï¼Œæ—¢æœªé€éœ²å®¶åº•ï¼Œä¹Ÿæœªå¤±äº†ç¤¼æ•°ï¼Œäººäººéƒ½ç§°èµä½ å¤§æ°”ã€‚" },
                            { text: "ã€å¦‚å®ç›¸å‘Šã€‘", effects: { attributes: { virtue: -2 } }, result_text: "ä½ çš„å¦è¯šè®©å¯¹æ–¹æ»¡æ„ï¼Œä½†ä¹Ÿå¯èƒ½å¼•æ¥ä¸å¿…è¦çš„è§Šè§ã€‚" }
                        ]
                    },
// =================== ä¸»æ¯ï¼šç¬¬ä¸€å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "å­¦ä¹ ç†è´¦",
                    desc: "å©†å©†å°†ä¸€æœ¬é™ˆå¹´æ—§è´¦äº¤ç»™ä½ ï¼Œè®©ä½ â€œå­¦ä¹ å­¦ä¹ â€ï¼Œå®åˆ™è€ƒéªŒä½ çš„èƒ½åŠ›ã€‚",
                    options: [
                        { text: "ã€ç†¬å¤œæ ¸ç®—ï¼Œæ‰¾å‡ºé”™æ¼ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.wisdom > 60) {
                                return { text: "ä½ æ‰¾å‡ºäº†è´¦ç›®ä¸­çš„å‡ å¤„é”™æ¼ï¼Œè®©å©†å©†åˆ®ç›®ç›¸çœ‹ã€‚", effects: { attributes: { wisdom: 2 }, core_resources: { dang_jia_quan: 10 } } };
                            }
                            return { text: "ä½ çœ‹å¾—ä¸€å¤´é›¾æ°´ï¼Œå©†å©†å¯¹ä½ é¢‡ä¸ºå¤±æœ›ã€‚", effects: { core_resources: { dang_jia_quan: -5 } } };
                        }},
                        { text: "ã€å‘ä¸ˆå¤«æ±‚åŠ©ã€‘", effects: { npc_relationship: { npc_key: 'spouse', favor: 10 } }, result_text: "ä¸ˆå¤«å¸®ä½ è§£å†³äº†é—®é¢˜ï¼Œå¤«å¦»æ„Ÿæƒ…å‡æ¸©ã€‚ä½†å©†å©†è®¤ä¸ºä½ æ— æ³•ç‹¬å½“ä¸€é¢ã€‚" }
                    ]
                },
                {
                    title: "å›é—¨ä¹‹æ—¥",
                    desc: "æˆå©šä¸€æœˆï¼Œä½ æŒ‰ä¾‹å›å¨˜å®¶ã€‚",
                    options: [
                        { text: "ã€å‘æ¯äº²å“­è¯‰åœ¨å¤«å®¶çš„ä¸æ˜“ã€‘", effects: { wealth: 500, item: { id: 'mu_qin_ti_ji_shou_shi', amount: 1 } }, result_text: "æ¯äº²å®‰æ…°ä½ ï¼Œå¹¶ç§ä¸‹èµ ä½ ä¸€ç¬”ç§æˆ¿é’±å’Œ[æ¯äº²çš„ä½“å·±é¦–é¥°]ã€‚ä½†æ­¤äº‹ä¼ åˆ°å©†å®¶ï¼Œä¼šè®¤ä¸ºä½ â€œçˆ±å‘ŠçŠ¶â€ã€‚" },
                        { text: "ã€æŠ¥å–œä¸æŠ¥å¿§ï¼Œå½°æ˜¾å¤«å®¶æ©å® ã€‘", effects: { core_resources: { jia_zu_sheng_wang: 5 }, attributes: { virtue: 3 } }, result_text: "ä½ çš„è¨€è¡Œè®©å¨˜å®¶äººæ”¾å¿ƒï¼Œä¹Ÿè®©å¤«å®¶æœ‰å…‰ã€‚" }
                    ]
                },
                {
                    title: "ä¸ˆå¤«çš„æ™šå½’",
                    desc: "ä½ çš„ä¸ˆå¤«æœ€è¿‘å¸¸å¸¸æ·±å¤œæ‰ä»åŒåƒšçš„å®´å¸­ä¸Šé†‰é†ºé†ºåœ°å›æ¥ã€‚",
                    options: [
                        { text: "ã€é»˜é»˜å‡†å¤‡é†’é…’æ±¤ï¼Œæ¸©æŸ”ç…§æ–™ã€‘", effects: { npc_relationship: { npc_key: 'spouse', favor: 10 } }, result_text: "ä½ çš„ä½“è´´è®©ä¸ˆå¤«å¿ƒä¸­ä¸€æš–ï¼Œå¤«å¦»æ„Ÿæƒ…å‡æ¸©ã€‚" },
                        { text: "ã€æ—æ•²ä¾§å‡»ï¼Œè¯¢é—®å®´å¸­è¯¦æƒ…ã€‘", getOutcome: (gs) => {
                             if(gs.player.attributes.charm > 70) {
                                 return { text: "ä½ ä»ä¸ˆå¤«å£ä¸­å¾—çŸ¥äº†ä¸€äº›å…³äºæœå ‚çš„[æƒ…æŠ¥]ã€‚", effects: { item: { id: 'qing_bao_cai_wu', amount: 1 } } };
                             }
                             return { text: "ä¸ˆå¤«è§‰å¾—ä½ ç–‘å¿ƒå¤ªé‡ï¼Œä¸ä½ å¥½æ„Ÿä¸‹é™ã€‚", effects: { npc_relationship: { npc_key: 'spouse', favor: -5 } } };
                        }}
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šå«¡å­è¯ç”Ÿ",
                trigger: { career_level: 2, text_desc: "ä¸ä¸ˆå¤«å¥½æ„Ÿåº¦>80ï¼Œå¹¶æˆåŠŸè¯ä¸‹å«¡å­", condition: (gs) => gs.marriage.favor > 80 && gs.flags.has_given_birth_to_heir },
                desc: "ç»å†äº†åæœˆæ€€èƒå’Œç”Ÿäº§çš„å‡¶é™©ï¼Œä¸€å£°å“äº®çš„å•¼å“­ä¸ºä½ çš„äººç”Ÿå¸¦æ¥äº†å…¨æ–°çš„æ„ä¹‰ã€‚ä½ çš„æ—¶ä»£ï¼Œæ­£å¼æ¥ä¸´ã€‚",
                success: { text: "å«¡å­è¯ç”Ÿï¼Œä½ çš„åœ°ä½ç¨³å¦‚æ³°å±±ã€‚å©†å©†åœ¨å…¨æ—äººçš„è§è¯ä¸‹ï¼Œå°†è±¡å¾ä¸»æ¯æƒåŠ›çš„[åºœåº“çš„é’¥åŒ™]å’Œã€å†…åŠ¡åºœåå†Œã€‘æ­£å¼äº¤ç»™ä½ ã€‚ä½ è·å¾—äº†å®Œå…¨çš„å½“å®¶æƒï¼", effects: { item: { id: 'fu_ku_yao_chi', amount: 1 }, core_resources: { dang_jia_quan: 100 } } },
                failure: { text: "ç”Ÿäº§å¤±è´¥å¯èƒ½å¯¼è‡´å­å—£å¤­æŠ˜æˆ–è‡ªèº«å¥åº·å¤§æŸã€‚æœªèƒ½æŠ“ä½æƒåŠ›äº¤æ¥çš„æœºä¼šï¼Œå°†è®©ä½ åœ¨å©†å©†æ‰‹ä¸‹ç»§ç»­éšå¿å¤šå¹´ã€‚", effects: { attributes: { health_max: -10 } } }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šç®¡å®¶ä¸»æ¯",
            level_range: [5, 7],
            goal: "è¿ç”¨ä½ æ‰‹ä¸­çš„æƒåŠ›ï¼Œå¯¹å¤–é€šè¿‡ç¤¾äº¤æ‹“å±•å®¶æ—å½±å“åŠ›ï¼Œå¯¹å†…ç®¡ç†åå®…ã€å¹³è¡¡å…³ç³»ã€æ‚‰å¿ƒåŸ¹å…»ä¸‹ä¸€ä»£ï¼Œå°†å®¶æ—æ‰“ç†å¾—äº•äº•æœ‰æ¡ã€‚",
            events: [
                {
                    title: "å¤„ç†ä¸‹äººç§æƒ…",
                    desc: "ä½ å‘ç°ä½ æœ€å¾—åŠ›çš„ä¸€ä¸ªä¸«é¬Ÿå’Œåºœé‡Œçš„æŠ¤é™¢ç§é€šã€‚",
                    options: [
                        { text: "ã€å°†äºŒäººç—›æ‰“ä¸€é¡¿åèµ¶å‡ºåºœã€‘", effects: { attributes: { virtue: -5 } }, result_text: "ä½ ç»´æŠ¤äº†åºœè§„çš„æ£®ä¸¥ã€‚ä½†æ‰‹æ®µè¿‡äºé…·çƒˆï¼Œä¸‹äººå¿ è¯šåº¦æ™®éä¸‹é™ã€‚" },
                        { text: "ã€æˆå…¨ä»–ä»¬ï¼Œä¸ºä»–ä»¬æ“åŠå©šäº‹ã€‘", cost: { wealth: 300 }, effects: { attributes: { virtue: 10 }, core_resources: { jia_zu_sheng_wang: 5 } }, result_text: "ä½ çš„ä»æ…ˆè¢«ä¼ ä¸ºä½³è¯ã€‚è¿™å¯¹å¤«å¦‡ä¼šå¯¹ä½ æ­»å¿ƒå¡Œåœ°ï¼Œæˆä¸ºä½ æœ€å¿ è¯šçš„çœ¼çº¿å’Œå¸®æ‰‹ã€‚" }
                    ]
                },
// =================== ä¸»æ¯ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "ç”°åº„æ­‰æ”¶",
                        desc: "è´Ÿè´£ç”°åº„çš„ç®¡äº‹æ¥æŠ¥ï¼Œä»Šå¹´é›¨æ°´ä¸å¥½ï¼Œç”°åº„æ­‰æ”¶ï¼Œå¯èƒ½æ— æ³•äº¤è¶³é¢å®šçš„ç§Ÿå­ã€‚",
                        options: [
                            { text: "ã€å®‰æŠšå¹¶å‡å…éƒ¨åˆ†ç§Ÿå­ã€‘", requirements: { virtue: 60 }, effects: { attributes: { virtue: 5 }, core_resources: { jia_zu_sheng_wang: 5 } }, result_text: "ä½ çš„ä»å¾·ä¹‹ååœ¨ä½ƒæˆ·ä¸­ä¼ æ‰¬å¼€æ¥ï¼Œå®¶æ—å£°æœ›æå‡ã€‚" },
                            { text: "ã€åšæŒæŒ‰å¥‘çº¦åŠäº‹ã€‘", effects: { attributes: { virtue: -3 } }, result_text: "ä½ ç»´æŠ¤äº†è§„çŸ©ï¼Œä½†ä½ƒæˆ·ä»¬æ€¨å£°è½½é“ã€‚" },
                            { text: "ã€æ´¾å¿ƒè…¹å‰å»è°ƒæŸ¥ã€‘", requirements: { wisdom: 70 }, effects: { attributes: { wisdom: 2 }, core_resources: { dang_jia_quan: 5 } }, result_text: "ä½ å‘ç°ç®¡äº‹è°æŠ¥ç¾æƒ…ï¼Œç§åäº†éƒ¨åˆ†æ”¶æˆã€‚ä½ å€Ÿæ­¤æœºä¼šæ’¤æ¢äº†ç®¡äº‹ï¼Œè¿›ä¸€æ­¥æŒæ¡äº†åº„å­çš„å®æƒã€‚" }
                        ]
                    },
                    {
                        title: "å¦¾å®¤é—´çš„â€œæ„å¤–â€",
                        desc: "ä¸€ä½ä¸å—å® çš„å¦¾å®¤â€œä¸æ…â€è½æ°´ï¼Œè€Œå½“æ—¶åœ¨åœºçš„åªæœ‰å¦ä¸€ä½å—å® çš„å¦¾å®¤ã€‚",
                        options: [
                            { text: "ã€ç›¸ä¿¡æ˜¯æ„å¤–ï¼Œå®‰æŠšäº†äº‹ã€‘", effects: { marriage: { familyHarmony: -5 } }, result_text: "ä½ çš„å¤„ç½®è®©å…¶ä¸­ä¸€æ–¹å¿ƒæ€€æ€¨æ¨ï¼Œåå®…å’Œè°åº¦ä¸‹é™ã€‚" },
                            { text: "ã€å„æ‰“äº”åå¤§æ¿ã€‘", effects: { attributes: { prestige: 5 } }, result_text: "æ— è®ºçœŸç›¸å¦‚ä½•ï¼Œä½ å€Ÿæ­¤äº‹æ•²æ‰“äº†æ‰€æœ‰äººï¼Œå®¶å¨æå‡ã€‚" },
                            { text: "ã€æš—ä¸­è°ƒæŸ¥çœŸç›¸ã€‘", requirements: { scheming: 70 }, effects: { attributes: { scheming: 5 } }, result_text: "ä½ å‘ç°è¿™ç«Ÿæ˜¯ä¸€åœºè‹¦è‚‰è®¡ï¼ä½ æŒæ¡äº†å¥¹ä»¬çš„æŠŠæŸ„ï¼Œåå®…å°½åœ¨ä½ çš„æŒæ§ä¹‹ä¸­ã€‚" }
                        ]
                    },
                    {
                        title: "ä¸ºå¤«å›çš„ç”Ÿè¾°åšå‡†å¤‡",
                        desc: "å³å°†æ˜¯ä½ å¤«å›çš„ç”Ÿè¾°ï¼Œä½ æ‰“ç®—å¦‚ä½•ä¸ºä»–åº†ç¥ï¼Ÿ",
                        options: [
                            { text: "ã€ä¸¾åŠå®¶å®´ï¼Œé‚€è¯·äº²å‹ã€‘", cost: { wealth: 500 }, effects: { npc_relationship: { npc_key: 'spouse', favor: 10 }, core_resources: { ren_qing: 10 } }, result_text: "ä¸€åœºæ¸©é¦¨çš„å®¶å®´è®©å¤«å›å€æ„Ÿæ¸©æš–ï¼Œä¹Ÿç»´ç³»äº†äº²æ—å…³ç³»ã€‚" },
                            { text: "ã€äº²æ‰‹ç¼åˆ¶ä¸€ä»¶è¡£è¢ã€‘", requirements: { talent: 60 }, effects: { npc_relationship: { npc_key: 'spouse', favor: 15 } }, result_text: "ä¸€é’ˆä¸€çº¿çš†æ˜¯æƒ…æ„ï¼Œå¤«å›å¯¹ä½ çš„çˆ±æ„æ›´æ·±äº†ã€‚" },
                            { text: "ã€äºŒäººä¸–ç•Œï¼Œå°é…Œå‡ æ¯ã€‘", effects: { npc_relationship: { npc_key: 'spouse', favor: 12 } }, result_text: "ä½ ä»¬äº«å—äº†éš¾å¾—çš„äºŒäººæ—¶å…‰ï¼Œæ„Ÿæƒ…å‡æ¸©ã€‚" }
                        ]
                    },
                    {
                        title: "å¨˜å®¶çš„æ±‚åŠ©",
                        desc: "ä½ çš„å¨˜å®¶å…„å¼Ÿç”Ÿæ„ä¸Šé‡åˆ°å›°éš¾ï¼Œæ¯äº²å†™ä¿¡å¸Œæœ›ä½ èƒ½ä»å¤«å®¶å‘¨è½¬ä¸€äº›èµ„é‡‘ã€‚",
                        options: [
                            { text: "ã€åŠ¨ç”¨è‡ªå·±çš„ç§äº§ç›¸åŠ©ã€‘", cost: { privateAssets: 1000 }, effects: { attributes: { virtue: 5 } }, result_text: "ä½ ç”¨è‡ªå·±çš„ç§æˆ¿é’±å¸®åŠ©äº†å¨˜å®¶ï¼ŒæœªåŠ¨ç”¨å¤«å®¶åˆ†æ¯«ã€‚" },
                            { text: "ã€è¯´æœå¤«å›åŠ¨ç”¨å®¶åº“ã€‘", requirements: { charm: 80 }, effects: { npc_relationship: { npc_key: 'spouse', favor: 5 }, core_resources: { nei_ku_zi_jin: -1000 } }, result_text: "åœ¨ä½ çš„è½¯è¯­ç›¸æ±‚ä¸‹ï¼Œå¤«å›åŒæ„äº†ã€‚ä½ ä»¬çš„å®¶åº“å‡å°‘äº†1000ä¸¤ã€‚" },
                            { text: "ã€å©‰è¨€æ‹’ç»ã€‘", effects: { attributes: { virtue: -5 } }, result_text: "ä½ ä»¥å¤«å®¶ä¸ºé‡ï¼Œæ‹’ç»äº†å¨˜å®¶çš„è¯·æ±‚ï¼Œå¿ƒä¸­æœ‰äº›æ„§ç–šã€‚" }
                        ]
                    },
                    {
                        title: "æ…ˆå–„æ´»åŠ¨",
                        desc: "äº¬ä¸­å¤§æˆ·è”åˆä¸¾åŠä¸ºè´«æ°‘æ–½ç²¥çš„æ…ˆå–„æ´»åŠ¨ï¼Œé‚€è¯·å„å®¶ä¸»æ¯å‚åŠ ã€‚",
                        options: [
                            { text: "ã€æé’±ä¸å‡ºå¸­ã€‘", cost: { wealth: 500 }, effects: { attributes: { virtue: 2 } }, result_text: "ä½ æäº†500ä¸¤ï¼Œå°½äº†ä¸€ä»½å¿ƒæ„ã€‚" },
                            { text: "ã€äº²è‡ªå‰å¾€ï¼Œæ“æŒäº‹åŠ¡ã€‘", requirements: { virtue: 70 }, effects: { attributes: { virtue: 10, reputation: 10 } }, result_text: "ä½ çš„äº²åŠ›äº²ä¸ºèµ¢å¾—äº†æå¥½çš„åå£°ï¼Œäººäººéƒ½ç§°èµä½ æ˜¯â€œæ´»è©è¨â€ã€‚" }
                        ]
                    },
// =================== ä¸»æ¯ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "å¦¾å®¤äº‰å® é£æ³¢",
                    desc: "ä¸¤ä½å—å® çš„å¦¾å®¤ä¸ºäº†äº‰å¤ºä¸ˆå¤«çš„å…³æ³¨ï¼Œåœ¨èŠ±å›­ä¸­å¤§æ‰“å‡ºæ‰‹ã€‚",
                    options: [
                        { text: "ã€å„æ‰“äº”åå¤§æ¿ï¼Œç½šæŠ„å¥³è¯«ã€‘", effects: {}, result_text: "å…¬å¹³ä½†æ— æ•ˆçš„å¤„ç†ï¼Œå¥¹ä»¬çš„æ¢å­è¶Šç»“è¶Šæ·±ï¼Œåå®…ä¸å¾—å®‰å®ã€‚" },
                        { text: "ã€æš—ä¸­è°ƒæŸ¥ï¼Œæ‰¶æŒä¸€æ–¹æ‰“å‹ä¸€æ–¹ã€‘", requirements: { wisdom: 80 }, effects: { attributes: { wisdom: 3 } }, result_text: "ä½ æˆåŠŸåœ°åˆ†åŒ–äº†å¥¹ä»¬ï¼Œå·©å›ºäº†ä½ ç‹¬ä¸€æ— äºŒçš„åœ°ä½ã€‚" }
                    ]
                },
                {
                    title: "æ‰“ç†å«å¦†äº§ä¸š",
                    desc: "ä½ çš„ä¸€ä¸ªé™ªå«é“ºå­ï¼ŒæŒæŸœå‰æ¥æŠ¥å‘Šä»Šå¹´çš„ç»è¥çŠ¶å†µã€‚",
                    options: [
                        { text: "ã€å¬å–æŠ¥å‘Šï¼Œç»´æŒç°çŠ¶ã€‘", effects: { wealth: 1000 }, result_text: "ä½ çš„é™ªå«é“ºå­ä»Šå¹´ä¸ºä½ å¸¦æ¥1000ä¸¤ç§æˆ¿é’±æ”¶å…¥ã€‚" },
                        { text: "ã€æŠ•å…¥æ›´å¤šç§æˆ¿é’±ï¼Œæ‰©å¤§ç»è¥ã€‘", cost: { wealth: 2000 }, getOutcome: (gs) => {
                            if (Math.random() < 0.7) {
                                return { text: "æŠ•èµ„æˆåŠŸï¼æœªæ¥æ•°å¹´æ”¶å…¥ç¿»å€ã€‚", effects: { flag: 'dowry_business_upgraded' } };
                            }
                            return { text: "æŠ•èµ„å¤±è´¥ï¼Œè¡€æœ¬æ— å½’ã€‚", effects: {} };
                        }}
                    ]
                },
                {
                    title: "è´µå¦‡åœˆçš„èŒ¶ä¼š",
                    desc: "ä½ å—é‚€å‚åŠ å®‰å›½å…¬å¤«äººçš„èŒ¶ä¼šï¼Œåœ¨åº§çš†æ˜¯äº¬åŸé¡¶çº§æƒè´µçš„å¦»å¥³ã€‚",
                    options: [
                        { text: "ã€ä½©æˆ´[çš‡åèµèµçš„ç é’—]å‡ºå¸­ã€‘", requirements: { has_item: 'huang_hou_shang_ci_zhu_chai' }, effects: { attributes: { charm: 5, reputation: 10 } }, result_text: "ä½ çš„åœ°ä½å’Œå“å‘³å¾—åˆ°æ‰€æœ‰äººçš„è®¤å¯ï¼ŒæˆåŠŸèå…¥äº†äº¬åŸçš„é¡¶çº§è´µå¦‡åœˆã€‚" },
                        { text: "ã€ä½è°ƒå‡ºå¸­ï¼Œå¤šå¬å°‘è¯´ã€‘", effects: { item: { id: 'qing_bao_cai_wu', amount: 1 } }, result_text: "ä½ åœ¨èŒ¶ä¼šä¸Šå¬åˆ°äº†å…³äºâ€œæœå»·ç›é“æ”¹é©â€çš„æƒ…æŠ¥ï¼Œå¯ä»¥å‘ŠçŸ¥ä½ å½“å®˜çš„ä¸ˆå¤«ã€‚" }
                    ]
                },
                {
                    title: "å­å¥³çš„æ•™è‚²",
                    desc: "ä½ çš„å„¿å­åˆ°äº†å¯è’™çš„å¹´é¾„ã€‚",
                    options: [
                        { text: "ã€è˜è¯·å½“ä¸–å¤§å„’ä½œä¸ºè€å¸ˆã€‘", cost: { wealth: 5000 }, effects: { flag: 'son_has_great_tutor' }, result_text: "ä½ çš„å„¿å­å°†è·å¾—æœ€å¥½çš„æ•™è‚²ï¼Œæ™ºæ…§å’Œæ‰æƒ…æˆé•¿ç‡å¤§å¹…æå‡ã€‚" },
                        { text: "ã€äº²è‡ªæ•™å¯¼ã€‘", requirements: { talent: 100, wisdom: 100 }, effects: { npc_relationship: { npc_key: 'son', favor: 20 } }, result_text: "èŠ‚çœäº†å¼€æ”¯ï¼Œä¸”ä½ ä¸å„¿å­çš„äº²å¯†åº¦å¤§å¹…æå‡ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šååŠ¨äº¬åçš„å¯¿å®´",
                trigger: { career_level: 6, text_desc: "å®Œå…¨æ‰§æŒä¸­é¦ˆï¼Œå®¶æ—å£°æœ›>300", condition: (gs) => (gs.career.core_resources.dang_jia_quan || 0) >= 100 && (gs.career.core_resources.jia_zu_sheng_wang || 0) > 300 },
                desc: "ä¸ºäº†åº†ç¥å…¬å…¬çš„å…­åå¤§å¯¿ï¼Œä½ å†³å®šä¸¾åŠä¸€åœºå‰æ‰€æœªæœ‰çš„ç››å¤§å®´ä¼šï¼Œé‚€è¯·æ»¡æœæ–‡æ­¦ä¸äº¬åŸåæµã€‚æ¯ä¸€ä¸ªç»†èŠ‚éƒ½è€ƒéªŒç€ä½ çš„è´¢åŠ›ã€å“å‘³å’Œç¤¾äº¤æ‰‹è…•ã€‚",
                success: { text: "ä½ çš„å®´ä¼šä¸¾åŠå¾—æ— æ‡ˆå¯å‡»ï¼Œè¢«èª‰ä¸ºâ€œäº¬åŸç¬¬ä¸€è´¤å†…åŠ©â€ï¼å®¶æ—å£°æœ›æš´æ¶¨ï¼Œä½ ä¸ˆå¤«çš„å®˜åœºä¹‹è·¯å› æ­¤å˜å¾—é¡ºé‚æ— æ¯”ã€‚", effects: { core_resources: { jia_zu_sheng_wang: 100, ren_qing: 50 }, attributes: { reputation: 50 } } },
                failure: { text: "å®´ä¼šä¸­å‡ºäº†å·®é”™ï¼Œå¾—ç½ªäº†æƒè´µï¼Œæ²¦ä¸ºç¬‘æŸ„ã€‚å®¶æ—å£°æœ›å¤§è·Œï¼Œä½ ä¸ˆå¤«ä¹Ÿå› æ­¤å—åˆ°ç‰µè¿ã€‚", effects: { core_resources: { jia_zu_sheng_wang: -50 } } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šç™»å³°é€ æ",
            level_range: [8, 10],
            goal: "ä½ å·²æ˜¯å®¶æ—çš„ç»å¯¹æ ¸å¿ƒã€‚ä½ çš„ç›®æ ‡ä¸å†æ˜¯ç®¡ç†çäº‹ï¼Œè€Œæ˜¯ä¸ºå®¶æ—çš„æœªæ¥è¿›è¡Œé•¿è¿œçš„æˆ˜ç•¥å¸ƒå±€ï¼Œé€šè¿‡å­å¥³çš„å©šé…å’Œä½ çš„ç¤¾äº¤å½±å“åŠ›ï¼Œå°†å®¶æ—æ¨å‘æƒåŠ›çš„å·…å³°ã€‚",
            events: [
                {
                    title: "çš‡åçš„ç§˜å¯†èŒ¶ä¼š",
                    desc: "ä½ è¢«çš‡åç§˜å¯†å¬å…¥å®«ä¸­ï¼Œå¥¹å±é€€å·¦å³ï¼Œå‘ä½ è¯¢é—®ä¸€ä»¶å…³äºå‰æœçš„ç§˜é—»ã€‚",
                    options: [
                        { text: "ã€çŸ¥æ— ä¸è¨€ã€‘", effects: { npc_relationship: { npc_key: 'empress', favor: 50 } }, result_text: "ä½ è·å¾—äº†çš‡åçš„ç»å¯¹ä¿¡ä»»ï¼Œæˆä¸ºå¥¹åœ¨å®«å¤–çš„ä»£è¨€äººã€‚" },
                        { text: "ã€æœ‰æ‰€ä¿ç•™ã€‘", effects: { npc_relationship: { npc_key: 'empress', favor: 10 } }, result_text: "ä½ æ²¡æœ‰å·å…¥å®«å»·æœ€æ·±çš„ç§˜å¯†ï¼Œä¿å…¨äº†è‡ªèº«ï¼Œä½†ä¹Ÿå¤±å»äº†æ›´è¿›ä¸€æ­¥çš„æœºä¼šã€‚" }
                    ]
                },
// =================== ä¸»æ¯ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "æ‰¶æŒå¨˜å®¶åŠ¿åŠ›",
                        desc: "ä½ çš„å¨˜å®¶æœ‰å­å¼Ÿå‡†å¤‡å‚åŠ ç§‘ä¸¾ï¼Œå¸Œæœ›ä½ èƒ½åˆ©ç”¨å¤«å®¶çš„å½±å“åŠ›ä¸ºå…¶é“ºè·¯ã€‚",
                        options: [
                            { text: "ã€å‘å¤«å›å¼•èï¼Œè¯·å…¶å…³ç…§ã€‘", requirements: { favor: 90 }, effects: { npc_relationship: { npc_key: 'spouse', favor: 5 }, core_resources: { ren_qing: 20 } }, result_text: "å¤«å›çœ‹åœ¨ä½ çš„é¢å­ä¸Šï¼Œå…³ç…§äº†ä½ çš„å¨˜å®¶å­å¼Ÿã€‚ä½ æ¬ ä¸‹å¤«å›ä¸€ä»½äººæƒ…ã€‚" },
                            { text: "ã€åŠ¨ç”¨è‡ªå·±çš„äººè„‰æ‰“ç‚¹ã€‘", requirements: { reputation: 300 }, effects: { attributes: { reputation: -10 } }, result_text: "ä½ åŠ¨ç”¨è‡ªå·±çš„äººè„‰ç½‘ï¼Œä¸ºå¨˜å®¶å­å¼Ÿé“ºå¹³äº†é“è·¯ï¼Œä½†æ¶ˆè€—äº†ä½ éƒ¨åˆ†å£°æœ›ã€‚" }
                        ]
                    },
                    {
                        title: "å«¡åº¶ä¹‹äº‰",
                        desc: "ä½ çš„å«¡å­ä¸ä¸€ä½å—å® å¦¾å®¤æ‰€ç”Ÿçš„åº¶å­ï¼Œåœ¨ç»§æ‰¿å®¶ä¸šçš„é—®é¢˜ä¸Šäº§ç”Ÿäº†æ˜æ˜¾çš„ç«äº‰å…³ç³»ã€‚",
                        options: [
                            { text: "ã€æ‰“å‹åº¶å­ï¼Œä¸ºå«¡å­é“ºè·¯ã€‘", requirements: { scheming: 80 }, effects: { attributes: { virtue: -10 } }, result_text: "ä½ ç”¨æ‰‹æ®µæ‰“å‹äº†åº¶å­ï¼Œç¡®ä¿äº†å«¡å­çš„åœ°ä½ï¼Œä½†åå®…å› æ­¤ä¸å¾—å®‰å®ã€‚" },
                            { text: "ã€å…¬å¹³ç«äº‰ï¼Œæ‹©ä¼˜è€Œç«‹ã€‘", requirements: { virtue: 90 }, effects: { attributes: { virtue: 10 } }, result_text: "ä½ çš„å…¬æ­£èµ¢å¾—äº†æ‰€æœ‰äººçš„å°Šé‡ï¼Œä½†ä¹Ÿå¯èƒ½è®©èƒ½åŠ›ä¸è¶³çš„å«¡å­å¤±å»ç»§æ‰¿æƒã€‚" },
                            { text: "ã€åˆ†åŒ–å®¶äº§ï¼Œå„ç«‹é—¨æˆ·ã€‘", requirements: { wisdom: 90 }, effects: { core_resources: { jia_zu_sheng_wang: -20 } }, result_text: "ä½ ä¸ºä»–ä»¬åˆ†åˆ«ç½®åŠäº§ä¸šï¼Œé¿å…äº†å†…æ–—ï¼Œä½†ä¹Ÿåˆ†æ•£äº†å®¶æ—çš„æ•´ä½“å®åŠ›ã€‚" }
                        ]
                    },
                    {
                        title: "æŠ•èµ„æœªæ¥",
                        desc: "ä½ é€šè¿‡æ•é”çš„è§‚å¯Ÿï¼Œå‘ç°æœä¸­ä¸€ä½ä¸èµ·çœ¼çš„å¹´è½»å®˜å‘˜æå…·æ½œåŠ›ã€‚",
                        options: [
                            { text: "ã€ä»¥å®¶æ—åä¹‰æš—ä¸­èµ„åŠ©ã€‘", cost: { wealth: 5000 }, effects: { npc_relationship: { npc_key: 'future_star', favor: 60, type: 'ally' } }, result_text: "ä½ è¿›è¡Œäº†ä¸€æ¬¡é•¿çº¿æŠ•èµ„ã€‚è‹¥æ­¤äººæœªæ¥å¹³æ­¥é’äº‘ï¼Œå°†æˆä¸ºä½ å®¶æ—æœ€åšå®çš„ç›Ÿå‹ã€‚" },
                            { text: "ã€å°†ä¸€ä½åº¶å¥³è®¸é…ç»™ä»–ã€‘", effects: { npc_relationship: { npc_key: 'future_star', favor: 80, type: 'ally' } }, result_text: "ä½ ç”¨è”å§»çš„æ–¹å¼å°†ä»–å½»åº•ç»‘åœ¨äº†ä½ å®¶çš„èˆ¹ä¸Šã€‚" }
                        ]
                    },
                    {
                        title: "å¤«å›çš„â€œçº¢é¢œçŸ¥å·±â€",
                        desc: "ä½ å‘ç°å¤«å›æœ€è¿‘å¸¸å¸¸ä¸ä¸€ä½æ‰åè¿œæ’­çš„å¥³è¯—äººâ€œæ¢è®¨è¯—è¯â€ï¼Œä¸¾æ­¢é¢‡ä¸ºäº²å¯†ã€‚",
                        options: [
                            { text: "ã€å¤§åµå¤§é—¹ã€‘", effects: { npc_relationship: { npc_key: 'spouse', favor: -20 } }, result_text: "ä½ çš„åµé—¹è®©å¤«å›é¢œé¢å°½å¤±ï¼Œå¤«å¦»å…³ç³»é™è‡³å†°ç‚¹ã€‚" },
                            { text: "ã€ç§ä¸‹ä¼šè§é‚£ä½å¥³è¯—äººã€‘", requirements: { charm: 100, scheming: 90 }, effects: { attributes: { scheming: 5 } }, result_text: "ä½ ä¸å¥³è¯—äººè¿›è¡Œäº†ä¸€åœºæ²¡æœ‰ç¡çƒŸçš„äº¤é”‹ï¼Œæœ€ç»ˆå…µä¸è¡€åˆƒåœ°åŠé€€äº†å¯¹æ–¹ã€‚" },
                            { text: "ã€æå‡è‡ªå·±ï¼Œç¨³å›ºåœ°ä½ã€‘", effects: { npc_relationship: { npc_key: 'spouse', favor: 10 }, attributes: { charm: 5, talent: 5 } }, result_text: "ä½ å°†ç²¾åŠ›æ”¾åœ¨æå‡è‡ªå·±å’Œæ‰“ç†å®¶äº‹ä¸Šï¼Œå¤«å›æœ€ç»ˆè¿˜æ˜¯è®¤è¯†åˆ°è°æ‰æ˜¯ä»–ç¦»ä¸å¼€çš„äººã€‚" }
                        ]
                    },
                    {
                        title: "å¤ªåçš„å¬è§",
                        desc: "å› ä½ æŒå®¶æœ‰é“ã€å£°åè¿œæ’­ï¼Œå¤ªåç‰¹å¬ä½ å…¥å®«å™è¯ã€‚",
                        options: [
                            { text: "ã€åº”å¯¹å¾—ä½“ï¼Œåšå¾—æ¬¢å¿ƒã€‘", requirements: { etiquette: 120 }, effects: { attributes: { reputation: 30 }, item: { id: 'huang_hou_shang_ci_zhu_chai', amount: 1 } }, result_text: "ä½ çš„è¨€è°ˆä¸¾æ­¢æ·±å¾—å¤ªåå–œçˆ±ï¼Œèµèµäº†ä½ [çš‡åèµèµçš„ç é’—]ï¼Œä½ åœ¨è´µå¦‡åœˆä¸­çš„åœ°ä½æ— äººèƒ½åŠã€‚" },
                            { text: "ã€æ— æ„ä¸­å·å…¥å®«å»·ç§˜é—»ã€‘", requirements: { wisdom: 100 }, effects: { attributes: { scheming: 10 } }, result_text: "ä½ åœ¨ä¸å¤ªåçš„äº¤è°ˆä¸­ï¼Œæ— æ„é—´å¾—çŸ¥äº†ä¸€æ¡©å…³äºçš‡å­ä»¬çš„å®«å»·ç§˜é—»ï¼Œè¿™æˆ–è®¸æ˜¯æœºé‡ï¼Œä¹Ÿæ˜¯å±é™©ã€‚" }
                        ]
                    },
// =================== ä¸»æ¯ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "ä¸ºå­å¥³è®®äº²",
                    desc: "ä½ çš„é•¿å­/é•¿å¥³åˆ°äº†è®®äº²çš„å¹´é¾„ï¼Œåª’äººé€æ¥äº†å‡ å®¶çš„èµ„æ–™ã€‚",
                    options: [
                        { text: "ã€å¼€å§‹ç­›é€‰ã€‘", effects: { flag: 'trigger_child_marriage_sequence' }, result_text: "ä½ å¼€å§‹åŠ¨ç”¨æƒ…æŠ¥å’Œäººè„‰ï¼Œå¯¹å€™é€‰äººè¿›è¡ŒèƒŒæ™¯è°ƒæŸ¥ï¼Œè¿™å°†å†³å®šå­å¥³ä¸€ç”Ÿçš„å¹¸ç¦å’Œå®¶æ—æœªæ¥çš„ç›Ÿå‹ã€‚" }
                    ]
                },
                {
                    title: "è°ƒè§£å§»äº²çº·äº‰",
                    desc: "ä½ å‡ºå«çš„å¥³å„¿å“­ç€å›å¨˜å®¶ï¼Œè¯´è¢«å¤«å®¶æ¬ºè´Ÿã€‚",
                    options: [
                        { text: "ã€äº²è‡ªå‰å¾€äº²å®¶é—®ç½ªã€‘", effects: {}, result_text: "ä½ ä¸ºå¥³å„¿è®¨å›äº†å…¬é“ï¼Œä½†ä¸äº²å®¶å…³ç³»ç ´è£‚ã€‚" },
                        { text: "ã€å¤‡ä¸Šåšç¤¼ï¼Œç§ä¸‹è°ƒè§£ã€‘", cost: { wealth: 1000 }, effects: { core_resources: { ren_qing: 20 } }, result_text: "ä½ ç”¨ä½ çš„æ™ºæ…§å’Œæ‰‹è…•åŒ–è§£äº†çŸ›ç›¾ï¼Œä¸äº²å®¶å…³ç³»æ›´åŠ ç¨³å›ºï¼Œå¹¶è·å¾—äº†äººæƒ…ã€‚" }
                    ]
                },
                {
                    title: "å®¶æ—ç»§æ‰¿æƒçš„æš—æµ",
                    desc: "ä½ çš„å‡ ä¸ªå„¿å­ä¸ºäº†æœªæ¥çš„ç»§æ‰¿æƒï¼Œåœ¨æš—ä¸­äº’ç›¸è¾ƒåŠ²ã€‚",
                    options: [
                        { text: "ã€æ˜ç¡®ç«‹é•¿å­ä¸ºæ ¸å¿ƒã€‘", effects: {}, result_text: "ç¨³å›ºäº†ç»§æ‰¿ç§©åºï¼Œä½†å…¶ä»–å„¿å­çš„å¿ è¯šåº¦å’Œå¥½æ„Ÿåº¦ä¼šä¸‹é™ã€‚" },
                        { text: "ã€åˆ†å®¶äº§ï¼Œè®©ä»–ä»¬å„è‡ªå‘å±•ã€‘", effects: {}, result_text: "é¿å…äº†å†…æ–—ï¼Œä½†å®¶æ—çš„æ•´ä½“å®åŠ›è¢«å‰Šå¼±ã€‚" }
                    ]
                },
                {
                    title: "ç¼–æ’°å®¶ä¹¦/æ—è°±",
                    desc: "ä½ å¹´äº‹å·²é«˜ï¼Œå†³å®šå°†ä¸€ç”Ÿçš„æ²»å®¶ç»éªŒå’Œäººç”Ÿæ™ºæ…§å†™ä¸‹æ¥ã€‚",
                    options: [
                        { text: "ã€å¼€å§‹ç¼–æ’°ã€‘", effects: { item: {id: 'chuan_jia_jia_xun', amount: 1} }, result_text: "è¿™æ˜¯ä¸€ä¸ªé•¿æœŸçš„é¡¹ç›®ã€‚å®Œæˆåï¼Œä½ å°†è·å¾—ç‹¬ä¸€æ— äºŒçš„[ä¼ å®¶å®¶è®­]ï¼Œå¯ä»¥è¢«ä½ çš„åä»£åœ¨ä¸‹ä¸€è½®æ¸¸æˆä¸­ç»§æ‰¿ï¼Œä¸ºå…¶æä¾›å¼ºå¤§çš„åˆå§‹å±æ€§åŠ æˆã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šä¸€é—¨è£è€€",
                trigger: { career_level: 9, text_desc: "ä¸ˆå¤«å®˜å±…ä¸€å“æˆ–å­å¥³è¾¾æˆè¾‰ç…Œæˆå°±", condition: (gs) => gs.flags.family_peak_glory },
                desc: "æµ©è¡çš„çš‡å®¶ä»ªä»—é˜Ÿæ¥åˆ°ä½ çš„åºœå‰ï¼Œå®«ä¸­æ´¾æ¥çš„å¤ªç›‘å±•å¼€åœ£æ—¨ï¼Œé«˜å£°å®£è¯»å¯¹ä½ çš„å†Œå°ã€‚ä½ ä¸€ç”Ÿçš„éšå¿ã€æ™ºæ…§å’Œç»è¥ï¼Œåœ¨è¿™ä¸€åˆ»å¾—åˆ°äº†æœ€é«˜çš„å›æŠ¥ã€‚",
                success: { text: "ä½ è¢«å†Œå°ä¸ºâ€œä¸€å“è¯°å‘½å¤«äººâ€ï¼ä½ çš„å®¶æ—å£°æœ›è¾¾åˆ°é¡¶å³°ã€‚è§£é”æœ€ç»ˆèƒ½åŠ›ã€å‘çš‡å/çš‡å¸ä¸¾èã€‘ã€‚ä½ ï¼Œå°±æ˜¯è¿™ä¸ªå®¶æ—çš„æ´»ä¼ å¥‡ã€‚", effects: { end_game_title: 'ä¸€å“è¯°å‘½', flag: 'unlock_imperial_recommendation' } },
                failure: { text: "", effects: {} } // è¾¾æˆå‹ï¼Œæ— å¤±è´¥
            }
        }
    ]
},

'embroiderer': {
    name: "ç»£å¨˜",
    icon: "fa-cut",
    gender: "female",
    core_resources: ["ben_jin", "pin_pai_sheng_wang", "du_jia_cai_liao", "reputation"],
    dashboard_name: "äº‘è£³ç»‡å°",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šç­šè·¯è“ç¼•",
            level_range: [1, 4],
            goal: "åœ¨ç«äº‰æ¿€çƒˆçš„å¸‚åœºä¸­ç”Ÿå­˜ä¸‹æ¥ï¼Œç§¯ç´¯ç¬¬ä¸€æ¡¶é‡‘ï¼Œæ‰¾åˆ°è‡ªå·±çš„ç‹¬ç‰¹é£æ ¼ï¼Œå¹¶æ‹¥æœ‰ä¸€å®¶å±äºè‡ªå·±çš„å°å°åº—é“ºã€‚",
            events: [
                {
                    title: "æ‹›å‹Ÿç»£å¨˜",
                    desc: "ä½ çš„å°ä½œåŠéœ€è¦äººæ‰‹ã€‚",
                    options: [
                        { text: "ã€æ‹›å‹Ÿæ‰‹è‰ºå¹³å¹³ä½†å·¥é’±ä½çš„ã€‘", effects: { }, result_text: "ä½ çš„æœ¬é‡‘å‹åŠ›è¾ƒå°ï¼Œä½†äº§å“è´¨é‡ä¸€èˆ¬ï¼Œå“ç‰Œå£°æœ›æå‡ç¼“æ…¢ã€‚" },
                        { text: "ã€å’¬ç‰™æ‹›å‹Ÿä¸€ä½æ‰‹è‰ºç²¾æ¹›çš„è€å¸ˆå‚…ã€‘", cost: { wealth: 500 }, effects: { core_resources: { pin_pai_sheng_wang: 10 } }, result_text: "ä½ çš„äº§å“è´¨é‡è¿œè¶…åŒè¡Œï¼Œå¾ˆå¿«å¸å¼•äº†ç¬¬ä¸€æ‰¹å®¢æˆ·ã€‚" }
                    ]
                },
// =================== ç»£å¨˜ï¼šç¬¬ä¸€å¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "çç¨€æŸ“æ–™",
                        desc: "ä¸€ä½è¥¿åŸŸå•†äººå‘ä½ å…œå”®ä¸€ç§ä»æœªè§è¿‡çš„è“è‰²æŸ“æ–™ï¼Œè‰²æ³½çº¯å‡€ï¼Œä½†ä»·æ ¼æ˜‚è´µã€‚",
                        options: [
                            { text: "ã€å€¾å°½æ‰€æœ‰ä¹°ä¸‹ã€‘", cost: { wealth: 500 }, effects: { item: { id: 'xiyu_dye', amount: 1 }, core_resources: { du_jia_cai_liao: 1 } }, result_text: "ä½ èµŒèµ¢äº†ï¼ç”¨è¿™ç§æŸ“æ–™åˆ¶æˆçš„â€œå¤©æ°´ç¢§â€ç³»åˆ—å¤§å—æ¬¢è¿ï¼Œä¸ºä½ å¸¦æ¥äº†ç¬¬ä¸€æ¡¶é‡‘ã€‚" },
                            { text: "ã€è°¨æ…è´­ä¹°æ ·å“ã€‘", cost: { wealth: 50 }, effects: {}, result_text: "ä½ èŠ±50ä¸¤è´­ä¹°äº†æ ·å“ï¼Œè¯å®äº†å…¶ä»·å€¼ï¼Œä½†é”™è¿‡äº†ç‹¬å çš„æœºä¼šã€‚" }
                        ]
                    },
                    {
                        title: "ç»£è‰ºå¤§èµ›",
                        desc: "åŸä¸­ä¸¾åŠäº†ä¸€åœºå°å‹çš„ç»£è‰ºæ¯”èµ›ï¼Œèƒœè€…å¯ä»¥è·å¾—ä¸€ç¬”å¥–é‡‘ã€‚",
                        options: [
                            { text: "ã€æ‹¿å‡ºçœ‹å®¶æœ¬é¢†å‚èµ›ã€‘", requirements: { talent: 60 }, effects: { wealth: 300, core_resources: { pin_pai_sheng_wang: 15 } }, result_text: "ä½ çš„ä½œå“æŠ€æƒŠå››åº§ï¼Œä¸ä»…èµ¢å¾—å¥–é‡‘ï¼Œä¹Ÿä¸ºä½ å°å°çš„ä½œåŠæ‰“å“äº†åæ°”ã€‚" },
                            { text: "ã€è®¤ä¸ºæ—¶æœºæœªåˆ°ï¼Œé€‰æ‹©è§‚æ‘©ã€‘", effects: { attributes: { talent: 2 } }, result_text: "ä½ åœ¨è§‚æ‘©ä¸­å­¦ä¹ åˆ°äº†å‡ ç§æ–°çš„é’ˆæ³•ã€‚" }
                        ]
                    },
                    {
                        title: "è¢«å¤§å•†é“ºæ¬ºå‹",
                        desc: "åŸä¸­æœ€å¤§çš„å¸ƒåº„â€œé”¦ç»£é˜â€è€æ¿è­¦å‘Šä½ ï¼Œä¸è®¸å†ä»ä»–çš„æ¸ é“è¿›è´§ã€‚",
                        options: [
                            { text: "ã€å¿æ°”åå£°ï¼Œå¦å¯»ä»–æ³•ã€‘", effects: {}, result_text: "ä½ è¢«è¿«å¯»æ‰¾æ–°çš„ã€æ›´æ˜‚è´µçš„è´§æºï¼Œç»è¥æˆæœ¬å¢åŠ ã€‚" },
                            { text: "ã€ä¸å°å•†æˆ·è”åˆæŠµåˆ¶ã€‘", requirements: { charm: 50 }, effects: { attributes: { reputation: 10 } }, result_text: "ä½ è”åˆäº†å…¶ä»–å°å•†æˆ·ï¼Œå…±åŒæŠµåˆ¶â€œé”¦ç»£é˜â€ï¼Œæ­¤äº‹åœ¨åŸä¸­å¼•èµ·ä¸å°çš„æ³¢æ¾œã€‚" }
                        ]
                    },
                    {
                        title: "ä¿®æ”¹æ—§è¡£",
                        desc: "ä¸€ä½å®¶å¢ƒè´«å¯’çš„å§‘å¨˜ï¼Œæ‹¿ç€æ¯äº²çš„æ—§å«è¡£å‰æ¥ï¼Œå¸Œæœ›ä½ èƒ½å¸®å¿™ä¿®æ”¹æˆå¥¹å‡ºå«æ—¶ç©¿çš„ç¤¼æœã€‚",
                        options: [
                            { text: "ã€åˆ†æ–‡ä¸å–ï¼Œç²¾å¿ƒä¿®æ”¹ã€‘", effects: { attributes: { virtue: 10, talent: 3 }, core_resources: { pin_pai_sheng_wang: 10 } }, result_text: "ä½ çš„å–„ä¸¾å’Œå·§æ‰‹è¢«ä¼ ä¸ºä½³è¯ï¼Œè®¸å¤šå¹³æ°‘å®¢æˆ·æ…•åè€Œæ¥ã€‚" },
                            { text: "ã€æ”¶å–å°‘é‡è´¹ç”¨ã€‘", cost: { wealth: -50 }, effects: { attributes: { virtue: 3 } }, result_text: "ä½ åªæ”¶å–äº†æˆæœ¬è´¹ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¡©å–„è¡Œã€‚" }
                        ]
                    },
                    {
                        title: "å®˜åºœè®¢å•",
                        desc: "è¡™é—¨éœ€è¦ä¸ºå¥³çœ·å®šåˆ¶ä¸€æ‰¹åˆ¶æœï¼Œè¿™æ˜¯ä¸€ç¬”ç¨³å®šä½†åˆ©æ¶¦å¾®è–„çš„ç”Ÿæ„ã€‚",
                        options: [
                            { text: "ã€æ¥ä¸‹è®¢å•ã€‘", effects: { wealth: 200, npc_relationship: { npc_key: 'ya_men_master', favor: 10 } }, result_text: "ä½ è™½ç„¶æ²¡èµšå¤šå°‘é’±ï¼Œä½†ä¸å®˜åºœæ­ä¸Šäº†çº¿ï¼Œä»¥ååŠäº‹æ–¹ä¾¿äº†è®¸å¤šã€‚" },
                            { text: "ã€å©‰è¨€æ‹’ç»ã€‘", effects: {}, result_text: "ä½ è®¤ä¸ºåˆ©æ¶¦å¤ªä½ï¼Œæ‹’ç»äº†è¿™ç¬”ç”Ÿæ„ã€‚" }
                        ]
                    },
// =================== ç»£å¨˜ï¼šç¬¬ä¸€å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "ç¬¬ä¸€ç¬”è®¢å•",
                    desc: "ä¸€ä½å¯Œå•†çš„å¦»å­å‰æ¥ï¼Œå¸Œæœ›èƒ½ä¸ºå¥¹çš„å¥³å„¿å®šåˆ¶ä¸€ä»¶ä¸ä¼—ä¸åŒçš„ç”Ÿæ—¥ç¤¼æœã€‚",
                    options: [
                        { text: "ã€ä½¿ç”¨åº—é‡Œæœ€å¥½çš„ææ–™ã€‘", effects: { core_resources: { pin_pai_sheng_wang: 20 }, npc_relationship: { npc_key: 'rich_merchant_wife', favor: 30, type: 'ally' } }, result_text: "ç¤¼æœç²¾ç¾ç»ä¼¦ï¼Œå®¢æˆ·éå¸¸æ»¡æ„ã€‚ä½ è™½æ²¡èµšå¤šå°‘é’±ï¼Œä½†èµ¢å¾—äº†å£ç¢‘å’Œä¸€ä½é‡è¦å®¢æˆ·ã€‚" },
                        { text: "ã€åœ¨ä¸å½±å“å¤–è§‚çš„åœ°æ–¹ä½¿ç”¨æ™®é€šææ–™ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.wisdom > 70) {
                                return { text: "ä½ ä¿è¯äº†å¤–è§‚ï¼Œè·å¾—äº†æé«˜çš„åˆ©æ¶¦ã€‚", effects: { wealth: 500, attributes: { wisdom: 1 } } };
                            }
                            return { text: "è¢«å®¢æˆ·å‘ç°ï¼Œè®¤ä¸ºä½ æ˜¯â€œå¥¸å•†â€ï¼Œå“ç‰Œå£°æœ›å—æŸã€‚", effects: { core_resources: { pin_pai_sheng_wang: -10 } } };
                        }}
                    ]
                },
                {
                    title: "é¢æ–™å¸‚åœºçš„â€œé™·é˜±â€",
                    desc: "ä¸€ä½å¸ƒæ–™å•†äººå‘ä½ ä½ä»·å…œå”®ä¸€æ‰¹è‰²æ³½æä¸ºè‰³ä¸½çš„â€œè¥¿åŸŸå¸ƒæ–™â€ã€‚",
                    options: [
                        { text: "ã€å…¨éƒ¨ä¹°ä¸‹ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.wisdom < 80) {
                                return { text: "è¿™æ‰¹å¸ƒæ–™ä¸€ç»æ°´æ´—å°±ä¸¥é‡è¤ªè‰²ï¼Œä½ çš„æŠ•èµ„è¡€æœ¬æ— å½’ã€‚", effects: { wealth: -300 } };
                            }
                            return { text: "ä½ åœ¨è´­ä¹°å‰è¿›è¡Œäº†æµ‹è¯•ï¼Œè¯†ç ´äº†éª—å±€ï¼Œé¿å…äº†æŸå¤±ã€‚", effects: { attributes: { wisdom: 2 } } };
                        }}
                    ]
                },
                {
                    title: "é‚»é‡Œå•†é“ºçš„æ’æŒ¤",
                    desc: "éš”å£çš„ç”·æ€§è€æ¿ä»¬å¯¹ä½ ä¸€ä¸ªå¥³äººå®¶æŠ›å¤´éœ²é¢åšç”Ÿæ„æŒ‡æŒ‡ç‚¹ç‚¹ï¼Œç”šè‡³æŠ¢ä½ çš„å®¢æºã€‚",
                    options: [
                        { text: "ã€èµ é€äº²æ‰‹åˆ¶ä½œçš„[ç²¾è‡´è·åŒ…]ç¤ºå¥½ã€‘", effects: { social_favor: { group: 'neighbor_shops', change: 10 } }, result_text: "ä½ çš„å–„æ„å’Œå·§æ‰‹èµ¢å¾—äº†ä»–ä»¬çš„å°Šé‡ï¼Œå…³ç³»æœ‰æ‰€æ”¹å–„ã€‚" },
                        { text: "ã€æ¨å‡ºâ€œå¥³æ€§ä¸“å±â€æŠ˜æ‰£ï¼Œç²¾å‡†è¥é”€ã€‘", effects: { core_resources: { pin_pai_sheng_wang: 5 } }, result_text: "ä½ å¸å¼•äº†åŸä¸­å¤§éƒ¨åˆ†å¥³æ€§å®¢æˆ·ï¼Œè®©éš”å£è€æ¿ä»¬æ— å¯å¥ˆä½•ã€‚" }
                    ]
                },
                {
                    title: "çµæ„Ÿçš„æ¯ç«­",
                    desc: "ä½ æœ€è¿‘æ„Ÿè§‰è®¾è®¡ä¸å‡ºæ–°ä¸œè¥¿äº†ã€‚",
                    options: [
                        { text: "ã€å‰å¾€éƒŠå¤–/å¯ºåº™æ¸¸ç©ã€‘", effects: { core_resources: { ling_gan: 30, xin_jing: 'æ¬æ·¡' } }, result_text: "ä½ åœ¨è‡ªç„¶ä¸å®é™ä¸­è·å¾—äº†å¯å‘ã€‚" },
                        { text: "ã€å»ç«äº‰å¯¹æ‰‹çš„åº—é“ºâ€œè€ƒå¯Ÿâ€ã€‘", effects: { core_resources: { ling_gan: 15 }, attributes: { virtue: -2 } }, result_text: "ä½ å€Ÿé‰´äº†å¯¹æ–¹çš„ä¼˜ç‚¹ï¼Œä½†æ­¤ä¸¾æœ‰å¤±é£éª¨ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šä¸€ç»£æˆå",
                trigger: { career_level: 3, text_desc: "æˆä¸ºæŒæŸœ, æ‰æƒ…>80, å“ç‰Œå£°æœ›>50", condition: (gs) => gs.player.attributes.talent > 80 && (gs.career.core_resources.pin_pai_sheng_wang || 0) > 50 },
                desc: "ä¸€ä½ç©¿ç€æœ´ç´ ä½†æ°”è´¨ä¸å‡¡çš„ä¾å¥³ï¼Œæ‚„ç„¶æ¥åˆ°ä½ ç®€é™‹çš„ä½œåŠï¼Œè¨€ç§°è‡ªå®¶ä¸»å­åŒå€¦äº†äº¬åŸåƒç¯‡ä¸€å¾‹çš„é£æ ¼ï¼Œæƒ³å¯»ä¸€ä»¶çœŸæ­£â€œåˆ«è‡´â€çš„å°ç‰©ä»¶ã€‚",
                success: { text: "ä½ çš„ä½œå“æ·±å¾—å®‰å›½å…¬å¤«äººçš„å–œçˆ±ï¼å¥¹æˆä¸ºäº†ä½ çš„ç¬¬ä¸€ä½å¤§å®¢æˆ·å’Œä¿æŠ¤äººï¼Œå¹¶èµ äºˆä½ [è´µå¤«äººçš„ä¿¡ç‰©]ã€‚ä½ è·å¾—äº†è¶³å¤Ÿèµ„é‡‘åœ¨äº¬åŸæœ€ç¹åçš„åœ°æ®µå¼€è®¾ä¸€å®¶çœŸæ­£çš„åº—é“ºï¼", effects: { core_resources: { pin_pai_sheng_wang: 100 }, wealth: 2000, item: { id: 'gui_fu_ren_xin_wu', amount: 1 } } },
                failure: { text: "ä½ çš„ä½œå“æœªèƒ½æ‰“åŠ¨å¯¹æ–¹ï¼Œå¥¹å®¢æ°”åœ°ä»˜äº†é’±ä¾¿å†æ— ä¸‹æ–‡ã€‚ä½ é”™å¤±äº†è¿›å…¥ä¸Šæµç¤¾ä¼šçš„æœºä¼šã€‚", effects: {} }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šååŠ¨äº¬å",
            level_range: [5, 7],
            goal: "å°†åº—é“ºæ‰“é€ æˆäº¬åŸçŸ¥åå“ç‰Œï¼Œå¼€è®¾åˆ†åº—ï¼Œç®¡ç†æ—¥ç›Šå¢å¤šçš„ç»£å¨˜å›¢é˜Ÿï¼Œå¹¶åœ¨ä¸å®¿æ•Œçš„ç«äº‰ä¸­è„±é¢–è€Œå‡ºã€‚",
            events: [
                {
                    title: "åº”å¯¹â€œéœ“è£³åŠâ€çš„æŒ‘æˆ˜",
                    desc: "ä½ çš„å®¿æ•Œã€éœ“è£³åŠã€‘å¼€å§‹å…¨é¢æ¨¡ä»¿ä½ çš„é£æ ¼ï¼Œå¹¶ä»¥æ›´ä½çš„ä»·æ ¼å‡ºå”®ã€‚",
                    options: [
                        { text: "ã€å‘èµ·ä»·æ ¼æˆ˜ã€‘", cost: { wealth: 5000 }, effects: { core_resources: { ben_jin: -5000 } }, result_text: "ä¸€åœºæƒ¨çƒˆçš„èµ„æœ¬æ¶ˆè€—æˆ˜ã€‚ä½ çš„æœ¬é‡‘å’Œéœ“è£³åŠçš„æœ¬é‡‘åŒæ—¶å¤§é‡å‡å°‘ï¼Œèƒœè´Ÿéš¾æ–™ã€‚" },
                        { text: "ã€ä¸¾åŠâ€œé«˜çº§å®šåˆ¶â€èŒ¶ä¼šã€‘", cost: { wealth: 1000 }, effects: { core_resources: { pin_pai_sheng_wang: 30 } }, result_text: "ä½ æ¨å‡ºâ€œä¸€äººä¸€ç‰ˆâ€çš„é«˜ç«¯å®šåˆ¶æœåŠ¡ï¼Œå½»åº•å é¢†äº†é«˜ç«¯å¸‚åœºï¼Œåˆ©æ¶¦ç‡å¤§å¹…æå‡ã€‚" },
                        { text: "ã€æš—ä¸­è°ƒæŸ¥å…¶â€œé»‘æ–™â€ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.wisdom > 100) {
                                return { text: "ä½ å‘ç°éœ“è£³åŠä½¿ç”¨åŠ£è´¨æŸ“æ–™ã€‚ä½ å¯ä»¥é€‰æ‹©â€œæ›å…‰â€å½»åº•å‡»å®å¯¹æ–¹ï¼ˆå“å¾·-5ï¼‰ï¼Œæˆ–â€œä»¥æ­¤è¦æŒŸâ€è·å¾—èµ”å¿å’Œå¸‚åœºä»½é¢ã€‚", effects: { flag: 'found_competitor_dirt' } };
                            }
                            return { text: "ä½ ä¸€æ— æ‰€è·ã€‚", effects: {} };
                        }}
                    ]
                },
// =================== ç»£å¨˜ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "åˆ›ç«‹å“ç‰Œ",
                        desc: "ä½ çš„åº—é“ºå·²ç»å°æœ‰åæ°”ï¼Œä½ å†³å®šä¸ºå®ƒå–ä¸€ä¸ªæ­£å¼çš„åå­—ï¼Œåˆ›ç«‹è‡ªå·±çš„å“ç‰Œã€‚",
                        options: [
                            { text: "ã€ä»¥è‡ªå·±çš„åå­—å‘½åã€‘", effects: { core_resources: { pin_pai_sheng_wang: 20 } }, result_text: "ä½ çš„åå­—ä»æ­¤ä¸é«˜å“è´¨çš„ç»£å“ç´§ç´§è”ç³»åœ¨ä¸€èµ·ã€‚" },
                            { text: "ã€å–ä¸€ä¸ªé£é›…çš„åå­—ã€‘", requirements: { talent: 80 }, effects: { core_resources: { pin_pai_sheng_wang: 15 } }, result_text: "ä¸€ä¸ªé›…è‡´çš„å“ç‰Œåï¼Œå¸å¼•äº†è®¸å¤šæ–‡äººé›…å£«çš„å¤«äººå‰æ¥å…‰é¡¾ã€‚" }
                        ]
                    },
                    {
                        title: "æ¥è‡ªå®«å»·çš„è¯•æ¢",
                        desc: "ä¸€ä½å®«é‡Œçš„å…¬å…¬æ¥åˆ°ä½ çš„åº—é‡Œï¼Œä¸è¨€æ˜èº«ä»½ï¼Œåªè¯´è¦å®šåˆ¶ä¸€ä»¶â€œè´µäººâ€ç©¿çš„è¡£æœã€‚",
                        options: [
                            { text: "ã€å€¾å°½å¿ƒåŠ›ï¼Œä¸é—®æ¥è·¯ã€‘", requirements: { talent: 100 }, effects: { attributes: { reputation: 20 }, npc_relationship: { npc_key: 'palace_eunuch', favor: 30, type: 'ally' } }, result_text: "ä½ çš„ä½œå“æ·±å¾—å®«ä¸­æŸä½å¨˜å¨˜çš„å–œçˆ±ï¼Œè¿™ä½å…¬å…¬ä¹Ÿæˆäº†ä½ åœ¨å®«ä¸­çš„çœ¼çº¿ã€‚" },
                            { text: "ã€æ‹…å¿ƒæƒ¹ç¥¸ï¼Œå©‰è¨€æ‹’ç»ã€‘", effects: {}, result_text: "ä½ æ‹’ç»äº†è¿™ç¬”è®¢å•ï¼Œè™½ç„¶å®‰å…¨ï¼Œä½†ä¹Ÿé”™å¤±äº†å¤©å¤§çš„æœºé‡ã€‚" }
                        ]
                    },
                    {
                        title: "å±±å¯¨é£æ³¢",
                        desc: "ä½ å‘ç°å¸‚é¢ä¸Šå‡ºç°äº†å¤§é‡ä»¿å†’ä½ è®¾è®¡çš„å»‰ä»·ç»£å“ï¼Œä¸¥é‡å½±å“äº†ä½ çš„ç”Ÿæ„ã€‚",
                        options: [
                            { text: "ã€ä¸å¯¹æ–¹å¯¹ç°¿å…¬å ‚ã€‘", cost: { wealth: 500 }, effects: { core_resources: { pin_pai_sheng_wang: 10 } }, result_text: "ä½ èŠ±è´¹500ä¸¤æ‰“èµ¢äº†å®˜å¸ï¼Œç»´æŠ¤äº†å“ç‰Œçš„å£°èª‰ã€‚" },
                            { text: "ã€å¼€å‘é˜²ä¼ªæ ‡è¯†ã€‘", requirements: { wisdom: 80 }, effects: { core_resources: { du_jia_cai_liao: 1 } }, result_text: "ä½ è®¾è®¡å‡ºä¸€ç§ç‹¬ç‰¹çš„é˜²ä¼ªç»£å°ï¼Œå½»åº•æœç»äº†ä»¿å†’å“ã€‚" },
                            { text: "ã€é™ä»·ç«äº‰ã€‘", effects: { core_resources: { ben_jin: -1000 } }, result_text: "ä½ è¢«è¿«å·å…¥ä»·æ ¼æˆ˜ï¼Œè™½ç„¶èµ¶èµ°äº†ä»¿å†’è€…ï¼Œä½†ä¹ŸæŸå¤±äº†ä¸å°‘åˆ©æ¶¦ã€‚" }
                        ]
                    },
                    {
                        title: "å¼‚åŸŸé£æƒ…",
                        desc: "ä¸€ä½è¥¿åŸŸèˆå¥³æ¥åˆ°ä½ çš„åº—é‡Œï¼Œå¸Œæœ›èƒ½å®šåˆ¶ä¸€ä»¶å……æ»¡å¼‚åŸŸé£æƒ…çš„èˆè¡£ã€‚",
                        options: [
                            { text: "ã€å¤§èƒ†å°è¯•ï¼Œèåˆé£æ ¼ã€‘", requirements: { talent: 90 }, effects: { attributes: { talent: 5 }, core_resources: { pin_pai_sheng_wang: 25 } }, result_text: "ä½ è®¾è®¡çš„èˆè¡£æƒŠè‰³äº†å…¨åŸï¼Œå¼€åˆ›äº†æ–°çš„æµè¡Œé£æ½®ã€‚" },
                            { text: "ã€åšæŒæœ¬åœŸé£æ ¼ã€‘", effects: {}, result_text: "ä½ æ‹’ç»äº†è¯·æ±‚ï¼ŒåšæŒè‡ªå·±çš„è®¾è®¡ç†å¿µã€‚" }
                        ]
                    },
                    {
                        title: "æ”¶æˆå¾’å¼Ÿ",
                        desc: "ä½ çš„åæ°”å¸å¼•äº†ä¸€äº›å¹´è½»å§‘å¨˜å‰æ¥æ‹œå¸ˆå­¦è‰ºã€‚",
                        options: [
                            { text: "ã€æ‹©ä¼˜å½•å–ï¼Œå€¾å›Šç›¸æˆã€‘", effects: { attributes: { virtue: 5 }, flag: 'unlock_apprentices' }, result_text: "ä½ å¼€åŠäº†ç»£ç­ï¼ŒåŸ¹å…»å‡ºçš„ç»£å¨˜å°†æˆä¸ºä½ æœ€å¾—åŠ›çš„åŠ©æ‰‹ã€‚ï¼ˆè§£é”å¾’å¼Ÿç³»ç»Ÿï¼‰" },
                            { text: "ã€æ‹…å¿ƒæŠ€æœ¯å¤–æµè€Œæ‹’ç»ã€‘", effects: {}, result_text: "ä½ æ‹’ç»äº†æ‰€æœ‰è¯·æ±‚ï¼Œé€‰æ‹©ç‹¬è‡ªå‘å±•ã€‚" }
                        ]
                    },
// =================== ç»£å¨˜ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "å­£èŠ‚æ€§çˆ†æ¬¾çš„èµŒæ³¨",
                    desc: "æ ¹æ®å¸‚åœºä¼ é—»ï¼Œä»Šå¹´ç§‹å­£çš„æµè¡Œå…ƒç´ å¯èƒ½æ˜¯â€œè¥¿åŸŸé£æƒ…â€æˆ–â€œç®€çº¦ç´ é›…â€ã€‚",
                    options: [
                        { text: "ã€å…¨åŠ›ç”Ÿäº§â€œè¥¿åŸŸé£â€æœé¥°ã€‘", getOutcome: (gs) => {
                            if (Math.random() < 0.5) {
                                return { text: "ä½ èµŒå¯¹äº†ï¼ä½ çš„æœé¥°å¼•é¢†æ½®æµï¼Œæœ¬å­£åº¦åˆ©æ¶¦ç¿»ä¸‰å€ï¼", effects: { wealth: 10000 } };
                            }
                            return { text: "ä½ èµŒé”™äº†ã€‚è´§ç‰©å¤§é‡ç§¯å‹ï¼Œæœ¬é‡‘ä¸¥é‡äºæŸã€‚", effects: { wealth: -5000 } };
                        }},
                        { text: "ã€ä¸¤ç§é£æ ¼éƒ½å°‘é‡ç”Ÿäº§ã€‘", effects: { wealth: 2000 }, result_text: "æ— è®ºå“ªç§æµè¡Œï¼Œä½ éƒ½èƒ½å°èµšä¸€ç¬”ï¼Œä½†æ— æ³•è·å¾—çˆ†å‘æ€§å¢é•¿ã€‚" }
                    ]
                },
                {
                    title: "ä¸ä¾›åº”å•†çš„åšå¼ˆ",
                    desc: "æ±Ÿå—çš„ä¸ç»¸ä¾›åº”å•†å‘ŠçŸ¥ä½ ï¼Œä»Šå¹´æœ€å¥½çš„é‚£ä¸€æ‰¹â€œé›ªèš•ä¸â€æ•°é‡æœ‰é™ã€‚",
                    options: [
                        { text: "ã€æ”¯ä»˜æº¢ä»·ï¼Œå…¨éƒ¨ä¹°æ–­ã€‘", cost: { wealth: 8000 }, effects: { core_resources: { du_jia_cai_liao: 1 } }, result_text: "ä½ è·å¾—äº†[é¡¶çº§é›ªèš•ä¸]ï¼Œå¯ä»¥åˆ¶ä½œå‡ºæœ€é«˜å“è´¨çš„æœè£…ã€‚ä½ çš„å¯¹æ‰‹æ— ç±³ä¸‹é”…ã€‚" },
                        { text: "ã€ä¸å¯¹æ‰‹ç«ä»·ã€‘", effects: {}, result_text: "å¯¼è‡´ææ–™ä»·æ ¼é£æ¶¨ï¼Œæ— è®ºè°èµ¢ï¼Œåˆ©æ¶¦éƒ½å°†å—æŸã€‚" }
                    ]
                },
                {
                    title: "å¼€è®¾åˆ†åº—çš„é€‰å€",
                    desc: "ä½ çš„ç”Ÿæ„è’¸è’¸æ—¥ä¸Šï¼Œéœ€è¦å¼€è®¾åˆ†åº—ã€‚",
                    options: [
                        { text: "ã€é€‰åœ¨æƒè´µèšé›†çš„â€œæœ±é›€å¤§è¡—â€ã€‘", cost: { wealth: 15000 }, effects: { core_resources: { pin_pai_sheng_wang: 50 } }, result_text: "ç§Ÿé‡‘æé«˜ï¼Œä½†å“ç‰Œå£°æœ›å¤§å¹…æå‡ï¼Œèƒ½å¸å¼•åˆ°æœ€é«˜ç«¯çš„å®¢æˆ·ã€‚" },
                        { text: "ã€é€‰åœ¨å•†é“ºæ—ç«‹çš„â€œä¸œå¸‚â€ã€‘", cost: { wealth: 8000 }, effects: { flag: 'east_market_branch' }, result_text: "ç«äº‰æ¿€çƒˆï¼Œä½†èƒ½è·å¾—æœ€å¤§çš„å®¢æµé‡ï¼Œåˆ©æ¶¦ç‡è¾ƒä½ã€‚" }
                    ]
                },
                {
                    title: "ç»£å¨˜çš„â€œè·³æ§½â€å±æœº",
                    desc: "ä½ æ‰‹ä¸‹æœ€èƒ½å¹²çš„ç»£å¨˜è¢«ã€éœ“è£³åŠã€‘ä»¥ä¸‰å€å·¥é’±æŒ–è§’ã€‚",
                    options: [
                        { text: "ã€åŒ¹é…è–ªé…¬ã€‘", cost: { wealth: 500 }, effects: {}, result_text: "ä½ ç•™ä½äº†äººï¼Œä½†ç»è¥æˆæœ¬æ°¸ä¹…æ€§ä¸Šå‡ã€‚" },
                        { text: "ã€æƒ…æ„ŸæŒ½ç•™ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.charm > 120) {
                                return { text: "å¥¹è¢«ä½ çš„æƒ…è°Šå’Œç†æƒ³æ‰“åŠ¨ï¼Œå†³å®šç•™ä¸‹ã€‚å¥¹å¯¹ä½ æ­»å¿ƒå¡Œåœ°ã€‚", effects: { npc_relationship: { npc_key: 'top_embroiderer', favor: 50 } } };
                            }
                            return { text: "å¥¹æ„Ÿè°¢ä½ çš„çœ‹é‡ï¼Œä½†è¿˜æ˜¯é€‰æ‹©äº†æ›´é«˜çš„è–ªæ°´ã€‚", effects: {} };
                        }},
                        { text: "ã€ææ‹”å‰¯æ‰‹ï¼Œç¥å¥¹å‰ç¨‹ä¼¼é”¦ã€‘", effects: {}, result_text: "ä½ å±•ç°äº†æ°”åº¦ï¼Œå¹¶ææ‹”äº†æ–°äººã€‚è™½æœ‰çŸ­æœŸé˜µç—›ï¼Œä½†é•¿æœŸæ¥çœ‹ï¼Œä½ æ‹¥æœ‰äº†æ›´å¿ è¯šçš„å›¢é˜Ÿã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šäº¬åŸæ—¶å°šé£å‘æ ‡",
                trigger: { career_level: 6, text_desc: "ååŠ¨äº¬å, å“ç‰Œå£°æœ›>500", condition: (gs) => (gs.career.core_resources.pin_pai_sheng_wang || 0) > 500 },
                desc: "åœ¨ä½ è‡ªå®¶çš„åèŠ±å›­ï¼Œä½ ä¸¾åŠäº†ä¸€åœºåç¾çš„æ—¶è£…ç§€ï¼Œäº¬åŸæ‰€æœ‰è´µå¦‡ååª›æ‚‰æ•°åˆ°åœºã€‚ä½ å°†å‘æ•´ä¸ªäº¬åŸå®£å‘Šï¼šæ½®æµï¼Œç”±æˆ‘å®šä¹‰ï¼",
                success: { text: "ä½ çš„æ—¶è£…ç§€å¤§è·æˆåŠŸï¼ä½ çš„è®¾è®¡æˆä¸ºæœªæ¥ä¸€å¹´çš„ç»å¯¹æ½®æµã€‚ä½ çš„å•†é“ºæ­£å¼å‡çº§ä¸ºâ€œå“ç‰Œâ€ï¼Œæ‰€æœ‰å•†å“å”®ä»·æ°¸ä¹…æå‡20%ï¼", effects: { core_resources: { pin_pai_sheng_wang: 200 }, flag: 'brand_established' } },
                failure: { text: "æ—¶è£…ç§€æ²¦ä¸ºç¬‘æŸ„ï¼ŒæŠ•å…¥çš„æœ¬é‡‘å…¨éƒ¨æ‰“æ°´æ¼‚ï¼Œå“ç‰Œå£°æœ›å¤§è·Œã€‚", effects: { wealth: -5000, core_resources: { pin_pai_sheng_wang: -100 } } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šå¯Œç”²ä¸€æ–¹",
            level_range: [8, 10],
            goal: "ä½ çš„å“ç‰Œå·²æ˜¯å¸å›½é¡¶æµã€‚ä½ çš„ç›®æ ‡æ˜¯è·å¾—çš‡å®¤çš„è®¤å¯ï¼Œæˆä¸ºå¾¡ç”¨å•†äººï¼Œå¹¶å°†ä½ çš„å½±å“åŠ›ä»å•†ä¸šé¢†åŸŸæ‰©å±•åˆ°æ›´å¹¿é˜”çš„å¤©åœ°ã€‚",
            events: [
                {
                    title: "å®«å»·çš„å„æ–­è®¢å•",
                    desc: "å†…åŠ¡åºœéœ€è¦ä¸ºå®«ä¸­æ‰€æœ‰å®«å¥³é‡‡åŠå››å­£çš„åˆ¶æœï¼Œè¿™æ˜¯ä¸€ç¬”å·¨é¢è®¢å•ã€‚",
                    options: [
                        { text: "ã€ä¸è®¡æˆæœ¬ï¼Œæ‹¿ä¸‹è®¢å•ã€‘", effects: { core_resources: { pin_pai_sheng_wang: 50 }, flag: 'imperial_supplier' }, result_text: "ä½ è™½ç„¶åˆ©æ¶¦å¾®è–„ï¼Œä½†æˆä¸ºäº†â€œå®«å»·ä¾›åº”å•†â€ï¼Œå“ç‰Œå£°æœ›å’Œæ”¿æ²»åœ°ä½å¤§å¹…æå‡ã€‚" },
                        { text: "ã€ä¸å‡ å®¶å•†è¡Œè”æ‰‹ï¼Œå…±åŒæ‰¿åŠã€‘", effects: { flag: 'form_textile_guild' }, result_text: "ä½ ç»„å»ºäº†äº¬åŸç¬¬ä¸€ä¸ªâ€œæœè£…è¡Œä¼šâ€ï¼Œä½ æˆä¸ºä¼šé•¿ï¼Œæ§åˆ¶äº†æ•´ä¸ªè¡Œä¸šçš„åŸææ–™å’Œå®šä»·ã€‚" }
                    ]
                },
// =================== ç»£å¨˜ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "ç¼–æ’°ã€Šå¥³çº¢å›¾é‰´ã€‹",
                        desc: "ä½ å†³å®šå°†è‡ªå·±ä¸€ç”Ÿçš„ç»£è‰ºå¿ƒå¾—å’Œè®¾è®¡å›¾æ ·ç¼–æ’°æˆä¹¦ï¼Œæµä¼ åä¸–ã€‚",
                        options: [
                            { text: "ã€å¼€å§‹ç¼–æ’°ã€‘", effects: { item: { id: 'nv_hong_tu_jian', amount: 1 }, attributes: { reputation: 50 } }, result_text: "è¿™æ˜¯ä¸€ä¸ªé•¿æœŸçš„é¡¹ç›®ã€‚å®Œæˆåï¼Œä½ å°†è·å¾—ç‹¬ä¸€æ— äºŒçš„[ã€Šå¥³çº¢å›¾é‰´ã€‹]ï¼Œå¯ä»¥è¢«åä»£ç»§æ‰¿ï¼Œä¸ºå…¶æä¾›å¼ºå¤§çš„æ‰æƒ…åŠ æˆã€‚" }
                        ]
                    },
                    {
                        title: "çš‡åçš„å¯¿ç¤¼",
                        desc: "çš‡åå³å°†ä¸¾åŠå¯¿å®´ï¼Œå†…åŠ¡åºœå‘æ‰€æœ‰é¡¶çº§å•†å·å¾é›†å¯¿ç¤¼è®¾è®¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è£è€€ã€‚",
                        options: [
                            { text: "ã€è®¾è®¡â€œç™¾é¸Ÿæœå‡¤â€å›¾ã€‘", requirements: { talent: 150 }, effects: { core_resources: { pin_pai_sheng_wang: 100 }, npc_relationship: { npc_key: 'empress', favor: 50, type: 'ally' } }, result_text: "ä½ çš„è®¾è®¡å±é›€ä¸­é€‰ï¼ä½ è·å¾—äº†ä¸ºçš‡ååˆ¶ä½œå¯¿ç¤¼çš„èµ„æ ¼ï¼Œä»æ­¤æˆä¸ºçš‡å•†ã€‚" },
                            { text: "ã€è”åˆå…¶ä»–å•†å·å…±åŒçŒ®ç¤¼ã€‘", requirements: { charm: 120 }, effects: { attributes: { reputation: 30 } }, result_text: "ä½ è”åˆäº†å…¶ä»–ç å®ã€æœ¨å™¨å•†å·ï¼Œå…±åŒè®¾è®¡äº†ä¸€ä»½å¤§ç¤¼ï¼Œå±•ç°äº†ä½ çš„é¢†å¯¼æ‰èƒ½ã€‚" }
                        ]
                    },
                    {
                        title: "å¼€è®¾ç”·è£…çº¿",
                        desc: "æœ‰å¯Œå®¶å…¬å­å‰æ¥è¯¢é—®ï¼Œæ˜¯å¦èƒ½ä¸ºä»–ä»¬å®šåˆ¶åŒæ ·é«˜å“è´¨çš„ç”·å£«é•¿è¢ã€‚",
                        options: [
                            { text: "ã€å¼€æ‹“æ–°å¸‚åœºã€‘", cost: { wealth: 10000 }, effects: { core_resources: { ben_jin: 5000 } }, result_text: "ä½ æˆåŠŸå¼€æ‹“äº†ç”·è£…å¸‚åœºï¼Œåº—é“ºçš„æ”¶å…¥æ¥æºæ›´åŠ å¤šæ ·åŒ–ã€‚" },
                            { text: "ã€ä¸“æ³¨å¥³æ€§å¸‚åœºã€‘", effects: {}, result_text: "ä½ è®¤ä¸ºåº”è¯¥ä¸“æ³¨äºè‡ªå·±æœ€æ“…é•¿çš„é¢†åŸŸã€‚" }
                        ]
                    },
                    {
                        title: "æµ·å¤–è®¢å•",
                        desc: "ä¸€ä½æµ·å¤–ä½¿è‡£å¯¹ä½ çš„ç»£å“å¤§åŠ èµèµï¼Œå¸Œæœ›èƒ½è®¢è´­ä¸€æ‰¹è¿å›ä»–çš„å›½å®¶ã€‚",
                        options: [
                            { text: "ã€æ¥ä¸‹è®¢å•ï¼Œèµ°å‘ä¸–ç•Œã€‘", effects: { wealth: 15000, attributes: { reputation: 50 } }, result_text: "ä½ çš„å“ç‰Œä»æ­¤åæ‰¬æµ·å¤–ï¼Œä¸ºä½ å¸¦æ¥äº†å·¨å¤§çš„è´¢å¯Œå’Œå£°æœ›ã€‚" },
                            { text: "ã€æ‹…å¿ƒè¿è¾“é£é™©è€Œæ‹’ç»ã€‘", effects: {}, result_text: "ä½ é”™è¿‡äº†è®©å“ç‰Œèµ°å‘ä¸–ç•Œçš„æœºä¼šã€‚" }
                        ]
                    },
                    {
                        title: "ç»§æ‰¿äººçš„æŠ‰æ‹©",
                        desc: "ä½ å¹´äº‹å·²é«˜ï¼Œéœ€è¦ä¸ºè¿™ä¸ªåºå¤§çš„å•†ä¸šå¸å›½å¯»æ‰¾ä¸€ä½ç»§æ‰¿äººã€‚",
                        options: [
                            { text: "ã€ä»å­å¥³ä¸­æŒ‘é€‰ã€‘", effects: { flag: 'start_heir_training_embroiderer' }, result_text: "ä½ å°†å¼€å¯â€œç»§æ‰¿äººåŸ¹å…»â€æ¨¡å¼ï¼Œå°†ä½ çš„æŠ€è‰ºå’Œå•†ä¸šå¤´è„‘ä¼ æˆç»™ä¸‹ä¸€ä»£ã€‚" },
                            { text: "ã€ä»æœ€å¾—åŠ›çš„å¾’å¼Ÿä¸­ææ‹”ã€‘", effects: {}, result_text: "ä½ çš„é€‰æ‹©ç¡®ä¿äº†å“ç‰Œçš„ä¸“ä¸šæ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¼•èµ·å®¶æ—å†…éƒ¨çš„ä¸æ»¡ã€‚" }
                        ]
                    },
// =================== ç»£å¨˜ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "ä¸ç»¸ä¹‹è·¯çš„æœºé‡",
                    desc: "ä¸€ä½ã€å•†è´¾ã€‘èŒä¸šçš„ç”·æ€§å·¨å¤´ï¼Œé‚€è¯·ä½ åˆè‚¡æŠ•èµ„ä¸€æ”¯å‰å¾€è¥¿åŸŸçš„é©¼é˜Ÿã€‚",
                    options: [
                        { text: "ã€æ¥å—åˆä½œã€‘", effects: { flag: 'unlock_overseas_trade' }, result_text: "ä½ å¼€å¯äº†æµ·å¤–è´¸æ˜“ã€‚ä½ è·å¾—äº†å…¨æ–°çš„ç‹¬å®¶ææ–™ï¼Œå¹¶æœ‰æœºä¼šå°†ä½ çš„å“ç‰Œå½±å“åŠ›æ‰©å±•åˆ°æµ·å¤–ã€‚" },
                        { text: "ã€æ‹…å¿ƒé£é™©ï¼Œé€‰æ‹©æ‹’ç»ã€‘", effects: {}, result_text: "ä½ é”™è¿‡äº†è®©å“ç‰Œå›½é™…åŒ–çš„æœºä¼šã€‚" }
                    ]
                },
                {
                    title: "å»ºç«‹å¥³å­ç»‡é€ å­¦é™¢",
                    desc: "ä½ æ„Ÿå¿µåˆ›ä¸šä¸æ˜“ï¼Œå†³å®šä¸ºè´«å®¶å¥³å­æä¾›ä¸€æŠ€ä¹‹é•¿ã€‚",
                    options: [
                        { text: "ã€æŠ•å…¥å·¨èµ„ï¼Œå»ºç«‹å­¦é™¢ã€‘", cost: { wealth: 50000 }, effects: { attributes: { virtue: 50, reputation: 100 } }, result_text: "ä½ è¢«èª‰ä¸ºâ€œå¥³ä¸­å°§èˆœâ€ï¼Œå“å¾·å’Œå£°æœ›è¾¾åˆ°é¡¶å³°ã€‚å­¦é™¢å°†æºæºä¸æ–­åœ°ä¸ºä½ æä¾›æœ€å¿ è¯šã€æœ€æœ‰æ‰åçš„ç»£å¨˜ã€‚" }
                    ]
                },
                {
                    title: "ç¤¼éƒ¨çš„â€œé£åŒ–â€æŒ‡è´£",
                    desc: "ä¸€ä½ä¿å®ˆçš„ç¤¼éƒ¨å®˜å‘˜ä¸Šå¥ï¼ŒæŒ‡è´£ä½ çš„æœè£…è®¾è®¡â€œè¿‡äºæš´éœ²ï¼Œæœ‰ä¼¤é£åŒ–â€ã€‚",
                    options: [
                        { text: "ã€é€šè¿‡è´µå¦‡äººè„‰ï¼Œå‘å…¶æ–½å‹ã€‘", cost: { core_resources: { ren_qing: 30 } }, effects: {}, result_text: "é‚£äº›ç©¿ç€ä½ è¡£æœçš„ç‹å¦ƒã€å…¬ä¸»ä»¬å‘çš‡å¸æŠ±æ€¨ï¼Œè¯¥å®˜å‘˜è¢«ç”³é¥¬ï¼Œå±æœºè§£é™¤ã€‚" },
                        { text: "ã€è®¾è®¡ä¸€æ¬¾â€œé“å¾·æ ‡å…µâ€ç³»åˆ—ã€‘", effects: { core_resources: { pin_pai_sheng_wang: 20 } }, result_text: "ä½ ç”¨ä¸€æ¬¾æä¸ºç«¯åº„å…¸é›…çš„è®¾è®¡å µä½äº†æ‚ æ‚ ä¹‹å£ï¼Œå±•ç°äº†ä½ é«˜è¶…çš„è®¾è®¡é©¾é©­èƒ½åŠ›ã€‚" }
                    ]
                },
                {
                    title: "å®¶æ—çš„å‹åŠ›",
                    desc: "ä½ çš„ç”·æ€§äº²æ—ä»¥â€œå¥³å­ä¸åº”æŒç®¡å¦‚æ­¤å¤§çš„å®¶ä¸šâ€ä¸ºç”±ï¼Œè¦æ±‚ä½ å°†ç”Ÿæ„äº¤ç»™ä»–ä»¬æ‰“ç†ã€‚",
                    options: [
                        { text: "ã€ç”¨é’±è´¢å®‰æŠšï¼Œåˆ†å‡ºéƒ¨åˆ†åˆ©æ¶¦ã€‘", cost: { wealth: 10000 }, effects: {}, result_text: "æš‚æ—¶å¹³æ¯äº†çº·äº‰ï¼Œä½†ä½ çš„æ”¶å…¥å‡å°‘ã€‚" },
                        { text: "ã€å¯»æ±‚å®˜åœº/è´µå¦‡äººè„‰çš„åº‡æŠ¤ã€‘", cost: { core_resources: { ren_qing: 50 } }, effects: {}, result_text: "ä½ çš„å¼ºå¤§ç›Ÿå‹è®©å®¶æ—ä¸æ•¢å†è½»ä¸¾å¦„åŠ¨ã€‚" },
                        { text: "ã€åŸ¹å…»ä¸€ä½å¥³æ€§ç»§æ‰¿äººã€‘", effects: { flag: 'start_heir_training' }, result_text: "ä½ é€‰æ‹©åŸ¹å…»ä½ çš„å¥³å„¿æˆ–ä¸€ä½å¾—åŠ›å¥³å¾’å¼Ÿï¼Œå°†ä½ çš„äº‹ä¸šå’Œç‹¬ç«‹ç²¾ç¥ä¼ æ‰¿ä¸‹å»ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šå‡¤è¢åŠ èº«",
                trigger: { career_level: 9, text_desc: "å“ç‰Œå£°æœ›é¡¶å³°, ä¸çš‡å®¤å…³ç³»â€œä¿¡èµ–â€", condition: (gs) => (gs.career.core_resources.pin_pai_sheng_wang || 0) > 1000 && (gs.social.royal_favor || 0) > 80 },
                desc: "å†…åŠ¡åºœæ€»ç®¡äº²è‡ªæ¥åˆ°ä½ çš„åº—é“ºï¼Œå®£è¯»çš‡åæ‡¿æ—¨ï¼šå‘½ä½ ä¸ºå³å°†åˆ°æ¥çš„â€œå¤©å¯¿èŠ‚â€åˆ¶ä½œä¸€ä»¶å…¨æ–°çš„å‡¤è¢ã€‚è¿™æ—¢æ˜¯æ— ä¸Šçš„è£è€€ï¼Œä¹Ÿæ˜¯ä¸‡ä¸ˆæ·±æ¸Šã€‚",
                success: { text: "ä½ çš„å‡¤è¢åœ¨å¤©å¯¿èŠ‚å¤§å…¸ä¸Šåå…‰ä¸‡ä¸ˆï¼Œçš‡åå¤§æ‚¦ã€‚ä½ çš„å•†è¡Œè¢«æ­£å¼å†Œå°ä¸ºâ€œä¸€å“å¾¡å•†â€ï¼Œå„æ–­æ‰€æœ‰çš‡å®¤çººç»‡å“ä¾›åº”ï¼Œå¹¶è·å¾—[å‡ºå…¥å®«ç¦é‡‘ç‰Œ]ï¼", effects: { item: { id: 'chu_ru_gong_jin_jin_pai', amount: 1 }, flag: 'imperial_monopoly', end_game_title: 'ä¸€å“å¾¡å•†' } },
                failure: { text: "ä½ çš„ä½œå“å‡ºäº†å·®é”™ï¼Œè¢«è§†ä¸ºâ€œæ¬ºå›ä¹‹ç½ªâ€ï¼Œåº—é“ºæŸ¥å°ï¼Œå®¶äººæµæ”¾ã€‚", effects: { end_game: 'execution' } }
            }
        }
    ]
},

'doctor': {
    name: "å¥³åŒ»",
    icon: "fa-clinic-medical",
    gender: "female",
    core_resources: ["yi_de", "reputation", "zhen_xi_yao_cai", "yi_shu"],
    dashboard_name: "ç™¾è‰è¯åº",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šææ—æ–°ç§€",
            level_range: [1, 4],
            goal: "å­¦ä¹ åŒ»è¯åŸºç¡€ï¼Œå…‹æœè¡ŒåŒ»çš„åˆæ­¥éšœç¢ï¼Œé€šè¿‡æ²»ç–—å¸¸è§ç—…ç—‡ï¼Œåœ¨è¡—åŠé‚»é‡Œé—´å»ºç«‹æœ€åˆçš„ä¿¡ä»»ã€‚",
            events: [
                {
                    title: "è¯é“ºå­¦å¾’",
                    desc: "ä½ åœ¨ä¸€å®¶è€è¯é“ºé‡Œå½“å­¦å¾’ï¼Œæ¯æ—¥çš„å·¥ä½œæ˜¯ç¹æ‚çš„ç‚®åˆ¶è¯æã€‚",
                    options: [
                        { text: "ã€å‹¤å¥‹åœ°ç ”ç£¨è¯æã€‘", getOutcome: (gs) => {
                            let outcome = { text: "ä½ çš„å‹¤åŠ³è¢«è€è¯å¸ˆçœ‹åœ¨çœ¼é‡Œã€‚", effects: { attributes: { health: 1 }, npc_relationship: { npc_key: 'old_pharmacist', favor: 5 } } };
                            if (Math.random() < 0.1) {
                                outcome.text += " ä½ åœ¨ç ”ç£¨æ—¶å‘ç°ä¸€æ ªæœªè¢«è¯†åˆ«çš„[å¼‚ç§è‰è¯]ï¼";
                                outcome.effects.item = { id: 'yi_zhong_cao_yao', amount: 1 };
                            }
                            return outcome;
                        }},
                        { text: "ã€å·å·ç¿»é˜…è¯æŸœåçš„åŒ»ä¹¦ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.wisdom > 40) {
                                return { text: "ä½ å­¦åˆ°äº†ä¸€äº›åŸºç¡€è¯ç†ã€‚", effects: { core_resources: { yi_shu: 2 } } };
                            }
                            return { text: "è¢«å‘ç°å¹¶é­åˆ°æ–¥è´£ï¼Œè®¤ä¸ºä½ å¥½é«˜éª›è¿œã€‚", effects: { npc_relationship: { npc_key: 'old_pharmacist', favor: -5 } } };
                        }}
                    ]
                },
// =================== å¥³åŒ»ï¼šç¬¬ä¸€å¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "è¯æç‚®åˆ¶",
                        desc: "è€è¯å¸ˆè®©ä½ å¤„ç†ä¸€æ‰¹é™„å­ï¼Œæ­¤è¯æœ‰å‰§æ¯’ï¼Œç‚®åˆ¶è¿‡ç¨‹ç¨æœ‰ä¸æ…ä¾¿ä¼šä¸­æ¯’ã€‚",
                        options: [
                            { text: "ã€ä¸¥æ ¼éµå¾ªå¤æ³•ï¼Œå°å¿ƒç¿¼ç¿¼ã€‘", requirements: { wisdom: 50 }, effects: { core_resources: { yi_shu: 3 }, npc_relationship: { npc_key: 'old_pharmacist', favor: 10 } }, result_text: "ä½ æˆåŠŸå®Œæˆäº†ç‚®åˆ¶ï¼Œè€è¯å¸ˆå¯¹ä½ çš„ä¸¥è°¨ååˆ†èµèµã€‚" },
                            { text: "ã€ç¨æœ‰ä¸æ…ï¼Œæ‰‹æŒ‡å‘éº»ã€‘", effects: { attributes: { health: -5 }, core_resources: { yi_shu: 1 } }, result_text: "ä½ ä¸­äº†è½»å¾®çš„æ¯’ï¼Œä½†ä¹Ÿäº²èº«ä½“ä¼šäº†è¯æ€§ï¼Œå¯¹é™„å­çš„ç†è§£æ›´æ·±äº†ã€‚" }
                        ]
                    },
                    {
                        title: "è´«è‹¦çš„ç—…äºº",
                        desc: "ä¸€ä½è¡£è¡«è¤´è¤›çš„è€å¦‡å‰æ¥æ±‚åŒ»ï¼Œä½†å¥¹ä»˜ä¸èµ·è¯é’±ã€‚",
                        options: [
                            { text: "ã€å…è´¹ä¸ºå¥¹åŒ»æ²»ã€‘", effects: { core_resources: { yi_de: 10 }, attributes: { virtue: 5 } }, result_text: "ä½ çš„å–„ä¸¾åœ¨åŠé—´ä¼ å¼€ï¼ŒåŒ»å¾·å’Œå£°æœ›éƒ½å¾—åˆ°äº†æå‡ã€‚" },
                            { text: "ã€è®©å¥¹ç”¨åŠ³åŠ¨æŠµå€ºã€‘", effects: { core_resources: { yi_de: 2 } }, result_text: "ä¸€ä¸ªå…¬å¹³çš„è§£å†³åŠæ³•ã€‚" }
                        ]
                    },
                    {
                        title: "ä¸€æœ¬æ®‹ç ´çš„åŒ»ä¹¦",
                        desc: "ä½ åœ¨æ—§ä¹¦æ‘Šä¸Šå‘ç°ä¸€æœ¬ä½œè€…ä¸è¯¦çš„åŒ»ä¹¦æ®‹å·ï¼Œä¸Šé¢è®°è½½äº†ä¸€äº›é—»æ‰€æœªé—»çš„æ²»ç–—æ€è·¯ã€‚",
                        options: [
                            { text: "ã€èŠ±è´¹100ä¸¤ä¹°ä¸‹ã€‘", cost: { wealth: 100 }, effects: { attributes: { wisdom: 5 }, core_resources: { yi_shu: 5 } }, result_text: "ä½ ä¹°ä¸‹äº†åŒ»ä¹¦ï¼Œå…¶ä¸­çš„å¥‡æ€å¦™æƒ³è®©ä½ å¤§å¼€çœ¼ç•Œï¼ŒåŒ»æœ¯æå‡ã€‚" },
                            { text: "ã€è®¤ä¸ºæ˜¯æ— ç¨½ä¹‹è°ˆã€‘", effects: {}, result_text: "ä½ é”™è¿‡äº†è¿™æ¬¡æœºä¼šã€‚" }
                        ]
                    },
                    {
                        title: "åŠ©äº§",
                        desc: "é‚»å±…å®¶çš„äº§å¦‡éš¾äº§ï¼Œç¨³å©†æŸæ‰‹æ— ç­–ï¼Œæƒ…æ€¥ä¹‹ä¸‹è¯·ä½ å»å¸®å¿™ã€‚",
                        options: [
                            { text: "ã€è¿ç”¨æ‰€å­¦ï¼Œå¤§èƒ†å°è¯•ã€‘", requirements: { wisdom: 60, virtue: 40 }, effects: { attributes: { reputation: 15 }, core_resources: { yi_de: 10 } }, result_text: "ä½ æˆåŠŸå¸®åŠ©äº§å¦‡è¯ä¸‹å©´å„¿ï¼Œæ¯å­å¹³å®‰ã€‚ä½ â€œé€å­è§‚éŸ³â€çš„åå£°ä¸èƒ«è€Œèµ°ã€‚" },
                            { text: "ã€è¡¨ç¤ºæ— èƒ½ä¸ºåŠ›ã€‘", effects: {}, result_text: "ä½ ä¸æ•¢å†’é™©ï¼Œæœ€ç»ˆäº§å¦‡è™½ç„¶ä¿ä½äº†æ€§å‘½ï¼Œä½†å­©å­å¤­æŠ˜äº†ã€‚" }
                        ]
                    },
                    {
                        title: "å® ç‰©çš„ç–¾ç—…",
                        desc: "ä¸€ä½è´µå¦‡äººæŠ±ç€å¥¹ç”Ÿç—…çš„çˆ±çŒ«å‰æ¥ï¼Œå¸Œæœ›ä½ èƒ½æ²»å¥½å®ƒã€‚",
                        options: [
                            { text: "ã€è§¦ç±»æ—é€šï¼Œä¸ºå…¶æ²»ç–—ã€‘", requirements: { wisdom: 50 }, effects: { wealth: 200, npc_relationship: { npc_key: 'cat_lady', favor: 20 } }, result_text: "ä½ æˆåŠŸæ²»å¥½äº†å°çŒ«ï¼Œè´µå¦‡äººååˆ†æ„Ÿæ¿€ï¼Œç»™äº†ä½ ä¸°åšçš„æŠ¥é…¬ï¼Œå¹¶æˆä¸ºä½ çš„å¸¸å®¢ã€‚" },
                            { text: "ã€è¡¨ç¤ºåªåŒ»äººï¼Œä¸åŒ»ç•œã€‘", effects: {}, result_text: "ä½ æ‹’ç»äº†è´µå¦‡äººï¼Œå¥¹å¤±æœ›åœ°ç¦»å¼€äº†ã€‚" }
                        ]
                    },
// =================== å¥³åŒ»ï¼šç¬¬ä¸€å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "ç¬¬ä¸€æ¬¡å‡ºè¯Š",
                    desc: "é‚»å®¶ä¸‰å²çš„å­©ç«¥æ·±å¤œé«˜çƒ§ä¸é€€ï¼Œç”·å¤§å¤«å‡ºè¿œé—¨æœªå½’ï¼Œå­©å­çš„æ¯äº²ç„¦æ€¥åœ°å‰æ¥æ±‚ä½ ã€‚",
                    options: [
                        { text: "ã€è‡ªä¿¡å‰å¾€ï¼Œä¸ºå…¶è¯Šæ²»ã€‘", getOutcome: (gs) => {
                            if ((gs.career.core_resources.yi_shu || 0) + gs.player.attributes.wisdom > 50) {
                                return { text: "ä½ æˆåŠŸä¸ºå­©å­é€€äº†çƒ§ï¼Œè·å¾—äº†è¡—åŠçš„åˆæ­¥ä¿¡ä»»ã€‚", effects: { attributes: { reputation: 10 }, core_resources: { yi_de: 5 } } };
                            }
                            return { text: "å­©å­ç—…æƒ…åŠ é‡ï¼Œä½ é­åˆ°é‚»é‡Œçš„æŒ‡è´£ã€‚", effects: { attributes: { reputation: -10 } } };
                        }}
                    ]
                },
                {
                    title: "å¤ç±ä¸­çš„åæ–¹",
                    desc: "ä½ åœ¨æ•´ç†ä¸€æœ¬ç ´æ—§åŒ»ä¹¦æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªæ²»ç–—é£æ¹¿çš„å¥‡æ€ªåæ–¹ï¼Œéœ€è¦ç”¨åˆ°èå­å’Œèœˆèš£ã€‚",
                    options: [
                        { text: "ã€ä¸ºä¸€ä½é¥±å—é£æ¹¿ä¹‹è‹¦çš„è€äººå°è¯•ã€‘", getOutcome: (gs) => {
                            if (Math.random() < 0.5) {
                                return { text: "åæ–¹æœ‰å¥‡æ•ˆï¼ä½ å°†æ­¤æ–¹å‰‚æ”¶å½•ï¼Œè·å¾—[ç‹¬å®¶è¯æ–¹]ã€‚", effects: { core_resources: { yi_shu: 5 }, attributes: { reputation: 10 }, item: { id: 'du_jia_yao_fang', amount: 1 } } };
                            }
                            return { text: "æ¯«æ— æ•ˆæœï¼Œç”šè‡³åŠ é‡äº†ç—…æƒ…ã€‚", effects: { attributes: { reputation: -5 }, core_resources: { yi_de: -5 } } };
                        }},
                        { text: "ã€è®¤ä¸ºé£é™©å¤ªé«˜ï¼Œæ”¾å¼ƒå°è¯•ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©äº†ç¨³å¦¥ï¼Œä½†ä¹Ÿé”™å¤±äº†ç²¾è¿›åŒ»æœ¯çš„æœºä¼šã€‚" }
                    ]
                },
                {
                    title: "æ¥è‡ªåŒè¡Œçš„è½»è§†",
                    desc: "åŸé‡Œçš„ç”·å¤§å¤«å…¬å¼€å£°ç§°â€œå¥³å­é˜´æŸ”ï¼Œä¸å®œè¡Œé˜³åˆšä¹‹åŒ»æœ¯â€ï¼Œå¯¼è‡´ä½ çš„ç—…äººå‡å°‘ã€‚",
                    options: [
                        { text: "ã€ä¸å…¶å…¬å¼€è¾©è®ºã€‘", effects: { attributes: { reputation: -5 } }, result_text: "æ— è®ºè¾“èµ¢ï¼Œè¿™åœºé£æ³¢éƒ½ä¼šè®©ä½ çš„åå£°å—æŸã€‚" },
                        { text: "ã€ç”¨ç–—æ•ˆè¯´è¯ï¼Œä¸äºˆç†ä¼šã€‘", effects: { attributes: { virtue: 3, reputation: 5 } }, result_text: "ä½ ä¸“å¿ƒæ²»ç—…æ•‘äººã€‚ä¸€æ®µæ—¶é—´åï¼Œä½ çš„ç–—æ•ˆè®©æµè¨€ä¸æ”»è‡ªç ´ã€‚" }
                    ]
                },
                {
                    title: "ä¸Šå±±é‡‡è¯",
                    desc: "ä¸ºäº†è¡¥å……è¯æï¼Œä½ äº²è‡ªè¿›å…¥æ·±å±±ã€‚",
                    options: [
                        { text: "ã€åœ¨å¤–å›´é‡‡æ‘˜å¸¸è§è‰è¯ã€‘", effects: { item: { id: 'common_herbs', amount: 10 } }, result_text: "å®‰å…¨è¿”å›ï¼Œè·å¾—äº†ç”˜è‰ã€é‡‘é“¶èŠ±ç­‰å¸¸ç”¨è¯æã€‚" },
                        { text: "ã€å†’é™©è¿›å…¥æ·±å±±ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.health > 70) {
                                return { text: "ä½ èº²è¿‡äº†æ¯’è›‡çŒ›å…½ï¼ŒæˆåŠŸé‡‡åˆ°äº†[ç™¾å¹´çµèŠ]ï¼", effects: { item: { id: 'bai_nian_ling_zhi', amount: 1 } } };
                            }
                            return { text: "ä½ å—ä¼¤è€Œå½’ï¼Œéœ€è¦ä¼‘å…»ã€‚", effects: { attributes: { health: -20 } } };
                        }}
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šå¦™æ‰‹å›æ˜¥",
                trigger: { career_level: 3, text_desc: "æˆä¸ºåŒ»å¥³, åŒ»æœ¯>80, åŒ»å¾·>50", condition: (gs) => (gs.career.core_resources.yi_shu || 0) > 80 && (gs.career.core_resources.yi_de || 0) > 50 },
                desc: "ä½ æ‰€åœ¨çš„è¡—åŒºçˆ†å‘äº†ä¸€åœºå¤§è§„æ¨¡çš„â€œç—¢ç–¾â€ï¼Œå®¶å®¶æˆ·æˆ·ç—…å€’ï¼Œå“€åšå£°ä¸æ–­ã€‚å®˜åºœçš„è¯é“ºæ”¶æ•ˆç”šå¾®ã€‚è¿™æ˜¯ä½ è¯æ˜è‡ªå·±ã€è·å¾—ç«‹èº«ä¹‹æœ¬çš„ç»ä½³æœºä¼šã€‚",
                success: { text: "ä½ åŠ›æŒ½ç‹‚æ¾œï¼Œæˆä¸ºäº†æ•´ç‰‡è¡—åŒºçš„æ•‘å‘½æ©äººï¼ä½ è·å¾—äº†è¶³å¤Ÿçš„èµ„é‡‘å’Œåæœ›ï¼Œæ­£å¼å¼€è®¾äº†å±äºè‡ªå·±çš„ã€ç™¾è‰è¯åºã€‘ï¼", effects: { career_level_set: 4, attributes: { reputation: 150 }, core_resources: { yi_de: 50 }, wealth: 1000, flag: 'clinic_opened' } },
                failure: { text: "ç–«æƒ…å¤±æ§ï¼Œä½ æŸæ‰‹æ— ç­–ï¼Œä¹‹å‰çš„åŠªåŠ›ä»˜è¯¸ä¸œæµã€‚ä½ çš„è¡ŒåŒ»ç”Ÿæ¶¯é­é‡é‡å¤§æ‰“å‡»ã€‚", effects: { attributes: { reputation: -30 } } }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šå°æœ‰åŒ»å",
            level_range: [5, 7],
            goal: "ä½ çš„åå£°å¼€å§‹ä¼ åˆ°ä¸Šæµç¤¾ä¼šã€‚ä½ éœ€è¦æ²»ç–—æ›´å¤æ‚çš„ç—…ç—‡ï¼Œå¹¶å¤„ç†éšä¹‹è€Œæ¥çš„ã€æ›´åŠ å¤æ‚çš„ä¼¦ç†å’Œäººé™…å…³ç³»æŒ‘æˆ˜ã€‚",
            events: [
                {
                    title: "æƒè´µå®¶çš„â€œéšç–¾â€",
                    desc: "ä¸€ä½ä¾¯çˆµå¤«äººæ´¾å¿ƒè…¹ç§˜å¯†è¯·ä½ è¿‡åºœï¼Œä¸ºå¥¹è¯Šæ²»ä¸€ç§â€œéš¾ä»¥å¯é½¿â€çš„å¦‡ç§‘ç–¾ç—…ã€‚",
                    options: [
                        { text: "ã€å°½å¿ƒè¯Šæ²»ï¼Œå®ˆå£å¦‚ç“¶ã€‘", effects: { core_resources: { yi_shu: 3 }, npc_relationship: { npc_key: 'marquise', favor: 40, type: 'ally' }, item: { id: 'nan_hai_zhen_zhu', amount: 1 } }, result_text: "ä½ æˆåŠŸæ²»æ„ˆäº†å¤«äººï¼Œå¥¹å¯¹ä½ æ„Ÿæ¿€ä¸å°½ï¼Œæˆä¸ºä½ çš„ç›Ÿå‹ï¼Œå¹¶ä¸ºä½ ä»‹ç»äº†å¤§é‡è´µå¦‡ç—…äººã€‚" },
                        { text: "ã€ä»¥æ­¤ä¸ºè¦æŒŸï¼Œç´¢å–å¥½å¤„ã€‘", effects: { wealth: 5000, core_resources: { yi_de: -20 } }, result_text: "ä½ è·å¾—äº†ä¸€å¤§ç¬”é’±ï¼Œä½†åŒ»å¾·å—æŸï¼Œä¾¯çˆµå¤«äººè§†ä½ ä¸ºå¿ƒè…¹å¤§æ‚£ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥å¯¹ä½ ä¸åˆ©ã€‚" }
                    ]
                },
                {
                    title: "ç–‘éš¾æ‚ç—‡çš„ä¼šè¯Š",
                    desc: "å¤ªåŒ»é™¢ä¸ºä¸€ä½é‡è‡£çš„æ€ªç—…æŸæ‰‹æ— ç­–ï¼Œå¬é—»ä½ çš„åå£°åï¼Œä¸æƒ…æ„¿åœ°é‚€è¯·ä½ å‚ä¸ä¼šè¯Šã€‚",
                    options: [
                        { text: "ã€æå‡ºå…³é”®è¯Šæ–­ï¼ŒåŠŸåŠ³è®©ç»™å¤ªåŒ»ã€‘", effects: { attributes: { reputation: 20 }, social_favor: { group: 'imperial_doctors', change: 15 } }, result_text: "ç—…äººè¢«æ²»æ„ˆã€‚ä½ èµ¢å¾—äº†å¤ªåŒ»é™¢ä¼—äººçš„æ•¬ä½©ï¼Œä¸å¤ªåŒ»é™¢å…³ç³»æ”¹å–„ã€‚" },
                        { text: "ã€å½“ä¼—æŒ‡å‡ºè°¬è¯¯ï¼Œç‹¬è‡ªå¼€æ–¹ã€‘", effects: { attributes: { reputation: 50 }, social_favor: { group: 'imperial_doctors', change: -30 } }, result_text: "ä½ æˆåŠŸæ²»æ„ˆäº†ç—…äººï¼Œåå£°å¤§å™ªï¼Œä½†ä¹Ÿå½»åº•å¾—ç½ªäº†æ•´ä¸ªå¤ªåŒ»é™¢ã€‚" }
                    ]
                },
                {
                    title: "å¼€è®¾ä¹‰è¯Š",
                    desc: "æ¯æœˆä¸€æ¬¡ï¼Œä½ å¯ä»¥é€‰æ‹©æ˜¯å¦åœ¨è¯åºå‰å¼€è®¾ä¹‰è¯Šã€‚",
                    options: [
                        { text: "ã€åšæŒä¹‰è¯Šã€‘", cost: { wealth: 100 }, effects: { core_resources: { yi_de: 10 }, attributes: { reputation: 5 } }, result_text: "è™½ç„¶æ²¡æœ‰æ”¶å…¥ï¼Œä½†ä½ çš„åŒ»å¾·å’Œæ°‘é—´å£°æœ›æŒç»­ç¨³å®šåœ°å¢é•¿ã€‚" },
                        { text: "ã€æš‚åœä¸€æ¬¡ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©ä¼‘æ¯ï¼Œæ— äº‹å‘ç”Ÿã€‚" }
                    ]
                },
                {
                    title: "ç ”åˆ¶æ–°çš„ä¸¹è¯",
                    desc: "åœ¨ã€ç™¾è‰è¯åºã€‘ä¸­ï¼Œä½ å¯ä»¥æŠ•å…¥çç¨€è¯æå’Œçµæ„Ÿï¼Œè¿›è¡Œç ”å‘ã€‚",
                    options: [
                        { text: "ã€ç ”å‘[å…»é¢œä¸¹]ã€‘", cost: { item: 'zhen_xi_yao_cai', amount: 1 }, getOutcome: (gs) => {
                            if(gs.player.attributes.talent > 100) return {text: "ä½ æˆåŠŸåˆ¶ä½œå‡º[å…»é¢œä¸¹]ï¼åœ¨è´µå¦‡åœˆä¸­å¤§å—æ¬¢è¿ï¼Œæˆä¸ºä¸€é¡¹é‡è¦çš„æ”¶å…¥æ¥æºã€‚", effects: {item: {id:'yang_yan_dan', amount: 5}}};
                            return {text: "ç ”å‘å¤±è´¥ï¼Œæµªè´¹äº†å®è´µçš„è¯æã€‚", effects:{}};
                        }},
                        { text: "ã€ç ”å‘[ç»­å‘½ä¸¸]ã€‘", cost: { item: 'bai_nian_ling_zhi', amount: 1 }, getOutcome: (gs) => {
                             if(gs.player.attributes.talent > 120 && gs.career.core_resources.yi_shu > 100) return {text: "ä½ æˆåŠŸåˆ¶ä½œå‡º[ç»­å‘½ä¸¸]ï¼æ˜¯ä»·å€¼è¿åŸçš„ä¿å‘½ä¹‹ç‰©ã€‚", effects: {item: {id:'xu_ming_wan', amount: 1}}};
                            return {text: "ç ”å‘å¤±è´¥ï¼Œæµªè´¹äº†å®è´µçš„è¯æã€‚", effects:{}};
                        }}
                    ]
                },// =================== å¥³åŒ»ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "åˆ¶ä½œæˆè¯",
                        desc: "è®¸å¤šç—…äººåæ˜ ç…è¯éº»çƒ¦ï¼Œä½ å†³å®šå°è¯•åˆ¶ä½œä¸€äº›æ–¹ä¾¿æœç”¨çš„æˆè¯ï¼ˆå¦‚è¯ä¸¸ã€è¯è†ï¼‰ã€‚",
                        options: [
                            { text: "ã€å¼€å§‹ç ”å‘ã€‘", cost: { wealth: 1000 }, effects: { attributes: { wisdom: 5 }, flag: 'unlock_pills_crafting' }, result_text: "ç»è¿‡å¤šæ¬¡å°è¯•ï¼Œä½ æˆåŠŸç ”å‘å‡ºå‡ ç§æˆè¯ï¼Œå¯ä»¥æ‰¹é‡å‡ºå”®ï¼Œä¸ºä½ å¸¦æ¥äº†ç¨³å®šçš„æ”¶å…¥ã€‚" }
                        ]
                    },
                    {
                        title: "è¢«äººè´¨ç–‘",
                        desc: "ä¸€ä½ç—…äººåœ¨æ¥å—ä½ çš„æ²»ç–—åç—…æƒ…åŠ é‡ï¼Œå…¶å®¶å±å‰æ¥ä½ çš„è¯åºå¤§é—¹ï¼Œå£°ç§°ä½ æ˜¯â€œåº¸åŒ»â€ã€‚",
                        options: [
                            { text: "ã€å†·é™åˆ†æï¼Œæ‰¾å‡ºç—…å› ã€‘", requirements: { wisdom: 90 }, effects: { attributes: { reputation: 20 } }, result_text: "ä½ å‘ç°ç—…äººæ˜¯å› ç§ä¸‹æœç”¨äº†ä¸è¯æ–¹ç›¸å†²çš„é£Ÿç‰©æ‰€è‡´ã€‚çœŸç›¸å¤§ç™½åï¼Œä½ çš„åå£°åè€Œæ›´é«˜äº†ã€‚" },
                            { text: "ã€èµ”é’±é“æ­‰ï¼Œæ¯äº‹å®äººã€‘", cost: { wealth: 500 }, effects: { attributes: { reputation: -10 } }, result_text: "ä½ èµ”äº†500ä¸¤ï¼Œæš‚æ—¶å¹³æ¯äº†äº‹ç«¯ï¼Œä½†ä½ çš„å£°èª‰å—åˆ°äº†å½±å“ã€‚" }
                        ]
                    },
                    {
                        title: "åŒè¡Œçš„åˆä½œè¯·æ±‚",
                        desc: "ä¸€ä½ç”·å¤§å¤«åœ¨æ²»ç–—ä¸€ä½ç–‘éš¾æ‚ç—‡ç—…äººæ—¶é‡åˆ°ç“¶é¢ˆï¼Œç§ä¸‹å‰æ¥å‘ä½ è¯·æ•™ã€‚",
                        options: [
                            { text: "ã€å€¾å›Šç›¸æˆã€‘", effects: { attributes: { virtue: 5 }, npc_relationship: { npc_key: 'colleague_doctor', favor: 30, type: 'ally' } }, result_text: "ä½ çš„æ…·æ…¨èµ¢å¾—äº†å¯¹æ–¹çš„å°Šé‡ï¼Œä½ ä»¬åŒ–æ•Œä¸ºå‹ï¼Œæˆä¸ºææ—ä½³è¯ã€‚" },
                            { text: "ã€æœ‰æ‰€ä¿ç•™ã€‘", effects: {}, result_text: "ä½ æŒ‡ç‚¹äº†ä»–å‡ å¥ï¼Œä½†ä¿ç•™äº†æ ¸å¿ƒçš„åŒ»æœ¯ã€‚" }
                        ]
                    },
                    {
                        title: "ç¼–å†™åŒ»æ¡ˆ",
                        desc: "ä½ å†³å®šå°†è‡ªå·±æ²»ç–—è¿‡çš„ä¸€äº›å…¸å‹ç—…ä¾‹è®°å½•ä¸‹æ¥ï¼Œæ•´ç†æˆåŒ»æ¡ˆã€‚",
                        options: [
                            { text: "ã€å¼€å§‹æ•´ç†ã€‘", effects: { attributes: { wisdom: 5 }, core_resources: { yi_shu: 10 } }, result_text: "åœ¨æ•´ç†åŒ»æ¡ˆçš„è¿‡ç¨‹ä¸­ï¼Œä½ æ¸©æ•…è€ŒçŸ¥æ–°ï¼ŒåŒ»æœ¯åˆç²¾è¿›äº†ä¸å°‘ã€‚" }
                        ]
                    },
                    {
                        title: "é¢„é˜²æ—¶ç–«",
                        desc: "æ ¹æ®ä½ çš„è§‚å¯Ÿï¼Œä»Šå¹´å¤ç§‹ä¹‹äº¤å¯èƒ½ä¼šæœ‰ç–«ç—…æµè¡Œã€‚",
                        options: [
                            { text: "ã€å…¬å¼€é¢„è­¦ï¼Œå¹¶å…¬å¸ƒé¢„é˜²è¯æ–¹ã€‘", requirements: { virtue: 70 }, effects: { attributes: { reputation: 30, virtue: 10 } }, result_text: "ä½ çš„é¢„è­¦å’Œè¯æ–¹è®©è®¸å¤šäººå…å—ç–«ç—…ä¹‹è‹¦ï¼Œä½ åœ¨æ°‘é—´çš„å£°æœ›è¾¾åˆ°äº†é¡¶å³°ã€‚" },
                            { text: "ã€æš—ä¸­å‚¨å¤‡ç›¸å…³è¯æã€‘", requirements: { wisdom: 80 }, effects: { wealth: 2000 }, result_text: "ç–«ç—…çˆ†å‘åï¼Œè¯æä»·æ ¼é£æ¶¨ï¼Œä½ å¤§èµšäº†ä¸€ç¬”ã€‚" }
                        ]
                    },
// =================== å¥³åŒ»ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ END ===================

                {
                    title: "äº§å¦‡çš„æ±‚åŠ©",
                    desc: "ä¸€ä½äº§å¦‡éš¾äº§ï¼Œæƒ…å†µå±æ€¥ï¼Œç¨³å©†æŸæ‰‹æ— ç­–ã€‚",
                    options: [
                        { text: "ã€å†’é™©è¿›è¡Œå¤–ç§‘æ‰‹æœ¯ã€‘", getOutcome: (gs) => {
                            if((gs.career.core_resources.yi_shu || 0) > 120 && gs.player.attributes.wisdom > 100) {
                                return { text: "ä½ æˆåŠŸåœ°ä¿ä½äº†æ¯å­å¹³å®‰ï¼Œä½ çš„åŒ»æœ¯è¢«ä¼ ä¸ºç¥æŠ€ï¼", effects: { attributes: { reputation: 50 }, core_resources: { yi_de: 20 } } };
                            }
                            return { text: "äº§å¦‡æ­»äº¡ï¼Œä½ è¢«å…¶å®¶äººå‘Šä¸Šå®˜åºœï¼Œé™·å…¥å·¨å¤§å±æœºã€‚", effects: { flag: 'malpractice_lawsuit' } };
                        }}
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šéåˆ¶åŸè¥¿ç˜Ÿç–«",
                trigger: { career_level: 6, text_desc: "æˆä¸ºè‰¯åŒ», å£°æœ›>500, åŒ»å¾·>300", condition: (gs) => gs.player.attributes.reputation > 500 && (gs.career.core_resources.yi_de || 0) > 300 },
                desc: "äº¬åŸè¥¿åŒºçˆ†å‘äº†ææ€–çš„ç˜Ÿç–«ï¼Œå®˜åºœå°†å…¶å½»åº•å°é”ï¼Œé‡Œé¢çš„äººåªèƒ½ç­‰æ­»ã€‚ä½ çš„åŒ»è€…ä¹‹å¿ƒï¼Œé¢ä¸´ç€ç”Ÿæ­»æŠ‰æ‹©ã€‚",
                success: { text: "ä½ æˆä¸ºäº†æ‹¯æ•‘äº†æ•°ä¸‡ç”Ÿå‘½çš„åŸå¸‚è‹±é›„ï¼çš‡å¸äº²è‡ªå¬è§å¹¶èµèµä½ ï¼Œå®˜åºœç‰¹æ‰¹ä½ çš„è¯åºå‡çº§ä¸ºäº¬åŸæœ€å¤§çš„è¯å±€ã€‚ä½ è·å¾—åå·â€œæµä¸–ç¥åŒ»â€ï¼", effects: { career_level_set: 7, attributes: { reputation: 200 }, core_resources: { yi_de: 100 }, wealth: 5000 } },
                failure: { text: "ä½ æˆ–å› æ„ŸæŸ“ç˜Ÿç–«è€Œæ­»ï¼Œæˆ–å› æ— æ³•æ§åˆ¶ç–«æƒ…è€Œå¿ƒåŠ›äº¤ç˜ï¼ŒåŒ»æœ¯å€’é€€ï¼Œå¥åº·ä¸Šé™æ°¸ä¹…ä¸‹é™ã€‚", effects: { attributes: { health_max: -20 }, core_resources: { yi_shu: -20 } } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šä¸€ä»£ç¥åŒ»",
            level_range: [8, 10],
            goal: "ä½ çš„åŒ»æœ¯å·²æ˜¯å…¨å›½é¡¶å°–ã€‚ä½ çš„å½±å“åŠ›å¼€å§‹è§¦åŠå®«å»·ï¼Œä½ çš„ç›®æ ‡æ˜¯è‘—ä¹¦ç«‹è¯´ï¼Œä¼ æ‰¿åŒ»é“ï¼Œæˆä¸ºçœŸæ­£çš„åŒ»å­¦æƒå¨ã€‚",
            events: [
                {
                    title: "è¢«å¬å…¥å®«ï¼Œä¸ºè´µå¦ƒè¯Šè„‰",
                    desc: "æœ€å—å® çš„è´µå¦ƒæ‚£ä¸Šâ€œæ€ªç—…â€ï¼Œå¤ªåŒ»é™¢æŸæ‰‹æ— ç­–ï¼Œä½ è¢«ç§˜å¯†å¬å…¥å®«ä¸­ã€‚",
                    options: [
                        { text: "ã€å…¨åŠ›è¯Šæ²»ã€‘", getOutcome: (gs) => ({
                            sub_decision: {
                                desc: "ä½ å‘ç°è´µå¦ƒå¹¶éç”Ÿç—…ï¼Œè€Œæ˜¯ä¸­äº†æ…¢æ€§æ¯’è¯ï¼ä½ è¯¥å¦‚ä½•æ˜¯å¥½ï¼Ÿ",
                                options: [
                                    { text: "ã€ä¸ŠæŠ¥çš‡å¸ã€‘", effects: { npc_relationship: { npc_key: 'emperor', favor: 30 } }, result_text: "ä½ è·å¾—äº†çš‡å¸çš„ä¿¡ä»»ï¼Œä½†å¾—ç½ªäº†ä¸‹æ¯’çš„åå®«åŠ¿åŠ›ã€‚" },
                                    { text: "ã€åªæ²»ç—…ä¸è¯´åŸå› ã€‘", effects: { npc_relationship: { npc_key: 'consort', favor: 50 } }, result_text: "ä½ ä¿å…¨äº†è‡ªèº«ï¼Œè·å¾—äº†è´µå¦ƒçš„ç»å¯¹ä¿¡ä»»ã€‚" },
                                    { text: "ã€ä¸ä¸‹æ¯’è€…äº¤æ˜“ã€‘", effects: { wealth: 20000, core_resources: { yi_de: -100 } }, result_text: "ä½ è·å¾—äº†å·¨å¤§åˆ©ç›Šï¼Œä½†åŒ»å¾·å½’é›¶ã€‚" }
                                ]
                            }
                        })},
                        { text: "ã€ç§°ç—…æ¨è¾ã€‘", effects: {}, result_text: "ä½ é¿å¼€äº†å·¨å¤§çš„é£é™©ï¼Œä½†ä¹Ÿå¤±å»äº†è¿›å…¥å®«å»·çš„æœºä¼šã€‚" }
                    ]
                },
// =================== å¥³åŒ»ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "æ”¹è‰¯å¤æ–¹",
                        desc: "ä½ å‘ç°ä¸€å¼ æ²»ç–—å¿ƒæ‚¸çš„å¤æ–¹ç”¨è¯éœ¸é“ï¼Œå¯¹èº«ä½“æœ‰æŸï¼Œå†³å®šå¯¹å…¶è¿›è¡Œæ”¹è‰¯ã€‚",
                        options: [
                            { text: "ã€èŠ±è´¹æ•°æœˆï¼Œæ½œå¿ƒç ”ç©¶ã€‘", effects: { attributes: { wisdom: 10 }, core_resources: { yi_shu: 20 } }, result_text: "ä½ æˆåŠŸæ”¹è‰¯äº†è¯æ–¹ï¼Œè¯æ•ˆæ›´ä½³ï¼Œå‰¯ä½œç”¨æ›´å°ï¼ŒåŒ»æœ¯è¾¾åˆ°äº†æ–°çš„å¢ƒç•Œã€‚" }
                        ]
                    },
                    {
                        title: "å†›ä¸­ç–«æƒ…",
                        desc: "è¾¹å…³å†›ä¸­çˆ†å‘ç–«æƒ…ï¼Œæœå»·å‘æ°‘é—´å¾å¬ååŒ»å‰å¾€æ”¯æ´ã€‚",
                        options: [
                            { text: "ã€è‡ªå‘Šå¥‹å‹‡ï¼Œå‰å¾€è¾¹å…³ã€‘", requirements: { virtue: 100 }, effects: { attributes: { reputation: 80, health: -10 }, npc_relationship: { npc_key: 'general', favor: 60, type: 'ally' } }, result_text: "ä½ ä¸ç•è‰°é™©å‰å¾€è¾¹å…³ï¼ŒæˆåŠŸæ§åˆ¶äº†ç–«æƒ…ï¼Œèµ¢å¾—äº†å…¨å†›å°†å£«çš„å°Šæ•¬ï¼Œå¹¶ä¸å½“æœå¤§å°†å†›ç»“ä¸‹æ·±åšæƒ…è°Šã€‚" },
                            { text: "ã€çŒ®ä¸Šè¯æ–¹ã€‘", effects: { attributes: { reputation: 20 } }, result_text: "ä½ çŒ®ä¸Šäº†æ²»ç–—ç–«æƒ…çš„è¯æ–¹ï¼Œä¹Ÿä¸ºå›½å®¶å°½äº†ä¸€ä»½åŠ›ã€‚" }
                        ]
                    },
                    {
                        title: "å¤–æ—å¥‡æ¯’",
                        desc: "ä¸€ä½è¢«å¤–æ—åˆºå®¢ç”¨å¥‡æ¯’æ‰€ä¼¤çš„é‡è‡£ï¼Œè¢«æŠ¬åˆ°äº†ä½ çš„è¯åºå‰ï¼Œå·²æ˜¯å¥„å¥„ä¸€æ¯ã€‚",
                        options: [
                            { text: "ã€ä»¥èº«è¯•æ¯’ï¼Œç ”å‘è§£è¯ã€‘", requirements: { health: 90, wisdom: 120 }, effects: { core_resources: { yi_shu: 30 }, attributes: { reputation: 50, health: -20 } }, result_text: "ä½ å†’ç€ç”Ÿå‘½å±é™©ï¼Œç»ˆäºæˆåŠŸç ”å‘å‡ºè§£è¯ï¼Œæ•‘æ´»äº†é‡è‡£ã€‚ä½ çš„åŒ»æœ¯è¢«èª‰ä¸ºâ€œç¥æŠ€â€ã€‚" },
                            { text: "ã€æŸæ‰‹æ— ç­–ã€‘", effects: { core_resources: { yi_shu: -10 } }, result_text: "ä½ å¯¹è¿™ç§å¥‡æ¯’æŸæ‰‹æ— ç­–ï¼Œåªèƒ½çœ¼ççåœ°çœ‹ç€é‡è‡£æ­»å»ï¼Œè¿™æˆäº†ä½ è¡ŒåŒ»ç”Ÿæ¶¯çš„ä¸€å¤§é—æ†¾ã€‚" }
                        ]
                    },
                    {
                        title: "çš‡å¸çš„èµè¯†",
                        desc: "ä½ çš„åå£°ä¼ åˆ°äº†çš‡å¸è€³ä¸­ï¼Œä»–æ¬²èµèµä½ é»„é‡‘åƒä¸¤ï¼Œå¹¶å°ä½ ä¸ºâ€œå¾¡åŒ»â€ã€‚",
                        options: [
                            { text: "ã€æ¥å—å°èµï¼Œè¿›å…¥å¤ªåŒ»é™¢ã€‘", effects: { change_profession: 'doctor', start_level: 4 }, result_text: "ä½ çš„èŒä¸šè·¯å¾„å‘ç”Ÿæ”¹å˜ï¼Œæˆä¸ºå¤ªåŒ»é™¢ç¬¬ä¸€ä½å¥³åŒ»å®˜ã€‚" },
                            { text: "ã€è°¢ç»å°èµï¼Œåªæ±‚ä¸ºæ°‘æ²»ç—…ã€‘", effects: { attributes: { virtue: 20, reputation: 50 } }, result_text: "ä½ çš„é«˜é£äº®èŠ‚è¢«å¤©ä¸‹ä¼ é¢‚ï¼Œå“å¾·å’Œå£°æœ›è¾¾åˆ°é¡¶å³°ã€‚" }
                        ]
                    },
                    {
                        title: "æ— å›½ç•Œè¡ŒåŒ»",
                        desc: "ä¸€ä½å¼‚å›½ä½¿è‡£æ³æ±‚ä½ éšä»–å›å›½ï¼Œå»æ²»ç–—ä»–ä»¬èº«æ‚£é‡ç—…çš„å›½ç‹ã€‚",
                        options: [
                            { text: "ã€æ…¨ç„¶åº”å…ã€‘", effects: { end_game: 'healer_abroad' }, result_text: "ä½ å†³å®šå°†ä½ çš„åŒ»æœ¯å¸¦å¾€æ›´è¿œçš„åœ°æ–¹ã€‚ä½ çš„åå­—ï¼Œå°†æˆä¸ºä¸åŒå›½åº¦ä¹‹é—´çš„å’Œå¹³æ¡¥æ¢ã€‚" },
                            { text: "ã€å©‰è¨€è°¢ç»ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©ç•™åœ¨è¿™ç‰‡ç”Ÿä½ å…»ä½ çš„åœŸåœ°ã€‚" }
                        ]
                    },
// =================== å¥³åŒ»ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "å¤ªåŒ»é™¢çš„æŒ‘æˆ˜",
                    desc: "å¤ªåŒ»é™¢é™¢é¦–ï¼Œä¸€ä½æ€æƒ³ä¿å®ˆçš„è€å¾¡åŒ»ï¼Œå…¬å¼€æŒ‘æˆ˜ä½ ï¼Œè¦æ±‚è¿›è¡Œä¸€åœºå…¬å¼€çš„â€œä¸‰å±€ä¸¤èƒœâ€è¯Šç—…æ¯”èµ›ã€‚",
                    options: [
                        { text: "ã€æ¬£ç„¶åº”æˆ˜ã€‘", getOutcome: (gs) => {
                            if ((gs.career.core_resources.yi_shu || 0) > 150) {
                                return { text: "ä½ å½»åº•å¾æœäº†è¿™äº›éª„å‚²çš„ç”·äººï¼Œå£°æœ›è¾¾åˆ°é¡¶å³°ï¼Œå¤ªåŒ»é™¢å‘ä½ æ•å¼€å¤§é—¨ã€‚", effects: { attributes: { reputation: 100 }, social_favor: { group: 'imperial_doctors', change: 50 } } };
                            }
                            return { text: "ä½ çš„åå£°å—æŸï¼Œè¢«è®¤ä¸ºæ˜¯â€œé‡è·¯å­â€ã€‚", effects: { attributes: { reputation: -30 } } };
                        }}
                    ]
                },
                {
                    title: "è‘—ä¹¦ç«‹è¯´ï¼šã€Šææ—åŒ»æ¡ˆã€‹",
                    desc: "ä½ å†³å®šå°†è‡ªå·±ä¸€ç”Ÿçš„è¡ŒåŒ»ç»éªŒå’Œç–‘éš¾æ‚ç—‡æ¡ˆä¾‹ç¼–æ’°æˆä¹¦ã€‚",
                    options: [
                        { text: "ã€å¼€å§‹ç¼–æ’°ã€‘", effects: { item: { id: 'xing_lin_yi_an', amount: 1 } }, result_text: "è¿™æ˜¯ä¸€ä¸ªé•¿æœŸçš„é¡¹ç›®ã€‚å®Œæˆåï¼Œä½ å°†è·å¾—ç‹¬ä¸€æ— äºŒçš„[ææ—åŒ»æ¡ˆ]ï¼Œè£…å¤‡ååŒ»æœ¯+10ï¼Œè¯¥ç‰©å“å¯è¢«å­å—£ç»§æ‰¿ã€‚" }
                    ]
                },
                {
                    title: "æ”¶æˆå¥³å¾’ï¼Œä¼ æ‰¿åŒ»é“",
                    desc: "è®¸å¤šå¹´è½»å¥³å­å› ä½ è€Œå—åˆ°é¼“èˆï¼Œå¸Œæœ›èƒ½æ‹œä½ ä¸ºå¸ˆï¼Œå­¦ä¹ åŒ»æœ¯ã€‚",
                    options: [
                        { text: "ã€é¡¶ä½å‹åŠ›ï¼Œå¼€è®¾å¥³å­åŒ»é¦†ã€‘", cost: { wealth: 10000 }, effects: { flag: 'unlock_disciple_system' }, result_text: "ä½ å¼€å¯äº†â€œå¼Ÿå­â€ç³»ç»Ÿï¼ŒåŸ¹å…»å‡ºçš„å¥³å¼Ÿå­å°†åœ¨æœªæ¥ä¸ºä½ å¸¦æ¥å·¨å¤§çš„å£°æœ›å’Œäººè„‰å›æŠ¥ã€‚è¿™æ˜¯ä¸€é¡¹è¶³ä»¥æ”¹å˜å†å²çš„ä¼Ÿå¤§äº‹ä¸šã€‚" }
                    ]
                },
                {
                    title: "â€œé•¿ç”Ÿä¸è€â€çš„è¯±æƒ‘",
                    desc: "å¹´è¿ˆçš„çš‡å¸æ²‰è¿·äºé“æ•™ï¼Œç§˜å¯†å¬è§ä½ ï¼Œå‘½ä»¤ä½ ç”¨ä½ çš„åŒ»æœ¯ä¸ºä»–ç‚¼åˆ¶â€œé•¿ç”Ÿä¸¹â€ã€‚",
                    options: [
                        { text: "ã€å†’æ­»ç›´è°ï¼Œé˜è¿°å…»ç”Ÿä¹‹é“ã€‘", getOutcome: (gs) => {
                            if (gs.player.attributes.virtue > 150 && gs.player.attributes.wisdom > 120) {
                                return { text: "çš‡å¸è¢«ä½ çš„æ­£ç›´å’Œå­¦è¯†æ‰“åŠ¨ï¼Œæ”¾å¼ƒäº†è’è°¬çš„æƒ³æ³•ã€‚ä½ è¢«å°Šä¸ºâ€œå›½å¸ˆâ€ã€‚", effects: { attributes: { reputation: 100 } } };
                            }
                            return { text: "é¾™é¢œå¤§æ€’ï¼Œä½ è¢«æ‰“å…¥å¤©ç‰¢ã€‚", effects: { end_game: 'imprisoned' } };
                        }},
                        { text: "ã€ç”¨åè´µè¯æç‚¼åˆ¶å®‰æ…°å‰‚ã€‘", cost: { item: 'bai_nian_ling_zhi', amount: 1 }, effects: { wealth: 20000 }, result_text: "ä½ æš‚æ—¶ç³Šå¼„äº†è¿‡å»ï¼Œè·å¾—äº†å·¨é¢èµèµï¼Œä½†è°è¨€æ€»æœ‰è¢«æ­ç©¿çš„ä¸€å¤©ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šææ—åœ£æ‰‹",
                trigger: { career_level: 9, text_desc: "å£°æœ›é¡¶å³°, æˆåŠŸæ²»æ„ˆè¿‡çš‡å®¤æ ¸å¿ƒæˆå‘˜", condition: (gs) => gs.player.attributes.reputation > 1000 && gs.flags.cured_royal_family },
                desc: "é‡‘éŠ®æ®¿ä¸Šï¼Œçš‡å¸é¢å¯¹æ‰€æœ‰å¤§è‡£çš„åå¯¹ï¼ŒåŠ›æ’ä¼—è®®ï¼Œäº²è‡ªä¸ºä½ èµä¸‹å®˜æœã€‚ä½ å°†ä½œä¸ºç¬¬ä¸€ä½å¥³æ€§ï¼Œèµ°è¿›é‚£åº§åƒç™¾å¹´æ¥åªæœ‰ç”·äººæ‰èƒ½è¿›å…¥çš„æ®¿å ‚â€”â€”å¤ªåŒ»é™¢ã€‚",
                success: { text: "ä½ å¥‡è¿¹èˆ¬åœ°æ•‘æ´»äº†é‡ç—…çš„å¤–å›½ä½¿è‡£ï¼Œæ‰€æœ‰åå¯¹è€…å“‘å£æ— è¨€ã€‚çš‡å¸äº²è‡ªæˆäºˆä½ â€œåŒ»å®˜â€ä¹‹èŒï¼Œå¹¶èµäºˆ[å¤ªåŒ»é™¢é‡‘ç‰Œ]ï¼ä½ çš„äººç”Ÿï¼Œå·²æˆä¸ºä¸æœ½çš„ä¼ å¥‡ã€‚", effects: { end_game_title: 'ææ—åœ£æ‰‹', item: { id: 'tai_yi_yuan_jin_pai', amount: 1 } } },
                failure: { text: "æ•‘æ²»å¤±è´¥ï¼Œä½ è™½ä¸ä¼šè¢«å®šç½ªï¼Œä½†å°†æ°¸è¿œå¤±å»è¿›å…¥ä½“åˆ¶çš„æœºä¼šï¼Œä½œä¸ºä¸€ä½ä¼Ÿå¤§çš„â€œæ°‘é—´ç¥åŒ»â€è¢«äººé“­è®°ã€‚", effects: {} }
            }
        }
    ]
},

'spy_master': {
    name: "æƒ…æŠ¥é¦–é¢†",
    icon: "fa-user-secret",
    gender: "female",
    core_resources: ["mi_tan", "qing_bao", "ying_xiang_li"],
    dashboard_name: "é™è¯­èŒ¶å®¤",
    acts: [
        {
            title: "ç¬¬ä¸€å¹•ï¼šè››ä¸é©¬è¿¹",
            level_range: [1, 4],
            goal: "å‘å±•æ‚¨çš„ç¬¬ä¸€æ‰¹æ ¸å¿ƒå¯†æ¢ï¼Œå­¦ä¼šå¦‚ä½•æ”¶é›†ã€ç”„åˆ«å’Œåˆ©ç”¨åŸºç¡€æƒ…æŠ¥ï¼Œå¹¶å®Œæˆç¬¬ä¸€æ¬¡è¶³ä»¥è‡ªä¿çš„â€œå°å‹å¸ƒå±€â€ã€‚",
            events: [
                {
                    title: "ä¸€ä¸ªâ€œå¤šå˜´â€çš„ä¸«é¬Ÿ",
                    desc: "æ‚¨å‘ç°åºœé‡Œä¸€ä¸ªæ–°æ¥çš„å°ä¸«é¬Ÿï¼Œç‰¹åˆ«å–œæ¬¢æ‰“å¬å’Œä¼ æ’­å„ç§å°é“æ¶ˆæ¯ã€‚",
                    options: [
                        { text: "ã€ä¸¥å‰ç”³æ–¥ï¼Œå°†å…¶èµ¶èµ°ã€‘", effects: {}, result_text: "ä½ æ¶ˆé™¤ä¸€ä¸ªéšæ‚£ï¼Œä½†é”™è¿‡äº†ä¸€ä¸ªäººæ‰ã€‚" },
                        { text: "ã€å·§å¦™å¼•å¯¼ï¼Œæ”¶ä¸ºå·±ç”¨ã€‘", getOutcome: (gs) => {
                            if(gs.player.attributes.charm > 50 && gs.player.attributes.wisdom > 50) {
                                return { text: "ä½ æˆåŠŸåœ°å°†å¥¹å‘å±•ä¸ºä½ çš„ç¬¬ä¸€ä½å¯†æ¢ï¼Œæ“…é•¿æ”¶é›†â€œæµè¨€â€ç­‰çº§çš„æƒ…æŠ¥ã€‚", effects: { core_resources: { mi_tan: 1 } } };
                            }
                            return { text: "å¥¹å¯¹ä½ çš„åŠ¨æœºäº§ç”Ÿæ€€ç–‘ï¼Œå¹¶åœ¨åºœå†…æ•£æ’­å¯¹ä½ ä¸åˆ©çš„è°£è¨€ã€‚", effects: { attributes: { reputation: -5 } } };
                        }}
                    ]
                },
// =================== æƒ…æŠ¥é¦–é¢†ï¼šç¬¬ä¸€å¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "èŒ¶é¦†é‡Œçš„è¯´ä¹¦äºº",
                        desc: "ä½ å‘ç°èŒ¶é¦†é‡Œçš„è¯´ä¹¦äººï¼Œæ€»èƒ½çŸ¥é“ä¸€äº›ä¸ä¸ºäººçŸ¥çš„å®˜åœºç§˜é—»ã€‚",
                        options: [
                            { text: "ã€å°†å…¶å‘å±•ä¸ºçº¿äººã€‘", cost: { wealth: 300 }, effects: { core_resources: { mi_tan: 1 } }, result_text: "ä½ æˆåŠŸå°†è¯´ä¹¦äººå‘å±•ä¸ºçº¿äººï¼Œä»–å°†ä¸ºä½ æä¾›æºæºä¸æ–­çš„â€œæµè¨€â€çº§æƒ…æŠ¥ã€‚" },
                            { text: "ã€åªæ˜¯å¬ä¹¦ã€‘", effects: { attributes: { wisdom: 1 } }, result_text: "ä½ ä»ä»–çš„æ•…äº‹é‡Œå¬åˆ°äº†ä¸€äº›æœ‰è¶£çš„ä¿¡æ¯ã€‚" }
                        ]
                    },
                    {
                        title: "ç ´è¯‘å¯†ç ",
                        desc: "ä½ æˆªè·äº†ä¸€å°å¯†ä¿¡ï¼Œä½†ä¸Šé¢å†™æ»¡äº†çœ‹ä¸æ‡‚çš„ç¬¦å·ã€‚",
                        options: [
                            { text: "ã€å°è¯•è‡ªè¡Œç ´è¯‘ã€‘", requirements: { wisdom: 70 }, effects: { attributes: { wisdom: 5 }, core_resources: { qing_bao: 5 } }, result_text: "ç»è¿‡ä¸€ç•ªæ¨æ•²ï¼Œä½ æˆåŠŸç ´è¯‘äº†å¯†ä¿¡ï¼Œå¾—çŸ¥äº†æŸä½å®˜å‘˜çš„è¡Œç¨‹å®‰æ’ã€‚" },
                            { text: "ã€å¯»æ±‚ä¸“ä¸šäººå£«å¸®åŠ©ã€‘", cost: { wealth: 400 }, effects: { core_resources: { qing_bao: 5 } }, result_text: "ä½ èŠ±é’±è¯·äººç ´è¯‘äº†å¯†ä¿¡ã€‚" }
                        ]
                    },
                    {
                        title: "ä¼ªè£…ä¸æ½œå…¥",
                        desc: "ä½ éœ€è¦è¿›å…¥ä¸€åœºä¸å¯¹å¤–å¼€æ”¾çš„å®´ä¼šï¼Œä»¥æ¢å¬æ¶ˆæ¯ã€‚",
                        options: [
                            { text: "ã€ä¼ªè£…æˆä¾å¥³æ½œå…¥ã€‘", requirements: { charm: 60, scheming: 50 }, effects: { core_resources: { qing_bao: 10 } }, result_text: "ä½ æˆåŠŸæ½œå…¥å®´ä¼šï¼Œå¹¶å¬åˆ°äº†ä¸€ä¸ªå…³äºâ€œç›é“ä¸“å–â€çš„ç»å¯†æ¶ˆæ¯ã€‚" },
                            { text: "ã€æ½œå…¥å¤±è´¥ã€‘", effects: { attributes: { reputation: -5 } }, result_text: "ä½ çš„ä¼ªè£…è¢«è¯†ç ´ï¼Œè¢«å½“ä½œé—¹äº‹è€…èµ¶äº†å‡ºå»ã€‚" }
                        ]
                    },
                    {
                        title: "æµè¨€çš„å¨åŠ›",
                        desc: "ä½ æ‰“ç®—æ•£æ’­ä¸€åˆ™æµè¨€ï¼Œæ¥è¯•æ¢å…¶å½±å“åŠ›ã€‚",
                        options: [
                            { text: "ã€æ•£æ’­æŸå®˜å‘˜å¥½ç”·é£çš„æµè¨€ã€‘", effects: { core_resources: { ying_xiang_li: 5 }, attributes: { virtue: -3 } }, result_text: "æµè¨€å¾ˆå¿«ä¼ å¼€ï¼Œè¯¥å®˜å‘˜ç„¦å¤´çƒ‚é¢ï¼Œä½ åˆæ­¥è§è¯†åˆ°äº†æƒ…æŠ¥çš„åŠ›é‡ã€‚" },
                            { text: "ã€æ•£æ’­æŸåœ°æœ‰å®è—çš„æµè¨€ã€‘", effects: { wealth: 200 }, result_text: "è®¸å¤šäººä¿¡ä»¥ä¸ºçœŸå‰å»å¯»å®ï¼Œä½ è¶æœºåœ¨å¿…ç»ä¹‹è·¯ä¸Šå–æ°´å’Œå¹²ç²®ï¼Œèµšäº†ä¸€ç¬”ã€‚" }
                        ]
                    },
                    {
                        title: "ç¬¬ä¸€æ¬¡è¢«â€œåä¾¦å¯Ÿâ€",
                        desc: "ä½ æ´¾å‡ºçš„å¯†æ¢åœ¨è·Ÿè¸ªä¸€ä¸ªç›®æ ‡æ—¶ï¼Œè¢«å¯¹æ–¹å‘ç°å¹¶ç”©æ‰äº†ã€‚",
                        options: [
                            { text: "ã€æ„è¯†åˆ°ç›®æ ‡ä¸ç®€å•ã€‘", effects: { attributes: { wisdom: 3 } }, result_text: "ä½ æ„è¯†åˆ°è¿™ä¸ªç›®æ ‡æœ‰å¾ˆå¼ºçš„åä¾¦å¯Ÿèƒ½åŠ›ï¼Œéœ€è¦æ›´å‘¨å¯†çš„è®¡åˆ’ã€‚" },
                            { text: "ã€æƒ©ç½šå¤±æ‰‹çš„å¯†æ¢ã€‘", effects: { core_resources: { mi_tan_loyalty: -10 } }, result_text: "ä½ çš„æƒ©ç½šè®©å¯†æ¢æ„Ÿåˆ°å§”å±ˆï¼Œå¿ è¯šåº¦ä¸‹é™ã€‚" }
                        ]
                    },
// =================== æƒ…æŠ¥é¦–é¢†ï¼šç¬¬ä¸€å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "åå··çš„äº¤æ˜“",
                    desc: "ä¸€ä½ç¥ç§˜çš„ä¸­é—´äººè”ç³»ä½ ï¼Œå£°ç§°æœ‰â€œå¥½ä¸œè¥¿â€è¦å–ç»™ä½ ã€‚",
                    options: [
                        { text: "ã€èŠ±è´¹500ä¸¤ï¼Œè´­ä¹°ä¸€ä»½[æƒ…æŠ¥]ã€‘", cost: { wealth: 500 }, getOutcome: (gs) => {
                            if (Math.random() < 0.7) {
                                return { text: "ä½ ä¹°åˆ°äº†ä¸€ä»½çœŸå®çš„â€œç§˜é—»â€ï¼Œä¾‹å¦‚æŸå®˜å‘˜çš„è´ªè…è¯æ®ã€‚", effects: { core_resources: { qing_bao: 10 }, item: { id: 'tan_fu_xian_suo', amount: 1 } } };
                            }
                            return { text: "ä½ ä¹°åˆ°äº†ä¸€ä»½å‡æƒ…æŠ¥ï¼Œé’±æ‰“æ°´æ¼‚äº†ã€‚", effects: {} };
                        }},
                        { text: "ã€å¨èƒå¯¹æ–¹ï¼Œå¼ºç´¢æƒ…æŠ¥ã€‘", requirements: { martial: 40 }, getOutcome: (gs) => {
                            if (gs.player.attributes.martial > 60) {
                                return { text: "å¯¹æ–¹è¢«ä½ éœ‡æ…‘ï¼Œäº¤å‡ºäº†æƒ…æŠ¥ã€‚", effects: { core_resources: { qing_bao: 10 }, item: { id: 'tan_fu_xian_suo', amount: 1 } } };
                            }
                            return { text: "å¯¹æ–¹æ—©æœ‰é˜²å¤‡ï¼Œä½ æœªèƒ½å¾—æ‰‹ï¼Œå¹¶ä¸è¯¥æƒ…æŠ¥è´©å­ç»“ä»‡ã€‚", effects: {} };
                        }}
                    ]
                },
                {
                    title: "æƒ…æŠ¥çš„ä»·å€¼",
                    desc: "ä½ æ‰‹ä¸­æœ‰ä¸€ä»½å…³äºâ€œåéƒ¨ä¾éƒå–œçˆ±å¤ç”»â€çš„æµè¨€ã€‚",
                    options: [
                        { text: "ã€å°†æ­¤æƒ…æŠ¥å–ç»™å¤è‘£å•†äººã€‘", effects: { wealth: 300 }, result_text: "ä½ è½»æ¾èµšå–äº†300ä¸¤é“¶å­ã€‚" },
                        { text: "ã€äº²è‡ªè´­ä¹°å¤ç”»ï¼ŒæŠ•å…¶æ‰€å¥½ã€‘", cost: { wealth: 400 }, effects: { npc_relationship: { npc_key: 'li_bu_shi_lang', favor: 30 } }, result_text: "ä½ æˆåŠŸåœ°ä¸åéƒ¨ä¾éƒæ­ä¸Šäº†çº¿ï¼Œä¸ºæœªæ¥é“ºä¸‹é‡è¦çš„äººè„‰ã€‚" },
                        { text: "ã€ä¸â€œä¾éƒæ”¿æ•Œâ€äº¤æ¢å¦ä¸€ä»½æƒ…æŠ¥ã€‘", effects: { core_resources: { qing_bao: 5 } }, result_text: "ä½ ä¸èŠ±ä¸€åˆ†é’±ï¼Œæ¢æ¥äº†ä¸€ä»½ä»·å€¼æ›´é«˜çš„â€œç§˜é—»â€ã€‚" }
                    ]
                },
                {
                    title: "å»ºç«‹å®‰å…¨å±‹",
                    desc: "ä½ çš„æƒ…æŠ¥æ´»åŠ¨éœ€è¦ä¸€ä¸ªå®‰å…¨çš„æ¥å¤´å’Œå‚¨è—åœ°ç‚¹ã€‚",
                    options: [
                        { text: "ã€åˆ©ç”¨ä½ çš„å«å¦†é“ºå­ä½œä¸ºæ©æŠ¤ã€‘", effects: { flag: 'safehouse_set_shop' }, result_text: "è¶³å¤Ÿå®‰å…¨ï¼Œä½†å¦‚æœé“ºå­å‡ºäº‹ï¼Œä½ çš„æƒ…æŠ¥ç½‘ä¹Ÿä¼šå—åˆ°ç‰µè¿ã€‚" },
                        { text: "ã€åœ¨åŸå¤–è´­ä¹°ä¸€å¤„ååƒ»çš„æ°‘å®…ã€‘", cost: { wealth: 1000 }, effects: { flag: 'safehouse_set_remote' }, result_text: "æ›´å®‰å…¨ï¼Œä½†ä¹Ÿæ›´å®¹æ˜“è¢«å®˜åºœæ³¨æ„åˆ°ã€‚" }
                    ]
                },
                {
                    title: "å¯†æ¢çš„å±æœº",
                    desc: "ä½ çš„ä¸€ä½å¯†æ¢åœ¨æ‰“æ¢æ¶ˆæ¯æ—¶ï¼Œè¢«ç›®æ ‡å¯Ÿè§‰ï¼Œèº«é™·é™©å¢ƒã€‚",
                    options: [
                        { text: "ã€èŠ±è´¹é“¶ä¸¤ï¼Œç–é€šå…³ç³»ï¼Œå°†å…¶æå‡ºã€‘", cost: { wealth: 1500 }, effects: { core_resources: { mi_tan_loyalty: 10 } }, result_text: "ä½ æ•‘å‡ºäº†å¯†æ¢ï¼Œè¯¥å¯†æ¢å¯¹ä½ æ­»å¿ƒå¡Œåœ°ã€‚" },
                        { text: "ã€å£®å£«æ–­è…•ï¼Œåˆ‡æ–­æ‰€æœ‰è”ç³»ã€‘", effects: { core_resources: { mi_tan: -1, mi_tan_loyalty: -20 } }, result_text: "ä½ ä¿å…¨äº†è‡ªå·±ï¼Œä½†å¤±å»äº†è¿™ä½å¯†æ¢ï¼Œä¸”å…¶ä»–å¯†æ¢çš„å¿ è¯šåº¦æ™®éä¸‹é™ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ Iï¼šä¸€å°ä¿¡çš„å¨åŠ›",
                trigger: { career_level: 3, text_desc: "æ‹¥æœ‰è‡³å°‘3åå¯†æ¢ï¼Œå¹¶æŒæ¡ä¸€ä»½â€œç§˜é—»â€", condition: (gs) => (gs.career.core_resources.mi_tan || 0) >= 3 && (gs.career.core_resources.qing_bao || 0) >= 10 },
                desc: "ä½ çš„ä¸ˆå¤«ï¼ˆæˆ–å®¶æ—æŸä½ç”·æ€§äº²å±ï¼‰åœ¨å®˜åœºä¸Šè¢«ä¸€ä¸ªåŒåƒšå¤„å¤„æ‰“å‹ã€‚ä½ å†³å®šåœ¨æš—ä¸­ç”¨ä½ æ‰‹ä¸­çš„ç§˜å¯†ï¼Œä¸‹ä¸€ç›˜å°å°çš„æ£‹ã€‚",
                success: { text: "è¯¥å®˜å‘˜å› ç§å¾·ä¸ä¿®è¢«å¾¡å²å¼¹åŠ¾ï¼Œç°æºœæºœåœ°è¢«è´¬æ–¥ã€‚ä½ çš„å®¶æ—æ‰«æ¸…äº†éšœç¢ï¼Œä½ é¦–æ¬¡ä½“ä¼šåˆ°æ“çºµä»–äººå‘½è¿çš„å¿«æ„Ÿï¼", effects: { career_level_set: 4, core_resources: { ying_xiang_li: 50 }, attributes: { wisdom: 5 } } },
                failure: { text: "ä½ çš„æ“ä½œè¢«è¯†ç ´ï¼Œå¯¹æ–¹è™½ç„¶å—äº†äº›å½±å“ï¼Œä½†å°†ä½ è§†ä¸ºæ­»æ•Œï¼Œåœ¨æœªæ¥ä¼šä¸æƒœä¸€åˆ‡ä»£ä»·æŠ¥å¤ä½ çš„å®¶æ—ã€‚", effects: { flag: 'powerful_enemy_created' } }
            }
        },
        {
            title: "ç¬¬äºŒå¹•ï¼šç»‡ç½‘ä¹‹äºº",
            level_range: [5, 7],
            goal: "ä½ çš„æƒ…æŠ¥ç½‘å·²åˆå…·è§„æ¨¡ã€‚ä½ éœ€è¦å¼€å§‹æ¶‰è¶³æ›´é«˜å±‚çº§çš„ç§˜å¯†ï¼Œé€šè¿‡å‡ æ¬¡æˆåŠŸçš„â€œå¸ƒå±€â€åœ¨äº¬åŸæš—å½±ä¸­ç«‹å¨ï¼Œå¹¶å¼€å§‹ä¸å…¶ä»–æƒ…æŠ¥åŠ¿åŠ›è¿›è¡Œäº¤é”‹ã€‚",
            events: [
                {
                    title: "å¯†æ¢çš„æ™‹å‡",
                    desc: "ä½ çš„ä¸€ä½å¿ è¯šå¯†æ¢ï¼Œæœ‰æœºä¼šè¿›å…¥æŸä¸ªå…³é”®éƒ¨é—¨ï¼ˆå¦‚ç‹åºœã€å…µéƒ¨ï¼‰å½“å·®ã€‚",
                    options: [
                        { text: "ã€æŠ•å…¥å·¨èµ„ä¸ºå…¶æ‰“ç‚¹ã€‘", cost: { wealth: 5000 }, effects: { core_resources: { mi_tan: 1 } }, result_text: "ä½ çš„å¯†æ¢æˆåŠŸâ€œæ™‹å‡â€ï¼Œèƒ½ä¸ºä½ å¸¦æ¥â€œç»å¯†â€ç­‰çº§çš„æƒ…æŠ¥ã€‚" },
                        { text: "ã€è®¤ä¸ºé£é™©å¤ªé«˜è€Œæ”¾å¼ƒã€‘", effects: {}, result_text: "ä½ é€‰æ‹©ç¨³å¦¥ï¼Œä½†ä¹Ÿé”™å¤±äº†è‰¯æœºã€‚" }
                    ]
                },
// =================== æƒ…æŠ¥é¦–é¢†ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "è®¾ç«‹â€œé¸½æˆ¿â€",
                        desc: "ä¸ºäº†æ›´å¿«é€Ÿã€æ›´éšç§˜åœ°ä¼ é€’æƒ…æŠ¥ï¼Œä½ å†³å®šå»ºç«‹ä¸€ä¸ªä¿¡é¸½ç½‘ç»œã€‚",
                        options: [
                            { text: "ã€æŠ•å…¥èµ„é‡‘ï¼Œå¼€å§‹è®­ç»ƒã€‘", cost: { wealth: 2000 }, effects: { flag: 'pigeon_network_established' }, result_text: "ä½ æˆåŠŸå»ºç«‹äº†è‡ªå·±çš„ä¿¡é¸½ç½‘ç»œï¼Œæƒ…æŠ¥ä¼ é€’æ•ˆç‡å’Œå®‰å…¨æ€§å¤§å¹…æå‡ã€‚" }
                        ]
                    },
                    {
                        title: "æƒ…æŠ¥å¸‚åœºçš„â€œé»‘å¸‚â€",
                        desc: "ä½ å¾—çŸ¥åŸä¸­æœ‰ä¸€ä¸ªåœ°ä¸‹çš„æƒ…æŠ¥äº¤æ˜“å¸‚åœºï¼Œä¸‰æ•™ä¹æµæ±‡é›†ï¼ŒçœŸå‡æ¶ˆæ¯éš¾è¾¨ã€‚",
                        options: [
                            { text: "ã€æ·±å…¥å…¶ä¸­ï¼Œå¯»æ‰¾æœºä¼šã€‘", requirements: { wisdom: 100 }, effects: { core_resources: { qing_bao: 20 } }, result_text: "ä½ å‡­å€Ÿè¿‡äººçš„æ™ºæ…§ï¼Œåœ¨é»‘å¸‚ä¸­å»ä¼ªå­˜çœŸï¼Œè·å¾—äº†ä¸€ä»½å…³äºâ€œç§‘ä¸¾è€ƒé¢˜â€çš„ç»å¯†æƒ…æŠ¥ã€‚" },
                            { text: "ã€è¢«å‡æƒ…æŠ¥æ‰€éª—ã€‘", effects: { wealth: -1000 }, result_text: "ä½ èŠ±1000ä¸¤ä¹°äº†ä¸€ä»½å‡æƒ…æŠ¥ï¼Œè’™å—äº†æŸå¤±ã€‚" }
                        ]
                    },
                    {
                        title: "ç­–åæ•Œå¯¹å¯†æ¢",
                        desc: "ä½ å‘ç°ä¸€ä½å±äºæ•Œå¯¹åŠ¿åŠ›çš„å¯†æ¢ï¼Œä¼¼ä¹å¯¹ä»–çš„ä¸»å­å¿ƒæ€€ä¸æ»¡ã€‚",
                        options: [
                            { text: "ã€è®¸ä»¥é‡åˆ©ï¼Œå°†å…¶ç­–åã€‘", cost: { wealth: 3000 }, effects: { core_resources: { mi_tan: 1 } }, result_text: "ä½ æˆåŠŸç­–åäº†å¯¹æ–¹ï¼Œä»–å°†æˆä¸ºä½ å®‰æ’åœ¨æ•Œäººå†…éƒ¨æœ€é‡è¦çš„ä¸€é¢—æ£‹å­ã€‚" },
                            { text: "ã€è¿™æ˜¯ä¸€ä¸ªé™·é˜±ã€‘", requirements: { scheming: 90 }, effects: { attributes: { scheming: 5 } }, result_text: "ä½ è¯†ç ´äº†å¯¹æ–¹çš„ä¼ªè£…ï¼Œé¿å…äº†æŸå¤±ã€‚" }
                        ]
                    },
                    {
                        title: "åˆ¶é€ â€œæ„å¤–â€",
                        desc: "ä¸€ä½æŒæ¡äº†ä½ éƒ¨åˆ†ç§˜å¯†çš„å®˜å‘˜ï¼Œå³å°†è¢«è°ƒå¾€å¤–åœ°ï¼Œå¯èƒ½ä¼šå¯¹ä½ ä¸åˆ©ã€‚",
                        options: [
                            { text: "ã€åˆ¶é€ ä¸€åœºâ€œé©¬è½¦å¤±æ§â€çš„æ„å¤–ã€‘", requirements: { virtue: -20 }, effects: { flag: 'enemy_eliminated' }, result_text: "è¿™ä½å®˜å‘˜â€œæ„å¤–â€èº«äº¡ï¼Œä½ çš„ç§˜å¯†è¢«æ°¸è¿œåœ°åŸ‹è‘¬äº†ã€‚ä½†ä½ çš„å“å¾·å¤§å¹…ä¸‹é™ã€‚" },
                            { text: "ã€è®©ä»–å¹³å®‰ç¦»å»ã€‘", effects: {}, result_text: "ä½ é€‰æ‹©ä¸å†’é£é™©ï¼Œä½†ä¹Ÿç•™ä¸‹äº†ä¸€ä¸ªæœªæ¥çš„éšæ‚£ã€‚" }
                        ]
                    },
                    {
                        title: "æ¥è‡ªåŒè¡Œçš„æŒ‘æˆ˜",
                        desc: "äº¬åŸå¦ä¸€è‚¡ç¥ç§˜çš„æƒ…æŠ¥åŠ¿åŠ›ï¼Œå¼€å§‹åœ¨ä½ çš„åœ°ç›˜ä¸Šæ´»åŠ¨ï¼Œå¹¶å‘ä½ å‘å‡ºäº†æŒ‘æˆ˜ã€‚",
                        options: [
                            { text: "ã€æ­£é¢è¿æˆ˜ï¼Œä¸€è¾ƒé«˜ä¸‹ã€‘", effects: { flag: 'start_spy_war' }, result_text: "ä¸€åœºæ— å£°çš„æˆ˜äº‰å¼€å§‹äº†ã€‚åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªå›åˆé‡Œï¼Œä½ ä»¬å°†å›´ç»•ä¸€ä»½é‡è¦æƒ…æŠ¥å±•å¼€æ¿€çƒˆäº‰å¤ºã€‚" },
                            { text: "ã€å¯»æ±‚åˆä½œã€‘", requirements: { charm: 90 }, effects: { core_resources: { ying_xiang_li: 20 } }, result_text: "ä½ æˆåŠŸè¯´æœäº†å¯¹æ–¹ï¼ŒåŒ–æ•Œä¸ºå‹ï¼Œå…±åŒç“œåˆ†äº†äº¬åŸçš„æƒ…æŠ¥å¸‚åœºã€‚" }
                        ]
                    },
// =================== æƒ…æŠ¥é¦–é¢†ï¼šç¬¬äºŒå¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "åŒé¢é—´è°",
                    desc: "ä½ å‘ç°ä½ çš„ä¸€ä½å¯†æ¢ï¼ŒåŒæ—¶ä¹Ÿåœ¨ä¸ºå¦ä¸€è‚¡åŠ¿åŠ›ï¼ˆå¯èƒ½æ˜¯æŸä½çš‡å­æˆ–æƒè‡£ï¼‰å·¥ä½œã€‚",
                    options: [
                        { text: "ã€ç§˜å¯†å¤„å†³ï¼Œä»¥å„†æ•ˆå°¤ã€‘", effects: { core_resources: { mi_tan: -1, mi_tan_loyalty: 10 } }, result_text: "ä½ å·©å›ºäº†å†…éƒ¨çš„å¿ è¯šï¼Œä½†ä¹ŸæŸå¤±äº†ä¸€åæœ‰ä»·å€¼çš„å¯†æ¢ã€‚" },
                        { text: "ã€å°†è®¡å°±è®¡ï¼Œåˆ©ç”¨ä»–ä¼ é€’å‡æƒ…æŠ¥ã€‘", requirements: { wisdom: 120 }, getOutcome: (gs) => {
                            if (Math.random() < (gs.player.attributes.wisdom / 200)) { // æ™ºæ…§è¶Šé«˜æˆåŠŸç‡è¶Šé«˜
                                return { text: "ä½ æˆåŠŸåœ°è¯¯å¯¼äº†ä½ çš„ç«äº‰å¯¹æ‰‹ï¼Œåœ¨ä¸€æ¬¡å…³é”®åšå¼ˆä¸­è·å¾—å·¨å¤§ä¼˜åŠ¿ã€‚", effects: { core_resources: { ying_xiang_li: 30 } } };
                            }
                            return { text: "å¯¹æ–¹è¯†ç ´äº†ä½ çš„è®¡ç­–ï¼Œä½ çš„æƒ…æŠ¥ç½‘å—åˆ°é‡åˆ›ã€‚", effects: { core_resources: { mi_tan: -2, qing_bao: -20 } } };
                        }}
                    ]
                },
                {
                    title: "è´­ä¹°åŠ å¯†æŠ€æœ¯",
                    desc: "ä¸€ä½è½é­„çš„å¯†ç å­¦è€…ï¼Œå£°ç§°å‘æ˜äº†ä¸€ç§æ— äººèƒ½ç ´çš„â€œå¯†ç æœ¯â€ã€‚",
                    options: [
                        { text: "ã€ä¹°ä¸‹[å¯†ç æœ¬]ã€‘", cost: { wealth: 2000 }, effects: { item: { id: 'mi_ma_ben', amount: 1 } }, result_text: "ä½ æ‰€æœ‰æƒ…æŠ¥çš„å®‰å…¨æ€§å¤§å¹…æå‡ï¼Œä¸æ˜“è¢«å¯¹æ‰‹æˆªè·ã€‚" },
                        { text: "ã€å°†å­¦è€…è½¯ç¦ï¼Œä¾›è‡ªå·±é©±ä½¿ã€‘", effects: { attributes: { virtue: -10 }, flag: 'scholar_imprisoned' }, result_text: "ä½ è·å¾—äº†æŒç»­çš„æŠ€æœ¯æ”¯æŒï¼Œä½†ä¹Ÿåšä¸‹äº†ä¸ä¹‰ä¹‹ä¸¾ã€‚" }
                    ]
                },
                {
                    title: "ä¸€åœºâ€œæ„å¤–â€çš„ç«ç¾",
                    desc: "ä½ éœ€è¦é”€æ¯ä¸€ä»½å¯¹ä½ æä¸ºä¸åˆ©çš„è¯æ®ï¼Œè¿™ä»½è¯æ®å­˜æ”¾åœ¨æŸå®˜å‘˜çš„ä¹¦æˆ¿é‡Œã€‚",
                    options: [
                        { text: "ã€æ´¾é£å¯†æ¢æ½œå…¥ï¼Œåˆ¶é€ ç«ç¾ã€‘", effects: { core_resources: { mi_tan_loyalty: -5 } }, result_text: "è¯æ®è¢«é”€æ¯ï¼Œä½†æœ‰å‡ ç‡â€œå¤±æ‰‹â€å¯¼è‡´ç«åŠ¿è¿‡å¤§ï¼Œé€ æˆä¼¤äº¡ï¼Œå¼•èµ·å®˜åºœå½»æŸ¥ã€‚" },
                        { text: "ã€é€šè¿‡äººè„‰ï¼Œè°ƒå¼€å®˜å‘˜å†ç›—å–ã€‘", cost: { core_resources: { ren_qing: 20 } }, effects: {}, result_text: "æ›´å®‰å…¨ï¼Œä½†éœ€è¦æ¶ˆè€—å®è´µçš„äººæƒ…ã€‚" }
                    ]
                },
                {
                    title: "æŠ•èµ„â€œé£æœˆé‰´â€",
                    desc: "é£æœˆé‰´çš„è€é¸¨ï¼ˆçº¢å§¨ï¼‰é‡åˆ°äº†èµ„é‡‘å›°éš¾ã€‚",
                    options: [
                        { text: "ã€æ³¨èµ„æˆä¸ºå…¶å¹•åè‚¡ä¸œã€‘", cost: { wealth: 15000 }, effects: { flag: 'invest_in_brothel' }, result_text: "ä½ è·å¾—äº†äº¬åŸæœ€å¤§çš„æƒ…æŠ¥é›†æ•£åœ°ã€‚é£æœˆé‰´ä¸­çš„æ‰€æœ‰å§‘å¨˜éƒ½å°†æˆä¸ºä½ çš„â€œä¿¡æ¯èŠ‚ç‚¹â€ï¼Œä¸ºä½ æºæºä¸æ–­åœ°æä¾›æ¥è‡ªå„é˜¶å±‚ç”·äººçš„ç§˜å¯†ã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIï¼šå¸ƒå±€æœå ‚",
                trigger: { career_level: 6, text_desc: "å½±å“åŠ›>300ï¼Œå¹¶æŒæ¡ä¸€ä»½â€œç»å¯†â€æƒ…æŠ¥", condition: (gs) => (gs.career.core_resources.ying_xiang_li || 0) > 300 && gs.inventory.some(item => item.id.includes('jue_mi')) },
                desc: "æˆ·éƒ¨ä¾éƒçš„èŒä½å› æ•…å‡ºç¼ºï¼Œå¤ªå­å’Œé›ç‹éƒ½æƒ³å®‰æ’è‡ªå·±çš„äººä¸Šä½ã€‚ä½ å†³å®šäº²è‡ªä¸‹åœºï¼Œæ¨åŠ¨ä¸€ä½å¯¹ä½ æœ€æœ‰åˆ©çš„äººåä¸Šé‚£ä¸ªä½ç½®ã€‚",
                success: { text: "ä½ æ”¯æŒçš„äººæˆåŠŸä¸Šä½ï¼ä½ ä¸ä»…è·å¾—äº†è¿™ä½æ–°ä»»ä¾éƒçš„ç»å¯¹å¿ è¯šï¼Œæ›´å‘æ‰€æœ‰æ”¿æ²»åŠ¿åŠ›å±•ç°äº†ä½ çš„ææ€–å®åŠ›ï¼", effects: { career_level_set: 7, core_resources: { ying_xiang_li: 200 }, flag: 'planted_official_in_ministry' } },
                failure: { text: "ä½ çš„å¸ƒå±€è¢«è¯†ç ´æˆ–å› æ„å¤–å¤±è´¥ã€‚ä½ å’Œä½ æ”¯æŒçš„äººéƒ½é­åˆ°äº†å¾—åŠ¿ä¸€æ–¹çš„æ®‹é…·æ‰“å‹ã€‚", effects: { flag: 'powerful_enemy_created' } }
            }
        },
        {
            title: "ç¬¬ä¸‰å¹•ï¼šæš—å½±å¥³ç‹",
            level_range: [8, 10],
            goal: "ä½ çš„åå­—æ— äººçŸ¥æ™“ï¼Œä½†ä½ çš„åŠ›é‡æ— å¤„ä¸åœ¨ã€‚ä½ ä¸å†æ»¡è¶³äºå½±å“äººäº‹ï¼Œè€Œæ˜¯è¦æ“çºµå›½è¿ï¼Œç”šè‡³å†³å®šé¾™æ¤…ä¸Šåçš„æ˜¯è°ã€‚",
            events: [
                {
                    title: "è¾¹å…³å†›æƒ…",
                    desc: "ä½ çš„å¯†æ¢ä»æ•Œå›½ä¼ å›ä¸€ä»½[æ•Œå†›å—ä¾µè®¡åˆ’]ã€‚",
                    options: [
                        { text: "ã€å°†æƒ…æŠ¥åŒ¿åäº¤ç»™å…µéƒ¨ã€‘", effects: { attributes: { virtue: 50 } }, result_text: "å¸å›½å› æ­¤é¿å…äº†ä¸€åœºå¤§è´¥ã€‚ä½ æ‹¯æ•‘äº†æ— æ•°äººçš„æ€§å‘½ã€‚" },
                        { text: "ã€å°†æƒ…æŠ¥å–ç»™è¾¹å…³å°†é¢†ã€‘", effects: { wealth: 30000, npc_relationship: { npc_key: 'border_general', favor: 80, type: 'ally' } }, result_text: "è¯¥å°†é¢†å› æ­¤å¤§è·å…¨èƒœï¼Œæˆä¸ºä½ çš„æ­»å¿ ç›Ÿå‹ï¼Œä½ åœ¨å†›æ–¹æœ‰äº†å·¨å¤§çš„å½±å“åŠ›ã€‚" },
                        { text: "ã€éšç’æƒ…æŠ¥ï¼Œåšç©ºç›¸å…³äº§ä¸šã€‘", effects: { wealth: 100000, attributes: { virtue: -100 } }, result_text: "ä½ è·å¾—äº†æ³¼å¤©çš„è´¢å¯Œï¼Œä½†ä»£ä»·æ˜¯æ— æ•°äººçš„é²œè¡€ã€‚" }
                    ]
                },
// =================== æƒ…æŠ¥é¦–é¢†ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ START ===================
                    {
                        title: "æ“æ§å¸‚åœº",
                        desc: "ä½ æå‰å¾—çŸ¥äº†ä»Šå¹´æ¼•è¿å°†å› å¤©ç¾å—é˜»çš„æ¶ˆæ¯ã€‚",
                        options: [
                            { text: "ã€æš—ä¸­å›¤ç§¯ç²®é£Ÿï¼Œé«˜ä»·å–å‡ºã€‘", effects: { wealth: 50000, attributes: { virtue: -30 } }, result_text: "ä½ åˆ©ç”¨æƒ…æŠ¥å¤§å‘å›½éš¾è´¢ï¼Œèµšå–äº†å·¨é¢åˆ©æ¶¦ï¼Œä½†å“å¾·å¤§å¹…ä¸‹é™ã€‚" },
                            { text: "ã€å°†æ¶ˆæ¯å‘ŠçŸ¥æœå»·ã€‘", effects: { attributes: { reputation: 30, virtue: 20 } }, result_text: "æœå»·å› æ­¤æå‰åšå¥½äº†å‡†å¤‡ï¼Œé¿å…äº†ä¸€åœºå¤§é¥¥è’ã€‚ä½ ç§¯ä¸‹äº†é˜´å¾·ã€‚" }
                        ]
                    },
                    {
                        title: "æ‰¶æŒå‚€å„¡",
                        desc: "ä½ æ‰“ç®—åœ¨æœä¸­æ‰¶æŒä¸€ä½å®Œå…¨å¬å‘½äºä½ çš„å®˜å‘˜ã€‚",
                        options: [
                            { text: "ã€é€‰æ‹©ä¸€ä½æœ‰æ‰ä½†æ— èƒŒæ™¯çš„å¯’é—¨å­å¼Ÿã€‘", cost: { wealth: 20000 }, effects: { core_resources: { ying_xiang_li: 50 } }, result_text: "ä½ èŠ±è´¹å·¨èµ„ï¼ŒæˆåŠŸå°†ä»–æ¨ä¸Šäº†é«˜ä½ã€‚ä»æ­¤ï¼Œä½ åœ¨æœå ‚ä¸Šæœ‰äº†è‡ªå·±çš„ä»£è¨€äººã€‚" }
                        ]
                    },
                    {
                        title: "é‚»å›½çš„æƒ…æŠ¥ç½‘",
                        desc: "ä½ å‘ç°é‚»å›½åœ¨ä½ æœä¸­å¸ƒä¸‹äº†ä¸€å¼ å·¨å¤§çš„é—´è°ç½‘ï¼Œæ„å›¾çªƒå–å†›æœºã€‚",
                        options: [
                            { text: "ã€å°†å…¶è¿æ ¹æ‹”èµ·ï¼ŒçŒ®ç»™çš‡å¸ã€‘", effects: { npc_relationship: { npc_key: 'emperor', favor: 80, type: 'ally' } }, result_text: "ä½ ä¸ºå›½å®¶ç«‹ä¸‹ä¸ä¸–ä¹‹åŠŸï¼Œè·å¾—äº†çš‡å¸çš„ç»å¯¹ä¿¡ä»»ã€‚" },
                            { text: "ã€æ¥ç®¡è¿™å¼ ç½‘ç»œï¼Œä¸ºå·±æ‰€ç”¨ã€‘", requirements: { scheming: 150 }, effects: { core_resources: { mi_tan: 10 } }, result_text: "ä½ è‰ºé«˜äººèƒ†å¤§ï¼ŒæˆåŠŸæ¥ç®¡äº†è¿™å¼ ç½‘ç»œï¼Œä½ çš„æƒ…æŠ¥åŠ¿åŠ›æ‰©å±•åˆ°äº†å›½å¤–ã€‚" }
                        ]
                    },
                    {
                        title: "ä¸€ä»½è¶³ä»¥æ”¹æœæ¢ä»£çš„å¯†è¯",
                        desc: "ä½ çš„äººä»ä¸€ä½å‰æœè€å¤ªç›‘çš„æ•…å±…ä¸­ï¼Œå‘ç°äº†ä¸€ä»½å…³äºå½“ä»Šçš‡å¸èº«ä¸–çš„æƒŠå¤©å¯†è¯ï¼",
                        options: [
                            { text: "ã€äº¤ç»™ä¸€ä½æœ‰é‡å¿ƒçš„çš‡å­ã€‘", effects: { flag: 'trigger_civil_war' }, result_text: "å¤©ä¸‹å°†å› æ­¤å¤§ä¹±ï¼Œä½†ä½ æ”¯æŒçš„çš‡å­è‹¥èƒ½æˆåŠŸï¼Œä½ å°†æˆä¸ºæ–°ç‹æœçš„â€œä»é¾™ä¹‹åŠŸâ€ç¬¬ä¸€äººã€‚" },
                            { text: "ã€æ°¸è¿œé”€æ¯è¿™ä»½å¯†è¯ã€‘", effects: { attributes: { virtue: 50 } }, result_text: "ä½ ä¸ºäº†å¤©ä¸‹è‹ç”Ÿï¼Œäº²æ‰‹é”€æ¯äº†è¿™ä»½è¶³ä»¥é¢ è¦†ä¸€åˆ‡çš„å¯†è¯ã€‚" }
                        ]
                    },
                    {
                        title: "è¢«é—å¿˜çš„åå­—",
                        desc: "ä½ å†³å®šä¸ºè‡ªå·±å‡†å¤‡æœ€ç»ˆçš„é€€è·¯ã€‚",
                        options: [
                            { text: "ã€å¼€å§‹æŠ¹å»è‡ªå·±å­˜åœ¨è¿‡çš„æ‰€æœ‰ç—•è¿¹ã€‘", effects: { end_game: 'vanished_queen' }, result_text: "è¿™æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ã€‚æˆåŠŸåï¼Œä½ å°†å½»åº•ä»è¿™ä¸ªä¸–ç•Œä¸Šâ€œæ¶ˆå¤±â€ï¼Œæˆä¸ºä¸€ä¸ªåªå­˜åœ¨äºä¼ è¯´ä¸­çš„å½±å­ã€‚" }
                        ]
                    },
// =================== æƒ…æŠ¥é¦–é¢†ï¼šç¬¬ä¸‰å¹•æ–°å¢äº‹ä»¶ END ===================
                {
                    title: "åºŸç«‹å¤ªå­çš„é˜´è°‹",
                    desc: "ä½ å‘ç°ä¸€ä½æ·±å—çš‡å¸å® ä¿¡çš„å¦ƒå­ä¸å¤–è‡£å‹¾ç»“ï¼Œæ„å›¾æ„é™·å¤ªå­ï¼Œæ‰¶æŒè‡ªå·±çš„å„¿å­ä¸Šä½ã€‚",
                    options: [
                        { text: "ã€å¸®åŠ©å¤ªå­ï¼Œæ­å‘é˜´è°‹ã€‘", effects: { flag: 'support_crown_prince' }, result_text: "ä½ ä¿ä½äº†å›½æœ¬ã€‚å¤ªå­ç™»åŸºåï¼Œä½ çš„å®¶æ—å°†è·å¾—â€œä»é¾™ä¹‹åŠŸâ€ï¼Œäº«å—ç™¾å¹´å¯Œè´µã€‚" },
                        { text: "ã€å¸®åŠ©å¦ƒå­ï¼Œæ¨æ³¢åŠ©æ¾œã€‘", effects: { flag: 'support_rebel_prince' }, result_text: "ä¸€åœºé«˜é£é™©çš„æ”¿æ²»æŠ•èµ„ã€‚æˆåŠŸåˆ™ä½ å°†æˆä¸ºæ–°çš‡å¸èƒŒåçœŸæ­£çš„â€œå½±å­å†…é˜â€ã€‚" }
                    ]
                },
                {
                    title: "åˆºå®¢ç»„ç»‡çš„æ¥è§¦",
                    desc: "æ±Ÿæ¹–ä¸Šæœ€é¡¶å°–çš„åˆºå®¢ç»„ç»‡ï¼Œå¸Œæœ›èƒ½ä¸ä½ åˆä½œï¼Œä»–ä»¬å‡ºäººï¼Œä½ å‡ºæƒ…æŠ¥ã€‚",
                    options: [
                        { text: "ã€æ¥å—åˆä½œã€‘", effects: { flag: 'unlock_assassination', attributes: { virtue: -20 } }, result_text: "ä½ è§£é”äº†â€œç‰©ç†æ¸…é™¤â€é€‰é¡¹ï¼Œå¯ä»¥æ‚„æ— å£°æ¯åœ°è®©ä½ çš„æ•Œäººâ€œæ„å¤–â€æ­»äº¡ã€‚" },
                        { text: "ã€æ‹’ç»å¹¶å°†å…¶å‰¿ç­ã€‘", effects: { attributes: { virtue: 30 } }, result_text: "ä½ åŠ¨ç”¨ä½ çš„æƒ…æŠ¥ç½‘å’Œå®˜åºœåŠ›é‡ï¼Œç«¯æ‰äº†è¿™ä¸ªç»„ç»‡ï¼Œè·å¾—äº†å·¨å¤§çš„æ­£é¢å£°æœ›ã€‚" }
                    ]
                },
                {
                    title: "åŸ¹å…»ç»§æ‰¿äºº",
                    desc: "ä½ éœ€è¦ä¸ºè¿™ä¸ªåºå¤§çš„åœ°ä¸‹ç‹å›½ï¼Œå¯»æ‰¾ä¸€ä½ç»§æ‰¿è€…ã€‚",
                    options: [
                        { text: "ã€ä»ä½ çš„å­å¥³ä¸­æŒ‘é€‰ã€‘", effects: { flag: 'start_heir_training_spy' }, result_text: "ä½ å¼€å¯â€œç»§æ‰¿äººåŸ¹å…»â€æ¨¡å¼ï¼Œä½ éœ€è¦æ•™å¯¼TAæƒ…æŠ¥æŠ€å·§å’Œæƒè°‹ä¹‹æœ¯ã€‚" },
                        { text: "ã€ä»æœ€å¿ è¯šçš„å¯†æ¢ä¸­ææ‹”ã€‘", effects: {}, result_text: "ä½ çš„ç»„ç»‡å°†æ›´åŠ ä¸“ä¸šåŒ–ï¼Œä½†ä¹Ÿè„±ç¦»äº†å®¶æ—çš„æŒæ§ã€‚" }
                    ]
                },
                {
                    title: "é‡‘ç›†æ´—æ‰‹ï¼Œå½’äºå¹³é™",
                    desc: "ä½ åŒå€¦äº†è¿™ä¸€åˆ‡ï¼Œæ¸´æœ›å›å½’æ™®é€šäººçš„ç”Ÿæ´»ã€‚",
                    options: [
                        { text: "ã€å¼€å§‹å¸ƒå±€â€œå‡æ­»â€è„±èº«ã€‘", effects: { end_game: 'faked_death' }, result_text: "ä½ å¼€å¯äº†ç»ˆæçš„â€œé‡‘è‰è„±å£³â€è®¡åˆ’ã€‚æˆåŠŸåï¼Œä½ å°†æºå¸¦ç€å·¨é¢è´¢å¯Œè¿œèµ°é«˜é£ï¼Œè·å¾—çœŸæ­£çš„è‡ªç”±ã€‚" },
                        { text: "ã€è§£æ•£ç»„ç»‡ï¼Œé”€æ¯æ‰€æœ‰æƒ…æŠ¥ã€‘", effects: { end_game: 'peaceful_retirement' }, result_text: "ä½ äº²æ‰‹åŸ‹è‘¬äº†è¿™ä¸ªåºå¤§çš„å¸å›½ï¼Œå›å½’ä¸ºä¸€ä¸ªæ™®é€šçš„è´µå¦‡ï¼Œå®‰åº¦ä½™ç”Ÿã€‚" }
                    ]
                }
            ],
            milestone_event: {
                title: "äººç”Ÿè½¬æŠ˜ç‚¹ IIIï¼šå¤©ä¸‹ä¸ºæ£‹",
                trigger: { career_level: 10, text_desc: "å½±å“åŠ›é¡¶å³°ï¼Œå¹¶æ·±åº¦å‚ä¸å‚¨ä½ä¹‹äº‰", condition: (gs) => (gs.career.core_resources.ying_xiang_li || 0) > 1000 && (gs.flags.support_crown_prince || gs.flags.support_rebel_prince) },
                desc: "è€çš‡å¸é©¾å´©ï¼Œäº¬åŸæˆ’ä¸¥ã€‚æ‰€æœ‰åŠ¿åŠ›çš„åŠ¨å‘éƒ½ä»¥ä¿¡é¸½å’Œå¯†æŠ¥çš„å½¢å¼ï¼Œæºæºä¸æ–­åœ°æ±‡é›†åˆ°ä½ çš„æ‰‹ä¸­ã€‚ä½ ï¼Œå°±æ˜¯è¿™åœºå†³å®šå¤©ä¸‹å½’å±çš„æ£‹å±€ä¸­ï¼Œå”¯ä¸€çš„ä¸Šå¸ã€‚",
                success: { text: "ä½ æ”¯æŒçš„çš‡å­æˆåŠŸç™»åŸºï¼æ–°çš‡çš„æ‰€æœ‰é‡å¤§å†³ç­–ï¼Œéƒ½éœ€è¦å…ˆç§˜å¯†å¾æ±‚ä½ çš„æ„è§ã€‚ä½ æ‰‹æŒ[çš‡å¸çš„ç§˜å¯†ä¿¡ç‰©]ï¼Œæˆä¸ºå¸å›½çœŸæ­£çš„â€œæ— å†•ä¹‹ç‹â€ï¼", effects: { end_game_title: 'æ— å†•ä¹‹ç‹', item: {id: 'huang_di_mi_mi_xin_wu', amount: 1} } },
                failure: { text: "ä½ çš„å¸ƒå±€æ£‹å·®ä¸€ç€ï¼Œæ»¡ç›˜çš†è¾“ã€‚æ–°çš‡ç™»åŸºåï¼Œä½ çš„æ•´ä¸ªç½‘ç»œè¢«è¿æ ¹æ‹”èµ·ï¼Œç­‰å¾…ä½ çš„ï¼Œå°†æ˜¯å¸å›½æœºå™¨æœ€æ®‹é…·çš„æ¸…æ´—ã€‚", effects: { end_game: 'execution' } }
            }
        }
    ]
}
};
// --- UTILITY: Logging ---
function logEvent(content, isYear = false) {
    if (!gameState.log) gameState.log = [];
    const ageDisplay = `${Math.floor(gameState.player.age)}å²${gameState.date.turn === 1 ? 'ä¸ŠåŠå¹´' : 'ä¸‹åŠå¹´'}`;
    const dateStamp = isYear ? `${content}` : `${ageDisplay}: ${content}`;
    gameState.log.unshift({ content: dateStamp, isYear });
    if (gameState.log.length > 200) gameState.log.pop();
}

// --- DATA: Unique Names & Personalities ---
const nameData = {
    surnames: ["æ²ˆ", "å«", "ç§¦", "å´”", "è£´", "è°¢", "è§", "é¡¾", "å‚…", "æ¸©", "æ…•å®¹", "ä¸Šå®˜", "æ¬§é˜³", "å¸å¾’", "èµ«è¿", "å°‰è¿Ÿ", "é—»äºº", "ç«¯æœ¨", "ç™¾é‡Œ", "å…¬å­™", "æ‹“è·‹", "è½©è¾•", "ä»¤ç‹", "çš‡ç”«", "å®‡æ–‡", "é•¿å­™", "å…ƒ", "ç¨‹", "ç‹„", "ç‡•", "çºª", "å¸­", "åº„", "å®¹", "éœ", "å²‘", "å–»", "è«", "æˆš", "è‹", "é™†", "æŸ³", "å”", "å®‹", "å§œ", "èŒƒ", "è–›", "éŸ©", "å†¯", "å‘¨", "å´", "éƒ‘", "é»„", "æ¯›", "èµµ", "å­™", "ç®€", "é˜®", "æ±Ÿ", "å­Ÿ", "æ¢", "é­", "ç™½", "è¢"],
    girlNames: ["é™å§", "èŠ·å…®", "äº‘åˆ", "æ¸…æ™", "æ€æ¶¦", "æ˜­å", "è¯­å ‚", "ä½©ç–", "ç‘¾ç‘œ", "çµçŠ€", "ç‘¶å…‰", "é”¦ç‘Ÿ", "å‡é¦™", "æƒœæ¾œ", "æŒ½é£", "çŸ¥ç”»", "è‹¥æ¸", "é’æ¢§", "æ‰¶è‹", "æœªå¤®", "å¿å°˜", "æµè¤", "ç¢§è½", "æ£ å", "å¾½éŸ³", "å‰ªç§‹", "ç‰èŒ—", "æª€æ¨±", "æ‰¶å…‰", "æ€€ä¿¡", "çŸ¥å¾®", "å«ç« ", "ä½©ç¯", "å½’ç‡•", "å©‰æ¸…", "æœˆç‘¶", "æ€éŸµ", "è‹¥é›ª", "è¯­å«£", "è¯—æ¶µ", "æ¢¦æ´", "é™ç’‡", "èŠ·è‹¥", "æ™´é›ª", "åˆäº‘", "ä¾è¯º", "é‡‡è–‡", "é’é»›", "æš®é›ª", "å¯»é˜³", "å¿µçœŸ", "æŸ“éœœ", "å€¾åŸ", "å®‰æ­Œ", "ä¹¦å…°", "ç”»æ„", "å¬é›ª", "æ•ç´", "æ”¸å®", "å—çµ®", "æœéœ²"],
    boyNames: ["ä¿®è¿œ", "å­è°¦", "æ™¯è¡Œ", "ä¼¯åº¸", "æœ›èˆ’", "é€¾æ˜", "äº¦è¯š", "ç§‰å›", "æ€€ç‘¾", "æ€è¡¡", "æ˜­å", "å›ä¸´", "æ¸…å’Œ", "å¼ˆè¾°", "é£æœ”", "å¢¨è¨€", "ç„æˆˆ", "ç‰è¡¡", "æ™¯ç°", "é•¿åºš", "æ— å’", "ç§‰çƒ›", "é’é˜³", "ä¹¦é€¸", "æ€€å®‰", "çŸ¥èŠ‚", "äº‘æ¾ˆ", "æŸèˆŸ", "è§‚å—", "æ‰¿ç¨·", "å»ç—…", "æƒŠé¸¿", "æ…•ç™½", "è¾ä¹", "æµ©ç„¶", "æ˜Ÿæ²³", "ç‘¾ç‘œ", "å­å¢¨", "é€¸è½©", "å‡Œäº‘", "æ‰¿æ©", "çŸ¥è¡Œ", "æ•¬äº­", "äº‘å¸†", "è‡´è¿œ", "å®ˆæ‹™", "æ€é½", "ä¸´æ¸Š", "ç§‰æ–‡", "æº¯å…‰", "ä½©ç’‹", "ç„ç­–", "ä¹¦æ’", "æ™¯è¾", "åº”é…Œ", "é’å±±", "å—æµ¦", "æ‰¶é£", "ä¹‹èˆŸ", "ä¸–ç« "]
};
const personalityTraits = {
    positive: ["æ¸©æŸ”", "èªæ…§", "å†…æ•›", "æ´»æ³¼", "ç«¯åº„", "åšéŸ§", "å–„è‰¯", "æ•é”", "è°¨æ…", "ä¹è§‚", "æœæ•¢", "æ¸…å†·", "æ´’è„±"],
    negative: ["å›é€†", "è…¹é»‘", "å¤šç–‘", "è‡ªè´Ÿ", "å–„å¦’", "ç°å®", "å‡‰è–„"]
};

// ã€æ–°å¢ã€‘éšæœºç«‹ç»˜åº“ (è¯·åœ¨æ­¤å¤„æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å›¾ç‰‡é“¾æ¥)
// [æ›¿æ¢] è¯·ç”¨è¿™ä¸ªå®Œæ•´çš„ä»£ç å—æ›¿æ¢æ‚¨æ–‡ä»¶ä¸­ç°æœ‰çš„ avatarPools å¯¹è±¡
const avatarPools = {
    female: [
        'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (1).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (2).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (3).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (4).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (5).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (6).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (7).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (8).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (9).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (10).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (11).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (12).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (13).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (14).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (15).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (16).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (17).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (18).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (19).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (20).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (21).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (22).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (23).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (24).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (25).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (26).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (27).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (28).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (29).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (30).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (31).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (32).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (33).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (34).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (35).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (36).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (37).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (38).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (39).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (40).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (41).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (42).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (43).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (44).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (45).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (46).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (47).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (48).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (49).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (50).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (51).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (52).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (53).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (54).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (55).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (56).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (57).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (58).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (59).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (60).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (61).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (62).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (63).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (64).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (65).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (66).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (67).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (68).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (69).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (70).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (71).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (72).jpg',
'https://raw.githubusercontent.com/baothienlam3939-sys/female-/main/1 (73).jpg'
    ],
    male: [
       'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (1).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (2).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (3).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (4).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (5).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (6).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (7).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (8).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (9).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (10).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (11).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (12).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (13).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (14).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (15).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (16).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (17).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (18).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (19).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (20).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (21).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (22).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (23).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (24).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (25).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (26).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (27).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (28).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (29).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (30).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (31).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (32).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (33).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (34).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (35).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (36).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (37).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (38).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (39).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (40).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (41).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (42).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (43).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (44).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (45).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (46).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (47).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (48).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (49).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (50).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (51).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (52).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (53).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (54).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (55).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (56).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (57).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (58).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (59).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (60).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (61).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (62).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (63).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (64).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (65).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (66).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (67).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (68).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (69).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (70).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (71).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (72).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (73).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (74).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (75).jpg',

'https://raw.githubusercontent.com/baothienlam3939-sys/male/main/1 (76).jpg'
    ]
};
// --- DATA: Financial Tiers (As per detailed specification) ---
// --- DATA: Family & Social ---
const familyTemplates = [
    // æ‚¨åŸæœ‰çš„5ä¸ªå®¶åº­èƒŒæ™¯ï¼ˆå·²ä¿ç•™ï¼‰
    { title: "ç¤¼éƒ¨å°šä¹¦", surname: "è£´", reputation: 70, wealth: 8000, color: "#8e44ad", annualIncome: 2400 },
    { title: "å®‰å›½å…¬", surname: "å«", reputation: 90, wealth: 15000, color: "#c0392b", annualIncome: 4000 },
    { title: "å¤§ç†å¯ºå¿", surname: "ç§¦", reputation: 65, wealth: 6000, color: "#2980b9", annualIncome: 2000 },
    { title: "ç¿°æ—å­¦å£«", surname: "è°¢", reputation: 60, wealth: 5000, color: "#27ae60", annualIncome: 1600 },
    { title: "å¿ æ­¦å°†å†›", surname: "è§", reputation: 85, wealth: 10000, color: "#d35400", annualIncome: 3000 },

    // â–¼â–¼â–¼ æ–°å¢çš„30ä¸ªå®¶åº­èƒŒæ™¯ â–¼â–¼â–¼
    
    // --- é¡¶çº§æƒè´µ ---
    { title: "é•‡å›½å…¬", surname: "é¡¾", reputation: 95, wealth: 20000, color: "#8B0000", annualIncome: 5000 },
    { title: "å†…é˜é¦–è¾…", surname: "æ²ˆ", reputation: 92, wealth: 12000, color: "#4B0082", annualIncome: 4500 },
    { title: "åéƒ¨å°šä¹¦", surname: "å´”", reputation: 88, wealth: 9000, color: "#00008B", annualIncome: 3800 },
    { title: "æˆ·éƒ¨å°šä¹¦", surname: "å‚…", reputation: 80, wealth: 25000, color: "#006400", annualIncome: 3500 },
    { title: "å…µéƒ¨å°šä¹¦", surname: "éœ", reputation: 86, wealth: 11000, color: "#FF4500", annualIncome: 4200 },

    // --- ä¸­åšå®˜å‘˜ ---
    { title: "äº¬å…†å°¹", surname: "é™†", reputation: 75, wealth: 7500, color: "#2E8B57", annualIncome: 2800 },
    { title: "éƒ½å¯Ÿé™¢å·¦éƒ½å¾¡å²", surname: "ç¨‹", reputation: 82, wealth: 6500, color: "#4682B4", annualIncome: 3000 },
    { title: "äº”å†›éƒ½ç£åºœéƒ½ç£", surname: "æˆš", reputation: 84, wealth: 13000, color: "#B22222", annualIncome: 3600 },
    { title: "å›½å­ç›‘ç¥­é…’", surname: "æ¸©", reputation: 78, wealth: 5500, color: "#556B2F", annualIncome: 2200 },
    { title: "æ¼•è¿æ€»ç£", surname: "é»„", reputation: 72, wealth: 30000, color: "#DAA520", annualIncome: 3200 },
    
    // --- åœ°æ–¹è±ªå¼ºä¸ä¸–å®¶ ---
    { title: "ä¸¤æ·®ç›è¿ä½¿", surname: "ç™½", reputation: 68, wealth: 40000, color: "#C0C0C0", annualIncome: 2900 },
    { title: "æ±Ÿå—ç»‡é€ ", surname: "è‹", reputation: 70, wealth: 35000, color: "#40E0D0", annualIncome: 2600 },
    { title: "ä¸–è¢­ä¾¯çˆµ", surname: "è¢", reputation: 83, wealth: 18000, color: "#BA55D3", annualIncome: 3300 },
    { title: "ä¹¦é¦™é—¨ç¬¬", surname: "æŸ³", reputation: 77, wealth: 7000, color: "#6B8E23", annualIncome: 1800 },
    { title: "æ­¦æ—ä¸–å®¶", surname: "ç‡•", reputation: 65, wealth: 12000, color: "#A0522D", annualIncome: 2500 },

    // --- æ–°è´µä¸ç‰¹æ®ŠèƒŒæ™¯ ---
    { title: "å¤ªåŒ»é™¢é™¢ä½¿", surname: "å­™", reputation: 73, wealth: 9500, color: "#20B2AA", annualIncome: 2100 },
    { title: "çš‡å•†", surname: "èŒƒ", reputation: 76, wealth: 50000, color: "#FFD700", annualIncome: 4800 },
    { title: "ç¾½æ—å«æŒ‡æŒ¥ä½¿", surname: "ç‹„", reputation: 81, wealth: 8500, color: "#778899", annualIncome: 3100 },
    { title: "åˆ‘éƒ¨ä¾éƒ", surname: "éŸ©", reputation: 69, wealth: 6800, color: "#6A5ACD", annualIncome: 2300 },
    { title: "å…‰ç¦„å¯ºå¿", surname: "å§œ", reputation: 67, wealth: 7200, color: "#FF69B4", annualIncome: 2000 },

    // --- è¾ƒä¸ºç‹¬ç‰¹çš„èƒŒæ™¯ ---
    { title: "è‡´ä»•é˜è€", surname: "å‘¨", reputation: 89, wealth: 16000, color: "#808000", annualIncome: 1500 },
    { title: "æ²¡è½å‹‹è´µ", surname: "æ…•å®¹", reputation: 79, wealth: 3000, color: "#BC8F8F", annualIncome: 1000 },
    { title: "éšä¸–å¤§å„’", surname: "åº„", reputation: 85, wealth: 4000, color: "#008B8B", annualIncome: 800 },
    { title: "æŒ¯è¿œé•–å±€æ€»é•–å¤´", surname: "å¸¸", reputation: 64, wealth: 14000, color: "#CD853F", annualIncome: 2800 },
    { title: "é€šæ”¿å¸ä½¿", surname: "å†¯", reputation: 71, wealth: 7800, color: "#4169E1", annualIncome: 2700 },
    
    // --- æ›´å¤šè¡¥å…… ---
    { title: "é¸¿èƒªå¯ºå¿", surname: "éƒ‘", reputation: 66, wealth: 6200, color: "#DDA0DD", annualIncome: 1900 },
    { title: "å¤ªå¸¸å¯ºå¿", surname: "å´", reputation: 68, wealth: 6600, color: "#DB7093", annualIncome: 2000 },
    { title: "å·¥éƒ¨ä¾éƒ", surname: "æ±Ÿ", reputation: 70, wealth: 11000, color: "#66CDAA", annualIncome: 2400 },
    { title: "ç™¾å¹´è¯é“ºä¸œå®¶", surname: "å”", reputation: 74, wealth: 18000, color: "#9370DB", annualIncome: 3000 },
    { title: "å››æµ·é’±åº„æ€»å·", surname: "é‡‘", reputation: 75, wealth: 60000, color: "#F0E68C", annualIncome: 5500 }
];
const suitorBackgrounds = [ // Male suitors for female protagonist
    { desc: "å¤ªå‚…ä¹‹å­™ï¼Œæ¸©æ¶¦å¦‚ç‰ï¼Œæ‰åæ¨ªæº¢ã€‚", family: 90, attributes: {talent: 85, charm: 88, wisdom: 82, martial: 30}, color: '#4169e1', personality: "æ¸©æŸ”" },
    { desc: "å°†å†›ä¹‹å­ï¼Œè‹±æ­¦ä¸å‡¡ï¼Œå¿ å‹‡æœæ•¢ã€‚", family: 75, attributes: {talent: 65, charm: 78, martial: 80, wisdom: 50}, color: '#c0392b', personality: "æœæ•¢" },
    { desc: "çš‡å•†ç‹¬å­ï¼Œå¯Œå¯æ•Œå›½ï¼Œç²¾æ˜æœºæ•ã€‚", family: 80, attributes: {talent: 70, charm: 82, wisdom: 90, martial: 40}, color: '#27ae60', personality: "æ•é”" },
    { desc: "é—²æ•£ç‹çˆ·ï¼Œé£æµå€œå‚¥ï¼Œæ“…é•¿ä¸¹é’ã€‚", family: 95, attributes: {talent: 80, charm: 92, etiquette: 75, wisdom: 60}, color: '#8e44ad', personality: "æ´»æ³¼" },
    { desc: "å›½å­ç›‘å­¦å­ï¼Œæ¸…é›…è„±ä¿—ï¼Œè¯—æ‰å“ç»ã€‚", family: 60, attributes: {talent: 90, charm: 80, wisdom: 85, martial: 25}, color: '#3498db', personality: "æ¸…å†·" },
    { desc: "æ–°ç§‘çŠ¶å…ƒï¼Œå‡ºèº«å¯’é—¨ï¼Œå‰é€”æ— é‡ã€‚", family: 40, attributes: {talent: 95, wisdom: 92, charm: 75, martial: 35}, color: '#f1c40f', personality: "èªæ…§" },
    { desc: "å¤§ç†å¯ºå°‘å¿ï¼Œé“é¢æ— ç§ï¼Œå¿ƒæ€ç¼œå¯†ã€‚", family: 65, attributes: {wisdom: 88, virtue: 80, martial: 60, charm: 65}, color: '#34495e', personality: "è°¨æ…" },
    { desc: "å¾¡å‰ä¾å«ç»Ÿé¢†ï¼Œæ²‰é»˜å¯¡è¨€ï¼Œå¿ å¿ƒè€¿è€¿ã€‚", family: 70, attributes: {martial: 90, virtue: 85, health: 90, charm: 60}, color: '#7f8c8d', personality: "å†…æ•›" },
    { desc: "æ±Ÿå—èŒ¶å•†ï¼Œè°ˆåé£é›…ï¼Œå¯Œç”²ä¸€æ–¹ã€‚", family: 78, attributes: {wisdom: 85, charm: 85, talent: 70, virtue: 60}, color: '#1abc9c', personality: "ç°å®" },
    { desc: "å½’éšç”°å›­çš„å°†å†›ï¼Œé¥±ç»é£éœœï¼Œç¨³é‡å¯é ã€‚", family: 50, attributes: {martial: 82, wisdom: 75, health: 80, virtue: 70}, color: '#95a5a6', personality: "ç«¯åº„" },
    { desc: "å¼‚åŸŸæ¥çš„ç‹å­ï¼Œé‡‘å‘ç¢§çœ¼ï¼Œçƒ­æƒ…å¥”æ”¾ã€‚", family: 88, attributes: {charm: 95, martial: 70, talent: 60, health: 85}, color: '#e67e22', personality: "æ´»æ³¼" },
    { desc: "åŒ»æœ¯é«˜è¶…çš„å¤ªåŒ»ï¼Œæ‚¬å£¶æµä¸–ï¼Œä»å¿ƒä»æœ¯ã€‚", family: 55, attributes: {wisdom: 90, virtue: 90, health: 70, talent: 65}, color: '#2ecc71', personality: "å–„è‰¯" },
    { desc: "å¨éœ‡æ±Ÿæ¹–çš„ä¾ å®¢ï¼Œæ½‡æ´’ä¸ç¾ï¼Œé‡æƒ…é‡ä¹‰ã€‚", family: 30, attributes: {martial: 95, virtue: 75, charm: 80, health: 88}, color: '#e74c3c', personality: "æ´’è„±" },
    { desc: "å·¥éƒ¨ä¾éƒï¼Œé†‰å¿ƒåŒ è‰ºï¼Œä¸å–„è¨€è¾ã€‚", family: 68, attributes: {talent: 88, wisdom: 80, virtue: 65, charm: 50}, color: '#9b59b6', personality: "å†…æ•›" },
    { desc: "é•¿å…¬ä¸»çš„ç‹¬å­ï¼Œå¨‡ç”Ÿæƒ¯å…»ï¼Œç›¸è²Œå‡ºä¼—ã€‚", family: 92, attributes: {charm: 93, etiquette: 80, talent: 75, martial: 55}, color: '#ffc0cb', personality: "è‡ªè´Ÿ" },
    { desc: "ä¸–å®¶æ—æ”¯çš„åº¶å­ï¼Œé‡å¿ƒå‹ƒå‹ƒï¼Œè…¹é»‘æ·±æ²‰ã€‚", family: 45, attributes: {wisdom: 93, talent: 70, charm: 78, virtue: 30}, color: '#2c3e50', personality: "è…¹é»‘" },
    { desc: "å°‘å¹´å°†å†›ï¼Œä¸€æˆ˜æˆåï¼Œæ„æ°”é£å‘ã€‚", family: 72, attributes: {martial: 88, charm: 80, health: 85, wisdom: 65}, color: '#c0392b', personality: "æœæ•¢" },
    { desc: "è¢«è´¬è°ªçš„çš‡å­ï¼Œèƒ¸æœ‰ä¸˜å£‘ï¼Œéšå¿å¾…å‘ã€‚", family: 85, attributes: {wisdom: 94, talent: 85, virtue: 70, martial: 70}, color: '#bdc3c7', personality: "åšéŸ§" },
    { desc: "æŒç®¡å¯†æ¢çš„é¦–é¢†ï¼Œç¥ç§˜è«æµ‹ï¼ŒæƒåŠ¿æ»”å¤©ã€‚", family: 82, attributes: {wisdom: 98, martial: 85, charm: 80, virtue: 40}, color: '#16a085', personality: "å¤šç–‘" },
    { desc: "ä¹¦ç”»åŒç»çš„è‰ºæœ¯å®¶ï¼Œè§†é‡‘é’±å¦‚ç²ªåœŸã€‚", family: 35, attributes: {talent: 98, charm: 82, virtue: 60, wisdom: 70}, color: '#2980b9', personality: "æ¸…å†·" },
    { desc: "æ¸¸å­¦å½’æ¥çš„å­¦å­ï¼Œè§å¤šè¯†å¹¿ï¼Œæ€æƒ³æ–°æ½®ã€‚", family: 62, attributes: {wisdom: 87, charm: 77, talent: 72, etiquette: 70}, color: '#f39c12', personality: "ä¹è§‚" },
    { desc: "æ£‹åœ£çš„å…³é—¨å¼Ÿå­ï¼Œèªæ…§è¿‡äººï¼Œå–„äºå¸ƒå±€ã€‚", family: 58, attributes: {wisdom: 96, talent: 75, virtue: 65, charm: 70}, color: '#d35400', personality: "èªæ…§" },
    { desc: "é•‡å›½å…¬ä¸–å­ï¼Œæœªæ¥çš„å®¶æ—ç»§æ‰¿äººï¼Œè´£ä»»å¿ƒé‡ã€‚", family: 93, attributes: {virtue: 88, etiquette: 85, wisdom: 80, martial: 75}, color: '#4682b4', personality: "ç«¯åº„" },
    { desc: "ç»è¥ç€å…¨å›½æœ€å¤§ç¥¨å·çš„å°‘ä¸œå®¶ï¼Œä¸ºäººæ…·æ…¨ã€‚", family: 84, attributes: {wisdom: 88, charm: 84, virtue: 70, health: 70}, color: '#27ae60', personality: "ç°å®" },
    { desc: "é’¦å¤©ç›‘ç›‘æ­£ï¼Œèƒ½è§‚æ˜Ÿè±¡ï¼ŒçŸ¥å¤©å‘½ã€‚", family: 66, attributes: {wisdom: 97, talent: 70, virtue: 60, charm: 68}, color: '#8e44ad', personality: "æ•é”" },
    { desc: "å› ç›´è¨€è¿›è°è€Œè¢«ç½¢å®˜çš„å¾¡å²ï¼Œé£éª¨è¿‡äººã€‚", family: 52, attributes: {virtue: 95, wisdom: 80, talent: 70, health: 65}, color: '#7f8c8d', personality: "åšéŸ§" },
    { desc: "å–œçˆ±å››å¤„æ¸¸å†çš„å¯Œå®¶å…¬å­ï¼Œä¹è§‚å¼€æœ—ã€‚", family: 76, attributes: {charm: 87, health: 82, talent: 68, wisdom: 65}, color: '#3498db', personality: "æ´»æ³¼" },
    { desc: "èƒŒè´Ÿç€è¡€æµ·æ·±ä»‡çš„å­¤å„¿ï¼Œå†·æ¼ ä½†å–„è‰¯ã€‚", family: 10, attributes: {martial: 92, virtue: 80, health: 85, wisdom: 70}, color: '#595959', personality: "å‡‰è–„" },
    { desc: "å¯ºåº™ä¸­å¸¦å‘ä¿®è¡Œçš„ä¿—å®¶å¼Ÿå­ï¼Œä½›æ³•ç²¾æ·±ã€‚", family: 20, attributes: {virtue: 98, wisdom: 85, health: 75, charm: 70}, color: '#a1887f', personality: "å–„è‰¯" },
    { desc: "æ“…é•¿æœºå…³æœ¯çš„å¢¨å®¶ä¼ äººï¼Œæƒ³æ³•å¤©é©¬è¡Œç©ºã€‚", family: 25, attributes: {talent: 94, wisdom: 86, martial: 60, charm: 60}, color: '#607d8b', personality: "èªæ…§" }
];

const ladyBackgrounds = [ // Female suitors for male protagonist
    // æ‚¨åŸæœ‰çš„5ä¸ªè§’è‰²èƒŒæ™¯ï¼ˆå·²ä¿ç•™ï¼‰
    { desc: "ä¸ç›¸å«¡å¥³ï¼Œè•™è´¨å…°å¿ƒï¼Œæ‰è²ŒåŒå…¨ã€‚", family: 95, attributes: {talent: 85, charm: 90, etiquette: 92, wisdom: 80}, color: '#e06c9e', personality: "ç«¯åº„" },
    { desc: "å°†å†›ä¹‹å¥³ï¼Œå·¾å¸¼è‹±å§¿ï¼Œä¸è®©é¡»çœ‰ã€‚", family: 80, attributes: {talent: 70, charm: 82, martial: 70, health: 80}, color: '#c0392b', personality: "æ´»æ³¼" },
    { desc: "æ±Ÿå—é¦–å¯Œåƒé‡‘ï¼Œç²¾é€šå•†é“ï¼Œå¨‡ä¿å¯äººã€‚", family: 85, attributes: {talent: 75, charm: 88, wisdom: 85, virtue: 70}, color: '#27ae60', personality: "èªæ…§" },
    { desc: "å¤ªåŒ»ç‹¬å¥³ï¼Œæ¸©æŸ”å¨´é™ï¼Œç²¾é€šåŒ»ç†ã€‚", family: 65, attributes: {talent: 80, charm: 85, wisdom: 88, virtue: 85}, color: '#3cb371', personality: "æ¸©æŸ”" },
    { desc: "ä¹¦é¦™é—¨ç¬¬å°å§ï¼ŒçŸ¥ä¹¦è¾¾ç†ï¼Œæ¸©å©‰å¯äººã€‚", family: 70, attributes: {talent: 90, charm: 80, etiquette: 85, wisdom: 75}, color: '#6a9ac9', personality: "å†…æ•›" },

    // â–¼â–¼â–¼ æ–°å¢çš„60ä¸ªè§’è‰²èƒŒæ™¯ â–¼â–¼â–¼
    
    // --- é¡¶çº§æƒè´µä¸çš‡å®¤è¡€è„‰ ---
    { desc: "é•‡å›½å…¬çš„æŒä¸Šæ˜ç ï¼Œé‡‘æç‰å¶ï¼Œå¨´é›…ç«¯æ–¹ã€‚", family: 96, attributes: {etiquette: 95, charm: 92, virtue: 85, talent: 80}, color: '#C71585', personality: "ç«¯åº„" },
    { desc: "å†…é˜é¦–è¾…çš„å­™å¥³ï¼Œèªæ…§æ•é”ï¼Œå–„äºæƒè°‹ã€‚", family: 94, attributes: {wisdom: 92, etiquette: 88, charm: 85, talent: 78}, color: '#483D8B', personality: "èªæ…§" },
    { desc: "é•¿å…¬ä¸»çš„å«¡å¥³ï¼Œèº«ä»½å°Šè´µï¼Œç•¥å¸¦å‚²æ°”ã€‚", family: 98, attributes: {charm: 94, etiquette: 90, talent: 82, martial: 60}, color: '#DB7093', personality: "è‡ªè´Ÿ" },
    { desc: "å…µéƒ¨å°šä¹¦çš„ç‹¬å¥³ï¼Œå°†é—¨è™å¥³ï¼Œæ€§æ ¼æœæ•¢ã€‚", family: 88, attributes: {martial: 80, health: 85, virtue: 75, charm: 78}, color: '#B22222', personality: "æœæ•¢" },
    { desc: "ä¸–è¢­ä¾¯çˆµçš„å¦¹å¦¹ï¼Œç²¾é€šéŸ³å¾‹ï¼Œæ¸…å†·è„±ä¿—ã€‚", family: 87, attributes: {talent: 92, charm: 88, etiquette: 80, wisdom: 70}, color: '#ADD8E6', personality: "æ¸…å†·" },
    { desc: "å®‰éƒ¡ç‹ä¹‹å¥³ï¼Œå¤©çœŸçƒ‚æ¼«ï¼Œå¤‡å—å® çˆ±ã€‚", family: 93, attributes: {charm: 91, virtue: 80, talent: 75, health: 78}, color: '#FFB6C1', personality: "æ´»æ³¼" },
    { desc: "æˆ·éƒ¨å°šä¹¦çš„åƒé‡‘ï¼Œå–„äºç†è´¢ï¼Œç°å®ç²¾æ˜ã€‚", family: 86, attributes: {wisdom: 90, virtue: 70, charm: 80, etiquette: 75}, color: '#FFD700', personality: "ç°å®" },

    // --- å®˜å®¦ä¸–å®¶ä¸ä¹¦é¦™é—¨ç¬¬ ---
    { desc: "åéƒ¨ä¾éƒçš„å«¡å¥³ï¼Œæ¸©å©‰è´¤æ·‘ï¼Œé¢‡æœ‰åŸåºœã€‚", family: 82, attributes: {etiquette: 88, wisdom: 85, charm: 82, virtue: 75}, color: '#BA55D3', personality: "å†…æ•›" },
    { desc: "äº¬å…†å°¹ä¹‹å¥³ï¼Œå«‰æ¶å¦‚ä»‡ï¼Œé¢‡æœ‰ä¾ æ°”ã€‚", family: 78, attributes: {virtue: 85, martial: 65, wisdom: 70, charm: 75}, color: '#4682B4', personality: "åšéŸ§" },
    { desc: "å›½å­ç›‘ç¥­é…’çš„å­™å¥³ï¼Œæ»¡è…¹ç»çº¶ï¼Œå–œçˆ±è¾©è®ºã€‚", family: 76, attributes: {talent: 93, wisdom: 88, etiquette: 75, charm: 72}, color: '#556B2F', personality: "èªæ…§" },
    { desc: "éƒ½å¯Ÿé™¢å¾¡å²ä¹‹å¥³ï¼Œå®¶æ•™æ£®ä¸¥ï¼Œå“è¡Œç«¯æ­£ã€‚", family: 79, attributes: {virtue: 92, etiquette: 85, wisdom: 75, talent: 68}, color: '#708090', personality: "ç«¯åº„" },
    { desc: "ç¿°æ—é™¢æŒé™¢å­¦å£«ä¹‹å¥³ï¼Œæ¸…ä¸½ç»å°˜ï¼Œä¸å–œä¿—åŠ¡ã€‚", family: 77, attributes: {talent: 95, charm: 86, wisdom: 80, etiquette: 78}, color: '#E0FFFF', personality: "æ¸…å†·" },
    { desc: "åˆ‘éƒ¨ä¾éƒçš„å¥³å„¿ï¼Œå¿ƒæ€ç¼œå¯†ï¼Œå–„äºè§‚å¯Ÿã€‚", family: 74, attributes: {wisdom: 91, virtue: 70, charm: 75, talent: 65}, color: '#2F4F4F', personality: "æ•é”" },
    { desc: "å·¥éƒ¨å‘˜å¤–éƒçš„å¥³å„¿ï¼Œå¯¹å¥‡å·§ä¹‹ç‰©å¾ˆæ„Ÿå…´è¶£ã€‚", family: 68, attributes: {talent: 80, wisdom: 78, charm: 70, health: 72}, color: '#DEB887', personality: "æ´»æ³¼" },
    { desc: "é¸¿èƒªå¯ºå¿ä¹‹å¥³ï¼Œæ›¾éšçˆ¶å‡ºä½¿ï¼Œè§å¤šè¯†å¹¿ã€‚", family: 72, attributes: {wisdom: 86, charm: 83, etiquette: 80, talent: 70}, color: '#4169E1', personality: "ä¹è§‚" },
    { desc: "å¤ªå¸¸å¯ºå¿ä¹‹å¥³ï¼Œæ“…é•¿ä¹èˆï¼Œå¸¸åœ¨ç¥­å…¸é¢†èˆã€‚", family: 73, attributes: {talent: 88, charm: 85, etiquette: 82, virtue: 70}, color: '#DDA0DD', personality: "ç«¯åº„" },

    // --- å¯Œå•†å·¨è´¾ä¸ç‰¹æ®ŠèƒŒæ™¯ ---
    { desc: "å››æµ·é’±åº„çš„å°‘ä¸œå®¶ï¼Œè¡Œäº‹æœæ–­ï¼Œæœ‰é­„åŠ›ã€‚", family: 90, attributes: {wisdom: 93, charm: 85, virtue: 60, talent: 65}, color: '#F0E68C', personality: "æœæ•¢" },
    { desc: "ä¸¤æ·®ç›è¿ä½¿çš„ä¹‰å¥³ï¼ŒèƒŒæ™¯ç¥ç§˜ï¼Œå¦©åªšåŠ¨äººã€‚", family: 84, attributes: {charm: 92, wisdom: 80, talent: 70, etiquette: 75}, color: '#8B008B', personality: "è…¹é»‘" },
    { desc: "äº¬åŸç¬¬ä¸€é…’æ¥¼â€œé†‰ä»™æ¥¼â€çš„å¹•åè€æ¿ã€‚", family: 75, attributes: {charm: 88, wisdom: 87, virtue: 65, health: 70}, color: '#800000', personality: "ç°å®" },
    { desc: "æ¼•è¿å¸®ä¸»çš„å¥³å„¿ï¼Œæ€§æ ¼è±ªçˆ½ï¼Œä¸æ‹˜å°èŠ‚ã€‚", family: 69, attributes: {martial: 75, charm: 80, health: 82, virtue: 68}, color: '#A0522D', personality: "æ´’è„±" },
    { desc: "æµ·å¤–å½’æ¥çš„å¯Œå•†ä¹‹å¥³ï¼Œæ€æƒ³å¼€æ”¾ï¼Œç‰¹ç«‹ç‹¬è¡Œã€‚", family: 70, attributes: {wisdom: 84, charm: 86, talent: 72, etiquette: 60}, color: '#FF4500', personality: "å›é€†" },
    { desc: "æ‹¥æœ‰äº¬åŸæœ€å¤§é©¬åœºçš„å¥³åœºä¸»ï¼Œæ“…é•¿ç›¸é©¬ã€‚", family: 67, attributes: {martial: 72, wisdom: 78, health: 80, charm: 75}, color: '#8B4513', personality: "æ´»æ³¼" },

    // --- æ±Ÿæ¹–é—¨æ´¾ä¸éšå£«é«˜äºº ---
    { desc: "æ­¦æ—ç›Ÿä¸»çš„ç‹¬ç”Ÿå¥³ï¼Œæ­¦åŠŸé«˜å¼ºï¼Œéª„å‚²è‡ªä¿¡ã€‚", family: 60, attributes: {martial: 90, charm: 80, virtue: 70, health: 85}, color: '#DC143C', personality: "è‡ªè´Ÿ" },
    { desc: "â€œè¯ç‹è°·â€çš„ä¼ äººï¼Œä¸è°™ä¸–äº‹ï¼Œå–„è‰¯çº¯çœŸã€‚", family: 40, attributes: {wisdom: 88, virtue: 95, health: 78, talent: 75}, color: '#9ACD32', personality: "å–„è‰¯" },
    { desc: "éšä¸–ç”»åœ£çš„å¼Ÿå­ï¼Œç”»æŠ€è¶…å‡¡ï¼Œä¸é£Ÿäººé—´çƒŸç«ã€‚", family: 35, attributes: {talent: 98, charm: 85, wisdom: 75, etiquette: 70}, color: '#F5FFFA', personality: "æ¸…å†·" },
    { desc: "â€œå¬é›¨æ¥¼â€æƒ…æŠ¥ç»„ç»‡çš„é¦–é¢†ï¼Œå¤šç–‘è°¨æ…ã€‚", family: 50, attributes: {wisdom: 95, martial: 80, charm: 78, virtue: 40}, color: '#778899', personality: "å¤šç–‘" },
    { desc: "æŒ¯è¿œé•–å±€æ€»é•–å¤´çš„å¥³å„¿ï¼Œèµ°å—é—¯åŒ—ï¼ŒåšéŸ§ç‹¬ç«‹ã€‚", family: 55, attributes: {martial: 82, virtue: 80, health: 85, wisdom: 68}, color: '#D2691E', personality: "åšéŸ§" },
    { desc: "å‰æœçš‡å®¤çš„é—å­¤ï¼ŒèƒŒè´Ÿå›½ä»‡å®¶æ¨ï¼Œå¤–å†·å†…çƒ­ã€‚", family: 20, attributes: {etiquette: 85, wisdom: 82, martial: 78, charm: 80}, color: '#696969', personality: "å‡‰è–„" },

    // --- æ›´å¤šè¡¥å……ç±»å‹ ---
    { desc: "å®¶é“ä¸­è½çš„å¤§å®¶é—ºç§€ï¼Œé å¥³çº¢ç»´æŒç”Ÿè®¡ã€‚", family: 30, attributes: {talent: 85, virtue: 82, health: 60, etiquette: 75}, color: '#BC8F8F', personality: "åšéŸ§" },
    { desc: "æ–°æ™‹å® å¦ƒçš„å¦¹å¦¹ï¼Œä»—ç€å§å§çš„åŠ¿å¤´ï¼Œæœ‰äº›åˆè›®ã€‚", family: 78, attributes: {charm: 88, etiquette: 70, martial: 50, virtue: 55}, color: '#FF69B4', personality: "å–„å¦’" },
    { desc: "è¢«æŠ„å®¶å®˜å‘˜çš„å¥³å„¿ï¼Œä»äº‘ç«¯è·Œè½ï¼Œçœ‹é€äººå¿ƒã€‚", family: 15, attributes: {wisdom: 85, talent: 80, charm: 78, virtue: 60}, color: '#B0C4DE', personality: "å†…æ•›" },
    { desc: "å› ä¸€é¦–è¯—ååŠ¨äº¬åŸçš„å¹³æ°‘æ‰å¥³ã€‚", family: 25, attributes: {talent: 96, charm: 84, wisdom: 80, virtue: 70}, color: '#E6E6FA', personality: "èªæ…§" },
    { desc: "è¢«å¤§æˆ·äººå®¶æ”¶å…»çš„å­¤å¥³ï¼Œè°¨å°æ…å¾®ï¼Œæ‡‚å¾—æ„Ÿæ©ã€‚", family: 40, attributes: {virtue: 90, etiquette: 80, wisdom: 72, charm: 75}, color: '#FFE4E1', personality: "è°¨æ…" },
    { desc: "å¯ºåº™æ—é•¿å¤§çš„å±…å£«ä¹‹å¥³ï¼Œæ€§æƒ…å¹³å’Œï¼Œä¸ä¸–æ— äº‰ã€‚", family: 22, attributes: {virtue: 94, wisdom: 80, health: 75, charm: 72}, color: '#F5F5DC', personality: "å–„è‰¯" },
    { desc: "å› çˆ¶äº²æˆè¾¹è€Œç‹¬è‡ªåœ¨äº¬åŸç”Ÿæ´»çš„å¥³å­ã€‚", family: 48, attributes: {virtue: 80, wisdom: 75, health: 70, martial: 60}, color: '#C0C0C0', personality: "åšéŸ§" },
    { desc: "ç»è¥ç€ä¸€å®¶å°èŒ¶é¦†çš„å¹´è½»å¯¡å¦‡ï¼Œæ•…äº‹å¾ˆå¤šã€‚", family: 38, attributes: {wisdom: 82, charm: 80, virtue: 75, health: 68}, color: '#A9A9A9', personality: "æ•é”" },
    { desc: "â€œéœ“è£³åŠâ€é¦–å¸­ç»£å¨˜ï¼ŒæŠ€è‰ºç²¾æ¹›ï¼Œå¿ƒæ°”é«˜ã€‚", family: 42, attributes: {talent: 94, charm: 80, wisdom: 70, virtue: 65}, color: '#FF1493', personality: "è‡ªè´Ÿ" },
    { desc: "æµè½æ°‘é—´çš„å…¬ä¸»ï¼Œå°šæœªçŸ¥æ™“è‡ªå·±çš„èº«ä¸–ã€‚", family: 10, attributes: {charm: 96, etiquette: 90, talent: 85, virtue: 80}, color: '#FFFACD', personality: "ä¹è§‚" },
    { desc: "å¤§å°†å†›çš„ä¹‰å¥³ï¼Œå–„äºéª‘å°„ï¼Œæ€§æ ¼å¼€æœ—ã€‚", family: 79, attributes: {martial: 83, charm: 81, health: 86, virtue: 72}, color: '#FFA07A', personality: "æ´»æ³¼" },
    { desc: "ä¸€ä½å¥³æ‰®ç”·è£…åœ¨ä¹¦é™¢è¯»ä¹¦çš„æ‰å¥³ã€‚", family: 64, attributes: {wisdom: 89, talent: 87, charm: 79, martial: 62}, color: '#87CEEB', personality: "èªæ…§" },
    { desc: "ç´æ£‹ä¹¦ç”»æ— ä¸€ä¸ç²¾çš„æ•™åŠå¸èŠ±é­ã€‚", family: 33, attributes: {talent: 97, charm: 95, wisdom: 83, etiquette: 80}, color: '#DA70D6', personality: "æ•é”" },
    { desc: "åœ¨æˆ˜åœºä¸Šæ•‘æ­»æ‰¶ä¼¤çš„å¥³å†›åŒ»ã€‚", family: 44, attributes: {wisdom: 88, health: 80, virtue: 90, martial: 50}, color: '#F08080', personality: "æœæ•¢" },
    { desc: "æ¥è‡ªæ³¢æ–¯çš„ç å®å•†äººï¼Œçƒ­æƒ…ä¼¼ç«ã€‚", family: 62, attributes: {charm: 90, wisdom: 82, talent: 65, health: 75}, color: '#FF8C00', personality: "æ´»æ³¼" },
    { desc: "æŒç®¡å®¶æ—ç”Ÿæ„çš„é•¿å§ï¼Œæ²‰ç¨³æœ‰æ‹…å½“ã€‚", family: 71, attributes: {wisdom: 87, virtue: 83, etiquette: 80, charm: 78}, color: '#B03060', personality: "ç«¯åº„" },
    { desc: "ä¸€ä½çˆ±å¥½æ¸¸å±±ç©æ°´çš„åœ°ä¸»åƒé‡‘ã€‚", family: 63, attributes: {health: 84, charm: 82, talent: 70, virtue: 68}, color: '#32CD32', personality: "æ´’è„±" },
    { desc: "åé—¨ä¹‹åï¼Œå´å› æ²‰è¿·é¬¼ç¥ä¹‹è¯´è€Œè¢«äººç–è¿œã€‚", family: 66, attributes: {wisdom: 85, talent: 75, charm: 70, etiquette: 72}, color: '#663399', personality: "å¤šç–‘" },
    { desc: "æ‹¥æœ‰ä¸€åº§ç§äººè—ä¹¦æ¥¼çš„å¥‡å¥³å­ã€‚", family: 57, attributes: {talent: 91, wisdom: 90, virtue: 75, charm: 74}, color: '#48D1CC', personality: "èªæ…§" },
    { desc: "ä¸ä½ æŒ‡è…¹ä¸ºå©šçš„è¡¨å¦¹ï¼Œä½“å¼±å¤šç—…ã€‚", family: 70, attributes: {virtue: 80, etiquette: 82, talent: 75, health: 50}, color: '#FFF0F5', personality: "æ¸©æŸ”" },
    { desc: "ç¤¼éƒ¨ä¾éƒä¹‹å¥³ï¼Œæœ€é‡è§„çŸ©ï¼Œä¸€ä¸ä¸è‹Ÿã€‚", family: 81, attributes: {etiquette: 94, virtue: 85, wisdom: 78, charm: 75}, color: '#7B68EE', personality: "è°¨æ…" },
    { desc: "ä¸€ä½çˆ±å¥½ç¾é£Ÿçš„ä¿å¨å¨˜ï¼Œå¨è‰ºé—»åä¹¡é‡Œã€‚", family: 28, attributes: {talent: 80, charm: 78, health: 75, virtue: 70}, color: '#FF7F50', personality: "æ´»æ³¼" },
    { desc: "è¢«ç»§æ¯è‹›å¾…çš„åº¶å¥³ï¼ŒåšéŸ§ä¸æ‹”ã€‚", family: 40, attributes: {virtue: 88, health: 70, wisdom: 75, talent: 70}, color: '#808080', personality: "åšéŸ§" },
    { desc: "å‰æœç½ªè‡£ä¹‹åï¼Œéšå§“åŸ‹åï¼Œç­‰å¾…æ—¶æœºã€‚", family: 18, attributes: {wisdom: 88, talent: 82, martial: 75, etiquette: 80}, color: '#000000', personality: "è…¹é»‘" },
    { desc: "ä¸ºçˆ¶ä¼¸å†¤ï¼Œå¸¸å¹´å¥”èµ°äºå„è¡™é—¨çš„å¥³å­å­ã€‚", family: 24, attributes: {virtue: 96, wisdom: 78, health: 72, martial: 55}, color: '#A52A2A', personality: "åšéŸ§" },
    { desc: "ä¸€ä½ä¹è§‚çš„å†œå®¶å¥³ï¼Œå¯¹ç”Ÿæ´»å……æ»¡çƒ­æƒ…ã€‚", family: 12, attributes: {health: 85, virtue: 75, charm: 70, wisdom: 50}, color: '#228B22', personality: "ä¹è§‚" }
];
// --- DATA: Career ---
// ===================== ã€è¯·ç”¨æ­¤å¯¹è±¡å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å¯¹è±¡å®Œæ•´æ›¿æ¢ã€‘ =====================
const careerPaths = {
    male: {
        civilian: {
            name: "æ–‡å®˜", icon: "fa-feather-alt",
            levels: [
                { title: "ç«¥ç”Ÿ", salary: 800, req: { wisdom: 20 }, promotion_points: 100 },
                { title: "ç§€æ‰", salary: 1500, req: { wisdom: 40 }, promotion_points: 120 },
                { title: "ä¸¾äºº", salary: 2500, req: { wisdom: 60, virtue: 40 }, promotion_points: 150 },
                { title: "è¿›å£«", salary: 4000, req: { wisdom: 85, etiquette: 60 }, promotion_points: 200 },
                { title: "ç¿°æ—é™¢ç¼–ä¿®", salary: 6000, req: { wisdom: 100, talent: 80 }, promotion_points: 250 },
                { title: "å…­éƒ¨ä¸»äº‹", salary: 10000, req: { wisdom: 120, virtue: 80 }, promotion_points: 300 },
                { title: "éƒä¸­", salary: 16000, req: { wisdom: 140, charm: 100 }, promotion_points: 400 },
                { title: "ä¾éƒ", salary: 24000, req: { wisdom: 160, virtue: 120 }, promotion_points: 500 },
                { title: "å°šä¹¦", salary: 40000, req: { wisdom: 180, reputation: 500 }, promotion_points: 700 },
                { title: "å†…é˜å¤§å­¦å£«", salary: 60000, req: { wisdom: 200, virtue: 150, reputation: 1000 }, promotion_points: 1000 }
            ]
        },
        warrior: {
            name: "æ­¦å°†", icon: "fa-shield-alt",
            levels: [
                { title: "æ­¦ç«¥ç”Ÿ", salary: 1000, req: { health: 30, martial: 20 }, promotion_points: 100 },
                { title: "æ­¦ç§€æ‰", salary: 1800, req: { health: 50, martial: 40 }, promotion_points: 120 },
                { title: "æ­¦ä¸¾äºº", salary: 3000, req: { health: 70, martial: 60 }, promotion_points: 150 },
                { title: "æ­¦è¿›å£«", salary: 5000, req: { health: 85, martial: 80 }, promotion_points: 200 },
                { title: "å¾¡å‰ä¾å«", salary: 8000, req: { health: 100, martial: 100, virtue: 60 }, promotion_points: 250 },
                { title: "è¥åƒæ€»", salary: 12000, req: { health: 120, martial: 120 }, promotion_points: 300 },
                { title: "å®ˆå¤‡", salary: 18000, req: { health: 140, martial: 140 }, promotion_points: 400 },
                { title: "éƒ½å¸", salary: 26000, req: { health: 160, martial: 160 }, promotion_points: 500 },
                { title: "æ€»å…µ", salary: 44000, req: { health: 180, martial: 180, reputation: 600 }, promotion_points: 700 },
                { title: "å¤§éƒ½ç£", salary: 70000, req: { health: 200, martial: 200, reputation: 1200 }, promotion_points: 1200 }
            ]
        },
        merchant: {
            name: "å•†è´¾", icon: "fa-store-alt",
            levels: [
                { title: "å­¦å¾’", salary: 600, req: { wisdom: 10 }, promotion_points: 100 },
                { title: "è´¦æˆ¿", salary: 1200, req: { wisdom: 30 }, promotion_points: 120 },
                { title: "ç®¡äº‹", salary: 2000, req: { wisdom: 50, charm: 40 }, promotion_points: 150 },
                { title: "æŒæŸœ", salary: 3000, req: { wisdom: 70, charm: 60 }, promotion_points: 200 },
                { title: "åˆ†è¡Œä¸œå®¶", salary: 6000, req: { wisdom: 90, charm: 80, reputation: 100 }, promotion_points: 300 },
                { title: "æ€»è¡Œä¸œå®¶", salary: 20000, req: { wisdom: 120, charm: 100, reputation: 500 }, promotion_points: 500 },
                { title: "çš‡å•†", salary: 100000, req: { wisdom: 150, charm: 120, reputation: 1000 }, promotion_points: 800 }
            ]
        },
        scholar: {
            name: "æ–‡äººå¢¨å®¢", icon: "fa-paint-brush",
            levels: [
                { title: "æ— åä¹¦ç”Ÿ", salary: 500, req: { talent: 20 }, promotion_points: 100 },
                { title: "å°æœ‰åæ°”", salary: 1000, req: { talent: 40 }, promotion_points: 150 },
                { title: "çŸ¥åä¹¦ç”Ÿ", salary: 1800, req: { talent: 70, reputation: 50 }, promotion_points: 200 },
                { title: "é‡‘é™µæ‰å­", salary: 2000, req: { talent: 100, charm: 80 }, promotion_points: 300 },
                { title: "ååŠ¨äº¬å", salary: 4000, req: { talent: 120, reputation: 200 }, promotion_points: 400 },
                { title: "å¤§å®¶", salary: 8000, req: { talent: 150, wisdom: 120, reputation: 500 }, promotion_points: 600 },
                { title: "ä¸€ä»£å®—å¸ˆ", salary: 16000, req: { talent: 180, virtue: 100, reputation: 1000 }, promotion_points: 1000 }
            ]
        },
        ranger: {
            name: "æ±Ÿæ¹–æ¸¸ä¾ ", icon: "fa-khanda",
            levels: [
                { title: "åˆå‡ºèŒ…åº", salary: 700, req: { martial: 30 }, promotion_points: 100 },
                { title: "è–„æœ‰ä¾ å", salary: 1300, req: { martial: 60 }, promotion_points: 150 },
                { title: "é»‘é£å…‹æ˜Ÿ", salary: 2200, req: { martial: 90, health: 80 }, promotion_points: 200 },
                { title: "ååŠ¨ä¸€æ–¹", salary: 3000, req: { martial: 120, reputation: 300 }, promotion_points: 300 },
                { title: "æ­¦æ—é«˜æ‰‹", salary: 6000, req: { martial: 150, wisdom: 80 }, promotion_points: 500 },
                { title: "ä¸€ä»£å¤§ä¾ ", salary: 12000, req: { martial: 180, virtue: 120, reputation: 800 }, promotion_points: 700 },
                { title: "æ­¦æ—ç¥è¯", salary: 20000, req: { martial: 200, reputation: 1500 }, promotion_points: 1200 }
            ]
        }
    },
    female: {
        matron: {
            name: "ä¸»æ¯", icon: "fa-chess-queen",
            levels: [
                { title: "æ–°å¦‡", salary: 800, req: { etiquette: 30 }, promotion_points: 100 },
                { title: "ç®¡äº‹åª³å¦‡", salary: 1500, req: { wisdom: 50 }, promotion_points: 150 },
                { title: "å½“å®¶ä¸»æ¯", salary: 4000, req: { virtue: 80 }, promotion_points: 200 },
                { title: "ä¸€å“è¯°å‘½", salary: 15000, req: { reputation: 500 }, promotion_points: 500 }
            ]
        },
        embroiderer: {
            name: "ç»£å¨˜", icon: "fa-cut",
            levels: [
                { title: "ç»£åŠå­¦å¾’", salary: 700, req: { talent: 30 }, promotion_points: 100 },
                { title: "ç»£å¨˜", salary: 1400, req: { talent: 60 }, promotion_points: 150 },
                { title: "æŒæŸœ", salary: 2800, req: { talent: 100, wisdom: 50 }, promotion_points: 250 },
                { title: "ç»‡é€ å¤§å®¶", salary: 6000, req: { talent: 150, reputation: 300 }, promotion_points: 350 },
                { title: "ä¸€å“å¾¡å•†", salary: 25000, req: { talent: 200, reputation: 800 }, promotion_points: 600 }
            ]
        },
        doctor: {
            name: "å¥³åŒ»", icon: "fa-clinic-medical",
            levels: [
                { title: "åŒ»é¦†å­¦å¾’", salary: 900, req: { wisdom: 30 }, promotion_points: 100 },
                { title: "åŒ»å¥³", salary: 1800, req: { wisdom: 60, virtue: 40 }, promotion_points: 150 },
                { title: "åå ‚å¥³åŒ»", salary: 3500, req: { wisdom: 100, reputation: 100 }, promotion_points: 250 },
                { title: "ææ—åæ‰‹", salary: 8000, req: { wisdom: 150, reputation: 300 }, promotion_points: 350 },
                { title: "å¤ªåŒ»é™¢åŒ»å®˜", salary: 30000, req: { wisdom: 200, reputation: 800 }, promotion_points: 700 }
            ]
        },
        spy_master: {
            name: "æƒ…æŠ¥é¦–é¢†", icon: "fa-user-secret",
            levels: [
                { title: "èŒ¶æ¥¼ä¾å¥³", salary: 900, req: { charm: 30 }, promotion_points: 100 },
                { title: "æƒ…æŠ¥è´©å­", salary: 2000, req: { wisdom: 60 }, promotion_points: 150 },
                { title: "ç»‡ç½‘ä¹‹äºº", salary: 4500, req: { wisdom: 100, charm: 70 }, promotion_points: 250 },
                { title: "æš—å½±ä¹‹ä¸»", salary: 10000, req: { wisdom: 150, reputation: 400 }, promotion_points: 350 },
                { title: "æ— å†•ä¹‹ç‹", salary: 40000, req: { wisdom: 200, reputation: 1000 }, promotion_points: 800 }
            ]
        }
    }
};
// --- DATA: Health & Medical ---
const diseases = {
    'common_cold': { name: "ä¼¤å¯’", severity: 'mild', duration: 4, health_decline: 2, treatment_cost: 30, initial_cure_chance: 0.95, death_chance: 0 },
    'malaria': { name: "ç–Ÿç–¾", severity: 'mild', duration: 6, health_decline: 3, treatment_cost: 50, initial_cure_chance: 0.90, death_chance: 0 },
    'plague': { name: "æ—¶ç–«", severity: 'severe', duration: 8, health_decline: 15, treatment_cost: 800, initial_cure_chance: 0.50, death_chance: 0.05 },
    'smallpox': { name: "å¤©èŠ±", severity: 'critical', duration: 10, health_decline: 20, treatment_cost: 1500, initial_cure_chance: 0.20, death_chance: 0.20 },
    'tuberculosis': { name: "è‚ºç—¨", severity: 'critical', duration: 12, health_decline: 12, treatment_cost: 1200, initial_cure_chance: 0.30, death_chance: 0.20 },
    'syphilis': { name: "æ¢…ç—…", severity: 'critical', duration: 20, health_decline: 8, treatment_cost: 1000, initial_cure_chance: 0.40, death_chance: 0.20, source: 'intimate' }
};

const famousDoctors = [
    { name: "åä½—", fee: 1000, success_rate_bonus: 0.30, desc: "å¤–ç§‘åœ£æ‰‹ï¼Œåˆ®éª¨ç–—æ¯’ã€‚" },
    { name: "å¼ ä»²æ™¯", fee: 700, success_rate_bonus: 0.20, desc: "åŒ»ä¸­ä¹‹åœ£ï¼Œå–„æ²»ä¼¤å¯’ã€‚" },
    { name: "å­™æ€é‚ˆ", fee: 600, success_rate_bonus: 0.18, desc: "è¯ç‹ï¼Œç²¾é€šå…»ç”Ÿã€‚" },
    { name: "ææ—¶ç", fee: 500, success_rate_bonus: 0.15, desc: "æœ¬è‰çº²ç›®ï¼Œè¯†å°½å¤©ä¸‹è¯ã€‚" },
    { name: "æ™®é€šéƒä¸­", fee: 100, success_rate_bonus: 0, desc: "åŸä¸­åå ‚å¤§å¤«ï¼Œç»éªŒå°šå¯ã€‚" }
];

// --- DATA: Events & Interactions ---
const marketItems = {
    female: [
        { id: 'silk_dress', name: 'äº‘é”¦è¿è¡£è£™', price: 800, effect: { charm: 8, etiquette: 3 }, desc: 'åç¾å¼‚å¸¸ï¼Œèƒ½æå¤§æå‡ä½ çš„é­…åŠ›ä¸æ°”è´¨ã€‚' },
        { id: 'pearl_hairpin', name: 'çç å‘ç°ª', price: 450, effect: { charm: 5, etiquette: 2 }, desc: 'æ¸©æ¶¦çš„çç è¡¬æ‰˜å‡ºä½ å…¸é›…çš„æ°”è´¨ã€‚' },
        { id: 'ancient_qin', name: 'åå®¶ç´è°±', price: 600, effect: { talent: 7 }, desc: 'ä¸€æœ¬å¤±ä¼ çš„å¤ç´è°±ï¼Œèƒ½æå¤§å¯å‘ä½ çš„æ‰æƒ…ã€‚' }
    ],
    male: [
        { id: 'fine_sword', name: 'é¾™æ³‰å®å‰‘', price: 1200, effect: { martial: 8 }, desc: 'å‰Šé“å¦‚æ³¥çš„å®å‰‘ï¼Œæ˜¯ä¹ æ­¦ä¹‹äººçš„æœ€çˆ±ã€‚' },
        { id: 'war_strategy_book', name: 'å…µæ³•è¦ç•¥', price: 750, effect: { wisdom: 7, martial: 2 }, desc: 'ä¸€éƒ¨å…µæ³•å¥‡ä¹¦ï¼ŒåŠ©ä½ è¿ç­¹å¸·å¹„ã€‚' },
        { id: 'good_wine', name: 'æœåº·ä½³é…¿', price: 300, desc: 'ä¸€å£¶ç»ä¸–ä½³é…¿ï¼Œæ˜¯ç»“äº¤æœ‹å‹çš„åˆ©å™¨ã€‚ (å¯ç”¨äºèµ ç¤¼)' }
    ],
    common: [
        { id: 'ginseng', name: 'ç™¾å¹´äººå‚', price: 20000, effect: { health: 10 }, desc: 'å¤§è¡¥å…ƒæ°”çš„çè´µè¯æï¼Œå±æ€¥æ—¶åˆ»å¯åŠå‘½ã€‚' },
        { id: 'antique_vase', name: 'å‰æœèŠ±ç“¶', price: 2500, type: 'collectible', baseAppreciation: 0.01, currentValue: 2500, purchasePrice: 2500, desc: 'ä¸€ä»¶é›…è‡´çš„å¤è‘£ï¼Œå¯æ”¶è—å¢å€¼ã€‚' },
        { id: 'famous_painting', name: 'åå®¶å­—ç”»', price: 4000, type: 'collectible', baseAppreciation: 0.02, currentValue: 4000, purchasePrice: 4000, desc: 'ä¸€å¹…ä¼ ä¸–ç”»ä½œï¼Œé¢‡å…·æ”¶è—ä»·å€¼ã€‚' },
    ]
};
const restaurantMenu = [
    { id: 'tea', name: 'é›¨å‰é¾™äº•', price: 100, effect: { health: 1 }, desc: 'ä¸€æ¯æ¸…èŒ¶ï¼Œç¥æ¸…æ°”çˆ½ã€‚' },
    { id: 'dimsum', name: 'æ¡‚èŠ±ç³–ç³•', price: 250, effect: { charm: 1 }, desc: 'ç”œç³¯çš„ç‚¹å¿ƒï¼Œå¿ƒæƒ…æ„‰æ‚¦ã€‚'},
    { id: 'meal', name: 'å››æ–¹é£Ÿç›’', price: 500, effect: { health: 2, charm: 1 }, desc: 'ç²¾è‡´çš„èœè‚´ï¼Œä¸€é¥±å£ç¦ã€‚'},
{ id: 'banquet', name: 'ç¼æ—ç››å®´', price: 1000, effect: { charm: 2, etiquette: 2 }, desc: 'å®´è¯·å®¾å®¢çš„ä¸Šä½³ä¹‹é€‰ã€‚' },
{ id: 'golden_fries', name: 'é»„é‡‘è–¯æ¡', price: 3000, effect: { performance: 20, talent: 10, martial: 10 }, desc: 'ç¥ç§˜çš„å¼‚åŸŸç¾é£Ÿï¼Œè•´å«ç€å¥‡ç‰¹çš„åŠ›é‡ã€‚' }
];
const wishingWellItems = [
    { id: 'beauty_fruit', name: 'æœ±é¢œæœ', effect: { charm: 30 }, desc: 'ä¼ è¯´ä¸­çš„ä»™æœï¼Œé£Ÿä¹‹å¯ä»¤å®¹é¢œç„•å‘ï¼Œé­…åŠ›å¤§å¢ã€‚' },
    { id: 'wisdom_spring', name: 'æ™ºæ…§æ³‰', effect: { wisdom: 30 }, desc: 'é¥®ä¸‹æ­¤æ³‰æ°´ï¼Œä¾¿èƒ½èŒ…å¡é¡¿å¼€ï¼Œæ™ºæ…§è¶…ç¾¤ã€‚' },
    { id: 'longevity_peach', name: 'é•¿å¯¿æ¡ƒ', effect: { health: 30 }, desc: 'ä»™æ± è¾¹çš„èŸ æ¡ƒï¼Œèƒ½ç¥›ç—…å»¶å¹´ï¼Œèº«å¼ºä½“å¥ã€‚' },
    { id: 'career_charm', name: 'æ™‹å‡ç¬¦', effect: { career_progress: 50 }, desc: 'ä¸€é“ç¥ç§˜çš„ç¬¦å’’ï¼Œèƒ½åŠ©ä½ åœ¨äº‹ä¸šä¸Šå–å¾—è¿›å±•ã€‚' },
    { id: 'love_knot', name: 'å£°æœ›å¡', effect: { reputation: 30 }, desc: 'å¯è®©ä½ å®¶å–»æˆ·æ™“ï¼Œæ˜¯å‡èŒæ¡ä»¶çš„å¿…å¤‡ä¹‹é€‰ã€‚' }
];

const romanticEvents = [
    "TAå¸¦ä½ å»äº†åŸéƒŠçš„ä¸€ç‰‡æ¡ƒèŠ±æ—ï¼Œé£å¹è¿‡ï¼ŒèŠ±ç“£å¦‚é›¨ï¼Œè½åœ¨ä½ ä»¬çš„å‘é—´ã€‚", "ä½ ä»¬åœ¨æœˆä¸‹æ³›èˆŸï¼ŒTAä¸ºä½ è½»å£°åŸå”±äº†ä¸€é¦–æƒ…è¯—ï¼Œæ¹–é¢æ³¢å…‰ç²¼ç²¼ï¼Œæ˜ ç€ä½ ä»¬çš„èº«å½±ã€‚",
    "TAåœ¨åº™ä¼šä¸ºä½ èµ¢å¾—äº†ä¸€æ”¯ç²¾è‡´çš„ç é’—ï¼Œäº²æ‰‹ä¸ºä½ ç°ªä¸Šã€‚", "ä¸‹é›¨å¤©ï¼Œä½ ä»¬å…±æ’‘ä¸€æŠŠæ²¹çº¸ä¼ï¼Œåœ¨é’çŸ³æ¿è·¯ä¸Šç¼“ç¼“èµ°ç€ï¼Œè‚©è†€å‡ ä¹é åœ¨ä¸€èµ·ã€‚",
    "TAè¯´ä½ ç¬‘èµ·æ¥çš„æ—¶å€™ï¼Œçœ¼ç›é‡Œåƒæœ‰æ˜Ÿæ˜Ÿã€‚", "ä½ ä»¬åœ¨èŒ¶æ¥¼å¬ä¹¦ï¼Œè®²åˆ°åŠ¨æƒ…å¤„ï¼ŒTAæ‚„æ‚„æ¡ä½äº†ä½ çš„æ‰‹ã€‚",
    "TAè®°å¾—ä½ ä¸çˆ±åƒè‘±ï¼Œæ¯æ¬¡éƒ½ä¼šç»†å¿ƒåœ°å¸®ä½ æŒ‘å‡ºæ¥ã€‚", "ä½ ç”Ÿäº†ä¸€åœºå°ç—…ï¼ŒTAæ—¥å¤œå®ˆåœ¨ä½ åºŠå‰ï¼Œä¸ºä½ ç«¯èŒ¶é€è¯ã€‚",
    "TAä¸ºä½ ç”»äº†ä¸€å¹…è‚–åƒï¼Œè¯´è¦æŠŠä½ æœ€ç¾çš„æ ·å­è®°ä¸‹æ¥ã€‚", "ä½ é‡åˆ°å±é™©æ—¶ï¼ŒTAæ¯«ä¸çŠ¹è±«åœ°æŒ¡åœ¨äº†ä½ çš„èº«å‰ã€‚",
    "TAå·å·ä¸ºä½ å‡†å¤‡äº†ä¸€åœºçƒŸç«ï¼Œç»šçƒ‚çš„çƒŸèŠ±ä¸‹ï¼ŒTAçš„çœ¼çœ¸æ¯”çƒŸç«æ›´äº®ã€‚"
];
const husbandInteractionEvents = [
    { favor_change: 2, text: 'ä½ ä¸å¤«å›æœˆä¸‹å¯¹é…Œï¼Œç›¸è°ˆç”šæ¬¢ï¼Œåªè§‰å²æœˆé™å¥½ã€‚' },
    { favor_change: 3, text: 'å¤«å›è°ˆåŠå…¬åŠ¡ä¸Šçš„çƒ¦å¿ƒäº‹ï¼Œä½ æ¸©è¨€è½¯è¯­åœ°å¼€è§£ä»–ï¼Œä»–çœ¼ä¸­æ»¡æ˜¯æ„Ÿæ¿€ã€‚' },
    { favor_change: 1, text: 'ä½ ä¸ºå¤«å›æ•´ç†ä¹¦æˆ¿ï¼Œä»–çœ‹åˆ°åï¼Œç¬‘ç€å¤¸ä½ è´¤æƒ ã€‚' },
    { favor_change: 5, text: 'å¤«å›å¤–å‡ºå½’æ¥ï¼Œç‰¹åœ°ä¸ºä½ å¸¦äº†ä½ æœ€çˆ±åƒçš„æ¡‚èŠ±ç³•ï¼Œä½ å¿ƒä¸­ä¸€æš–ã€‚' }
];
const wifeInteractionEvents = [
    { favor_change: 2, text: 'ä½ ä¸å¤«äººåœ¨èŠ±å›­ä¸­æ•£æ­¥ï¼Œå¥¹ä¸ºä½ ç°ªä¸Šä¸€æœµåˆšæ‘˜çš„é²œèŠ±ã€‚' },
    { favor_change: 3, text: 'å¤«äººä¸ºä½ ç¼åˆ¶çš„è¡£è¢é€åˆ°äº†ï¼Œé’ˆè„šç»†å¯†ï¼Œæ»¡å«æƒ…æ„ã€‚' },
    { favor_change: 1, text: 'ä½ å¤„ç†å®Œå…¬åŠ¡å›åˆ°æˆ¿ä¸­ï¼Œå‘ç°å¤«äººå·²ä¸ºä½ å¤‡å¥½çƒ­èŒ¶ç‚¹å¿ƒã€‚' },
    { favor_change: 5, text: 'ä½ ä¸ºå¤«äººä¹°äº†ä¸€æ”¯å¥¹å¿ƒä»ªå·²ä¹…çš„ç é’—ï¼Œå¥¹å–œä¸è‡ªèƒœã€‚' }
];

// --- DATA: Children & Cultivation ---
const childPersonalityEvents = {
     '1': {
        title: "å‘¨å²æŠ“å‘¨",
        desc: "åœ¨ä½ çš„å‘¨å²å®´ä¸Šï¼Œçˆ¶æ¯å°†å„ç§ç‰©å“æ‘†åœ¨é¢å‰ï¼Œè®©ä½ æŠ“å–ã€‚",
        options: [
            { text: "æŠ“äº†ä¹¦æœ¬ï¼Œçœ‹æ¥å°†æ¥æ˜¯ä¸ªè¯»ä¹¦çš„æ–™ã€‚", trait: "èªæ…§", effects: { attributes: { wisdom: 5 } } },
            { text: "æŠ“äº†ç®—ç›˜ï¼Œçœ‹æ¥å¯¹æ•°å­—å¾ˆæ•æ„Ÿã€‚", trait: "æ•é”", effects: { attributes: { wisdom: 5 } } },
            { text: "æŠ“äº†ç‰ä½©ï¼Œä¼¼æœ‰å›å­ä¹‹é£ã€‚", trait: "ç«¯åº„", effects: { attributes: { etiquette: 5 } } },
            { text: "æŠ“äº†æœ¨å‰‘ï¼Œçœ‹æ¥æ˜¯ä¸ªæ´»æ³¼å¥½åŠ¨çš„å­©å­ã€‚", trait: "æ´»æ³¼", effects: { attributes: { martial: 5 } } }
        ]
    },
    '5': {
        title: "åˆå…¥è’™å­¦",
        desc: "ä½ çš„å­©å­åˆå…¥è’™å­¦ï¼Œé¢å¯¹é™Œç”Ÿçš„ç¯å¢ƒå’ŒåŒå­¦ï¼ŒTAæœ‰äº›ä¸çŸ¥æ‰€æªã€‚",
        options: [
            { text: "ä½ é¼“åŠ±TAä¸»åŠ¨ç»“äº¤æ–°æœ‹å‹ã€‚", trait: "ä¹è§‚", effects: { attributes: { charm: 5 } } },
            { text: "ä½ æ•™å¯¼TAè¦è°¦é€Šæœ‰ç¤¼ï¼Œä¸ä¸äººäº‰åµã€‚", trait: "å†…æ•›", effects: { attributes: { etiquette: 5 } } },
            { text: "ä½ è®©TAå°†å®¶ä¸­ç‚¹å¿ƒåˆ†ç»™åŒå­¦ã€‚", trait: "å–„è‰¯", effects: { attributes: { virtue: 5 } } }
        ]
    },
    '7': {
        title: "è¯¾å ‚é£æ³¢",
        desc: "ä½ çš„å­©å­åœ¨è¯¾å ‚ä¸Šå› ä¸€ç¯‡è¯¾æ–‡ä¸åŒå­¦äº§ç”Ÿäº†æ¿€çƒˆçš„äº‰æ‰§ã€‚",
        options: [
            { text: "é¼“åŠ±TAåšæŒè‡ªå·±çš„è§‚ç‚¹ï¼Œä½†è¦è®²ç©¶æ–¹æ³•ã€‚", trait: "æœæ•¢", effects: { attributes: { wisdom: 5 } } },
            { text: "è®©TAå‘åŒå­¦é“æ­‰ï¼Œä»¥å’Œä¸ºè´µã€‚", trait: "å†…æ•›", effects: { attributes: { virtue: 5 } } },
            { text: "è°ƒæŸ¥äº‰æ‰§çš„èµ·å› ï¼Œæ‰¾å‡ºçœŸç›¸ã€‚", trait: "æ•é”", effects: { attributes: { wisdom: 5 } } }
        ]
    },
    '10': {
        title: "å°‘å¹´å¿ƒäº‹",
        desc: "ä½ çš„å­©å­æœ€è¿‘ä¼¼ä¹å¿ƒäº‹é‡é‡ï¼Œç»å¸¸ç‹¬è‡ªä¸€äººå‘å‘†ã€‚",
        options: [
            { text: "è€å¿ƒåœ°è¯¢é—®TAçš„å¿ƒäº‹ã€‚", trait: "æ¸©æŸ”", effects: { favor: 10 } },
            { text: "å¸¦TAå»éƒŠå¤–æ¸¸ç©ï¼Œæ”¾æ¾å¿ƒæƒ…ã€‚", trait: "ä¹è§‚", effects: { attributes: { health: 5, charm: 5 } } },
            { text: "äº¤ç»™è€å¸ˆï¼Œè®©è€å¸ˆå»å¼€å¯¼ã€‚", trait: "ç°å®", effects: { favor: -5 } }
        ]
    },
    '12': {
        title: "æ‰è‰ºæŠ‰æ‹©",
        desc: "ä½ çš„å­©å­åœ¨ç´æ£‹ä¹¦ç”»å’Œæ­¦å­¦ä¹‹é—´ï¼Œä¸çŸ¥å¦‚ä½•é€‰æ‹©ã€‚",
        options: [
            { text: "é¼“åŠ±TAå­¦ä¹ ç´æ£‹ä¹¦ç”»ï¼Œæå‡æ‰æƒ…ã€‚", trait: "èªæ…§", effects: { attributes: { talent: 5 } } },
            { text: "é¼“åŠ±TAä¿®ä¹ æ­¦å­¦ï¼Œå¼ºèº«å¥ä½“ã€‚", trait: "æ­¦å‹‡", effects: { attributes: { martial: 5 } } },
            { text: "è®©TAè‡ªå·±é€‰æ‹©ï¼Œå°Šé‡TAçš„æ„æ„¿ã€‚", trait: "ç‹¬ç«‹", effects: { favor: 10 } }
        ]
    },
    '14': {
        title: "æœ‹å‹ä¹‹ä¹‰",
        desc: "ä½ çš„å­©å­çš„æœ‹å‹è¢«äººæ¬ºè´Ÿï¼ŒTAæƒ³ä¸ºæœ‹å‹å‡ºå¤´ï¼Œä½†åˆæ‹…å¿ƒæƒ¹éº»çƒ¦ã€‚",
        options: [
            { text: "æ”¯æŒTAä¸ºæœ‹å‹å‡ºå¤´ï¼Œå½°æ˜¾ä¾ ä¹‰ã€‚", trait: "åšéŸ§", effects: { attributes: { martial: 5, virtue: 5 } } },
            { text: "åŠè¯´TAå¯»æ±‚å¤§äººçš„å¸®åŠ©ï¼Œé¿å…ä¸å¿…è¦çš„å†²çªã€‚", trait: "è°¨æ…", effects: { attributes: { wisdom: 5 } } },
            { text: "ä¸æ’æ‰‹ï¼Œè®©TAè‡ªå·±å¤„ç†ã€‚", trait: "ç‹¬ç«‹", effects: { favor: 5 } }
        ]
    },
    '16': {
        title: "åŠç¬„/å† ç¤¼",
        desc: "ä½ çš„å­©å­å·²åˆ°åŠç¬„/å† ç¤¼ä¹‹å¹´ï¼Œä½ ä¸ºTAä¸¾åŠäº†éš†é‡çš„ä»ªå¼ã€‚",
        options: [
            { text: "æé†’TAè¦æ—¶åˆ»æ³¨æ„è¨€è¡Œï¼Œæˆä¸ºå®¶æ—çš„è¡¨ç‡ã€‚", trait: "ç«¯åº„", effects: { attributes: { etiquette: 5, virtue: 5 } } },
            { text: "é¼“åŠ±TAå‹‡æ•¢è¿½æ±‚è‡ªå·±çš„ç†æƒ³ï¼Œä¸è¢«ä¸–ä¿—æ‰€æ‹˜ã€‚", trait: "æ´’è„±", effects: { attributes: { charm: 5, talent: 5 } } },
            { text: "è¯¢é—®TAå¯¹æœªæ¥çš„è§„åˆ’ï¼Œç»™äºˆæ”¯æŒã€‚", trait: "æ•é”", effects: { attributes: { wisdom: 5 } } }
        ]
    },
    '18': {
        title: "æˆäººä¹‹ç¤¼",
        desc: "ä½ çš„å­©å­å·²ç»æˆå¹´ï¼Œä½ å†³å®šç»™TAä¸€ç¬”é’±ï¼Œè®©TAè‡ªå·±å»é—¯è¡ã€‚",
        options: [
            { text: "ç»™äºˆå¤§ç¬”é’±è´¢ï¼Œè®©TAè¡£é£Ÿæ— å¿§ã€‚", trait: "ç°å®", effects: { wealth: 1000, favor: 10 } },
            { text: "ç»™äºˆå°‘é‡é’±è´¢ï¼Œè®©TAè‡ªå·±å»å¥‹æ–—ã€‚", trait: "åšéŸ§", effects: { wealth: 200, favor: 5 } },
            { text: "é¼“åŠ±TAç•™åœ¨å®¶ä¸­ï¼Œç»§æ‰¿å®¶ä¸šã€‚", trait: "ä¼ ç»Ÿ", effects: { favor: 15 } }
        ]
    }
};
// ===================== ã€æ–°åŠŸèƒ½ã€‘å­å¥³æˆé•¿äº‹ä»¶åº“ =====================
// ===================== ã€æ–°åŠŸèƒ½ã€‘å­å¥³æˆé•¿äº‹ä»¶åº“ =====================
const CHILD_LIFE_EVENTS = {
    6: [
        { id: 'first_day_school', title: 'å¼€è’™ä¹‹æ—¥', desc: 'ä½ çš„å­©å­ {childName} åˆ°äº†å¼€è’™çš„å¹´çºªï¼Œä½ é€TAå»äº†å­¦å ‚ã€‚ç¬¬ä¸€å¤©å›æ¥åï¼ŒTAçœ‹èµ·æ¥...', options: [
            { text: 'å…´é«˜é‡‡çƒˆï¼Œè¯´äº¤åˆ°äº†æ–°æœ‹å‹ã€‚', effects: { charm: 2, favor: 5 }, log: '{childName}å±•ç°äº†è‰¯å¥½çš„ç¤¾äº¤èƒ½åŠ›ã€‚' },
            { text: 'æœ‰äº›æ²®ä¸§ï¼Œè¯´åŠŸè¯¾å¤ªéš¾äº†ã€‚', effects: { wisdom: -1, health: -1 }, log: '{childName}ä¼¼ä¹å¯¹å­¦ä¸šæœ‰äº›ç•éš¾æƒ…ç»ªã€‚' },
            { text: 'ä¸äººäº‰æ‰§ï¼Œè¡£æœéƒ½å¼„è„äº†ã€‚', effects: { martial: 1, etiquette: -2 }, log: '{childName}æ€§æ ¼ä¼¼ä¹æœ‰äº›å¥½æ–—ã€‚' }
        ]}
    ],
    7: [
        { id: 'found_pet', title: 'å¶é‡çµå® ', desc: 'å­©å­ {childName} ä»å¤–é¢æŠ±å›æ¥ä¸€åªå—ä¼¤çš„å°åŠ¨ç‰©ï¼Œçœ¼ç¥æœŸç›¼åœ°çœ‹ç€ä½ ï¼Œå¸Œæœ›å¯ä»¥æ”¶å…»å®ƒã€‚', options: [
            { text: 'ã€åŒæ„æ”¶å…»ã€‘å¹¶ä¸€åŒåŒ»æ²»ã€‚', effects: { virtue: 3, favor: 10 }, log: 'ä½ å’Œå­©å­ä¸€åŒç…§æ–™å°åŠ¨ç‰©ï¼ŒåŸ¹å…»äº†TAçš„çˆ±å¿ƒã€‚' },
            { text: 'ã€ä¸¥å‰æ‹’ç»ã€‘è®¤ä¸ºç©ç‰©ä¸§å¿—ã€‚', effects: { virtue: -2, favor: -5 }, log: 'ä½ æ‹’ç»äº†å­©å­çš„è¯·æ±‚ï¼ŒTAçœ‹èµ·æ¥å¾ˆéš¾è¿‡ã€‚' },
            { text: 'ã€æ•™å¯¼çŸ¥è¯†ã€‘å‘Šè¯‰TAå¦‚ä½•å¤„ç†ã€‚', effects: { wisdom: 2, virtue: 1 }, log: 'ä½ å€Ÿæ­¤æœºä¼šæ•™å¯¼äº†å­©å­ç›¸å…³çš„çŸ¥è¯†ã€‚' }
        ]}
    ],
    8: [
        { id: 'bully_incident', title: 'å­¦å ‚çº·äº‰', desc: 'ä½ å¬è¯´å­©å­ {childName} åœ¨å­¦å ‚è¢«é«˜å¹´çº§çš„å­©å­æ¬ºè´Ÿäº†ã€‚', options: [
            { text: 'ã€æ•™TAæ‰“å›å»ã€‘ç”·å­æ±‰ä¸èƒ½å—æ¬ºè´Ÿï¼', effects: { martial: 3, virtue: -1 }, log: 'ä½ æ•™å¯¼å­©å­è¦å¼ºç¡¬ï¼ŒTAçš„æ­¦å­¦ç•¥æœ‰æå‡ã€‚' },
            { text: 'ã€äº²è‡ªå»å­¦å ‚ã€‘æ‰¾å…ˆç”Ÿå’Œå¯¹æ–¹å®¶é•¿ç†è®ºã€‚', effects: { reputation: 2, favor: 5 }, log: 'ä½ çš„å‡ºé¢è§£å†³äº†é—®é¢˜ï¼Œå­©å­è§‰å¾—å¾ˆæœ‰å®‰å…¨æ„Ÿã€‚' },
            { text: 'ã€æ•™TAç”¨è®¡ã€‘è®©ä»–ä»¬è‡ªé£Ÿå…¶æœã€‚', effects: { wisdom: 3 }, log: 'ä½ æ•™å¯¼å­©å­è¦ç”¨æ™ºæ…§è§£å†³é—®é¢˜ã€‚' }
        ]},
        // ============= æ–°å¢äº‹ä»¶ START ===============
        { id: 'saving_money', title: 'æ”’ç§æˆ¿é’±', desc: 'ä½ å‘ç°å­©å­ {childName} åœ¨å·å·æ”’é’±ï¼Œä¼¼ä¹åœ¨è®¡åˆ’ç€ä»€ä¹ˆã€‚', options: [
            { text: 'ã€å‡è£…ä¸çŸ¥ã€‘ç»™äºˆTAéšç§ã€‚', effects: { wisdom: 1 }, log: 'ä½ é€‰æ‹©å°Šé‡å­©å­çš„ç§˜å¯†ã€‚' },
            { text: 'ã€è¯¢é—®ç”¨é€”ã€‘å¹¶è¡¨ç¤ºå¯ä»¥æ”¯æŒã€‚', effects: { favor: 8 }, log: 'ä½ çš„å…³å¿ƒè®©å­©å­å¾ˆæ„ŸåŠ¨ï¼Œå¹¶å‘Šè¯‰äº†ä½ TAçš„â€œå°è®¡åˆ’â€ã€‚' },
            { text: 'ã€æ²¡æ”¶å……å…¬ã€‘è®¤ä¸ºå°å­©ä¸è¯¥æœ‰ç§˜å¯†ã€‚', effects: { favor: -10, virtue: -2 }, log: 'ä½ çš„åšæ³•ä¸¥é‡ä¼¤å®³äº†å­©å­çš„æ„Ÿæƒ…ã€‚' }
        ]}
        // ============= æ–°å¢äº‹ä»¶ END =================
    ],
    9: [
        { id: 'interest_develop', title: 'å…´è¶£èŒèŠ½', desc: 'å­©å­ {childName} æœ€è¿‘å¯¹æŸä¸€é¢†åŸŸè¡¨ç°å‡ºäº†æµ“åšçš„å…´è¶£ã€‚', options: [
            { text: 'å¯¹ã€è¯—è¯æ­Œèµ‹ã€‘ååˆ†ç€è¿·ã€‚', effects: { talent: 4 }, log: 'ä½ å†³å®šæ”¯æŒå­©å­çš„å…´è¶£ï¼ŒTAçš„æ‰æƒ…è·å¾—äº†æˆé•¿ã€‚' },
            { text: 'å–œæ¬¢ã€èˆåˆ€å¼„æªã€‘ã€‚', effects: { martial: 4 }, log: 'ä½ ä¸ºå­©å­è¯·äº†æ­¦å­¦å¸ˆå‚…ï¼ŒTAçš„èº«ä½“æ›´å¼ºå¥äº†ã€‚' },
            { text: 'çƒ­è¡·äºã€å¸‚é›†ç®—è´¦ã€‘ã€‚', effects: { wisdom: 4 }, log: 'ä½ å‘ç°å­©å­é¢‡æœ‰ç»å•†å¤´è„‘ï¼Œå†³å®šåŠ ä»¥å¼•å¯¼ã€‚' }
        ]}
    ],
    10: [
        { id: 'friend_trouble', title: 'æœ‹å‹ä¹‹éš¾', desc: 'å­©å­ {childName} çš„ä¸€ä½å¥½å‹å®¶ä¸­çªé­å˜æ•…ï¼ŒTAæƒ³ç”¨è‡ªå·±çš„é›¶èŠ±é’±å»å¸®åŠ©å¯¹æ–¹ã€‚', options: [
            { text: 'ã€å¤§åŠ›æ”¯æŒã€‘å¹¶é¢å¤–ç»™äºˆèµ„åŠ©ã€‚', effects: { virtue: 5, charm: 2, favor: 10 }, log: 'ä½ çš„å–„ä¸¾è®©å­©å­æ˜ç™½äº†ä¸ºäººä¹‹é“ã€‚' },
            { text: 'ã€å£å¤´é¼“åŠ±ã€‘ä½†è®¤ä¸ºè¿™æ˜¯TAè‡ªå·±çš„äº‹ã€‚', effects: { virtue: 2 }, log: 'å­©å­ç”¨è‡ªå·±çš„åŠ›é‡å¸®åŠ©äº†æœ‹å‹ã€‚' },
            { text: 'ã€è¡¨ç¤ºåå¯¹ã€‘è®¤ä¸ºä¸åº”å¤šç®¡é—²äº‹ã€‚', effects: { virtue: -3, favor: -5 }, log: 'ä½ çš„æ€åº¦è®©å­©å­æ„Ÿåˆ°ä¸è§£å’Œå¤±æœ›ã€‚' }
        ]}
    ],
    11: [
        { id: 'academic_competition', title: 'ä¹¦é™¢å°æ¯”', desc: 'ä¹¦é™¢ä¸¾è¡Œäº†ä¸€æ¬¡ç»ä¹‰å°æ¯”ï¼Œä½ çš„å­©å­ {childName} ä¹Ÿå‚åŠ äº†ã€‚', options: [
            { text: 'è·å¾—äº†ã€ä¼˜èƒœã€‘ï¼Œå¾—äº†å…ˆç”Ÿçš„å¤¸å¥–ã€‚', effects: { wisdom: 3, reputation: 2 }, log: '{childName}åœ¨ä¹¦é™¢å°æ¯”ä¸­å´­éœ²å¤´è§’ã€‚' },
            { text: 'è¡¨ç°ã€å¹³å¹³ã€‘ï¼Œä½†è®¤è¯†äº†å·®è·ã€‚', effects: { wisdom: 1 }, log: '{childName}åœ¨å°æ¯”åæ›´åŠ åŠªåŠ›äº†ã€‚' },
            { text: 'å› ã€ç´§å¼ ã€‘è€Œå‘æŒ¥å¤±å¸¸ã€‚', effects: { health: -1, wisdom: -1 }, log: '{childName}ä¼¼ä¹ä¸å¤ªé€‚åº”ç«äº‰çš„åœºåˆã€‚' }
        ]},
        // ============= æ–°å¢äº‹ä»¶ START ===============
        { id: 'found_love_letter', title: 'å‘ç°æƒ…ä¹¦', desc: 'ä½ æ‰“æ‰«æˆ¿é—´æ—¶ï¼Œæ— æ„ä¸­å‘ç°äº† {childName} å†™ç»™åˆ«äººçš„æƒ…ä¹¦ã€‚', options: [
            { text: 'ã€å·çœ‹ã€‘å¹¶äº†è§£TAçš„å¿ƒäº‹ã€‚', effects: { wisdom: 2, virtue: -3 }, log: 'ä½ æ»¡è¶³äº†å¥½å¥‡å¿ƒï¼Œä½†ä¹Ÿä¾µçŠ¯äº†å­©å­çš„éšç§ã€‚' },
            { text: 'ã€æ”¾å›åŸå¤„ã€‘å½“åšä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚', effects: { virtue: 2 }, log: 'ä½ é€‰æ‹©äº†å°Šé‡å­©å­ã€‚' },
            { text: 'ã€å½“é¢è¯¢é—®ã€‘å¼€è¯šå¸ƒå…¬åœ°è°ˆä¸€è°ˆã€‚', effects: { favor: 5, charm: 1 }, log: 'ä½ ä¸å­©å­è¿›è¡Œäº†ä¸€æ¬¡å¼€è¯šå¸ƒå…¬çš„è°ˆè¯ã€‚' }
        ]}
        // ============= æ–°å¢äº‹ä»¶ END =================
    ],
    12: [
        { id: 'first_crush', title: 'æƒ…çª¦åˆå¼€', desc: 'ä½ å‘ç°å­©å­ {childName} æœ€è¿‘æ€»æ˜¯å’Œä¸€ä¸ªå¼‚æ€§åŒå­¦å‡ºåŒå…¥å¯¹ï¼Œä¼¼ä¹æ˜¯æƒ…çª¦åˆå¼€äº†ã€‚', options: [
            { text: 'ã€æ­£ç¡®å¼•å¯¼ã€‘å‘ŠçŸ¥åˆ†å¯¸ï¼Œä¸åŠ å¹²æ¶‰ã€‚', effects: { charm: 2, wisdom: 1, favor: 5 }, log: 'ä½ çš„å¼€æ˜è®©å­©å­å¾ˆæ„Ÿæ¿€ï¼Œäº²å­å…³ç³»æ›´å¥½äº†ã€‚' },
            { text: 'ã€ä¸¥å‰ç¦æ­¢ã€‘è®¤ä¸ºä¸ºæ—¶å°šæ—©ã€‚', effects: { favor: -8, etiquette: 2 }, log: 'ä½ çš„ç¦æ­¢è®©å­©å­äº§ç”Ÿäº†é€†åå¿ƒç†ã€‚' },
            { text: 'ã€æš—ä¸­è§‚å¯Ÿã€‘å¯¹æ–¹çš„å®¶ä¸–å“è¡Œã€‚', effects: { wisdom: 2 }, log: 'ä½ å†³å®šå…ˆè§‚å¯Ÿä¸€æ®µæ—¶é—´å†è¯´ã€‚' }
        ]}
    ],
    13: [
        { id: 'rebellious_phase', title: 'å°‘å¹´å›é€†', desc: 'å­©å­ {childName} å¼€å§‹æœ‰äº›å›é€†ï¼Œå¯¹ä½ çš„ç®¡æ•™æ—¶å¸¸é¡¶å˜´ã€‚', options: [
            { text: 'ã€è€å¿ƒæ²Ÿé€šã€‘å°è¯•ç†è§£TAçš„æƒ³æ³•ã€‚', effects: { favor: 10, wisdom: 1 }, log: 'è€å¿ƒæ²Ÿé€šåŒ–è§£äº†çŸ›ç›¾ã€‚' },
            { text: 'ã€åŠ å¼ºç®¡æ•™ã€‘ç”¨è§„çŸ©çº¦æŸTAã€‚', effects: { favor: -5, etiquette: 3 }, log: 'ä¸¥å‰çš„ç®¡æ•™è®©TAè¡¨é¢ä¸Šé¡ºä»äº†ã€‚' },
            { text: 'ã€å†·å¤„ç†ã€‘ç»™å½¼æ­¤ä¸€äº›ç©ºé—´ã€‚', effects: { favor: -2 }, log: 'ä½ é€‰æ‹©æš‚æ—¶ä¸ä¸TAè®¡è¾ƒã€‚' }
        ]}
    ],
    14: [
        { id: 'career_dream', title: 'ç«‹ä¸‹å¿—å‘', desc: 'å­©å­ {childName} ä¸ä½ ç•…è°ˆæœªæ¥ï¼ŒTAå‘Šè¯‰ä½ ï¼ŒTAçš„æ¢¦æƒ³æ˜¯æˆä¸ºä¸€å...', options: [
            { text: 'ã€æ–‡å®˜ã€‘ï¼Œä¸ºå›½ä¸ºæ°‘ã€‚', effects: { virtue: 2, wisdom: 2 }, log: '{childName}ç«‹ä¸‹äº†æˆä¸ºå›½ä¹‹æ ‹æ¢çš„å¿—å‘ã€‚' },
            { text: 'ã€æ­¦å°†ã€‘ï¼Œä¿å®¶å«å›½ã€‚', effects: { martial: 2, health: 2 }, log: '{childName}æ¸´æœ›åœ¨æ²™åœºä¸Šå»ºåŠŸç«‹ä¸šã€‚' },
            { text: 'ã€å¯Œå•†ã€‘ï¼Œå¯Œç”²ä¸€æ–¹ã€‚', effects: { charm: 2, wisdom: 2 }, log: '{childName}å¯¹å•†ä¸šç»è¥äº§ç”Ÿäº†æµ“åšçš„å…´è¶£ã€‚' }
        ]},
        // ============= æ–°å¢äº‹ä»¶ START ===============
        { id: 'helping_poor', title: 'å¸®åŠ©ç©·äºº', desc: 'ä½ çœ‹åˆ° {childName} å°†è‡ªå·±çš„é£Ÿç‰©åˆ†ç»™äº†è·¯è¾¹çš„ä¹ä¸ã€‚', options: [
            { text: 'ã€åŠ ä»¥èµèµã€‘å¹¶ç»™äºˆæ›´å¤šé£Ÿç‰©ã€‚', effects: { virtue: 4, favor: 5 }, log: 'ä½ çš„é¼“åŠ±è®©å­©å­çš„å–„è‰¯å“è´¨å¾—ä»¥æˆé•¿ã€‚' },
            { text: 'ã€é»˜è®¸ã€‘ä½†ä¸å‘è¡¨æ„è§ã€‚', effects: { virtue: 1 }, log: 'ä½ çœ‹åˆ°äº†å­©å­çš„å–„ä¸¾ã€‚' },
            { text: 'ã€å‘Šè¯«TAã€‘ä¸è¦éšä¾¿å’Œé™Œç”Ÿäººè¯´è¯ã€‚', effects: { wisdom: 1, virtue: -1 }, log: 'ä½ çš„å‘Šè¯«è®©å­©å­å­¦ä¼šäº†ä¿æŠ¤è‡ªå·±ï¼Œä½†ä¹Ÿæœ‰äº›å›°æƒ‘ã€‚' }
        ]}
        // ============= æ–°å¢äº‹ä»¶ END =================
    ],
    15: [
        { id: 'part_time_work', title: 'åˆæ¶‰ä¸–äº‹', desc: 'å­©å­ {childName} æƒ³è¦åˆ©ç”¨è¯¾ä½™æ—¶é—´å»ä¸€å®¶åº—é“ºå½“å­¦å¾’ï¼Œä½“éªŒç”Ÿæ´»ã€‚', options: [
            { text: 'ã€æ¬£ç„¶åŒæ„ã€‘è¿™æ˜¯éš¾å¾—çš„é”»ç‚¼ã€‚', effects: { wisdom: 2, virtue: 1, favor: 5 }, log: 'å­©å­åœ¨å®è·µä¸­å­¦åˆ°äº†å¾ˆå¤šã€‚' },
            { text: 'ã€æ‹…å¿ƒå®‰å…¨ã€‘ä½†æœ€ç»ˆè¿˜æ˜¯åŒæ„äº†ã€‚', effects: { favor: 2 }, log: 'ä½ è™½æœ‰æ‹…å¿§ï¼Œä½†è¿˜æ˜¯å°Šé‡äº†å­©å­çš„å†³å®šã€‚' },
            { text: 'ã€åšå†³åå¯¹ã€‘è®¤ä¸ºåº”å½“ä»¥å­¦ä¸šä¸ºé‡ã€‚', effects: { favor: -5 }, log: 'ä½ æ‹’ç»äº†å­©å­çš„è¯·æ±‚ã€‚' }
        ]}
    ],
    // æ›´å¤šäº‹ä»¶...
    16: [
        { id: 'coming_of_age', title: 'åŠç¬„/å† ç¤¼', desc: 'ä¸ºåº†ç¥ {childName} æˆå¹´ï¼Œä½ ä¸ºå…¶ä¸¾åŠäº†ç››å¤§çš„åŠç¬„/å† ç¤¼ã€‚', options: [
            { text: 'ã€åœºé¢å®å¤§ã€‘ï¼Œå®¾å®¢äº‘é›†ã€‚', effects: { reputation: 5, charm: 3 }, log: 'ç››å¤§çš„å…¸ç¤¼è®©å®¶æ—éå¸¸æœ‰é¢å­ã€‚' },
            { text: 'ã€æ¸©é¦¨é›…è‡´ã€‘ï¼Œåªè¯·è‡³äº²å¥½å‹ã€‚', effects: { virtue: 2, favor: 8 }, log: 'æ¸©é¦¨çš„å®¶å®´è®©å­©å­æ„Ÿå—åˆ°äº†æµ“æµ“çš„äº²æƒ…ã€‚' },
            { text: 'ã€èµ äºˆé‡ç¤¼ã€‘ï¼Œä½œä¸ºæˆå¹´ç¤¼ç‰©ã€‚', effects: { favor: 12 }, log: 'ä¸€ä»½é‡ç¤¼è®©å­©å­æ˜ç™½äº†ä½ å¯¹TAçš„é‡è§†ã€‚' }
        ]}
    ],
    17: [
        { id: 'bad_influence', title: 'è¯¯äº¤æŸå‹', desc: 'ä½ å‘ç° {childName} æœ€è¿‘ä¸ä¸€äº›ä¸åŠ¡æ­£ä¸šçš„çº¨ç»”å­å¼Ÿèµ°å¾—å¾ˆè¿‘ï¼Œå­¦åäº†ã€‚', options: [
            { text: 'ã€ä¸¥ä»¤ç¦æ­¢ã€‘TAå†ä¸é‚£äº›äººæ¥å¾€ã€‚', effects: { virtue: 3, etiquette: 2, favor: -6 }, log: 'ä½ åŠæ—¶é˜»æ­¢äº†å­©å­æ»‘å‘æ·±æ¸Šã€‚' },
            { text: 'ã€æ—æ•²ä¾§å‡»ã€‘å¼•å¯¼TAè‡ªå·±ç–è¿œã€‚', effects: { wisdom: 2, virtue: 1 }, log: 'ä½ çš„å¼•å¯¼è®©å­©å­è‡ªå·±æ„è¯†åˆ°äº†é—®é¢˜ã€‚' },
            { text: 'ã€æ•™è®­æŸå‹ã€‘è®©å¯¹æ–¹ä¸æ•¢å†æ¥è¿‘ã€‚', effects: { martial: 2, reputation: -2 }, log: 'ä½ ç”¨å¼ºç¡¬çš„æ‰‹æ®µè§£å†³äº†é—®é¢˜ï¼Œä½†ä¹Ÿç•™ä¸‹äº†éœ¸é“çš„åå£°ã€‚' }
        ]}
    ],
     8: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'saving_money', title: 'æ”’ç§æˆ¿é’±', desc: 'ä½ å‘ç°å­©å­ {childName} åœ¨å·å·æ”’é’±ï¼Œä¼¼ä¹åœ¨è®¡åˆ’ç€ä»€ä¹ˆã€‚', options: [
            { text: 'ã€å‡è£…ä¸çŸ¥ã€‘ç»™äºˆTAéšç§ã€‚', effects: { wisdom: 1 }, log: 'ä½ é€‰æ‹©å°Šé‡å­©å­çš„ç§˜å¯†ã€‚' },
            { text: 'ã€è¯¢é—®ç”¨é€”ã€‘å¹¶è¡¨ç¤ºå¯ä»¥æ”¯æŒã€‚', effects: { favor: 8 }, log: 'ä½ çš„å…³å¿ƒè®©å­©å­å¾ˆæ„ŸåŠ¨ï¼Œå¹¶å‘Šè¯‰äº†ä½ TAçš„â€œå°è®¡åˆ’â€ã€‚' },
            { text: 'ã€æ²¡æ”¶å……å…¬ã€‘è®¤ä¸ºå°å­©ä¸è¯¥æœ‰ç§˜å¯†ã€‚', effects: { favor: -10, virtue: -2 }, log: 'ä½ çš„åšæ³•ä¸¥é‡ä¼¤å®³äº†å­©å­çš„æ„Ÿæƒ…ã€‚' }
        ]}
    ],
    11: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'found_love_letter', title: 'å‘ç°æƒ…ä¹¦', desc: 'ä½ æ‰“æ‰«æˆ¿é—´æ—¶ï¼Œæ— æ„ä¸­å‘ç°äº† {childName} å†™ç»™åˆ«äººçš„æƒ…ä¹¦ã€‚', options: [
            { text: 'ã€å·çœ‹ã€‘å¹¶äº†è§£TAçš„å¿ƒäº‹ã€‚', effects: { wisdom: 2, virtue: -3 }, log: 'ä½ æ»¡è¶³äº†å¥½å¥‡å¿ƒï¼Œä½†ä¹Ÿä¾µçŠ¯äº†å­©å­çš„éšç§ã€‚' },
            { text: 'ã€æ”¾å›åŸå¤„ã€‘å½“åšä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚', effects: { virtue: 2 }, log: 'ä½ é€‰æ‹©äº†å°Šé‡å­©å­ã€‚' },
            { text: 'ã€å½“é¢è¯¢é—®ã€‘å¼€è¯šå¸ƒå…¬åœ°è°ˆä¸€è°ˆã€‚', effects: { favor: 5, charm: 1 }, log: 'ä½ ä¸å­©å­è¿›è¡Œäº†ä¸€æ¬¡å¼€è¯šå¸ƒå…¬çš„è°ˆè¯ã€‚' }
        ]}
    ],
    14: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'helping_poor', title: 'å¸®åŠ©ç©·äºº', desc: 'ä½ çœ‹åˆ° {childName} å°†è‡ªå·±çš„é£Ÿç‰©åˆ†ç»™äº†è·¯è¾¹çš„ä¹ä¸ã€‚', options: [
            { text: 'ã€åŠ ä»¥èµèµã€‘å¹¶ç»™äºˆæ›´å¤šé£Ÿç‰©ã€‚', effects: { virtue: 4, favor: 5 }, log: 'ä½ çš„é¼“åŠ±è®©å­©å­çš„å–„è‰¯å“è´¨å¾—ä»¥æˆé•¿ã€‚' },
            { text: 'ã€é»˜è®¸ã€‘ä½†ä¸å‘è¡¨æ„è§ã€‚', effects: { virtue: 1 }, log: 'ä½ çœ‹åˆ°äº†å­©å­çš„å–„ä¸¾ã€‚' },
            { text: 'ã€å‘Šè¯«TAã€‘ä¸è¦éšä¾¿å’Œé™Œç”Ÿäººè¯´è¯ã€‚', effects: { wisdom: 1, virtue: -1 }, log: 'ä½ çš„å‘Šè¯«è®©å­©å­å­¦ä¼šäº†ä¿æŠ¤è‡ªå·±ï¼Œä½†ä¹Ÿæœ‰äº›å›°æƒ‘ã€‚' }
        ]}
    ],
    10: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'failed_exam', title: 'è€ƒè¯•å¤±åˆ©', desc: 'å­©å­ {childName} è¿™æ¬¡è€ƒè¯•æˆç»©ä¸ç†æƒ³ï¼Œæƒ…ç»ªä½è½ã€‚', options: [
            { text: 'ã€æ¸©è¨€å®‰æ…°ã€‘å¹¶å¸®åŠ©TAåˆ†æåŸå› ã€‚', effects: { favor: 10, wisdom: 2 }, log: 'ä½ çš„å®‰æ…°å’Œå¸®åŠ©è®©å­©å­é‡æ‹¾ä¿¡å¿ƒã€‚' },
            { text: 'ã€ä¸¥å‰æ‰¹è¯„ã€‘è®¤ä¸ºTAä¸å¤ŸåŠªåŠ›ã€‚', effects: { favor: -8, martial: 1 }, log: 'ä½ çš„æ‰¹è¯„è®©å­©å­å‹åŠ›å€å¢ã€‚' },
            { text: 'ã€ç‰©è´¨æ¿€åŠ±ã€‘æ‰¿è¯ºä¸‹æ¬¡è€ƒå¥½æœ‰å¥–åŠ±ã€‚', effects: { charm: 1 }, log: 'ä½ è¯•å›¾ç”¨ç‰©è´¨å¥–åŠ±æ¥æ¿€åŠ±å­©å­ã€‚' }
        ]}
    ],
    13: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'secret_hobby', title: 'ç§˜å¯†çˆ±å¥½', desc: 'ä½ å‘ç° {childName} æœ‰ä¸€ä¸ªç§˜å¯†çˆ±å¥½ï¼ˆä¾‹å¦‚å”±æˆã€æ–—è›è›ï¼‰ï¼Œè¿™åœ¨ä¸–äººçœ‹æ¥æœ‰äº›â€œä¸åŠ¡æ­£ä¸šâ€ã€‚', options: [
            { text: 'ã€å°Šé‡å¹¶æ”¯æŒã€‘TAçš„çˆ±å¥½ã€‚', effects: { talent: 2, favor: 12 }, log: 'ä½ çš„ç†è§£å’Œæ”¯æŒè®©å­©å­éå¸¸æ„ŸåŠ¨ã€‚' },
            { text: 'ã€è¡¨ç¤ºæ‹…å¿§ã€‘ä½†ä¸å¼ºè¡Œç¦æ­¢ã€‚', effects: { favor: 2 }, log: 'ä½ è¡¨è¾¾äº†è‡ªå·±çš„æ‹…å¿§ï¼Œä½†ä»å°Šé‡å­©å­çš„é€‰æ‹©ã€‚' },
            { text: 'ã€å¼ºè¡Œç¦æ­¢ã€‘å¹¶é”€æ¯ç›¸å…³ç‰©å“ã€‚', effects: { favor: -15, virtue: -3 }, log: 'ä½ çš„ç²—æš´åšæ³•åœ¨å­©å­å¿ƒä¸­ç•™ä¸‹äº†æ·±æ·±çš„åˆ›ä¼¤ã€‚' }
        ]}
    ],
    7: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'telling_lie', title: 'ç¬¬ä¸€æ¬¡æ’’è°', desc: '{childName} ä¸ºäº†é€ƒé¿æƒ©ç½šï¼Œå¯¹ä½ æ’’äº†ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„è°ã€‚', options: [
            { text: 'ã€ä¸¥å‰æˆ³ç©¿ã€‘å¹¶åŠ å€æƒ©ç½šã€‚', effects: { etiquette: 2, favor: -5 }, log: 'ä½ è®©å­©å­æ˜ç™½äº†æ’’è°çš„ä¸¥é‡åæœã€‚' },
            { text: 'ã€æ¸©å’Œå¼•å¯¼ã€‘å‘Šè¯‰TAè¯šå®æ›´é‡è¦ã€‚', effects: { virtue: 3, favor: 5 }, log: 'ä½ å¼•å¯¼å­©å­è®¤è¯†åˆ°äº†é”™è¯¯ï¼Œå¹¶ä¸»åŠ¨æ‰¿è®¤ã€‚' },
            { text: 'ã€ä¸åŠ¨å£°è‰²ã€‘çœ‹TAå¦‚ä½•æ”¶åœºã€‚', effects: { wisdom: 2 }, log: 'ä½ å†³å®šè§‚å¯Ÿå­©å­çš„åº”å¯¹æ–¹å¼ï¼Œä»¥æ›´å¥½åœ°äº†è§£TAã€‚' }
        ]}
    ],
    15: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'first_income', title: 'ç¬¬ä¸€ç¬”æ”¶å…¥', desc: '{childName} é€šè¿‡è‡ªå·±çš„åŠªåŠ›ï¼ˆå¦‚æŠ„ä¹¦ã€å¸®å·¥ï¼‰èµšåˆ°äº†ç¬¬ä¸€ç¬”é’±ï¼Œå…´é«˜é‡‡çƒˆåœ°æ‹¿ç»™ä½ çœ‹ã€‚', options: [
            { text: 'ã€ä¸ºTAé«˜å…´ã€‘å¹¶è®©TAè‡ªå·±æ”¯é…ã€‚', effects: { wisdom: 2, favor: 10 }, log: 'ä½ çš„ä¿¡ä»»è®©å­©å­å­¦ä¼šäº†ç†è´¢ã€‚' },
            { text: 'ã€æ›¿TAä¿ç®¡ã€‘è®¤ä¸ºTAä¼šä¹±èŠ±ã€‚', effects: { favor: -5 }, log: 'ä½ å‡ºäºå¥½æ„æ›¿TAä¿ç®¡ï¼Œä½†TAè§‰å¾—ä¸è¢«ä¿¡ä»»ã€‚' },
            { text: 'ã€é¼“åŠ±TAã€‘ç”¨è¿™ç¬”é’±åšäº›æœ‰æ„ä¹‰çš„äº‹ã€‚', effects: { virtue: 2, favor: 5 }, log: 'åœ¨ä½ çš„é¼“åŠ±ä¸‹ï¼Œå­©å­ç”¨è¿™ç¬”é’±åšäº†ä»¶å¥½äº‹ã€‚' }
        ]}
    ],
    17: [ // é¢å¤–è¡¥å…… (è¿™é‡Œæ˜¯æ‚¨åŸæœ‰çš„ï¼Œäºˆä»¥ä¿ç•™)
        { id: 'defending_family', title: 'ç»´æŠ¤å®¶æ—', desc: 'åœ¨å¤–å¬åˆ°æœ‰äººéè®®ä½ çš„å®¶æ—ï¼Œ{childName} æŒºèº«è€Œå‡ºï¼Œä¸å¯¹æ–¹è¾©é©³ã€‚', options: [
            { text: 'ã€å¤§åŠ èµèµã€‘TAçš„å®¶æ—è£èª‰æ„Ÿã€‚', effects: { reputation: 3, virtue: 2, favor: 8 }, log: 'ä½ å¯¹å­©å­çš„è¡Œä¸ºæ„Ÿåˆ°éå¸¸éª„å‚²ã€‚' },
            { text: 'ã€å‘Šè¯«TAã€‘ä¸è¦å†²åŠ¨ï¼Œæ³¨æ„å®‰å…¨ã€‚', effects: { wisdom: 1, favor: 3 }, log: 'ä½ æé†’å­©å­è¦ç”¨æ›´èªæ˜çš„æ–¹å¼ç»´æŠ¤å®¶æ—ã€‚' },
            { text: 'ã€è®¤ä¸ºTAå¤šäº‹ã€‘è®©ä½ æœ‰äº›éš¾å ªã€‚', effects: { favor: -5 }, log: 'ä½ è§‰å¾—å­©å­çš„åšæ³•æœ‰äº›é²è½ã€‚' }
        ]}
    ],
    // ============= æ–°å¢äº‹ä»¶ START ===============
    12: [ // æ–°å¢äº‹ä»¶
        { id: 'family_chore', title: 'åˆ†æ‹…å®¶åŠ¡', desc: 'å­©å­ {childName} ä¸»åŠ¨æå‡ºæƒ³è¦å¸®ä½ åˆ†æ‹…ä¸€äº›å®¶åŠ¡ã€‚', options: [
            { text: 'ã€æ¬£æ…°æ¥å—ã€‘å¹¶æ•™å¯¼TAã€‚', effects: { virtue: 3, favor: 8, health: 1 }, log: '{childName}å­¦ä¼šäº†æ–°çš„ç”Ÿæ´»æŠ€èƒ½ï¼Œå¹¶ä¸ºä½ åˆ†æ‹…äº†è¾›åŠ³ã€‚' },
            { text: 'ã€æ‹’ç»ã€‘è®¤ä¸ºTAåº”ä»¥å­¦ä¸šä¸ºé‡ã€‚', effects: { favor: -3 }, log: 'ä½ çš„æ‹’ç»è®©å­©å­æœ‰äº›å¤±è½ï¼Œè§‰å¾—ä¸è¢«éœ€è¦ã€‚' }
        ]}
    ],
    16: [ // æ–°å¢äº‹ä»¶
        { id: 'future_anxiety', title: 'æœªæ¥çš„è¿·èŒ«', desc: '{childName} å³å°†æˆå¹´ï¼Œå¯¹è‡ªå·±çš„æœªæ¥æ„Ÿåˆ°æœ‰äº›è¿·èŒ«å’Œç„¦è™‘ï¼Œå‰æ¥å¯»æ±‚ä½ çš„å»ºè®®ã€‚', options: [
            { text: 'ã€åˆ†äº«ä½ çš„ç»éªŒã€‘å¹¶é¼“åŠ±TAã€‚', effects: { wisdom: 2, favor: 12 }, log: 'ä½ çš„ç»éªŒä¹‹è°ˆç»™äº†å­©å­è«å¤§çš„é¼“åŠ±å’Œå¯å‘ã€‚' },
            { text: 'ã€å¸¦TAæ‹œè®¿åå£«ã€‘å¼€é˜”çœ¼ç•Œã€‚', effects: { reputation: 2, charm: 2, favor: 8 }, log: 'æ‹œè®¿åå£«åï¼Œå­©å­çœ¼ç•Œå¤§å¼€ï¼Œå¯¹æœªæ¥æœ‰äº†æ›´æ¸…æ™°çš„è§„åˆ’ã€‚' },
            { text: 'ã€è®©TAè‡ªå·±æ‘¸ç´¢ã€‘ã€‚', effects: { favor: -5 }, log: 'ä½ è®¤ä¸ºè¿™æ˜¯æˆé•¿çš„å¿…ç»ä¹‹è·¯ï¼Œä½†å­©å­è§‰å¾—ä½ ä¸å¤Ÿå…³å¿ƒTAã€‚' }
        ]}
    ]
    // ============= æ–°å¢äº‹ä»¶ END =================
};

const childCareerAssignment = {
    male: { 
        "æ–‡å®˜": { req: { wisdom: 60, virtue: 50 }, path: 'civilian' }, 
        "æ­¦å°†": { req: { health: 60, martial: 50 }, path: 'warrior' }, 
        "å•†è´¾": { req: { wisdom: 70 }, path: 'merchant' }, 
        "æ–‡äººå¢¨å®¢": { req: { talent: 70, charm: 60 }, path: 'scholar' },
        "æ±Ÿæ¹–æ¸¸ä¾ ": { req: { health: 50, martial: 60 }, path: 'ranger' },
        "å¾…ä¸š": { req: {}, path: 'unemployed' } 
    },
    female: { 
        "ä¸»æ¯": { req: { etiquette: 70, virtue: 60 }, path: 'matron' }, 
        "ç»£å¨˜": { req: { talent: 70 }, path: 'embroiderer' }, 
        "å¥³åŒ»": { req: { wisdom: 60, virtue: 50 }, path: 'doctor' }, 
        "æƒ…æŠ¥é¦–é¢†": { req: { wisdom: 70, charm: 60 }, path: 'spy_master' },
        "å¾…ä¸š": { req: {}, path: 'unemployed' } 
    }
};
// --- DATA: Merchant Guild & Farming ---
// ===================== ã€æ–°åŠŸèƒ½ã€‘å•†ä¼šç‰¹æ®Šäº‹ä»¶åº“ =====================

// ===================== ã€è¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢ã€‘ =====================
const FARMING_EVENTS = [
    // æ‚¨åŸæœ‰çš„7ä¸ªæ­£é¢äº‹ä»¶
    { title: 'å¤©é™ç”˜éœ–', type: 'positive', desc: 'ä»Šå¹´é›¨æ°´å……æ²›ï¼Œä½ çš„ç”°åœ°é•¿åŠ¿å–œäººï¼Œé¢„è®¡å°†è¿æ¥å¤§ä¸°æ”¶ï¼', options: [
        { text: 'è¿½åŠ æŠ•èµ„ï¼Œè´­ä¹°è‚¥æ–™ã€‚', req: { wisdom: 30 }, outcome: { text: 'ç²¾å¿ƒçš„ç…§æ–™è®©æ”¶æˆè¿œè¶…é¢„æœŸï¼', effects: { multiplier: 1.5, cost: 200 } } },
        { text: 'ä¿æŒç°çŠ¶ï¼Œé¡ºå…¶è‡ªç„¶ã€‚', req: {}, outcome: { text: 'ä½ è·å¾—äº†ä¸€æ¬¡ä¸é”™çš„ä¸°æ”¶ã€‚', effects: { multiplier: 1.2, cost: 0 } } },
        { text: 'æå‰è”ç³»å•†è·¯ï¼Œå‡†å¤‡å¤–é”€ã€‚', req: { charm: 40 }, outcome: { text: 'ä½ æå‰é”å®šäº†ä¹°å®¶ï¼Œä»¥é«˜ä»·å–å‡ºäº†æ‰€æœ‰æ”¶æˆï¼', effects: { multiplier: 1.4, cost: 50 } } }
    ]},
    { title: 'å‘ç°è‰¯ç§', type: 'positive', desc: 'ä¸€ä½äº‘æ¸¸çš„è€å†œç»™äº†ä½ ä¸€äº›æ”¹è‰¯è¿‡çš„ç§å­ï¼Œæ®è¯´äº§é‡æ›´é«˜ã€‚', options: [
        { text: 'ã€èŠ±è´¹500ä¸¤ã€‘å…¨éƒ¨æ¢ç”¨è‰¯ç§ã€‚', req: { wealth: 500 }, outcome: { text: 'è€å†œæ‰€è¨€éè™šï¼ä½ çš„äº§é‡æš´å¢ï¼', effects: { multiplier: 1.6, cost: 500 } } },
        { text: 'ã€å°èŒƒå›´è¯•ç§ã€‘ã€‚', req: {}, outcome: { text: 'è¯•ç§çš„ç”°åœ°æ”¶æˆå–œäººï¼Œä½ å†³å®šæ˜å¹´å†å¤§è§„æ¨¡æ¨å¹¿ã€‚', effects: { multiplier: 1.1, cost: 0 } } },
        { text: 'ã€å¿ƒå­˜ç–‘è™‘ã€‘ä¸æ•¢ä½¿ç”¨ã€‚', req: { wisdom: 50 }, outcome: { text: 'ä½ é”™è¿‡äº†è¿™æ¬¡æœºä¼šï¼Œæ”¶æˆä¸å¾€å¹´æ— å¼‚ã€‚', effects: { multiplier: 1.0, cost: 0 } } }
    ]},
    { title: 'è´µäººå·¡è§†', type: 'positive', desc: 'ä¸€ä½å¾®æœç§è®¿çš„è´µäººè·¯è¿‡ä½ çš„ç”°åº„ï¼Œå¯¹ä½ äº•äº•æœ‰æ¡çš„å†œäº‹ç®¡ç†å¤§åŠ èµèµã€‚', options: [
        { text: 'ã€ç››æƒ…æ¬¾å¾…ã€‘ã€‚', req: { etiquette: 50 }, outcome: { text: 'è´µäººååˆ†é«˜å…´ï¼Œèµèµäº†ä½ ä¸€ç¬”é’±ã€‚', effects: { wealth: 1000, reputation: 5 } } },
        { text: 'ã€å€Ÿæœºè¯·æ•™ã€‘å†œæ¡‘æ”¿ç­–ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ ç‹¬åˆ°çš„è§è§£è®©è´µäººåˆ®ç›®ç›¸çœ‹ï¼Œå¹¶ä¸ºä½ æä¾›äº†ä¸€äº›æ”¿ç­–ä¾¿åˆ©ã€‚', effects: { multiplier: 1.2, reputation: 10 } } },
        { text: 'ã€ä¸å‘ä¸äº¢ã€‘ï¼Œæ­£å¸¸æ¥å¾…ã€‚', req: {}, outcome: { text: 'è´µäººå¯¹ä½ çš„æ²‰ç¨³è¡¨ç¤ºæ¬£èµã€‚', effects: { reputation: 2 } } }
    ]},
    { title: 'å†œå…·é©æ–°', type: 'positive', desc: 'ä½ æ‰‹ä¸‹çš„ä¸€ä¸ªå·§æ‰‹å†œæˆ·æ”¹è‰¯äº†æ›²è¾•çŠï¼Œè€•ä½œæ•ˆç‡å¤§å¤§æå‡ã€‚', options: [
        { text: 'ã€é‡èµå†œæˆ·ã€‘å¹¶æ¨å¹¿æ–°çŠã€‚', req: { virtue: 40 }, outcome: { text: 'å†œæˆ·ä»¬æ„Ÿæ¿€ä½ çš„ä»å¾·ï¼Œå¹²åŠ²åè¶³ï¼Œæ”¶æˆå¤§å¢ã€‚', effects: { multiplier: 1.3, cost: 300, virtue: 5 } } },
        { text: 'ã€ä¹°æ–­æŠ€æœ¯ã€‘æ®ä¸ºå·±æœ‰ã€‚', req: {}, outcome: { text: 'ä½ ç‹¬å äº†æ–°æŠ€æœ¯ï¼Œæ”¶æˆå¢åŠ ï¼Œä½†å¤±å»äº†äººå¿ƒã€‚', effects: { multiplier: 1.25, virtue: -3 } } },
        { text: 'ã€ç”³è¯·ä¸“åˆ©ã€‘ä¸å®˜åºœåˆä½œæ¨å¹¿ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ çš„é•¿è¿œçœ¼å…‰è·å¾—äº†å®˜åºœçš„èµè¯†ï¼Œä¸ä»…è·å¾—å¥–åŠ±ï¼Œè¿˜æå‡äº†å£°æœ›ã€‚', effects: { wealth: 500, reputation: 15 } } }
    ]},
    { title: 'åœŸåœ°è‚¥åŠ›æ¢å¤', type: 'positive', desc: 'ä½ é‡‡ç”¨äº†æ–°çš„ä¼‘è€•æ–¹æ³•ï¼Œä»Šå¹´åœŸåœ°çš„è‚¥åŠ›æƒŠäººåœ°å¥½ã€‚', options: [
        { text: 'ã€ç§æ¤é«˜äº§ä½œç‰©ã€‘ã€‚', req: {}, outcome: { text: 'è‚¥æ²ƒçš„åœŸåœ°å¸¦æ¥äº†æƒŠäººçš„äº§é‡ï¼', effects: { multiplier: 1.4 } } },
        { text: 'ã€ç§æ¤ç»æµä½œç‰©ã€‘ã€‚', req: { wisdom: 50 }, outcome: { text: 'ä½ ç§å‡ºçš„ç»æµä½œç‰©å“è´¨ä¸Šä¹˜ï¼Œå–å‡ºäº†é«˜ä»·ã€‚', effects: { multiplier: 1.35 } } },
        { text: 'ã€å‡ºç§Ÿéƒ¨åˆ†åœŸåœ°ã€‘ã€‚', req: {}, outcome: { text: 'ä½ å°†éƒ¨åˆ†åœŸåœ°å‡ºç§Ÿï¼Œè·å¾—äº†ä¸€ç¬”ç¨³å®šçš„ç§Ÿé‡‘ã€‚', effects: { wealth: 800 } } }
    ]},
    { title: 'å¸‚åœºéœ€æ±‚æ—ºç››', type: 'positive', desc: 'å› é‚»è¿‘å·åºœæ­‰æ”¶ï¼Œäº¬åŸå¯¹ç²®é£Ÿçš„éœ€æ±‚å¤§å¢ï¼Œç²®ä»·é£æ¶¨ã€‚', options: [
        { text: 'ã€æŠ“ä½æ—¶æœºã€‘å…¨éƒ¨å‡ºå”®ã€‚', req: {}, outcome: { text: 'ä½ å¤§èµšäº†ä¸€ç¬”ï¼', effects: { multiplier: 1.8 } } },
        { text: 'ã€å›¤ç§¯å±…å¥‡ã€‘ç­‰å¾…æ›´é«˜ä»·æ ¼ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ çš„èƒ†è¯†è·å¾—äº†å›æŠ¥ï¼Œä»·æ ¼åˆæ¶¨äº†ä¸€æˆï¼', effects: { multiplier: 2.0, virtue: -5 } } },
        { text: 'ã€å¹³ä»·å‡ºå”®ã€‘ç»™ç™¾å§“ï¼Œèµšå–å£°æœ›ã€‚', req: { virtue: 60 }, outcome: { text: 'ä½ çš„å–„ä¸¾è¢«ä¼ ä¸ºä½³è¯ï¼Œè·å¾—äº†ç™¾å§“çš„çˆ±æˆ´ã€‚', effects: { multiplier: 1.1, reputation: 20, virtue: 10 } } }
    ]},
    { title: 'ç¥¥ç‘ä¹‹å…†', type: 'positive', desc: 'ä½ çš„ç”°é‡Œç«Ÿç„¶é•¿å‡ºäº†ä¸€æ ªå¹¶è’‚è²/çµèŠï¼Œè¢«è®¤ä¸ºæ˜¯ç¥¥ç‘ä¹‹å…†ã€‚', options: [
        { text: 'ã€çŒ®ç»™å®˜åºœã€‘ã€‚', req: {}, outcome: { text: 'å®˜åºœå¤§å–œï¼Œèµèµäº†ä½ å¹¶æå‡äº†ä½ çš„å£°æœ›ã€‚', effects: { wealth: 1200, reputation: 10 } } },
        { text: 'ã€é«˜ä»·å‡ºå”®ã€‘ç»™å¯Œå•†ã€‚', req: {}, outcome: { text: 'ä½ å°†ç¥¥ç‘å–å‡ºäº†ä¸€ä¸ªå¥½ä»·é’±ã€‚', effects: { wealth: 2000 } } },
        { text: 'ã€è‡ªå·±ä¿ç•™ã€‘å¸Œæœ›å¸¦æ¥å¥½è¿ã€‚', req: {}, outcome: { text: 'ä½ ä¿ç•™äº†ç¥¥ç‘ï¼Œæ„Ÿè§‰æœªæ¥ä¸€å¹´çš„è¿æ°”éƒ½ä¼šå¾ˆå¥½ã€‚', effects: { luck_boost: 1 } } }
    ]},
    // æ‚¨åŸæœ‰çš„8ä¸ªè´Ÿé¢äº‹ä»¶
    { title: 'è—ç¾æ¥è¢­', type: 'negative', desc: 'é®å¤©è”½æ—¥çš„è—è™«å‘ä½ çš„ç”°åœ°è¢­æ¥ï¼', options: [
        { text: 'ã€èŠ±è´¹å·¨èµ„ã€‘é›‡äººæ•è—ã€‚', req: { wealth: 800 }, outcome: { text: 'è™½ç„¶èŠ±è´¹å·¨å¤§ï¼Œä½†ä½ ä¿ä½äº†å¤§éƒ¨åˆ†æ”¶æˆã€‚', effects: { multiplier: 0.8, cost: 800 } } },
        { text: 'ã€å¬å¤©ç”±å‘½ã€‘ç¥ˆæ±‚ç¥æ˜ä¿ä½‘ã€‚', req: {}, outcome: { text: 'ä½ çš„ç”°åœ°æŸå¤±æƒ¨é‡ï¼Œå‡ ä¹é¢—ç²’æ— æ”¶ã€‚', effects: { multiplier: 0.1, cost: 0 } } },
        { text: 'ã€ä½¿ç”¨åæ–¹ã€‘ä»¥çƒŸç†é©±èµ¶ã€‚', req: { wisdom: 40 }, outcome: { text: 'åæ–¹æœ‰ä¸€å®šæ•ˆæœï¼Œä½†ä»æœ‰ä¸å°çš„æŸå¤±ã€‚', effects: { multiplier: 0.5, cost: 100 } } }
    ]},
    { title: 'é­é‡æ—±ç¾', type: 'negative', desc: 'è¿ç»­æ•°æœˆæœªä¸‹é›¨ï¼ŒåœŸåœ°å¹²è£‚ï¼Œä½œç‰©æ¯é»„ã€‚', options: [
        { text: 'ã€é‡é‡‘é›‡äººã€‘ä»è¿œå¤„è¿æ°´çŒæº‰ã€‚', req: { wealth: 1000 }, outcome: { text: 'é«˜æ˜‚çš„æˆæœ¬è®©ä½ å‡ ä¹æ²¡æœ‰åˆ©æ¶¦ï¼Œä½†æ€»ç®—ä¿ä½äº†æ”¶æˆã€‚', effects: { multiplier: 0.9, cost: 1000 } } },
        { text: 'ã€å‘é¾™ç‹åº™ã€‘æ±‚é›¨ã€‚', req: {}, outcome: { text: 'æ±‚é›¨å¹¶æœªæˆåŠŸï¼Œä½ çš„ä½œç‰©å¤§éƒ¨åˆ†éƒ½æ¯æ­»äº†ã€‚', effects: { multiplier: 0.2, cost: 50 } } },
        { text: 'ã€å˜å–éƒ¨åˆ†åœŸåœ°ã€‘æ¢å–èµ„é‡‘ä¿ä½æ ¸å¿ƒç”°äº§ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ å£®å£«æ–­è…•ï¼Œä¿ä½äº†æœ€é‡è¦çš„ç”°åœ°ï¼Œä½†æŸå¤±äº†ä¸€éƒ¨åˆ†äº§ä¸šã€‚', effects: { multiplier: 0.8, land_loss: 1 } } }
    ]},
    { title: 'æ¶éœ¸è§Šè§', type: 'negative', desc: 'é™„è¿‘çš„åœ°ä¸»æ¶éœ¸çœ‹ä¸Šäº†ä½ çš„è‰¯ç”°ï¼Œæ´¾äººå‰æ¥æ»‹äº‹ï¼Œé˜»æŒ è€•ä½œã€‚', options: [
        { text: 'ã€æŠ¥å®˜å¤„ç†ã€‘ã€‚', req: {}, outcome: { text: 'å®˜åºœæ•·è¡äº†äº‹ï¼Œé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œè¿˜è€½è¯¯äº†å†œæ—¶ã€‚', effects: { multiplier: 0.7, cost: 100 } } },
        { text: 'ã€é›‡ä½£æŠ¤é™¢ã€‘æ­¦åŠ›å¯¹æŠ—ã€‚', req: { wealth: 500 }, outcome: { text: 'ä½ æˆåŠŸèµ¶èµ°äº†æ¶éœ¸ï¼Œä½†åŒæ–¹ç»“ä¸‹äº†æ¢å­ã€‚', effects: { multiplier: 0.9, cost: 500 } } },
        { text: 'ã€æ‰˜å…³ç³»ã€‘è¯·ä¸€ä½ä¹¡ç»…å‡ºé¢è°ƒè§£ã€‚', req: { charm: 60 }, outcome: { text: 'ä½ èŠ±è´¹äººæƒ…å’Œé‡‘é’±ï¼Œæš‚æ—¶å¹³æ¯äº†äº‹ç«¯ã€‚', effects: { multiplier: 0.85, cost: 300 } } }
    ]},
    { title: 'å†œæˆ·ç”Ÿå˜', type: 'negative', desc: 'ä½ æ‰‹ä¸‹çš„å†œæˆ·ä»¬å› å·¥é’±é—®é¢˜é›†ä½“æ€ å·¥ï¼Œå¨èƒè¦ç¦»å¼€ã€‚', options: [
        { text: 'ã€å¼ºç¡¬é•‡å‹ã€‘å¹¶å¦å¯»å†œæˆ·ã€‚', req: {}, outcome: { text: 'ä½ çš„å¼ºç¡¬å¯¼è‡´å†œæˆ·å…¨éƒ¨ç¦»å¼€ï¼Œæ–°æ‰¾çš„äººä¸ç†Ÿæ‚‰ç”°åœ°ï¼Œæ”¶æˆå¤§å‡ã€‚', effects: { multiplier: 0.4, virtue: -5 } } },
        { text: 'ã€æ‰¿è¯ºåŠ è–ªã€‘å®‰æŠšäººå¿ƒã€‚', req: { wealth: 400 }, outcome: { text: 'ä½ å¢åŠ äº†æ”¯å‡ºï¼Œç¨³ä½äº†å†œæˆ·ï¼Œä½†åˆ©æ¶¦é™ä½äº†ã€‚', effects: { multiplier: 0.8, cost: 400 } } },
        { text: 'ã€ç”»å¤§é¥¼ã€‘æ‰¿è¯ºä¸°æ”¶åæœ‰é‡èµã€‚', req: { charm: 70 }, outcome: { text: 'ä½ æˆåŠŸè¯´æœäº†å†œæˆ·ï¼Œä½†å¦‚æœå¹´åº•æ— æ³•å…‘ç°ï¼Œä½ çš„ä¿¡èª‰å°†ç ´äº§ã€‚', effects: { multiplier: 0.9, reputation_risk: 1 } } }
    ]},
    { title: 'ç”°å¥‘çº çº·', type: 'negative', desc: 'æœ‰äººæ‹¿ç€ä¸€å¼ æ—§åœ°å¥‘æ‰¾ä¸Šé—¨æ¥ï¼Œå£°ç§°è¿™ç‰‡åœŸåœ°æ˜¯ä»–ä»¬å®¶çš„ï¼Œè¦æ±‚ä½ å½’è¿˜ã€‚', options: [
        { text: 'ã€å¯¹ç°¿å…¬å ‚ã€‘ã€‚', req: {}, outcome: { text: 'æ¼«é•¿çš„å®˜å¸è€—è´¹äº†ä½ å¤§é‡é‡‘é’±å’Œç²¾åŠ›ï¼Œæ— è®ºè¾“èµ¢éƒ½å½±å“äº†æ”¶æˆã€‚', effects: { multiplier: 0.6, cost: 600 } } },
        { text: 'ã€ç ´è´¢æ¶ˆç¾ã€‘ç»™å¯¹æ–¹ä¸€ç¬”é’±äº†äº‹ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ èŠ±é’±ä¹°äº†ä¸ªæ¸…é™ã€‚', effects: { cost: 1000 } } },
        { text: 'ã€æš—ä¸­è°ƒæŸ¥ã€‘å¯¹æ–¹çš„åº•ç»†ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ å‘ç°å¯¹æ–¹æ˜¯èŒä¸šéª—å­ï¼ŒæˆåŠŸæ­ç©¿äº†ä»–ä»¬ï¼', effects: { reputation: 5, wisdom: 2 } } }
    ]},
    { title: 'è«åç˜Ÿç—…', type: 'negative', desc: 'ä½ çš„ç”°é‡Œçˆ†å‘äº†ä¸€åœºå¥‡æ€ªçš„æ¤ç‰©ç˜Ÿç—…ï¼Œè¿…é€Ÿè”“å»¶ã€‚', options: [
        { text: 'ã€è¯·æ•™è€å†œã€‘ä½¿ç”¨åœŸæ–¹ã€‚', req: {}, outcome: { text: 'åœŸæ–¹æ•ˆæœæœ‰é™ï¼ŒæŸå¤±ä¾ç„¶ä¸å°ã€‚', effects: { multiplier: 0.6 } } },
        { text: 'ã€å¿ç—›ç„šçƒ§ã€‘ç—…æ ªï¼Œé˜²æ­¢è”“å»¶ã€‚', req: { virtue: 30 }, outcome: { text: 'ä½ æœæ–­çš„å†³å®šä¿ä½äº†å¤§éƒ¨åˆ†ç”°åœ°ï¼Œä½†çƒ§æ¯çš„éƒ¨åˆ†é¢—ç²’æ— æ”¶ã€‚', effects: { multiplier: 0.7 } } },
        { text: 'ã€å¯»è®¿ååŒ»ã€‘é…ç½®è¯æ°´ã€‚', req: { wealth: 600 }, outcome: { text: 'æ˜‚è´µçš„è¯æ°´æ§åˆ¶ä½äº†ç—…æƒ…ï¼Œä½†æˆæœ¬é«˜æ˜‚ã€‚', effects: { multiplier: 0.8, cost: 600 } } }
    ]},
    { title: 'å®˜åºœåŠ ç¨', type: 'negative', desc: 'æœå»·è´¢æ”¿ç´§å¼ ï¼Œçªç„¶å®£å¸ƒåŠ å¾å†œä¸šç¨ã€‚', options: [
        { text: 'ã€è¶³é¢ç¼´çº³ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ç¼´çº³äº†é¢å¤–çš„ç¨æ¬¾ï¼Œåˆ©æ¶¦å¤§å¹…å‡å°‘ã€‚', effects: { multiplier: 0.75 } } },
        { text: 'ã€è¯•å›¾ç’æŠ¥ã€‘éƒ¨åˆ†ç”°äº§ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ ä¾¥å¹¸æˆåŠŸï¼Œä½†ä¸€æ—¦è¢«å‘ç°å°†é¢ä¸´é‡ç½šã€‚', effects: { multiplier: 0.9, risk: 'heavy_fine' } } },
        { text: 'ã€è”ç»œä¹¡ç»…ã€‘å…±åŒå‘å®˜åºœè¯·æ„¿ã€‚', req: { charm: 70 }, outcome: { text: 'ä½ ä»¬çš„è¯·æ„¿æœ‰äº†ä¸€å®šæ•ˆæœï¼Œç¨ç‡ç•¥æœ‰ä¸‹è°ƒã€‚', effects: { multiplier: 0.85, reputation: 5 } } }
    ]},
    { title: 'ä»“åº“å¤±ç«', type: 'negative', desc: 'å­˜æ”¾ç§å­çš„ä»“åº“æ„å¤–å¤±ç«ï¼Œå¤§é‡å‚¨å¤‡è¢«çƒ§æ¯ã€‚', options: [
        { text: 'ã€ç´§æ€¥é«˜ä»·ã€‘ä»å¸‚åœºè´­å…¥ç§å­ã€‚', req: {}, outcome: { text: 'ä½ ä¸å¾—ä¸é«˜ä»·ä¹°å…¥ç§å­ï¼Œä¸¥é‡å½±å“äº†æœ¬å­£çš„åˆ©æ¶¦ã€‚', effects: { multiplier: 0.8, cost: 500 } } },
        { text: 'ã€å‡å°‘æ’­ç§ã€‘é¢ç§¯ã€‚', req: {}, outcome: { text: 'ä½ è¢«è¿«å‡å°‘äº†æ’­ç§é¢ç§¯ï¼Œæœ¬å­£æ”¶æˆæ³¨å®šæƒ¨æ·¡ã€‚', effects: { multiplier: 0.5 } } },
        { text: 'ã€å‘é‚»é‡Œã€‘æ±‚åŠ©å€Ÿç§ã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ çš„å¥½äººç¼˜è®©ä½ å€Ÿåˆ°äº†ç§å­ï¼Œä½†æ¬ ä¸‹äº†äººæƒ…ã€‚', effects: { multiplier: 0.9, reputation: -5 } } }
    ]},
    // â–¼â–¼â–¼ ã€æ–°å¢20ä¸ªå†œäº‹ç»è¥äº‹ä»¶ã€‘ â–¼â–¼â–¼
    // --- 10ä¸ªæ­£é¢äº‹ä»¶ ---
    { title: 'å‘ç°æ¸©æ³‰', type: 'positive', desc: 'ä½ åœ¨å·¡è§†ç”°äº§æ—¶ï¼Œæ„å¤–å‘ç°ä¸€å¤„åœ°ä¸‹æ¸©æ³‰çœ¼ï¼', options: [
        { text: 'ã€å¼•æµçŒæº‰ã€‘ã€‚', req: {}, outcome: { text: 'æ¸©æ³‰æ°´å¯Œå«çŸ¿ç‰©ï¼Œä½ çš„ä½œç‰©é•¿åŠ¿å–œäººï¼Œå“è´¨æå‡ã€‚', effects: { multiplier: 1.35 } } },
        { text: 'ã€ä¿®å»ºåˆ«é™¢ã€‘ã€‚', req: { wealth: 2000 }, outcome: { text: 'ä½ ä¿®å»ºäº†æ¸©æ³‰åˆ«é™¢ï¼Œæˆäº†äº¬ä¸­æƒè´µä»¬ä¼‘é—²çš„å¥½å»å¤„ï¼Œä¸ºä½ å¸¦æ¥äº†é¢å¤–æ”¶å…¥å’Œäººè„‰ã€‚', effects: { cost: 2000, wealth: 2500, reputation: 10 } } }
    ]},
    { title: 'èƒ½å¹²çš„é•¿å·¥', type: 'positive', desc: 'ä½ æ‰‹ä¸‹ä¸€ä½æ–°æ¥çš„é•¿å·¥ä¸ä»…æ‰‹è„šéº»åˆ©ï¼Œè¿˜æ‡‚ä¸€äº›æ”¹è‰¯å†œå…·çš„å·§æ€ã€‚', options: [
        { text: 'ã€ææ‹”ä¸ºç®¡äº‹ã€‘ã€‚', req: { charm: 50 }, outcome: { text: 'ä½ çš„çŸ¥äººå–„ä»»è®©è¿™ä½é•¿å·¥æ„Ÿæ¿€æ¶•é›¶ï¼Œåœ¨ä»–çš„ç®¡ç†ä¸‹ï¼Œå†œåº„æ•ˆç‡å¤§å¢ã€‚', effects: { multiplier: 1.2, virtue: 3 } } },
        { text: 'ã€ç»™äºˆé‡èµã€‘ã€‚', req: { wealth: 300 }, outcome: { text: 'ä½ èµèµäº†300ä¸¤ï¼Œæ¿€åŠ±äº†ä»–ç»§ç»­åˆ›æ–°ã€‚', effects: { cost: 300, multiplier: 1.1 } } }
    ]},
    { title: 'å¼‚åŸŸå¥‡ç', type: 'positive', desc: 'ä¸€ä½è¥¿åŸŸå•†äººå‘ä½ å…œå”®ä¸€ç§åä¸ºâ€œç•ªèŒ„â€çš„å¥‡ç‰¹ä½œç‰©ç§å­ï¼Œå£°ç§°å…¶å‘³ç¾ä¸”é«˜äº§ã€‚', options: [
        { text: 'ã€æ–¥å·¨èµ„è´­å…¥å¹¶è¯•ç§ã€‘ã€‚', req: { wealth: 600 }, outcome: { text: 'ä½ çš„å†’é™©å¾—åˆ°äº†å›æŠ¥ï¼ç•ªèŒ„åœ¨äº¬åŸå¤§å—æ¬¢è¿ï¼Œä½ ç‹¬å äº†å¸‚åœºï¼', effects: { multiplier: 1.5, cost: 600, reputation: 5 } } },
        { text: 'ã€è®¤ä¸ºæ˜¯å¥‡æŠ€æ·«å·§ã€‘ã€‚', req: {}, outcome: { text: 'ä½ æ‹’ç»äº†å•†äººï¼Œé”™å¤±äº†ä¸€æ¬¡å¼•é¢†æ½®æµçš„æœºä¼šã€‚', effects: {} } }
    ]},
    { title: 'å¯ºåº™ç¥ˆç¦', type: 'positive', desc: 'é™„è¿‘çš„å¯ºåº™ä¸¾åŠç¥ˆç¦æ³•ä¼šï¼Œä¸ºå‘¨è¾¹çš„ç”°åœ°ç¥ˆæ±‚é£è°ƒé›¨é¡ºã€‚', options: [
        { text: 'ã€æèµ é¦™ç«é’±ã€‘ã€‚', req: { wealth: 400 }, outcome: { text: 'ä½ çš„è™”è¯šä¼¼ä¹çœŸçš„æ„ŸåŠ¨äº†ä¸Šå¤©ï¼Œä»Šå¹´ä½ çš„ç”°åœ°æ— ç¾æ— ç—…ã€‚', effects: { cost: 400, multiplier: 1.25, virtue: 5 } } },
        { text: 'ã€ä¸ä¿¡é¬¼ç¥ã€‘ã€‚', req: {}, outcome: { text: 'ä½ å¯¹æ­¤ä¸å±‘ä¸€é¡¾ï¼Œæ”¶æˆä¸å¾€å¹´æ— å¼‚ã€‚', effects: { multiplier: 1.0 } } }
    ]},
    { title: 'çš‡å®¶é‡‡è´­', type: 'positive', desc: 'ä½ çš„å†œäº§å“å“è´¨å‡ºä¼—ï¼Œè¢«å†…åŠ¡åºœé€‰ä¸­ï¼Œä½œä¸ºè´¡å“é€å…¥å®«ä¸­ã€‚', options: [
        { text: 'ã€æ¬£ç„¶æ¥å—ã€‘ã€‚', req: {}, outcome: { text: 'æˆä¸ºâ€œçš‡å•†â€è®©ä½ çš„å£°æœ›å¤§å¢ï¼Œäº§å“ä»·æ ¼ä¹Ÿæ°´æ¶¨èˆ¹é«˜ã€‚', effects: { multiplier: 1.4, reputation: 25 } } }
    ]},
    { title: 'å†œå­¦è‘—ä½œ', type: 'positive', desc: 'ä½ åœ¨æ—§ä¹¦æ‘Šæ·˜åˆ°ä¸€æœ¬å‰æœçš„å†œå­¦è‘—ä½œï¼Œé‡Œé¢è®°è½½äº†è®¸å¤šå…ˆè¿›çš„è€•ä½œæŠ€å·§ã€‚', options: [
        { text: 'ã€æ½œå¿ƒç ”è¯»å¹¶åº”ç”¨ã€‘ã€‚', req: { wisdom: 60 }, outcome: { text: 'ç§‘å­¦ç§ç”°æ•ˆæœæ˜¾è‘—ï¼Œä½ çš„æ”¶æˆè¿œè¶…æ—äººã€‚', effects: { multiplier: 1.45, wisdom: 5 } } },
        { text: 'ã€æŸä¹‹é«˜é˜ã€‘ã€‚', req: {}, outcome: { text: 'ä½ å°†ä¹¦æœ¬æŸä¹‹é«˜é˜ï¼Œé”™è¿‡äº†å®è´µçš„çŸ¥è¯†ã€‚', effects: {} } }
    ]},
    { title: 'é‚»é‡Œäº’åŠ©', type: 'positive', desc: 'é‚»è¿‘çš„ç”°ä¸»é‡åˆ°äº†å›°éš¾ï¼Œå‘ä½ æ±‚åŠ©ã€‚', options: [
        { text: 'ã€æ…·æ…¨ç›¸åŠ©ã€‘ã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ çš„å–„ä¸¾è®©ä½ åœ¨ä¹¡é‚»ä¸­å¤‡å—å°Šæ•¬ï¼Œæ¥å¹´ä»–ä»¬ä¹Ÿä¸ºä½ æä¾›äº†å¸®åŠ©ã€‚', effects: { virtue: 8, reputation: 5, future_favor: 1 } } },
        { text: 'ã€å©‰è¨€è°¢ç»ã€‘ã€‚', req: {}, outcome: { text: 'ä½ æ‹’ç»äº†é‚»å±…ï¼Œä½ ä»¬çš„å…³ç³»å˜å¾—å†·æ·¡ã€‚', effects: { virtue: -2 } } }
    ]},
    { title: 'ä¸°æ”¶åº†å…¸', type: 'positive', desc: 'ä½ çš„ç”°åº„ä»Šå¹´å¤§ä¸°æ”¶ï¼Œå†œæˆ·ä»¬æè®®ä¸¾åŠä¸€åœºåº†å…¸ã€‚', options: [
        { text: 'ã€åŒæ„å¹¶å‡ºèµ„ã€‘ã€‚', req: { wealth: 500 }, outcome: { text: 'ä¸€åœºçƒ­é—¹çš„åº†å…¸è®©å†œæˆ·ä»¬å£«æ°”é«˜æ¶¨ï¼Œå¯¹ä½ æ›´åŠ å¿ è¯šã€‚', effects: { cost: 500, loyalty_boost: 2 } } },
        { text: 'ã€è®¤ä¸ºé“ºå¼ æµªè´¹ã€‘ã€‚', req: {}, outcome: { text: 'ä½ æ‹’ç»äº†æè®®ï¼Œå†œæˆ·ä»¬æœ‰äº›å¤±æœ›ã€‚', effects: { loyalty_boost: -1 } } }
    ]},
    { title: 'æ°´åˆ©å·¥ç¨‹', type: 'positive', desc: 'å®˜åºœåœ¨ä½ ç”°åº„é™„è¿‘å…´ä¿®æ°´åˆ©ï¼Œä½ çš„ç”°åœ°ä¹Ÿå› æ­¤å—ç›Šã€‚', options: [
        { text: 'ã€æèµ„æ”¯æŒã€‘ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ çš„æåŠ©è·å¾—äº†å®˜åºœçš„è¡¨å½°ï¼Œå¹¶ä¸”çŒæº‰æ›´åŠ ä¾¿åˆ©ï¼Œæ”¶æˆå¤§å¢ã€‚', effects: { cost: 1000, multiplier: 1.3, reputation: 10 } } },
        { text: 'ã€åäº«å…¶æˆã€‘ã€‚', req: {}, outcome: { text: 'ä½ äº«å—äº†æ°´åˆ©å¸¦æ¥çš„ä¾¿åˆ©ï¼Œæ”¶æˆæœ‰æ‰€å¢åŠ ã€‚', effects: { multiplier: 1.15 } } }
    ]},
    { title: 'ç”Ÿæ€å¹³è¡¡', type: 'positive', desc: 'ä½ å‘ç°ç”°é‡Œæ¥äº†å¾ˆå¤šç›Šé¸Ÿï¼Œåƒæ‰äº†å®³è™«ã€‚', options: [
        { text: 'ã€ä¸ºç›Šé¸Ÿã€‘æ­å»ºå·¢ç©´ã€‚', req: {}, outcome: { text: 'ä½ çš„ä¸¾åŠ¨å¸å¼•äº†æ›´å¤šç›Šé¸Ÿï¼Œä»Šå¹´çš„è™«å®³å¤§å¤§å‡å°‘ã€‚', effects: { multiplier: 1.2 } } }
    ]},
    // --- 10ä¸ªè´Ÿé¢äº‹ä»¶ ---
    { title: 'æ´ªæ°´æ³›æ»¥', type: 'negative', desc: 'è¿æ—¥æš´é›¨å¯¼è‡´æ²³æ°´æ³›æ»¥ï¼Œæ·¹æ²¡äº†ä½ çš„ä¸€éƒ¨åˆ†ç”°åœ°ï¼', options: [
        { text: 'ã€ç»„ç»‡äººæ‰‹ã€‘åŠ å›ºå ¤åã€‚', req: {}, outcome: { text: 'ä½ ä»¬çš„åŠªåŠ›ä¿ä½äº†ä¸€åŠçš„ç”°åœ°ï¼Œä½†æŸå¤±ä¾ç„¶æƒ¨é‡ã€‚', effects: { multiplier: 0.5 } } },
        { text: 'ã€è¯·æ±‚å®˜åºœã€‘æ•‘æ´ã€‚', req: { charm: 50 }, outcome: { text: 'å®˜åºœçš„æ•‘æ´æ¥å¾—æœ‰äº›æ™šï¼Œåªä¿ä½äº†å°éƒ¨åˆ†æ”¶æˆã€‚', effects: { multiplier: 0.3 } } }
    ]},
    { title: 'ç½•è§éœœå†»', type: 'negative', desc: 'æ˜¥å­£çš„ä¸€åœºå€’æ˜¥å¯’ï¼Œéœœå†»æ¯åäº†åˆšå‘èŠ½çš„å¹¼è‹—ã€‚', options: [
        { text: 'ã€ç´§æ€¥è¡¥ç§ã€‘è€å¯’ä½œç‰©ã€‚', req: { wealth: 400 }, outcome: { text: 'ä½ ç´§æ€¥è¡¥ç§ï¼Œè™½ç„¶é”™è¿‡äº†æœ€ä½³æ—¶èŠ‚ï¼Œä½†æ€»ç®—æŒ½å›äº†ä¸€äº›æŸå¤±ã€‚', effects: { multiplier: 0.7, cost: 400 } } },
        { text: 'ã€æ”¾å¼ƒæœ¬å­£ã€‘ã€‚', req: {}, outcome: { text: 'ä½ å†³å®šæ”¾å¼ƒè¿™ä¸€å­£çš„æ”¶æˆï¼Œç­‰å¾…æ¥å¹´ã€‚', effects: { multiplier: 0 } } }
    ]},
    { title: 'æ°´æºæ±¡æŸ“', type: 'negative', desc: 'ä¸Šæ¸¸çš„ä¸€å®¶å°æŸ“ä½œåŠæ’æ”¾æ±¡æ°´ï¼Œæ±¡æŸ“äº†ä½ çš„çŒæº‰æ°´æºã€‚', options: [
        { text: 'ã€å¯¹ç°¿å…¬å ‚ã€‘ã€‚', req: { wealth: 500 }, outcome: { text: 'å®˜å¸è™½ç„¶èµ¢äº†ï¼Œä½†ç”°åœ°å·²è¢«æ±¡æŸ“ï¼Œä»Šå¹´æ”¶æˆå¤§å‡ã€‚', effects: { cost: 500, multiplier: 0.4 } } },
        { text: 'ã€å¦å¯»æ°´æºã€‘ã€‚', req: { wealth: 1500 }, outcome: { text: 'ä½ èŠ±è´¹é‡é‡‘é‡æ–°å¼€å‡¿äº†æ°´æ¸ ï¼Œè§£å†³äº†é—®é¢˜ã€‚', effects: { cost: 1500, multiplier: 0.9 } } }
    ]},
    { title: 'é‡å…½ä¾µæ‰°', type: 'negative', desc: 'ä¸€ç¾¤é‡çŒªé—¯å…¥äº†ä½ çš„ç”°åœ°ï¼Œæ‹±åäº†è®¸å¤šå³å°†æˆç†Ÿçš„ä½œç‰©ï¼', options: [
        { text: 'ã€é›‡ä½£çŒæˆ·ã€‘é©±èµ¶ã€‚', req: { wealth: 300 }, outcome: { text: 'çŒæˆ·æˆåŠŸé©±èµ¶äº†é‡çŒªï¼Œä½†éƒ¨åˆ†æŸå¤±å·²æ— æ³•æŒ½å›ã€‚', effects: { multiplier: 0.85, cost: 300 } } },
        { text: 'ã€è®¾ç½®é™·é˜±ã€‘ã€‚', req: { wisdom: 50 }, outcome: { text: 'ä½ è®¾ç½®çš„é™·é˜±æ•è·äº†å‡ å¤´é‡çŒªï¼Œä¸ä»…å¼¥è¡¥äº†æŸå¤±ï¼Œè¿˜å¾—äº†é‡å‘³ã€‚', effects: { multiplier: 0.95, wealth: 100 } } },
        { text: 'ã€å¬å¤©ç”±å‘½ã€‘ã€‚', req: {}, outcome: { text: 'é‡çŒªè‚†è™ï¼Œä½ çš„æ”¶æˆæŸå¤±æƒ¨é‡ã€‚', effects: { multiplier: 0.6 } } }
    ]},
    { title: 'å°äººä½œç¥Ÿ', type: 'negative', desc: 'ä½ è§£é›‡çš„ä¸€ä¸ªæ‡’æƒ°å†œæˆ·æ€€æ¨åœ¨å¿ƒï¼Œå››å¤„æ•£æ’­ä½ çš„è°£è¨€ï¼Œè¯´ä½ çš„ç²®é£Ÿæœ‰æ¯’ã€‚', options: [
        { text: 'ã€å…¬å¼€æ¾„æ¸…ã€‘ã€‚', req: {}, outcome: { text: 'æ¾„æ¸…æœ‰ä¸€å®šæ•ˆæœï¼Œä½†å£°èª‰è¿˜æ˜¯å—åˆ°äº†å½±å“ã€‚', effects: { reputation: -5 } } },
        { text: 'ã€ç”¨é’±å°å£ã€‘ã€‚', req: { wealth: 500 }, outcome: { text: 'ä½ èŠ±é’±å‹ä¸‹äº†è°£è¨€ï¼Œä½†å¯¹æ–¹å¯èƒ½æ•…æŠ€é‡æ–½ã€‚', effects: { cost: 500, virtue: -2 } } }
    ]},
    { title: 'å·¥å…·çŸ­ç¼º', type: 'negative', desc: 'å› è¾¹å¢ƒæˆ˜äº‹ï¼Œå®˜åºœå¤§é‡å¾ç”¨é“å™¨ï¼Œå¯¼è‡´å¸‚é¢ä¸Šçš„å†œå…·ä»·æ ¼é£æ¶¨ä¸”çŸ­ç¼ºã€‚', options: [
        { text: 'ã€é«˜ä»·è´­å…¥ã€‘ã€‚', req: {}, outcome: { text: 'ä½ è¢«è¿«é«˜ä»·è´­ä¹°å†œå…·ï¼Œæˆæœ¬å¤§å¢ã€‚', effects: { cost: 400, multiplier: 0.9 } } },
        { text: 'ã€ä½¿ç”¨æ—§å†œå…·ã€‘ã€‚', req: {}, outcome: { text: 'æ—§å†œå…·æ•ˆç‡ä½ä¸‹ï¼Œå½±å“äº†è€•ä½œè¿›åº¦å’Œæ”¶æˆã€‚', effects: { multiplier: 0.8 } } }
    ]},
    { title: 'åŠ³åŠ›æµå¤±', type: 'negative', desc: 'åŸé‡Œçš„å¤§å·¥ç¨‹å¸å¼•äº†å¤§é‡åŠ³åŠ¨åŠ›ï¼Œä½ çš„å†œåº„äººæ‰‹ä¸¥é‡ä¸è¶³ã€‚', options: [
        { text: 'ã€æé«˜å·¥é’±ã€‘ç•™ä½äººã€‚', req: { wealth: 600 }, outcome: { text: 'ä½ æé«˜äº†å·¥é’±ï¼Œç¨³ä½äº†äººæ‰‹ï¼Œä½†åˆ©æ¶¦é™ä½äº†ã€‚', effects: { cost: 600, multiplier: 0.85 } } },
        { text: 'ã€æ‹›å‹Ÿæµæ°‘ã€‘ã€‚', req: {}, outcome: { text: 'æµæ°‘è™½ç„¶ä¾¿å®œï¼Œä½†ç®¡ç†æ··ä¹±ï¼Œæ—¶å¸¸æƒ¹å‡ºäº‹ç«¯ã€‚', effects: { multiplier: 0.7, reputation: -3 } } }
    ]},
    { title: 'äº§ä¸šå†²å‡»', type: 'negative', desc: 'ä»æµ·å¤–å¼•è¿›çš„æ–°å‹é«˜äº§ä½œç‰©å†²å‡»äº†å¸‚åœºï¼Œä½ çš„ä¼ ç»Ÿä½œç‰©ä»·æ ¼æš´è·Œã€‚', options: [
        { text: 'ã€é™ä»·æŠ›å”®ã€‘ã€‚', req: {}, outcome: { text: 'ä½ äºæœ¬æŠ›å”®äº†æ‰€æœ‰å­˜è´§ï¼Œé¿å…äº†æ›´å¤§çš„æŸå¤±ã€‚', effects: { multiplier: 0.5 } } },
        { text: 'ã€æ”¹ç§æ–°ä½œç‰©ã€‘ã€‚', req: { wealth: 800 }, outcome: { text: 'ä½ èŠ±è´¹é‡é‡‘æ”¹ç§æ–°ä½œç‰©ï¼Œä½†éœ€è¦æ—¶é—´é€‚åº”ï¼Œæœ¬å­£æ”¶æˆä¸ä½³ã€‚', effects: { cost: 800, multiplier: 0.6 } } }
    ]},
    { title: 'å®˜å·®å‹’ç´¢', type: 'negative', desc: 'ä¸€ä½è·¯è¿‡çš„å®˜å·®ä»¥â€œæ£€æŸ¥ç”°å¥‘â€ä¸ºç”±ï¼Œå‘ä½ å‹’ç´¢ä¸€ç¬”â€œè¾›è‹¦è´¹â€ã€‚', options: [
        { text: 'ã€ç ´è´¢æ¶ˆç¾ã€‘ã€‚', req: { wealth: 250 }, outcome: { text: 'ä½ èŠ±é’±æ‰“å‘äº†å®˜å·®ã€‚', effects: { cost: 250 } } },
        { text: 'ã€å¼ºç¡¬æ‹’ç»ã€‘ã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ ä¹‰æ­£è¾ä¸¥åœ°æ‹’ç»äº†ï¼Œä½†å¯¹æ–¹ä¼¼ä¹è®°æ¨ä¸Šäº†ä½ ã€‚', effects: { risk: 'official_revenge' } } }
    ]},
    { title: 'åœŸåœ°è´«ç˜ ', type: 'negative', desc: 'å› è¿å¹´è€•ä½œï¼Œä½ çš„ä¸€å—åœŸåœ°è‚¥åŠ›ä¸‹é™ï¼Œä½œç‰©é•¿åŠ¿ä¸ä½³ã€‚', options: [
        { text: 'ã€è´­ä¹°è±†é¥¼ã€‘æ–½è‚¥ã€‚', req: { wealth: 350 }, outcome: { text: 'ä½ èŠ±è´¹é‡é‡‘æ–½è‚¥ï¼Œæ”¶æˆæœ‰æ‰€å¥½è½¬ã€‚', effects: { cost: 350, multiplier: 0.8 } } },
        { text: 'ã€ä¼‘è€•ä¸€å¹´ã€‘ã€‚', req: {}, outcome: { text: 'ä½ å†³å®šè®©åœŸåœ°ä¼‘å…»ç”Ÿæ¯ï¼Œæœ¬å­£è¯¥åœ°å—æ²¡æœ‰ä»»ä½•æ”¶å…¥ã€‚', effects: { multiplier: 0 } } }
    ]}
];
// ===================== ã€è¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢ã€‘ =====================
const INVESTMENT_EVENTS = [
    // æ‚¨åŸæœ‰çš„7ä¸ªæ­£é¢äº‹ä»¶
    { title: 'å¸‚åœºæ–°æ½®', type: 'positive', desc: 'ä½ ç»è¥çš„äº§ä¸šçªç„¶æˆäº†äº¬åŸçš„æ–°é£å°šï¼Œé¡¾å®¢ç›ˆé—¨ï¼', options: [
        { text: 'ã€è¶æœºæ¶¨ä»·ã€‘ã€‚', req: { wisdom: 40 }, outcome: { text: 'ä½ æŠ“ä½äº†å•†æœºï¼Œå¤§èµšä¸€ç¬”ã€‚', effects: { multiplier: 1.5, reputation: -2 } } },
        { text: 'ã€æ‰©å¤§è§„æ¨¡ã€‘æ»¡è¶³éœ€æ±‚ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ æœæ–­æŠ•èµ„ï¼Œå æ®äº†æ›´å¤§çš„å¸‚åœºä»½é¢ã€‚', effects: { multiplier: 1.4, cost: 1000 } } },
        { text: 'ã€ä¿æŒå“è´¨ã€‘ç»´æŠ¤å£ç¢‘ã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ åšæŒå“è´¨ï¼Œèµ¢å¾—äº†é¡¾å®¢çš„é•¿æœŸä¿¡èµ–ã€‚', effects: { multiplier: 1.2, reputation: 10 } } }
    ]},
    { title: 'å®˜åºœæ‰¶æŒ', type: 'positive', desc: 'å®˜åºœæ¨è¡Œæ–°æ”¿ï¼Œå¯¹ä½ æ‰€åœ¨çš„è¡Œä¸šæœ‰ç¨æ”¶å‡å…ç­‰æ‰¶æŒæ”¿ç­–ã€‚', options: [
        { text: 'ã€äº«å—æ”¿ç­–ã€‘çº¢åˆ©ã€‚', req: {}, outcome: { text: 'ä½ äº«å—äº†ç¨æ”¶å‡å…ï¼Œåˆ©æ¶¦æå‡ã€‚', effects: { multiplier: 1.3 } } },
        { text: 'ã€å€Ÿæœºæ‰©å¼ ã€‘ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ åˆ©ç”¨æ”¿ç­–ä¼˜åŠ¿ï¼Œè¿…é€Ÿæ‰©å¼ äº†äº§ä¸šã€‚', effects: { multiplier: 1.2, cost: 500 } } },
        { text: 'ã€ä¸å®˜åºœã€‘åŠ æ·±åˆä½œã€‚', req: { charm: 60 }, outcome: { text: 'ä½ ä¸å®˜åºœå»ºç«‹äº†è‰¯å¥½å…³ç³»ï¼Œä¸ºæœªæ¥é“ºå¹³äº†é“è·¯ã€‚', effects: { reputation: 15 } } }
    ]},
    { title: 'å¯¹æ‰‹å¤±è¯¯', type: 'positive', desc: 'ä½ çš„ä¸»è¦ç«äº‰å¯¹æ‰‹å› ç»è¥å¤±è¯¯ï¼Œå£°èª‰å¤§è·Œï¼Œå¤§é‡å®¢æˆ·æµå‘äº†ä½ è¿™è¾¹ã€‚', options: [
        { text: 'ã€å…¨ç›˜æ¥æ”¶ã€‘å®¢æˆ·ã€‚', req: {}, outcome: { text: 'ä½ çš„ç”Ÿæ„å¼‚å¸¸ç«çˆ†ï¼', effects: { multiplier: 1.6 } } },
        { text: 'ã€è¶æœºæ”¶è´­ã€‘å¯¹æ–¹çš„åº—é“ºã€‚', req: { wealth: 2000, wisdom: 70 }, outcome: { text: 'ä½ ä»¥ä½ä»·æ”¶è´­äº†å¯¹æ‰‹çš„äº§ä¸šï¼Œå®åŠ›å¤§å¢ï¼', effects: { cost: 2000, asset_gain: 1 } } },
        { text: 'ã€å¼•ä»¥ä¸ºæˆ’ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ä»å¯¹æ‰‹çš„å¤±è´¥ä¸­å¸å–äº†æ•™è®­ï¼Œæå‡äº†ç®¡ç†æ°´å¹³ã€‚', effects: { wisdom: 5 } } }
    ]},
    { title: 'å‘ç°æ–°æ¸ é“', type: 'positive', desc: 'ä½ å¶ç„¶å‘ç°äº†ä¸€æ¡æ–°çš„åŸææ–™æ¸ é“ï¼Œæˆæœ¬å¯ä»¥å¤§å¤§é™ä½ã€‚', options: [
        { text: 'ã€ç«‹å³æ›´æ¢ã€‘ä¾›åº”å•†ã€‚', req: {}, outcome: { text: 'ä½ çš„æˆæœ¬é™ä½ï¼Œåˆ©æ¶¦å¤§å¹…æå‡ï¼', effects: { multiplier: 1.4 } } },
        { text: 'ã€ä»¥æ­¤ä¸ºç­¹ç ã€‘ä¸è€ä¾›åº”å•†è°ˆåˆ¤ã€‚', req: { charm: 60 }, outcome: { text: 'ä½ æˆåŠŸå‹ä½äº†è¿›è´§ä»·ã€‚', effects: { multiplier: 1.3 } } },
        { text: 'ã€å„æ–­æ¸ é“ã€‘ã€‚', req: { wealth: 1500, wisdom: 70 }, outcome: { text: 'ä½ ä¹°æ–­äº†æ–°æ¸ é“ï¼Œä¸ä»…è‡ªå·±è·åˆ©ï¼Œè¿˜æ‰“å‡»äº†å¯¹æ‰‹ã€‚', effects: { multiplier: 1.35, cost: 1500 } } }
    ]},
    { title: 'æŒæŸœçŒ®ç­–', type: 'positive', desc: 'ä½ é›‡ä½£çš„æŒæŸœæƒ³å‡ºäº†ä¸€ä¸ªç»å¦™çš„è¥é”€ç‚¹å­ã€‚', options: [
        { text: 'ã€é‡‡çº³å¹¶æˆæƒã€‘ã€‚', req: {}, outcome: { text: 'æ–°ç‚¹å­å¤§è·æˆåŠŸï¼Œç”Ÿæ„å…´éš†ï¼', effects: { multiplier: 1.3, virtue: 2 } } },
        { text: 'ã€äº²è‡ªæ‰§è¡Œã€‘ã€‚', req: {}, outcome: { text: 'ä½ äº²è‡ªæ“åˆ€ï¼Œæ•ˆæœåŒæ ·å‡ºè‰²ã€‚', effects: { multiplier: 1.25 } } },
        { text: 'ã€è®ºåŠŸè¡Œèµã€‘é‡èµæŒæŸœã€‚', req: { wealth: 500 }, outcome: { text: 'æŒæŸœæ„Ÿæ¿€æ¶•é›¶ï¼Œæ›´åŠ å¿ å¿ƒè€¿è€¿ã€‚', effects: { multiplier: 1.2, cost: 500, loyalty_boost: 1 } } }
    ]},
    { title: 'æ–‡åŒ–åäººå…‰é¡¾', type: 'positive', desc: 'ä¸€ä½è‘—åçš„æ–‡äººå¢¨å®¢å…‰é¡¾äº†ä½ çš„åº—é“ºï¼Œå¹¶ç•™ä¸‹äº†èµç¾çš„è¯—å¥ã€‚', options: [
        { text: 'ã€å¤§è‚†å®£ä¼ ã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„åº—é“ºåå£°å¤§å™ªï¼Œæˆäº†â€œç½‘çº¢åº—â€ã€‚', effects: { multiplier: 1.25, reputation: 15 } } },
        { text: 'ã€èµ é€åšç¤¼ã€‘æ„Ÿè°¢ã€‚', req: { wealth: 300 }, outcome: { text: 'ä½ ä¸è¿™ä½åäººç»“ä¸‹äº†å–„ç¼˜ã€‚', effects: { multiplier: 1.1, cost: 300 } } },
        { text: 'ã€è£…è£±èµ·æ¥ã€‘ä½œä¸ºé•‡åº—ä¹‹å®ã€‚', req: {}, outcome: { text: 'æ­¤ä¸¾æå‡äº†åº—é“ºçš„æ ¼è°ƒã€‚', effects: { multiplier: 1.15, reputation: 5 } } }
    ]},
    { title: 'èŠ‚æ—¥ç‰¹éœ€', type: 'positive', desc: 'æ°é€¢é‡å¤§èŠ‚æ—¥ï¼Œæ°‘ä¼—æ¶ˆè´¹æ¬²æœ›é«˜æ¶¨ï¼Œä½ çš„äº§ä¸šè¿æ¥äº†é”€å”®æ—ºå­£ã€‚', options: [
        { text: 'ã€æå‰å¤‡è´§ã€‘ã€‚', req: { wisdom: 50 }, outcome: { text: 'ä½ ç²¾å‡†çš„é¢„åˆ¤è®©ä½ èµšå¾—ç›†æ»¡é’µæ»¡ï¼', effects: { multiplier: 1.7 } } },
        { text: 'ã€ä¸¾åŠä¿ƒé”€ã€‘æ´»åŠ¨ã€‚', req: { charm: 50 }, outcome: { text: 'ä¿ƒé”€æ´»åŠ¨å¸å¼•äº†å¤§é‡é¡¾å®¢ï¼Œè–„åˆ©å¤šé”€ã€‚', effects: { multiplier: 1.5, cost: 200 } } },
        { text: 'ã€ç»´æŒåŸæ ·ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ä¾ç„¶è·å¾—äº†ä¸é”™çš„æ”¶ç›Šã€‚', effects: { multiplier: 1.3 } } }
    ]},
    // æ‚¨åŸæœ‰çš„8ä¸ªè´Ÿé¢äº‹ä»¶
    { title: 'é­é‡å‹’ç´¢', type: 'negative', desc: 'ä¸€ç¾¤åœ°ç—æµæ°“æ¥åº—é‡Œé—¹äº‹ï¼Œå£°ç§°è¦æ”¶â€œä¿æŠ¤è´¹â€ã€‚', options: [
        { text: 'ã€ç ´è´¢æ¶ˆç¾ã€‘ã€‚', req: { wealth: 500 }, outcome: { text: 'ä½ èŠ±é’±ä¹°äº†ä¸ªæš‚æ—¶çš„å®‰å®ã€‚', effects: { cost: 500 } } },
        { text: 'ã€å¼ºç¡¬å¯¹æŠ—ã€‘ã€‚', req: {}, outcome: { text: 'ä½ èµ¶èµ°äº†åœ°ç—ï¼Œä½†åº—é“ºè¢«æ‰“ç ¸ï¼ŒæŸå¤±ä¸å°ã€‚', effects: { multiplier: 0.8, cost: 300 } } },
        { text: 'ã€å¯»æ±‚å®˜åºœã€‘åº‡æŠ¤ã€‚', req: { charm: 50 }, outcome: { text: 'ä½ æ‰“ç‚¹å®˜åºœï¼Œè§£å†³äº†éº»çƒ¦ï¼Œä½†ä¹ŸèŠ±äº†ä¸å°‘é’±ã€‚', effects: { cost: 700 } } }
    ]},
    { title: 'å‡ºç°ä»¿å†’å“', type: 'negative', desc: 'å¸‚åœºä¸Šå‡ºç°äº†å¤§é‡ä»¿å†’ä½ çš„äº§å“çš„åŠ£è´¨è´§ï¼Œå½±å“äº†ä½ çš„å£°èª‰ã€‚', options: [
        { text: 'ã€ç™»æŠ¥æ¾„æ¸…ã€‘ã€‚', req: {}, outcome: { text: 'æ¾„æ¸…æœ‰ä¸€å®šæ•ˆæœï¼Œä½†å£°èª‰æŸå¤±éš¾ä»¥å®Œå…¨æŒ½å›ã€‚', effects: { multiplier: 0.9, cost: 100 } } },
        { text: 'ã€é™ä»·ç«äº‰ã€‘ã€‚', req: {}, outcome: { text: 'é™ä»·å¯¼è‡´åˆ©æ¶¦å¤§å‡ï¼Œå¾—ä¸å¿å¤±ã€‚', effects: { multiplier: 0.7 } } },
        { text: 'ã€æš—ä¸­è°ƒæŸ¥ã€‘æºå¤´å¹¶æŠ¥å®˜ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ æˆåŠŸç«¯æ‰äº†ä»¿å†’çªç‚¹ï¼Œç»´æŠ¤äº†å“ç‰Œã€‚', effects: { cost: 400, reputation: 5 } } }
    ]},
    { title: 'å†…éƒ¨å¤±çªƒ', type: 'negative', desc: 'ä½ å‘ç°åº—é‡Œçš„è´¦ç›®ä¸å¯¹ï¼Œä¼¼ä¹æœ‰å†…éƒ¨äººå‘˜ç›‘å®ˆè‡ªç›—ã€‚', options: [
        { text: 'ã€ä¸åŠ¨å£°è‰²ã€‘æš—ä¸­è§‚å¯Ÿã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ æˆåŠŸæŠ“ä½äº†å†…é¬¼ï¼Œä½†éƒ¨åˆ†æŸå¤±å·²æ— æ³•è¿½å›ã€‚', effects: { multiplier: 0.9 } } },
        { text: 'ã€å…¬å¼€å®¡æŸ¥ã€‘æ‰€æœ‰äººå‘˜ã€‚', req: {}, outcome: { text: 'äººå¿ƒæƒ¶æƒ¶ï¼Œå½±å“äº†æ­£å¸¸ç»è¥ã€‚', effects: { multiplier: 0.85, virtue: -2 } } },
        { text: 'ã€è‡ªè®¤å€’éœ‰ã€‘åŠ å¼ºç®¡ç†ã€‚', req: {}, outcome: { text: 'ä½ æŸå¤±äº†ä¸€ç¬”é’±ã€‚', effects: { multiplier: 0.8 } } }
    ]},
    { title: 'æµè¡Œå˜è¿', type: 'negative', desc: 'äº¬åŸçš„æµè¡Œé£å‘çªç„¶è½¬å˜ï¼Œä½ çš„äº§å“ä¸å†å—æ¬¢è¿ï¼Œåº“å­˜å¤§é‡ç§¯å‹ã€‚', options: [
        { text: 'ã€äºæœ¬æ¸…ä»“ã€‘ã€‚', req: {}, outcome: { text: 'ä½ äºæœ¬å¤„ç†äº†åº“å­˜ï¼ŒåŠæ—¶å›ç¬¼äº†éƒ¨åˆ†èµ„é‡‘ã€‚', effects: { multiplier: 0.6 } } },
        { text: 'ã€ç­‰å¾…é£å‘ã€‘è½¬å›æ¥ã€‚', req: {}, outcome: { text: 'ä½ çš„ç­‰å¾…æ˜¯å¾’åŠ³çš„ï¼Œåº“å­˜æœ€ç»ˆä¸€æ–‡ä¸å€¼ã€‚', effects: { multiplier: 0.2 } } },
        { text: 'ã€äºŒæ¬¡æ”¹é€ ã€‘è¿åˆæ–°æ½®æµã€‚', req: { talent: 60, wealth: 500 }, outcome: { text: 'ä½ å·§å¦™åœ°æ”¹é€ äº†äº§å“ï¼ŒæŒ½å›äº†éƒ¨åˆ†æŸå¤±ã€‚', effects: { multiplier: 0.8, cost: 500 } } }
    ]},
    { title: 'ä¾›åº”å•†æ¶¨ä»·', type: 'negative', desc: 'ä½ çš„ä¸»è¦ä¾›åº”å•†çªç„¶å®£å¸ƒåŸææ–™ä»·æ ¼ä¸Šæ¶¨ã€‚', options: [
        { text: 'ã€æ¥å—æ¶¨ä»·ã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„æˆæœ¬ä¸Šå‡ï¼Œåˆ©æ¶¦é™ä½ã€‚', effects: { multiplier: 0.8 } } },
        { text: 'ã€å¯»æ‰¾æ–°çš„ã€‘ä¾›åº”å•†ã€‚', req: {}, outcome: { text: 'å¯»æ‰¾æ–°ä¾›åº”å•†éœ€è¦æ—¶é—´ï¼ŒæœŸé—´çš„æ–­è´§é€ æˆäº†æŸå¤±ã€‚', effects: { multiplier: 0.75 } } },
        { text: 'ã€å°è¯•è‡ªå·±ã€‘ç”Ÿäº§åŸæ–™ã€‚', req: { wisdom: 80, wealth: 2000 }, outcome: { text: 'è¿™æ˜¯ä¸€é¡¹é•¿æœŸæŠ•èµ„ï¼ŒçŸ­æœŸå†…é€ æˆäº†å·¨å¤§äºæŸã€‚', effects: { multiplier: 0.5, cost: 2000 } } }
    ]},
    { title: 'æ”¿ç­–å˜åŠ¨', type: 'negative', desc: 'å®˜åºœå‡ºå°æ–°æ”¿ç­–ï¼Œå¯¹ä½ æ‰€åœ¨çš„è¡Œä¸šè¿›è¡Œä¸¥æ ¼ç®¡åˆ¶ï¼Œç»è¥æˆæœ¬å¤§å¤§å¢åŠ ã€‚', options: [
        { text: 'ã€éµå®ˆè§„å®šã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„ç»è¥æˆæœ¬å¢åŠ ï¼Œåˆ©æ¶¦ä¸‹é™ã€‚', effects: { multiplier: 0.7 } } },
        { text: 'ã€æ‰“ç‚¹å®˜å‘˜ã€‘å¯»æ±‚é€šèã€‚', req: { charm: 70, wealth: 1000 }, outcome: { text: 'ä½ èŠ±é’±æå®šäº†å…³ç³»ï¼Œä½†æœ‰æ½œåœ¨é£é™©ã€‚', effects: { multiplier: 0.9, cost: 1000, virtue: -5 } } },
        { text: 'ã€è½¬è¡Œã€‘ã€‚', req: {}, outcome: { text: 'ä½ å†³å®šè½¬è¡Œï¼Œå˜å–äº†ç°æœ‰äº§ä¸šï¼ŒæŸå¤±å·¨å¤§ã€‚', effects: { multiplier: 0.4, asset_loss: 1 } } }
    ]},
    { title: 'å®‰å…¨äº‹æ•…', type: 'negative', desc: 'ä½ çš„åº—é“ºå‘ç”Ÿäº†ä¸€èµ·å®‰å…¨äº‹æ•…ï¼ˆå¦‚ç«ç¾ã€ä¼¤äººï¼‰ï¼Œéœ€è¦èµ”å¿å¹¶åœä¸šæ•´é¡¿ã€‚', options: [
        { text: 'ã€è¶³é¢èµ”å¿ã€‘å¹¶ç§¯ææ•´æ”¹ã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ çš„è´Ÿè´£æ€åº¦æŒ½å›äº†ä¸€äº›å£°èª‰ï¼Œä½†æŸå¤±ä¾ç„¶æƒ¨é‡ã€‚', effects: { multiplier: 0.5, cost: 1500, reputation: -5 } } },
        { text: 'ã€æ¨å¸è´£ä»»ã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„å£°èª‰ä¸€è½åƒä¸ˆï¼Œåº—é“ºè¢«å¼ºåˆ¶å…³é—­ã€‚', effects: { multiplier: 0.1, reputation: -20, virtue: -10 } } },
        { text: 'ã€ç§äº†ã€‘ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ èŠ±é’±ç§äº†ï¼Œå°†äº‹ä»¶å‹äº†ä¸‹å»ã€‚', effects: { multiplier: 0.6, cost: 1000, reputation: -10 } } }
    ]},
    { title: 'é£æ°´é—®é¢˜', type: 'negative', desc: 'ä¸€ä½é£æ°´å…ˆç”Ÿè¯´ä½ çš„åº—é“ºé£æ°´ä¸å¥½ï¼Œå¯¼è‡´å®¢æµç¨€å°‘ï¼Œäººå¿ƒä¸ç¨³ã€‚', options: [
        { text: 'ã€è¯·å¤§å¸ˆã€‘ä½œæ³•æ”¹è¿ã€‚', req: { wealth: 800 }, outcome: { text: 'ä½ èŠ±é’±è¯·äººä½œæ³•ï¼Œä¼¼ä¹å¹¶æ— æ•ˆæœã€‚', effects: { cost: 800 } } },
        { text: 'ã€é‡æ–°è£…ä¿®ã€‘æ”¹å˜å¸ƒå±€ã€‚', req: { wealth: 1200 }, outcome: { text: 'é‡æ–°è£…ä¿®åï¼Œåº—é“ºé¢è²Œä¸€æ–°ï¼Œç”Ÿæ„ç•¥æœ‰èµ·è‰²ã€‚', effects: { multiplier: 1.1, cost: 1200 } } },
        { text: 'ã€ä¸ä¿¡é¬¼ç¥ã€‘ã€‚', req: {}, outcome: { text: 'ä½ å¯¹æ­¤å—¤ä¹‹ä»¥é¼»ï¼Œä½†æµè¨€å´è®©ä½ çš„ç”Ÿæ„æ›´å·®äº†ã€‚', effects: { multiplier: 0.8 } } }
    ]},
    // â–¼â–¼â–¼ ã€æ–°å¢20ä¸ªäº§ä¸šæŠ•èµ„äº‹ä»¶ã€‘ â–¼â–¼â–¼
    // --- 10ä¸ªæ­£é¢äº‹ä»¶ ---
    { title: 'å·§åŒ æ¥æŠ•', type: 'positive', desc: 'ä¸€ä½æŠ€è‰ºç²¾æ¹›ä½†æ€€æ‰ä¸é‡çš„å·¥åŒ å‰æ¥ï¼Œå¸Œæœ›èƒ½ä¸ä½ çš„äº§ä¸šåˆä½œï¼Œæå‡äº§å“å“è´¨ã€‚', options: [
        { text: 'ã€è˜ä¸ºä¸Šå®¾ã€‘ã€‚', req: { wealth: 800 }, outcome: { text: 'ä½ çš„äº§å“å“è´¨å¤§å¹…æå‡ï¼Œå£ç¢‘è¿œæ‰¬ï¼', effects: { multiplier: 1.3, cost: 800, reputation: 10 } } },
        { text: 'ã€è®©ä»–å½“å­¦å¾’ã€‘ã€‚', req: {}, outcome: { text: 'å¯¹æ–¹è®¤ä¸ºä½ ç§ä¸èµ·ä»–ï¼Œæ‹‚è¢–è€Œå»ã€‚', effects: {} } }
    ]},
    { title: 'æµ·å¤–å•†æœº', type: 'positive', desc: 'ä¸€æ”¯æ¥è‡ªæµ·å¤–çš„å•†é˜Ÿå¯¹ä½ çš„å•†å“è¡¨ç°å‡ºæµ“åšå…´è¶£ï¼Œå¸Œæœ›èƒ½å»ºç«‹é•¿æœŸåˆä½œã€‚', options: [
        { text: 'ã€ç­¾è®¢åˆçº¦ã€‘ã€‚', req: {}, outcome: { text: 'ä½ æˆåŠŸæ‰“å¼€äº†æµ·å¤–å¸‚åœºï¼Œæœªæ¥çš„æ”¶ç›Šå°†æ›´åŠ å¯è§‚ï¼', effects: { multiplier: 1.25, trade_partner: 1 } } },
        { text: 'ã€æ‹…å¿ƒé£é™©ã€‘è€Œæ‹’ç»ã€‚', req: {}, outcome: { text: 'ä½ é€‰æ‹©äº†ç¨³å¦¥ï¼Œä½†ä¹Ÿé”™è¿‡äº†å‘å±•çš„è‰¯æœºã€‚', effects: {} } }
    ]},
    { title: 'æ„å¤–çš„é—äº§', type: 'positive', desc: 'ä¸€ä½ä»æœªè°‹é¢çš„è¿œæˆ¿äº²æˆšå»ä¸–ï¼Œç«Ÿç»™ä½ ç•™ä¸‹äº†ä¸€é—´ä½ç½®ä¸é”™çš„å°å•†é“ºã€‚', options: [
        { text: 'ã€æ¥æ”¶å¹¶ç»è¥ã€‘ã€‚', req: {}, outcome: { text: 'ä½ æ„å¤–è·å¾—äº†ä¸€ä»½äº§ä¸šï¼', effects: { asset_gain: 1 } } },
        { text: 'ã€ç«‹å³å˜å–ã€‘ã€‚', req: {}, outcome: { text: 'ä½ å°†å•†é“ºå˜å–ï¼Œè·å¾—äº†ä¸€ç¬”å¯è§‚çš„ç°é‡‘ã€‚', effects: { wealth: 5000 } } }
    ]},
    { title: 'é“è·¯é€šç•…', type: 'positive', desc: 'å®˜åºœåœ¨ä½ åº—é“ºé—¨å‰æ–°ä¿®äº†ä¸€æ¡ä¸»å¹²é“ï¼Œå®¢æµé‡å¤§å¢ï¼', options: [
        { text: 'ã€æŠ“ä½æœºé‡ã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„åº—é“ºå› æ­¤ç”Ÿæ„ç«çˆ†ï¼', effects: { multiplier: 1.4 } } }
    ]},
    { title: 'åŠ å…¥å•†å¸®', type: 'positive', desc: 'æœ¬åœ°æœ€å¤§çš„å•†å¸®å‘ä½ é€’æ¥æ©„æ¦„æï¼Œé‚€è¯·ä½ åŠ å…¥ä»–ä»¬ã€‚', options: [
        { text: 'ã€æ¬£ç„¶åŠ å…¥ã€‘ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ æˆåŠŸåŠ å…¥äº†å•†å¸®ï¼Œè·å¾—äº†åº‡æŠ¤å’Œæ›´å¤šçš„ä¿¡æ¯æ¸ é“ã€‚', effects: { cost: 1000, reputation: 10 } } },
        { text: 'ã€ä¿æŒç‹¬ç«‹ã€‘ã€‚', req: {}, outcome: { text: 'ä½ é€‰æ‹©å•æ‰“ç‹¬æ–—ï¼Œä½†ä¹Ÿå¤±å»äº†é å±±ã€‚', effects: {} } }
    ]},
    { title: 'æ—§å€ºå¿è¿˜', type: 'positive', desc: 'ä¸€ç¬”ä½ æ—©å·²å½“åšåè´¦çš„æ—§æ¬ æ¬¾ï¼Œå¯¹æ–¹ç«Ÿç„¶è¿æœ¬å¸¦åˆ©åœ°è¿˜äº†å›æ¥ï¼', options: [
        { text: 'ã€æ„å¤–ä¹‹å–œã€‘ã€‚', req: {}, outcome: { text: 'ä½ è·å¾—äº†ä¸€ç¬”æ„å¤–ä¹‹è´¢ï¼', effects: { wealth: 1500 } } }
    ]},
    { title: 'å¿ è¯šå®¢æˆ·', type: 'positive', desc: 'ä¸€ä½å¿ å®çš„è€å®¢æˆ·ä¸ºåº†ç¥å®¶ä¸­å–œäº‹ï¼Œå‘ä½ ä¸‹äº†ä¸€ç¬”å·¨é¢è®¢å•ã€‚', options: [
        { text: 'ã€ç»™äºˆä¼˜æƒ ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ç»™äºˆäº†ä¼˜æƒ ï¼Œè™½ç„¶åˆ©æ¶¦ç¨å‡ï¼Œä½†èµ¢å¾—äº†å®¢æˆ·çš„é•¿æœŸä¿¡èµ–ã€‚', effects: { multiplier: 1.5, virtue: 2 } } },
        { text: 'ã€æ­£å¸¸æ”¶è´¹ã€‘ã€‚', req: {}, outcome: { text: 'ä¸€ç¬”å¯è§‚çš„æ”¶å…¥å…¥è´¦ã€‚', effects: { multiplier: 1.6 } } }
    ]},
    { title: 'æˆæœ¬ä¸‹é™', type: 'positive', desc: 'å› æŠ€æœ¯é©æ–°ï¼Œä½ äº§ä¸šæ‰€éœ€çš„ä¸€ç§å…³é”®åŸææ–™æˆæœ¬å¤§å¹…ä¸‹é™ã€‚', options: [
        { text: 'ã€äº§å“é™ä»·ã€‘æ‰©å¤§å¸‚åœºã€‚', req: {}, outcome: { text: 'ä½ é€šè¿‡é™ä»·è¿…é€Ÿå é¢†äº†æ›´å¤§çš„å¸‚åœºä»½é¢ã€‚', effects: { multiplier: 1.15, reputation: 5 } } },
        { text: 'ã€ä¿æŒåŸä»·ã€‘æå‡åˆ©æ¶¦ã€‚', req: {}, outcome: { text: 'ä½ çš„åˆ©æ¶¦ç‡å¤§å¹…æå‡ã€‚', effects: { multiplier: 1.3 } } }
    ]},
    { title: 'ç«äº‰è€…å†…æ–—', type: 'positive', desc: 'ä½ çš„å‡ å®¶ä¸»è¦ç«äº‰å¯¹æ‰‹å› å†…æ–—è€Œå…ƒæ°”å¤§ä¼¤ï¼Œä¸ºä½ ç•™å‡ºäº†å¸‚åœºç©ºé—´ã€‚', options: [
        { text: 'ã€è¶æœºæ‰©å¼ ã€‘ã€‚', req: { wealth: 1500 }, outcome: { text: 'ä½ æœæ–­å‡ºæ‰‹ï¼ŒæŠ¢å äº†ä»–ä»¬ç•™ä¸‹çš„å¸‚åœºã€‚', effects: { cost: 1500, multiplier: 1.4 } } }
    ]},
    { title: 'çš‡å®¤é£å°š', type: 'positive', desc: 'å®«ä¸­çš„ä¸€ä½è´µå¦ƒæ— æ„ä¸­ä½¿ç”¨äº†ä½ çš„äº§å“ï¼Œä½¿å…¶ä¸€å¤œä¹‹é—´æˆäº†è´¡å“çº§çš„å¥¢ä¾ˆå“ã€‚', options: [
        { text: 'ã€ååˆ©åŒæ”¶ã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„äº§å“ä»·æ ¼é£æ¶¨ï¼Œåå£°å¤§å™ªï¼', effects: { multiplier: 1.8, reputation: 20 } } }
    ]},
    // --- 10ä¸ªè´Ÿé¢äº‹ä»¶ ---
    { title: 'ä¼™è®¡è¢«æŒ–è§’', type: 'negative', desc: 'ä½ çš„ç«äº‰å¯¹æ‰‹ç”¨åŒå€è–ªæ°´æŒ–èµ°äº†ä½ æœ€èƒ½å¹²çš„ä¼™è®¡ï¼', options: [
        { text: 'ã€åŒ¹é…è–ªæ°´ã€‘ç•™ä½ä»–ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ ç•™ä½äº†äººï¼Œä½†åº—é“ºçš„äººå·¥æˆæœ¬æ°¸ä¹…ä¸Šå‡ã€‚', effects: { cost: 1000 } } },
        { text: 'ã€ç¥ä»–é«˜å°±ã€‘å¹¶ææ‹”æ–°äººã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ çš„æ°”åº¦èµ¢å¾—äº†å…¶ä»–ä¼™è®¡çš„å¿ å¿ƒï¼Œä½†çŸ­æœŸå†…ç»è¥ä¼šå—å½±å“ã€‚', effects: { multiplier: 0.9, loyalty_boost: 1 } } }
    ]},
    { title: 'è¡—åŒºå¤±ç«', type: 'negative', desc: 'ä½ çš„åº—é“ºæ‰€åœ¨çš„è¡—åŒºå‘ç”Ÿå¤§ç«ï¼Œè™½ç„¶åº—é“ºå¹¸å…ï¼Œä½†æ•´æ¡è¡—éƒ½è¢«å°é”æ•°æœˆã€‚', options: [
        { text: 'ã€ç­‰å¾…é‡å¼€ã€‘ã€‚', req: {}, outcome: { text: 'å°é”æœŸé—´ä½ æ²¡æœ‰ä»»ä½•æ”¶å…¥ï¼ŒæŸå¤±æƒ¨é‡ã€‚', effects: { multiplier: 0.3 } } },
        { text: 'ã€ä¸´æ—¶æ¬è¿ã€‘ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ èŠ±è´¹é‡é‡‘ä¸´æ—¶ç§Ÿèµäº†æ–°åº—é¢ï¼ŒæŒ½å›äº†éƒ¨åˆ†æŸå¤±ã€‚', effects: { cost: 1000, multiplier: 0.7 } } }
    ]},
    { title: 'å®˜å·®åˆéš¾', type: 'negative', desc: 'ä¸€ä½ä¸»ç®¡ä½ è¡Œä¸šçš„å®˜å·®å‰æ¥æ£€æŸ¥ï¼Œé¸¡è›‹é‡ŒæŒ‘éª¨å¤´ï¼Œæš—ç¤ºéœ€è¦â€œæ‰“ç‚¹â€ã€‚', options: [
        { text: 'ã€é€ä¸Šçº¢åŒ…ã€‘ã€‚', req: { wealth: 500 }, outcome: { text: 'ä½ èŠ±é’±æ¶ˆç¾ï¼Œå®˜å·®æ»¡æ„åœ°ç¦»å¼€äº†ã€‚', effects: { cost: 500, virtue: -3 } } },
        { text: 'ã€åšæŒåŸåˆ™ã€‘ã€‚', req: {}, outcome: { text: 'ä½ è¢«å¼ºè¡Œåœä¸šæ•´é¡¿äº†åŠä¸ªæœˆã€‚', effects: { multiplier: 0.7, reputation: -5 } } }
    ]},
    { title: 'åŸæ–™æ–­ä¾›', type: 'negative', desc: 'ä½ çš„ä¸»è¦ä¾›åº”å•†å› æ•…å€’é—­ï¼Œå¯¼è‡´ä½ çš„äº§ä¸šæ ¸å¿ƒåŸæ–™æ–­ä¾›ï¼', options: [
        { text: 'ã€ç´§æ€¥å¯»æ‰¾ã€‘æ›¿ä»£å“ã€‚', req: {}, outcome: { text: 'ä½ æ‰¾åˆ°äº†æ›¿ä»£å“ï¼Œä½†å“è´¨å’Œæˆæœ¬éƒ½ä¸å¦‚ä»å‰ã€‚', effects: { multiplier: 0.8 } } },
        { text: 'ã€é«˜ä»·æ”¶è´­ã€‘åŒè¡Œå­˜è´§ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ ä»˜å‡ºäº†é«˜æ˜‚çš„ä»£ä»·æ‰ç»´æŒä½ç”Ÿäº§ã€‚', effects: { cost: 1000, multiplier: 0.85 } } }
    ]},
    { title: 'é›†ä½“ä¸­æ¯’', type: 'negative', desc: 'ï¼ˆä»…é™èŒ¶æ¥¼ï¼‰ä¸€æ‰¹å®¢äººåœ¨ä½ çš„èŒ¶æ¥¼ç”¨è†³åå‡ºç°é›†ä½“ä¸­æ¯’ç—‡çŠ¶ï¼Œå®˜åºœå·²ä»‹å…¥è°ƒæŸ¥ï¼', options: [
        { text: 'ã€æ‰¿æ‹…è´£ä»»ã€‘ç§¯æèµ”å¿ã€‚', req: { virtue: 60, wealth: 2000 }, outcome: { text: 'ä½ çš„è´Ÿè´£æ€åº¦è®©ä½ åœ¨å£°èª‰ä¸ŠæŒ½å›äº†ä¸€ç‚¹æŸå¤±ï¼Œä½†è´¢åŠ¡ä¸Šè¡€æœ¬æ— å½’ã€‚', effects: { cost: 2000, reputation: -15, multiplier: 0.4 } } },
        { text: 'ã€å«ç¥¸äºã€‘ä¾›åº”å•†ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ æˆåŠŸå°†è´£ä»»æ¨ç»™äº†é£Ÿæä¾›åº”å•†ï¼Œä½†ä½ çš„ä¿¡èª‰ä¹Ÿå—åˆ°äº†å½±å“ã€‚', effects: { reputation: -10, multiplier: 0.7 } } }
    ]},
    { title: 'æŒæŸœèƒŒå›', type: 'negative', desc: 'ä½ æœ€ä¿¡ä»»çš„æŒæŸœç«Ÿç„¶å·èµ°äº†åº—é‡Œæ‰€æœ‰çš„æµåŠ¨èµ„é‡‘ï¼Œè·‘è·¯äº†ï¼', options: [
        { text: 'ã€ç«‹å³æŠ¥å®˜ã€‘ã€‚', req: {}, outcome: { text: 'å®˜åºœæ­£åœ¨è¿½ç¼‰ï¼Œä½†è¿½å›èµ„é‡‘çš„å¸Œæœ›æ¸ºèŒ«ã€‚', effects: { multiplier: 0.2, asset_loss: 1 } } }
    ]},
    { title: 'æƒè´µå¼ºä¹°', type: 'negative', desc: 'ä¸€ä½æƒè´µçœ‹ä¸Šäº†ä½ çš„åº—é“ºï¼Œæƒ³ç”¨æä½çš„ä»·æ ¼å¼ºè¡Œè´­ä¹°ã€‚', options: [
        { text: 'ã€å¿ç—›å‡ºå”®ã€‘ã€‚', req: {}, outcome: { text: 'ä½ æŸå¤±äº†äº§ä¸šï¼Œä½†ä¿å…¨äº†èº«å®¶æ€§å‘½ã€‚', effects: { wealth: 1000, asset_loss: 1 } } },
        { text: 'ã€å¯»æ±‚é å±±ã€‘åº‡æŠ¤ã€‚', req: { charm: 80 }, outcome: { text: 'ä½ èŠ±è´¹äº†å·¨å¤§çš„äººæƒ…å’Œä»£ä»·ï¼Œæœ€ç»ˆä¿ä½äº†åº—é“ºã€‚', effects: { cost: 1500, reputation: -5 } } }
    ]},
    { title: 'åŸå¸‚æ”¹é“', type: 'negative', desc: 'å› åŸå¸‚è§„åˆ’æ”¹é“ï¼Œä½ çš„åº—é“ºä»ç¹ååœ°æ®µå˜æˆäº†ååƒ»è§’è½ã€‚', options: [
        { text: 'ã€åšå®ˆåŸåœ°ã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„å®¢æµå¤§å‡ï¼Œç”Ÿæ„ä¸€è½åƒä¸ˆã€‚', effects: { multiplier: 0.5 } } },
        { text: 'ã€å¿ç—›æ¬è¿ã€‘ã€‚', req: { wealth: 2500 }, outcome: { text: 'ä½ èŠ±è´¹å·¨èµ„æ¬è¿åˆ°äº†æ–°å€ï¼Œä½†éœ€è¦é‡æ–°ç§¯ç´¯å®¢æˆ·ã€‚', effects: { cost: 2500, multiplier: 0.8 } } }
    ]},
    { title: 'ç¨æ”¶æ–°æ”¿', type: 'negative', desc: 'æœå»·å¯¹ä½ æ‰€åœ¨çš„è¡Œä¸šåŠ å¾é‡ç¨ï¼Œåˆ©æ¶¦ç©ºé—´è¢«ä¸¥é‡å‹ç¼©ã€‚', options: [
        { text: 'ã€åˆæ³•é¿ç¨ã€‘ã€‚', req: { wisdom: 80 }, outcome: { text: 'ä½ é€šè¿‡å¤æ‚çš„è´¦ç›®æ“ä½œï¼ŒæˆåŠŸè§„é¿äº†éƒ¨åˆ†ç¨æ¬¾ã€‚', effects: { multiplier: 0.9, virtue: -2 } } },
        { text: 'ã€ä¸Šä¹¦è¯·æ„¿ã€‘ã€‚', req: {}, outcome: { text: 'ä½ çš„è¯·æ„¿çŸ³æ²‰å¤§æµ·ï¼Œæ¯«æ— ä½œç”¨ã€‚', effects: { multiplier: 0.75 } } }
    ]},
    { title: 'å¤©ç¾äººç¥¸', type: 'negative', desc: 'ä¸€åœºè½»å¾®çš„åœ°éœ‡/æ°´ç¾æŸåäº†ä½ çš„åº—é“ºï¼Œéœ€è¦åœä¸šä¿®ç¼®ã€‚', options: [
        { text: 'ã€ç«‹å³ä¿®ç¼®ã€‘ã€‚', req: { wealth: 700 }, outcome: { text: 'ä½ èŠ±è´¹äº†700ä¸¤è¿›è¡Œä¿®ç¼®ï¼ŒæœŸé—´çš„åœä¸šä¹Ÿé€ æˆäº†æŸå¤±ã€‚', effects: { cost: 700, multiplier: 0.9 } } }
    ]}
];
// ===================== ã€è¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢ã€‘ =====================
const SEA_EXPLORATION_EVENTS = [
    // æ‚¨åŸæœ‰çš„7ä¸ªæ­£é¢äº‹ä»¶
    { title: 'å‘ç°æ–°èˆªè·¯', type: 'positive', desc: 'ä½ çš„èˆ¹é˜Ÿæ„å¤–å‘ç°äº†ä¸€æ¡æœªçŸ¥çš„æ–°èˆªè·¯ï¼Œå¤§å¤§ç¼©çŸ­äº†èˆªç¨‹ï¼', options: [
        { text: 'ã€è®°å½•èˆªè·¯ã€‘å¹¶ç«‹å³ä½¿ç”¨ã€‚', req: { wisdom: 60 }, outcome: { text: 'æ–°èˆªè·¯è®©ä½ èŠ‚çœäº†å¤§é‡æˆæœ¬ï¼Œæœ¬æ¬¡èˆªè¡Œåˆ©æ¶¦å¤§å¢ï¼', effects: { multiplier: 1.6 } } },
        { text: 'ã€å°†èˆªè·¯å›¾ã€‘é«˜ä»·å–ç»™å…¶ä»–å•†ä¼šã€‚', req: {}, outcome: { text: 'ä½ å–æ‰äº†èˆªè·¯å›¾ï¼Œè·å¾—äº†ä¸€ç¬”å·¨æ¬¾ã€‚', effects: { wealth: 5000 } } },
        { text: 'ã€ä¸ŠæŠ¥æœå»·ã€‘ã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ çš„è´¡çŒ®å¾—åˆ°äº†æœå»·çš„å˜‰å¥–ã€‚', effects: { reputation: 20, wealth: 1000 } } }
    ]},
    { title: 'å¶é‡å¼‚å›½å•†èˆ¹', type: 'positive', desc: 'ä½ çš„èˆ¹é˜Ÿåœ¨æµ·ä¸Šé‡åˆ°äº†ä¸€æ”¯å‹å¥½çš„å¼‚å›½å•†èˆ¹ï¼Œä»–ä»¬å¸Œæœ›ä¸ä½ äº¤æ¢è´§ç‰©ã€‚', options: [
        { text: 'ã€è¿›è¡Œäº¤æ¢ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ç”¨å»‰ä»·çš„è´§ç‰©æ¢æ¥äº†çç¨€çš„å¼‚åŸŸç‰¹äº§ï¼Œå¤§èµšä¸€ç¬”ï¼', effects: { multiplier: 1.5 } } },
        { text: 'ã€é‚€è¯·å¯¹æ–¹ã€‘åˆ°äº¬åŸåšå®¢ã€‚', req: { charm: 70 }, outcome: { text: 'ä½ ä¸å¼‚å›½å•†äººå»ºç«‹äº†é•¿æœŸåˆä½œå…³ç³»ã€‚', effects: { multiplier: 1.2, trade_partner: 1 } } },
        { text: 'ã€ä¿æŒè­¦æƒ•ã€‘æ‹’ç»äº¤æ˜“ã€‚', req: { wisdom: 50 }, outcome: { text: 'ä½ é€‰æ‹©å®‰å…¨ä¸ºä¸Šï¼Œé”™è¿‡äº†è¿™æ¬¡æœºä¼šã€‚', effects: {} } }
    ]},
    { title: 'å‘ç°æ— äººå²›', type: 'positive', desc: 'èˆ¹é˜Ÿå› èº²é¿é£æš´ï¼Œæ„å¤–å‘ç°äº†ä¸€åº§ç‰©äº§ä¸°å¯Œçš„æ— äººå²›ã€‚', options: [
        { text: 'ã€é‡‡é›†èµ„æºã€‘ã€‚', req: {}, outcome: { text: 'ä½ åœ¨å²›ä¸Šå‘ç°äº†çè´µçš„é¦™æ–™å’Œæœ¨æï¼Œä»·å€¼ä¸è²ã€‚', effects: { multiplier: 1.4 } } },
        { text: 'ã€å»ºç«‹æ®ç‚¹ã€‘ã€‚', req: { wealth: 2000, wisdom: 80 }, outcome: { text: 'ä½ æŠ•èµ„å»ºç«‹äº†ä¸­è½¬æ®ç‚¹ï¼Œæœªæ¥çš„èˆªè¡Œå°†æ›´åŠ å®‰å…¨é«˜æ•ˆã€‚', effects: { cost: 2000, exploration_bonus: 1 } } },
        { text: 'ã€ç»˜åˆ¶æµ·å›¾ã€‘è®°å½•ä½ç½®ã€‚', req: {}, outcome: { text: 'ä½ è·å¾—äº†å®è´µçš„æµ·å›¾èµ„æ–™ã€‚', effects: { wisdom: 5 } } }
    ]},
    { title: 'æ•‘åŠ©é‡éš¾èˆ¹åª', type: 'positive', desc: 'ä½ åœ¨æµ·ä¸Šæ•‘åŠ©äº†ä¸€è‰˜é‡éš¾çš„å•†èˆ¹ï¼Œèˆ¹ä¸»æ˜¯ä½å¤§äººç‰©ã€‚', options: [
        { text: 'ã€ä¸æ±‚å›æŠ¥ã€‘ã€‚', req: { virtue: 60 }, outcome: { text: 'ä½ çš„å–„ä¸¾èµ¢å¾—äº†å¯¹æ–¹çš„æ„Ÿæ¿€ï¼Œä»–æ‰¿è¯ºå°†æ¥å¿…æœ‰é‡æŠ¥ã€‚', effects: { virtue: 10, reputation: 5, future_favor: 1 } } },
        { text: 'ã€ç´¢è¦æŠ¥é…¬ã€‘ã€‚', req: {}, outcome: { text: 'ä½ è·å¾—äº†ä¸€ç¬”ä¸°åšçš„æŠ¥é…¬ã€‚', effects: { wealth: 3000 } } },
        { text: 'ã€é‚€è¯·å…¥è‚¡ã€‘ã€‚', req: { charm: 80 }, outcome: { text: 'å¯¹æ–¹æ¬£èµä½ çš„èƒ†è¯†ï¼Œå†³å®šæŠ•èµ„ä½ çš„èˆ¹é˜Ÿã€‚', effects: { wealth: 5000, cost: -5000 } } }
    ]},
    { title: 'ä¸€å¸†é£é¡º', type: 'positive', desc: 'æœ¬æ¬¡èˆªè¡Œå¾—åˆ°äº†æµ·ç¥çš„çœ·é¡¾ï¼Œä¸€è·¯é¡ºé£é¡ºæ°´ï¼Œæ¯”é¢„æœŸæ—©äº†åŠä¸ªæœˆæŠµè¾¾ã€‚', options: [
        { text: 'ã€èŠ‚çœå¼€é”€ã€‘ã€‚', req: {}, outcome: { text: 'æå‰æŠµè¾¾ä¸ºä½ èŠ‚çœäº†å¤§é‡çš„äººå‘˜å’Œè¡¥ç»™å¼€é”€ã€‚', effects: { multiplier: 1.25 } } },
        { text: 'ã€åˆ©ç”¨æ—¶é—´ã€‘è¿›è¡Œé¢å¤–äº¤æ˜“ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ åˆ©ç”¨å¤šå‡ºæ¥çš„æ—¶é—´åšäº†ä¸€ç¬”é¢å¤–çš„ç”Ÿæ„ï¼Œæ”¶ç›Šé¢‡ä¸°ã€‚', effects: { multiplier: 1.35 } } },
        { text: 'ã€è®©èˆ¹å‘˜ã€‘ä¼‘æ•´ã€‚', req: { virtue: 40 }, outcome: { text: 'èˆ¹å‘˜ä»¬å£«æ°”å¤§æŒ¯ï¼Œå¯¹ä½ æ›´åŠ å¿ è¯šã€‚', effects: { multiplier: 1.1, loyalty_boost: 1 } } }
    ]},
    { title: 'æ•è·çå¥‡æµ·å…½', type: 'positive', desc: 'ä½ çš„èˆ¹å‘˜æ„å¤–æ•è·äº†ä¸€å¤´ä¼ è¯´ä¸­çš„çå¥‡æµ·å…½ï¼', options: [
        { text: 'ã€çŒ®ç»™çš‡å¸ã€‘ã€‚', req: {}, outcome: { text: 'é¾™é¢œå¤§æ‚¦ï¼Œä½ è·å¾—äº†ä¸°åšçš„èµèµå’Œæ— ä¸Šçš„è£è€€ã€‚', effects: { wealth: 4000, reputation: 25 } } },
        { text: 'ã€é«˜ä»·æ‹å–ã€‘ã€‚', req: {}, outcome: { text: 'è¿™å¤´æµ·å…½åœ¨é»‘å¸‚ä¸Šå–å‡ºäº†å¤©ä»·ï¼', effects: { wealth: 8000 } } },
        { text: 'ã€æ”¾ç”Ÿã€‘ã€‚', req: { virtue: 70 }, outcome: { text: 'ä½ å°†æµ·å…½æ”¾å½’å¤§æµ·ï¼Œèˆ¹å‘˜ä»¬éƒ½è®¤ä¸ºä½ ç§¯äº†é˜´å¾·ã€‚', effects: { virtue: 15, luck_boost: 1 } } }
    ]},
    { title: 'æ‰“æåˆ°æ²‰èˆ¹å®è—', type: 'positive', desc: 'èˆ¹é˜Ÿåœ¨æµ…æµ·åŒºæ„å¤–æ‰“æåˆ°äº†ä¸€ä¸ªå‰æœçš„æ²‰èˆ¹å®ç®±ï¼', options: [
        { text: 'ã€æ‰“å¼€å®ç®±ã€‘ã€‚', req: {}, outcome: { text: 'å®ç®±é‡Œè£…æ»¡äº†é‡‘é“¶ç å®ï¼', effects: { wealth: 10000 } } },
        { text: 'ã€å°†å®ç®±ã€‘ä¸Šäº¤ã€‚', req: {}, outcome: { text: 'ä½ å°†å®è—ä¸Šäº¤ï¼Œè·å¾—äº†å®˜åºœçš„å¥–åŠ±ã€‚', effects: { wealth: 5000, reputation: 10 } } },
        { text: 'ã€ç§ä¸‹åˆ†ç»™ã€‘èˆ¹å‘˜ã€‚', req: { virtue: 60 }, outcome: { text: 'ä½ å°†è´¢å®åˆ†ç»™äº†èˆ¹å‘˜ï¼Œä»–ä»¬æ„¿ä¸ºä½ èµ´æ±¤è¹ˆç«ï¼', effects: { wealth: 2000, loyalty_boost: 2 } } }
    ]},
    // æ‚¨åŸæœ‰çš„8ä¸ªè´Ÿé¢äº‹ä»¶
    { title: 'è—ç¾æ¥è¢­', type: 'negative', desc: 'é®å¤©è”½æ—¥çš„è—è™«å‘ä½ çš„ç”°åœ°è¢­æ¥ï¼', options: [
        { text: 'ã€èŠ±è´¹å·¨èµ„ã€‘é›‡äººæ•è—ã€‚', req: { wealth: 800 }, outcome: { text: 'è™½ç„¶èŠ±è´¹å·¨å¤§ï¼Œä½†ä½ ä¿ä½äº†å¤§éƒ¨åˆ†æ”¶æˆã€‚', effects: { multiplier: 0.8, cost: 800 } } },
        { text: 'ã€å¬å¤©ç”±å‘½ã€‘ç¥ˆæ±‚ç¥æ˜ä¿ä½‘ã€‚', req: {}, outcome: { text: 'ä½ çš„ç”°åœ°æŸå¤±æƒ¨é‡ï¼Œå‡ ä¹é¢—ç²’æ— æ”¶ã€‚', effects: { multiplier: 0.1, cost: 0 } } },
        { text: 'ã€ä½¿ç”¨åæ–¹ã€‘ä»¥çƒŸç†é©±èµ¶ã€‚', req: { wisdom: 40 }, outcome: { text: 'åæ–¹æœ‰ä¸€å®šæ•ˆæœï¼Œä½†ä»æœ‰ä¸å°çš„æŸå¤±ã€‚', effects: { multiplier: 0.5, cost: 100 } } }
    ]},
    { title: 'é­é‡æ—±ç¾', type: 'negative', desc: 'è¿ç»­æ•°æœˆæœªä¸‹é›¨ï¼ŒåœŸåœ°å¹²è£‚ï¼Œä½œç‰©æ¯é»„ã€‚', options: [
        { text: 'ã€é‡é‡‘é›‡äººã€‘ä»è¿œå¤„è¿æ°´çŒæº‰ã€‚', req: { wealth: 1000 }, outcome: { text: 'é«˜æ˜‚çš„æˆæœ¬è®©ä½ å‡ ä¹æ²¡æœ‰åˆ©æ¶¦ï¼Œä½†æ€»ç®—ä¿ä½äº†æ”¶æˆã€‚', effects: { multiplier: 0.9, cost: 1000 } } },
        { text: 'ã€å‘é¾™ç‹åº™ã€‘æ±‚é›¨ã€‚', req: {}, outcome: { text: 'æ±‚é›¨å¹¶æœªæˆåŠŸï¼Œä½ çš„ä½œç‰©å¤§éƒ¨åˆ†éƒ½æ¯æ­»äº†ã€‚', effects: { multiplier: 0.2, cost: 50 } } },
        { text: 'ã€å˜å–éƒ¨åˆ†åœŸåœ°ã€‘æ¢å–èµ„é‡‘ä¿ä½æ ¸å¿ƒç”°äº§ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ å£®å£«æ–­è…•ï¼Œä¿ä½äº†æœ€é‡è¦çš„ç”°åœ°ï¼Œä½†æŸå¤±äº†ä¸€éƒ¨åˆ†äº§ä¸šã€‚', effects: { multiplier: 0.8, land_loss: 1 } } }
    ]},
    { title: 'æ¶éœ¸è§Šè§', type: 'negative', desc: 'é™„è¿‘çš„åœ°ä¸»æ¶éœ¸çœ‹ä¸Šäº†ä½ çš„è‰¯ç”°ï¼Œæ´¾äººå‰æ¥æ»‹äº‹ï¼Œé˜»æŒ è€•ä½œã€‚', options: [
        { text: 'ã€æŠ¥å®˜å¤„ç†ã€‘ã€‚', req: {}, outcome: { text: 'å®˜åºœæ•·è¡äº†äº‹ï¼Œé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œè¿˜è€½è¯¯äº†å†œæ—¶ã€‚', effects: { multiplier: 0.7, cost: 100 } } },
        { text: 'ã€é›‡ä½£æŠ¤é™¢ã€‘æ­¦åŠ›å¯¹æŠ—ã€‚', req: { wealth: 500 }, outcome: { text: 'ä½ æˆåŠŸèµ¶èµ°äº†æ¶éœ¸ï¼Œä½†åŒæ–¹ç»“ä¸‹äº†æ¢å­ã€‚', effects: { multiplier: 0.9, cost: 500 } } },
        { text: 'ã€æ‰˜å…³ç³»ã€‘è¯·ä¸€ä½ä¹¡ç»…å‡ºé¢è°ƒè§£ã€‚', req: { charm: 60 }, outcome: { text: 'ä½ èŠ±è´¹äººæƒ…å’Œé‡‘é’±ï¼Œæš‚æ—¶å¹³æ¯äº†äº‹ç«¯ã€‚', effects: { multiplier: 0.85, cost: 300 } } }
    ]},
    { title: 'å†œæˆ·ç”Ÿå˜', type: 'negative', desc: 'ä½ æ‰‹ä¸‹çš„å†œæˆ·ä»¬å› å·¥é’±é—®é¢˜é›†ä½“æ€ å·¥ï¼Œå¨èƒè¦ç¦»å¼€ã€‚', options: [
        { text: 'ã€å¼ºç¡¬é•‡å‹ã€‘å¹¶å¦å¯»å†œæˆ·ã€‚', req: {}, outcome: { text: 'ä½ çš„å¼ºç¡¬å¯¼è‡´å†œæˆ·å…¨éƒ¨ç¦»å¼€ï¼Œæ–°æ‰¾çš„äººä¸ç†Ÿæ‚‰ç”°åœ°ï¼Œæ”¶æˆå¤§å‡ã€‚', effects: { multiplier: 0.4, virtue: -5 } } },
        { text: 'ã€æ‰¿è¯ºåŠ è–ªã€‘å®‰æŠšäººå¿ƒã€‚', req: { wealth: 400 }, outcome: { text: 'ä½ å¢åŠ äº†æ”¯å‡ºï¼Œç¨³ä½äº†å†œæˆ·ï¼Œä½†åˆ©æ¶¦é™ä½äº†ã€‚', effects: { multiplier: 0.8, cost: 400 } } },
        { text: 'ã€ç”»å¤§é¥¼ã€‘æ‰¿è¯ºä¸°æ”¶åæœ‰é‡èµã€‚', req: { charm: 70 }, outcome: { text: 'ä½ æˆåŠŸè¯´æœäº†å†œæˆ·ï¼Œä½†å¦‚æœå¹´åº•æ— æ³•å…‘ç°ï¼Œä½ çš„ä¿¡èª‰å°†ç ´äº§ã€‚', effects: { multiplier: 0.9, reputation_risk: 1 } } }
    ]},
    { title: 'ç”°å¥‘çº çº·', type: 'negative', desc: 'æœ‰äººæ‹¿ç€ä¸€å¼ æ—§åœ°å¥‘æ‰¾ä¸Šé—¨æ¥ï¼Œå£°ç§°è¿™ç‰‡åœŸåœ°æ˜¯ä»–ä»¬å®¶çš„ï¼Œè¦æ±‚ä½ å½’è¿˜ã€‚', options: [
        { text: 'ã€å¯¹ç°¿å…¬å ‚ã€‘ã€‚', req: {}, outcome: { text: 'æ¼«é•¿çš„å®˜å¸è€—è´¹äº†ä½ å¤§é‡é‡‘é’±å’Œç²¾åŠ›ï¼Œæ— è®ºè¾“èµ¢éƒ½å½±å“äº†æ”¶æˆã€‚', effects: { multiplier: 0.6, cost: 600 } } },
        { text: 'ã€ç ´è´¢æ¶ˆç¾ã€‘ç»™å¯¹æ–¹ä¸€ç¬”é’±äº†äº‹ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ èŠ±é’±ä¹°äº†ä¸ªæ¸…é™ã€‚', effects: { cost: 1000 } } },
        { text: 'ã€æš—ä¸­è°ƒæŸ¥ã€‘å¯¹æ–¹çš„åº•ç»†ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ å‘ç°å¯¹æ–¹æ˜¯èŒä¸šéª—å­ï¼ŒæˆåŠŸæ­ç©¿äº†ä»–ä»¬ï¼', effects: { reputation: 5, wisdom: 2 } } }
    ]},
    { title: 'è«åç˜Ÿç—…', type: 'negative', desc: 'ä½ çš„ç”°é‡Œçˆ†å‘äº†ä¸€åœºå¥‡æ€ªçš„æ¤ç‰©ç˜Ÿç—…ï¼Œè¿…é€Ÿè”“å»¶ã€‚', options: [
        { text: 'ã€è¯·æ•™è€å†œã€‘ä½¿ç”¨åœŸæ–¹ã€‚', req: {}, outcome: { text: 'åœŸæ–¹æ•ˆæœæœ‰é™ï¼ŒæŸå¤±ä¾ç„¶ä¸å°ã€‚', effects: { multiplier: 0.6 } } },
        { text: 'ã€å¿ç—›ç„šçƒ§ã€‘ç—…æ ªï¼Œé˜²æ­¢è”“å»¶ã€‚', req: { virtue: 30 }, outcome: { text: 'ä½ æœæ–­çš„å†³å®šä¿ä½äº†å¤§éƒ¨åˆ†ç”°åœ°ï¼Œä½†çƒ§æ¯çš„éƒ¨åˆ†é¢—ç²’æ— æ”¶ã€‚', effects: { multiplier: 0.7 } } },
        { text: 'ã€å¯»è®¿ååŒ»ã€‘é…ç½®è¯æ°´ã€‚', req: { wealth: 600 }, outcome: { text: 'æ˜‚è´µçš„è¯æ°´æ§åˆ¶ä½äº†ç—…æƒ…ï¼Œä½†æˆæœ¬é«˜æ˜‚ã€‚', effects: { multiplier: 0.8, cost: 600 } } }
    ]},
    { title: 'å®˜åºœåŠ ç¨', type: 'negative', desc: 'æœå»·è´¢æ”¿ç´§å¼ ï¼Œçªç„¶å®£å¸ƒåŠ å¾å†œä¸šç¨ã€‚', options: [
        { text: 'ã€è¶³é¢ç¼´çº³ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ç¼´çº³äº†é¢å¤–çš„ç¨æ¬¾ï¼Œåˆ©æ¶¦å¤§å¹…å‡å°‘ã€‚', effects: { multiplier: 0.75 } } },
        { text: 'ã€è¯•å›¾ç’æŠ¥ã€‘éƒ¨åˆ†ç”°äº§ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ ä¾¥å¹¸æˆåŠŸï¼Œä½†ä¸€æ—¦è¢«å‘ç°å°†é¢ä¸´é‡ç½šã€‚', effects: { multiplier: 0.9, risk: 'heavy_fine' } } },
        { text: 'ã€è”ç»œä¹¡ç»…ã€‘å…±åŒå‘å®˜åºœè¯·æ„¿ã€‚', req: { charm: 70 }, outcome: { text: 'ä½ ä»¬çš„è¯·æ„¿æœ‰äº†ä¸€å®šæ•ˆæœï¼Œç¨ç‡ç•¥æœ‰ä¸‹è°ƒã€‚', effects: { multiplier: 0.85, reputation: 5 } } }
    ]},
    { title: 'ä»“åº“å¤±ç«', type: 'negative', desc: 'å­˜æ”¾ç§å­çš„ä»“åº“æ„å¤–å¤±ç«ï¼Œå¤§é‡å‚¨å¤‡è¢«çƒ§æ¯ã€‚', options: [
        { text: 'ã€ç´§æ€¥é«˜ä»·ã€‘ä»å¸‚åœºè´­å…¥ç§å­ã€‚', req: {}, outcome: { text: 'ä½ ä¸å¾—ä¸é«˜ä»·ä¹°å…¥ç§å­ï¼Œä¸¥é‡å½±å“äº†æœ¬å­£çš„åˆ©æ¶¦ã€‚', effects: { multiplier: 0.8, cost: 500 } } },
        { text: 'ã€å‡å°‘æ’­ç§ã€‘é¢ç§¯ã€‚', req: {}, outcome: { text: 'ä½ è¢«è¿«å‡å°‘äº†æ’­ç§é¢ç§¯ï¼Œæœ¬å­£æ”¶æˆæ³¨å®šæƒ¨æ·¡ã€‚', effects: { multiplier: 0.5 } } },
        { text: 'ã€å‘é‚»é‡Œã€‘æ±‚åŠ©å€Ÿç§ã€‚', req: { virtue: 50 }, outcome: { text: 'ä½ çš„å¥½äººç¼˜è®©ä½ å€Ÿåˆ°äº†ç§å­ï¼Œä½†æ¬ ä¸‹äº†äººæƒ…ã€‚', effects: { multiplier: 0.9, reputation: -5 } } }
    ]},
    // â–¼â–¼â–¼ ã€æ–°å¢20ä¸ªè¿œæ´‹æ¢ç´¢äº‹ä»¶ã€‘ â–¼â–¼â–¼
    // --- 10ä¸ªæ­£é¢äº‹ä»¶ ---
    { title: 'é²¸ç¾¤å¼•è·¯', type: 'positive', desc: 'ä¸€ç¾¤å·¨å¤§çš„é²¸é±¼å‡ºç°åœ¨ä½ çš„èˆªçº¿ä¸Šï¼Œå®ƒä»¬ä¼¼ä¹åœ¨ä¸ºä½ å¼•è·¯ï¼Œé¿å¼€äº†æš—æµã€‚', options: [
        { text: 'ã€è·Ÿéšå‰è¡Œã€‘ã€‚', req: {}, outcome: { text: 'é²¸ç¾¤å°†ä½ å¸¦åˆ°äº†ä¸€ç‰‡æ¸”äº§ä¸°å¯Œçš„æµ·åŸŸï¼Œèˆ¹å‘˜ä»¬æ”¶è·é¢‡ä¸°ã€‚', effects: { multiplier: 1.2, loyalty_boost: 1 } } },
        { text: 'ã€å¿ƒå­˜æ•¬ç•ã€‘ï¼Œä¿æŒè·ç¦»ã€‚', req: {}, outcome: { text: 'ä½ å¯¹è‡ªç„¶çš„æ•¬ç•è®©èˆ¹å‘˜ä»¬é¢‡ä¸ºè®¤åŒã€‚', effects: { virtue: 3 } } }
    ]},
    { title: 'èˆ¹å‘˜çš„æ‰è‰º', type: 'positive', desc: 'ä¸€ä½ä¸èµ·çœ¼çš„æ°´æ‰‹åœ¨ç”²æ¿ä¸Šç”¨å°åˆ€é›•åˆ»æœ¨å¤´ï¼Œä½œå“æ ©æ ©å¦‚ç”Ÿï¼ŒæŠ€è‰ºæƒŠäººã€‚', options: [
        { text: 'ã€è®©ä»–ä¸“èŒã€‘å·¥è‰ºå“åˆ›ä½œã€‚', req: {}, outcome: { text: 'èˆ¹å‘˜ä»¬åˆ©ç”¨èˆªè¡Œæ—¶é—´åˆ›ä½œäº†ä¸€æ‰¹ç²¾ç¾çš„å·¥è‰ºå“ï¼ŒæŠµè¾¾æ¸¯å£åå–å‡ºäº†å¥½ä»·é’±ã€‚', effects: { multiplier: 1.25 } } },
        { text: 'ã€å¤§åŠ èµèµã€‘å¹¶ç»™äºˆå¥–åŠ±ã€‚', req: { wealth: 100 }, outcome: { text: 'ä½ çš„èµèµå’Œå¥–åŠ±æå¤§åœ°é¼“èˆäº†å£«æ°”ã€‚', effects: { cost: 100, loyalty_boost: 1 } } }
    ]},
    { title: 'ç¥ç§˜çš„é›¾ä¸­å²›', type: 'positive', desc: 'å¤§é›¾æ•£å»åï¼Œä¸€åº§æµ·å›¾ä¸Šä»æœªæ ‡è®°è¿‡çš„å²›å±¿å‡ºç°åœ¨çœ¼å‰ï¼Œå²›ä¸Šä¼ æ¥æ‚¦è€³çš„æ­Œå£°ã€‚', options: [
        { text: 'ã€ç™»å²›æ¢æŸ¥ã€‘ã€‚', req: { martial: 50 }, outcome: { text: 'å²›ä¸Šå±…ä½ç€ä¸€ä¸ªä¸ä¸–éš”ç»çš„éƒ¨è½ï¼Œä»–ä»¬çƒ­æƒ…åœ°æ¥å¾…äº†ä½ ï¼Œå¹¶ä¸ä½ äº¤æ¢äº†çè´µçš„ç‰¹äº§ã€‚', effects: { multiplier: 1.4, wisdom: 2 } } },
        { text: 'ã€è®¤ä¸ºæœ‰å¦–ã€‘ï¼Œè¿…é€Ÿç¦»å¼€ã€‚', req: {}, outcome: { text: 'ä½ é€‰æ‹©è°¨æ…è¡Œäº‹ï¼Œç¦»å¼€äº†è¿™ç‰‡ç¥ç§˜çš„æµ·åŸŸã€‚', effects: {} } }
    ]},
    { title: 'æµ·ä¸Šæµ®å¸‚', type: 'positive', desc: 'ä½ ä»¬é‡åˆ°äº†ä¸€æ”¯ç”±æ•°åè‰˜å°èˆ¹ç»„æˆçš„çš„æµ·ä¸Šé›†å¸‚ï¼Œé™„è¿‘çš„æ¸”æ°‘éƒ½åœ¨æ­¤äº¤æ˜“ã€‚', options: [
        { text: 'ã€å‚ä¸äº¤æ˜“ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ç”¨èˆ¹ä¸Šçš„å·¥å…·æ¢å–äº†å¤§é‡å»‰ä»·çš„çç å’ŒçŠç‘šï¼Œåˆ©æ¶¦å¯è§‚ã€‚', effects: { multiplier: 1.3 } } },
        { text: 'ã€æ‰“æ¢æ¶ˆæ¯ã€‘ã€‚', req: { charm: 50 }, outcome: { text: 'ä½ ä»æ¸”æ°‘å£ä¸­å¾—çŸ¥äº†é™„è¿‘æµ·ç›—çš„åŠ¨å‘ï¼ŒæˆåŠŸé¿å¼€äº†å±é™©ã€‚', effects: { pirate_chance_modifier: -0.5 } } }
    ]},
    { title: 'å¤©è±¡å¼‚å˜', type: 'positive', desc: 'å¤©ç©ºä¸­å‡ºç°äº†ç»šä¸½çš„æå…‰ï¼Œèˆ¹å‘˜ä»¬ä»æœªè§è¿‡æ­¤ç­‰å¥‡æ™¯ï¼Œçº·çº·è·ªæ‹œï¼Œè®¤ä¸ºæ˜¯æµ·ç¥çš„ç¥ç¦ã€‚', options: [
        { text: 'ã€é¼“èˆå£«æ°”ã€‘ã€‚', req: {}, outcome: { text: 'èˆ¹å‘˜ä»¬è®¤ä¸ºè¿™æ˜¯ç¥¥ç‘ä¹‹å…†ï¼Œå£«æ°”å¤§æŒ¯ï¼Œå·¥ä½œæ•ˆç‡æé«˜ã€‚', effects: { multiplier: 1.15, loyalty_boost: 2 } } }
    ]},
    { title: 'æ—§å‹é‡é€¢', type: 'positive', desc: 'åœ¨å¼‚å›½æ¸¯å£ï¼Œä½ ç«Ÿç„¶é‡é€¢äº†ä¸€ä½å¤šå¹´æœªè§çš„æ—§å‹ï¼', options: [
        { text: 'ã€æŠŠé…’è¨€æ¬¢ã€‘ã€‚', req: {}, outcome: { text: 'æ•…äººé‡é€¢ï¼Œåˆ†å¤–å–œæ‚¦ã€‚ä»–è¿˜ä¸ºä½ ä»‹ç»äº†ä¸€ä½å½“åœ°çš„å¤§å•†äººã€‚', effects: { reputation: 5, trade_partner: 1 } } },
        { text: 'ã€å™æ—§åŒ†åŒ†ã€‘ã€‚', req: {}, outcome: { text: 'ä½ ä»¬ç®€å•å™æ—§åä¾¿åŒ†åŒ†å‘Šåˆ«ã€‚', effects: {} } }
    ]},
    { title: 'å¤–äº¤çªç ´', type: 'positive', desc: 'ä½ æºå¸¦çš„å›½ä¹¦å’Œç¤¼ç‰©æ·±å¾—å½“åœ°ç»Ÿæ²»è€…çš„æ¬¢å¿ƒï¼Œå¯¹æ–¹å†³å®šç»™äºˆä½ ç‰¹æ®Šçš„è´¸æ˜“ä¼˜å¾…ã€‚', options: [
        { text: 'ã€ç­¾è®¢åè®®ã€‘ã€‚', req: { etiquette: 70 }, outcome: { text: 'ä½ è·å¾—äº†åœ¨è¯¥å›½æ¸¯å£çš„å…ç¨ç‰¹æƒï¼Œåˆ©æ¶¦å¤§å¢ï¼', effects: { multiplier: 1.5, reputation: 10 } } }
    ]},
    { title: 'å‘ç°é¦™æ–™ç¾¤å²›', type: 'positive', desc: 'ä½ çš„èˆ¹é˜Ÿåç¦»èˆªçº¿ï¼Œå´æ„å¤–å‘ç°äº†ä¸€ç‰‡ç››äº§é¡¶çº§é¦™æ–™çš„ç¾¤å²›ï¼', options: [
        { text: 'ã€ç§˜å¯†å¼€é‡‡ã€‘ã€‚', req: {}, outcome: { text: 'ä½ è·å¾—äº†ä»·å€¼è¿åŸçš„é¦™æ–™ï¼Œè¿™è¶³ä»¥è®©ä½ å¯Œç”²ä¸€æ–¹ï¼', effects: { multiplier: 2.5, virtue: -5 } } },
        { text: 'ã€ä¸å½“åœ°åœŸè‘—ã€‘å…¬å¹³äº¤æ˜“ã€‚', req: { virtue: 60 }, outcome: { text: 'ä½ çš„å…¬å¹³äº¤æ˜“èµ¢å¾—äº†åœŸè‘—çš„å‹è°Šï¼Œä½ è·å¾—äº†ç¨³å®šçš„é¦™æ–™æ¥æºã€‚', effects: { multiplier: 1.8, trade_partner: 1 } } }
    ]},
    { title: 'æ”¶åˆ°å®¶ä¹¦', type: 'positive', desc: 'ä¸€è‰˜è¿”èˆªçš„å•†èˆ¹ä¸ºä½ å¸¦æ¥äº†å®¶äººçš„ä¹¦ä¿¡ï¼ŒæŠ¥å¹³å®‰çš„åŒæ—¶ä¹Ÿå……æ»¡äº†æ€å¿µã€‚', options: [
        { text: 'ã€ä¸èˆ¹å‘˜åˆ†äº«ã€‘å–œæ‚¦ã€‚', req: {}, outcome: { text: 'å®¶äººçš„æ¶ˆæ¯è®©æ‰€æœ‰äººéƒ½å€æ„Ÿæ¸©æš–ï¼Œæš‚æ—¶ç¼“è§£äº†æ€ä¹¡ä¹‹æƒ…ï¼Œå£«æ°”é«˜æ¶¨ã€‚', effects: { loyalty_boost: 1 } } }
    ]},
    { title: 'æ¡åˆ°é¾™æ¶é¦™', type: 'positive', desc: 'èˆ¹å‘˜åœ¨æµ·æ»©ä¸Šå‘ç°äº†ä¸€å—å…¶è²Œä¸æ‰¬çš„èœ¡çŠ¶ç‰©ï¼Œç»é‰´å®šç«Ÿæ˜¯ä¼ è¯´ä¸­çš„é¾™æ¶é¦™ï¼', options: [
        { text: 'ã€å¦¥å–„ä¿ç®¡ã€‘ã€‚', req: {}, outcome: { text: 'è¿™å—é¾™æ¶é¦™ä»·å€¼è¿åŸï¼Œæ˜¯ä½ æ­¤è¡Œæœ€å¤§çš„æ”¶è·ï¼', effects: { wealth: 15000 } } }
    ]},
    // --- 10ä¸ªè´Ÿé¢äº‹ä»¶ ---
    { title: 'ä¸»å¸†æ–­è£‚', type: 'negative', desc: 'åœ¨ä¸€æ¬¡å¼ºé£ä¸­ï¼Œèˆ¹é˜Ÿçš„ä¸»å¸†è¢«æ’•è£‚ï¼Œèˆ¹åªå¤±å»äº†å¤§éƒ¨åˆ†åŠ¨åŠ›ã€‚', options: [
        { text: 'ã€ç´§æ€¥ä¿®å¤ã€‘ã€‚', req: {}, outcome: { text: 'èˆ¹å‘˜ä»¬å…¨åŠ›æŠ¢ä¿®ï¼Œä½†èˆªç¨‹è¿˜æ˜¯è¢«å¤§å¤§å»¶è¯¯äº†ã€‚', effects: { multiplier: 0.8 } } },
        { text: 'ã€å¯»æ‰¾æ¸¯å£ã€‘ä¿®ç†ã€‚', req: { wealth: 1200 }, outcome: { text: 'ä½ èŠ±è´¹é‡é‡‘åœ¨é™„è¿‘æ¸¯å£ä¿®ç†äº†èˆ¹å¸†ï¼Œæˆæœ¬å¤§å¢ã€‚', effects: { cost: 1200, multiplier: 0.85 } } }
    ]},
    { title: 'é£Ÿç‰©ä¸­æ¯’', type: 'negative', desc: 'éƒ¨åˆ†èˆ¹å‘˜å› è¯¯é£Ÿæœ‰æ¯’çš„æµ·é±¼ï¼Œä¸Šåä¸‹æ³»ï¼Œå¤±å»äº†æˆ˜æ–—åŠ›ã€‚', options: [
        { text: 'ã€ä½¿ç”¨å¤‡ç”¨è¯æã€‘æ²»ç–—ã€‚', req: {}, outcome: { text: 'ä½ æ¶ˆè€—äº†çè´µçš„è¯æï¼Œç¨³å®šäº†èˆ¹å‘˜çš„ç—…æƒ…ã€‚', effects: { cost: 300 } } },
        { text: 'ã€éš”ç¦»è§‚å¯Ÿã€‘ã€‚', req: {}, outcome: { text: 'ä½ åªèƒ½éš”ç¦»ä»–ä»¬ï¼Œç¥ˆç¥·ä»–ä»¬èƒ½è‡ªå·±æ‰›è¿‡å»ã€‚', effects: { loyalty_boost: -1 } } }
    ]},
    { title: 'æµ·å›¾é”™è¯¯', type: 'negative', desc: 'ä½ ä»¬æƒŠæåœ°å‘ç°ï¼Œæ‰‹ä¸­çš„æµ·å›¾ä¸å®é™…æ°´æ–‡ä¸¥é‡ä¸ç¬¦ï¼Œä½ ä»¬è¿·èˆªäº†ï¼', options: [
        { text: 'ã€é è§‚æ˜Ÿã€‘è¾¨åˆ«æ–¹å‘ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ å‡­å€Ÿä¸°å¯Œçš„çŸ¥è¯†é‡æ–°å®šä½ï¼Œä½†è¿˜æ˜¯æµªè´¹äº†ä¸å°‘æ—¶é—´ã€‚', effects: { multiplier: 0.85 } } },
        { text: 'ã€æ²¿æµ·å²¸çº¿ã€‘èˆªè¡Œã€‚', req: {}, outcome: { text: 'æ²¿å²¸èˆªè¡Œè™½å®‰å…¨ä½†ç¼“æ…¢ï¼Œå¤§å¤§å¢åŠ äº†èˆªè¡Œæˆæœ¬ã€‚', effects: { multiplier: 0.75 } } }
    ]},
    { title: 'é­é‡å·¨å‹ç« é±¼', type: 'negative', desc: 'ä¸€åªå·¨å¤§çš„ç« é±¼ç¼ ä½äº†ä½ çš„èˆ¹ï¼èˆ¹å‘˜ä»¬å“å¾—é­‚é£é­„æ•£ã€‚', options: [
        { text: 'ã€é›†ç«æ”»å‡»ã€‘ã€‚', req: { martial: 60 }, outcome: { text: 'ä½ ä»¬å‡»é€€äº†å·¨å…½ï¼Œä½†èˆ¹åªä¹Ÿå—åˆ°äº†ä¸€äº›æŸä¼¤ã€‚', effects: { multiplier: 0.9 } } },
        { text: 'ã€æŠ•æ·é£Ÿç‰©ã€‘å¸å¼•å…¶æ³¨æ„åŠ›ã€‚', req: {}, outcome: { text: 'ä½ ä¸¢å¼ƒäº†éƒ¨åˆ†è´§ç‰©ï¼ŒæˆåŠŸå¼•å¼€äº†å®ƒã€‚', effects: { multiplier: 0.8 } } }
    ]},
    { title: 'å†…éƒ¨å‡ºç°å°å·', type: 'negative', desc: 'èˆ¹ä¸Šå‘ç”Ÿäº†å¤±çªƒäº‹ä»¶ï¼Œä¸€åèˆ¹å‘˜çš„è´¢ç‰©è¢«ç›—ï¼Œå¯¼è‡´å†…éƒ¨çŒœå¿Œï¼Œäººå¿ƒæƒ¶æƒ¶ã€‚', options: [
        { text: 'ã€ä¸¥æŸ¥åˆ°åº•ã€‘ã€‚', req: { wisdom: 60 }, outcome: { text: 'ä½ æˆåŠŸæŠ“åˆ°äº†å°å·ï¼Œæ¢å¤äº†ç§©åºã€‚', effects: { loyalty_boost: 1 } } },
        { text: 'ã€è‡ªæè…°åŒ…ã€‘å¼¥è¡¥æŸå¤±ã€‚', req: { virtue: 50, wealth: 200 }, outcome: { text: 'ä½ çš„æ…·æ…¨æš‚æ—¶å®‰æŠšäº†ä¼—äººã€‚', effects: { cost: 200, virtue: 3 } } }
    ]},
    { title: 'æ€ä¹¡ç—…è”“å»¶', type: 'negative', desc: 'é•¿æ—¶é—´çš„èˆªè¡Œè®©èˆ¹å‘˜ä»¬å¼€å§‹è”“å»¶æ€ä¹¡ç—…ï¼Œå£«æ°”æŒç»­ä½è½ã€‚', options: [
        { text: 'ã€ç»„ç»‡å¨±ä¹æ´»åŠ¨ã€‘ã€‚', req: { charm: 60 }, outcome: { text: 'ä½ ç»„ç»‡çš„æ´»åŠ¨æš‚æ—¶æå‡äº†å£«æ°”ã€‚', effects: { loyalty_boost: 1 } } },
        { text: 'ã€æ‰¿è¯ºåŒå€é…¬åŠ³ã€‘ã€‚', req: { wealth: 1000 }, outcome: { text: 'é‡‘é’±çš„åˆºæ¿€è®©èˆ¹å‘˜ä»¬æš‚æ—¶å¿˜å´äº†æ€ä¹¡ä¹‹æƒ…ã€‚', effects: { cost: 1000, multiplier: 0.9 } } }
    ]},
    { title: 'é­é‡å®˜æ–¹ç›˜æŸ¥', type: 'negative', desc: 'ä¸€é˜Ÿå¼‚å›½çš„æ°´å¸ˆèˆ¹åªæ‹¦ä½äº†ä½ ï¼Œè¦æ±‚ç™»èˆ¹è¿›è¡Œä¸¥æ ¼ç›˜æŸ¥ã€‚', options: [
        { text: 'ã€æ¬£ç„¶æ¥å—ã€‘ç›˜æŸ¥ã€‚', req: {}, outcome: { text: 'ç›˜æŸ¥è€½è¯¯äº†å¤§é‡æ—¶é—´ï¼Œå½±å“äº†äº¤è´§æœŸã€‚', effects: { multiplier: 0.9 } } },
        { text: 'ã€è´¿èµ‚ã€‘å®˜å‘˜ã€‚', req: { wealth: 1000 }, outcome: { text: 'ä½ èŠ±é’±å…å»äº†ç¹ççš„ç›˜æŸ¥ã€‚', effects: { cost: 1000, virtue: -3 } } }
    ]},
    { title: 'è´§ç‰©å—æ½®', type: 'negative', desc: 'å› èˆ¹èˆ±å¯†å°ä¸ä¸¥ï¼Œä¸€éƒ¨åˆ†å®³æ€•æ½®æ¹¿çš„è´§ç‰©ï¼ˆå¦‚èŒ¶å¶ã€ä¸ç»¸ï¼‰å“è´¨ä¸‹é™ã€‚', options: [
        { text: 'ã€ç´§æ€¥æ™¾æ™’ã€‘å¤„ç†ã€‚', req: {}, outcome: { text: 'ç´§æ€¥å¤„ç†æŒ½å›äº†ä¸€éƒ¨åˆ†æŸå¤±ï¼Œä½†å“è´¨è¿˜æ˜¯å—æŸäº†ã€‚', effects: { multiplier: 0.85 } } },
        { text: 'ã€ä½ä»·å¤„ç†ã€‘ç»™èˆ¹å‘˜ã€‚', req: { virtue: 40 }, outcome: { text: 'ä½ å°†å—æŸè´§ç‰©ä½ä»·å–ç»™èˆ¹å‘˜ï¼Œè·å¾—äº†ä»–ä»¬çš„å¥½æ„Ÿã€‚', effects: { multiplier: 0.8, loyalty_boost: 1 } } }
    ]},
    { title: 'é‡è¦èˆ¹å‘˜ç—…å€’', type: 'negative', desc: 'ä½ çš„å¤§å‰¯/é¢†èˆªå‘˜çªç„¶ç—…å€’ï¼Œæ— äººèƒ½å¤Ÿå®Œå…¨æ¥æ›¿å…¶å·¥ä½œã€‚', options: [
        { text: 'ã€ä½ äº²è‡ªã€‘æ¥ç®¡ã€‚', req: { wisdom: 70 }, outcome: { text: 'ä½ å‡­å€Ÿè‡ªå·±çš„èƒ½åŠ›ç¨³ä½äº†èˆ¹é˜Ÿï¼Œä½†å¿ƒåŠ›äº¤ç˜ã€‚', effects: { multiplier: 0.9, health: -5 } } },
        { text: 'ã€ææ‹”æ–°äººã€‘ã€‚', req: {}, outcome: { text: 'æ–°äººç»éªŒä¸è¶³ï¼Œå¯¼è‡´èˆªè¡Œæ•ˆç‡é™ä½ã€‚', effects: { multiplier: 0.8 } } }
    ]},
    { title: 'é­é‡ç¾äººé±¼çš„æ­Œå£°', type: 'negative', desc: 'æµ·ä¸Šä¼ æ¥è¿·é­‚çš„æ­Œå£°ï¼Œèˆ¹å‘˜ä»¬çº·çº·è¢«è¿·æƒ‘ï¼Œèˆ¹åªæ­£é©¶å‘å±é™©çš„æš—ç¤ï¼', options: [
        { text: 'ã€å µä½è€³æœµã€‘ï¼Œå¼ºè¡Œçº æ­£èˆªå‘ã€‚', req: { virtue: 60 }, outcome: { text: 'ä½ å‡­å€Ÿåšå®šçš„æ„å¿—åŠ›æŠµæŠ—äº†è¯±æƒ‘ï¼Œæ‹¯æ•‘äº†èˆ¹é˜Ÿã€‚', effects: { virtue: 5 } } },
        { text: 'ã€å¼€ç‚®ã€‘é©±èµ¶ã€‚', req: { martial: 50 }, outcome: { text: 'å·¨å¤§çš„ç‚®å£°æƒŠèµ°äº†ä¼ è¯´ä¸­çš„ç”Ÿç‰©ï¼Œä½†ä¹Ÿè®©ä½ å¿ƒæœ‰ä½™æ‚¸ã€‚', effects: {} } }
    ]}
];
const merchantInvestmentData = {
    types: [
        { 
            id: 'silk_shop', name: 'ç»¸ç¼åº„', 
            levels: [
                { name: 'ç»¸ç¼åº„', cost: 1000, base_return: 150, upgrade_cost: 3000 },
                { name: 'é”¦ç»£åŠ', cost: 3000, base_return: 500, upgrade_cost: 10000 },
                { name: 'å¤©è¡£é˜', cost: 10000, base_return: 2000, upgrade_cost: 0 }
            ],
            attribute_boost: { talent: 1 }
        },
        { 
            id: 'teahouse', name: 'èŒ¶æ¥¼',
            levels: [
                { name: 'èŒ¶æ¥¼', cost: 1500, base_return: 200, upgrade_cost: 4500 },
                { name: 'é›…è½©', cost: 4500, base_return: 700, upgrade_cost: 15000 },
                { name: 'å“èŒ—æ¥¼', cost: 15000, base_return: 2500, upgrade_cost: 0 }
            ],
            attribute_boost: { etiquette: 1 }
        },
        {
            id: 'bank', name: 'é’±åº„',
            levels: [
                { name: 'é’±åº„', cost: 5000, base_return: 600, upgrade_cost: 15000 },
                { name: 'ç¥¨å·', cost: 15000, base_return: 2500, upgrade_cost: 50000 },
                { name: 'é€šæºæ€»å·', cost: 50000, base_return: 10000, upgrade_cost: 0 }
            ],
             attribute_boost: { wisdom: 1 }
        }
    ],
    managers: [
        { id: 'frugal', name: 'æ™®é€šä¼™è®¡', salary: 50, effect: { return_mod: 1.0, risk_mod: 1.0, reputation: 1 } },
        { id: 'steady', name: 'å¿ åšæŒæŸœ', salary: 200, effect: { return_mod: 1.2, risk_mod: 0.8, reputation: 5 } },
        { id: 'shrewd', name: 'ç²¾æ˜ç®¡äº‹', salary: 500, effect: { return_mod: 1.5, risk_mod: 1.3, reputation: -2 } }
    ],
    strategies: [
        { id: 'stable', name: 'è–„åˆ©å¤šé”€', desc: 'æ”¶ç›Šç¨³å®šï¼Œé£é™©è¾ƒä½', effect: { return_mod: 0.9, risk_mod: 0.7 } },
        { id: 'gamble', name: 'å¥‡è´§å¯å±…', desc: 'æ”¶ç›Šæ³¢åŠ¨å¤§ï¼Œé£é™©é«˜', effect: { return_mod: 1.5, risk_mod: 2.0 } },
        { id: 'promote', name: 'æŠ•å…¥å®£ä¼ ', desc: 'æœ¬å¹´æ”¶ç›Šé™ä½ï¼Œæå‡å£°æœ›', cost: 300, effect: { return_mod: 0.5, risk_mod: 1.0, reputation: 10 } }
    ]
};
const landData = [
    { id: 'farmland', name: 'è‚¥æ²ƒè‰¯ç”°', cost: 200, icon: 'ğŸï¸', desc: 'äº¬éƒŠæœ€å¸¸è§çš„ç”°åœ°ã€‚é€‚åˆç§æ¤å„ç±»ä¸»ç²®ä½œç‰©ã€‚', reputation_req: 0 },
    { id: 'paddy', name: 'æ±Ÿå—æ°´ç”°', cost: 350, icon: 'ğŸ’§', desc: 'å¼•æ´»æ°´çŒæº‰ï¼Œæ˜¯ç§æ¤æ°´ç¨»çš„ç»ä½³ä¹‹é€‰ã€‚', reputation_req: 20 },
    { id: 'hill', name: 'å±±åœ°ä¸˜é™µ', cost: 300, icon: 'â›°ï¸', desc: 'äº‘é›¾ç¼­ç»•ï¼Œæ˜¯ç§æ¤èŒ¶å¶ã€ç‰¹å®šè¯æçš„å®åœ°ã€‚', reputation_req: 40 }
];
const cropData = [
    { id: 'rice', name: 'æ°´ç¨»', icon: 'ğŸŒ¾', cost: 10, cycle: 2, yield: 50, desc: 'ç™¾å§“é¤æ¡Œä¸Šçš„ä¸»é£Ÿï¼Œéœ€æ±‚ç¨³å®šã€‚' },
    { id: 'wheat', name: 'å°éº¦', icon: 'ğŸŒ½', cost: 10, cycle: 2, yield: 45, desc: 'åŒ—æ–¹å¸¸è§çš„ä¸»é£Ÿï¼Œè€æ—±ã€‚' },
    { id: 'tea', name: 'èŒ¶å¶', icon: 'ğŸŒ¿', cost: 30, cycle: 3, yield: 120, desc: 'æ–‡äººé›…å£«çš„æœ€çˆ±ï¼Œä»·å€¼ä¸è²ã€‚' },
    { id: 'peony', name: 'ç‰¡ä¸¹', icon: 'ğŸŒ¸', cost: 50, cycle: 4, yield: 200, desc: 'èŠ±ä¸­ä¹‹ç‹ï¼Œé›å®¹åè´µã€‚', effect: { charm: 1 } },
    { id: 'herb', name: 'çç¨€è¯æ', icon: 'ğŸ’', cost: 80, cycle: 6, yield: 300, desc: 'ç”Ÿé•¿å‘¨æœŸæ¼«é•¿ï¼Œé£é™©æé«˜ï¼Œä½†ä»·å€¼è¿åŸã€‚', effect: { wisdom: 1 } }
];
const adaptationMatrix = {
    farmland: { rice: 1, wheat: 1.5, tea: 0.5, peony: 1.2, herb: 0.5 },
    paddy:    { rice: 1.5, wheat: 0.5, tea: 0.5, peony: 0.8, herb: 0.5 },
    hill:     { rice: 0.5, wheat: 1, tea: 1.5, peony: 1, herb: 1.5 }
};
const MARITIME_TRADE_DATA = {
    fleetLevels: [
        { level: 0, name: "æœªç»„å»ºèˆ°é˜Ÿ", upgradeCost: 5000, req: { reputation: 50 }, desc: "ç»„å»ºä¸€æ”¯åŸºç¡€çš„è¿‘æµ·èˆ¹é˜Ÿï¼Œå¼€å¯ä½ çš„èˆªæµ·äº‹ä¸šã€‚" },
        { level: 1, name: "è¿‘æµ·èˆ¹é˜Ÿ", upgradeCost: 25000, req: { reputation: 200 }, desc: "å‡çº§ä¸ºæ›´å¯é çš„è¿œæ´‹èˆ¹é˜Ÿï¼Œä»¥æ¢ç´¢æ›´å¹¿é˜”çš„æµ·åŸŸã€‚" },
        { level: 2, name: "è¿œæ´‹èˆ¹é˜Ÿ", upgradeCost: 100000, req: { reputation: 500 }, desc: "å‡çº§ä¸ºæ‹¥æœ‰å®˜æ–¹èƒŒæ™¯çš„çš‡å®¶èˆ°é˜Ÿï¼Œæ‰¿æ¥æœ€é«˜é£é™©ä¸å›æŠ¥çš„ä»»åŠ¡ã€‚" },
        { level: 3, name: "çš‡å®¶èˆ°é˜Ÿ", upgradeCost: 0, req: {}, desc: "ä½ çš„èˆ°é˜Ÿå·²æ˜¯æµ·ä¸Šéœ¸ä¸»ã€‚" }
    ],
    investmentTiers: [
        { level: 1, name: "è¿‘æµ·è´¸æ˜“", desc: "å¾€è¿”äºé‚»è¿‘æ¸¯å£ï¼Œé£é™©ä½ï¼Œå›æŠ¥ç¨³å®šã€‚", investment: 5000, cycle: 2, roi_range: [0.1, 0.4] }, // roi: Return on Investment
        { level: 2, name: "è¿œæ´‹é¦™æ–™", desc: "å‰å¾€å—æ´‹ï¼Œå¯»æ±‚çè´µçš„é¦™æ–™ï¼Œé£é™©ä¸å›æŠ¥å¹¶å­˜ã€‚", investment: 25000, cycle: 4, roi_range: [0.2, 0.8] },
        { level: 3, name: "çš‡å®¶è´¡å“", desc: "ä¸ºçš‡å®¤å¯»æ‰¾ä¼ è¯´ä¸­çš„æµ·å¤–å¥‡çï¼Œé£é™©æé«˜ï¼Œä½†å¯èƒ½ä¸€æœ¬ä¸‡åˆ©ã€‚", investment: 100000, cycle: 6, roi_range: [-0.2, 2.0] } // å¯èƒ½ä¼šäºæŸ
    ]
};
// ===================== ã€æ–°å¢å¹¶æ‰©å……ã€‘è¿œæ´‹æ¢ç´¢è¿‡ç¨‹äº‹ä»¶åº“ =====================
const VOYAGE_EVENTS = {
    positive: [
        { id: 'good_wind', name: 'å¤©åŠ©é¡ºé£', desc: 'ä½ çš„èˆ¹é˜Ÿé‡åˆ°äº†æŒç»­çš„é¡ºé£ï¼Œèˆªè¡Œé€Ÿåº¦å¤§å¢ï¼Œé¢„è®¡å¯ä»¥æå‰æŠµè¾¾ï¼', effect: { turnsLeft: -1 }, log: 'èˆªç¨‹ç¼©çŸ­äº†ä¸€å›åˆï¼' },
        { id: 'friendly_ship', name: 'å¶é‡å•†èˆ¹', desc: 'ä½ ä»¬é‡åˆ°äº†ä¸€æ”¯å‹å¥½çš„å¼‚å›½å•†èˆ¹ï¼Œå¯¹æ–¹ä¸ä½ ä»¬äº¤æ¢äº†ä¸€äº›ç‰¹äº§ã€‚', effect: { profit_bonus: 500 }, log: 'ä½ é¢å¤–è·åˆ©500ä¸¤ã€‚' },
        { id: 'big_catch', name: 'æ¸”è·ä¸°æ”¶', desc: 'èˆ¹å‘˜ä»¬æ•è·äº†å¤§é‡çš„é±¼ç¾¤ï¼Œä¸ä»…æ”¹å–„äº†ä¼™é£Ÿï¼Œè¿˜èŠ‚çœäº†è¡¥ç»™å¼€é”€ã€‚', effect: { supply_cost_reduction: 100 }, log: 'è¡¥ç»™å¼€é”€å‡å°‘100ä¸¤ã€‚' },
        { id: 'treasure_map_fragment', name: 'å‘ç°æ¼‚æµç“¶', desc: 'èˆ¹å‘˜åœ¨æµ·é¢ä¸Šå‘ç°ä¸€ä¸ªæ¼‚æµç“¶ï¼Œé‡Œé¢ç«Ÿæ˜¯ä¸€å¼ è—å®å›¾çš„æ®‹ç‰‡ï¼', effect: { item: 'cang_bao_tu_can_pian' }, log: 'è·å¾—ç‰©å“ã€è—å®å›¾æ®‹ç‰‡ã€‘ï¼' }
    ],
    negative: [
        { id: 'minor_storm', name: 'é­é‡é£æµª', desc: 'ä¸€åœºä¸å¤§ä¸å°çš„é¢¨æš´æ¥è¢­ï¼Œéƒ¨åˆ†è´§ç‰©è¢«æ‰“æ¹¿æŸåã€‚', effect: { cargo_integrity: -10, morale: -5 }, log: 'è´§ç‰©å®Œå¥½åº¦-10%ï¼Œèˆ¹å‘˜å£«æ°”-5ã€‚' },
        { id: 'becalmed', name: 'é™·å…¥æ— é£å¸¦', desc: 'èˆ¹åªé™·å…¥äº†æ— é£å¸¦ï¼Œåªèƒ½åŸåœ°ç­‰å¾…ï¼Œç™½ç™½æ¶ˆè€—äº†è¡¥ç»™ã€‚', effect: { turnsLeft: 1, morale: -8 }, log: 'èˆªç¨‹å»¶é•¿äº†ä¸€å›åˆï¼Œèˆ¹å‘˜å£«æ°”-8ã€‚' },
        { id: 'crew_sickness', name: 'èˆ¹å‘˜æŸ“ç—…', desc: 'éƒ¨åˆ†èˆ¹å‘˜å› æ°´åœŸä¸æœæŸ“ä¸Šäº†ç–¾ç—…ï¼Œéœ€è¦é¢å¤–çš„åŒ»è¯å¼€é”€ã€‚', effect: { supply_cost_increase: 200, morale: -10 }, log: 'åŒ»è¯è´¹å¯¼è‡´è¡¥ç»™å¼€é”€å¢åŠ 200ä¸¤ï¼Œèˆ¹å‘˜å£«æ°”-10ã€‚' },
        { id: 'minor_pirates', name: 'é­é‡å°è‚¡æµ·ç›—', desc: 'ä½ ä»¬é­é‡äº†ä¸€å°è‚¡æµ·ç›—çš„éªšæ‰°ï¼', effect: { cargo_integrity: -5, morale: -5 }, log: 'ä½ ä»¬å‡»é€€äº†æµ·ç›—ï¼Œä½†æŸå¤±äº†å°‘é‡è´§ç‰©ã€‚' },
        { id: 'navigational_error', name: 'èˆªå‘é”™è¯¯', desc: 'å› å¤©æ°”åŸå› ï¼Œèˆ¹é˜Ÿåç¦»äº†é¢„å®šèˆªçº¿ï¼Œéœ€è¦èŠ±è´¹é¢å¤–æ—¶é—´ä¿®æ­£ã€‚', effect: { turnsLeft: 1, supply_cost_increase: 150 }, log: 'èˆªç¨‹å»¶é•¿ä¸€å›åˆï¼Œè¡¥ç»™å¼€é”€å¢åŠ 150ä¸¤ã€‚' }
    ],
    neutral: [
        { id: 'dolphins', name: 'æµ·è±šä¼´æ¸¸', desc: 'ä¸€ç¾¤æµ·è±šè¿½é€ç€ä½ ä»¬çš„èˆ¹åªå¬‰æˆï¼Œèˆ¹å‘˜ä»¬å£«æ°”é«˜æ¶¨ã€‚', effect: { morale: 5 }, log: 'èˆ¹å‘˜å£«æ°”+5ã€‚' },
        { id: 'aurora', name: 'ç›®ç¹å¥‡æ™¯', desc: 'ä½ ä»¬åœ¨å¤œé—´ç›®ç¹äº†ç»šä¸½çš„å¥‡æ™¯ï¼Œæ­¤ç­‰æ™¯è±¡ä»¤äººç»ˆèº«éš¾å¿˜ã€‚', effect: { morale: 8 }, log: 'èˆ¹å‘˜å£«æ°”+8ã€‚' },
        { id: 'old_sailor_story', name: 'è€æ°´æ‰‹çš„æ•…äº‹', desc: 'èˆ¹ä¸Šçš„ä¸€ä½è€æ°´æ‰‹è®²è¿°ç€ä»–å¹´è½»æ—¶é­é‡æµ·æ€ªçš„ç¦»å¥‡æ•…äº‹ï¼Œå¬å¾—ä¼—äººå¿ƒæƒŠèƒ†æˆ˜ã€‚', effect: { morale: -2 }, log: 'èˆ¹å‘˜å£«æ°”å¾®é™ã€‚' }
    ]
};
const seaExplorationData = {
    captains: [
        { id: 'veteran', name: 'è€ç»ƒçš„èˆªæµ·å®¶', desc: 'ç»éªŒä¸°å¯Œï¼Œèƒ½å¤§æ¦‚ç‡é¿å¼€é£æš´ã€‚', cost: 1500, effect: { storm_chance_modifier: -0.2 } },
        { id: 'general', name: 'é€€å½¹çš„æ°´å¸ˆå°†é¢†', desc: 'éªå‹‡å–„æˆ˜ï¼Œèƒ½æœ‰æ•ˆå¯¹æŠ—æµ·ç›—ã€‚', cost: 2500, effect: { pirate_chance_modifier: -0.2, combat_bonus: 10 } },
        { id: 'local', name: 'æœ¬åœ°çš„æ¸”æ°‘å‘å¯¼', desc: 'ç†Ÿæ‚‰è¿‘æµ·æ°´æ–‡ï¼Œæ€»èƒ½æ‰¾åˆ°å¯Œé¥¶ä¹‹åœ°ã€‚', cost: 800, effect: { base_profit_modifier: 1.2, high_reward_chance_modifier: -0.3 } }
    ],
    routes: [
        { id: 'east', name: 'ä¸œæ–¹èˆªçº¿', desc: 'å‰å¾€ç››äº§ä¸ç»¸ä¸ç“·å™¨çš„å¯Œåº¶ä¹‹åœ°ï¼Œé£å¹³æµªé™ï¼Œæ”¶ç›Šç¨³å®šã€‚', risk: 'low', reward: 'medium', attribute: 'charm' },
        { id: 'south', name: 'å—æ–¹èˆªçº¿', desc: 'å‰å¾€éåœ°é¦™æ–™ä¸å®çŸ³çš„å¼‚åŸŸï¼Œè·¯é€”é¥è¿œï¼Œæ—¶æœ‰é£æš´ã€‚', risk: 'medium', reward: 'high', attribute: 'wisdom' },
        { id: 'unknown', name: 'æœªçŸ¥æµ·åŸŸ', desc: 'æ¢ç´¢è¿·é›¾ç¬¼ç½©çš„ç¥ç§˜æµ·åŸŸï¼Œæˆ–æ˜¯æƒŠå¤©å®è—ï¼Œæˆ–æ˜¯ä¸‡ä¸ˆæ·±æ¸Šã€‚', risk: 'high', reward: 'very_high', attribute: 'martial' }
    ],
    cargos: [
        { id: 'silk', name: 'ä¸ç»¸ç“·å™¨', space: 20, value: 150 },
        { id: 'grain', name: 'ç²®é£Ÿè¯æ', space: 30, value: 100 },
        { id: 'tools', name: 'é“å™¨å·¥å…·', space: 25, value: 120 }
    ],
    events: {
    success: [
         { desc: "å‘ç°å¼‚åŸŸå¥‡çï¼Œé«˜ä»·æ‹å–è·åˆ©", multiplier: 2.0, bonus: { charm: 2 } },
         { desc: "è¿›çŒ®æƒè´µï¼Œå£°æœ›å¤§æ¶¨", multiplier: 1.2, bonus: { reputation: 20 } },
         { desc: "å‘ç°é»„é‡‘èˆªçº¿ï¼Œè·å¾—å·¨é¢å›æŠ¥", multiplier: 3.5, bonus: {} }
    ],
    failure: [
         { id: 'storm', desc: "é­é‡é£æš´ï¼Œæ–­å°¾æ±‚ç”Ÿ", loss_percent: 0.3, penalty: { health: -5 } },
         { id: 'pirate', desc: "é­é‡æµ·ç›—ï¼Œè¡€æˆ˜é€ƒè„±", loss_percent: 0.5, penalty: { health: -15, martial: 2 } },
         { id: 'reef', desc: "èˆ¹åªè§¦ç¤ï¼ŒæŸå¤±æƒ¨é‡", loss_percent: 0.6, penalty: { health: -10 } }
    ]
}
};
// ===================== ã€æ–°å¢ã€‘é’æ¥¼äº’åŠ¨äº‹ä»¶åº“ START =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘é’æ¥¼äº’åŠ¨äº‹ä»¶åº“ (V2.0 æ‰©å……ç‰ˆ) START =====================
const COURTESAN_INTERACTION_EVENTS = {
    // é—²èŠäº’åŠ¨äº‹ä»¶åº“
    chat: [
        // æ‚¨å·²æœ‰çš„äº‹ä»¶ (å·²ä¿ç•™)
        {
            title: "çº¢è¢–æ·»é¦™",
            desc: "ä½ è§å¥¹æ­£åœ¨ç¯ä¸‹ç ”å¢¨ï¼Œä¾¿èµ°ä¸Šå‰å»ï¼Œè¯¢é—®æ˜¯å¦éœ€è¦å¸®å¿™ã€‚",
            options: [
                { text: "ä¸ºå¥¹æ‰§ç¬”", req: { talent: 70 }, effects: { favor: 15, player_talent: 2 }, log: "ä½ æ¡ä½å¥¹çš„æ‰‹ï¼Œæ•™å¥¹å†™ä¸‹æƒ…è¯—ï¼Œé¼»å°–æ»¡æ˜¯å¥¹å‘é—´çš„é¦™æ°”ã€‚å¥¹é¢è‹¥æ¡ƒèŠ±ï¼Œç¾èµ§åœ°ä¾ååœ¨ä½ æ€€ä¸­ã€‚" },
                { text: "é™é™æ¬£èµ", effects: { favor: 8, player_virtue: 1 }, log: "ä½ é™ç«‹ä¸€æ—ï¼Œæ¬£èµå¥¹ä¸“æ³¨çš„ä¾§è„¸ï¼Œåªè§‰å²æœˆé™å¥½ã€‚å¥¹å¯Ÿè§‰åˆ°ä½ çš„ç›®å…‰ï¼Œå¯¹ä½ æ¸©å©‰ä¸€ç¬‘ã€‚" }
            ]
        },
        {
            title: "èº«ä¸–ä¹‹è°œ",
            desc: "åœ¨ä¸€æ¬¡é—²è°ˆä¸­ï¼Œå¥¹æ— æ„é—´è¯´æ¼äº†å˜´ï¼Œä¼¼ä¹æåŠäº†ä¸€æ®µä¸ä¸ºäººçŸ¥çš„è¿‡å¾€ã€‚",
            options: [
                { text: "ã€è¿½é—®ã€‘", req: { wisdom: 60 }, effects: { favor: 10 }, log: "åœ¨ä½ çš„å¼•å¯¼ä¸‹ï¼Œå¥¹åéœ²äº†éƒ¨åˆ†å¿ƒäº‹ï¼Œä½ ä»¬çš„å…³ç³»ä¼¼ä¹æ›´è¿‘äº†ä¸€æ­¥ã€‚" },
                { text: "ã€è½¬ç§»è¯é¢˜ã€‘", effects: { favor: 5 }, log: "ä½ æ²¡æœ‰è¿½é—®ï¼Œè¿™ä»½ä½“è´´è®©å¥¹å¿ƒç”Ÿæš–æ„ã€‚" }
            ]
        },
        {
            title: "é‡‘é’—ä¹‹é€‰",
            desc: "å¥¹æ‹¿å‡ºä¸¤æ”¯é‡‘é’—ï¼Œä¸€æ”¯åä¸½ï¼Œä¸€æ”¯ç´ é›…ï¼Œè¯¢é—®ä½ å“ªæ”¯æ›´å¥½çœ‹ã€‚",
            options: [
                { text: "ã€ç´ é›…ã€‘", effects: { favor: 8, player_talent: 1 }, log: "â€œæ¸…æ°´å‡ºèŠ™è“‰ï¼Œå¤©ç„¶å»é›•é¥°ã€‚â€ä½ çš„ç§°èµè®©å¥¹çœ‰çœ¼å«ç¬‘ï¼Œè®¤ä¸ºä½ æ˜¯æœ‰å“ä½çš„çŸ¥å·±ã€‚" },
                { text: "ã€åä¸½ã€‘", effects: { favor: 8 }, log: "â€œå®é’—é…ä½³äººï¼Œç›¸å¾—ç›Šå½°ã€‚â€ä½ çš„å¤¸å¥–è®©å¥¹ååˆ†å—ç”¨ã€‚" }
            ]
        },
        {
            title: "çª—è¾¹æ„ç»ª",
            desc: "ä½ è§å¥¹ç‹¬è‡ªå€šåœ¨çª—è¾¹ï¼Œæœ›ç€å¤©è¾¹çš„æœˆäº®å‘å‘†ï¼Œç¥æƒ…æœ‰äº›è½å¯ã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹æŠ«ä¸Šå¤–è¡£ã€‘", effects: { favor: 12 }, log: "ä½ é»˜é»˜åœ°ä¸ºå¥¹æŠ«ä¸Šå¤–è¡£ï¼Œå¥¹å›è¿‡ç¥ï¼Œçœ¼ä¸­æ»¡æ˜¯æ„ŸåŠ¨ä¸æŸ”æƒ…ã€‚" },
                { text: "ã€ä»èƒŒåæŠ±ä½å¥¹ã€‘", effects: { favor: 15 }, log: "ä½ ä»èƒŒåè½»è½»æŠ±ä½å¥¹ï¼Œåœ¨å¥¹è€³è¾¹ä½è¯­ã€‚å¥¹èº«å­ä¸€é¢¤ï¼Œéšåä¾¿å®‰å¿ƒåœ°é åœ¨ä½ æ€€é‡Œã€‚" }
            ]
        },
        {
            title: "æœªæ¥ä¹‹é—®",
            desc: "â€œå…¬å­...ä»¥åä¼šå¸¸æ¥çœ‹æˆ‘å—ï¼Ÿâ€å¥¹ä½ç€å¤´ï¼Œè½»å£°é—®é“ï¼Œä¼¼ä¹æœ‰äº›ä¸å®‰ã€‚",
            options: [
                { text: "ã€è®¸ä¸‹æ‰¿è¯ºã€‘", effects: { favor: 10 }, log: "â€œå½“ç„¶ã€‚â€ä½ åšå®šçš„å›ç­”è®©å¥¹å®‰ä¸‹å¿ƒæ¥ï¼Œçœ¼ä¸­é—ªçƒç€å–œæ‚¦çš„å…‰èŠ’ã€‚" },
                { text: "ã€ç¬‘è€Œä¸è¯­ã€‘", effects: { favor: -5 }, log: "ä½ çš„æ²‰é»˜è®©å¥¹æœ‰äº›å¤±è½ã€‚" }
            ]
        },
        {
            title: "æ•…ä½œåƒé†‹",
            desc: "å¥¹â€œæ— æ„â€ä¸­æèµ·ï¼Œæœ€è¿‘ä¼¼ä¹æœ‰ä½æ‰ä¿Šåœ¨è¿½æ±‚å¥¹ã€‚",
            options: [
                { text: "ã€è¡¨ç°å‡ºå¼ºçƒˆçš„å æœ‰æ¬²ã€‘", effects: { favor: 10 }, log: "â€œä»–å²‚èƒ½ä¸æˆ‘ç›¸æ¯”ï¼Ÿâ€ä½ çš„é†‹æ„è®©å¥¹æš—è‡ªçªƒå–œï¼ŒçŸ¥é“ä½ æ˜¯åœ¨ä¹å¥¹çš„ã€‚" },
                { text: "ã€å‡è£…ä¸åœ¨æ„ã€‘", effects: { favor: -8 }, log: "ä½ çš„â€œå¤§æ–¹â€è®©å¥¹æœ‰äº›å¤±æœ›ï¼Œä¸ç¡®å®šä½ æ˜¯å¦çœŸçš„åœ¨ä¹ã€‚" }
            ]
        },
        // æ–°å¢10ä¸ªé—²èŠäº‹ä»¶
        {
            title: "æŒå¿ƒä¹‹ç§˜",
            desc: "å¥¹å¿½ç„¶æ‹‰è¿‡ä½ çš„æ‰‹ï¼Œè¯´è¦ä¸ºä½ çœ‹çœ‹æ‰‹ç›¸ã€‚å¥¹çš„æŒ‡å°–è½»æŸ”åœ°åˆ’è¿‡ä½ çš„æŒå¿ƒï¼Œæœ‰äº›å¾®ç—’ã€‚",
            options: [
                { text: "ã€ä»»å¥¹è§‚çœ‹ã€‘", effects: { favor: 12 }, log: "â€œå…¬å­çš„æŒçº¹...â€ï¼Œå¥¹æ¬²è¨€åˆæ­¢ï¼Œåªç•™ä¸‹ä¸€æŠ¹ç¥ç§˜çš„å¾®ç¬‘ï¼Œæ°”æ°›å˜å¾—æš§æ˜§èµ·æ¥ã€‚" },
                { text: "ã€åæ¡ä½å¥¹çš„æ‰‹ã€‘", effects: { favor: 15 }, log: "ä½ åæ‰‹æ¡ä½å¥¹æŸ”è‹¥æ— éª¨çš„å°æ‰‹ï¼Œè½»å£°é“ï¼šâ€œæˆ‘çš„å‘½è¿ï¼Œä¸å°±åœ¨ä½ æ‰‹ä¸­ä¹ˆï¼Ÿâ€å¥¹å¨‡å—”åœ°çœ‹äº†ä½ ä¸€çœ¼ï¼Œæ»¡æ˜¯é£æƒ…ã€‚" }
            ]
        },
        {
            title: "ç«¥å¹´è¶£äº‹",
            desc: "å¥¹ä¸ä½ åˆ†äº«äº†ä¸€ä»¶ç«¥å¹´æ—¶çš„ç³—äº‹ï¼Œè¯´åˆ°å¥½ç¬‘å¤„ï¼Œè‡ªå·±å…ˆç¬‘å¾—å‰ä»°ååˆï¼Œæ¯«æ— å¹³æ—¥çš„ç«¯åº„ã€‚",
            options: [
                { text: "ã€åˆ†äº«ä½ çš„ç³—äº‹ã€‘", effects: { favor: 10 }, log: "ä½ ä¹Ÿåˆ†äº«äº†è‡ªå·±çš„ç³—äº‹ï¼Œä½ ä»¬ç›¸è§†å¤§ç¬‘ï¼Œæ„Ÿè§‰å½¼æ­¤ä¹‹é—´å†æ— éš”é˜‚ã€‚" },
                { text: "ã€å® æººåœ°çœ‹ç€å¥¹ç¬‘ã€‘", effects: { favor: 8 }, log: "ä½ åªæ˜¯å® æººåœ°çœ‹ç€å¥¹ï¼Œè§‰å¾—å¥¹æ­¤åˆ»çš„æ¨¡æ ·å¯çˆ±æäº†ã€‚" }
            ]
        },
        {
            title: "æåŠæ­£å¦»",
            desc: "â€œå¬é—»å…¬å­å®¶æœ‰è´¤å¦»...â€å¥¹çœ‹ä¼¼ä¸ç»æ„åœ°æèµ·ä½ çš„æ­£å¦»ï¼Œçœ¼åº•å´é—ªè¿‡ä¸€ä¸å¤æ‚çš„æƒ…ç»ªã€‚",
            options: [
                { text: "ã€å¦ç„¶æ‰¿è®¤ã€‘", req: { virtue: 60 }, effects: { favor: 5 }, log: "ä½ å¦ç„¶æ‰¿è®¤ï¼Œå¥¹è™½æœ‰äº›å¤±è½ï¼Œä½†æ›´æ¬£èµä½ çš„å¦è¯šã€‚" },
                { text: "ã€é¿è€Œä¸è°ˆã€‘", effects: { favor: -5 }, log: "ä½ é¿å¼€äº†è¿™ä¸ªè¯é¢˜ï¼Œå¥¹ä¾¿ä¸å†è¿½é—®ï¼Œä½†æ°”æ°›æœ‰äº›å†·å´ã€‚" }
            ]
        },
        {
            title: "é›¨å¤œæƒŠé›·",
            desc: "çª—å¤–ç”µé—ªé›·é¸£ï¼Œå¥¹å¿½ç„¶æƒŠå‘¼ä¸€å£°ï¼Œä¸‹æ„è¯†åœ°å‘ä½ é è¿‘äº†ä¸€äº›ã€‚",
            options: [
                { text: "ã€å°†å¥¹æ½å…¥æ€€ä¸­ã€‘", effects: { favor: 15 }, log: "ä½ å°†å¥¹è½»è½»æ½å…¥æ€€ä¸­å®‰æŠšï¼Œå¥¹åœ¨ä½ æ€€é‡Œï¼Œä¼¼ä¹æ‰¾åˆ°äº†æœ€å®‰å…¨çš„æ¸¯æ¹¾ã€‚" },
                { text: "ã€ä¸ºå¥¹æ‚ä½è€³æœµã€‘", effects: { favor: 10 }, log: "ä½ ä¼¸å‡ºæ‰‹ä¸ºå¥¹æ‚ä½è€³æœµï¼Œè¿™ä¸ªæ¸©æŸ”çš„ä¸¾åŠ¨è®©å¥¹æ„Ÿåˆ°æ— æ¯”å®‰å¿ƒã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ ç†å®¹",
            desc: "ä½ é¥®èŒ¶æ—¶ï¼Œä¸€ç¼•å‘ä¸å‚è½é¢Šè¾¹ï¼Œå¥¹è‡ªç„¶åœ°ä¼¸å‡ºæ‰‹ï¼Œä¸ºä½ å°†å‘ä¸æ åˆ°è€³åã€‚",
            options: [
                { text: "ã€ä»»ç”±å¥¹æ•´ç†ã€‘", effects: { favor: 12 }, log: "å¥¹çš„æŒ‡å°–ä¸ç»æ„åœ°è§¦ç¢°åˆ°ä½ çš„è€³å»“ï¼Œä¸¤äººå¿ƒä¸­éƒ½æ˜¯ä¸€è¡ã€‚" },
                { text: "ã€æŠ“ä½å¥¹çš„æ‰‹ã€‘", effects: { favor: 10 }, log: "ä½ æŠ“ä½å¥¹åœåœ¨åŠç©ºçš„æ‰‹ï¼Œæ”¾åœ¨å”‡è¾¹è½»å»äº†ä¸€ä¸‹ï¼Œå¥¹çš„è„¸ç¬é—´çº¢é€ã€‚" }
            ]
        },
        {
            title: "é¦™å›Šå¿ƒæ„",
            desc: "å¥¹èµ ä½ ä¸€ä¸ªäº²æ‰‹ç¼åˆ¶çš„é¦™å›Šï¼Œä¸Šé¢ç»£ç€ä¸€å¯¹é¸³é¸¯ï¼Œé’ˆè„šç»†å¯†ï¼Œæ»¡å«æƒ…æ„ã€‚",
            options: [
                { text: "ã€å½“å³ä½©æˆ´ã€‘", effects: { favor: 15 }, log: "ä½ ç«‹åˆ»å°†é¦™å›Šä½©æˆ´åœ¨è…°é—´ï¼Œå¥¹è§ä½ å¦‚æ­¤çè§†ï¼Œçœ¼ä¸­æ»¡æ˜¯å–œæ‚¦ã€‚" },
                { text: "ã€éƒ‘é‡æ”¶ä¸‹ã€‘", effects: { favor: 8 }, log: "ä½ å°†é¦™å›Šéƒ‘é‡åœ°æ”¾å…¥æ€€ä¸­ï¼Œæ‰¿è¯ºä¼šå¥½å¥½ä¿ç®¡ã€‚" }
            ]
        },
        {
            title: "æ— å£°çš„é»˜å¥‘",
            desc: "ä½ ä»¬ç›¸å¯¹è€Œåï¼Œä¸€æ—¶æ— è¯ï¼Œä½†æ°”æ°›å¹¶ä¸å°´å°¬ï¼Œåè€Œæœ‰ç§æ— å£°çš„é»˜å¥‘åœ¨æµæ·Œã€‚",
            options: [
                { text: "ã€äº«å—æ­¤åˆ»ã€‘", effects: { favor: 8 }, log: "æœ‰æ—¶å€™ï¼Œæœ€èˆ’æœçš„å…³ç³»ï¼Œä¾¿æ˜¯ç›¸é¡¾æ— è¨€ï¼Œå´å¿ƒæœ‰çµçŠ€ã€‚" },
                { text: "ã€ä¸ºå¥¹æ–ŸèŒ¶ã€‘", effects: { favor: 10 }, log: "ä½ ä¸ºå¥¹æ·»ä¸Šä¸€æ¯çƒ­èŒ¶ï¼Œæ‰“ç ´äº†æ²‰é»˜ï¼Œå¥¹å›ä»¥æ¸©æŸ”ä¸€ç¬‘ã€‚" }
            ]
        },
        {
            title: "å­¦è¯´æ–¹è¨€",
            desc: "å¥¹æ•™ä½ è¯´å¥¹å®¶ä¹¡çš„æ–¹è¨€ï¼Œä½ ç¬¨æ‹™çš„å£éŸ³é€—å¾—å¥¹å’¯å’¯ç›´ç¬‘ã€‚",
            options: [
                { text: "ã€è®¤çœŸå­¦ä¹ ã€‘", effects: { favor: 10 }, log: "ä½ æœ€ç»ˆç”¨è¹©è„šçš„æ–¹è¨€è¯´å‡ºäº†ä¸€å¥æƒ…è¯ï¼Œå¥¹åˆç¾åˆå–œã€‚" },
                { text: "ã€æ•…æ„è¯´é”™ã€‘", effects: { favor: 8 }, log: "ä½ æ•…æ„è¯´é”™å‡ ä¸ªéŸ³èŠ‚ï¼Œæƒ¹å¾—å¥¹ç¬‘å¼¯äº†è…°ï¼Œæ°”æ°›ååˆ†è½»æ¾ã€‚" }
            ]
        },
        {
            title: "ä¹¦ä¸­å¯†è¯­",
            desc: "å¥¹é€’ç»™ä½ ä¸€æœ¬ä¹¦ï¼Œä½ ç¿»å¼€ä¸€çœ‹ï¼Œå‘ç°å¥¹åœ¨ä¹¦ä¸­ç”¨è‡å¤´å°æ¥·æ ‡æ³¨äº†è®¸å¤šæƒ…æ„ç»µç»µçš„æ‰¹æ³¨ã€‚",
            options: [
                { text: "ã€æç¬”å›åº”ã€‘", req: { talent: 60 }, effects: { favor: 15 }, log: "ä½ ä¹Ÿæç¬”åœ¨ä¹¦é¡µé—´éš™å†™ä¸‹å›åº”ï¼Œä¸€æ¥ä¸€å¾€ï¼Œä»¿ä½›åœ¨ç”¨æ–‡å­—è°ˆæƒ…è¯´çˆ±ã€‚" },
                { text: "ã€è¡¨ç¤ºæ„Ÿè°¢ã€‘", effects: { favor: 8 }, log: "ä½ æ„Ÿè°¢å¥¹çš„è¿™ä»½ç‰¹æ®Šå¿ƒæ„ï¼Œå¥¹èå°”ä¸€ç¬‘ã€‚" }
            ]
        },
        {
            title: "å°å°çš„è¯·æ±‚",
            desc: "â€œå…¬å­ï¼Œä¸‹æ¬¡èƒ½ä¸ºæˆ‘å¸¦åŸè¥¿é‚£å®¶çš„æ¡‚èŠ±ç³•å—ï¼Ÿâ€å¥¹å°å£°åœ°è¯·æ±‚ï¼Œåƒä¸ªè®¨è¦ç³–æœçš„å­©å­ã€‚",
            options: [
                { text: "ã€æ»¡å£ç­”åº”ã€‘", effects: { favor: 10 }, log: "ä½ æ»¡å£ç­”åº”ï¼Œå¥¹å¼€å¿ƒåœ°çœ¯èµ·äº†çœ¼ï¼Œä»¿ä½›å·²ç»å°åˆ°äº†é‚£ä»½ç”œèœœã€‚" },
                { text: "ã€ç°åœ¨å°±å»ã€‘", cost: 100, effects: { favor: 20 }, log: "ä½ ç«‹åˆ»èµ·èº«ä¸ºå¥¹å»ä¹°ï¼Œè¿™ä»½è¡ŒåŠ¨åŠ›è®©å¥¹æƒŠå–œåˆæ„ŸåŠ¨ã€‚" }
            ]
        }
    ],
    // çœ‹èˆäº’åŠ¨äº‹ä»¶åº“
    dance: [
        // æ‚¨å·²æœ‰çš„äº‹ä»¶ (å·²ä¿ç•™)
        {
            title: "ä¸€èˆå€¾åŸ",
            desc: "å¥¹ä¸ºä½ è·³èµ·ä¸€æ›²éœ“è£³ç¾½è¡£èˆï¼Œæ°´è¢–è½»èˆï¼Œæ­¥æ­¥ç”Ÿè²ï¼Œç¾å¾—ä»¤äººçª’æ¯ã€‚",
            options: [
                { text: "ã€ä¸Šå‰å…±èˆã€‘", req: { charm: 80 }, effects: { favor: 20 }, log: "ä½ ä¸Šå‰ä¸å¥¹å…±èˆï¼Œé…åˆé»˜å¥‘ï¼Œä»¿ä½›ä¸€å¯¹ç¥ä»™çœ·ä¾£ã€‚" },
                { text: "ã€æ·åƒé‡‘æ‰“èµã€‘", cost: 500, effects: { favor: 15 }, log: "ä½ æ·ä¸‹500ä¸¤ï¼Œè¿™ä»½è±ªæ°”è®©å¥¹å¯¹ä½ å¦çœ¼ç›¸çœ‹ã€‚" }
            ]
        },
        {
            title: "æ„å¤–å´´è„š",
            desc: "å¥¹åœ¨ä¸€ä¸ªé«˜éš¾åº¦çš„æ—‹è½¬åï¼Œä¸æ…å´´äº†è„šï¼Œè·Œå…¥ä½ çš„æ€€ä¸­ã€‚",
            options: [
                { text: "ã€æ¨ªæŠ±èµ·å¥¹ã€‘", effects: { favor: 15 }, log: "ä½ é¡ºåŠ¿å°†å¥¹æ¨ªæŠ±èµ·æ¥ï¼Œå¥¹æƒŠå‘¼ä¸€å£°ï¼Œè„¸é¢Šç»¯çº¢ï¼Œå¿ƒå¦‚é¹¿æ’ã€‚" },
                { text: "ã€ä¸ºå¥¹æ‰è„šã€‘", effects: { favor: 12 }, log: "ä½ æ‰¶å¥¹åä¸‹ï¼Œæ¸©æŸ”åœ°ä¸ºå¥¹æ‰æè„šè¸ï¼Œè¿™ä»½ä½“è´´è®©å¥¹å¿ƒåŠ¨ä¸å·²ã€‚" }
            ]
        },
        {
            title: "é‚€ä½ å…±èˆ",
            desc: "ä¸€æ›²èˆç½¢ï¼Œå¥¹å¾®å–˜ç€å‘ä½ ä¼¸å‡ºæ‰‹ï¼Œé‚€è¯·ä½ å…±èˆä¸€æ›²ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶åº”å…ã€‘", effects: { favor: 10 }, log: "ä½ æ¬£ç„¶æ¥å—é‚€è¯·ï¼Œä¸¤äººåœ¨ä¼—äººè‰³ç¾¡çš„ç›®å…‰ä¸­ç¿©ç¿©èµ·èˆã€‚" },
                { text: "ã€å©‰è¨€è°¢ç»ã€‘", effects: { favor: -5 }, log: "ä½ è¡¨ç¤ºè‡ªå·±ä¸å–„èˆè‰ºï¼Œå¥¹æœ‰äº›å¤±æœ›ã€‚" }
            ]
        },
        // æ–°å¢10ä¸ªçœ‹èˆäº‹ä»¶
        {
            title: "ä¸ºä½ è€Œèˆ",
            desc: "â€œä»Šæ—¥ä¹‹èˆï¼Œåªä¸ºå…¬å­ä¸€äººã€‚â€å¥¹å±é€€å·¦å³ï¼Œä¸ºä½ è·³èµ·ä¸€æ”¯ä»æœªç¤ºäººçš„ç§æˆ¿èˆã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹æ–Ÿé…’ã€‘", effects: { favor: 15 }, log: "ä¸€æ›²èˆç½¢ï¼Œä½ ä¸ºå¥¹é€’ä¸Šä¸€æ¯ç¾é…’ï¼Œå¥¹æ¥è¿‡é…’æ¯ï¼Œå«æƒ…è„‰è„‰åœ°ä¸€é¥®è€Œå°½ã€‚" },
                { text: "ã€ä¸Šå‰æ‹¥æŠ±ã€‘", effects: { favor: 18 }, log: "èˆæ›²ç»ˆäº†ï¼Œä½ ä¸Šå‰å°†é¦™æ±—æ·‹æ¼“çš„å¥¹æ‹¥å…¥æ€€ä¸­ï¼Œæ„Ÿå—ç€å¥¹çš„å¿ƒè·³ã€‚" }
            ]
        },
        {
            title: "ç½—è£³åŠè§£",
            desc: "èˆè‡³é…£å¤„ï¼Œå¥¹çš„è¡£å¸¦ä¸æ…æ•£å¼€ï¼Œå¤–è¡«åŠè¤ªï¼Œéœ²å‡ºé›ªç™½çš„é¦™è‚©ï¼Œåœºé¢é¦™è‰³æ— æ¯”ã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹æ•´ç†å¥½è¡£è¡«ã€‘", req: { virtue: 50 }, effects: { favor: 15 }, log: "ä½ ä¸Šå‰ä¸ºå¥¹ç»†å¿ƒæ•´ç†å¥½è¡£è¡«ï¼Œè¿™ä»½å›å­é£åº¦è®©å¥¹æ—¢æ„Ÿæ¿€åˆå¿ƒåŠ¨ã€‚" },
                { text: "ã€å¹å£å“¨èµ·å“„ã€‘", effects: { favor: 5, virtue: -2 }, log: "ä½ çš„èµ·å“„è®©å¥¹æœ‰äº›ç¾æ¼ï¼Œå´ä¹Ÿå¹³æ·»äº†å‡ åˆ†é£æƒ…ã€‚" }
            ]
        },
        {
            title: "å›¢æ‰‡èˆ",
            desc: "å¥¹æ‰‹æŒä¸€æŸ„å›¢æ‰‡ï¼Œä¸ºä½ è·³èµ·ä¸€æ”¯å¤å…¸èˆï¼Œå›¢æ‰‡åŠé®é¢ï¼Œæ¬²è¯­è¿˜ä¼‘ï¼Œå‹¾äººå¿ƒé­„ã€‚",
            options: [
                { text: "ã€å¤ºè¿‡å›¢æ‰‡ã€‘", effects: { favor: 12 }, log: "ä½  playful åœ°å¤ºè¿‡å¥¹çš„å›¢æ‰‡ï¼Œçœ‹åˆ°äº†å¥¹é‚£æƒŠè‰³çš„å®¹é¢œï¼Œå¥¹å¨‡å—”åœ°è®©ä½ è¿˜å›æ¥ã€‚" },
                { text: "ã€é™é™æ¬£èµã€‘", effects: { favor: 8 }, log: "ä½ é™é™æ¬£èµç€è¿™ä»½çŠ¹æŠ±çµç¶åŠé®é¢çš„ç¾æ„Ÿã€‚" }
            ]
        },
        {
            title: "æ•™ä½ èˆæ­¥",
            desc: "å¥¹æ‹‰ç€ä½ çš„æ‰‹ï¼Œè¦æ•™ä½ å‡ ä¸ªç®€å•çš„èˆæ­¥ã€‚",
            options: [
                { text: "ã€ç¬¨æ‹™åœ°å­¦ä¹ ã€‘", effects: { favor: 10 }, log: "ä½ ç¬¨æ‹™çš„èˆæ­¥é€—å¾—å¥¹ç¬‘ä¸ªä¸åœï¼Œä½ ä»¬åœ¨ç¬‘é—¹ä¸­é å¾—æ›´è¿‘äº†ã€‚" },
                { text: "ã€å±•ç°å¤©èµ‹ã€‘", req: { talent: 60 }, effects: { favor: 15 }, log: "ä½ ç«Ÿä¸€ç‚¹å°±é€šï¼Œä¸å¥¹è·³å¾—æœ‰æ¨¡æœ‰æ ·ï¼Œå¥¹å¯¹ä½ çš„å¤©èµ‹å¾ˆæ˜¯æƒŠè®¶ã€‚" }
            ]
        },
        {
            title: "æ‚²ä¼¤çš„èˆè¹ˆ",
            desc: "ä»Šå¤©çš„èˆè¹ˆå……æ»¡äº†æ‚²ä¼¤çš„æƒ…ç»ªï¼Œå¥¹çœ¼è§’å«æ³ªï¼Œä»¿ä½›åœ¨è¯‰è¯´ä¸€ä¸ªæ‚²æƒ¨çš„æ•…äº‹ã€‚",
            options: [
                { text: "ã€ä¸Šå‰æ‹­å»å¥¹çš„çœ¼æ³ªã€‘", effects: { favor: 18 }, log: "ä¸€èˆç»ˆäº†ï¼Œä½ ä¸Šå‰æ¸©æŸ”åœ°ä¸ºå¥¹æ‹­å»æ³ªæ°´ï¼Œå¥¹å†ä¹Ÿå¿ä¸ä½ï¼Œä¼åœ¨ä½ è‚©å¤´ä½å£°å•œæ³£ã€‚" },
                { text: "ã€è¯¢é—®å¥¹ä¸ºä½•æ‚²ä¼¤ã€‘", effects: { favor: 12 }, log: "ä½ è¯¢é—®å¥¹ï¼Œå¥¹å‘ä½ åéœ²äº†å¿ƒäº‹ï¼Œä½ ä»¬çš„å…³ç³»æ›´è¿‘äº†ä¸€æ­¥ã€‚" }
            ]
        },
        {
            title: "å¼‚åŸŸé£æƒ…èˆ",
            desc: "å¥¹æ¢ä¸Šä¸€èº«ç«çº¢çš„å¼‚åŸŸèˆè£™ï¼Œä¸ºä½ è·³èµ·çƒ­æƒ…å¥”æ”¾çš„èƒ¡æ—‹èˆï¼Œè£™æ‘†é£æ‰¬ï¼Œæ´»åŠ›å››å°„ã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹å‡»æŒæ‰“èŠ‚æ‹ã€‘", effects: { favor: 10 }, log: "ä½ ä¸ºå¥¹å‡»æŒæ‰“ç€èŠ‚æ‹ï¼Œå¥¹è·³å¾—æ›´åŠ èµ·åŠ²äº†ã€‚" },
                { text: "ã€ç§°èµå¥¹çš„æ´»åŠ›ã€‘", effects: { favor: 8 }, log: "ä½ ç§°èµå¥¹çš„èˆå§¿åƒä¸€å›¢ç«ç„°ï¼Œç‚¹ç‡ƒäº†ä½ çš„å¿ƒã€‚" }
            ]
        },
        {
            title: "é†‰èˆ",
            desc: "å¥¹ä¼¼ä¹å¤šå–äº†å‡ æ¯ï¼Œå¸¦ç€é†‰æ„ä¸ºä½ èµ·èˆï¼Œèˆæ­¥è¸‰è·„ï¼Œå´æ›´æ˜¾å¨‡æ†¨å¯çˆ±ã€‚",
            options: [
                { text: "ã€æ‰¶ä½å¥¹ã€‘", effects: { favor: 12 }, log: "ä½ æ‹…å¿ƒå¥¹æ‘”å€’ï¼Œä¸Šå‰æ‰¶ä½å¥¹ï¼Œå¥¹é¡ºåŠ¿å€’åœ¨ä½ æ€€é‡Œï¼Œä¸å†èµ·æ¥ã€‚" },
                { text: "ã€ä¸å¥¹å…±é¥®ã€‘", effects: { favor: 10 }, log: "ä½ æ‹¿èµ·é…’æ¯ä¸å¥¹å¯¹é¥®ï¼Œä¸¤äººéƒ½é†‰çœ¼æƒºå¿ªï¼Œæ°”æ°›è¿·ç¦»ã€‚" }
            ]
        },
        {
            title: "çœ¼ç¥çš„äº¤æ±‡",
            desc: "åœ¨æ•´ä¸ªèˆè¹ˆä¸­ï¼Œå¥¹çš„ç›®å…‰å§‹ç»ˆæ²¡æœ‰ç¦»å¼€è¿‡ä½ ï¼Œå……æ»¡äº†ä¸“æ³¨ä¸æƒ…æ„ã€‚",
            options: [
                { text: "ã€ä»¥çœ¼ç¥å›åº”ã€‘", effects: { favor: 15 }, log: "ä½ ä»¬çš„ç›®å…‰åœ¨ç©ºä¸­äº¤æ±‡ï¼Œæ— éœ€è¨€è¯­ï¼Œä¾¿å·²èƒœè¿‡åƒè¨€ä¸‡è¯­ã€‚" },
                { text: "ã€å®³ç¾åœ°ç§»å¼€ç›®å…‰ã€‘", effects: { favor: 5 }, log: "ä½ æœ‰äº›å®³ç¾åœ°ç§»å¼€äº†ç›®å…‰ï¼Œå¥¹è§äº†ï¼Œå˜´è§’å‹¾èµ·ä¸€æŠ¹å¾—æ„çš„å¾®ç¬‘ã€‚" }
            ]
        },
        {
            title: "çº¢ç»¸èˆ",
            desc: "å¥¹èˆåŠ¨ç€é•¿é•¿çš„çº¢ç»¸ï¼Œçº¢ç»¸å¦‚é¾™ï¼Œåœ¨ä½ èº«è¾¹ç¯ç»•ï¼Œæœ€åè½»è½»åœ°ç¼šä½äº†ä½ çš„æ‰‹è…•ã€‚",
            options: [
                { text: "ã€ä»»ç”±å¥¹â€œä¿˜è·â€ã€‘", effects: { favor: 15 }, log: "ä½ ä»»ç”±çº¢ç»¸ç¼šä½ï¼Œç¬‘ç€è¯´ï¼šâ€œæˆ‘æ—©å°±è¢«ä½ ä¿˜è·äº†ã€‚â€å¥¹å¬åï¼Œç¬‘é¥å¦‚èŠ±ã€‚" },
                { text: "ã€æŒ£è„±çº¢ç»¸ã€‘", effects: { favor: -3 }, log: "ä½ æŒ£è„±äº†çº¢ç»¸ï¼Œå¥¹è§‰å¾—ä½ æœ‰äº›ä¸è§£é£æƒ…ã€‚" }
            ]
        },
        {
            title: "æœˆä¸‹ç‹¬èˆ",
            desc: "å¥¹é‚€ä½ åœ¨åº­é™¢ä¸­èµæœˆï¼Œå¹¶å³å…´åœ¨æœˆå…‰ä¸‹ä¸ºä½ ç‹¬èˆä¸€æ›²ï¼Œèº«å½±å¦‚æ¢¦ä¼¼å¹»ã€‚",
            options: [
                { text: "ã€é™é™æ¬£èµã€‘", effects: { favor: 12 }, log: "æ­¤æƒ…æ­¤æ™¯ï¼Œç¾å¾—å¦‚åŒä¸€å¹…ç”»ï¼Œè®©ä½ æ²‰é†‰å…¶ä¸­ã€‚" },
                { text: "ã€ä¸ºå¥¹åŸè¯—ã€‘", req: { talent: 70 }, effects: { favor: 18 }, log: "ä½ ä¸ºå¥¹çš„èˆå§¿å³å…´èµ‹è¯—ä¸€é¦–ï¼Œè¯—èˆç›¸åˆï¼Œå ªç§°ç»é…ã€‚" }
            ]
        }
    ],
    // å¬ç´äº’åŠ¨äº‹ä»¶åº“
    music: [
        // æ‚¨å·²æœ‰çš„äº‹ä»¶ (å·²ä¿ç•™)
        {
            title: "ç´å£°å¯„æƒ…",
            desc: "å¥¹å¼¹å¥çš„æ›²å­ä¼¼ä¹æ»¡å«æƒ…æ„ï¼Œæ¯ä¸€ä¸ªéŸ³ç¬¦éƒ½åœ¨è¯‰è¯´ç€å¯¹ä½ çš„çˆ±æ…•ã€‚",
            options: [
                { text: "ã€å¬å‡ºæ›²ä¸­ä¹‹æ„ã€‘", req: { talent: 60 }, effects: { favor: 15 }, log: "ä½ å¬å‡ºäº†å¥¹ç´å£°ä¸­çš„æƒ…æ„ï¼Œå¹¶ä»¥è¯—å›åº”ï¼Œå¥¹è§†ä½ ä¸ºçŸ¥éŸ³ã€‚" },
                { text: "ã€ç§°èµç´è‰ºé«˜è¶…ã€‘", effects: { favor: 8 }, log: "ä½ ç§°èµå¥¹çš„ç´è‰ºï¼Œå¥¹å¾®ç¬‘ç€æ¥å—äº†ã€‚" }
            ]
        },
        {
            title: "ç´å¼¦æ–­è£‚",
            desc: "å¼¹åˆ°é«˜æ½®å¤„ï¼Œç´å¼¦çªç„¶æ–­äº†ä¸€æ ¹ï¼Œå¥¹æœ‰äº›ä¸çŸ¥æ‰€æªã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹æ¢ä¸Šæ–°å¼¦ã€‘", effects: { favor: 12 }, log: "ä½ ç†Ÿç»ƒåœ°ä¸ºå¥¹æ¢ä¸Šæ–°å¼¦ï¼Œè¿™ä»½ä»å®¹è®©å¥¹å¾ˆæ˜¯æ¬£èµã€‚" },
                { text: "ã€å®‰æ…°å¥¹ã€‘", effects: { favor: 5 }, log: "ä½ å®‰æ…°å¥¹è¯´æ–­å¼¦æ˜¯çŸ¥éŸ³çš„é¢„å…†ï¼Œå¥¹ç ´æ¶•ä¸ºç¬‘ã€‚" }
            ]
        },
        {
            title: "ç´ç®«åˆå¥",
            desc: "ä½ å–å‡ºéšèº«æºå¸¦çš„æ´ç®«ï¼Œæè®®ä¸å¥¹ç´ç®«åˆå¥ä¸€æ›²ã€‚",
            options: [
                { text: "ã€å¼€å§‹åˆå¥ã€‘", req: { talent: 80 }, effects: { favor: 20 }, log: "ä½ ä»¬ç´ç®«å’Œé¸£ï¼Œå®›å¦‚å¤©ä½œä¹‹åˆï¼Œä¸€æ›²ç»ˆäº†ï¼Œæ„çŠ¹æœªå°½ã€‚" },
                { text: "ã€æŠ€è‰ºä¸ç²¾ã€‘", effects: { favor: -5 }, log: "ä½ çš„ç®«å£°ä¸å¥¹çš„ç´å£°æ ¼æ ¼ä¸å…¥ï¼Œç ´åäº†æ°”æ°›ã€‚" }
            ]
        },
        // æ–°å¢10ä¸ªå¬ç´äº‹ä»¶
        {
            title: "ä¸ºä½ è€Œä½œ",
            desc: "â€œè¿™é¦–æ›²å­ï¼Œæ˜¯å¦¾èº«ä¸“é—¨ä¸ºå…¬å­æ‰€ä½œï¼Œåä¸ºã€ŠçŸ¥æ„ã€‹ã€‚â€å¥¹è¯´ç€ï¼Œä¸ºä½ å¼¹å¥äº†ä¸€é¦–ä»æœªå¬è¿‡çš„æ›²å­ã€‚",
            options: [
                { text: "ã€æ·±å—æ„ŸåŠ¨ã€‘", effects: { favor: 20 }, log: "è¿™ä»½ç‰¹æ®Šçš„å¿ƒæ„è®©ä½ æ·±å—æ„ŸåŠ¨ï¼Œä½ çŸ¥é“ï¼Œè¿™é¦–æ›²å­åªå±äºä½ ä¸€äººã€‚" },
                { text: "ã€ä¸ºæ›²å­å¡«è¯ã€‘", req: { talent: 80 }, effects: { favor: 25 }, log: "ä½ ä¸ºå¥¹çš„æ›²å­å¡«ä¸Šäº†è¯ï¼Œè¯æ›²ç›¸å¾—ç›Šå½°ï¼Œæˆä¸ºä½ ä»¬ä¹‹é—´ç‹¬ä¸€æ— äºŒçš„ä½œå“ã€‚" }
            ]
        },
        {
            title: "æŒ‡å°–çš„ä¼¤",
            desc: "ä¸€æ›²å¼¹ç½¢ï¼Œä½ å‘ç°å¥¹ç™½çš™çš„æŒ‡å°–å› ç»ƒç´è€Œå·²æœ‰äº›çº¢è‚¿ï¼Œç”šè‡³ç£¨å‡ºäº†è–„èŒ§ã€‚",
            options: [
                { text: "ã€å¿ƒç–¼åœ°ä¸ºå¥¹ä¸Šè¯ã€‘", effects: { favor: 18 }, log: "ä½ æ‹¿å‡ºé‡‘ç–®è¯ï¼Œå°å¿ƒç¿¼ç¿¼åœ°ä¸ºå¥¹ä¸Šè¯ï¼Œè¿™ä»½å¿ƒç–¼ä¸å‘µæŠ¤è®©å¥¹æ— æ¯”åŠ¨å®¹ã€‚" },
                { text: "ã€ç§°èµå¥¹çš„å‹¤å¥‹ã€‘", effects: { favor: 8 }, log: "ä½ ç§°èµå¥¹çš„å‹¤å¥‹ï¼Œå¥¹ç¬‘ç€è¯´ï¼Œä¸ºäº†å¼¹ç»™ä½ å¬ï¼Œè¿™ä¸€åˆ‡éƒ½å€¼å¾—ã€‚" }
            ]
        },
        {
            title: "å”±æ›²åŠ©å…´",
            desc: "å¥¹ä¸ä»…æŠšç´ï¼Œè¿˜è½»å¯æœ±å”‡ï¼Œä¸ºä½ å”±èµ·ä¸€é¦–æ±Ÿå—å°è°ƒï¼Œæ­Œå£°å©‰è½¬ï¼Œç”œå…¥å¿ƒæ‰‰ã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹å–å½©ã€‘", effects: { favor: 10 }, log: "ä½ ä¸ºå¥¹å¤§å£°å–å½©ï¼Œå¥¹å”±å¾—æ›´åŠ åŠ¨æƒ…ã€‚" },
                { text: "ã€é‚€å¥¹å†å”±ä¸€æ›²ã€‘", effects: { favor: 12 }, log: "ä½ è¯·æ±‚å¥¹å†å”±ä¸€æ›²ï¼Œå¥¹æ¬£ç„¶åº”å…ã€‚" }
            ]
        },
        {
            title: "æ•™ä½ æŠšç´",
            desc: "å¥¹ç¬‘ç€é‚€è¯·ä½ ååˆ°å¥¹èº«è¾¹ï¼Œè¦æ•™ä½ æŠšç´ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶å­¦ä¹ ã€‘", effects: { favor: 15 }, log: "ä½ ååˆ°å¥¹èº«æ—ï¼Œå¥¹æ¡ç€ä½ çš„æ‰‹ï¼Œæ‰‹æŠŠæ‰‹åœ°æ•™ä½ ã€‚é†‰ç¿ä¹‹æ„ä¸åœ¨é…’ï¼Œä½ æ—©å·²æ²‰é†‰åœ¨å¥¹èº«ä¸Šç‹¬æœ‰çš„é¦™æ°”é‡Œã€‚" },
                { text: "ã€ç¬¨æ‰‹ç¬¨è„šã€‘", effects: { favor: 8 }, log: "ä½ å¼¹å‡ºçš„å£°éŸ³å¦‚åŒå™ªéŸ³ï¼Œä½†å¥¹å´è¢«ä½ ç¬¨æ‹™çš„æ ·å­é€—å¾—ç¬‘ä¸ªä¸åœã€‚" }
            ]
        },
        {
            title: "å›å¿†ä¹‹æ›²",
            desc: "å¥¹å¼¹èµ·äº†ä¸€é¦–ä½ ä»¬åˆè§æ—¶å¬è¿‡çš„æ›²å­ï¼Œç´å£°ä¸­å……æ»¡äº†å›å¿†ã€‚",
            options: [
                { text: "ã€è¯´å‡ºæ›²åã€‘", req: { wisdom: 60 }, effects: { favor: 15 }, log: "ä½ å‡†ç¡®åœ°è¯´å‡ºäº†æ›²åå’Œå½“æ—¶çš„æƒ…æ™¯ï¼Œå¥¹æƒŠå–œäºä½ çš„è®°å¿†åŠ›ï¼ŒçŸ¥é“ä½ ä¸€ç›´å°†å¥¹æ”¾åœ¨å¿ƒä¸Šã€‚" },
                { text: "ã€é™é™è†å¬ã€‘", effects: { favor: 8 }, log: "ä½ é™é™åœ°å¬ç€ï¼Œå¾€äº‹å†å†åœ¨ç›®ï¼Œä½ ä»¬ä¸€åŒæ²‰æµ¸åœ¨ç¾å¥½çš„å›å¿†ä¸­ã€‚" }
            ]
        },
        {
            title: "æ€ä¼ä¹‹éŸ³",
            desc: "å¥¹ä»Šæ—¥å¼¹å¥çš„æ›²å­ç«Ÿæ˜¯ã€Šåé¢åŸ‹ä¼ã€‹ï¼Œç´å£°ä¸­å……æ»¡äº†é‡‘æˆˆé“é©¬çš„è‚ƒæ€ä¹‹æ°”ï¼Œä¸å¹³æ—¥çš„æ¸©å©‰æˆªç„¶ä¸åŒã€‚",
            options: [
                { text: "ã€ç§°èµå…¶æ°”åŠ¿ã€‘", effects: { favor: 10 }, log: "ä½ ç§°èµå¥¹èƒ¸æœ‰ä¸˜å£‘ï¼Œå·¾å¸¼ä¸è®©é¡»çœ‰ï¼Œå¥¹å¯¹ä½ çš„ç†è§£å¾ˆæ˜¯æ¬£èµã€‚" },
                { text: "ã€è¯¢é—®å…¶å¿ƒäº‹ã€‘", effects: { favor: 12 }, log: "ä½ è¯¢é—®å¥¹æ˜¯å¦é‡åˆ°çƒ¦å¿ƒäº‹ï¼Œå¥¹å‘ä½ åéœ²äº†å¿ƒä¸­çš„æ„¤æ‡‘ã€‚" }
            ]
        },
        {
            title: "ç´éŸ³ç–—ä¼¤",
            desc: "ä½ è¿‘æ¥å› å…¬åŠ¡çƒ¦å¿ƒï¼Œå¥¹ä¸ºä½ å¼¹å¥äº†ä¸€æ›²å®‰ç¥çš„æ›²å­ï¼Œç´å£°å¦‚æµæ°´ï¼Œæ¶¤è¡ç€ä½ çš„å¿ƒçµã€‚",
            options: [
                { text: "ã€é—­ç›®å…»ç¥ã€‘", effects: { favor: 12, health: 2 }, log: "ä½ åœ¨å¥¹çš„ç´å£°ä¸­ï¼Œæ„Ÿåˆ°æ— æ¯”çš„æ”¾æ¾ï¼Œçƒ¦æ¼ä¼¼ä¹éƒ½çƒŸæ¶ˆäº‘æ•£äº†ã€‚" },
                { text: "ã€æ„Ÿè°¢å¥¹çš„ä½“è´´ã€‘", effects: { favor: 10 }, log: "ä½ æ„Ÿè°¢å¥¹çš„ä½“è´´ï¼Œå¥¹å¾®ç¬‘ç€è¯´ï¼Œèƒ½ä¸ºå…¬å­åˆ†å¿§æ˜¯å¥¹çš„ç¦æ°”ã€‚" }
            ]
        },
        {
            title: "éš”å¢™æœ‰è€³",
            desc: "æ­£å½“ä½ ä»¬æ²‰æµ¸åœ¨éŸ³ä¹ä¸­æ—¶ï¼Œå¥¹çªç„¶åœä¸‹ï¼Œç¤ºæ„ä½ çª—å¤–æœ‰äººåœ¨å·å¬ã€‚",
            options: [
                { text: "ã€ä¸Šå‰æŸ¥çœ‹ã€‘", req: { martial: 60 }, effects: { favor: 10 }, log: "ä½ ä¸Šå‰æŸ¥çœ‹ï¼Œå°†æ¥äººæƒŠèµ°ï¼Œè¿™ä»½è­¦è§‰å’Œæ­¦å‹‡è®©å¥¹å¾ˆæœ‰å®‰å…¨æ„Ÿã€‚" },
                { text: "ã€å°†è®¡å°±è®¡ã€‘", req: { wisdom: 70 }, effects: { favor: 12 }, log: "ä½ ä»¬å°†è®¡å°±è®¡ï¼Œæ•…æ„è¯´äº›è¯ç»™å¤–é¢çš„äººå¬ï¼Œç›¸è§†ä¸€ç¬‘ï¼Œé»˜å¥‘åè¶³ã€‚" }
            ]
        },
        {
            title: "ç´ç‘Ÿä¹‹å–»",
            desc: "â€œå¸¸è¨€é“ç´ç‘Ÿå’Œé¸£ï¼Œä¸çŸ¥å…¬å­æ˜¯å¦æ„¿åšå¦¾èº«çš„â€˜ç‘Ÿâ€™ï¼Ÿâ€å¥¹æŠšç€ç´ï¼Œæ„æœ‰æ‰€æŒ‡åœ°é—®é“ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶åº”å…ã€‘", effects: { favor: 15 }, log: "â€œæ„¿ä¸å§‘å¨˜ï¼Œç´ç‘Ÿå’Œé¸£ï¼Œå…±è°±ä¸€æ›²ã€‚â€ä½ çš„å›åº”è®©å¥¹å–œä¸Šçœ‰æ¢¢ã€‚" },
                { text: "ã€è£…ä½œä¸æ‡‚ã€‘", effects: { favor: -5 }, log: "ä½ å‡è£…ä¸æ‡‚å¥¹çš„æš—ç¤ºï¼Œå¥¹æœ‰äº›å¤±æœ›ã€‚" }
            ]
        },
        {
            title: "å³å…´åˆ›ä½œ",
            desc: "ä½ éšå£åŸè¯µäº†ä¸€å¥è¯—ï¼Œå¥¹å¬åï¼Œç«Ÿèƒ½ç«‹åˆ»å°†å…¶è°±æˆæ›²å­ï¼Œå³å…´å¼¹å¥å‡ºæ¥ã€‚",
            options: [
                { text: "ã€æƒŠä¸ºå¤©äººã€‘", effects: { favor: 15 }, log: "ä½ å¯¹å¥¹çš„æ‰æ€æ•æ·æƒŠä¸ºå¤©äººï¼Œå¥¹å¯¹ä½ çš„è¯—æ‰ä¹Ÿèµå¹ä¸å·²ï¼Œä½ ä»¬æ˜¯çœŸæ­£çš„çŸ¥éŸ³ã€‚" },
                { text: "ã€é‚€è¯·å¥¹åˆä½œã€‘", effects: { favor: 12 }, log: "ä½ é‚€è¯·å¥¹æœªæ¥å¤šä¸ä½ åˆä½œï¼Œå…±åŒåˆ›ä½œï¼Œå¥¹æ¬£ç„¶åŒæ„ã€‚" }
            ]
        }
    ],
    // å¯¹å¼ˆäº’åŠ¨äº‹ä»¶åº“
    chess: [
        // æ‚¨å·²æœ‰çš„äº‹ä»¶ (å·²ä¿ç•™)
        {
            title: "æ£‹å±€ä¹‹äº‰",
            desc: "ä½ ä»¬æ­£åœ¨å¯¹å¼ˆï¼Œæ£‹å±€é™·å…¥èƒ¶ç€ã€‚å¥¹å¿½ç„¶å‡‘è¿‘ï¼Œåæ°”å¦‚å…°åœ°é—®ä½ ä¸‹ä¸€æ­¥è¯¥å¦‚ä½•èµ°ã€‚",
            options: [
                { text: "ã€æ•…æ„è®©æ£‹ã€‘", effects: { favor: 10 }, log: "ä½ æ•…æ„èµ°äº†ä¸€æ­¥è‡­æ£‹ï¼Œè®©å¥¹èµ¢å¾—äº†æ£‹å±€ï¼Œå¥¹å¼€å¿ƒåœ°ç¬‘äº†ã€‚" },
                { text: "ã€ä»å®¹åº”å¯¹ã€‘", req: { wisdom: 70 }, effects: { favor: 12 }, log: "ä½ è¯†ç ´äº†å¥¹çš„ç¾äººè®¡ï¼Œå¹¶ä¸‹å‡ºå¦™æ‰‹ï¼Œå¥¹å¯¹ä½ çš„æ™ºæ…§èµå¹ä¸å·²ã€‚" }
            ]
        },
        {
            title: "æ‚”æ£‹",
            desc: "å¥¹èµ°é”™ä¸€æ­¥ï¼Œæ’…ç€å˜´å‘ä½ è¯·æ±‚æ‚”æ£‹ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶åŒæ„ã€‘", effects: { favor: 8 }, log: "â€œè§‚æ£‹ä¸è¯­çœŸå›å­ï¼Œè½å­æ— æ‚”å¤§ä¸ˆå¤«ã€‚ä½†å¯¹å§‘å¨˜ä½ ï¼Œåˆä½•å¦¨ç ´ä¾‹ä¸€æ¬¡ï¼Ÿâ€ä½ çš„è¯é€—ç¬‘äº†å¥¹ã€‚" },
                { text: "ã€æ‹’ç»ã€‘", effects: { favor: -5 }, log: "ä½ æ‹’ç»äº†å¥¹çš„è¯·æ±‚ï¼Œå¥¹æœ‰äº›ä¸é«˜å…´ã€‚" }
            ]
        },
        {
            title: "æ£‹ç›˜å¤–çš„èµŒæ³¨",
            desc: "â€œè‹¥æˆ‘èµ¢äº†ï¼Œå…¬å­ä¾¿è¦ç­”åº”æˆ‘ä¸€ä¸ªæ¡ä»¶ï¼Œå¦‚ä½•ï¼Ÿâ€å¥¹ç‹¡é» åœ°çœ¨äº†çœ¨çœ¼ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶åº”å…ã€‘", effects: { favor: 10 }, log: "ä½ ç¬‘ç€åº”å…äº†ï¼Œæ— è®ºè¾“èµ¢ï¼Œè¿™éƒ½æ˜¯ä¸€åœºé£èŠ±é›ªæœˆçš„æ¸¸æˆã€‚" },
                { text: "ã€åå°†ä¸€å†›ã€‘", effects: { favor: 12 }, log: "â€œè‹¥æˆ‘èµ¢äº†ï¼Œå§‘å¨˜ä¾¿è¦ä¸ºæˆ‘ç‹¬èˆä¸€æ›²ã€‚â€ä½ çš„åå°†ä¸€å†›è®©å¥¹è„¸é¢Šå¾®çº¢ã€‚" }
            ]
        },
        // æ–°å¢10ä¸ªå¯¹å¼ˆäº‹ä»¶
        {
            title: "æŒ‡å¯¼æ£‹",
            desc: "å¥¹çš„æ£‹åŠ›è¿œä¸å¦‚ä½ ï¼Œä½ å†³å®šè®©å¥¹å‡ å­ï¼Œä½œä¸ºæŒ‡å¯¼ã€‚",
            options: [
                { text: "ã€è€å¿ƒæŒ‡å¯¼ã€‘", effects: { favor: 12 }, log: "ä½ è€å¿ƒåœ°ä¸ºå¥¹è®²è§£æ¯ä¸€æ­¥çš„å¾—å¤±ï¼Œå¥¹è™½ç„¶æ£‹è‰ºæœªè¿›ï¼Œä½†å¯¹ä½ çš„å¥½æ„Ÿå¤§å¢ã€‚" },
                { text: "ã€æ€å¾—å¥¹ç‰‡ç”²ä¸ç•™ã€‘", effects: { favor: -8 }, log: "ä½ æ¯«ä¸ç•™æƒ…ï¼Œæ€å¾—å¥¹ç‰‡ç”²ä¸ç•™ï¼Œå¥¹æœ‰äº›æ¼æ€’ï¼Œè§‰å¾—ä½ ä¸çŸ¥æ€œé¦™æƒœç‰ã€‚" }
            ]
        },
        {
            title: "æ£‹å­ä¼ æƒ…",
            desc: "å¥¹ç”¨æ£‹å­åœ¨æ£‹ç›˜ä¸Šæ‘†å‡ºäº†ä¸€ä¸ªâ€œå¿ƒâ€å½¢ã€‚",
            options: [
                { text: "ã€ç”¨æ£‹å­å›åº”ã€‘", req: { wisdom: 60 }, effects: { favor: 15 }, log: "ä½ ä¹Ÿç”¨æ£‹å­åœ¨æ—è¾¹æ‘†äº†ä¸€ä¸ªâ€œå¿ƒâ€ï¼Œå¥¹è§åï¼Œæ»¡çœ¼éƒ½æ˜¯ç¬‘æ„ã€‚" },
                { text: "ã€å‡è£…æ²¡çœ‹è§ã€‘", effects: { favor: -5 }, log: "ä½ å‡è£…æ²¡çœ‹è§ï¼Œç»§ç»­ä¸‹æ£‹ï¼Œå¥¹çš„å¿ƒæ„è¢«è¾œè´Ÿï¼Œæœ‰äº›å¤±è½ã€‚" }
            ]
        },
        {
            title: "æ·±å¤œæ£‹å±€",
            desc: "ä½ ä»¬çš„æ£‹å±€ä»ç™½å¤©æ€åˆ°æ·±å¤œï¼Œä¾æ—§éš¾åˆ†éš¾è§£ã€‚",
            options: [
                { text: "ã€æè®®å°ç›˜æ˜æ—¥å†æˆ˜ã€‘", effects: { favor: 8 }, log: "ä½ ä»¬çº¦å®šæ˜æ—¥å†æˆ˜ï¼Œå¯¹ç¬¬äºŒå¤©çš„çº¦ä¼šå……æ»¡æœŸå¾…ã€‚" },
                { text: "ã€ç‚¹ç¯å¤œæˆ˜ã€‘", effects: { favor: 10, health: -1 }, log: "ä½ ä»¬ç‚¹ç¯å¤œæˆ˜ï¼Œç›´åˆ°é›„é¸¡æŠ¥æ™“ï¼Œè™½æœ‰äº›ç–²æƒ«ï¼Œå´å¤§å‘¼è¿‡ç˜¾ã€‚" }
            ]
        },
        {
            title: "æ—è§‚è€…æ¸…",
            desc: "ä½ ä»¬çš„æ£‹å±€å¸å¼•äº†æ—äººå›´è§‚ï¼Œä¸€ä½è€è€…å¯¹ä½ çš„æ£‹è·¯æå‡ºäº†æ‰¹è¯„ã€‚",
            options: [
                { text: "ã€è™šå¿ƒæ¥å—ã€‘", effects: { favor: 10, wisdom: 2 }, log: "ä½ è™šå¿ƒæ¥å—äº†æ‰¹è¯„ï¼Œè¿™ä»½æ°”åº¦è®©å¥¹å¾ˆæ˜¯æ¬£èµã€‚" },
                { text: "ã€ä¸è€è€…è¾©è®ºã€‘", effects: { favor: -5 }, log: "ä½ ä¸è€è€…äº‰è®ºèµ·æ¥ï¼Œå¥¹è§‰å¾—ä½ æœ‰äº›å¤±äº†é£åº¦ã€‚" }
            ]
        },
        {
            title: "å–‚é£Ÿç‚¹å¿ƒ",
            desc: "ä½ æ­£é•¿è€ƒæ—¶ï¼Œå¥¹æ‹ˆèµ·ä¸€å—ç²¾è‡´çš„ç‚¹å¿ƒï¼Œäº²æ‰‹å–‚åˆ°ä½ çš„å˜´è¾¹ã€‚",
            options: [
                { text: "ã€å¼ å£åƒä¸‹ã€‘", effects: { favor: 15 }, log: "ä½ è‡ªç„¶åœ°å¼ å£åƒä¸‹ï¼Œé¡ºåŠ¿å«ä½äº†å¥¹çš„æŒ‡å°–ï¼Œå¥¹è§¦ç”µèˆ¬åœ°ç¼©å›æ‰‹ï¼Œè„¸çº¢å¿ƒè·³ã€‚" },
                { text: "ã€æ‘‡å¤´æ‹’ç»ã€‘", effects: { favor: -3 }, log: "ä½ æ‘‡å¤´æ‹’ç»ï¼Œå¥¹æœ‰äº›å°´å°¬åœ°æ”¶å›äº†æ‰‹ã€‚" }
            ]
        },
        {
            title: "ä»¥èº«ä¸ºæ£‹",
            desc: "â€œè¿™ç›˜æ£‹å¤ªæ— è¶£äº†ï¼Œä¸å¦‚...æˆ‘ä»¬æ¢ä¸ªç©æ³•ï¼Ÿâ€å¥¹è¯´ç€ï¼Œå°†æ£‹ç›˜æ‰«è½ï¼Œåªšçœ¼å¦‚ä¸åœ°çœ‹ç€ä½ ã€‚",
            options: [
                { text: "ã€ä¼šå¿ƒä¸€ç¬‘ã€‘", effects: { favor: 20 }, log: "ä½ ä¼šå¿ƒä¸€ç¬‘ï¼Œå°†å¥¹æ‹¦è…°æŠ±èµ·ï¼Œèµ°å‘äº†å†…å®¤..." },
                { text: "ã€æ­£è¥Ÿå±åã€‘", req: { virtue: 80 }, effects: { favor: -10 }, log: "ä½ æ­£è¥Ÿå±åï¼Œè®¤ä¸ºå¥¹æœ‰å¤±ä½“ç»Ÿï¼Œå¥¹è‡ªè®¨æ²¡è¶£ï¼Œå¾ˆæ˜¯æ¼ç«ã€‚" }
            ]
        },
        {
            title: "å¤©å…ƒä¹‹äº‰",
            desc: "å¼€å±€ç¬¬ä¸€æ‰‹ï¼Œå¥¹ç«Ÿç›´æ¥è½å­äºå¤©å…ƒï¼Œæ£‹è·¯è¯¡å¼‚ï¼Œä¸æŒ‰å¸¸ç†ã€‚",
            options: [
                { text: "ã€ç§°èµå…¶ä¸æ‹˜ä¸€æ ¼ã€‘", effects: { favor: 8 }, log: "ä½ ç§°èµå¥¹çš„æ£‹è·¯ä¸æ‹˜ä¸€æ ¼ï¼Œå¥¹å¾—æ„åœ°ç¬‘äº†ã€‚" },
                { text: "ã€è®¤ä¸ºå…¶ä¸æ‡‚æ£‹ç†ã€‘", effects: { favor: -3 }, log: "ä½ è®¤ä¸ºå¥¹ä¸æ‡‚æ£‹ç†ï¼Œå¥¹å´è¯´æ£‹æœ¬æ— å®šæ³•ã€‚" }
            ]
        },
        {
            title: "æ”¶æ‹¾æ£‹å­",
            desc: "æ£‹å±€ç»“æŸï¼Œä½ ä»¬ä¸€åŒæ”¶æ‹¾æ£‹å­ï¼ŒæŒ‡å°–å¶å°”è§¦ç¢°ï¼Œæ°”æ°›å¾®å¦™ã€‚",
            options: [
                { text: "ã€æ¡ä½å¥¹çš„æ‰‹ã€‘", effects: { favor: 12 }, log: "åœ¨ä¸€æ¬¡è§¦ç¢°æ—¶ï¼Œä½ é¡ºåŠ¿æ¡ä½äº†å¥¹çš„æ‰‹ï¼Œå¥¹æ²¡æœ‰æŒ£è„±ï¼Œåªæ˜¯ä½ä¸‹äº†å¤´ã€‚" },
                { text: "ã€å¿«é€Ÿæ”¶æ‹¾ã€‘", effects: { favor: 5 }, log: "ä½ ä»¬å¾ˆå¿«æ”¶æ‹¾å¥½äº†æ£‹å­ï¼Œç›¸çº¦ä¸‹æ¬¡å†æˆ˜ã€‚" }
            ]
        },
        {
            title: "æ£‹é€¢å¯¹æ‰‹",
            desc: "å¥¹çš„æ£‹åŠ›ç«Ÿä¸ä½ ä¸ç›¸ä¸Šä¸‹ï¼Œä½ ä»¬ä½ æ¥æˆ‘å¾€ï¼Œæ€å¾—éš¾åˆ†éš¾è§£ã€‚",
            options: [
                { text: "ã€æƒºæƒºç›¸æƒœã€‘", effects: { favor: 15 }, log: "â€œäººç”Ÿéš¾å¾—ä¸€çŸ¥å·±ï¼Œæ£‹é€¢å¯¹æ‰‹äº¦æ˜¯å¦‚æ­¤ã€‚â€ä½ ä»¬æƒºæƒºç›¸æƒœï¼Œå¥½æ„Ÿå¤§å¢ã€‚" },
                { text: "ã€ç‡ƒèµ·å¥½èƒœå¿ƒã€‘", effects: { favor: 8 }, log: "ä½ ç‡ƒèµ·äº†å¥½èƒœå¿ƒï¼Œä¸€å¿ƒåªæƒ³èµ¢ä¸‹è¿™ç›˜æ£‹ã€‚" }
            ]
        },
        {
            title: "åˆ†å¿ƒ",
            desc: "å¯¹å¼ˆæ—¶ï¼Œä½ å‘ç°å¥¹ä¼¼ä¹ä¸€ç›´æ²¡åœ¨çœ‹æ£‹ç›˜ï¼Œè€Œæ˜¯åœ¨å·å·åœ°çœ‹ä½ ã€‚",
            options: [
                { text: "ã€å¼€å£è°ƒä¾ƒã€‘", effects: { favor: 12 }, log: "â€œå§‘å¨˜çœ‹çš„ï¼Œç©¶ç«Ÿæ˜¯æ£‹ï¼Œè¿˜æ˜¯æˆ‘ï¼Ÿâ€ä½ çš„è°ƒä¾ƒè®©å¥¹ç¾çº¢äº†è„¸ã€‚" },
                { text: "ã€å‡è£…ä¸çŸ¥ã€‘", effects: { favor: 5 }, log: "ä½ å‡è£…ä¸çŸ¥é“ï¼Œå¿ƒä¸­å´æœ‰äº›çªƒå–œã€‚" }
            ]
        }
    ],
    // å…±åº¦è‰¯å®µäº‹ä»¶åº“
    sleep: [
        // æ‚¨å·²æœ‰çš„äº‹ä»¶ (å·²ä¿ç•™)
        { desc: "çº¢çƒ›æ‘‡æ›³ï¼Œçº±å¸è½»å‚ã€‚å¥¹ä¸ºä½ å®½è¡£è§£å¸¦ï¼ŒåŠ¨ä½œæ¸©æŸ”è€Œç¾æ¶©ï¼Œçœ¼ä¸­æ˜¯åŒ–ä¸å¼€çš„ç»µç»µæƒ…æ„ã€‚ä¸€å¤œç¼ ç»µï¼Œè‡ªä¸å¿…è¯´ã€‚", effects: { favor: 15, charm: 2, health: -2 } },
        { desc: "å¥¹ä¸ºä½ æ¸©å¥½ä¸€å£¶é…’ï¼Œä¸ä½ å¯¹é…Œã€‚é…’è‡³åŠé…£ï¼Œå¥¹åªšçœ¼å¦‚ä¸ï¼Œä¸»åŠ¨ä¾åå…¥ä½ æ€€ä¸­ï¼Œåæ°”å¦‚å…°ï¼šâ€œå…¬å­ï¼Œå¤œæ·±äº†...â€ã€‚", effects: { favor: 18, health: -3 } },
        { desc: "ä½ æ²æµ´å½’æ¥ï¼Œå‘ç°å¥¹å·²ä¸ºä½ é“ºå¥½åºŠè¢«ï¼Œèº«ä¸Šåªç€ä¸€ä»¶è–„çº±ï¼Œç²ç‘èº«æ®µè‹¥éšè‹¥ç°ã€‚å¥¹ä½ç€å¤´ï¼Œè½»å£°é“ï¼šâ€œå¦¾èº«...æ­å€™å…¬å­å¤šæ—¶äº†ã€‚â€", effects: { favor: 20, charm: 3, health: -4 } },
        { desc: "çª—å¤–é£é›¨äº¤åŠ ï¼Œå±‹å†…å´æ˜¥è‰²æ— è¾¹ã€‚å¥¹ä¼¼ä¸€æœµè¢«é£é›¨å‚¬å¼€çš„å¨‡èŠ±ï¼Œåœ¨ä½ èº«ä¸‹å©‰è½¬æ‰¿æ¬¢ï¼ŒåŠ¨æƒ…å¤„ï¼Œå£°å£°å”¤ç€ä½ çš„åå­—ã€‚", effects: { favor: 16, health: -3 } },
        { desc: "æ¿€æƒ…è¿‡åï¼Œå¥¹æ…µæ‡’åœ°èººåœ¨ä½ è‡‚å¼¯ï¼Œç”¨æ‰‹æŒ‡åœ¨ä½ èƒ¸å£ç”»ç€åœˆï¼Œä¸ä½ èŠèµ·å¥³å„¿å®¶çš„å¿ƒäº‹ï¼Œä½ ä»¬çš„å…³ç³»ä¼¼ä¹ä¸æ­¢äºèº«ä½“çš„äº¤åˆã€‚", effects: { favor: 12, wisdom: 1 } },
        { desc: "å¥¹ä¼¼ä¹æœ‰äº›ç»éªŒä¸è¶³ï¼ŒåŠ¨ä½œç”Ÿæ¶©ï¼Œå´æ›´æ˜¾çº¯æƒ…ã€‚ä½ è€å¿ƒåœ°å¼•å¯¼ï¼Œå¥¹åœ¨ä½ çš„å¸¦é¢†ä¸‹ï¼Œé€æ¸é¢†ç•¥äº†äº‘é›¨ä¹‹ä¹ã€‚", effects: { favor: 14, virtue: -1 } },
        { desc: "â€œå¦¾æœ‰ä¸€æ³•ï¼Œå¯å¢æ·»é—ºæˆ¿ä¹‹ä¹ï¼Œå…¬å­å¯æ„¿ä¸€è¯•ï¼Ÿâ€å¥¹ä»æ•ä¸‹å–å‡ºä¸€æœ¬æ˜¥å®«å›¾å†Œï¼Œä¸ä½ å…±åŒç ”è¯»ï¼Œä¸€å¤œé£æµï¼Œè§£é”äº†æ— æ•°æ–°å§¿åŠ¿ã€‚", effects: { favor: 22, health: -5, talent: 1 } },
        // æ–°å¢10ä¸ªå…±åº¦è‰¯å®µäº‹ä»¶
        { desc: "å¥¹ä¸ºä½ å‡†å¤‡äº†èŠ±ç“£æµ´ï¼Œå¹¶äº²è‡ªä¸ºä½ æ“¦æ‹­èº«ä½“ï¼ŒæŒ‡å°–çš„æ¯ä¸€æ¬¡åˆ’è¿‡éƒ½åƒä¸€é“ç”µæµï¼Œè®©ä½ å¿ƒçŒ¿æ„é©¬ã€‚", effects: { favor: 18, health: 2 } },
        { desc: "äº‹åï¼Œå¥¹ä¾ååœ¨ä½ æ€€ä¸­æ²‰æ²‰ç¡å»ï¼Œå˜´è§’è¿˜å¸¦ç€æ»¡è¶³çš„å¾®ç¬‘ã€‚ä½ çœ‹ç€å¥¹å®‰è¯¦çš„ç¡é¢œï¼Œå¿ƒä¸­ä¸€ç‰‡æŸ”è½¯ã€‚", effects: { favor: 15, virtue: 1 } },
        { desc: "â€œå…¬å­ï¼Œç´¯äº†å§ï¼Ÿå¦¾èº«ä¸ºæ‚¨æŒ‰æŒ‰ã€‚â€å¥¹è·ªååœ¨ä½ èº«åï¼Œç”¨å¥¹çº¤å·§çš„åŒæ‰‹ä¸ºä½ æŒ‰æ‘©ï¼ŒåŠ›é“é€‚ä¸­ï¼Œè®©ä½ ç–²æƒ«å°½æ¶ˆã€‚", effects: { favor: 16, health: 3 } },
        { desc: "åœ¨é»‘æš—ä¸­ï¼Œå¥¹ä¸ä½ èŠèµ·äº†å¥¹çš„æ¢¦æƒ³â€”â€”å¼€ä¸€å®¶è‡ªå·±çš„å°é“ºå­ï¼Œè¿‡å¹³å‡¡å®‰ç¨³çš„ç”Ÿæ´»ã€‚ä½ ç¬¬ä¸€æ¬¡çœ‹åˆ°äº†å¥¹é£æƒ…ä¹‹å¤–çš„ä¸€é¢ã€‚", effects: { favor: 14, wisdom: 2 } },
        { desc: "å¥¹æœ‰äº›å®³ç¾ï¼Œè¯·æ±‚ä½ å¹ç†„èœ¡çƒ›ã€‚åœ¨é»‘æš—ä¸­ï¼Œæ„Ÿå®˜å˜å¾—æ›´åŠ æ•é”ï¼Œæ¯ä¸€æ¬¡çš„è§¦ç¢°éƒ½è®©ä½ ä»¬æˆ˜æ —ã€‚", effects: { favor: 15, charm: 2 } },
        { desc: "ä¸å¹³æ—¥çš„æ¸©å©‰ä¸åŒï¼Œä»Šå¤œçš„å¥¹çƒ­æƒ…ä¼¼ç«ï¼Œä¸»åŠ¨ç´¢å–ï¼Œè®©ä½ ä½“éªŒåˆ°äº†åˆ«æ ·çš„åˆºæ¿€ä¸å¾æœæ„Ÿã€‚", effects: { favor: 20, health: -4 } },
        { desc: "æ¸…æ™¨é†’æ¥ï¼Œä½ å‘ç°å¥¹æ—©å·²ä¸ºä½ å¤‡å¥½æ—©é¤ï¼Œå¹¶ä¸ºä½ æŸå¥½å‘å† ã€‚æ­¤æƒ…æ­¤æ™¯ï¼Œè®©ä½ ç«Ÿæœ‰äº†ä¸€ä¸å®¶çš„é”™è§‰ã€‚", effects: { favor: 16, virtue: 2 } },
        { desc: "åŠå¤œï¼Œå¥¹ä»å™©æ¢¦ä¸­æƒŠé†’ï¼Œç´§ç´§åœ°æŠ±ä½ä½ ï¼Œç‘Ÿç‘Ÿå‘æŠ–ã€‚ä½ è½»å£°å®‰æŠšï¼Œç›´åˆ°å¥¹å†æ¬¡å®‰ç„¶å…¥ç¡ã€‚", effects: { favor: 18 } },
        { desc: "å¥¹æ‚„æ‚„åœ¨ä½ æ•è¾¹æ”¾äº†ä¸€æœµäº²æ‰‹æŠ˜çš„çº¸èŠ±ï¼Œç¬¬äºŒå¤©æ¸…æ™¨ä½ æ‰å‘ç°ã€‚è¿™ä»½ä¸åŠ¨å£°è‰²çš„å°æµªæ¼«è®©ä½ ä¼šå¿ƒä¸€ç¬‘ã€‚", effects: { favor: 12, talent: 1 } },
        { desc: "ä½ ä»¬ç©èµ·äº†äº‰æŠ¢è¢«å­çš„æ¸¸æˆï¼Œç¬‘é—¹é—´ï¼Œè¢«å­æ»‘è½ï¼Œæ˜¥å…‰ä¹æ³„ï¼Œä¸€åœºæ–°çš„â€œæˆ˜æ–—â€åˆå¼€å§‹äº†...", effects: { favor: 14, health: -3 } }
    ]
};
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘é’æ¥¼äº’åŠ¨äº‹ä»¶åº“ (V2.0 æ‰©å……ç‰ˆ) END =====================
// ===================== ã€æ–°å¢ã€‘é’æ¥¼äº’åŠ¨äº‹ä»¶åº“ END =====================
// --- DATA: Feng Yue Jian (For Male Protagonist) ---
const fengYueJianData = {
    entry_cost: 50,
    courtesans: [
        { id: 'fyj_liu', name: 'æŸ³æ‹‚è¡£', title: 'é›ªéª¨å†°å¿ƒ', specialty: 'ç´è‰ºè¯—è¯', personality: 'æ¸…å†·å­¤é«˜', color: '#add8e6', redemption_cost: 20000, check_attribute: 'talent' },
        { id: 'fyj_su', name: 'è‹åˆ', title: 'ç‰é¢ç²ç‘', specialty: 'äº¤é™…å•†é“', personality: 'å…«é¢ç²ç‘', color: '#98fb98', redemption_cost: 15000, check_attribute: 'charm'},
        { id: 'fyj_yu', name: 'è™ç¾äºº', title: 'äººé—´å°¤ç‰©', specialty: 'èº«ä¸–æˆè°œ', personality: 'å¦©åªšåŠ¨äºº', color: '#ffc0cb', redemption_cost: 30000, check_attribute: 'wealth'},
        // ============= æ–°å¢NPC START =============
        { id: 'fyj_xue', name: 'è–›çµèŠ¸', title: 'æ´›ç¥ä¸´æ°´', specialty: 'ä¸€èˆå€¾åŸ', personality: 'æ¸…å†·', color: '#a0d2eb', redemption_cost: 25000, check_attribute: 'charm' },
        { id: 'fyj_qin', name: 'ç§¦æ¢¦å¿', title: 'é†‰å§çº¢å°˜', specialty: 'é…’ä»¤æ£‹å±€', personality: 'æ´’è„±', color: '#c3aed6', redemption_cost: 22000, check_attribute: 'wisdom' },
        { id: 'fyj_bai', name: 'ç™½ç‰å¥´', title: 'çº¢è¢–æ·»é¦™', specialty: 'ä¹¦ç”»åŒç»', personality: 'èªæ…§', color: '#f9d5a7', redemption_cost: 18000, check_attribute: 'talent' }
        // ============= æ–°å¢NPC END ===============
    ],
    interactions: [
        {id: 'chat', name: "èŠå¤©", cost: 30, favor: [2,4]},
        {id: 'dance', name: "çœ‹èˆ", cost: 100, favor: [4,8]},
        {id: 'music', name: "å¬ç´", cost: 80, favor: [3,7]},
        {id: 'chess', name: "å¯¹å¼ˆ", cost: 50, favor: [3,6]},
    ],
    sleep: { unlock_favor: 85, first_cost: 10000, subsequent_cost_factor: 0.5 },
    redeem: { unlock_favor: 95 }
};

// --- DATA: Career Challenges ---
const careerChallenges = {
    wen: [
        { level: 0, title: "ä¹¦é™¢è¾©ç»", desc: "ä¹¦é™¢ä¸¾è¡Œè¾©ç»å¤§ä¼šï¼Œä½ éœ€è¦å°±'äººæ€§æœ¬å–„æˆ–æœ¬æ¶'ç«‹è®ºã€‚", options: [
            { text: "äººæ€§æœ¬å–„ï¼Œçš†å¯æ•™åŒ–ã€‚", req: { virtue: 30 }, success: { performance: 10, virtue: 2 }, failure: { performance: -5 } },
            { text: "äººæ€§æœ¬æ¶ï¼Œéœ€ç¤¼æ³•çº¦æŸã€‚", req: { wisdom: 30 }, success: { performance: 10, wisdom: 2 }, failure: { performance: -5 } },
            { text: "å–„æ¶äº¤ç»‡ï¼Œåœ¨äºå¼•å¯¼ã€‚", req: { wisdom: 20, virtue: 20 }, success: { performance: 15, wisdom: 1, virtue: 1 }, failure: { performance: -5 } },
        ]},
        { level: 2, title: "èµˆç¾ç­–è®º", desc: "æ·®æ²³æ³›æ»¥ï¼Œç¾æ°‘éé‡ã€‚åœ£ä¸Šå‘½ä½ åæ—¥å†…æ‹Ÿå®šèµˆç¾ç« ç¨‹ã€‚", options: [
             { text: 'ä»¥å·¥ä»£èµˆï¼Œä¿®å ¤ç­‘åã€‚', req: { wisdom: 60 }, success: { performance: 30, reputation: 5 }, failure: { reputation: -5 } },
             { text: 'å¼€ä»“æ”¾ç²®ï¼Œå®‰æŠšæ°‘å¿ƒã€‚', req: { virtue: 50 }, success: { performance: 20, virtue: 5 }, failure: { reputation: -10 } },
             { text: 'è¯·æ±‚æ‹¨æ¬¾ï¼Œè”ç»œå•†è´¾ã€‚', req: { charm: 50 }, success: { performance: 25, wealth: 500 }, failure: { virtue: -5 } }
        ]},
          {
            level: 1,
            title: "ç§‘ä¸¾åº”è¯•",
            desc: "ä¸‰å¹´ä¸€åº¦çš„ç§‘ä¸¾è€ƒè¯•å³å°†å¼€å§‹ï¼Œä½ éœ€è¦åšå¥½å‡†å¤‡å‚åŠ è€ƒè¯•ã€‚",
            options: [
                { 
                    text: "åˆ»è‹¦æ”»è¯»ï¼Œå…¨åŠ›å¤‡è€ƒ", 
                    req: { wisdom: 40 }, 
                    success: { performance: 25, wisdom: 3 }, 
                    failure: { performance: -10, health: -5 } 
                },
                { 
                    text: "æ‹œè®¿è€ƒå®˜ï¼Œæ‰“ç‚¹å…³ç³»", 
                    req: { charm: 35, wealth: 300 }, 
                    success: { performance: 30, reputation: -5 }, 
                    failure: { performance: -15, virtue: -10 } 
                },
                { 
                    text: "ä¸åŒçª—åˆ‡ç£‹äº¤æµ", 
                    req: { talent: 30 }, 
                    success: { performance: 20, talent: 2 }, 
                    failure: { performance: -5 } 
                }
            ]
        },
        {
            level: 3,
            title: "å¤„ç†æ°‘é—´çº çº·",
            desc: "ä¸¤æ‘å› æ°´æºé—®é¢˜å‘ç”Ÿäº‰æ‰§ï¼Œæ‘æ°‘è¯·æ±‚å®˜åºœè£å†³ã€‚",
            options: [
                { 
                    text: "å®åœ°è€ƒå¯Ÿï¼Œå…¬æ­£è£å†³", 
                    req: { wisdom: 60, virtue: 50 }, 
                    success: { performance: 35, reputation: 10 }, 
                    failure: { performance: -15, reputation: -10 } 
                },
                { 
                    text: "å®‰æŠšåŒæ–¹ï¼Œå¯»æ±‚å¦¥å", 
                    req: { charm: 55 }, 
                    success: { performance: 30, virtue: 5 }, 
                    failure: { performance: -10 } 
                },
                { 
                    text: "å¼ºåŠ¿é•‡å‹ï¼Œç»´æŠ¤ç§©åº", 
                    req: { martial: 45 }, 
                    success: { performance: 25 }, 
                    failure: { performance: -20, virtue: -10, reputation: -15 } 
                }
            ]
        },
        // å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šäº‹ä»¶...
    ],
    wu: [
        { level: 1, title: "æ ¡åœºæ¯”æ­¦", desc: "å°†å†›æ£€é˜…æ–°å…µï¼Œä½ è¢«é€‰ä¸­ä¸Šå°æ¯”æ­¦ï¼Œå±•ç¤ºæ­¦è‰ºã€‚", options: [
            { text: "çŒ›è™ä¸‹å±±ï¼Œä¸»åŠ¨æŠ¢æ”»ã€‚", req: { martial: 30 }, success: { performance: 15, martial: 2 }, failure: { health: -5 } },
            { text: "ç¨³æ‰ç¨³æ‰“ï¼Œåå‘åˆ¶äººã€‚", req: { health: 30 }, success: { performance: 10, health: 2 }, failure: { martial: -2 } },
            { text: "è™šæ™ƒä¸€æ‹›ï¼Œæ™ºå–å¯¹æ‰‹ã€‚", req: { wisdom: 20, martial: 20 }, success: { performance: 20, wisdom: 1, martial: 1 }, failure: { performance: -5 } },
        ]},
        { level: 3, title: "å‰¿åŒªå…ˆé”‹", desc: "ä¸€ä¼™å±±åŒªç›˜è¸é»‘é£å²­ï¼ŒåŠ«æ å•†é˜Ÿã€‚ä½ å¥‰å‘½å¸¦é˜Ÿæ¸…å‰¿ã€‚", options: [
            { text: "æ­£é¢å¼ºæ”»ï¼ŒåŠ¿å¦‚ç ´ç«¹ã€‚", req: { health: 70 }, success: { performance: 40, martial: 5 }, failure: { health: -10 } },
            { text: "å¤œé—´å¥‡è¢­ï¼Œæ“’è´¼æ“’ç‹ã€‚", req: { wisdom: 60 }, success: { performance: 30, wisdom: 5 }, failure: { performance: -10 } },
            { text: "åŠé™æ‹›å®‰ï¼Œå…µä¸è¡€åˆƒã€‚", req: { charm: 55 }, success: { performance: 25, charm: 5 }, failure: { reputation: -5 } }
        ]},
    ],
    shang: [
        { level: 2, title: "å•†ä¼šè°ˆåˆ¤", desc: "ä¸'å²­å—ç å¸‚'çš„è°ˆåˆ¤é™·å…¥åƒµå±€ï¼Œå¯¹æ–¹åœ¨çç ä»·æ ¼ä¸Šå¯¸æ­¥ä¸è®©ã€‚", options: [
            { text: "å¨é€¼åˆ©è¯±ï¼Œæš—ç¤ºè½¬å‘å¯¹æ‰‹ã€‚", req: { charm: 60, wisdom: 50 }, success: { performance: 30, charm: 2 }, failure: { reputation: -5 } },
            { text: "æƒ…æ„ŸæŠ•èµ„ï¼Œåªäº¤æœ‹å‹ä¸è°ˆç”Ÿæ„ã€‚", req: { virtue: 55 }, success: { performance: 20, virtue: 2, relation_favor: 20 }, failure: { wealth: -100 } },
            { text: "æŠ€æœ¯åˆ†æï¼ŒæŒ‡å‡ºå…¶æŠ¥ä»·ä¸åˆç†ã€‚", req: { wisdom: 70 }, success: { performance: 35, wisdom: 2 }, failure: { wisdom: -2 } }
        ]}, {
            level: 1,
            title: "å¼€æ‹“æ–°å¸‚åœº",
            desc: "å‘ç°ä¸€ä¸ªæ½œåœ¨çš„å•†ä¸šæœºä¼šï¼Œéœ€è¦å†³å®šå¦‚ä½•å¼€æ‹“æ–°å¸‚åœºã€‚",
            options: [
                { 
                    text: "å¤§èƒ†æŠ•èµ„ï¼Œè¿…é€Ÿå é¢†", 
                    req: { wisdom: 40, wealth: 500 }, 
                    success: { performance: 35, wealth: 200 }, 
                    failure: { performance: -15, wealth: -300 } 
                },
                { 
                    text: "è°¨æ…è¯•æ¢ï¼Œé€æ­¥æ¨è¿›", 
                    req: { wisdom: 50 }, 
                    success: { performance: 25, wisdom: 3 }, 
                    failure: { performance: -10, wealth: -100 } 
                },
                { 
                    text: "å¯»æ‰¾åˆä½œä¼™ä¼´", 
                    req: { charm: 45 }, 
                    success: { performance: 30, charm: 2 }, 
                    failure: { performance: -5 } 
                }
            ]
        }
        // æ›´å¤šå•†è´¾äº‹ä»¶... 
    ]
};


// =======================================================================
// ======================== æ”¶å¾’ç³»ç»Ÿå®ç° ================================
// =======================================================================

// å¾’å¼Ÿæ•°æ®ç»“æ„
const apprenticeData = {
    // å¾’å¼Ÿå±æ€§é…ç½®
    baseAttributes: {
        talent: { min: 10, max: 30 },
        wisdom: { min: 10, max: 30 },
        health: { min: 70, max: 90 },
        virtue: { min: 10, max: 30 },
        charm: { min: 10, max: 30 },
        etiquette: { min: 10, max: 30 },
        martial: { min: 10, max: 30 }
    },
    
    // å¾’å¼Ÿæˆé•¿é…ç½®
    growthRates: {
        talent: 0.8,
        wisdom: 1.0,
        health: 0.3,
        virtue: 0.7,
        charm: 0.9,
        etiquette: 0.6,
        martial: 1.1
    },
    
    // å¾’å¼Ÿç±»å‹
    types: [
        {
            name: "èªæ…§å‹",
            desc: "å¤©èµ„èªé¢–ï¼Œæ‚Ÿæ€§æé«˜ï¼Œæ“…é•¿æ™ºæ…§å‹å·¥ä½œ",
            attributesBonus: { wisdom: 10, talent: 5 },
            growthBonus: { wisdom: 0.2, talent: 0.1 },
            assistBonus: { wisdom: 5 }
        },
        {
            name: "å‹¤å¥‹å‹",
            desc: "åˆ»è‹¦åŠªåŠ›ï¼Œè„šè¸å®åœ°ï¼Œå„é¡¹èƒ½åŠ›å‡è¡¡å‘å±•",
            attributesBonus: { virtue: 10, health: 5 },
            growthBonus: { virtue: 0.2, health: 0.1 },
            assistBonus: { virtue: 5 }
        },
        {
            name: "çµå·§å‹",
            desc: "å¿ƒçµæ‰‹å·§ï¼Œæ‰è‰ºå‡ºä¼—ï¼Œæ“…é•¿åˆ›æ„å‹å·¥ä½œ",
            attributesBonus: { talent: 10, charm: 5 },
            growthBonus: { talent: 0.2, charm: 0.1 },
            assistBonus: { talent: 5 }
        },
        {
            name: "æ­¦å‹‡å‹",
            desc: "ä½“é­„å¼ºå¥ï¼Œå‹‡æ­¦è¿‡äººï¼Œæ“…é•¿ä½“åŠ›å‹å·¥ä½œ",
            attributesBonus: { martial: 10, health: 5 },
            growthBonus: { martial: 0.2, health: 0.1 },
            assistBonus: { martial: 5 }
        }
    ],
    
    // äº’åŠ¨é€‰é¡¹
    interactions: [
        {
            id: "teach",
            name: "ä¼ æˆçŸ¥è¯†",
            desc: "èŠ±è´¹æ—¶é—´æŒ‡å¯¼å¾’å¼Ÿï¼Œæå‡å…¶å±æ€§",
            cost: { action: true },
            effect: { apprentice: { attributes: { wisdom: 7, talent: 4 } }, master: { attributes: { wisdom: 4 } } }
        },
        {
            id: "practice",
            name: "å…±åŒä¿®ç‚¼",
            desc: "ä¸å¾’å¼Ÿä¸€èµ·ä¿®ç‚¼ï¼Œæå‡æ­¦å­¦ä¸å¥åº·",
            cost: { action: true },
            effect: { apprentice: { attributes: { martial: 7, health: 4 } }, master: { attributes: { martial: 4, health: 4 } } }
        },
        {
            id: "socialize",
            name: "ç¤¾äº¤ç¤¼ä»ª",
            desc: "æ•™å¯¼å¾’å¼Ÿç¤¾äº¤ç¤¼ä»ªï¼Œæå‡é­…åŠ›ä¸ç¤¼ä»ª",
            cost: { action: true, wealth: 50 },
            effect: { apprentice: { attributes: { charm: 7, etiquette: 7 } }, master: { attributes: { charm: 4 } } }
        },
        {
            id: "assign_work",
            name: "æŒ‡æ´¾å·¥ä½œ",
            desc: "è®©å¾’å¼ŸååŠ©å®Œæˆå·¥ä½œï¼Œè·å¾—é¢å¤–æ”¶ç›Š",
            cost: { action: true },
            effect: { master: { career_performance: 40, wealth: 400 } }
        },
        // æ–°å¢äº’åŠ¨é€‰é¡¹
        {
            id: "mentor",
            name: "äººç”ŸæŒ‡å¯¼",
            desc: "ç»™äºˆå¾’å¼Ÿäººç”Ÿå»ºè®®ï¼Œæå‡å“å¾·ä¸æ™ºæ…§",
            cost: { action: true },
            effect: { apprentice: { attributes: { virtue: 7, wisdom: 7 } }, master: { attributes: { virtue: 4 } } }
        },
        {
            id: "gift_money",
            name: "èµ äºˆé“¶é’±",
            desc: "ç»™äºˆå¾’å¼Ÿä¸€äº›é“¶é’±ï¼Œå¤§å¹…æå‡å¥½æ„Ÿåº¦",
            cost: { wealth: 400 },
            effect: { apprentice: { favor: 45 } }
        }
    ],
    
    // å‡ºå¸ˆæ¡ä»¶
    graduationConditions: [
        { type: "age", value: 18, desc: "å¹´æ»¡18å²" },
        { type: "attribute", attribute: "wisdom", value: 60, desc: "æ™ºæ…§è¾¾åˆ°60" },
        { type: "attribute", attribute: "talent", value: 60, desc: "æ‰æƒ…è¾¾åˆ°60" }
    ],
    
    // å‡ºå¸ˆå¥–åŠ±
    graduationRewards: {
        wealth: 2000,
        reputation: 50,
        items: ["åå¸ˆåŒ¾é¢", "è°¢å¸ˆç¤¼"]
    }
};

// å¸ˆå¾’è¯•ç‚¼äº‹ä»¶ (æ–°å¢)
const apprenticeTrials = {
    talent: {
        title: "æ‰æƒ…è¯•ç‚¼",
        desc: "çˆ±å¾’çš„æ‰æƒ…ä¼¼é‡ç“¶é¢ˆï¼Œç¥è‰²éƒéƒã€‚ä½ å¬é—»åŸä¸­å³å°†ä¸¾åŠè¯—ä¼šï¼Œæˆ–è®¸è¿™æ­£æ˜¯ä¸ªå±•ç°å®åŠ›çš„å¥½æœºä¼šï¼Ÿ",
        options: [
            {
                text: "äº²è‡ªæŒ‡ç‚¹ (æ¶ˆè€—1è¡ŒåŠ¨ç‚¹)",
                cost: { action: true },
                effect: { apprentice: { attributes: { talent: 8 } }, master: { attributes: { talent: 1 } }, favor: 5 },
                successRate: 1.0
            },
            {
                text: "å®‰æ’å†ç»ƒ (æ¶ˆè€—100ä¸¤)",
                cost: { wealth: 100 },
                effect: { apprentice: { attributes: { talent: 5 } }, reward: { wealth: 50 } },
                successRate: 0.8,
                failureEffect: { apprentice: { attributes: { health: -5 } }, favor: -5 }
            },
            {
                text: "ç½®ä¹‹ä¸ç†",
                cost: {},
                effect: { apprentice: { attributes: { talent: 2 } } },
                successRate: 0.3,
                failureEffect: { apprentice: { growthRate: { talent: -0.2 } }, favor: -5 }
            }
        ]
    },
    martial: {
        title: "æ­¦å­¦è¯•ç‚¼",
        desc: "çˆ±å¾’çš„æ­¦å­¦ä¼¼é‡ç“¶é¢ˆï¼Œç¥è‰²éƒéƒã€‚ä½ å¬é—»åŸéƒŠæœ‰æ¶éœ¸æ»‹æ‰°ç™¾å§“ï¼Œæˆ–è®¸è¿™æ­£æ˜¯ä¸ªå®æˆ˜å†ç»ƒçš„å¥½æœºä¼šï¼Ÿ",
        options: [
            {
                text: "äº²è‡ªæŒ‡ç‚¹ (æ¶ˆè€—1è¡ŒåŠ¨ç‚¹)",
                cost: { action: true },
                effect: { apprentice: { attributes: { martial: 8 } }, master: { attributes: { martial: 1 } }, favor: 5 },
                successRate: 1.0
            },
            {
                text: "å®‰æ’å†ç»ƒ (æ¶ˆè€—100ä¸¤)",
                cost: { wealth: 100 },
                effect: { apprentice: { attributes: { martial: 5 } }, reward: { reputation: 10 } },
                successRate: 0.7,
                failureEffect: { apprentice: { attributes: { health: -10 } }, favor: -10 }
            },
            {
                text: "ç½®ä¹‹ä¸ç†",
                cost: {},
                effect: { apprentice: { attributes: { martial: 2 } } },
                successRate: 0.4,
                failureEffect: { apprentice: { growthRate: { martial: -0.2 } }, favor: -5 }
            }
        ]
    }
};

// å¸ˆå¾’ç¤¾äº¤äº‹ä»¶ (æ–°å¢)
const apprenticeSpecialEvents = [
    {
        title: "å¾’å¼Ÿçš„å›°æƒ‘",
        desc: "ä½ çš„å¾’å¼Ÿåœ¨ä¿®ç‚¼ä¸­é‡åˆ°äº†éš¾é¢˜ï¼Œå‰æ¥å‘ä½ è¯·æ•™ã€‚",
        options: [
            {
                text: "è€å¿ƒè§£ç­” (æ¶ˆè€—1è¡ŒåŠ¨ç‚¹)",
                cost: { action: true },
                effect: { apprentice: { attributes: { wisdom: 5 } }, master: { attributes: { wisdom: 2 } } },
                result_text: "ä½ è€å¿ƒè§£ç­”ï¼Œå¾’å¼Ÿè±ç„¶å¼€æœ—ï¼Œå¹¶å¯¹ä½ æ›´ä¸ºå´‡æ•¬ã€‚"
            },
            {
                text: "è®©TAè‡ªè¡Œé¢†æ‚Ÿ",
                effect: { apprentice: { attributes: { wisdom: 2 } }, favor: -5 },
                result_text: "ä½ é€‰æ‹©è®©å¾’å¼Ÿç‹¬è‡ªé¢å¯¹ï¼ŒTAè™½ç„¶æœ‰æ‰€é¢†æ‚Ÿï¼Œä½†å†…å¿ƒå¯¹ä½ æœ‰äº›ç–è¿œã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„æˆé•¿",
        desc: "ä½ æ³¨æ„åˆ°å¾’å¼Ÿåœ¨æŸæ–¹é¢æœ‰äº†æ˜¾è‘—çš„è¿›æ­¥ã€‚",
        options: [
            {
                text: "ç»™äºˆå¥–åŠ± (æ¶ˆè€—50ä¸¤)",
                cost: { wealth: 50 },
                effect: { apprentice: { favor: 10, attributes: { talent: 3 } } },
                result_text: "ä½ ç»™äº†å¾’å¼Ÿ50ä¸¤ä½œä¸ºå¥–åŠ±ï¼ŒTAå¯¹ä½ çš„å¥½æ„Ÿåº¦å¤§å¢ã€‚"
            },
            {
                text: "æå‡ºæ›´é«˜è¦æ±‚",
                effect: { apprentice: { attributes: { talent: 5, virtue: 2 } }, favor: -3 },
                result_text: "ä½ å¯¹å¾’å¼Ÿæå‡ºäº†æ›´é«˜çš„è¦æ±‚ï¼Œè™½ç„¶TAçš„æ½œåŠ›è¢«æ¿€å‘ï¼Œä½†æœ‰äº›ä¸å¼€å¿ƒã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„æ¯”è¯•",
        desc: "ä½ çš„å¾’å¼Ÿä¸å…¶ä»–é—¨ä¸‹çš„å¼Ÿå­çº¦å®šäº†ä¸€åœºæ¯”è¯•ï¼Œå‰æ¥è¯·æ±‚ä½ çš„æŒ‡å¯¼ã€‚",
        options: [
            {
                text: "è¿›è¡Œç‰¹è®­ (æ¶ˆè€—1è¡ŒåŠ¨ç‚¹)",
                cost: { action: true },
                effect: { apprentice: { attributes: { martial: 10, health: 5 } }, favor: 10 },
                result_text: "ä½ å¯¹å¾’å¼Ÿè¿›è¡Œäº†ç‰¹è®­ï¼ŒTAåœ¨æ¯”è¯•ä¸­å¤§è·å…¨èƒœï¼Œåå£°å¤§å™ªï¼"
            },
            {
                text: "èµ é€é‡‘ç–®è¯ (æ¶ˆè€—100ä¸¤)",
                cost: { wealth: 100 },
                effect: { apprentice: { attributes: { health: 10 } }, favor: 5 },
                result_text: "ä½ ç»™äº†å¾’å¼Ÿ100ä¸¤é“¶é’±ï¼Œå¹¶å®å˜±TAå°å¿ƒï¼ŒTAæ„Ÿåˆ°ååˆ†æš–å¿ƒã€‚"
            },
            {
                text: "æ”¾ä»»å…¶è‡ªç”±å‘æŒ¥",
                effect: { apprentice: { attributes: { wisdom: 5 } }, favor: -5 },
                result_text: "ä½ è®©å¾’å¼Ÿè‡ªè¡Œå¤„ç†ï¼Œè™½ç„¶TAæœ€ç»ˆèµ¢äº†ï¼Œä½†è§‰å¾—è‡ªå·±æ²¡æœ‰å¾—åˆ°ä½ çš„é‡è§†ã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„ç“¶é¢ˆ",
        desc: "ä½ çš„å¾’å¼Ÿåœ¨å­¦ä¸šä¸Šé‡åˆ°äº†ç“¶é¢ˆï¼Œå‘ä½ è¯‰è¯´è‡ªå·±çš„è‹¦æ¼ã€‚",
        options: [
            {
                text: "å¸¦å…¶å‡ºæ¸¸æ•£å¿ƒ (æ¶ˆè€—200ä¸¤)",
                cost: { wealth: 200 },
                effect: { apprentice: { attributes: { wisdom: 5, charm: 5 } }, favor: 15 },
                result_text: "ä½ å¸¦å¾’å¼Ÿå‡ºæ¸¸ï¼Œä¸ä»…è§£å†³äº†TAçš„ç“¶é¢ˆï¼Œè¿˜è®©TAèº«å¿ƒæ„‰æ‚¦ã€‚"
            },
            {
                text: "é¼“åŠ±å…¶è‡ªè¡Œå…‹æœ",
                effect: { apprentice: { attributes: { virtue: 8 } }, favor: -5 },
                result_text: "ä½ é¼“åŠ±å¾’å¼Ÿï¼Œè™½ç„¶æ²¡æœ‰ç›´æ¥å¸®åŠ©ï¼Œä½†ç£¨ç‚¼äº†TAçš„æ„å¿—ã€‚"
            },
            {
                text: "ä¸äºˆç†ä¼š",
                effect: { apprentice: { attributes: { virtue: -5 } }, favor: -10 },
                result_text: "ä½ å¯¹å¾’å¼Ÿçš„è‹¦æ¼ä¸äºˆç†ä¼šï¼ŒTAæ„Ÿåˆ°è¢«å†·è½ï¼Œå“å¾·å’Œå¥½æ„Ÿåº¦å‡æœ‰ä¸‹é™ã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„æ±‚åŠ©",
        desc: "ä½ çš„å¾’å¼Ÿå®¶ä¸­çªé­å˜æ•…ï¼Œæ€¥éœ€ä¸€ç¬”é’±æ¥æ¸¡è¿‡éš¾å…³ã€‚",
        options: [
            {
                text: "æ…·æ…¨è§£å›Š (æ¶ˆè€—500ä¸¤)",
                cost: { wealth: 500 },
                effect: { apprentice: { favor: 30, virtue: 10 }, master: { attributes: { virtue: 5 } } },
                result_text: "ä½ æ…·æ…¨è§£å›Šï¼Œå¸®åŠ©å¾’å¼Ÿæ¸¡è¿‡éš¾å…³ã€‚å¾’å¼Ÿå¯¹ä½ å¿ å¿ƒè€¿è€¿ï¼Œä½ çš„å“å¾·ä¹Ÿå¾—åˆ°æå‡ã€‚"
            },
            {
                text: "å€Ÿå‡ºé“¶é’± (æ¶ˆè€—500ä¸¤)",
                cost: { wealth: 500 },
                effect: { apprentice: { favor: 15 } },
                result_text: "ä½ å€Ÿç»™å¾’å¼Ÿ500ä¸¤ï¼Œä½†å¾’å¼Ÿå¿ƒä¸­æœ‰å‹åŠ›ï¼Œå¥½æ„Ÿåº¦æå‡ä¸å¤§ã€‚"
            },
            {
                text: "è¡¨ç¤ºæ— èƒ½ä¸ºåŠ›",
                effect: { apprentice: { favor: -20 } },
                result_text: "ä½ è¡¨ç¤ºæ— èƒ½ä¸ºåŠ›ï¼Œå¾’å¼Ÿæ„Ÿåˆ°å¤±æœ›ï¼Œå¥½æ„Ÿåº¦å¤§å¹…ä¸‹é™ã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„ä»°æ…•è€…",
        desc: "ä½ çš„å¾’å¼Ÿå› æ‰è²Œå‡ºä¼—ï¼Œå¼•æ¥äº†åŸä¸­æŸä½å…¬å­çš„è¿½æ±‚ï¼ŒTAå¯¹æ­¤æ„Ÿåˆ°å›°æ‰°ã€‚",
        options: [
            {
                text: "å‡ºé¢è§£å†³éº»çƒ¦ (æ¶ˆè€—1è¡ŒåŠ¨ç‚¹)",
                cost: { action: true },
                effect: { apprentice: { favor: 15, attributes: { charm: 3 } } },
                result_text: "ä½ å‡ºé¢è§£å†³äº†è¿™ä¸ªéº»çƒ¦ï¼Œå¾’å¼Ÿå¯¹ä½ å……æ»¡æ„Ÿæ¿€ï¼Œé­…åŠ›ä¹Ÿå¾—åˆ°æå‡ã€‚"
            },
            {
                text: "è®©TAè‡ªè¡Œå¤„ç†",
                effect: { apprentice: { attributes: { wisdom: 5 } } },
                result_text: "ä½ è®©å¾’å¼Ÿè‡ªè¡Œåº”å¯¹ï¼ŒTAæœ€ç»ˆå·§å¦™åŒ–è§£äº†å›°æ‰°ï¼Œæ™ºæ…§æœ‰æ‰€æˆé•¿ã€‚"
            },
            {
                text: "æ’®åˆè¿™é—¨äº²äº‹ (æ¶ˆè€—200ä¸¤)",
                cost: { wealth: 200 },
                effect: { apprentice: { favor: -10 } },
                result_text: "ä½ æ“…è‡ªåšä¸»æ’®åˆäº†è¿™é—¨äº²äº‹ï¼Œå¾’å¼Ÿæ„Ÿåˆ°è¢«æ§åˆ¶ï¼Œå¥½æ„Ÿåº¦ä¸‹é™ã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„ç§˜å¯†",
        desc: "ä½ æ— æ„ä¸­å‘ç°äº†å¾’å¼Ÿçš„ä¸€ä¸ªç§˜å¯†ï¼ŒTAä¼¼ä¹èº«æ€€å¼‚å®ï¼Œä½†åˆå®³æ€•è¢«äººå‘ç°ã€‚",
        options: [
            {
                text: "æ›¿TAä¿å®ˆç§˜å¯†",
                effect: { apprentice: { favor: 20, attributes: { virtue: 10 } } },
                result_text: "ä½ é€‰æ‹©ä¸ºå¾’å¼Ÿä¿å®ˆç§˜å¯†ï¼ŒTAå¯¹ä½ æ— æ¯”ä¿¡èµ–ï¼Œä½ çš„å“å¾·ä¹Ÿå¾—åˆ°æå‡ã€‚"
            },
            {
                text: "åŠTAä¸Šäº¤å¼‚å®",
                effect: { apprentice: { favor: -15 } },
                result_text: "ä½ åŠå¾’å¼Ÿä¸Šäº¤å¼‚å®ï¼ŒTAè™½ç„¶å¬ä»äº†ï¼Œä½†å¯¹ä½ äº§ç”Ÿäº†éš”é˜‚ã€‚"
            },
            {
                text: "å¤ºå–å¼‚å®",
                effect: { apprentice: { favor: -50, virtue: -20 } },
                result_text: "ä½ å¤ºå–äº†å¼‚å®ï¼Œä½†æ°¸è¿œå¤±å»äº†å¾’å¼Ÿçš„ä¿¡ä»»ï¼Œä½ çš„å“å¾·ä¹Ÿå—åˆ°ä¸¥é‡æŸå®³ã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„å–„è¡Œ",
        desc: "ä½ å‘ç°å¾’å¼Ÿåœ¨åŸå¤–ä¸ºæµæµªå„¿æ–½ç²¥ï¼Œä½†æ­¤ä¸¾ä¼šæ¶ˆè€—TAçš„ä¸å°‘ç²¾åŠ›ã€‚",
        options: [
            {
                text: "æ”¯æŒå¹¶æä¾›èµ„é‡‘ (æ¶ˆè€—300ä¸¤)",
                cost: { wealth: 300 },
                effect: { apprentice: { favor: 10, attributes: { virtue: 15 } }, master: { attributes: { reputation: 5 } } },
                result_text: "ä½ æ”¯æŒå¾’å¼Ÿçš„å–„è¡Œï¼Œæä¾›äº†300ä¸¤é“¶é’±ã€‚ä½ ä»¬çš„å–„ä¸¾å¾—åˆ°ä¸–äººç§°èµï¼Œå£°æœ›æœ‰æ‰€æå‡ã€‚"
            },
            {
                text: "é¼“åŠ±ä½†ä¸æ”¯æŒ",
                effect: { apprentice: { favor: 5, attributes: { virtue: 5 } } },
                result_text: "ä½ å£å¤´é¼“åŠ±äº†å¾’å¼Ÿï¼ŒTAçš„å“å¾·å¾—åˆ°å°å¹…æå‡ï¼Œä½†ä½ æ²¡æœ‰æä¾›å®é™…å¸®åŠ©ã€‚"
            },
            {
                text: "é˜»æ­¢å…¶æµªè´¹ç²¾åŠ›",
                effect: { apprentice: { favor: -5, attributes: { virtue: -5 } } },
                result_text: "ä½ é˜»æ­¢äº†å¾’å¼Ÿçš„å–„è¡Œï¼ŒTAæ„Ÿåˆ°éå¸¸ä¸è§£ï¼Œå“å¾·å’Œå¥½æ„Ÿåº¦å‡æœ‰ä¸‹é™ã€‚"
            }
        ]
    },
    {
        title: "å¾’å¼Ÿçš„æ‰å",
        desc: "ä½ çš„å¾’å¼Ÿåˆ›ä½œå‡ºäº†ä¸€éƒ¨éå¸¸ä¼˜ç§€çš„ä½œå“ï¼Œä½†å› ä¸ºç¼ºä¹åæ°”ï¼Œæ— äººé—®æ´¥ã€‚",
        options: [
            {
                text: "ä»¥ä½ çš„åä¹‰ä¸¾è",
                effect: { apprentice: { favor: 20, attributes: { talent: 10 } }, master: { attributes: { reputation: 10 } } },
                result_text: "ä½ ä»¥ä½ çš„åä¹‰ä¸¾èäº†å¾’å¼Ÿçš„ä½œå“ï¼Œä½œå“å¤§å–ï¼Œä½ ä»¬å¸ˆå¾’äºŒäººçš„åå£°éƒ½å¾—åˆ°äº†æå‡ã€‚"
            },
            {
                text: "èŠ±é’±ä¸ºTAå®£ä¼  (æ¶ˆè€—150ä¸¤)",
                cost: { wealth: 150 },
                effect: { apprentice: { favor: 10, attributes: { talent: 5 } } },
                result_text: "ä½ èŠ±è´¹150ä¸¤ä¸ºå¾’å¼Ÿçš„ä½œå“è¿›è¡Œå®£ä¼ ï¼Œä½œå“å¾—åˆ°å…³æ³¨ï¼Œå¾’å¼Ÿçš„æ‰æƒ…å’Œå¥½æ„Ÿåº¦éƒ½æœ‰æå‡ã€‚"
            },
            {
                text: "è®©TAè‡ªå·±åŠªåŠ›",
                effect: { apprentice: { attributes: { talent: 2 } }, favor: -5 },
                result_text: "ä½ è®©å¾’å¼Ÿè‡ªå·±å»åŠªåŠ›ï¼ŒTAè™½ç„¶æœ‰æ‰€æˆé•¿ï¼Œä½†è§‰å¾—ä½ ä¸å¤Ÿé‡è§†TAã€‚"
            }
        ]
    }
];

// ================== [æ–°å¢] çº¢ç¬ºå¯„æƒ… & æƒ…äººç³»ç»Ÿæ ¸å¿ƒæ•°æ® (V2-èŒä¸šè”åŠ¨ç‰ˆ) ===================
// =======================================================================================
const POETRY_DATA = {
    å©‰çº¦: [
        "æœˆä¸‹åˆè§å›", "æ„¿ä¸ºç”»ä¸­äºº", "æ­¤æƒ…å¯å¾…æˆè¿½å¿†", "äººé¢æ¡ƒèŠ±ç›¸æ˜ çº¢", "åªæ„¿å›å¿ƒä¼¼æˆ‘å¿ƒ", "ç²ç‘éª°å­å®‰çº¢è±†",
        // â–¼â–¼â–¼ ã€æ–°å¢è¯—å¥ã€‘ â–¼â–¼â–¼
        "æ™“é£æ®‹æœˆå¤œ", "æ¨æŸ³å²¸è¾¹äºº", "ä¸€å¸˜å¹½æ¢¦æ·±", "ä¸ºä¼Šæ¶ˆå¾—äººæ†”æ‚´", "è¡£å¸¦æ¸å®½ç»ˆä¸æ‚”", "è“¦ç„¶å›é¦–æ—¶",
        "é‚£äººå´åœ¨ç¯ç«é˜‘çŠå¤„", "é›¾å¤±æ¥¼å°ï¼Œæœˆè¿·æ´¥æ¸¡", "è‡ªåœ¨é£èŠ±è½»ä¼¼æ¢¦", "æ— è¾¹ä¸é›¨ç»†å¦‚æ„", "çœ‰é—´å¿ƒä¸Š",
        "æ¬²è¯´è¿˜ä¼‘", "å´é“å¤©å‡‰å¥½ä¸ªç§‹", "ä¸€ç§ç›¸æ€ï¼Œä¸¤å¤„é—²æ„", "æ­¤æƒ…æ— è®¡å¯æ¶ˆé™¤", "æ‰ä¸‹çœ‰å¤´ï¼Œå´ä¸Šå¿ƒå¤´",
        "çº¢äº†æ¨±æ¡ƒï¼Œç»¿äº†èŠ­è•‰", "èŠ±è‡ªé£˜é›¶æ°´è‡ªæµ", "äº‘ä¸­è°å¯„é”¦ä¹¦æ¥", "é›å­—å›æ—¶ï¼Œæœˆæ»¡è¥¿æ¥¼", "å¯‚å¯æ¢§æ¡é”æ¸…ç§‹",
        "å¸˜å·è¥¿é£ï¼Œäººæ¯”é»„èŠ±ç˜¦", "ä½å¤´å¼„èŠ±å½±", "å¿ƒäº‹ä»˜ç‘¶ç´", "é™å¾…å›å½’æ¥", "ç›¸æ€æ»¡æå¤´", "æœˆä¸ŠæŸ³æ¢¢å¤´",
        "äººçº¦é»„æ˜å", "æ³ªæ¹¿æ˜¥è¡«è¢–", "æ˜¥å¿ƒè«å…±èŠ±äº‰å‘", "ä¸€å¯¸ç›¸æ€ä¸€å¯¸ç°", "å½“æ—¶æ˜æœˆåœ¨", "æ›¾ç…§å½©äº‘å½’",
        "èŠ™è“‰ä¸åŠç¾äººå¦†", "äº‘æƒ³è¡£è£³èŠ±æƒ³å®¹", "æ˜¥é£æ‹‚æ§›éœ²åæµ“", "ä¸€æçº¢è‰³éœ²å‡é¦™", "å·§ç¬‘å€©å…®ï¼Œç¾ç›®ç›¼å…®",
        "æ‰‹å¦‚æŸ”è‘ï¼Œè‚¤å¦‚å‡è„‚", "æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹", "è¾—è½¬åä¾§å¤œæœªå¤®", "é’é’å­è¡¿ï¼Œæ‚ æ‚ æˆ‘å¿ƒ", "ä½•ä»¥è§£å¿§ï¼Œå”¯æœ‰æœåº·",
        "å±±æœ‰æœ¨å…®æœ¨æœ‰æ", "å¿ƒæ‚¦å›å…®å›ä¸çŸ¥", "æ»´æ»´æ¢§æ¡é›¨", "é—²æ•²æ£‹å­è½ç¯èŠ±", "é£ä¹èµ·ï¼Œå¹çš±ä¸€æ± æ˜¥æ°´"
    ],
    è±ªæ”¾: [
        "ä¸€è§å€¾å¿ƒï¼Œå†è§å€¾åŸ", "æ„¿ä¸ºå›æŠ«ç”²", "ä¸å›å…±é¥®æ±Ÿæ¹–é…’", "æˆ‘å¯„æ„å¿ƒä¸æ˜æœˆ", "å¤§é£èµ·å…®äº‘é£æ‰¬", "é†‰å§æ²™åœºå›è«ç¬‘",
        // â–¼â–¼â–¼ ã€æ–°å¢è¯—å¥ã€‘ â–¼â–¼â–¼
        "ä¸å›å…±ç­–é©¬", "åŒé—¯æ±Ÿæ¹–è·¯", "é†‰çœ‹æ±Ÿå±±ç”»", "å‰‘æŒ‡å¤©æ¶¯è¿œ", "æŠŠé…’è®ºè‹±é›„", "å¿«æ„æ©ä»‡å½•",
        "è¸éé’å±±äººæœªè€", "é£æ™¯è¿™è¾¹ç‹¬å¥½", "ä¸ºä½ å€¾å€’", "å¿ƒéšå›è¿œè¡Œ", "è±ªæƒ…å¹²äº‘éœ„", "çƒˆç«æ˜ çº¢é¢œ",
        "æ•¢ä¸ºå¤©ä¸‹å…ˆ", "ä¸æ‰å°‘å¹´æ¸¸", "æˆ‘è¾ˆå²‚æ˜¯è“¬è’¿äºº", "ä»°å¤©å¤§ç¬‘å‡ºé—¨å»", "äººç”Ÿå¾—æ„é¡»å°½æ¬¢", "è«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆ",
        "å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨", "åƒé‡‘æ•£å°½è¿˜å¤æ¥", "ä¼šæŒ½é›•å¼“å¦‚æ»¡æœˆ", "è¥¿åŒ—æœ›ï¼Œå°„å¤©ç‹¼", "æƒ³å½“å¹´ï¼Œé‡‘æˆˆé“é©¬",
        "æ°”åä¸‡é‡Œå¦‚è™", "å¤§æ¼ å­¤çƒŸç›´", "é•¿æ²³è½æ—¥åœ†", "åƒé‡Œå…±å©µå¨Ÿ", "ä¼šå½“å‡Œç»é¡¶", "ä¸€è§ˆä¼—å±±å°",
        "ä¸œä¸´ç¢£çŸ³ï¼Œä»¥è§‚æ²§æµ·", "æ—¥æœˆä¹‹è¡Œï¼Œè‹¥å‡ºå…¶ä¸­", "æ˜Ÿæ±‰ç¿çƒ‚ï¼Œè‹¥å‡ºå…¶é‡Œ", "åæ­¥æ€ä¸€äººï¼Œåƒé‡Œä¸ç•™è¡Œ",

        "äº‹äº†æ‹‚è¡£å»ï¼Œæ·±è—èº«ä¸å", "ä¸‰æ¯åç„¶è¯ºï¼Œäº”å²³å€’ä¸ºè½»", "çºµæ­»ä¾ éª¨é¦™ï¼Œä¸æƒ­ä¸–ä¸Šè‹±", "æ„¿å°†è…°ä¸‹å‰‘",
        "ç›´ä¸ºæ–©æ¥¼å…°", "é»„æ²™ç™¾æˆ˜ç©¿é‡‘ç”²", "ä¸ç ´æ¥¼å…°ç»ˆä¸è¿˜", "ä¸€èº«è½¬æˆ˜ä¸‰åƒé‡Œ", "ä¸€å‰‘æ›¾å½“ç™¾ä¸‡å¸ˆ",
        "ä½†ä½¿é¾™åŸé£å°†åœ¨", "ä¸æ•™èƒ¡é©¬åº¦é˜´å±±", "ç”·å„¿ä½•ä¸å¸¦å´é’©", "æ”¶å–å…³å±±äº”åå·", "æ„¿å¾—æ­¤ç”Ÿé•¿æŠ¥å›½"
    ],
    æ‰¿è¯º: [
        "æ‰§å­ä¹‹æ‰‹ï¼Œä¸å­å•è€", "å…±èµ´ç™½é¦–çº¦", "æ­¤ç”Ÿä¸è´Ÿç›¸æ€æ„", "å±±æ— æ£±ï¼Œå¤©åœ°åˆ", "ç»“å‘ä¸ºå¤«å¦»", "æ©çˆ±ä¸¤ä¸ç–‘",
        // â–¼â–¼â–¼ ã€æ–°å¢è¯—å¥ã€‘ â–¼â–¼â–¼
        "ä¸‰ç”ŸçŸ³ä¸Šå", "ç¼˜å®šä»Šç”Ÿ", "æ°¸ç»“åŒå¿ƒå¥½", "æ­¤ç”Ÿä¸ç›¸è´Ÿ", "æƒŸæ„¿é•¿ç›¸å®ˆ", "æ—¥æœˆä»¥ä¸ºç›Ÿ",
        "æ­»ç”Ÿå¥‘é˜”ï¼Œä¸å­æˆè¯´", "æµ·æ¯çŸ³çƒ‚", "å¤©è’åœ°è€", "é£é›¨äº¦åŒèˆŸ", "ç›¸ä¼´åˆ°å¤©æ¶¯", "ä¸å›å…±æœæš®",
        "äººé—´å…±ç™½å¤´", "æ„¿å¾—ä¸€äººå¿ƒ", "ç™½é¦–ä¸ç›¸ç¦»", "ä»æ­¤ä¸åˆ†ç¦»", "è®¸ä½ ä¸€ä¸–å®‰", "ä¸ºä½ ç»¾é•¿å‘",
        "æçœ‰åˆ°ç™½å¤´", "æ„¿ä¸ºæ¯”ç¿¼é¸Ÿ", "åŒ–ä½œè¿ç†æ", "åœ¨å¤©æ„¿ä½œæ¯”ç¿¼é¸Ÿ", "åœ¨åœ°æ„¿ä¸ºè¿ç†æ", "å¤©é•¿åœ°ä¹…æœ‰æ—¶å°½",
        "æ­¤æ¨ç»µç»µæ— ç»æœŸ", "æ›¾ç»æ²§æµ·éš¾ä¸ºæ°´", "é™¤å´å·«å±±ä¸æ˜¯äº‘", "å–æ¬¡èŠ±ä¸›æ‡’å›é¡¾", "åŠç¼˜ä¿®é“åŠç¼˜å›",
        "ä¸¤æƒ…è‹¥æ˜¯ä¹…é•¿æ—¶", "åˆå²‚åœ¨æœæœæš®æš®", "é‡‘é£ç‰éœ²ä¸€ç›¸é€¢", "ä¾¿èƒœå´äººé—´æ— æ•°", "èº«æ— å½©å‡¤åŒé£ç¿¼",
        "å¿ƒæœ‰çµçŠ€ä¸€ç‚¹é€š", "è¿˜å›æ˜ç åŒæ³ªå‚", "æ¨ä¸ç›¸é€¢æœªå«æ—¶", "æˆ‘å¿ƒåŒªçŸ³ï¼Œä¸å¯è½¬ä¹Ÿ", "æˆ‘å¿ƒåŒªå¸­ï¼Œä¸å¯å·ä¹Ÿ",
        "æŠ•æˆ‘ä»¥æœ¨æ¡ƒï¼ŒæŠ¥ä¹‹ä»¥ç¼ç‘¶", "åŒªæŠ¥ä¹Ÿï¼Œæ°¸ä»¥ä¸ºå¥½ä¹Ÿ", "è°·åˆ™å¼‚å®¤ï¼Œæ­»åˆ™åŒç©´", "ä¿¡èª“æ—¦æ—¦ï¼Œä¸æ€å…¶å"
    ]
};
// ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä¸ºæ¯ä¸ªèŒä¸šå®šä¹‰ä¸“å±çš„ä¿¡ç‰©åˆ¶ä½œææ–™
const CAREER_CRAFTING_ITEMS = {
    'civilian': { id: 'oath_bamboo_slip', name: 'ç›Ÿèª“ç«¹ç®€', icon: 'fa-scroll', type: 'ææ–™', desc: 'æ–‡å®˜å¤„ç†å…¬åŠ¡æ—¶ç”¨ä»¥è®°å½•ç›Ÿèª“çš„ç«¹ç®€ï¼Œè´¨åœ°åšéŸ§ï¼Œè±¡å¾ç€ä¸å˜çš„æ‰¿è¯ºã€‚' },
    'warrior': { id: 'battle_worn_tassel', name: 'å†æˆ˜å‰‘ç©—', icon: 'fa-khanda', type: 'ææ–™', desc: 'ä»ç™¾æˆ˜ä¸æŒ çš„ä½©å‰‘ä¸Šå–ä¸‹çš„å‰‘ç©—ï¼Œæµ¸æŸ“ç€æ²™åœºè±ªæƒ…ä¸å®ˆæŠ¤ä¹‹æ„ã€‚' },
    'merchant': { id: 'abacus_bead_bracelet', name: 'ç²ç‘ç®—ç›˜ç ', icon: 'fa-calculator', type: 'ææ–™', desc: 'å•†è´¾ä»¬ç”¨æœ€åè´µçš„æœ¨æ–™æ‰“ç£¨çš„ç®—ç›˜ç ï¼Œè±¡å¾ç€ç²¾æ‰“ç»†ç®—çš„çˆ±æ„ã€‚' },
    'scholar': { id: 'ink_heart_stone', name: 'å¢¨å¿ƒçŸ³', icon: 'fa-paint-brush', type: 'ææ–™', desc: 'æ–‡äººå¢¨å®¢è§†è‹¥çå®çš„çŸ³ç šï¼Œç£¨å‡ºçš„å¢¨å¸¦æœ‰å¥‡é¦™ï¼Œç”¨ä»¥ä¹¦å†™æƒ…è¯—æœ€ä½³ã€‚' },
    'ranger': { id: 'heroic_wine_gourd', name: 'ä¾ ä¹‰é…’è‘«', icon: 'fa-wine-bottle', type: 'ææ–™', desc: 'æ±Ÿæ¹–æ¸¸ä¾ éšèº«æºå¸¦çš„é…’è‘«èŠ¦ï¼Œè£…è¿‡æœ€çƒˆçš„é…’ï¼Œä¹Ÿè£…ç€æœ€çœŸçš„æƒ…ã€‚' },
    'matron': { id: 'seven_ingenuity_thread', name: 'ä¸ƒå·§ä¸çº¿', icon: 'fa-ribbon', type: 'ææ–™', desc: 'ä¸»æ¯åœ¨ä¹å·§èŠ‚æ—¶æ±‚å¾—çš„ä¸ƒå½©ä¸çº¿ï¼Œæ®è¯´èƒ½ç¼–ç»‡å‡ºä¸–ä¸Šæœ€ç‰¢å›ºçš„åŒå¿ƒç»“ã€‚' },
    'embroiderer': { id: 'phoenix_tail_pin', name: 'å‡¤å°¾é‡‘é’ˆ', icon: 'fa-cut', type: 'ææ–™', desc: 'ç»£å¨˜æ¢¦å¯ä»¥æ±‚çš„å¾¡èµé‡‘é’ˆï¼Œèƒ½ç»£å‡ºæ ©æ ©å¦‚ç”Ÿçš„å‡¤å‡°ï¼Œè±¡å¾ç€è‡³é«˜æ— ä¸Šçš„çˆ±ã€‚' },
    'doctor': { id: 'longevity_herb', name: 'é•¿ç”Ÿè‰', icon: 'fa-leaf', type: 'ææ–™', desc: 'å¥³åŒ»è¸éåƒå±±å¯»å¾—çš„çç¨€è‰è¯ï¼Œè™½ä¸èƒ½é•¿ç”Ÿï¼Œå´ä»£è¡¨ç€æ„¿å¯¹æ–¹ä¸€ä¸–å®‰åº·çš„å¿ƒæ„ã€‚' },
    'spy_master': { id: 'invisible_ink', name: 'æ— è¿¹å¢¨', icon: 'fa-feather-alt', type: 'ææ–™', desc: 'æƒ…æŠ¥é¦–é¢†ç”¨ç‹¬é—¨ç§˜æ³•è°ƒåˆ¶çš„å¢¨æ°´ï¼Œå†™ä¸‹çš„æƒ…ä¹¦å”¯æœ‰çœŸçˆ±ä¹‹äººå¯è§ã€‚' }
};

// ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†ä¿¡ç‰©åˆ¶ä½œçš„è¦æ±‚ä»â€œé‡‘é’±â€æ”¹ä¸ºâ€œèŒä¸šä¸“å±ææ–™â€

const TOKEN_DATA = {
    'tongxinjie': { name: 'åŒå¿ƒç»“é¦™å›Š', req: { item: 'seven_ingenuity_thread' }, quality_attr: 'talent', target: ['æ¸©æŸ”', 'ç«¯åº„'], stats: { romance: 15, sincerity: 20 } },
    'yupä½©': { name: 'åŒé±¼ç‰ä½©', req: { item: 'abacus_bead_bracelet' }, quality_attr: 'random', target: ['æƒè´µ', 'å¯Œå•†'], stats: { sincerity: 25 } },
    'muzhan': { name: 'äº²åˆ»æœ¨ç°ª', req: { item: 'ink_heart_stone' }, quality_attr: 'talent', target: ['æ¸…å†·', 'æ‰å¥³'], stats: { romance: 20, sincerity: 15 } },
    'jiansui': { name: 'å®å‰‘å‰‘ç©—', req: { item: 'battle_worn_tassel' }, quality_attr: 'random', target: ['æ­¦å°†', 'ä¾ å®¢'], stats: { sincerity: 20 } },
    'shiji': { name: 'æ‰‹æŠ„è¯—é›†', req: { item: 'oath_bamboo_slip' }, quality_attr: 'talent', target: ['æ–‡äºº', 'ä¹¦ç”Ÿ'], stats: { romance: 25 } },
    // ä½ å¯ä»¥ç»§ç»­ä¸º ranger, doctor, spy_master ç­‰èŒä¸šæ·»åŠ ä¸“å±ä¿¡ç‰©
    'wine_gourd_pendant': { name: 'é…’è‘«èŠ¦æŒ‚å ', req: { item: 'heroic_wine_gourd' }, quality_attr: 'random', target: ['ä¾ å®¢', 'æ´’è„±'], stats: { sincerity: 22 } },
    'herbal_sachet': { name: 'å®‰ç¥è¯åŒ…', req: { item: 'longevity_herb' }, quality_attr: 'wisdom', target: ['ä½“å¼±', 'å†…æ•›'], stats: { romance: 10, sincerity: 28 } },
    'secret_letter': { name: 'å¯†æ–‡æƒ…ä¿¡', req: { item: 'invisible_ink' }, quality_attr: 'wisdom', target: ['èªæ…§', 'å¤šç–‘'], stats: { romance: 30 } }
};

let confessionState = {}; // ç”¨äºå­˜å‚¨è¡¨ç™½è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®

/**
 * æ ¸å¿ƒåŠŸèƒ½1ï¼šå¼€å§‹è¡¨ç™½æµç¨‹çš„æ€»å…¥å£
 * å½“ç©å®¶ç‚¹å‡»â€œçº¢ç¬ºå¯„æƒ…â€æ—¶ï¼Œæ­¤å‡½æ•°è¢«è°ƒç”¨ã€‚
 */
function startConfessionProcess(npcId) {
    // ã€æ–°å¢ã€‘æ£€æŸ¥æœ¬å›åˆæ˜¯å¦å·²ç»è¡¨ç™½è¿‡
    if (gameState.flags.confessionAttemptedThisTurn) {
        showToast("ä½ ä»Šæ—¥å·²è¡¨ç™½è¿‡å¿ƒæ„ï¼Œè¯·å¾…ä¸‹å›åˆ†æ™“ã€‚");
        return;
    }

    // æ¯æ¬¡å¼€å§‹éƒ½é‡ç½®çŠ¶æ€ï¼Œé˜²æ­¢æ•°æ®æ®‹ç•™
    confessionState = { targetNpcId: npcId, poem: null, token: null };
    
    // æ˜¾ç¤ºä¸€ä¸ªå†³ç­–å¼¹çª—ï¼Œè®©ç©å®¶é€‰æ‹©å…ˆå‡†å¤‡å“ªä¸€é¡¹
    showDecisionCard(
        'çº¢ç¬ºå¯„æƒ…', 
        'fa-pen-fancy', 
        'ä½ å†³å®šå‘å¯¹æ–¹è¡¨æ˜å¿ƒæ„ï¼Œæ­¤äº‹éœ€ç²¾å¿ƒå‡†å¤‡ï¼Œæ–¹æ˜¾è¯šæ„ã€‚', 
        [
            { htmlContent: 'âœï¸ ä¹¦å†™æƒ…è¯—', callback: () => showPoetryEditor(npcId) },
            { htmlContent: 'ğŸ å‡†å¤‡ä¿¡ç‰©', callback: () => showTokenCrafting(npcId) }
        ]
    );
}
function showPoetryEditor(npcId) {
    const playerTalent = gameState.player.attributes.talent || 0;
    let fragmentsHTML = '';
    
    // [ä¿®æ”¹] ä¸ºæ¯ä¸ªè¯—å¥ç¢ç‰‡å¢åŠ  onclick äº‹ä»¶
    const addFragmentToLine = (text) => {
        const firstEmptySlot = document.querySelector('.poetry-line:not(.filled)');
        if (firstEmptySlot) {
            firstEmptySlot.textContent = text;
            firstEmptySlot.classList.add('filled');
        } else {
            showToast("è¯—ç¬ºå·²æ»¡ã€‚");
        }
    };
    
    window.addFragmentToLine = addFragmentToLine; // å°†å‡½æ•°æŒ‚è½½åˆ° windowï¼Œä»¥ä¾¿ onclick å¯ä»¥è°ƒç”¨

    ['å©‰çº¦', 'è±ªæ”¾', 'æ‰¿è¯º'].forEach(style => {
        fragmentsHTML += `<h5>${style}æ´¾</h5>`;
        for(let i=0; i<2; i++) {
            const isGoodVerse = Math.random() < playerTalent / 150;
            const verse = getRandomElement(POETRY_DATA[style]);
            // åœ¨è¿™é‡Œæ·»åŠ  onclick="window.addFragmentToLine(\`${verse}\`)"
            fragmentsHTML += `<div class="fragment" draggable="true" ondragstart="drag(event)" onclick="window.addFragmentToLine(\`${verse}\`)" style="${isGoodVerse ? 'color: var(--highlight-strong); font-weight: bold;' : ''}">${verse}</div>`;
        }
    });

    const content = `
        <p class="comment" style="text-align:center;">å¯ä»¥æ‹–æ‹½æˆ–ç‚¹å‡»å³ä¾§è¯—å¥æ¥å¡«å†™è¯—ç¬ºã€‚</p>
        <div class="poetry-editor-container">
            <div class="poetry-scroll">
                <div class="poetry-line" ondrop="drop(event, this)" ondragover="allowDrop(event)"></div>
                <div class="poetry-line" ondrop="drop(event, this)" ondragover="allowDrop(event)"></div>
                <div class="poetry-line" ondrop="drop(event, this)" ondragover="allowDrop(event)"></div>
                <div class="poetry-line" ondrop="drop(event, this)" ondragover="allowDrop(event)"></div>
            </div>
            <div class="poetry-fragments">${fragmentsHTML}</div>
        </div>
        <input type="text" id="selfComposeInput" class="self-compose-input" placeholder="æˆ–å¯è‡ªæ‹Ÿä¸€å¥... (æŒ‰å›è½¦ç¡®è®¤)">
        <button class="control-btn" style="margin-top:15px;" onclick="craftPoem('${npcId}')">å®Œæˆè¯—ä½œ</button>
    `;
    
    document.getElementById('poetryEditorContent').innerHTML = content;
    showOverlay('poetryEditorOverlay');

    document.getElementById('selfComposeInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            const line = this.value.trim();
            if (line) {
                window.addFragmentToLine(line); // è°ƒç”¨é€šç”¨å‡½æ•°
                this.value = '';
            }
        }
    });
} 
function craftPoem(npcId) {
    const lines = Array.from(document.querySelectorAll('.poetry-line')).map(el => el.textContent.trim()).filter(Boolean);
    if (lines.length < 1) {
        showToast("è‡³å°‘éœ€æœ‰ä¸€å¥è¯—ã€‚");
        return;
    }
    
    // æ ¹æ®è¯—å¥å†…å®¹å’Œç©å®¶æ‰æƒ…è®¡ç®—è¯—æ­Œçš„â€œæµªæ¼«å€¼â€å’Œâ€œæ‰¿è¯ºå€¼â€
    let romance = 0, commitment = 0;
    lines.forEach(line => {
        if (POETRY_DATA.å©‰çº¦.includes(line) || POETRY_DATA.è±ªæ”¾.includes(line)) romance += 5;
        if (POETRY_DATA.æ‰¿è¯º.includes(line)) commitment += 8; // æ‰¿è¯ºçš„è¯—å¥æ›´æ˜¾è¯šæ„
        if (!Object.values(POETRY_DATA).flat().includes(line)) romance += 3; // è‡ªæ‹Ÿçš„è¯—å¥åŠ åˆ†
    });

    romance += Math.floor(gameState.player.attributes.talent / 10);
    
    const poem = { 
        name: `æƒ…æ„ç»µç»µçš„è¯—ç¬º`, 
        desc: `ä¸€å°å¯„æ‰˜ç€ä½ å¿ƒæ„çš„è¯—ç¬ºã€‚`, 
        type: 'çå“', 
        icon: 'fa-scroll', 
        romance: romance, 
        commitment: commitment 
    };
    confessionState.poem = poem;
    
    showEventCard('è¯—ä½œæˆ', 'fa-check', `ä½ å·²å®Œæˆè¯—ä½œã€‚<br><strong class="value">æµªæ¼«+${romance}, æ‰¿è¯º+${commitment}</strong>`);
    
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ£€æŸ¥ä¿¡ç‰©æ˜¯å¦å·²å‡†å¤‡å¥½ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¼•å¯¼ç©å®¶å»å‡†å¤‡ä¿¡ç‰©
    // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿ showEventCard çš„å¼¹çª—å¯ä»¥å…ˆå…³é—­
    setTimeout(() => {
        if (confessionState.token) {
            checkConfessionReady(); // å¦‚æœä¿¡ç‰©å·²å¤‡å¥½ï¼Œç›´æ¥è¿›å…¥æœ€åä¸€æ­¥
        } else {
            showTokenCrafting(confessionState.targetNpcId); // å¦åˆ™ï¼Œå¼•å¯¼å»åˆ¶ä½œä¿¡ç‰©
        }
    }, 300); // å»¶è¿Ÿ300æ¯«ç§’
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢] showTokenCrafting å‡½æ•°
function showTokenCrafting(npcId) {
    let content = Object.entries(TOKEN_DATA).map(([id, data]) => {
        const requiredItemId = data.req.item;
        const requiredItemDef = ITEM_DATA[requiredItemId];
        const canCraft = hasItemInInventory(requiredItemId);

  
        let sourceText = 'èŒä¸šäº‹ä»¶'; // é»˜è®¤çš„è·å–é€”å¾„æ–‡æœ¬
        
        // æŸ¥æ‰¾è¿™ä¸ªææ–™æ˜¯ç”±å“ªä¸ªèŒä¸šäº§å‡ºçš„
        const sourceCareerId = Object.keys(CAREER_CRAFTING_ITEMS).find(
            careerId => CAREER_CRAFTING_ITEMS[careerId].id === requiredItemId
        );
        
        // å¦‚æœæ‰¾åˆ°äº†å¯¹åº”çš„èŒä¸šä¿¡æ¯
        if (sourceCareerId && PROFESSION_DATA[sourceCareerId]) {
            const careerName = PROFESSION_DATA[sourceCareerId].name;
            // æ›´æ–°é€”å¾„æ–‡æœ¬ï¼Œä½¿å…¶æ›´å…·ä½“ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬ä¿®æ­£åçš„â€œåŠä»¥ä¸Šâ€
            sourceText = `${careerName} (éœ€Lv.2åŠä»¥ä¸Š)`;
        }
     

        let reqText = '';
        if (!canCraft) {
            reqText += `ç¼ºå°‘ææ–™: ${requiredItemDef ? requiredItemDef.name : 'æœªçŸ¥ææ–™'}`;
        }
        
        return `
        <div class="token-option ${!canCraft ? 'disabled' : ''}" onclick="${canCraft ? `craftToken('${npcId}', '${id}')` : ''}">
            <div class="token-icon"><i class="fas fa-gift"></i></div>
            <div class="token-details">
                <strong>${data.name}</strong><br>
                {
                <small>éœ€è¦: <span class="value">${requiredItemDef ? requiredItemDef.name : 'ç‰¹æ®Šææ–™'}</span> | æ¥è‡ª: <span class="value">${sourceText}</span></small>
                ${!canCraft ? `<br><small style="color:red;">${reqText}</small>` : ''}
            </div>
        </div>`;
    }).join('');

    
    const moneyOptionCost = 5000;
    const canAffordMoneyOption = gameState.finances.wealth >= moneyOptionCost;
    content += `
        <div style="text-align: center; color: var(--text-comment); margin: 15px 0;">â€” æˆ– â€”</div>
        <div class="token-option ${!canAffordMoneyOption ? 'disabled' : ''}" onclick="${canAffordMoneyOption ? `craftTokenWithMoney('${npcId}')` : ''}">
            <div class="token-icon"><i class="fas fa-gem"></i></div>
            <div class="token-details">
                <strong>è±ªæ·åƒé‡‘</strong><br>
                <small>èŠ±è´¹ <span class="value">${moneyOptionCost}</span> ä¸¤ï¼Œå‡†å¤‡ä¸€ä»½ä¸‡èƒ½çš„å¥‡çå¼‚å®ä½œä¸ºä¿¡ç‰©ã€‚</small>
                ${!canAffordMoneyOption ? `<br><small style="color:red;">èµ„é‡‘ä¸è¶³</small>` : ''}
            </div>
        </div>
    `;
    document.getElementById('tokenCraftingContent').innerHTML = content;
    showOverlay('tokenCraftingOverlay');
}
function craftTokenWithMoney(npcId) {
    const cost = 5000;
    if (gameState.finances.wealth < cost) {
        showToast("èµ„é‡‘ä¸è¶³ï¼");
        return;
    }

    applyEffects({ wealth: -cost });

    // åˆ›å»ºä¸€ä¸ªå±æ€§ä¸é”™çš„é€šç”¨ä¿¡ç‰©
    const token = { 
        name: `ç¨€ä¸–å¥‡ç`, 
        desc: `ä½ èŠ±è´¹é‡é‡‘è´­å¾—çš„å®ç‰©ï¼Œè¶³ä»¥ä»£è¡¨ä½ çš„å¿ƒæ„ã€‚`, 
        type: 'çå“', 
        icon: 'fa-gem', 
        sincerity: 30 + Math.floor(gameState.player.attributes.charm / 10) // é­…åŠ›è¶Šé«˜ï¼ŒæŒ‘é€‰çš„ç¤¼ç‰©è¶Šå¥½
    };

    confessionState.token = token;

    showEventCard('ä¿¡ç‰©å¤‡å¦¥', 'fa-check', `ä½ èŠ±è´¹ <strong class="value">${cost}</strong> ä¸¤ï¼ŒæˆåŠŸè´­å¾—äº† <strong class="value">${token.name}</strong>ã€‚<br><strong class="value">å¿ƒæ„+${token.sincerity}</strong>`);

    // è¿™éƒ¨åˆ†é€»è¾‘å’Œ craftToken å‡½æ•°ä¿æŒä¸€è‡´ï¼Œç¡®ä¿æµç¨‹é¡ºç•…
    setTimeout(() => {
        if (confessionState.poem) {
            checkConfessionReady();
        } else {
            showPoetryEditor(confessionState.targetNpcId);
        }
    }, 300);
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
function craftToken(npcId, tokenId) {
    const data = TOKEN_DATA[tokenId];
    const requiredItemId = data.req.item;

    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ¶ˆè€—ç‰©å“æ ä¸­çš„ææ–™ï¼Œè€Œä¸æ˜¯æ‰£é’±
    if (!removeItemFromInventory(requiredItemId, 1)) {
        showToast("åˆ¶ä½œå¤±è´¥ï¼Œææ–™ä¸è¶³ï¼");
        return;
    }

    let qualityBonus = 0;
    if (data.quality_attr === 'random') {
        qualityBonus = getRandomInt(-5, 10);
    } else {
        // ç¡®ä¿å±æ€§å­˜åœ¨ï¼Œé¿å…é”™è¯¯
        const attrValue = gameState.player.attributes[data.quality_attr] || 0;
        qualityBonus = Math.floor(attrValue / 10);
    }

    const token = { 
        name: `ç²¾è‡´çš„${data.name}`, 
        desc: `ä½ ç²¾å¿ƒå‡†å¤‡çš„ä¿¡ç‰©ã€‚`, 
        type: 'çå“', 
        icon: 'fa-gift', 
        ...data.stats 
    };
    if (token.sincerity) {
        token.sincerity += qualityBonus;
    }

    confessionState.token = token;

    showEventCard('ä¿¡ç‰©å¤‡å¦¥', 'fa-check', `ä½ ä½¿ç”¨äº†<strong class="value">ã€${ITEM_DATA[requiredItemId].name}ã€‘</strong>ï¼ŒæˆåŠŸåˆ¶ä½œäº† <strong class="value">${token.name}</strong>ã€‚<br><strong class="value">å¿ƒæ„+${token.sincerity || 0}</strong>`);

    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ£€æŸ¥æƒ…è¯—æ˜¯å¦å·²å‡†å¤‡å¥½ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¼•å¯¼ç©å®¶å»å†™è¯—
    // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿ showEventCard çš„å¼¹çª—å¯ä»¥å…ˆå…³é—­
    setTimeout(() => {
        if (confessionState.poem) {
            checkConfessionReady(); // å¦‚æœæƒ…è¯—å·²å¤‡å¥½ï¼Œç›´æ¥è¿›å…¥æœ€åä¸€æ­¥
        } else {
            showPoetryEditor(confessionState.targetNpcId); // å¦åˆ™ï¼Œå¼•å¯¼å»å†™è¯—
        }
    }, 300); // å»¶è¿Ÿ300æ¯«ç§’
} 
function checkConfessionReady() {
    // åªæœ‰å½“è¯—å’Œä¿¡ç‰©éƒ½å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œä¸‹ä¸€æ­¥
    if (confessionState.poem && confessionState.token) {
        // å…³é—­å½“å‰å¯èƒ½æ‰“å¼€çš„ç¼–è¾‘å™¨/åˆ¶ä½œå°
        closeAllOverlays();
        
        // å»¶è¿Ÿä¸€ç‚¹ç‚¹ï¼Œè®©UIå…³é—­åŠ¨ç”»å®Œæˆï¼Œé˜²æ­¢é—ªçƒ
        setTimeout(() => {
            showDecisionCard('å‡†å¤‡å¦¥å½“', 'fa-paper-plane', 'æƒ…è¯—ä¸ä¿¡ç‰©å‡å·²å¤‡å¥½ï¼Œä½ æ‰“ç®—å¦‚ä½•å°†è¿™ä»½å¿ƒæ„ä¼ è¾¾ç»™TAï¼Ÿ', [
                { htmlContent: 'æ‰˜å¿ƒè…¹è½¬äº¤', callback: () => handleConfessionDelivery('servant') },
                { htmlContent: 'é£é¸½ä¼ ä¹¦', callback: () => handleConfessionDelivery('pigeon') },
                { htmlContent: 'å½“é¢é€’äº¤', callback: () => handleConfessionDelivery('in_person') },
            ]);
        }, 300);

    } else {
        // å¦‚æœåªå®Œæˆäº†ä¸€é¡¹ï¼Œå°±å›åˆ°æœ€åˆçš„é€‰é¡¹ç•Œé¢ï¼Œè®©ç©å®¶ç»§ç»­å‡†å¤‡å¦ä¸€é¡¹
        startConfessionProcess(confessionState.targetNpcId);
    }
}

/**
 * æ ¸å¿ƒåŠŸèƒ½7ï¼šå¤„ç†æœ€ç»ˆçš„è¡¨ç™½é€’é€å’Œç»“æœåˆ¤å®š
 */
function handleConfessionDelivery(method) {
    // ã€æ–°å¢ã€‘åœ¨è¡¨ç™½æµç¨‹å¼€å§‹æ—¶ï¼Œç«‹åˆ»è®¾ç½®æ ‡è®°ï¼Œé˜»æ­¢æœ¬å›åˆå†æ¬¡è¡¨ç™½
    gameState.flags.confessionAttemptedThisTurn = true;

    const npc = gameState.npcs[confessionState.targetNpcId];
    let successRate = 0.5; // åŸºç¡€æˆåŠŸç‡
    let resultLog = [];

    // æ ¹æ®é€’é€æ–¹å¼è°ƒæ•´æˆåŠŸç‡
    switch(method) {
        case 'servant': successRate += 0.05; resultLog.push('ä½ å°†ä¿¡ç‰©ä¸è¯—ç¬ºäº¤äºˆå¿ƒè…¹ï¼Œæ‰˜å…¶è½¬äº¤ã€‚'); break;
        case 'pigeon': successRate -= 0.1; resultLog.push('ä½ å°†ä¿¡ä¸ç‰©ç³»äºé¸½è¶³ï¼Œæ”¾é£äºå¤©é™…ï¼Œå¿ƒä¸­ä¸å…æœ‰äº›å¿å¿‘ã€‚'); break;
        case 'in_person': successRate += 0.2; resultLog.push('ä½ é¼“èµ·å‹‡æ°”ï¼Œå†³å®šå½“é¢å°†è¿™ä»½å¿ƒæ„äº¤äºˆå¯¹æ–¹ã€‚'); break;
    }

    // æ ¹æ®è¯—å’Œä¿¡ç‰©çš„æ€»å±æ€§è®¡ç®—æˆåŠŸç‡åŠ æˆ
    const totalScore = (confessionState.poem.romance || 0) + (confessionState.poem.commitment || 0) + (confessionState.token.sincerity || 0);
    successRate += totalScore / 150; // æ€»åˆ†è¶Šé«˜ï¼ŒåŠ æˆè¶Šå¤š
    resultLog.push(`ä½ çš„è¯—æ–‡ä¸ä¿¡ç‰©å…±è®¡æä¾›äº† <strong class="value">${Math.round(totalScore / 150 * 100)}%</strong> çš„æˆåŠŸç‡åŠ æˆã€‚`);

    // æ ¹æ®å¥½æ„Ÿåº¦è®¡ç®—æˆåŠŸç‡åŠ æˆ
    successRate += npc.favor / 250;
    resultLog.push(`ä½ ä»¬çš„å½“å‰å¥½æ„Ÿæä¾›äº† <strong class="value">${Math.round(npc.favor / 250 * 100)}%</strong> çš„æˆåŠŸç‡åŠ æˆã€‚`);
    
    successRate = Math.min(0.98, successRate); // æœ€é«˜98%æˆåŠŸç‡

    if (Math.random() < successRate) {
        // è¡¨ç™½æˆåŠŸ
        resultLog.push(`<br><strong><span style="color:green;">è¡¨ç™½æˆåŠŸï¼</span></strong>`);
        resultLog.push(`å¯¹æ–¹æ”¶ä¸‹äº†ä½ çš„å¿ƒæ„ï¼Œé¢è‹¥æ¡ƒèŠ±ï¼Œå«ç¾åº”å…ã€‚ä½ ä»¬çš„å…³ç³»æ­£å¼ç¡®ç«‹ï¼`);
        
        showEventCard('ä¸¤æƒ…ç›¸æ‚¦', 'fa-heart', resultLog.join('<br>'));
        
        // è‡ªåŠ¨è½¬ä¸ºæƒ…äººå…³ç³»
        applyEffects({ relationship: { targetId: npc.id, favor: 50, emotionValue: 100 } });
        const rel = gameState.social.relationships[npc.id];
        if (rel) {
            rel.type = 'lover';
            rel.level = 1; // å…³ç³»ç­‰çº§æå‡
            if(!gameState.social.secretLovers.includes(npc.id)) {
                gameState.social.secretLovers.push(npc.id);
            }
        }
    } else {
        // è¡¨ç™½å¤±è´¥
        resultLog.push(`<br><strong><span style="color:red;">è¡¨ç™½å¤±è´¥...</span></strong>`);
        resultLog.push(`â€œæ‰¿è’™åšçˆ±ï¼Œç„¶ä½ æˆ‘...æœ‰ç¼˜æ— åˆ†ã€‚â€å¯¹æ–¹å©‰æ‹’äº†ä½ çš„å¿ƒæ„ã€‚`);
        showEventCard('æœ‰ç¼˜æ— åˆ†', 'fa-heart-broken', resultLog.join('<br>'));
        applyEffects({ relationship: { targetId: npc.id, favor: -20 } });
    }
    
    // æ¸…ç©ºæœ¬æ¬¡è¡¨ç™½çš„çŠ¶æ€
    confessionState = {};
}// åˆå§‹åŒ–å¾’å¼Ÿç³»ç»Ÿ
function initApprenticeSystem() {
    if (!gameState.apprentices) {
        gameState.apprentices = [];
    }
    if (!gameState.apprenticeSlots) {
        gameState.apprenticeSlots = 1; // åˆå§‹å¾’å¼Ÿæ§½ä½
    }
}

// ã€å·²ä¿®å¤ã€‘æ£€æŸ¥æ˜¯å¦å¯ä»¥æ”¶å¾’ (æ”¹å›å£°æœ›åˆ¤æ–­)
function canTakeApprentice() {
    // è¿‡æ»¤æ‰å·²å‡ºå¸ˆçš„å¾’å¼Ÿæ¥è®¡ç®—å½“å‰å ç”¨çš„æ§½ä½æ•°
    const activeApprentices = gameState.apprentices.filter(a => a.state !== 'graduated').length;
    return activeApprentices < gameState.apprenticeSlots;
}
// ã€å·²ä¿®å¤ã€‘ç”Ÿæˆéšæœºå¾’å¼Ÿ (è¡¥ä¸Šæˆé•¿ç‡)
function generateRandomApprentice() {
    const gender = Math.random() > 0.5 ? 'male' : 'female';
    const type = getRandomElement(apprenticeData.types);
    const surname = getRandomElement(nameData.surnames);
    const givenName = gender === 'female' ?
        getRandomElement(nameData.girlNames) :
        getRandomElement(nameData.boyNames);

    const attributes = {};
    for (const [attr, range] of Object.entries(apprenticeData.baseAttributes)) {
        attributes[attr] = getRandomInt(range.min, range.max);
    }

    for (const [attr, bonus] of Object.entries(type.attributesBonus)) {
        attributes[attr] += bonus;
    }
    
    // å¤åˆ¶åŸºç¡€æˆé•¿ç‡
    const growthRates = { ...apprenticeData.growthRates };
    // åº”ç”¨ç±»å‹æˆé•¿åŠ æˆ
    for (const [attr, bonus] of Object.entries(type.growthBonus)) {
        growthRates[attr] += bonus;
    }

    return {
        id: `apprentice_${Date.now()}_${getRandomInt(1000, 9999)}`,
        name: `${surname}${givenName}`,
        gender: gender,
        age: 14,
        type: type.name,
        attributes: attributes,
        growthRates: growthRates, // <--- è¡¥ä¸Šè¿™ä¸€è¡Œ
        favor: 50,
        state: 'learning',
        avatar: getRandomElement(avatarPools[gender]),
    };
}

// ã€å·²ä¿®å¤ã€‘æ˜¾ç¤ºæ”¶å¾’ç•Œé¢ (æ”¹å›æ”¶å¾’æ¡ä»¶åˆ¤æ–­)
function showApprenticeSystem() {
    const content = document.getElementById('apprenticeSystemContent');
    let html = '';
    
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†æ—§çš„å£°æœ›åˆ¤æ–­ï¼Œæ”¹ä¸ºæ›´å‡†ç¡®çš„å¹´é¾„åˆ¤æ–­ â–¼â–¼â–¼
    if (gameState.player.age < 16) {
        html = `
            <div class="overlay-content">
                <p class="comment" style="text-align:center; padding-top: 50px;">
                    å¸ˆé—¨æœªç«‹ï¼Œé™å¾…æˆå¹´ã€‚<br>
                    ï¼ˆè¯¥åŠŸèƒ½å°†åœ¨ä½ 16å²åå¼€å¯ï¼‰
                </p>
            </div>
        `;
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    } else {
        if (gameState.apprentices.length > 0) {
            html += `<div class="section-header"><i class="fas fa-users"></i> æˆ‘çš„å¾’å¼Ÿ</div>`;
            gameState.apprentices.forEach(apprentice => {
                html += renderApprenticeCard(apprentice);
            });
        }
        
        if (gameState.apprentices.length < gameState.apprenticeSlots) {
            html += `
                <div class="section-header"><i class="fas fa-user-plus"></i> æ‹›æ”¶æ–°å¾’</div>
                <p>ä½ å¯ä»¥æ‹›æ”¶ä¸€åæ–°å¾’å¼Ÿï¼š</p>
                <button class="apprentice-option" onclick="takeNewApprentice()">
                    <i class="fas fa-graduation-cap"></i> æ‹›æ”¶å¾’å¼Ÿ
                </button>
            `;
        } else {
            const nextUpgrade = APPRENTICE_SLOT_UPGRADES.find(u => u.slot === gameState.apprenticeSlots + 1);
            if (nextUpgrade) {
                const playerCareerLevel = gameState.career.path !== null ? gameState.career.level + 1 : 0;
                const canUpgrade = playerCareerLevel >= nextUpgrade.req.level;
                html += `
                    <div class="section-header"><i class="fas fa-unlock-alt"></i> æ‰©å……å¸ˆé—¨</div>
                    <button class="apprentice-option" ${!canUpgrade ? 'disabled' : ''} onclick="upgradeApprenticeSlot()">
                        <i class="fas fa-unlock-alt"></i> 
                        <span class="option-text">å‡çº§å¾’å¼Ÿæ§½ä½</span>
                    </button>
                    <p class="comment" style="text-align:center;">${nextUpgrade.desc}</p>
                `;
            } else {
                html += `<p class="comment" style="text-align:center;">å¾’å¼Ÿåé¢å·²è¾¾ä¸Šé™ã€‚</p>`;
            }
        }
    }
    
    content.innerHTML = html;
    showOverlay('apprenticeSystemOverlay');
}
// ã€å·²ä¿®å¤ã€‘æ¸²æŸ“å¾’å¼Ÿå¡ç‰‡ (è¡¥ä¸ŠçŠ¶æ€å’Œå‡ºå¸ˆæŒ‰é’®)
// [æ›¿æ¢]
function renderApprenticeCard(apprentice) {
    const canGraduate = checkApprenticeGraduation(apprentice);
    
    let graduationConditionsHTML = '';
    if (apprentice.state !== 'graduated') {
        const masterProfession = gameState.career.path || 'default';
        const requirements = APPRENTICE_GRADUATION_REQUIREMENTS[masterProfession] || APPRENTICE_GRADUATION_REQUIREMENTS['default'];
        
        graduationConditionsHTML = `<div style="font-size: 0.8em; margin-top: 8px; color: var(--text-comment);"><strong>å‡ºå¸ˆç›®æ ‡: ${requirements.desc}</strong><ul>`;
        
        for (const attr in requirements) {
            if (attr === 'desc') continue;
            const currentVal = Math.floor(apprentice.attributes[attr] || 0);
            const targetVal = requirements[attr];
            const met = currentVal >= targetVal;
            graduationConditionsHTML += `<li style="color: ${met ? 'green' : 'inherit'};">${ATTR_MAP[attr] || attr}: ${currentVal} / ${targetVal}</li>`;
        }
        graduationConditionsHTML += `</ul></div>`;
    }
  return `
        <div class="apprentice-card">
            <div class="avatar-wrapper" style="width: 80px; height: 80px; flex-shrink:0;">
                <img src="${apprentice.avatar}" class="avatar-image" style="display:block;">
            </div>
            <div class="apprentice-details">
                <div class="apprentice-name">
                    <i class="fas fa-${apprentice.gender === 'male' ? 'male' : 'female'}"></i> 
                    ${apprentice.name} (${Math.floor(apprentice.age)}å²)
                    <span style="font-size:0.8em; color:#666; margin-left:10px;">${apprentice.type}</span>
                </div>
                <p><strong>çŠ¶æ€:</strong> ${apprentice.state === 'learning' ? 'ä¿®ä¹ ä¸­' : 'å·²å‡ºå¸ˆ'}</p>
                <p><strong>å¥½æ„Ÿåº¦:</strong> ${apprentice.favor}</p>
                <div class="attributes-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); margin-top:10px; gap: 5px 15px;">
                    ${Object.keys(ATTR_MAP).map(attr => {
                        const iconMap = {talent:'fa-pencil-alt', etiquette:'fa-hands-helping', wisdom:'fa-lightbulb', virtue:'fa-leaf', charm:'fa-grin-stars', martial:'fa-khanda', health:'fa-heart', reputation:'fa-star'};
                        const classMap = {talent:'talent-fill', etiquette:'etiquette-fill', wisdom:'wisdom-fill', virtue:'virtue-fill', charm:'charm-fill', martial:'martial-fill', health:'health-fill', reputation:'virtue-fill'};
                        if(apprentice.attributes[attr] === undefined) return '';
                        return renderAttributeBar(ATTR_MAP[attr], apprentice.attributes[attr], classMap[attr], iconMap[attr], 100);
                    }).join('')}
                </div>
                ${graduationConditionsHTML}
            </div>
            <div class="apprentice-btn-group">
                ${apprentice.state !== 'graduated' ? `<button class="apprentice-interact-btn" onclick="interactWithApprentice('${apprentice.id}')">äº’åŠ¨</button>` : ''}
                ${canGraduate ? `<button class="apprentice-interact-btn" style="background:linear-gradient(135deg, #a7c957, #6a9ac9);" onclick="graduateApprentice('${apprentice.id}')">å‡ºå¸ˆ</button>` : ''}
            </div>
        </div>
    `;
}
function takeNewApprentice() {
    if (!canTakeApprentice()) {
        showToast("æ”¶å¾’æ¡ä»¶æœªæ»¡è¶³æˆ–åé¢å·²æ»¡");
        return;
    }
    
    // ç”Ÿæˆä¸‰ä½å€™é€‰äººä¾›ç©å®¶é€‰æ‹©
    const candidates = [
        generateRandomApprentice(),
        generateRandomApprentice(),
        generateRandomApprentice()
    ];

    let optionsHTML = candidates.map(candidate => {
        const candidateInfoString = JSON.stringify(candidate).replace(/'/g, "\\'");
        return {
            htmlContent: `
                <div class="suitor" style="cursor:pointer; margin-bottom:0;">
                    <div class="suitor-avatar-wrapper" style="width:50px; height:50px;">
                         <img src="${candidate.avatar}" class="suitor-avatar">
                    </div>
                    <div class="suitor-details" style="text-align:left;">
                        <div class="suitor-name">${candidate.name}</div>
                        <div class="suitor-desc">${candidate.type}</div>
                    </div>
                </div>`,
            style: `padding:10px; height:auto;`,
            callback: () => {
                const chosen = JSON.parse(candidateInfoString);
                gameState.apprentices.push(chosen);
                showEventCard('å–œæ”¶é—¨å¾’', 'fa-graduation-cap', `ä½ æ”¶ä¸‹äº† <strong class="value">${chosen.name}</strong> ä¸ºå¾’ï¼Œä»æ­¤æœ‰äº†ä¼ æ‰¿ä¹‹äººã€‚`);
                closeAllOverlays();
                showApprenticeSystem();
            }
        };
    });

    showDecisionCard(
        "æ‹©å¾’æˆä¸š",
        "fa-users",
        "<p>ä½ æ”¾å‡ºæ¶ˆæ¯è¦æ”¶å¾’ï¼Œå‰æ¥æ‹œå¸ˆçš„å°‘å¹´ç»œç»ä¸ç»ã€‚ç»è¿‡ç­›é€‰ï¼Œä½ ç•™ä¸‹äº†ä¸‰ä½å€™é€‰äººï¼š</p>",
        optionsHTML
    );
}
// ã€å·²ä¿®å¤ã€‘ä¸å¾’å¼Ÿäº’åŠ¨ (æ¢å¤æ£€æŸ¥é‡‘é’±çš„é€»è¾‘)
function interactWithApprentice(apprenticeId) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    if (!apprentice) return;
    
    let html = `
        <div class="overlay-content">
            <h4>ä¸å¾’å¼Ÿ <strong class="value">${apprentice.name}</strong> çš„äº’åŠ¨</h4>
            <p>é€‰æ‹©äº’åŠ¨æ–¹å¼ (æœ¬å›åˆå‰©ä½™åŸ¹å…»æ¬¡æ•°: ${2 - (gameState.flags.actionUsed_apprentice || 0)})</p>
            <div id="apprentice-interactions-container">
    `;
    
    apprenticeData.interactions.forEach(interaction => {
        let canInteract = true;
        let costText = '';
        
        if (interaction.cost.action && (gameState.flags.actionUsed_apprentice || 0) >= 2) {
            canInteract = false;
        }
        
        if (interaction.cost.wealth && gameState.finances.wealth < interaction.cost.wealth) {
            canInteract = false;
            costText += `é“¶ä¸¤ä¸è¶³(${interaction.cost.wealth}) `;
        }
        
        // ä¿®æ”¹ "æŒ‡æ´¾å·¥ä½œ" çš„ onclick äº‹ä»¶
        const clickAction = interaction.id === 'assign_work' 
            ? `showAssignWorkOptions('${apprentice.id}')` 
            : `performApprenticeInteraction('${apprentice.id}', '${interaction.id}')`;

        html += `
            <button class="apprentice-option" ${!canInteract ? 'disabled' : ''} onclick="${clickAction}">
                <i class="fas fa-${interaction.id === 'teach' ? 'book' : interaction.id === 'practice' ? 'running' : interaction.id === 'socialize' ? 'hands-helping' : 'tasks'}"></i>
                <span class="option-text"><strong>${interaction.name}</strong> - ${interaction.desc}</span>
                ${costText ? `<br><small style="color:red;">${costText}</small>` : ''}
            </button>
        `;
    });
    
    html += `</div></div>`;
    
    document.getElementById('apprenticeSystemContent').innerHTML = html;
    showOverlay('apprenticeSystemOverlay');
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢] performApprenticeInteraction å‡½æ•°
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function performApprenticeInteraction(apprenticeId, interactionId) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    const interaction = apprenticeData.interactions.find(i => i.id === interactionId);

    if (!apprentice || !interaction) return;

    if (interaction.cost.action && (gameState.flags.actionUsed_apprentice || 0) >= 2) {
        showToast("æœ¬å›åˆåŸ¹å…»å¾’å¼Ÿæ¬¡æ•°å·²ç”¨å°½");
        return;
    }

    if (interaction.cost.wealth && gameState.finances.wealth < interaction.cost.wealth) {
        showToast("é“¶ä¸¤ä¸è¶³");
        return;
    }

    if (interaction.cost.action) {
        gameState.flags.actionUsed_apprentice = (gameState.flags.actionUsed_apprentice || 0) + 1; 
    }

    if (interaction.cost.wealth) {
        applyEffects({ wealth: -interaction.cost.wealth });
    }

    let apprenticeEffectsLog = [];
    let masterEffectsLog = [];
    let narrativeText = ''; // ç”¨äºç”Ÿæˆæè¿°æ€§æ–‡æœ¬

    // ã€ä¿®å¤æ ¸å¿ƒã€‘é‡å†™åé¦ˆæ–‡æœ¬ç”Ÿæˆé€»è¾‘
    switch(interactionId) {
        case 'teach':
            narrativeText = "ä½ å°†æ¯•ç”Ÿæ‰€å­¦å€¾å›Šç›¸æˆï¼Œå¾’å¼Ÿå¬å¾—å¦‚ç—´å¦‚é†‰ï¼Œä¼¼ä¹å¯¹ç»å²å­é›†æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œä½ è‡ªå·±çš„å­¦é—®ä¹Ÿç²¾è¿›äº†ä¸å°‘ã€‚";
            break;
        case 'practice':
            narrativeText = "åº­é™¢ä¸­ï¼Œä½ ä»¬å¸ˆå¾’äºŒäººåˆ‡ç£‹æ­¦è‰ºï¼Œæ±—æ°´æµ¸æ¹¿äº†è¡£è¡«ã€‚å¾’å¼Ÿçš„æ‹›å¼æ„ˆå‘çº¯ç†Ÿï¼Œä½ çš„ç­‹éª¨ä¹Ÿå¾—åˆ°äº†æ´»åŠ¨ã€‚";
            break;
        case 'socialize':
            narrativeText = "ä½ å¸¦ç€å¾’å¼Ÿå‚åŠ äº†ä¸€åœºæ–‡ä¼šé›…é›†ï¼Œæ•™å¯¼TAå¾…äººæ¥ç‰©çš„ç¤¼èŠ‚ã€‚TAåœ¨ä¼—äººé¢å‰ä¸¾æ­¢å¾—ä½“ï¼Œä¸ºä½ æŒ£å¾—äº†ä¸å°‘é¢œé¢ã€‚";
            break;
        case 'mentor':
            narrativeText = "æœˆä¸‹é•¿è°ˆï¼Œä½ ä¸å¾’å¼Ÿæ¢è®¨äººç”Ÿå“²ç†ã€‚TAçœ¼ä¸­è¿·èŒ«æ¸å»ï¼Œå¤šäº†å‡ åˆ†æ¸…æ˜ï¼Œè€Œä½ ä¹Ÿåœ¨æ•™å¯¼ä¸­åšå®šäº†è‡ªå·±çš„é“å¿ƒã€‚";
            break;
        case 'gift_money':
            narrativeText = `â€œè¿™ç‚¹é’±æ‹¿å»ï¼Œä¹°äº›éœ€è¦çš„ä¸œè¥¿å§ã€‚â€ä½ çš„æ…·æ…¨è®©å¾’å¼Ÿ${apprentice.name}æ„ŸåŠ¨ä¸å·²ï¼Œè§†ä½ å¦‚å†ç”Ÿçˆ¶æ¯ã€‚`;
            break;
        default:
            narrativeText = `ä½ å¯¹å¾’å¼Ÿ ${apprentice.name} è¿›è¡Œäº† ${interaction.name}ã€‚`;
            break;
    }

    // åº”ç”¨æ•ˆæœå¹¶ç”Ÿæˆè¯¦ç»†æ—¥å¿—ï¼ˆè¿™éƒ¨åˆ†é€»è¾‘ä¿ç•™å¹¶ä¼˜åŒ–ï¼‰
    if (interaction.effect.apprentice) {
        if (interaction.effect.apprentice.attributes) {
            for (const [attr, value] of Object.entries(interaction.effect.apprentice.attributes)) {
                apprentice.attributes[attr] = (apprentice.attributes[attr] || 0) + value;
                apprenticeEffectsLog.push(`${ATTR_MAP[attr]} +${value}`);
            }
        }
        if (interaction.effect.apprentice.favor) {
            apprentice.favor = Math.min(100, apprentice.favor + interaction.effect.apprentice.favor);
            apprenticeEffectsLog.push(`å¥½æ„Ÿ +${interaction.effect.apprentice.favor}`);
        }
    }

    if (interaction.effect.master) {
        if (interaction.effect.master.attributes) {
            applyEffects({ attributes: interaction.effect.master.attributes });
            for (const [attr, value] of Object.entries(interaction.effect.master.attributes)) {
                masterEffectsLog.push(`${ATTR_MAP[attr]} +${value}`);
            }
        }
    }

    // ç»„åˆæœ€ç»ˆçš„åé¦ˆæ–‡æœ¬
    let resultText = `<p>${narrativeText}</p><hr style="margin: 10px 0; border-top: 1px dashed var(--border-color-light);">`;
    if(apprenticeEffectsLog.length > 0) {
        resultText += `<p><strong>${apprentice.name}:</strong> ${apprenticeEffectsLog.join('ï¼Œ')}ã€‚</p>`;
    }
    if(masterEffectsLog.length > 0) {
        resultText += `<p><strong>ä½ :</strong> ${masterEffectsLog.join('ï¼Œ')}ã€‚</p>`;
    }

    showEventCard('å¸ˆå¾’äº’åŠ¨', 'fa-users', resultText, [
        { text: 'å¥½çš„', callback: () => { renderGame(); showApprenticeSystem(); } }
    ]);
}
function checkForApprenticeEvents() {
    const activeApprentices = gameState.apprentices.filter(a => a.state === 'learning');
    if (activeApprentices.length === 0) return;
    
    // æ¯å›åˆæœ‰25%çš„å‡ ç‡è§¦å‘ä¸€ä¸ªå¾’å¼Ÿäº‹ä»¶
    if (Math.random() < 0.25) {
        const apprentice = getRandomElement(activeApprentices);
        const event = getRandomElement(apprenticeSpecialEvents);
        
        let eventDesc = event.desc.replace('ä½ çš„å¾’å¼Ÿ', `ä½ çš„å¾’å¼Ÿ <strong class="value">${apprentice.name}</strong>`);
        
        let options = event.options.map(option => {
            let canSelect = true;
            let costText = "";
            
            if (option.cost) {
                if (option.cost.action && gameState.flags.actionUsed_apprentice >= 2) {
                    canSelect = false;
                    costText += "åŸ¹å…»æ¬¡æ•°å·²ç”¨å°½ ";
                }
                if (option.cost.wealth && gameState.finances.wealth < option.cost.wealth) {
                    canSelect = false;
                    costText += `é“¶ä¸¤ä¸è¶³(${option.cost.wealth}) `;
                }
            }
            
            return {
                htmlContent: `<span class="option-text">${option.text}${costText ? `<br><small style="color:red;">${costText}</small>` : ""}</span>`,
                disabled: !canSelect,
                callback: () => handleApprenticeEvent(apprentice.id, event, option)
            };
        });
        
        // ä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—æ¥æ˜¾ç¤ºï¼Œé˜²æ­¢ä¸å…¶ä»–å¼¹çª—å†²çª
        eventQueue.push(() => {
            showDecisionCard(event.title, 'fa-user-graduate', eventDesc, options);
        });
    }
}// æ·»åŠ å¤„ç†å¾’å¼Ÿäº‹ä»¶çš„å‡½æ•°
// [æ›¿æ¢]
function handleApprenticeEvent(apprenticeId, event, option) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    if(!apprentice) return;

    // æ”¯ä»˜æˆæœ¬
    if (option.cost) {
        if (option.cost.action) {
            gameState.flags.actionUsed_apprentice++;
        }
        if (option.cost.wealth) {
            // æ³¨æ„ï¼šå¦‚æœcostæ˜¯è´Ÿæ•°ï¼Œåˆ™ä¸ºå¢åŠ è´¢å¯Œ
            applyEffects({ wealth: -option.cost.wealth });
        }
    }
    
    const effects = option.effects || {};
    
    // åº”ç”¨å¯¹å¾’å¼Ÿçš„æ•ˆæœ
    if (effects.apprentice) {
        if (effects.apprentice.attributes) {
            Object.entries(effects.apprentice.attributes).forEach(([attr, value]) => {
                apprentice.attributes[attr] = (apprentice.attributes[attr] || 0) + value; // [ä¿®å¤] ç§»é™¤äº†200çš„ä¸Šé™
            });
        }
        if (effects.apprentice.favor) {
            apprentice.favor = Math.max(0, Math.min(100, apprentice.favor + effects.apprentice.favor));
        }
    }
    
    // åº”ç”¨å¯¹å¸ˆå‚…çš„æ•ˆæœ
    if (effects.master) {
        if (effects.master.attributes) {
            applyEffects({ attributes: effects.master.attributes });
        }
        if (effects.master.reputation) {
            applyEffects({ reputation: effects.master.reputation });
        }
    }
    
    showEventCard(event.title, 'fa-user-graduate', option.result_text);
    renderGame();
}
function checkApprenticeGraduation(apprentice) {
    if (apprentice.state === 'graduated' || apprentice.age < 18) return false;
    const masterProfession = gameState.career.path || 'default';
    const requirements = APPRENTICE_GRADUATION_REQUIREMENTS[masterProfession] || APPRENTICE_GRADUATION_REQUIREMENTS['default'];

    for (const attr in requirements) {
        if (attr === 'desc') continue;
        // â–¼â–¼â–¼ æ ¸å¿ƒä¿®å¤ç‚¹ â–¼â–¼â–¼
        // åœ¨è¿›è¡Œé€»è¾‘åˆ¤æ–­å‰ï¼Œä¹Ÿå¯¹å±æ€§å€¼è¿›è¡Œå–æ•´ï¼Œç¡®ä¿ä¸ç•Œé¢æ˜¾ç¤ºä¸€è‡´
        if (Math.floor(apprentice.attributes[attr] || 0) < requirements[attr]) {
        // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
            return false;
        }
    }
    return true;
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢] graduateApprentice å‡½æ•°
function graduateApprentice(apprenticeId) {
    const apprenticeIndex = gameState.apprentices.findIndex(a => a.id === apprenticeId);
    if (apprenticeIndex === -1) return;

    const apprentice = gameState.apprentices[apprenticeIndex];
    if (!checkApprenticeGraduation(apprentice)) return;

    const totalAttributes = Object.values(apprentice.attributes).reduce((sum, val) => sum + val, 0);
    const reward = {
        wealth: 1000 + Math.floor(totalAttributes * 5) + Math.floor(apprentice.favor * 20),
        reputation: 50 + Math.floor(totalAttributes / 20)
    };

    // [æ–°å¢] å°†å¾’å¼Ÿè½¬æ¢æˆNPC
    const newNpc = generateNPC({
        id: apprentice.id, // ä½¿ç”¨åŸIDç¡®ä¿å”¯ä¸€æ€§
        name: apprentice.name,
        gender: apprentice.gender,
        age: apprentice.age,
        avatar: apprentice.avatar,
        attributes: apprentice.attributes,
        favor: apprentice.favor + 20, // å‡ºå¸ˆåå¥½æ„Ÿæ›´é«˜
        relationship: 'former_apprentice',
        role: 'å‡ºå¸ˆå¼Ÿå­'
    });

    // åœ¨ç¤¾äº¤å…³ç³»ä¸­å»ºç«‹è”ç³»
    gameState.social.relationships[newNpc.id] = {
        type: 'former_apprentice', // è‡ªå®šä¹‰ä¸€ä¸ªå…³ç³»ç±»å‹
        favor: newNpc.favor,
        trust: 80,
        emotionValue: 150,
        level: 3
    };

    // ä»å¾’å¼Ÿåˆ—è¡¨ä¸­ç§»é™¤
    gameState.apprentices.splice(apprenticeIndex, 1);

    applyEffects({ wealth: reward.wealth, reputation: reward.reputation });
    addItemToInventory('ming_shi_bian_e', 1);

    const apprenticeTypeData = apprenticeData.types.find(t => t.name === apprentice.type);
    let attributeBonusText = '';
    if (apprenticeTypeData && apprenticeTypeData.assistBonus) {
        applyEffects({ attributes: apprenticeTypeData.assistBonus });
        attributeBonusText = `<p>å› ææ–½æ•™ï¼Œä½ å¯¹${Object.keys(apprenticeTypeData.assistBonus).map(k => ATTR_MAP[k]).join('ä¸')}çš„ç†è§£ä¹Ÿæ›´æ·±äº†ã€‚</p>`;
    }

    const eventContent = `
        <p>ä½ çš„å¾’å¼Ÿ <strong class="value">${apprentice.name}</strong> å·²å­¦æœ‰æ‰€æˆï¼Œä»Šæ—¥å«æ³ªæ‹œåˆ«ï¼Œæ­£å¼å‡ºå¸ˆï¼</p>
        <p>TAä¸ºä½ é€ä¸Š<strong class="value">ã€åå¸ˆåŒ¾é¢ã€‘</strong>ä¸<strong class="value">è°¢å¸ˆç¤¼(${reward.wealth}ä¸¤)</strong>ã€‚</p>
        ${attributeBonusText}
        <p>ä½ çš„å£°æœ›ä¹Ÿå› æ­¤æå‡äº† <span class="value">${reward.reputation}</span> ç‚¹ã€‚</p>
        <p class="comment">â€œå¸ˆçˆ¶å¤§æ©ï¼Œå¼Ÿå­æ°¸ä¸–ä¸å¿˜ã€‚â€ ä»æ­¤ï¼ŒTAå°†ä½œä¸ºä½ çš„å¼Ÿå­åœ¨äº¬åŸè¡Œèµ°ï¼Œä½ ä»¬ä»å¯æ—¶æ—¶äº’åŠ¨ã€‚</p>
    `;

    showEventCard('é«˜å¾’å‡ºå¸ˆ', 'fa-user-graduate', eventContent, [
        { text: 'æŒ¥æ‰‹ä½œåˆ«', callback: () => {
            closeAllOverlays();
            showApprenticeSystem();
        }}
    ]);
    renderGame();
}
function calculateGraduationReward(apprentice) {
  // æ ¹æ®å¾’å¼Ÿå±æ€§å’Œç±»å‹è®¡ç®—å¥–åŠ±
  const baseReward = 2000;
  const attributeBonus = Object.values(apprentice.attributes).reduce((sum, val) => sum + val, 0) * 10;
  
  return {
    wealth: baseReward + attributeBonus,
    reputation: 50 + Math.floor(attributeBonus / 100)
  };
}
// ã€æ–°å¢ã€‘æ˜¾ç¤ºæŒ‡æ´¾å·¥ä½œé€‰é¡¹çš„å‡½æ•°
function showAssignWorkOptions(apprenticeId) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    if (!apprentice) return;
    if ((gameState.flags.actionUsed_apprentice || 0) >= 2) {
        showToast("æœ¬å›åˆåŸ¹å…»æ¬¡æ•°å·²ç”¨å°½");
        return;
    }

    const hasProperty = gameState.merchant.investments.length > 0 || gameState.merchant.ownedLand.length > 0;
    
    const options = [
        {
            htmlContent: `<strong>è¾…åŠ©æœ¬èŒ</strong><div><small>æå‡èŒä¸šæ ¸å¿ƒèµ„æº</small></div>`,
            callback: () => handleWorkAssignment(apprenticeId, 'assist')
        },
        {
            htmlContent: `<strong>æ´¾å¾€å•†ä¼š</strong><div><small>å¯èƒ½å¸¦å›é‡‘é’±æˆ–è´§ç‰©</small></div>`,
            callback: () => handleWorkAssignment(apprenticeId, 'guild')
        },
        {
            htmlContent: `<strong>æ‰“ç†ç§äº§</strong><div><small>æå‡äº§ä¸š/å†œç”°æ”¶ç›Š</small></div>`,
            disabled: !hasProperty,
            callback: () => handleWorkAssignment(apprenticeId, 'property')
        }
    ];

    showDecisionCard('æŒ‡æ´¾å·¥ä½œ', 'fa-tasks', `ä½ æ‰“ç®—è®© ${apprentice.name} å»åšä»€ä¹ˆï¼Ÿ`, options);
}

// ã€æ–°å¢ã€‘å¤„ç†æŒ‡æ´¾å·¥ä½œç»“æœçš„å‡½æ•°
function handleWorkAssignment(apprenticeId, workType) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    if (!apprentice) return;
    
    gameState.flags.actionUsed_apprentice = (gameState.flags.actionUsed_apprentice || 0) + 1;
    let resultText = '';
    
    switch(workType) {
        case 'assist':
            const profession = PROFESSION_DATA[gameState.career.path];
            if (profession && profession.core_resources.length > 0) {
                const resourceToBoost = getRandomElement(profession.core_resources);
                const boostAmount = getRandomInt(1, 3);
                gameState.career.core_resources[resourceToBoost] += boostAmount;
                resultText = `${apprentice.name} å¸®ä½ å¤„ç†å…¬åŠ¡ï¼Œä½ çš„ ${resourceToBoost} æå‡äº† ${boostAmount} ç‚¹ã€‚`;
            } else {
                resultText = `${apprentice.name} å¸®ä½ å¤„ç†äº†äº›æ‚äº‹ï¼Œè®©ä½ è½»æ¾ä¸å°‘ã€‚`;
            }
            break;
        case 'guild':
            if (Math.random() < 0.2) { // 20% å‡ ç‡æ‹¿å›ç‰©å“
                const good = getRandomElement(Object.values(TRADING_GOODS_DATA));
                // ç®€åŒ–å¤„ç†ï¼Œç›´æ¥ç»™é’±
                const profit = Math.floor(good.basePrice[0] * 0.5);
                applyEffects({ wealth: profit });
                resultText = `${apprentice.name} åœ¨å•†ä¼šå­¦åˆ°ä¸å°‘ï¼Œè¿˜ä¸ºä½ èµšå›äº† <span class="value">${profit}</span> ä¸¤ã€‚`;
            } else {
                const profit = getRandomInt(20, 50);
                applyEffects({ wealth: profit });
                resultText = `${apprentice.name} åœ¨å•†ä¼šå¸®å·¥ï¼Œä¸ºä½ èµšå› <span class="value">${profit}</span> ä¸¤ã€‚`;
            }
            break;
        case 'property':
             // åœ¨è¿™é‡Œå¯ä»¥è®¾ç½®ä¸€ä¸ª flagï¼Œåœ¨å¹´åº¦ç»“ç®—æ—¶ç»™ä¸åŠ æˆ
            gameState.flags.apprenticeManagedProperty = true;
            resultText = `ä½ æ´¾ ${apprentice.name} å»å·¡è§†ç”°äº§å’Œåº—é“ºï¼ŒTAå¹²å¾—ä¸é”™ï¼Œæƒ³å¿…ä»Šå¹´çš„æ”¶æˆä¼šæ›´å¥½ã€‚`;
            break;
    }
    
    showEventCard('å·¥ä½œæˆæœ', 'fa-briefcase', resultText);
}
function applyPassiveBonuses() {
    // æ£€æŸ¥åå¸ˆåŒ¾é¢
    if (gameState.inventory.some(item => item.id === 'ming_shi_bian_e')) {
        const reputationGain = 5 * gameState.inventory.filter(item => item.id === 'ming_shi_bian_e').length;
        applyEffects({ reputation: reputationGain });
        logEvent(`ä½ çš„<strong class="value">ã€åå¸ˆåŒ¾é¢ã€‘</strong>ä¸ºä½ å¸¦æ¥äº† ${reputationGain} ç‚¹å£°æœ›ã€‚`, true);
    }
}
// æ¯å›åˆæ›´æ–°å¾’å¼ŸçŠ¶æ€
// ã€å·²ä¿®å¤ã€‘æ›´æ–°å¾’å¼ŸçŠ¶æ€ (ä½¿ç”¨æ­£ç¡®çš„æˆé•¿ç‡)
function updateApprentices() {
    if (!gameState.apprentices || gameState.apprentices.length === 0) return;
    
    gameState.apprentices.forEach(apprentice => {
        if (apprentice.state !== 'graduated') {
            apprentice.age += 0.5;
            
            // ä½¿ç”¨æ­£ç¡®çš„æˆé•¿ç‡
            if (apprentice.growthRates) {
                for (const [attr, rate] of Object.entries(apprentice.growthRates)) {
                    const growth = Math.random() * rate;
                    apprentice.attributes[attr] = Math.min(100, (apprentice.attributes[attr] || 0) + growth);
                }
            }

            if (apprentice.state === 'working' && gameState.career.path) {
                const performanceGain = getRandomInt(3, 8);
                gameState.career.performance += performanceGain;
                logEvent(`å¾’å¼Ÿ <strong class="highlight-npc">${apprentice.name}</strong> ååŠ©ä½ å·¥ä½œï¼ŒåŠŸç»©+${performanceGain}ã€‚`);
            }
        }
    });
}

// åœ¨ç¤¾äº¤æ ‡ç­¾é¡µä¸­æ˜¾ç¤ºå¾’å¼Ÿ
function renderApprenticesInSocialTab() {
    if (!gameState.apprentices || gameState.apprentices.length === 0) return '';
    
    let html = `<div class="section-header"><i class="fas fa-user-graduate"></i> æˆ‘çš„å¾’å¼Ÿ</div>`;
    gameState.apprentices.forEach(apprentice => {
        html += renderApprenticeCard(apprentice);
    });
    
    return html;
}


// è§¦å‘å¸ˆå¾’è¯•ç‚¼
function triggerApprenticeTrial(apprenticeId, attribute) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    if (!apprentice) return;
    
    const trial = apprenticeTrials[attribute];
    if (!trial) return;
    
    let options = trial.options.map((option, index) => {
        let canAttempt = true;
        let costText = '';
        
        // æ£€æŸ¥é€‰é¡¹æˆæœ¬
        if (option.cost.action && gameState.flags.actionUsed_study) {
            canAttempt = false;
            costText += 'æœ¬å›åˆå·²è¿›è¡Œè¿‡ä¿®èº« ';
        }
        
        if (option.cost.wealth && gameState.finances.wealth < option.cost.wealth) {
            canAttempt = false;
            costText += `é“¶ä¸¤ä¸è¶³(${option.cost.wealth}) `;
        }
        
        return {
            htmlContent: `<span class="option-text"><strong>${option.text}</strong>
                ${costText ? `<br><small style="color:red;">${costText}</small>` : ''}
            </span>`,
            disabled: !canAttempt,
            callback: () => handleApprenticeTrial(apprentice.id, attribute, index)
        };
    });
    
    showDecisionCard(
        trial.title,
        'fa-graduation-cap',
        trial.desc,
        options
    );
}
// æ–°å¢å‡½æ•°ï¼šæ˜¾ç¤ºç¾è§‚çš„æ”¹åå¼¹çª—
// [æ–°å¢]
// æ–°å¢å‡½æ•°ï¼šæ˜¾ç¤ºç¾è§‚çš„æ”¹åå¼¹çª—
function showRenameChildOverlay(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    // å®‰å…¨åœ°è·å–å­©å­çš„å§“æ°å’Œæ—§åï¼ˆä¸å«å§“ï¼‰
    const oldGivenName = child.name ? child.name.slice(1) : 'æœªå‘½å';

    // å¡«å……å¼¹çª—å†…å®¹
    document.getElementById('renameChildOldName').textContent = child.name || 'è¿™ä¸ªå­©å­';
    document.getElementById('renameChildInput').value = oldGivenName === 'æœªå‘½å' ? '' : oldGivenName;

    // åŠ¨æ€è®¾ç½®ç¡®è®¤æŒ‰é’®çš„äº‹ä»¶
    const confirmBtn = document.getElementById('confirmRenameBtn');
    confirmBtn.onclick = () => {
        confirmNewName(childId);
    };

    // æ˜¾ç¤ºæ”¹åå¼¹çª—
    showOverlay('renameChildOverlay');
}

// [æ–°å¢]
// æ–°å¢å‡½æ•°ï¼šç¡®è®¤æ–°åå­—çš„é€»è¾‘
function confirmNewName(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    const newNameInput = document.getElementById('renameChildInput');
    let newGivenName = newNameInput.value.trim();

    if (newGivenName.length === 0) {
        const namePool = child.gender === 'female' ? nameData.girlNames : nameData.boyNames;
        newGivenName = getRandomElement(namePool);
        showToast("ä½ æœªç»™å­©å­å‘½åï¼Œä¾¿éšå£å–äº†ä¸€ä¸ªã€‚");
    }

    if (newGivenName.length > 3) {
        showToast("è¯·è¾“å…¥1-3ä¸ªå­—çš„æ–°åã€‚");
        return;
    }

    // [ä¿®å¤æ ¸å¿ƒ] ç¡®ä¿æ€»èƒ½æ‰¾åˆ°æ­£ç¡®çš„å§“æ°
    let surname = '';
    // ä¼˜å…ˆä½¿ç”¨åˆæ³•çˆ¶äº²çš„å§“
    const legalFather = child.fatherId ? (gameState.npcs[child.fatherId] || (child.fatherId === 'player' ? gameState.player : null)) : null;
    if (legalFather && legalFather.name) {
        surname = legalFather.name.slice(0, 1);
    } 
    // å…¶æ¬¡ä½¿ç”¨å­©å­è‡ªå·±å·²æœ‰çš„å§“ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
    else if (child.name) {
        surname = child.name.slice(0, 1);
    } 
    // æœ€åä½¿ç”¨ç©å®¶çš„å§“ä½œä¸ºå¤‡ç”¨
    else {
        surname = gameState.player.name.slice(0, 1);
    }

    const finalName = surname + newGivenName;

    if (gameState.flags.allNames.has(finalName) && finalName !== child.name) {
        showToast("è¿™ä¸ªåå­—å·²ç»æœ‰äººç”¨å•¦ï¼Œæ¢ä¸€ä¸ªå§ã€‚");
        return;
    }

    if (child.name) {
        gameState.flags.allNames.delete(child.name);
    }

    const oldName = child.name || "è¿™ä¸ªå­©å­";
    child.name = finalName;
    gameState.flags.allNames.add(finalName);

    showEventCard('æ”¹åæˆåŠŸ', 'fa-pen-fancy', `ä½ å°† <strong class="value">${oldName}</strong> çš„åå­—æ”¹ä¸ºäº† <strong class="value">${finalName}</strong>ã€‚`);

    closeAllOverlays();
    renderGame();
}
// å¤„ç†å¸ˆå¾’è¯•ç‚¼ç»“æœ
// ===================== ã€ä¿®å¤äºŒï¼šè¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢æ‚¨çš„ handleApprenticeTrial å‡½æ•°ã€‘ =====================
function handleApprenticeTrial(apprenticeId, attribute, optionIndex) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    const trial = apprenticeTrials[attribute];
    const option = trial.options[optionIndex];
    
    if (!apprentice || !trial || !option) return;
    
    // æ”¯ä»˜æˆæœ¬
    if (option.cost.action) {
        gameState.flags.actionUsed_study = true;
    }
    
    if (option.cost.wealth) {
        applyEffects({ wealth: -option.cost.wealth });
    }
    
    // åˆ¤æ–­æˆåŠŸä¸å¦
    const success = Math.random() <= option.successRate;
    let resultText = '';
    
    if (success) {
        // åº”ç”¨æˆåŠŸæ•ˆæœ
        if (option.effect.apprentice) {
            if (option.effect.apprentice.attributes) {
                for (const [attr, value] of Object.entries(option.effect.apprentice.attributes)) {
                    apprentice.attributes[attr] = Math.min(100, (apprentice.attributes[attr] || 0) + value);
                }
            }
        }
        
        if (option.effect.master) {
            if (option.effect.master.attributes) {
                applyEffects({ attributes: option.effect.master.attributes });
            }
        }
        
        if (option.effect.favor) {
            apprentice.favor = Math.min(100, apprentice.favor + option.effect.favor);
        }
        
        if (option.effect.reward) {
            if (option.effect.reward.wealth) {
                applyEffects({ wealth: option.effect.reward.wealth });
            }
            
            if (option.effect.reward.reputation) {
                applyEffects({ reputation: option.effect.reward.reputation });
            }
        }
        
        resultText = `è¯•ç‚¼æˆåŠŸï¼`;
    } else {
        // åº”ç”¨å¤±è´¥æ•ˆæœ
        if (option.failureEffect) {
            if (option.failureEffect.apprentice) {
                if (option.failureEffect.apprentice.attributes) {
                    for (const [attr, value] of Object.entries(option.failureEffect.apprentice.attributes)) {
                        apprentice.attributes[attr] = Math.max(0, (apprentice.attributes[attr] || 0) + value);
                    }
                }
                
                if (option.failureEffect.apprentice.growthRate) {
                    for (const [attr, value] of Object.entries(option.failureEffect.apprentice.growthRate)) {
                        apprentice.growthRates[attr] = Math.max(0, (apprentice.growthRates[attr] || 0) + value);
                    }
                }
            }
            
            if (option.failureEffect.favor) {
                apprentice.favor = Math.max(0, apprentice.favor + option.failureEffect.favor);
            }
        }
        
        resultText = `è¯•ç‚¼å¤±è´¥ï¼`;
    }
    
    // â–¼â–¼â–¼ æ ¸å¿ƒä¿®å¤ â–¼â–¼â–¼
    const resultLog = `
        <p>${resultText}</p>
        <p>å¾’å¼Ÿ <strong class="value">${apprentice.name}</strong> çš„${ATTR_MAP[attribute]} ${success ? 'æå‡' : 'ä¸‹é™'}äº†ã€‚</p>
    `;
    eventQueue.unshift(() => {
        showEventCard('å¸ˆå¾’è¯•ç‚¼', 'fa-graduation-cap', resultLog);
    });
    closeAllOverlays();
    // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
}
// æ£€æŸ¥å¹¶è§¦å‘å¾’å¼Ÿç¤¾äº¤äº‹ä»¶
// ä¿®æ”¹åçš„ checkForApprenticeSocialEvents å‡½æ•°
// ã€ä¿®æ”¹ä¸ºä»¥ä¸‹ä»£ç ã€‘
// æ‰¾åˆ° checkForApprenticeSocialEvents å‡½æ•°
// æ‰¾åˆ° checkForApprenticeSocialEvents å‡½æ•° (å¤§çº¦ 6980è¡Œ)
// å°†å…¶æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function checkForApprenticeSocialEvents() {
    const activeApprentices = gameState.apprentices.filter(a => a.state === 'learning');
    if (activeApprentices.length === 0) return;
    if (Math.random() < 0.2) {
        const randomApprentice = getRandomElement(activeApprentices);
        const event = getRandomElement(apprenticeSpecialEvents);
        
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†äº‹ä»¶å­˜å…¥ social ä»“åº“
        addUiEvent('social', () => {
            let eventDesc = event.desc.replace('ä½ çš„å¾’å¼Ÿ', `ä½ çš„å¾’å¼Ÿ <strong class="value">${randomApprentice.name}</strong>`);
            let optionsHTML = event.options.map(option => {
                return {
                    htmlContent: `<span class="option-text">${option.text}</span>`,
                    callback: () => handleApprenticeSocialEvent(randomApprentice.id, event, option)
                };
            });
            showDecisionCard(event.title, 'fa-users', eventDesc, optionsHTML);
        });
    }
}
function triggerApprenticeSocialEvent(apprenticeId, event) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    if (!apprentice) return;
    
    let options = event.options.map((option, index) => {
        return {
            htmlContent: `<span class="option-text">${option.text}</span>`,
            callback: () => handleApprenticeSocialEvent(apprentice.id, event, option)
        };
    });
    
    showDecisionCard(
        event.title,
        'fa-users',
        event.desc,
        options
    );
}

// å¤„ç†å¾’å¼Ÿç¤¾äº¤äº‹ä»¶
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€ä¿®å¤ä¸‰ï¼šè¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢æ‚¨çš„ handleApprenticeSocialEvent å‡½æ•°ã€‘ =====================
function handleApprenticeSocialEvent(apprenticeId, event, option) {
    const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
    if (!apprentice) return;

    let favorChange = 0;
    let attributeChanges = [];
    
    // åº”ç”¨æ•ˆæœ
    if (option.effect) {
        if (option.effect.favor) {
            favorChange = option.effect.favor;
            apprentice.favor = Math.min(100, Math.max(0, apprentice.favor + favorChange));
        }
        if (option.effect.apprentice && option.effect.apprentice.attributes) {
            for (const [attr, value] of Object.entries(option.effect.apprentice.attributes)) {
                apprentice.attributes[attr] = Math.min(200, Math.max(0, (apprentice.attributes[attr] || 0) + value));
                attributeChanges.push(`${ATTR_MAP[attr]} +${value}`);
            }
        }
        if (option.effect.master && option.effect.master.attributes) {
            applyEffects({ attributes: option.effect.master.attributes });
        }
    }
    
    // ç”Ÿæˆæ›´è¯¦ç»†çš„åé¦ˆæ–‡æœ¬
    let resultText = `<p>${option.result_text}</p><hr style="margin: 10px 0;">`;
    if (attributeChanges.length > 0) {
        resultText += `<p><strong>${apprentice.name}:</strong> ${attributeChanges.join('ï¼Œ')}ã€‚</p>`;
    }
    if (favorChange > 0) {
        resultText += `<p>TAå¯¹ä½ çš„å¥½æ„Ÿæå‡äº† ${favorChange} ç‚¹ã€‚</p>`;
    } else if (favorChange < 0) {
        resultText += `<p class="comment">ä½ çš„å†³å®šä¼¼ä¹è®©TAæœ‰äº›å¤±è½ï¼Œå¥½æ„Ÿåº¦é™ä½äº† ${Math.abs(favorChange)} ç‚¹ã€‚</p>`;
    }

    // â–¼â–¼â–¼ æ ¸å¿ƒä¿®å¤ â–¼â–¼â–¼
    eventQueue.unshift(() => {
        showEventCard(event.title, 'fa-users', resultText);
    });
    closeAllOverlays();
    // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
}
// =======================================================================
// ===================== [æ–°å¢] æš—ä¸­è°ƒæŸ¥äº‹ä»¶åº“ ===========================
// =======================================================================
// ===================== ã€è¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢ã€‘ =====================
const INVESTIGATION_EVENTS = [
    // --- 6ä¸ªæ­£é¢äº‹ä»¶ ---
    {
        type: 'positive',
        title: 'ä»å¿ƒå–„ä¸¾',
        desc: 'ä½ çš„çœ¼çº¿å›æŠ¥ï¼Œæ›¾è§ã€å¯¹è±¡å§“åã€‘åœ¨æµä¸–å ‚å‰ä¸ºæµæ°‘æ–½ç²¥ï¼ŒåŸä¸­ç™¾å§“æ— ä¸ç§°èµå…¶ä»å–„ä¹‹å¿ƒã€‚',
        effect_text: 'ä½ å¯¹TAçš„å“å¾·é¢‡ä¸ºæ¬£èµã€‚'
    },
    {
        type: 'positive',
        title: 'æ‰æƒ…å‡ºä¼—',
        desc: 'æ¢å­æ¥æŠ¥ï¼Œã€å¯¹è±¡å§“åã€‘è¿‘æ—¥åœ¨å…°äº­é›…é›†ä¸Šæ‹”å¾—å¤´ç­¹ï¼Œä¸€é¦–ä¸ƒè¨€ç»å¥å¼•å¾—æ»¡å ‚å–å½©ï¼Œè¢«èª‰ä¸ºâ€œäº¬åŸç¬¬ä¸€æ‰å­/æ‰å¥³â€ã€‚',
        effect_text: 'å¦‚æ­¤æ‰åï¼Œä¸ä½ çš„å­©å„¿æ­£æ˜¯ç»é…ã€‚'
    },
    {
        type: 'positive',
        title: 'å®¶é£æ¸…æ­£',
        desc: 'ç»è¿‡å¤šæ–¹æ‰“æ¢ï¼Œä½ äº†è§£åˆ°ã€å¯¹è±¡å§“åã€‘å®¶ä¸­é•¿è¾ˆçš†æ˜¯å“è¡Œç«¯æ­£ä¹‹äººï¼Œå®¶é£æ¸…å»‰ï¼Œåœ¨æœä¸­å£ç¢‘ç”šå¥½ã€‚',
        effect_text: 'ä¸è¿™æ ·çš„å®¶æ—ç»“äº²ï¼Œå¯¹ä½ å®¶å¤§æœ‰è£¨ç›Šã€‚'
    },
    {
        type: 'positive',
        title: 'ä»—ä¹‰ç–è´¢',
        desc: 'ä½ çš„äººå‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘æ›¾ä¸ºä¸€ä½è½éš¾çš„åŒä¹¡å€¾å›Šç›¸åŠ©ï¼ŒåŠ©å…¶æ¸¡è¿‡éš¾å…³ï¼Œä¸ºäººååˆ†ä»—ä¹‰ã€‚',
        effect_text: 'ä½ è®¤ä¸ºæ­¤äººé‡æƒ…é‡ä¹‰ï¼Œå€¼å¾—æ‰˜ä»˜ã€‚'
    },
    {
        type: 'positive',
        title: 'éšè—äº§ä¸š',
        desc: 'è°ƒæŸ¥å‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘è¡¨é¢ä¸Šåªæ˜¯æ™®é€šå®˜å®¦å­å¼Ÿï¼Œå®åˆ™åœ¨æ±Ÿå—è¿˜ç»è¥ç€æ•°å®¶ç»¸ç¼åº„ï¼Œè´¢åŠ›è¿œè¶…å¤–äººæ‰€æƒ³ã€‚',
        effect_text: 'è¿™é—¨äº²äº‹ï¼ŒçœŸæ˜¯é”¦ä¸Šæ·»èŠ±ã€‚'
    },
    {
        type: 'positive',
        title: 'æ­¦è‰ºé«˜å¼º',
        desc: 'ä½ çš„æŠ¤é™¢åœ¨ä¸åŸä¸­æ­¦å¸ˆåˆ‡ç£‹æ—¶ï¼Œå¬é—»ã€å¯¹è±¡å§“åã€‘æ›¾ä¸€äººä¸€å‰‘æŒ‘äº†é»‘é£å¯¨ï¼Œæ˜¯ä½æ·±è—ä¸éœ²çš„æ­¦æ—é«˜æ‰‹ã€‚',
        effect_text: 'æ–‡æ­¦åŒå…¨ï¼Œå®ä¹ƒè‰¯é…ã€‚'
    },
    // --- 9ä¸ªè´Ÿé¢/æŠ“é©¬äº‹ä»¶ ---
    {
        type: 'negative',
        title: 'å·²æœ‰å¿ƒä¸Šäºº',
        desc: 'ä½ çš„çœ¼çº¿å‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘ä¼¼ä¹ä¸å¦ä¸€ä½é—¨å½“æˆ·å¯¹çš„å¼‚æ€§å¾€æ¥ç”šå¯†ï¼Œä¸¤äººé’æ¢…ç«¹é©¬ï¼Œæƒ…æŠ•æ„åˆã€‚',
        options: [
            { text: 'ã€å‘ŠçŸ¥å­©å„¿ï¼Œæ”¾å¼ƒæ­¤äººã€‘', log: 'ä½ çš„å­©å­è™½ç„¶å¤±è½ï¼Œä½†ä¹Ÿæ„Ÿè°¢ä½ é¿å…äº†ä¸€æ®µæ— æœçš„æ„Ÿæƒ…ã€‚' },
            { text: 'ã€å¼ºè¡Œæäº²ï¼Œæ¨ªåˆ€å¤ºçˆ±ã€‘', log: 'ä½ å†³å®šåˆ©ç”¨å®¶æ—æƒåŠ¿å¼ºè¡Œä¿ƒæˆè¿™é—¨å©šäº‹ï¼Œä½†è¿™çœŸçš„ä¼šå¹¸ç¦å—ï¼Ÿ' }
        ]
    },
    {
        type: 'negative',
        title: 'æœªå©šå…ˆå­•/å·²æœ‰ç§ç”Ÿå­',
        desc: 'ä¸€ä¸ªæƒŠå¤©ç§˜å¯†è¢«ä½ å‘ç°ï¼šã€å¯¹è±¡å§“åã€‘åœ¨ä¹¡ä¸‹ç«Ÿæœ‰ä¸€ä¸ªå°šæœªå…¬å¼€çš„ç§ç”Ÿå­/å¥³ï¼',
        options: [
            { text: 'ã€ä»¥æ­¤ä¸ºæŠŠæŸ„ï¼Œå‹ä½è˜ç¤¼/å«å¦†ã€‘', log: 'å¯¹æ–¹å®¶æ—ä¸ºé®æ©ä¸‘é—»ï¼ŒåŒæ„äº†ä½ çš„æ— ç†è¦æ±‚ã€‚' },
            { text: 'ã€æ–­ç„¶æ‹’å©šã€‘', log: 'ä½ æ— æ³•æ¥å—æ­¤äº‹ï¼Œç«‹å³ä¸­æ–­äº†è®®äº²ã€‚' }
        ]
    },
    {
        type: 'negative',
        title: 'æ€§æ ¼æš´èº',
        desc: 'ä½ ä¹°é€šäº†å¯¹æ–¹åºœä¸Šçš„ä¸€ä¸ªä¸‹äººï¼Œå¾—çŸ¥ã€å¯¹è±¡å§“åã€‘ç§ä¸‹é‡Œæ€§æ ¼æš´èºï¼Œç¨æœ‰ä¸é¡ºä¾¿ä¼šå¯¹ä¸‹äººæ‹³æ‰“è„šè¸¢ã€‚',
        effect_text: 'æ­¤äººè¡¨é‡Œä¸ä¸€ï¼Œç»éè‰¯é…ï¼'
    },
    {
        type: 'negative',
        title: 'èº«æœ‰éšç–¾',
        desc: 'ä½ èŠ±é‡é‡‘ä»å¤ªåŒ»é™¢çš„æ•…äººå¤„å¾—çŸ¥ï¼Œã€å¯¹è±¡å§“åã€‘èº«æ‚£é—ä¼ éšç–¾ï¼Œææœ‰ç¢å­å—£ã€‚',
        options: [
            { text: 'ã€ä¸ºäº†è”å§»ï¼Œéšç’æ­¤äº‹ã€‘', log: 'ä½ é€‰æ‹©äº†å®¶æ—åˆ©ç›Šï¼Œä½†æ­¤äº‹æœªæ¥å¯èƒ½ä¼šæˆä¸ºå·¨å¤§çš„éšæ‚£ã€‚' },
            { text: 'ã€å‘ŠçŸ¥å­©å„¿ï¼Œç”±å…¶å®šå¤ºã€‘', log: 'ä½ å°†å†³å®šæƒäº¤ç»™äº†å­©å­ï¼Œæ— è®ºç»“æœå¦‚ä½•ï¼Œä½ ä»¬çš„äº²æƒ…éƒ½æ›´æ·±äº†ã€‚' }
        ]
    },
    {
        type: 'negative',
        title: 'å®¶æœ‰å·¨é¢å€ºåŠ¡',
        desc: 'è°ƒæŸ¥å‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘çš„å®¶æ—è¡¨é¢é£å…‰ï¼Œå®åˆ™æ—©å·²è¢«æç©ºï¼Œåœ¨å¤–æ¬ ä¸‹å·¨é¢å€ºåŠ¡ï¼Œæ­£æŒ‡æœ›é è”å§»æ¥å¡«è¡¥çªŸçª¿ã€‚',
        effect_text: 'ä½ è¯†ç ´äº†å¯¹æ–¹çš„å›¾è°‹ï¼Œåº†å¹¸æ²¡æœ‰æ‰å…¥é™·é˜±ã€‚'
    },
    {
        type: 'negative',
        title: 'é£æµæˆæ€§',
        desc: 'ä½ çš„çœ¼çº¿å›æŠ¥ï¼Œã€å¯¹è±¡å§“åã€‘æ˜¯é£æœˆé‰´çš„å¸¸å®¢ï¼Œä¸å¤šä½çº¢å°˜å¥³å­å…³ç³»åŒªæµ…ï¼Œåå£°ä¸ä½³ã€‚',
        effect_text: 'æ­¤ç­‰æµªè¡ä¹‹äººï¼Œæ€èƒ½æ‰˜ä»˜ç»ˆèº«ï¼'
    },
    {
        type: 'negative',
        title: 'æ–­è¢–ä¹‹ç™–/ç£¨é•œä¹‹å¥½',
        desc: 'ä¸€ä¸ªç»å¯¹çš„ç§˜å¯†è¢«ä½ å‘ç°ï¼šã€å¯¹è±¡å§“åã€‘å¯¹å¼‚æ€§æ¯«æ— å…´è¶£ï¼Œå…¶çœŸå®å–œå¥½ä¸ä¸–ä¿—ç›¸æ‚–ã€‚',
        effect_text: 'ä½ éœ‡æƒŠä¸å·²ï¼Œä¸ºäº†å­©å­çš„å¹¸ç¦ï¼Œè¿™é—¨äº²äº‹ç»ä¸èƒ½æˆã€‚'
    },
    {
        type: 'negative',
        title: 'å®ä¸ºåº¶å‡º',
        desc: 'ä½ å‘ç°ã€å¯¹è±¡å§“åã€‘å¯¹å¤–å®£ç§°æ˜¯å«¡å‡ºï¼Œå®åˆ™æ˜¯è¢«æ‰¶æ­£çš„åº¶å­/åº¶å¥³ï¼Œå…¶åœ°ä½å¹¶ä¸ç¨³å›ºã€‚',
        effect_text: 'è¿™é—¨äº²äº‹çš„ä»·å€¼ï¼Œéœ€è¦é‡æ–°è¯„ä¼°äº†ã€‚'
    },
    {
        type: 'negative',
        title: 'ä¸é•¿è¾ˆä¸ç¦',
        desc: 'ä½ äº†è§£åˆ°ï¼Œã€å¯¹è±¡å§“åã€‘ä¸å®¶ä¸­é•¿è¾ˆå…³ç³»æä¸ºç´§å¼ ï¼Œè¢«è®¤ä¸ºâ€œä¸å­â€ï¼Œåœ¨æ—ä¸­é¥±å—æ’æŒ¤ã€‚',
        effect_text: 'ä¸€ä¸ªè¿è‡ªå·±é•¿è¾ˆéƒ½æ— æ³•å’Œç¦ç›¸å¤„çš„äººï¼Œæƒ³å¿…ä¹Ÿéš¾ä»¥ç»´ç³»å¥½ä½ ä»¬çš„å§»äº²å…³ç³»ã€‚'
    },
    // â–¼â–¼â–¼ æ–°å¢çš„20ä¸ªäº‹ä»¶ â–¼â–¼â–¼
    {
        type: 'positive',
        title: 'å­é¡ºå¤‡è‡³',
        desc: 'çœ¼çº¿å›æŠ¥ï¼Œæ›¾äº²çœ¼è§åˆ°ã€å¯¹è±¡å§“åã€‘åœ¨åºŠå‰ä¸ºå…¶ä¹…ç—…çš„æ¯äº²/çˆ¶äº²å–‚è¯ï¼Œæ¯«æ— æ€¨è¨€ï¼Œååˆ†å­é¡ºã€‚',
        effect_text: 'ç™¾å–„å­ä¸ºå…ˆï¼Œæ­¤äººå“æ€§çº¯è‰¯ï¼Œå€¼å¾—ä¿¡èµ–ã€‚'
    },
    {
        type: 'positive',
        title: 'ä½“æ¤ä¸‹äºº',
        desc: 'ä½ çš„äººæ‰“å¬åˆ°ï¼Œã€å¯¹è±¡å§“åã€‘å¯¹å¾…ä¸‹äººå®½åšï¼Œä»æœªæœ‰è¿‡è‹›è´£ï¼Œåºœå†…ä»†å½¹æ— ä¸ç§°èµã€‚',
        effect_text: 'èƒ½ä½“æ¤å¼±å°ï¼Œå¯è§å…¶å¿ƒèƒ¸å®½å¹¿ã€‚'
    },
    {
        type: 'positive',
        title: 'å‹¤å¥‹å¥½å­¦',
        desc: 'æ®å›½å­ç›‘çš„åŒçª—æ‰€è¨€ï¼Œã€å¯¹è±¡å§“åã€‘æ¯æ—¥è‹¦è¯»è‡³æ·±å¤œï¼Œå­¦é—®æ‰å®ï¼Œæ˜¯åŒè¾ˆä¸­çš„ç¿˜æ¥šã€‚',
        effect_text: 'å‹¤å¥‹ä¹‹äººï¼Œæœªæ¥å¯æœŸã€‚'
    },
    {
        type: 'positive',
        title: 'ç†è´¢æœ‰é“',
        desc: 'è°ƒæŸ¥å‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘ä¸ä»…å°†è‡ªå·±çš„ä»½ä¾‹æ‰“ç†å¾—äº•äº•æœ‰æ¡ï¼Œç”šè‡³è¿˜ç”¨ä½™é’±åšäº†äº›å°ç”Ÿæ„ï¼Œé¢‡æœ‰æ”¶ç›Šã€‚',
        effect_text: 'æ­¤äººç²¾æ‰“ç»†ç®—ï¼Œæœ‰æŒå®¶ä¹‹èƒ½ã€‚'
    },
    {
        type: 'positive',
        title: 'äººç¼˜æä½³',
        desc: 'åœ¨ä¸ã€å¯¹è±¡å§“åã€‘çš„å‹äººäº¤è°ˆæ—¶ï¼Œä»–ä»¬æ— ä¸ç§°èµå…¶ä¸ºäººå¯é ï¼Œå€¼å¾—æ·±äº¤ã€‚',
        effect_text: 'èƒ½å¾—ä¼—äººä¿¡èµ–ï¼Œå¯è§å…¶äººå“ä¸ä¿—ã€‚'
    },
    {
        type: 'positive',
        title: 'å¿—å‘è¿œå¤§',
        desc: 'ä½ æ— æ„ä¸­å¾—åˆ°äº†ä¸€ä»½ã€å¯¹è±¡å§“åã€‘æ—©å¹´çš„æ–‡ç« ï¼Œæ–‡ä¸­å±•ç°å‡ºçš„æŠ±è´Ÿä¸è§è¯†è¿œè¶…å¸¸äººã€‚',
        effect_text: 'æ­¤äººèƒ¸æœ‰ä¸˜å£‘ï¼Œéæ± ä¸­ä¹‹ç‰©ã€‚'
    },
    {
        type: 'positive',
        title: 'ç²¾é€šéŸ³å¾‹',
        desc: 'ã€å¯¹è±¡å§“åã€‘çš„ä¸€æ›²ç´éŸ³/ç®«å£°åœ¨äº¬ä¸­é¢‡æœ‰åæ°”ï¼Œæ®è¯´æœ‰ç»•æ¢ä¸‰æ—¥ä¹‹æ•ˆã€‚',
        effect_text: 'ç²¾é€šé›…äº‹ï¼Œæƒ³å¿…ç”Ÿæ´»ä¸ä¼šæ¯ç‡¥ã€‚'
    },
    {
        type: 'positive',
        title: 'å¨è‰ºç²¾æ¹›',
        desc: 'ä½ å¬è¯´ã€å¯¹è±¡å§“åã€‘äº²æ‰‹åšçš„æ¡‚èŠ±ç³•ï¼Œè¿å¾¡å¨éƒ½è‡ªæ„§ä¸å¦‚ã€‚',
        effect_text: 'æ‡‚å¾—ç”Ÿæ´»æƒ…è¶£ï¼Œæ˜¯ä¸ªåŠ åˆ†é¡¹ã€‚'
    },
    {
        type: 'positive',
        title: 'æœ‰æ•‘å‘½ä¹‹æ©',
        desc: 'ä½ æ„å¤–å¾—çŸ¥ï¼Œã€å¯¹è±¡å§“åã€‘æ›¾åœ¨å†°æ¹–ä¸­æ•‘èµ·è¿‡ä¸€åå¤±è¶³è½æ°´çš„å­©ç«¥ï¼Œå´ä»æœªå‘äººæåŠã€‚',
        effect_text: 'æœ‰æ­¤ç­‰ä»å‹‡ä¹‹å¿ƒï¼Œå®ä¹ƒå¤§å–„ã€‚'
    },
    {
        type: 'positive',
        title: 'æ·±å—å™¨é‡',
        desc: 'æ¢å­å›æŠ¥ï¼Œã€å¯¹è±¡å§“åã€‘æ·±å—å…¶ä¸Šå¸/è€å¸ˆçš„å™¨é‡ï¼Œè¢«è®¤ä¸ºæ˜¯æœªæ¥çš„æ¥ç­äººã€‚',
        effect_text: 'å‰é€”å…‰æ˜ï¼Œæ˜¯ä¸€é—¨ä¸é”™çš„äº²äº‹ã€‚'
    },
    {
        type: 'negative',
        title: 'æ²‰è¿·èµŒåš',
        desc: 'ä½ çš„çœ¼çº¿å›æŠ¥ï¼Œã€å¯¹è±¡å§“åã€‘æ˜¯åŸå—èµŒåŠçš„å¸¸å®¢ï¼Œä¼¼ä¹è¿˜æ¬ ä¸‹äº†ä¸€ç¬”ä¸å°çš„èµŒå€ºã€‚',
        options: [
            { text: 'ã€å‘Šè¯«å­©å„¿ï¼Œè¿œç¦»æ­¤äººã€‘', log: 'ä½ å†³å®šä¸ºäº†å­©å­çš„æœªæ¥ï¼Œç«‹å³ä¸­æ­¢è¿™é—¨è®®äº²ã€‚' },
            { text: 'ã€ä»¥æ­¤è¦æŒŸï¼Œå›¾è°‹æ›´å¤šã€‘', log: 'ä½ å†³å®šå°†æ­¤ä½œä¸ºè°ˆåˆ¤çš„ç­¹ç ï¼Œä¸ºè‡ªå·±çš„å®¶æ—è°‹å–æ›´å¤§åˆ©ç›Šã€‚' }
        ]
    },
    {
        type: 'negative',
        title: 'æ°”é‡ç‹­å°',
        desc: 'ä»ä¸€ä½æ›¾ä¸ã€å¯¹è±¡å§“åã€‘æœ‰è¿‡èŠ‚çš„äººå£ä¸­å¾—çŸ¥ï¼Œæ­¤äººçšçœ¦å¿…æŠ¥ï¼Œæ°”é‡æä¸ºç‹­å°ã€‚',
        effect_text: 'ä¸æ­¤ç­‰å¿ƒèƒ¸ç‹­éš˜ä¹‹äººç»“äº²ï¼Œæå®¶å®…ä¸å®ã€‚'
    },
    {
        type: 'negative',
        title: 'æ—©å·²è®¢äº²',
        desc: 'è°ƒæŸ¥å‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘åœ¨å®¶ä¹¡æ—©æœ‰ä¸€ä½æŒ‡è…¹ä¸ºå©šçš„æœªå©šå¤«/å¦»ï¼Œåªæ˜¯å°šæœªå…¬å¼€ã€‚',
        options: [
            { text: 'ã€è´¨é—®å¯¹æ–¹å®¶æ—ã€‘', log: 'ä½ å‰å»è´¨é—®ï¼Œå¯¹æ–¹å®¶æ—ç†äºï¼Œåªå¾—è¿è¿é“æ­‰ã€‚' },
            { text: 'ã€ä½œç½¢ï¼Œå¦å¯»è‰¯ç¼˜ã€‘', log: 'ä½ å†³å®šä¸å†ä¸æ­¤ç­‰æ— ä¿¡ä¹‰ä¹‹å®¶æ¥å¾€ã€‚' }
        ]
    },
    {
        type: 'negative',
        title: 'è¿·ä¿¡é¬¼ç¥',
        desc: 'ä½ å‘ç°ã€å¯¹è±¡å§“åã€‘èŠ±è´¹å¤§é‡é‡‘é’±ä¾›å¥‰ä¸€ä½æ¥è·¯ä¸æ˜çš„â€œæ´»ç¥ä»™â€ï¼Œè¨€è¡Œé¢‡ä¸ºç—´è¿·ã€‚',
        effect_text: 'è¿‡äºè¿·ä¿¡ï¼Œæéç†æ™ºä¹‹äººã€‚'
    },
    {
        type: 'negative',
        title: 'çˆ¶æ¯ä¸ç¦',
        desc: 'ä½ äº†è§£åˆ°ï¼Œã€å¯¹è±¡å§“åã€‘çš„çˆ¶æ¯å…³ç³»æ¶åŠ£ï¼Œå¸¸å¹´äº‰åµï¼Œå®¶åº­æ°›å›´å‹æŠ‘ã€‚',
        effect_text: 'åœ¨è¿™æ ·çš„ç¯å¢ƒä¸‹æˆé•¿ï¼Œå…¶æ€§æ ¼ææ€•ä¼šæœ‰äº›ç¼ºé™·ã€‚'
    },
    {
        type: 'negative',
        title: 'æœ‰ç›—çªƒå‰ç§‘',
        desc: 'ä¸€ä¸ªæ„å¤–çš„å‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘å¹´å°‘æ—¶æ›¾å› æ‰‹è„šä¸å¹²å‡€è¢«é€å®˜ç©¶åŠè¿‡ï¼Œåªæ˜¯åæ¥è¢«å®¶æ—å‹äº†ä¸‹å»ã€‚',
        effect_text: 'å“è¡Œä¸ç«¯ï¼Œæ­¤ä¹ƒå¤§å¿Œï¼'
    },
    {
        type: 'negative',
        title: 'è™å¾…åŠ¨ç‰©',
        desc: 'ä½ çš„çœ¼çº¿äº²çœ¼ç›®ç¹ã€å¯¹è±¡å§“åã€‘å°†ä¸€åªæŒ¡è·¯çš„å°çŒ«è¸¢å‡ºæ•°ä¸ˆä¹‹è¿œï¼Œè„¸ä¸Šæ¯«æ— æ€œæ‚¯ä¹‹è‰²ã€‚',
        effect_text: 'å¯¹å¼±å°ç”Ÿçµå°šä¸”å¦‚æ­¤æ®‹å¿ï¼Œå…¶å¿ƒå¯çŸ¥ï¼'
    },
    {
        type: 'negative',
        title: 'æœ‰ä½“è‡­ä¹‹ç–¾',
        desc: 'ä½ ä¹°é€šçš„ä¸‹äººæ‚„æ‚„å‘Šè¯‰ä½ ï¼Œã€å¯¹è±¡å§“åã€‘èº«ä¸Šæœ‰ä¸€è‚¡éš¾ä»¥è¨€å–»çš„å¼‚å‘³ï¼Œéœ€ç”¨é‡é¦™æ‰èƒ½é®ç›–ã€‚',
        options: [
            { text: 'ã€å‘ŠçŸ¥å­©å„¿ï¼Œç”±å…¶å®šå¤ºã€‘', log: 'ä½ å°†æ­¤äº‹å‘ŠçŸ¥äº†å­©å­ï¼Œè®©TAè‡ªå·±å†³å®šæ˜¯å¦èƒ½æ¥å—ã€‚' },
            { text: 'ã€è®¤ä¸ºæ— ä¼¤å¤§é›…ã€‘', log: 'ä½ è§‰å¾—æ­¤äº‹å¹¶éå“è¡Œé—®é¢˜ï¼Œå†³å®šç»§ç»­è®®äº²ã€‚' }
        ]
    },
    {
        type: 'negative',
        title: 'èº«è´Ÿå‘½æ¡ˆ',
        desc: 'ä½ é€šè¿‡ç»å¯†æ¸ é“å¾—çŸ¥ï¼Œã€å¯¹è±¡å§“åã€‘æ›¾å¤±æ‰‹ä¼¤äººè‡´æ­»ï¼Œåç”±å®¶æ—å‡ºé¢ï¼Œç”¨é’±è´¢å’ŒæƒåŠ¿å°†æ­¤äº‹å‹ä¸‹ã€‚',
        effect_text: 'æ­¤äº‹å…³ç³»é‡å¤§ï¼Œä¸æ­¤äººç»“äº²æ— å¼‚äºä¸è™è°‹çš®ï¼'
    },
    {
        type: 'negative',
        title: 'ç¤¾äº¤å­¤ç«‹',
        desc: 'è°ƒæŸ¥å‘ç°ï¼Œã€å¯¹è±¡å§“åã€‘åœ¨åŒé¾„äººä¸­å‡ ä¹æ²¡æœ‰æœ‹å‹ï¼Œä¸ºäººå­¤åƒ»ï¼Œéš¾ä»¥ç›¸å¤„ã€‚',
        effect_text: 'æ­¤äººæ€§æ ¼å¦‚æ­¤ï¼Œå©šåææ€•éš¾ä»¥ä¸ä½ çš„å­©å­å’Œè°å…±å¤„ã€‚'
    }
];
// ===================== ã€æ–°å¢ã€‘è¡ŒåŠ¨ç‚¹è®¡æ•°å™¨å‡½æ•° END =====================
// =======================================================================
// ========================= UTILITY FUNCTIONS ===========================
// =======================================================================
// ===================== ã€æ–°åŠŸèƒ½ä»£ç ã€‘å­å¥³åŸ¹å…»ä¸å©šå«æ•°æ® START ======================

const CHILD_CULTIVATION_STAGES = {
    // 0-5å² å¯è’™æœŸ
    infancy: {
        male: [
            { id: 'play_infant', name: 'é™ªä¼´ç©è€', desc: '+é­…åŠ›, +äº²å­å…³ç³»', effects: { charm: 0.5, favor: 2 } },
            { id: 'care_infant', name: 'æ‚‰å¿ƒç…§æ–™', desc: '+å¥åº·, +äº²å­å…³ç³»', effects: { health: 1, favor: 2 } },
        ],
        female: [
            { id: 'play_infant', name: 'é™ªä¼´ç©è€', desc: '+é­…åŠ›, +äº²å­å…³ç³»', effects: { charm: 0.5, favor: 2 } },
            { id: 'sing_infant', name: 'è½»å£°å“¼å”±', desc: '+æ‰æƒ…, +äº²å­å…³ç³»', effects: { talent: 0.5, favor: 2 } },
        ]
    },
    // 6-15å² æˆå­¦æœŸ
    childhood: {
        male: [
            { id: 'focus_wisdom', name: 'ä¸»ä¿®ç»å²', desc: 'æ™ºæ…§ä¸å“å¾·å¤§å¹…æˆé•¿', focus: { wisdom: 2.0, virtue: 1.5, martial: 0.5 } },
            { id: 'focus_martial', name: 'ä¸»ä¿®æ­¦è‰º', desc: 'æ­¦å­¦ä¸å¥åº·å¤§å¹…æˆé•¿', focus: { martial: 2.0, health: 1.5, talent: 0.5 } },
            { id: 'focus_business', name: 'ä¸»ä¿®å•†é“', desc: 'æ™ºæ…§ä¸é­…åŠ›å¤§å¹…æˆé•¿', focus: { wisdom: 1.8, charm: 1.5, virtue: 0.5 } },
        ],
        female: [
            { id: 'focus_art', name: 'ä¸»ä¿®æ‰è‰º', desc: 'æ‰æƒ…ä¸é­…åŠ›å¤§å¹…æˆé•¿', focus: { talent: 2.0, charm: 1.5, wisdom: 0.5 } },
            { id: 'focus_etiquette', name: 'ä¸»ä¿®ç¤¼æ³•', desc: 'ç¤¼ä»ªä¸å“å¾·å¤§å¹…æˆé•¿', focus: { etiquette: 2.0, virtue: 1.5, charm: 0.5 } },
            { id: 'focus_management', name: 'ä¸»ä¿®å†…åŠ¡', desc: 'æ™ºæ…§ä¸å“å¾·å¤§å¹…æˆé•¿', focus: { wisdom: 1.8, virtue: 1.5, talent: 0.5 } },
        ]
    },
    // 16-18å² åŠç¬„/å† ç¤¼æœŸ
    teenager: {
        common: [
            { id: 'socialize', name: 'å‚åŠ å®´ä¼š', desc: 'èŠ±è´¹100ä¸¤ï¼Œæå‡å£°æœ›', cost: 100, effects: { reputation: 5, charm: 1 } },
            { id: 'discuss_future', name: 'æ¢è®¨æœªæ¥', desc: 'æå‡æ™ºæ…§ä¸äº²å­å…³ç³»', effects: { wisdom: 2, favor: 5 } },
        ]
    }
};

// [æ›¿æ¢]
const childSpousePools = {
    male: [ // å¥³å­©çš„ç»“å©šå¯¹è±¡ (å…±35ä½)
        // æ‚¨åŸæœ‰çš„5ä½
        { desc: "å®¶é“ä¸­è½çš„ä¹¦ç”Ÿï¼Œæ‰åæ¨ªæº¢ä½†ç©·å›°æ½¦å€’ã€‚", family: 20, attributes: { talent: 75, wisdom: 70, charm: 60, martial: 20, virtue: 50, health: 60, etiquette: 55 }, hidden_trait: { positive: "æ½œåŠ›è‚¡", negative: "æ€§æ ¼å›ºæ‰§" } },
        { desc: "å¿ä»¤ä¹‹å­ï¼Œä¸ºäººç¨³é‡ï¼Œå‰é€”å…‰æ˜ã€‚", family: 60, attributes: { talent: 60, wisdom: 65, virtue: 70, martial: 40, charm: 55, health: 70, etiquette: 65 }, hidden_trait: { positive: "æœ‰è´£ä»»å¿ƒ", negative: "ç•¥æ˜¾æ— è¶£" } },
        { desc: "å¯Œå•†çš„åº¶å­ï¼Œç²¾äºç®—è®¡ï¼Œå–„äºäº¤é™…ã€‚", family: 70, attributes: { talent: 50, wisdom: 80, charm: 75, martial: 30, virtue: 40, health: 65, etiquette: 60 }, hidden_trait: { positive: "æ…·æ…¨å¤§æ–¹", negative: "é£æµæˆæ€§" } },
        { desc: "è¾¹å…³æ ¡å°‰ï¼Œå‹‡æ­¦è¿‡äººä½†æ€§æ ¼ç²—çŠ·ã€‚", family: 55, attributes: { martial: 80, health: 85, virtue: 60, talent: 30, wisdom: 50, charm: 45, etiquette: 40 }, hidden_trait: { positive: "ä¸ºäººæ­£ç›´", negative: "ä¸è§£é£æƒ…" } },
        { desc: "å®‰å›½å…¬åºœçš„è¿œæˆ¿äº²æˆšï¼Œå®¶ä¸–æ˜¾èµ«ä½†æ¸¸æ‰‹å¥½é—²ã€‚", family: 85, attributes: { charm: 80, etiquette: 70, martial: 50, talent: 45, wisdom: 55, virtue: 50, health: 75 }, hidden_trait: { positive: "å‡ºæ‰‹é˜”ç»°", negative: "å®¶æœ‰å·¨é¢å€ºåŠ¡" } },
        // æ–°å¢çš„30ä½
        { desc: "ç¿°æ—é™¢ç¼–ä¿®ï¼Œæ¸…é«˜å­¤å‚²ï¼Œå­¦å¯Œäº”è½¦ã€‚", family: 65, attributes: { talent: 85, wisdom: 80, virtue: 65, charm: 60, martial: 30, health: 65, etiquette: 70 }, hidden_trait: { positive: "å­¦è¯†æ¸Šåš", negative: "ä¸å–„äº¤é™…" } },
        { desc: "ç¦å†›æ•™å¤´ï¼Œæ­¦è‰ºé«˜å¼ºï¼Œä¸è‹Ÿè¨€ç¬‘ã€‚", family: 62, attributes: { martial: 85, health: 80, virtue: 70, wisdom: 55, charm: 50, talent: 40, etiquette: 60 }, hidden_trait: { positive: "å¿ è¯šå¯é ", negative: "æ€§æ ¼æ²‰é—·" } },
        { desc: "å¤§ç†å¯ºä¸»ç°¿ï¼Œæ–­æ¡ˆå¦‚ç¥ï¼Œå¿ƒæ€ç¼œå¯†ã€‚", family: 58, attributes: { wisdom: 88, virtue: 75, talent: 50, martial: 50, charm: 60, health: 68, etiquette: 65 }, hidden_trait: { positive: "å…¬æ­£æ— ç§", negative: "å¤šç–‘" } },
        { desc: "å¤ªåŒ»é™¢çš„å¹´è½»å¾¡åŒ»ï¼Œæ¸©æ¶¦å¦‚ç‰ï¼ŒåŒ»æœ¯ç²¾æ¹›ã€‚", family: 72, attributes: { wisdom: 85, virtue: 80, health: 75, talent: 65, charm: 70, martial: 35, etiquette: 75 }, hidden_trait: { positive: "ä»å¿ƒä»æœ¯", negative: "èº«ä½“å­±å¼±" } },
        { desc: "æ¼•è¿å¸®çš„å°‘å¸®ä¸»ï¼Œä¸ºäººè±ªçˆ½ï¼Œæ±Ÿæ¹–æ°”é‡ã€‚", family: 48, attributes: { martial: 75, charm: 70, health: 82, virtue: 45, wisdom: 60, talent: 40, etiquette: 50 }, hidden_trait: { positive: "é‡æƒ…é‡ä¹‰", negative: "è¡Œäº‹é²è½" } },
        { desc: "å›½å­ç›‘çš„ç›‘ç”Ÿï¼Œå‡ºèº«åé—¨ï¼Œçœ¼é«˜äºé¡¶ã€‚", family: 78, attributes: { talent: 70, etiquette: 75, charm: 72, wisdom: 68, martial: 45, health: 70, virtue: 55 }, hidden_trait: { positive: "å®¶ä¸–æ˜¾èµ«", negative: "è‡ªè´Ÿ" } },
        { desc: "éšå±…å±±æ—çš„ç”»å¸ˆï¼Œæ‰æƒ…å“ç»ï¼Œä¸é—®ä¸–äº‹ã€‚", family: 15, attributes: { talent: 90, charm: 78, wisdom: 70, health: 65, virtue: 60, martial: 25, etiquette: 50 }, hidden_trait: { positive: "æ·¡æ³Šååˆ©", negative: "ä¸åˆ‡å®é™…" } },
        { desc: "å››æµ·é’±åº„çš„å°‘ä¸œå®¶ï¼Œç²¾æ˜èƒ½å¹²ï¼Œå–„äºæŠ•èµ„ã€‚", family: 82, attributes: { wisdom: 85, charm: 78, health: 70, virtue: 50, talent: 60, martial: 40, etiquette: 68 }, hidden_trait: { positive: "å–„äºç†è´¢", negative: "å”¯åˆ©æ˜¯å›¾" } },
        { desc: "è¢«è´¬è°ªçš„çš‡å­ï¼Œèƒ¸æœ‰åŸåºœï¼Œéšå¿å¾…å‘ã€‚", family: 90, attributes: { wisdom: 90, etiquette: 80, martial: 70, charm: 80, talent: 75, virtue: 60, health: 72 }, hidden_trait: { positive: "èƒ¸æ€€å¤§å¿—", negative: "èƒŒæ™¯å¤æ‚" } },
        { desc: "å¨éœ‡ä¸€æ–¹çš„å¤§ä¾ ï¼Œè¡Œä¾ ä»—ä¹‰ï¼Œæ½‡æ´’ä¸ç¾ã€‚", family: 30, attributes: { martial: 90, virtue: 85, charm: 80, health: 88, wisdom: 60, talent: 50, etiquette: 45 }, hidden_trait: { positive: "ä¾ è‚ä¹‰èƒ†", negative: "å››æµ·ä¸ºå®¶" } },
        { desc: "å·¥éƒ¨éƒä¸­ï¼Œé†‰å¿ƒè¥é€ ä¹‹æœ¯ï¼Œæ€§æ ¼æœ¨è®·ã€‚", family: 63, attributes: { talent: 80, wisdom: 75, virtue: 68, health: 70, martial: 40, charm: 50, etiquette: 62 }, hidden_trait: { positive: "æŠ€è‰ºç²¾æ¹›", negative: "ä¸è§£é£æƒ…" } },
        { desc: "é•¿å…¬ä¸»ä¹‹å­ï¼Œç›¸è²Œå‡ºä¼—ï¼Œå¤‡å—æººçˆ±ã€‚", family: 92, attributes: { charm: 90, etiquette: 80, talent: 65, martial: 55, wisdom: 60, virtue: 50, health: 75 }, hidden_trait: { positive: "èº«ä»½å°Šè´µ", negative: "æ€§æ ¼å›é€†" } },
        { desc: "å±¡è¯•ä¸ç¬¬çš„ç§€æ‰ï¼Œæ»¡è…¹ç‰¢éªšï¼Œå´ä¹Ÿå–„è‰¯ã€‚", family: 25, attributes: { talent: 70, wisdom: 65, virtue: 60, health: 58, charm: 55, martial: 20, etiquette: 50 }, hidden_trait: { positive: "å¿ƒåœ°å–„è‰¯", negative: "æ€€æ‰ä¸é‡" } },
        { desc: "æ¥è‡ªå¼‚åŸŸçš„ç‹å­ï¼Œçƒ­æƒ…å¥”æ”¾ï¼Œä¸æ‹˜ç¤¼æ³•ã€‚", family: 88, attributes: { charm: 88, martial: 75, health: 85, talent: 60, wisdom: 65, etiquette: 50, virtue: 58 }, hidden_trait: { positive: "è§å¤šè¯†å¹¿", negative: "æ–‡åŒ–å·®å¼‚" } },
        { desc: "é•‡å›½å…¬ä¸–å­ï¼Œæœªæ¥çš„ç»§æ‰¿äººï¼Œç¨³é‡ç«¯æ–¹ã€‚", family: 95, attributes: { virtue: 85, etiquette: 88, wisdom: 80, martial: 70, charm: 78, health: 75, talent: 70 }, hidden_trait: { positive: "æœ‰æ‹…å½“", negative: "è¿‡äºä¸¥è‚ƒ" } },
        { desc: "æ–°ç§‘æ­¦çŠ¶å…ƒï¼Œå‡ºèº«è¡Œä¼ï¼Œå¿ å‹‡è€¿ç›´ã€‚", family: 45, attributes: { martial: 92, health: 90, virtue: 80, wisdom: 60, charm: 65, etiquette: 55, talent: 40 }, hidden_trait: { positive: "å‹‡å† ä¸‰å†›", negative: "æ€§æ ¼è€¿ç›´" } },
        { desc: "æ£‹åœ£çš„å…³é—¨å¼Ÿå­ï¼Œèªæ…§ç»é¡¶ï¼Œå–„äºå¸ƒå±€ã€‚", family: 40, attributes: { wisdom: 92, talent: 75, etiquette: 70, charm: 68, virtue: 65, health: 65, martial: 30 }, hidden_trait: { positive: "æ™ºè®¡è¿‡äºº", negative: "ä½“å¼±å¤šç—…" } },
        { desc: "ç»è¥é©¬åœºçš„èƒ¡äººï¼Œè±ªçˆ½å¼€æœ—ï¼Œèº«å®¶é¢‡ä¸°ã€‚", family: 50, attributes: { charm: 75, health: 85, martial: 70, wisdom: 60, virtue: 55, talent: 35, etiquette: 40 }, hidden_trait: { positive: "ä¹è§‚å¼€æœ—", negative: "ä¸é€šæ–‡å¢¨" } },
        { desc: "å¯ºåº™ä¸­å¸¦å‘ä¿®è¡Œçš„ä¿—å®¶å¼Ÿå­ï¼Œä½›æ³•ç²¾æ·±ã€‚", family: 18, attributes: { virtue: 90, wisdom: 80, health: 75, charm: 70, talent: 60, martial: 40, etiquette: 65 }, hidden_trait: { positive: "å†…å¿ƒå¹³å’Œ", negative: "çº¢å°˜ç¼˜æµ…" } },
        { desc: "é’¦å¤©ç›‘ç›‘æ­£ï¼Œèƒ½è§‚æ˜Ÿè±¡ï¼Œè¨€è¯­ç¥ç§˜ã€‚", family: 66, attributes: { wisdom: 87, talent: 70, charm: 65, virtue: 60, health: 68, etiquette: 72, martial: 32 }, hidden_trait: { positive: "çŸ¥æ™“å¤©æœº", negative: "å‘½æ ¼ç‰¹æ®Š" } },
        { desc: "ç»è¥å¤ç©åº—çš„æŒæŸœï¼Œçœ¼å…‰æ¯’è¾£ï¼Œæ•…äº‹å¾ˆå¤šã€‚", family: 52, attributes: { wisdom: 82, charm: 72, talent: 68, virtue: 58, health: 67, etiquette: 60, martial: 38 }, hidden_trait: { positive: "åšå¤é€šä»Š", negative: "èƒŒæ™¯æˆè°œ" } },
        { desc: "ä¸€ä½çˆ±å¥½ç¾é£Ÿçš„æ¸¸å­ï¼Œå¨è‰ºé«˜è¶…ï¼Œéšé‡è€Œå®‰ã€‚", family: 33, attributes: { talent: 82, charm: 75, health: 78, virtue: 62, wisdom: 60, etiquette: 58, martial: 42 }, hidden_trait: { positive: "ç”Ÿæ´»é›…è‡´", negative: "èƒ¸æ— å¤§å¿—" } },
        { desc: "æ¢¨å›­æˆç­çš„å½“å®¶æ­¦ç”Ÿï¼Œæ‰®ç›¸ä¿Šç¾ï¼Œç²‰ä¸ä¼—å¤šã€‚", family: 38, attributes: { charm: 85, talent: 80, martial: 65, health: 75, wisdom: 58, virtue: 50, etiquette: 60 }, hidden_trait: { positive: "ä¸‡äººè¿·", negative: "èº«ä»½ä½å¾®" } },
        { desc: "ä¸ºçˆ¶ä¼¸å†¤çš„å­å­ï¼ŒåšéŸ§ä¸æ‹”ï¼Œå››å¤„å¥”èµ°ã€‚", family: 22, attributes: { virtue: 88, health: 75, wisdom: 65, martial: 50, talent: 45, charm: 58, etiquette: 52 }, hidden_trait: { positive: "å“è¡Œé«˜æ´", negative: "å®¶æœ‰å†¤å±ˆ" } },
        { desc: "è¢«å®¶æ—é™¤åçš„åº¶å­ï¼Œå‡­å€Ÿè‡ªå·±é—¯å‡ºä¸€ç‰‡å¤©ã€‚", family: 28, attributes: { wisdom: 80, martial: 70, health: 78, virtue: 40, charm: 65, talent: 55, etiquette: 50 }, hidden_trait: { positive: "è‡ªå¼ºä¸æ¯", negative: "è…¹é»‘è®°ä»‡" } },
        { desc: "ä¸€ä½æ“…é•¿æœºå…³æœ¯çš„å¢¨å®¶ä¼ äººï¼Œæƒ³æ³•å¥‡ç‰¹ã€‚", family: 26, attributes: { talent: 88, wisdom: 82, martial: 55, health: 70, charm: 60, virtue: 65, etiquette: 55 }, hidden_trait: { positive: "åŠ¨æ‰‹èƒ½åŠ›å¼º", negative: "ä¸å–„è¨€è¾" } },
        { desc: "æŒç®¡çš‡å®¶å›­æ—çš„å¥‰å®¸è‹‘å¿ï¼Œå“å‘³ä¸å‡¡ã€‚", family: 74, attributes: { talent: 80, etiquette: 82, charm: 75, wisdom: 70, virtue: 65, health: 68, martial: 48 }, hidden_trait: { positive: "å®¡ç¾é«˜é›…", negative: "è¿½æ±‚å®Œç¾" } },
        { desc: "é¸¿èƒªå¯ºå°‘å¿ï¼Œå¸¸ä¸å¤–é‚¦ä½¿è‡£æ‰“äº¤é“ã€‚", family: 69, attributes: { wisdom: 80, charm: 78, etiquette: 80, talent: 65, virtue: 68, health: 69, martial: 40 }, hidden_trait: { positive: "èƒ½è¨€å–„è¾©", negative: "åº”é…¬ç¹å¤š" } },
        { desc: "ç¾½æ—å«çš„ä¸­éƒå°†ï¼Œè´Ÿè´£äº¬åŸé˜²åŠ¡ã€‚", family: 76, attributes: { martial: 82, health: 80, virtue: 72, wisdom: 68, etiquette: 70, charm: 65, talent: 42 }, hidden_trait: { positive: "å®‰å…¨æ„Ÿåè¶³", negative: "å¸¸å¹´ä¸å½’å®¶" } }
    ],
    female: [ // ç”·å­©çš„ç»“å©šå¯¹è±¡ (å…±35ä½)
        // æ‚¨åŸæœ‰çš„5ä½
        { desc: "å°å®¶ç¢§ç‰ï¼Œæ¸©æŸ”è´¤æ·‘ï¼Œæ“…é•¿å¥³çº¢ã€‚", family: 30, attributes: { talent: 65, virtue: 75, charm: 65, martial: 25, wisdom: 55, health: 70, etiquette: 60 }, hidden_trait: { positive: "å‹¤ä¿­æŒå®¶", negative: "çœ¼ç•Œç‹­çª„" } },
        { desc: "å®˜å®¦å«¡å¥³ï¼ŒçŸ¥ä¹¦è¾¾ç†ï¼Œé¢‡æœ‰ä¸»è§ã€‚", family: 75, attributes: { talent: 70, wisdom: 70, etiquette: 80, martial: 40, charm: 75, virtue: 65, health: 65 }, hidden_trait: { positive: "èªæ…§æ•é”", negative: "æ€§æ ¼å¼ºåŠ¿" } },
        { desc: "æ±Ÿå—ç»£å•†ä¹‹å¥³ï¼Œæ´»æ³¼å¯çˆ±ï¼Œå«å¦†ä¸°åšã€‚", family: 65, attributes: { charm: 80, wisdom: 60, talent: 70, martial: 35, virtue: 60, health: 70, etiquette: 65 }, hidden_trait: { positive: "å–„äºç†è´¢", negative: "èŠ±é’±å¦‚æµæ°´" } },
        { desc: "åé—¨ä¹‹åï¼Œæ‰æƒ…ä¸å®¹è²Œé—»åäº¬åŸã€‚", family: 80, attributes: { talent: 85, charm: 85, etiquette: 75, martial: 45, wisdom: 70, virtue: 70, health: 65 }, hidden_trait: { positive: "äº¤é™…å¹¿æ³›", negative: "èº«æœ‰éšç–¾" } },
        { desc: "æ­¦æ—ä¸–å®¶çš„å°å§ï¼Œæ€§æ ¼ç›´çˆ½ï¼Œä¸æ‹˜å°èŠ‚ã€‚", family: 50, attributes: { martial: 70, virtue: 65, health: 80, talent: 40, wisdom: 50, charm: 60, etiquette: 50 }, hidden_trait: { positive: "åšéŸ§ä¸æ‹”", negative: "æ€§æ ¼æš´èº" } },
        // æ–°å¢çš„30ä½
        { desc: "å¤ªå‚…çš„å­™å¥³ï¼Œç«¯åº„ç¨³é‡ï¼Œæ˜¯äº¬åŸè´µå¥³çš„å…¸èŒƒã€‚", family: 90, attributes: { etiquette: 85, virtue: 80, wisdom: 75, charm: 70, talent: 65, health: 68, martial: 35 }, hidden_trait: { positive: "å®¶ä¸–æ˜¾èµ«", negative: "è¿‡äºä¼ ç»Ÿ" } },
        { desc: "é•¿å…¬ä¸»çš„æŒä¸Šæ˜ç ï¼Œå¨‡ä¿å¯äººï¼Œç•¥å¸¦å‚²æ°”ã€‚", family: 95, attributes: { charm: 90, etiquette: 82, talent: 70, martial: 50, wisdom: 65, health: 72, virtue: 60 }, hidden_trait: { positive: "èº«ä»½å°Šè´µ", negative: "å–„å¦’" } },
        { desc: "è¢«æŠ„å®¶å®˜å‘˜çš„å¥³å„¿ï¼Œä»äº‘ç«¯è·Œè½ï¼Œå¤–æŸ”å†…åˆšã€‚", family: 15, attributes: { wisdom: 75, talent: 70, virtue: 65, charm: 72, health: 60, etiquette: 68, martial: 30 }, hidden_trait: { positive: "åšéŸ§ä¸æ‹”", negative: "å†…å¿ƒæ•æ„Ÿ" } },
        { desc: "è¯ç‹è°·çš„ä¼ äººï¼Œä¸è°™ä¸–äº‹ï¼Œå–„è‰¯çº¯çœŸã€‚", family: 35, attributes: { wisdom: 85, virtue: 90, health: 75, talent: 68, charm: 70, etiquette: 60, martial: 40 }, hidden_trait: { positive: "åŒ»æœ¯é«˜è¶…", negative: "ä¸é€šäººæƒ…" } },
        { desc: "å¥³æ‰®ç”·è£…åœ¨ä¹¦é™¢è¯»ä¹¦çš„æ‰å¥³ï¼Œæ€æƒ³æ–°æ½®ã€‚", family: 58, attributes: { wisdom: 88, talent: 80, charm: 75, martial: 55, health: 68, etiquette: 65, virtue: 62 }, hidden_trait: { positive: "è§è§£ç‹¬åˆ°", negative: "æƒŠä¸–éª‡ä¿—" } },
        { desc: "ç»è¥ç€äº¬åŸæœ€å¤§é…’æ¥¼çš„å¥³æŒæŸœï¼Œå…«é¢ç²ç‘ã€‚", family: 72, attributes: { charm: 85, wisdom: 82, health: 70, talent: 60, etiquette: 70, virtue: 55, martial: 45 }, hidden_trait: { positive: "äººè„‰å¹¿é˜”", negative: "èƒŒæ™¯å¤æ‚" } },
        { desc: "â€œéœ“è£³åŠâ€çš„é¦–å¸­ç»£å¨˜ï¼ŒæŠ€è‰ºç²¾æ¹›ï¼Œå¿ƒæ°”é«˜ã€‚", family: 42, attributes: { talent: 90, charm: 80, virtue: 60, wisdom: 68, health: 65, etiquette: 70, martial: 30 }, hidden_trait: { positive: "æ‰‹è‰ºç»ä¼¦", negative: "æ€§æ ¼å­¤åƒ»" } },
        { desc: "ä¸€ä½æˆ˜åŠŸèµ«èµ«çš„å¥³å°†å†›ï¼Œæ°”åœºå¼ºå¤§ã€‚", family: 68, attributes: { martial: 90, health: 88, virtue: 75, wisdom: 65, charm: 70, etiquette: 60, talent: 40 }, hidden_trait: { positive: "ä¿å®¶å«å›½", negative: "æ€§æ ¼å¼ºåŠ¿" } },
        { desc: "å‰æœçš‡å®¤çš„é—å­¤ï¼ŒèƒŒè´Ÿå›½ä»‡å®¶æ¨ï¼Œæ¸…å†·è…¹é»‘ã€‚", family: 20, attributes: { etiquette: 85, wisdom: 80, talent: 75, charm: 78, martial: 65, health: 62, virtue: 40 }, hidden_trait: { positive: "è¡€ç»Ÿé«˜è´µ", negative: "åŸåºœææ·±" } },
        { desc: "æŒ¯è¿œé•–å±€æ€»é•–å¤´çš„ç‹¬å¥³ï¼Œèµ°å—é—¯åŒ—ï¼Œè§å¤šè¯†å¹¿ã€‚", family: 55, attributes: { martial: 75, health: 82, wisdom: 70, charm: 75, virtue: 68, etiquette: 55, talent: 45 }, hidden_trait: { positive: "ç‹¬ç«‹è‡ªä¸»", negative: "ä¸å–œçº¦æŸ" } },
        { desc: "æµè½æ°‘é—´çš„å…¬ä¸»ï¼Œä¹è§‚å¼€æœ—ï¼Œå°šæœªçŸ¥æ™“èº«ä¸–ã€‚", family: 10, attributes: { charm: 88, virtue: 82, health: 78, talent: 70, wisdom: 65, etiquette: 60, martial: 40 }, hidden_trait: { positive: "ç¦æ³½æ·±åš", negative: "èº«ä»½æ˜¯è°œ" } },
        { desc: "å› ä¸€é¦–è¯ååŠ¨äº¬åŸçš„å¹³æ°‘æ‰å¥³ï¼Œè¿½æ±‚è€…ä¼—ã€‚", family: 28, attributes: { talent: 92, charm: 85, wisdom: 78, virtue: 70, health: 65, etiquette: 68, martial: 30 }, hidden_trait: { positive: "æ‰åæ¨ªæº¢", negative: "å®¶å¢ƒè´«å¯’" } },
        { desc: "è¢«ç»§æ¯è‹›å¾…çš„åº¶å¥³ï¼Œè°¨å°æ…å¾®ï¼Œæ¥šæ¥šå¯æ€œã€‚", family: 40, attributes: { virtue: 80, etiquette: 70, health: 62, charm: 75, talent: 65, wisdom: 60, martial: 28 }, hidden_trait: { positive: "æƒ¹äººæ€œçˆ±", negative: "å†…å¿ƒè‡ªå‘" } },
        { desc: "ä¸€ä½çˆ±å¥½ç¾é£Ÿçš„ä¿å¨å¨˜ï¼Œå¨è‰ºé—»åä¹¡é‡Œã€‚", family: 32, attributes: { talent: 80, charm: 78, health: 75, virtue: 70, wisdom: 55, etiquette: 58, martial: 38 }, hidden_trait: { positive: "æ‡‚å¾—ç”Ÿæ´»", negative: "ä¸å–„ç†è´¢" } },
        { desc: "ç¤¼éƒ¨å°šä¹¦å®¶çš„å«¡æ¬¡å¥³ï¼Œæœ€é‡è§„çŸ©ï¼Œä¸€ä¸ä¸è‹Ÿã€‚", family: 84, attributes: { etiquette: 90, virtue: 82, wisdom: 78, talent: 70, charm: 75, health: 68, martial: 40 }, hidden_trait: { positive: "æŒå®¶æœ‰é“", negative: "æ€§æ ¼åˆ»æ¿" } },
        { desc: "ä¸ä½ æŒ‡è…¹ä¸ºå©šçš„è¡¨å¦¹ï¼Œä½“å¼±å¤šç—…ï¼Œæ¸©æŸ”ä¼¼æ°´ã€‚", family: 70, attributes: { virtue: 85, etiquette: 80, charm: 78, talent: 72, health: 55, wisdom: 65, martial: 25 }, hidden_trait: { positive: "é’æ¢…ç«¹é©¬", negative: "éœ€è¦ç…§é¡¾" } },
        { desc: "æŒç®¡å®¶æ—ç”Ÿæ„çš„é•¿å§ï¼Œæ²‰ç¨³æœ‰æ‹…å½“ã€‚", family: 71, attributes: { wisdom: 87, virtue: 83, etiquette: 80, charm: 78, talent: 68, health: 70, martial: 45 }, hidden_trait: { positive: "èƒ½åŠ›å‡ºä¼—", negative: "æ— æš‡é£æœˆ" } },
        { desc: "æ¥è‡ªæ³¢æ–¯çš„ç å®å•†äººï¼Œçƒ­æƒ…ä¼¼ç«ï¼Œèˆå§¿åŠ¨äººã€‚", family: 62, attributes: { charm: 90, wisdom: 75, health: 78, talent: 65, etiquette: 55, virtue: 58, martial: 50 }, hidden_trait: { positive: "å¼‚åŸŸé£æƒ…", negative: "ä¸å®ˆè§„çŸ©" } },
        { desc: "ç´æ£‹ä¹¦ç”»æ— ä¸€ä¸ç²¾çš„æ•™åŠå¸èŠ±é­ã€‚", family: 33, attributes: { talent: 95, charm: 92, wisdom: 80, etiquette: 78, health: 68, virtue: 50, martial: 40 }, hidden_trait: { positive: "é£æƒ…ä¸‡ç§", negative: "èº«ä¸–åå·" } },
        { desc: "ä¸€ä½çˆ±å¥½æ¸¸å±±ç©æ°´çš„åœ°ä¸»åƒé‡‘ï¼Œæ´’è„±è‡ªåœ¨ã€‚", family: 63, attributes: { health: 80, charm: 82, martial: 60, talent: 65, wisdom: 62, virtue: 68, etiquette: 60 }, hidden_trait: { positive: "çƒ­çˆ±è‡ªç”±", negative: "ä¸å–œæ‹˜æŸ" } },
        { desc: "æ‹¥æœ‰ç§äººè—ä¹¦æ¥¼çš„å¥‡å¥³å­ï¼Œåšé—»å¼ºè®°ã€‚", family: 57, attributes: { wisdom: 90, talent: 88, virtue: 72, charm: 75, health: 66, etiquette: 75, martial: 33 }, hidden_trait: { positive: "åšå­¦å¤šæ‰", negative: "ä¸å–„è¿åŠ¨" } },
        { desc: "åé—¨ä¹‹åï¼Œå´å› æ²‰è¿·é¬¼ç¥ä¹‹è¯´è€Œè¢«äººç–è¿œã€‚", family: 66, attributes: { wisdom: 85, talent: 75, charm: 70, etiquette: 72, virtue: 55, health: 67, martial: 35 }, hidden_trait: { positive: "æ€æƒ³å¥‡ç‰¹", negative: "æ€§æ ¼å¤æ€ª" } },
        { desc: "æ–°æ™‹å® å¦ƒçš„å¦¹å¦¹ï¼Œä»—ç€å§å§çš„åŠ¿å¤´ï¼Œæœ‰äº›åˆè›®ã€‚", family: 78, attributes: { charm: 88, etiquette: 70, martial: 50, virtue: 55, wisdom: 62, talent: 68, health: 74 }, hidden_trait: { positive: "èƒŒæ™¯å¼ºå¤§", negative: "åˆè›®ä»»æ€§" } },
        { desc: "ç»è¥ç€ä¸€å®¶å°èŒ¶é¦†çš„å¹´è½»å¯¡å¦‡ï¼Œæ•…äº‹å¾ˆå¤šã€‚", family: 38, attributes: { wisdom: 82, charm: 80, virtue: 75, health: 68, talent: 65, etiquette: 66, martial: 36 }, hidden_trait: { positive: "æˆç†Ÿæ‡‚äº‹", negative: "æ›¾ç»å«äºº" } },
        { desc: "å› çˆ¶äº²æˆè¾¹è€Œç‹¬è‡ªåœ¨äº¬åŸç”Ÿæ´»çš„å¥³å­ï¼Œåšå¼ºç‹¬ç«‹ã€‚", family: 48, attributes: { virtue: 80, wisdom: 75, health: 70, martial: 60, talent: 55, charm: 68, etiquette: 64 }, hidden_trait: { positive: "ç‹¬ç«‹", negative: "ç¼ºå°‘å®‰å…¨æ„Ÿ" } },
        { desc: "å¯ºåº™æ—é•¿å¤§çš„å±…å£«ä¹‹å¥³ï¼Œæ€§æƒ…å¹³å’Œï¼Œä¸ä¸–æ— äº‰ã€‚", family: 22, attributes: { virtue: 94, wisdom: 80, health: 75, charm: 72, talent: 62, etiquette: 68, martial: 38 }, hidden_trait: { positive: "ä¸ä¸–æ— äº‰", negative: "ç¼ºä¹ä¸»è§" } },
        { desc: "è¢«å¤§æˆ·äººå®¶æ”¶å…»çš„å­¤å¥³ï¼Œè°¨å°æ…å¾®ï¼Œæ‡‚å¾—æ„Ÿæ©ã€‚", family: 40, attributes: { virtue: 90, etiquette: 80, wisdom: 72, charm: 75, talent: 68, health: 68, martial: 34 }, hidden_trait: { positive: "çŸ¥æ©å›¾æŠ¥", negative: "è¿‡äºè°¨æ…" } },
        { desc: "ä¸€ä½ä¹è§‚çš„å†œå®¶å¥³ï¼Œå¯¹ç”Ÿæ´»å……æ»¡çƒ­æƒ…ã€‚", family: 12, attributes: { health: 85, virtue: 75, charm: 70, wisdom: 50, talent: 40, etiquette: 45, martial: 45 }, hidden_trait: { positive: "çƒ­çˆ±ç”Ÿæ´»", negative: "è§è¯†ä¸å¹¿" } },
        { desc: "æ±Ÿå—èˆ¹ç‹çš„å¥³å„¿ï¼Œæ€§æ ¼å¼€æœ—ï¼Œå–œçˆ±èˆªæµ·ã€‚", family: 77, attributes: { charm: 84, health: 80, wisdom: 77, talent: 67, martial: 60, virtue: 67, etiquette: 67 }, hidden_trait: { positive: "å¿ƒèƒ¸å¼€é˜”", negative: "ä¸å–œå†…å®…" } }
    ]
};
// =======================================================================
// ===================== ã€æ–°å¢ã€‘æƒ…äººä¸é‡‘å…°ç³»ç»Ÿæ ¸å¿ƒæ•°æ® =====================
// =======================================================================
// ===================== ã€ç¬¬ä¸€æ­¥ï¼šæ–°å¢çƒ¦æ¼äº‹ä»¶åº“ã€‘ =====================
const CONVERSATION_DILEMMAS = [
    // --- æ™ºæ…§å‹çƒ¦æ¼ ---
    {
        id: 'faction_strife', bestType: 'wisdom',
        desc: `è¿‘æ¥æœå ‚ä¹‹ä¸Šæ´¾ç³»æ–—äº‰æ„ˆå‘æ¿€çƒˆï¼Œæˆ‘èº«å¤„å…¶ä¸­ï¼Œåªè§‰å¦‚å±¥è–„å†°ã€‚`,
        responses: {
            wisdom: { text: "åˆ†æåˆ©å¼Šï¼Œå¯»æ‰¾ç ´å±€ä¹‹æ³•ã€‚", outcome: { title: "èŒ…å¡é¡¿å¼€", log: "ä½ çš„åˆ†æä¸€é’ˆè§è¡€ï¼Œä¸ºTAæŒ‡æ˜äº†æ–¹å‘ã€‚TAè§†ä½ ä¸ºå¯æ‰˜ä»˜å¤§äº‹çš„è‚±è‚¡ä¹‹è‡£ã€‚", effects: { favor: 10, trust: 20, emotionValue: 5 } } },
            charm:  { text: "å®‰æ…°TAï¼Œå®˜åœºé™©æ¶ï¼Œä¸å¿…è¿‡äºå¿§å¿ƒã€‚", outcome: { title: "ç‰‡åˆ»æ…°è—‰", log: "ä½ çš„å®‰æ…°è®©TAç´§ç»·çš„å¿ƒå¼¦ç¨æœ‰æ”¾æ¾ï¼Œä½†å¹¶æœªè§£å†³æ ¹æœ¬é—®é¢˜ã€‚", effects: { favor: 5, trust: 5, emotionValue: 8 } } },
            virtue: { text: "åŠTAåšå®ˆæœ¬å¿ƒï¼Œå‡ºæ·¤æ³¥è€Œä¸æŸ“ã€‚", outcome: { title: "æ¸…æµä¹‹è¨€", log: "ä½ çš„è¯è¯­è®©TAåšå®šäº†è‡ªå·±çš„é“ä¹‰ï¼Œä½†TAä¹Ÿæ˜ç™½ï¼Œè¿™åœ¨å¤æ‚çš„æ–—äº‰ä¸­æˆ–è®¸è¿‡äºç†æƒ³åŒ–ã€‚", effects: { favor: 2, trust: 10, emotionValue: 12 } } }
        }
    },
    {
        id: 'ancient_text', bestType: 'wisdom',
        desc: `æˆ‘æ­£åœ¨ç ”è¯»ä¸€æœ¬å¤ç±ï¼Œä½†å…¶ä¸­ä¸€å¤„å…³éš˜æ™¦æ¶©éš¾æ‡‚ï¼Œè‹¦æ€æ•°æ—¥ä¸å¾—å…¶è§£ã€‚`,
        responses: {
            wisdom: { text: "ä¸TAä¸€åŒæ¢è®¨ï¼Œå¼•ç»æ®å…¸ã€‚", outcome: { title: "è±ç„¶å¼€æœ—", log: "åœ¨ä½ ä»¬çš„å…±åŒæ¢è®¨ä¸‹ï¼Œç«ŸçœŸçš„è§£å¼€äº†è¿™ä¸ªéš¾é¢˜ï¼TAå¯¹ä½ çš„æ‰å­¦é’¦ä½©ä¸å·²ã€‚", effects: { favor: 12, trust: 15, attributes: { wisdom: 1 } } } },
            charm:  { text: "ç§°èµTAå‹¤å­¦å¥½é—®ã€‚", outcome: { title: "å·§è¨€èµèµ", log: "ä½ ç§°èµTAçš„å‹¤å¥‹ä¸ä¸“æ³¨ï¼ŒTAå¬åååˆ†å—ç”¨ã€‚", effects: { favor: 6, trust: 5 } } },
            virtue: { text: "åŠTAåŠ³é€¸ç»“åˆï¼Œä¸å¿…æ€¥äºä¸€æ—¶ã€‚", outcome: { title: "ä½“è´´ä¹‹è¯­", log: "ä½ çš„å…³å¿ƒè®©TAæ„Ÿåˆ°æ¸©æš–ï¼Œå†³å®šä¼‘æ¯ç‰‡åˆ»ã€‚", effects: { favor: 4, trust: 8 } } }
        }
    },
    {
        id: 'arranged_marriage', bestType: 'wisdom',
        desc: `å®¶æ—æœ‰æ„ä¸ºæˆ‘å®‰æ’ä¸€é—¨äº²äº‹ï¼Œå¯¹æ–¹å®¶ä¸–æ˜¾èµ«ï¼Œäºæˆ‘å‰é€”å¤§æœ‰è£¨ç›Šï¼Œä½†æˆ‘å´å¹¶ä¸å€¾å¿ƒã€‚`,
        responses: {
            wisdom: { text: "åˆ†æå…¶ä¸­çš„åˆ©å®³ä¸é£é™©ã€‚", outcome: { title: "æƒè¡¡åˆ©å¼Š", log: "ä½ çš„åˆ†æè®©TAå¯¹è¿™é—¨äº²äº‹æœ‰äº†æ›´æ¸…é†’çš„è®¤è¯†ï¼ŒTAå†³å®šå†æ…é‡è€ƒè™‘ã€‚", effects: { favor: 8, trust: 15 } } },
            charm:  { text: "æ”¯æŒTAè¿½æ±‚è‡ªå·±çš„å¹¸ç¦ã€‚", outcome: { title: "æƒ…æ„Ÿå…±é¸£", log: "ä½ å¯¹TAçš„æ”¯æŒè®©TAå¤§ä¸ºæ„ŸåŠ¨ï¼Œè§†ä½ ä¸ºå”¯ä¸€çš„çŸ¥å·±ã€‚", effects: { favor: 15, emotionValue: 20 } } },
            virtue: { text: "æé†’TAå®¶æ—è´£ä»»çš„é‡è¦æ€§ã€‚", outcome: { title: "å®¶æ—ä¸ºé‡", log: "ä½ æé†’TAå®¶æ—çš„è´£ä»»ï¼ŒTAè™½æœ‰è§¦åŠ¨ï¼Œä½†å†…å¿ƒæ›´æ·»æ„ç»ªã€‚", effects: { favor: -5, trust: 10 } } }
        }
    },
    // --- é­…åŠ›å‹çƒ¦æ¼ ---
    {
        id: 'restless_heart', bestType: 'charm',
        desc: `æœ€è¿‘æ€»è§‰å¾—å¿ƒç»ªä¸å®ï¼Œè¿çª—å¤–çš„é¸Ÿé¸£éƒ½è§‰å¾—çƒ¦èºï¼Œä¸çŸ¥è¯¥å¦‚ä½•æ˜¯å¥½ã€‚`,
        responses: {
            wisdom: { text: "ä¸ºTAåˆ†æå¿ƒçƒ¦çš„å¯èƒ½åŸå› ã€‚", outcome: { title: "ç†æ€§åˆ†æ", log: "ä½ çš„åˆ†æå¾ˆæœ‰é“ç†ï¼Œä½†ä¼¼ä¹æ²¡èƒ½è®©TAçš„å¿ƒæƒ…å¥½èµ·æ¥ã€‚", effects: { favor: 2, trust: 5 } } },
            charm:  { text: "å¸¦TAå»éƒŠå¤–æ•£å¿ƒã€‚", outcome: { title: "æ¸©æŸ”é™ªä¼´", log: "åœ¨ä½ çš„é™ªä¼´ä¸‹ï¼ŒTAåœ¨éƒŠå¤–æ•£äº†æ•£å¿ƒï¼Œçƒ¦é—·çš„å¿ƒæƒ…ä¸€æ‰«è€Œç©ºã€‚TAå¯¹ä½ æ›´åŠ ä¾èµ–ã€‚", effects: { favor: 15, emotionValue: 15 } } },
            virtue: { text: "é¼“åŠ±TAé™å¿ƒå…»æ€§ã€‚", outcome: { title: "å–„æ„è§„åŠ", log: "ä½ åŠTAé™ä¸‹å¿ƒæ¥è°ƒå…»ï¼ŒTAç‚¹äº†ç‚¹å¤´ã€‚", effects: { favor: 4, trust: 8 } } }
        }
    },
    {
        id: 'offended_friend', bestType: 'charm',
        desc: `æˆ‘ä¼¼ä¹æ— æ„ä¸­å¾—ç½ªäº†ä¸€ä½æœ‹å‹ï¼Œå¯¹æ–¹è¿‘æ¥å¯¹æˆ‘é¢‡ä¸ºå†·æ·¡ï¼Œæˆ‘ä¸ºæ­¤å¾ˆæ˜¯éš¾è¿‡ã€‚`,
        responses: {
            wisdom: { text: "å»ºè®®TAä¸»åŠ¨æ²Ÿé€šï¼Œè§£å¼€è¯¯ä¼šã€‚", outcome: { title: "è‰¯ç­–", log: "ä½ å»ºè®®TAä¸»åŠ¨æ²Ÿé€šï¼ŒTAè®¤ä¸ºè¿™æ˜¯ä¸ªå¥½ä¸»æ„ã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "å€¾å¬TAçš„å§”å±ˆï¼Œè¡¨ç¤ºç†è§£ã€‚", outcome: { title: "æ„ŸåŒèº«å—", log: "ä½ çš„å€¾å¬å’Œç†è§£ï¼Œè®©TAæ„Ÿåˆ°è«å¤§çš„å®‰æ…°ã€‚TAè§‰å¾—ä½ æ˜¯æœ€æ‡‚TAçš„äººã€‚", effects: { favor: 12, emotionValue: 10 } } },
            virtue: { text: "â€œæ¸…è€…è‡ªæ¸…ï¼Œä¸å¿…ä»‹æ€€ã€‚â€", outcome: { title: "é«˜æ´ä¹‹è®º", log: "ä½ çš„è¯è™½æœ‰é“ç†ï¼Œä½†ä¼¼ä¹æ²¡èƒ½çœŸæ­£å®‰æ…°åˆ°TAã€‚", effects: { favor: 3, trust: 5 } } }
        }
    },
    {
        id: 'world_weariness', bestType: 'charm',
        desc: `çœ‹åˆ°è¡—è¾¹æµç¦»å¤±æ‰€çš„å­©ç«¥ï¼Œæ€»è§‰å¾—å¿ƒä¸­ä¸å¿ï¼Œæ„Ÿå¹ä¸–äº‹æ— å¸¸ã€‚`,
        responses: {
            wisdom: { text: "æ¢è®¨è´«å›°çš„æ ¹æºã€‚", outcome: { title: "æ¢è®¨æ ¹æº", log: "ä½ ä»¬çš„è°ˆè¯å¾ˆæœ‰æ·±åº¦ï¼Œä½†æ°”æ°›æœ‰äº›æ²‰é‡ã€‚", effects: { favor: 5, trust: 8 } } },
            charm:  { text: "â€œæ­£å› ä¸–äº‹æ— å¸¸ï¼Œæ­¤åˆ»çš„ç›¸ä¼´æ‰æ›´æ˜¾çè´µã€‚â€", outcome: { title: "è¯—æ„å›åº”", log: "ä½ è¯—æ„çš„è¯è¯­å’Œæ¸©æŸ”çš„çœ¼ç¥ï¼Œè®©TAä»ä¼¤æ„Ÿä¸­æŠ½ç¦»ï¼Œä¸“æ³¨äºçœ¼å‰äººã€‚", effects: { favor: 10, emotionValue: 15 } } },
            virtue: { text: "æè®®ä¸€åŒæ–½ç²¥è¡Œå–„ã€‚", outcome: { title: "èº«ä½“åŠ›è¡Œ", log: "ä½ ä»¬ä¸€åŒè¡Œå–„ï¼ŒTAå¯¹ä½ çš„å“è¡Œæ›´åŠ æ•¬ä½©ã€‚", effects: { favor: 8, trust: 12, attributes: { virtue: 1 } } } }
        }
    },
    // --- å“å¾·å‹çƒ¦æ¼ ---
    {
        id: 'misunderstanding_friend', bestType: 'virtue',
        desc: `æˆ‘ä¸ä¸€ä½å‹äººäº§ç”Ÿäº†äº›è®¸è¯¯ä¼šï¼Œæ­£ä¸ºæ­¤çƒ¦æ¼ï¼Œä¸çŸ¥è¯¥å¦‚ä½•åŒ–è§£ã€‚`,
        responses: {
            wisdom: { text: "åˆ†æè¯¯ä¼šçš„å…³é”®ç‚¹ã€‚", outcome: { title: "æ´è‹¥è§‚ç«", log: "ä½ æŒ‡å‡ºäº†è¯¯ä¼šçš„å…³é”®ï¼ŒTAçŸ¥é“è¯¥å¦‚ä½•å¤„ç†äº†ã€‚", effects: { favor: 8, trust: 12 } } },
            charm:  { text: "å®‰æ…°TAï¼Œè¡¨ç¤ºå‹è°Šæ€»ä¼šç»å†è€ƒéªŒã€‚", outcome: { title: "æƒ…æ„Ÿæ…°è—‰", log: "ä½ çš„å®‰æ…°è®©TAå¿ƒæƒ…å¥½äº†è®¸å¤šã€‚", effects: { favor: 5, emotionValue: 8 } } },
            virtue: { text: "åŠTAä¸»åŠ¨é“æ­‰ï¼Œå±•ç°æ°”åº¦ã€‚", outcome: { title: "å›å­ä¹‹é£", log: "ä½ åŠTAä¸»åŠ¨ä¼¸å‡ºæ©„æ¦„æï¼Œæ— è®ºå¯¹é”™ï¼Œéƒ½å±•ç°å›å­é£åº¦ã€‚TAæ·±å—è§¦åŠ¨ã€‚", effects: { favor: 10, trust: 15, emotionValue: 10 } } }
        }
    },
    {
        id: 'whistleblowing_dilemma', bestType: 'virtue',
        desc: `æˆ‘æ— æ„ä¸­å¾—çŸ¥ä¸€ä½åŒåƒšä¼¼ä¹æœ‰è¥ç§èˆå¼Šä¹‹ä¸¾ï¼Œæˆ‘åº”ä¸åº”è¯¥æ­å‘æ­¤äº‹ï¼Ÿ`,
        responses: {
            wisdom: { text: "å»ºè®®TAå…ˆæ”¶é›†è¯æ®ï¼Œå†åšå®šå¤ºã€‚", outcome: { title: "è°‹å®šååŠ¨", log: "ä½ å»ºè®®TAä¸è¦æ‰“è‰æƒŠè›‡ï¼Œå…ˆæš—ä¸­æ”¶é›†è¯æ®ã€‚TAè®¤ä¸ºæ­¤è®¡ç”šå¦™ã€‚", effects: { favor: 10, trust: 15 } } },
            charm:  { text: "â€œæ­¤äº‹é£é™©å¤ªå¤§ï¼Œè¿˜æ˜¯æ˜å“²ä¿èº«ä¸ºå¥½ã€‚â€", outcome: { title: "è§„é¿é£é™©", log: "ä½ åŠTAä¸è¦å·å…¥å…¶ä¸­ï¼ŒTAé™·å…¥äº†æ²‰æ€ã€‚", effects: { favor: -5, trust: 5 } } },
            virtue: { text: "â€œä¸ºå›½ä¸ºæ°‘ï¼Œä¹‰ä¸å®¹è¾ï¼â€", outcome: { title: "æ­£ä¹‰å‡›ç„¶", log: "ä½ çš„æ­£ä¹‰æ„Ÿæ·±æ·±æ„ŸæŸ“äº†TAï¼ŒTAå†³å®šæŒºèº«è€Œå‡ºï¼", effects: { favor: 15, trust: 20 } } }
        }
    },
    {
        id: 'moral_doubt', bestType: 'virtue',
        desc: `çœ¼è§èº«è¾¹ä¹‹äººä¸ºè¿½åé€åˆ©ä¸æ‹©æ‰‹æ®µï¼Œæˆ‘æ—¶å¸¸ä¼šæ€€ç–‘ï¼Œåšå®ˆæœ¬å¿ƒæ˜¯å¦çœŸçš„æ­£ç¡®ã€‚`,
        responses: {
            wisdom: { text: "â€œåšå®ˆæœ¬å¿ƒå¹¶éè¿‚è…ï¼Œè€Œæ˜¯å¤§æ™ºæ…§ã€‚â€", outcome: { title: "æ™ºæ…§ä¹‹è¨€", log: "ä½ ç”¨å……æ»¡æ™ºæ…§çš„è¨€è¯­ï¼Œè®ºè¯äº†åšå®ˆæœ¬å¿ƒçš„é•¿è¿œç›Šå¤„ã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œæ— è®ºä¸–ç•Œå¦‚ä½•ï¼Œæˆ‘éƒ½ä¼šé™ªä½ åšå®ˆã€‚â€", outcome: { title: "åšå®šçš„é™ªä¼´", log: "ä½ çš„é™ªä¼´æ˜¯TAæœ€å¤§çš„åŠ›é‡ï¼ŒTAçš„ç–‘è™‘çƒŸæ¶ˆäº‘æ•£ã€‚", effects: { favor: 12, emotionValue: 15 } } },
            virtue: { text: "ç”¨å¤ä»£å…ˆè´¤çš„æ•…äº‹æ¿€åŠ±TAã€‚", outcome: { title: "å…ˆè´¤ä¹‹å¿—", log: "ä½ è®²è¿°äº†å¤ä»£å…ˆè´¤çš„æ•…äº‹ï¼ŒTAæ·±å—é¼“èˆï¼Œé‡æ‹¾äº†ä¿¡å¿µã€‚", effects: { favor: 10, trust: 15 } } }
        }
},
{
        id: 'difficult_superior', bestType: 'wisdom',
        desc: `æˆ‘çš„ä¸Šå¸ä¸ºäººåˆ»è–„ï¼Œæ—¶å¸¸å°†æˆ‘çš„åŠŸåŠ³æ®ä¸ºå·±æœ‰ï¼Œæˆ‘å®åœ¨ä¸çŸ¥è¯¥å¦‚ä½•ä¸ä»–ç›¸å¤„ã€‚`,
        responses: {
            wisdom: { text: "å¿ä¸€æ—¶ä¹‹æ°”ï¼Œæš—ä¸­ç§¯è“„å®åŠ›ä¸äººè„‰ï¼Œç­‰å¾…æ—¶æœºã€‚", outcome: { title: "å§è–ªå°èƒ†", log: "ä½ å»ºè®®TAæš‚é¿é”‹èŠ’ï¼Œé™å¾…è‰¯æœºã€‚TAè®¤ä¸ºè¿™æ˜¯è€æˆä¹‹è¨€ï¼Œå¿ƒä¸­æœ‰äº†è®¡è¾ƒã€‚", effects: { favor: 8, trust: 15 } } },
            charm:  { text: "æˆ–è®¸æ˜¯æ²Ÿé€šä¸è¶³ï¼Œä¸å¦‚å¤‡äº›è–„ç¤¼ï¼Œå¤šèµ°åŠ¨èµ°åŠ¨ï¼Ÿ", outcome: { title: "åœ†æ»‘ä¹‹é“", log: "ä½ çš„å»ºè®®è™½åœ†æ»‘ï¼Œä½†TAè§‰å¾—è¿™å¹¶éé•¿ä¹…ä¹‹è®¡ã€‚", effects: { favor: 3, trust: 5 } } },
            virtue: { text: "å½“é¢ä¸ä»–å¯¹è´¨ï¼Œå›å­ä¸ç«‹äºå±å¢™ä¹‹ä¸‹ã€‚", outcome: { title: "æ­£æ°”å‡›ç„¶", log: "ä½ çš„è¯è™½æ­£æ°”å‡›ç„¶ï¼Œä½†TAä¹Ÿæ˜ç™½ï¼Œå¦‚æ­¤è¡Œäº‹æ— å¼‚äºä»¥åµå‡»çŸ³ã€‚", effects: { favor: -5, trust: 10 } } }
        }
    },
    {
        id: 'passed_over_promotion', bestType: 'charm',
        desc: `ä¸€ä¸ªé‡è¦çš„æ™‹å‡æœºä¼šï¼Œæˆ‘è‡ªè®¤èƒ½åŠ›è¶³å¤Ÿï¼Œæœ€ç»ˆå´è½åˆ°äº†ä¸€ä¸ªè¿œä¸å¦‚æˆ‘çš„äººå¤´ä¸Šï¼Œå®åœ¨æ„éš¾å¹³ã€‚`,
        responses: {
            wisdom: { text: "åˆ†ææ­¤æ¬¡å¤±è´¥çš„åŸå› ï¼Œæ˜¯èƒ½åŠ›è¿˜æ˜¯äººè„‰ï¼Ÿ", outcome: { title: "å†·é™åˆ†æ", log: "ä½ çš„å†·é™åˆ†æè®©TAä»æƒ…ç»ªä¸­æŠ½ç¦»ï¼Œå¼€å§‹åæ€è‡ªå·±çš„ä¸è¶³ã€‚", effects: { favor: 10, trust: 15 } } },
            charm:  { text: "â€œæ˜¯ä»–ä»¬æœ‰çœ¼æ— ç ï¼Œåœ¨æˆ‘å¿ƒé‡Œä½ æœ€å‡ºè‰²ã€‚â€", outcome: { title: "æ¸©æŸ”çš„è‚¯å®š", log: "ä½ çš„è‚¯å®šå’Œå®‰æ…°æ˜¯TAæ­¤åˆ»æœ€éœ€è¦çš„æ…°è—‰ï¼ŒTAå¯¹ä½ å¥½æ„Ÿå¤§å¢ã€‚", effects: { favor: 15, emotionValue: 15 } } },
            virtue: { text: "â€œæ‰èƒ½ä¸ä¼šè¢«åŸ‹æ²¡ï¼Œç»§ç»­åšå¥½åˆ†å†…äº‹å³å¯ã€‚â€", outcome: { title: "åŠæ…°", log: "ä½ åŠTAç»§ç»­åŠªåŠ›ï¼ŒTAç‚¹äº†ç‚¹å¤´ï¼Œä½†çœ‹å¾—å‡ºæƒ…ç»ªä¾æ—§ä½è½ã€‚", effects: { favor: 4, trust: 8 } } }
        }
    },
    {
        id: 'undesirable_posting', bestType: 'virtue',
        desc: `æˆ‘è¢«è°ƒå¾€ä¸€ä¸ªåè¿œè´«ç˜ ä¹‹åœ°ä»»èŒï¼Œå‰é€”æ¸ºèŒ«ï¼Œä¸çŸ¥æ˜¯å¦è¯¥æ¥å—ä»»å‘½ã€‚`,
        responses: {
            wisdom: { text: "â€œç©·å±±æ¶æ°´ï¼Œäº¦æ˜¯å»ºåŠŸç«‹ä¸šä¹‹åœ°ã€‚â€", outcome: { title: "å±ä¸­æœ‰æœº", log: "ä½ ä¸ºTAåˆ†æäº†æ­¤äº‹èƒŒåçš„æœºé‡ï¼ŒTAé‡æ‹¾äº†ä¿¡å¿ƒã€‚", effects: { favor: 10, trust: 12 } } },
            charm:  { text: "â€œæ— è®ºä½ èº«åœ¨ä½•æ–¹ï¼Œæˆ‘éƒ½ä¼šç­‰ä½ ã€‚â€", outcome: { title: "åšå®šçš„æ‰¿è¯º", log: "ä½ çš„æ‰¿è¯ºè®©TAæ„ŸåŠ¨ä¸å·²ï¼Œè§‰å¾—æ— è®ºå»å“ªéƒ½æœ‰äº†åŠ¨åŠ›ã€‚", effects: { favor: 12, emotionValue: 18 } } },
            virtue: { text: "â€œä¸ºå®˜è€…ï¼Œå½“ä¸è¾è¾›è‹¦ï¼Œä¸ºæ°‘åŠäº‹ã€‚â€", outcome: { title: "å¤§ä¹‰å‡›ç„¶", log: "ä½ çš„å¤§ä¹‰å‡›ç„¶è®©TAæ·±å—è§¦åŠ¨ï¼Œå†³å®šèµ°é©¬ä¸Šä»»ã€‚", effects: { favor: 8, trust: 15 } } }
        }
    },
    // --- å®¶åº­/äº²æ—ç±» ---
    {
        id: 'sibling_rivalry', bestType: 'virtue',
        desc: `æˆ‘ä¸å…„é•¿å› å®¶äº§åˆ†å‰²ä¹‹äº‹ï¼Œé—¹å¾—æœ‰äº›ä¸æ„‰å¿«ï¼Œæ¯äº²ä¸ºæ­¤å¾ˆæ˜¯ä¼¤å¿ƒã€‚`,
        responses: {
            wisdom: { text: "å˜æ¸…è´¦ç›®ï¼ŒæŒ‰æ³•ç†ä¸æƒ…ç†æå‡ºåˆ†å‰²æ–¹æ¡ˆã€‚", outcome: { title: "æ¡ç†åˆ†æ˜", log: "ä½ æå‡ºäº†ä¸€ä¸ªæ¸…æ™°çš„æ–¹æ¡ˆï¼ŒTAè®¤ä¸ºæ­¤æ³•å¯è¡Œã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "æ¯•ç«Ÿæ˜¯è¡€è„‰è‡³äº²ï¼Œä¸å¦‚å…ˆæœä¸ªè½¯ï¼Œå“„å“„æ¯äº²ã€‚", outcome: { title: "å’Œç¨€æ³¥", log: "ä½ çš„å»ºè®®èƒ½æš‚æ—¶ç¼“å’Œæ°”æ°›ï¼Œä½†é—®é¢˜å¹¶æœªè§£å†³ã€‚", effects: { favor: 4, emotionValue: 8 } } },
            virtue: { text: "â€œé’±è´¢ä¹ƒèº«å¤–ä¹‹ç‰©ï¼Œå®¶äººå’Œç¦æ–¹ä¸ºæ ¹æœ¬ã€‚â€", outcome: { title: "æ‰‹è¶³æƒ…æ·±", log: "ä½ çš„è¯è®©TAå¹¡ç„¶é†’æ‚Ÿï¼Œå†³å®šä»¥äº²æƒ…ä¸ºé‡ã€‚TAå¯¹ä½ çš„å“å¾·æ•¬ä½©ä¸å·²ã€‚", effects: { favor: 12, trust: 18, emotionValue: 10 } } }
        }
    },
    {
        id: 'child_rebellion', bestType: 'charm',
        desc: `æˆ‘çš„å­©å­æœ€è¿‘æ„ˆå‘å›é€†ï¼Œä¸æˆ‘é¢‘é¢‘é¡¶æ’ï¼Œæˆ‘çœŸä¸çŸ¥è¯¥å¦‚ä½•æ˜¯å¥½ã€‚`,
        responses: {
            wisdom: { text: "åˆ†æå­©å­å›é€†çš„æ ¹æºï¼Œå¯¹ç—‡ä¸‹è¯ã€‚", outcome: { title: "å¯»æ‰¾æ ¹æº", log: "ä½ å»ºè®®TAå¤šè§‚å¯Ÿï¼Œå¯»æ‰¾å­©å­å›é€†çš„æ·±å±‚åŸå› ï¼ŒTAè§‰å¾—å¾ˆæœ‰é“ç†ã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œå­©å­é•¿å¤§äº†ï¼Œå¤šäº›è€å¿ƒï¼Œè¯•ç€åƒæœ‹å‹ä¸€æ ·ç›¸å¤„ã€‚â€", outcome: { title: "æ˜¥é£åŒ–é›¨", log: "ä½ çš„æ¸©æŸ”å»ºè®®è®©TAç„¦èºçš„å¿ƒæƒ…å¹³é™ä¸‹æ¥ï¼Œå†³å®šå°è¯•æ–°çš„æ²Ÿé€šæ–¹å¼ã€‚", effects: { favor: 10, emotionValue: 12 } } },
            virtue: { text: "â€œæ£æ£’åº•ä¸‹å‡ºå­å­ï¼Œä¸¥åŠ ç®¡æ•™æ€»æ˜¯æ²¡é”™çš„ã€‚â€", outcome: { title: "ä¸¥å¸ˆå‡ºé«˜å¾’", log: "ä½ çš„å»ºè®®è®©TAè§‰å¾—æˆ–è®¸åº”è¯¥æ›´ä¸¥å‰äº›ï¼Œä½†è¿™ä¼¼ä¹ä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚", effects: { favor: -5, trust: 5 } } }
        }
    },
    {
        id: 'family_scandal', bestType: 'wisdom',
        desc: `æˆ‘çš„ä¸€ä½æ—äº²åœ¨å¤–æƒ¹ä¸‹é£æµå€ºï¼Œå¦‚ä»Šé—¹å¾—æ»¡åŸé£é›¨ï¼Œå®¶æ—é¢œé¢å°½å¤±ã€‚`,
        responses: {
            wisdom: { text: "â€œå¿«åˆ€æ–©ä¹±éº»ï¼Œå…¬å¼€å¤„ç½®ï¼Œä»¥æ­£å®¶é£ã€‚â€", outcome: { title: "é›·éœ†æ‰‹æ®µ", log: "ä½ å»ºè®®TAç”¨é›·éœ†æ‰‹æ®µå¤„ç†æ­¤äº‹ï¼Œä»¥ç»´æŠ¤å®¶æ—å£°èª‰ã€‚TAè®¤ä¸ºæ­¤ä¹ƒä¸Šç­–ã€‚", effects: { favor: 10, trust: 15 } } },
            charm:  { text: "â€œäººéåœ£è´¤ï¼Œå­°èƒ½æ— è¿‡ï¼Œç§ä¸‹è§£å†³ä¸ºå¥½ã€‚â€", outcome: { title: "å®¶ä¸‘ä¸å¯å¤–æ‰¬", log: "ä½ å»ºè®®ç§ä¸‹è§£å†³ï¼Œä½†TAæ‹…å¿ƒè¿™ä¼šç•™ä¸‹åæ‚£ã€‚", effects: { favor: 2, trust: 5 } } },
            virtue: { text: "â€œæ‰¿æ‹…è´£ä»»ï¼Œä¸ºæ—äº²å¼¥è¡¥è¿‡é”™ã€‚â€", outcome: { title: "å¼•å’è‡ªè´£", log: "ä½ çš„å»ºè®®è™½æ˜¾å“å¾·é«˜å°šï¼Œä½†ä¼¼ä¹ä¸å¤ªç°å®ã€‚", effects: { favor: -2, trust: 8 } } }
        }
    },
    // --- äººé™…/ç¤¾äº¤ç±» ---
    {
        id: 'friend_betrayal', bestType: 'charm',
        desc: `æˆ‘ä¸€ç›´ä¿¡èµ–çš„ä¸€ä½æœ‹å‹ï¼Œç«Ÿä¸ºäº†åˆ©ç›Šåœ¨èƒŒåä¸­ä¼¤æˆ‘ï¼Œæˆ‘æ—¢æ„¤æ€’åˆç—›å¿ƒã€‚`,
        responses: {
            wisdom: { text: "â€œçœ‹æ¸…ä¸€äººï¼Œæ€»æ¯”ä¸€ä¸–è¢«è’™åœ¨é¼“é‡Œè¦å¥½ã€‚â€", outcome: { title: "åŠæ—¶æ­¢æŸ", log: "ä½ ç†æ€§çš„åˆ†æè®©TAå¥½å—äº†ä¸€äº›ã€‚", effects: { favor: 6, trust: 8 } } },
            charm:  { text: "â€œæ— éœ€ä¸ºè¿™ç­‰äººä¼¤å¿ƒï¼Œä½ è¿˜æœ‰æˆ‘ã€‚â€", outcome: { title: "åšå®šçš„é™ªä¼´", log: "ä½ åšå®šçš„é™ªä¼´æ˜¯TAæ­¤åˆ»æœ€éœ€è¦çš„ã€‚TAç´§ç´§æ¡ä½ä½ çš„æ‰‹ï¼Œæ„Ÿæ¿€ä¸å·²ã€‚", effects: { favor: 18, emotionValue: 25 } } },
            virtue: { text: "â€œæˆ–è®¸å…¶ä¸­æœ‰è¯¯ä¼šï¼Ÿä¸å¦‚æ‰¾æœºä¼šé—®ä¸ªæ¸…æ¥šã€‚â€", outcome: { title: "å›å­ä¹‹å¿ƒ", log: "ä½ çš„å–„è‰¯è®©TAæœ‰äº›çŠ¹è±«ï¼Œä½†èƒŒå›çš„ä¼¤ç—›ä»åœ¨ã€‚", effects: { favor: 2, trust: 5 } } }
        }
    },
    {
        id: 'public_rumors', bestType: 'virtue',
        desc: `æœ€è¿‘ä¸çŸ¥ä¸ºä½•ï¼ŒåŠé—´æ€»æœ‰äº›å…³äºæˆ‘çš„æµè¨€èœšè¯­ï¼Œè™½ç„¶æ— ä¼¤å¤§é›…ï¼Œå´ä¹Ÿä»¤äººçƒ¦é—·ã€‚`,
        responses: {
            wisdom: { text: "â€œæµè¨€æ­¢äºæ™ºè€…ï¼Œä½†æœ‰æ—¶ä¹Ÿéœ€é‡œåº•æŠ½è–ªã€‚â€", outcome: { title: "é‡œåº•æŠ½è–ª", log: "ä½ å»ºè®®TAæš—ä¸­è°ƒæŸ¥æµè¨€æºå¤´ï¼ŒTAè®¤ä¸ºæ­¤è®¡å¯è¡Œã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œä¸è¿‡æ˜¯åº¸äººè‡ªæ‰°ï¼Œæˆ‘é™ªä½ é¥®é…’èµæœˆï¼Œè«ç®¡å®ƒã€‚â€", outcome: { title: "æ½‡æ´’ä¸ç¾", log: "ä½ çš„æ½‡æ´’æ„ŸæŸ“äº†TAï¼ŒTAå†³å®šä¸å†ä¸ºæ­¤çƒ¦å¿ƒã€‚", effects: { favor: 6, emotionValue: 10 } } },
            virtue: { text: "â€œèº«æ­£ä¸æ€•å½±å­æ–œï¼Œæ¸…è€…è‡ªæ¸…ã€‚â€", outcome: { title: "æ¸…è€…è‡ªæ¸…", log: "ä½ çš„è¯è®©TAå¿ƒå®‰ï¼Œå†³å®šä»¥å¦è¡ä¹‹å§¿é¢å¯¹æµè¨€ã€‚", effects: { favor: 10, trust: 12, emotionValue: 5 } } }
        }
    },
    {
        id: 'owing_favor', bestType: 'wisdom',
        desc: `æˆ‘æ›¾å—è¿‡ä¸€ä½å‰è¾ˆå¤§æ©ï¼Œå¦‚ä»Šä»–è¯·æˆ‘åŠä¸€ä»¶é¢‡ä¸ºæ£˜æ‰‹çš„äº‹ï¼Œæˆ‘è‹¥åŠä¸å¥½ï¼Œæœ‰è´Ÿæ©æƒ…ï¼Œè‹¥åº”ä¸‹ï¼Œåˆæ€•åŠ›æœ‰ä¸é€®ã€‚`,
        responses: {
            wisdom: { text: "â€œå¦è¯šç›¸å‘Šï¼Œè¨€æ˜å…¶ä¸­éš¾å¤„ï¼Œå¯»æ±‚å˜é€šä¹‹æ³•ã€‚â€", outcome: { title: "å¦è¯šä¸ºä¸Š", log: "ä½ å»ºè®®TAå¦è¯šæ²Ÿé€šï¼Œä¸æ‰“è‚¿è„¸å……èƒ–å­ã€‚TAè®¤ä¸ºè¿™æ˜¯æœ€ç¨³å¦¥çš„åŠæ³•ã€‚", effects: { favor: 12, trust: 15 } } },
            charm:  { text: "â€œå…ˆåº”ä¸‹å†è¯´ï¼Œå±•ç°ä½ çš„è¯šæ„æ€»æ˜¯å¥½çš„ã€‚â€", outcome: { title: "å…ˆè¡Œåº”å…", log: "ä½ çš„å»ºè®®è®©TAè§‰å¾—æœ‰é“ç†ï¼Œä½†å†…å¿ƒè¿˜æ˜¯ä¸å®‰ã€‚", effects: { favor: 2, trust: 5 } } },
            virtue: { text: "â€œå—äººæ»´æ°´ä¹‹æ©ï¼Œå½“æ¶Œæ³‰ç›¸æŠ¥ï¼Œç†åº”ç«­å°½å…¨åŠ›ã€‚â€", outcome: { title: "æ¶Œæ³‰ç›¸æŠ¥", log: "ä½ çš„è¯è®©TAä¸‹å®šå†³å¿ƒï¼Œæ— è®ºå¤šéš¾éƒ½è¦å»å°è¯•ã€‚", effects: { favor: 8, trust: 10 } } }
        }
    },
    // --- ä¸ªäºº/å“²æ€ç±» ---
    {
        id: 'creative_block', bestType: 'charm',
        desc: `æˆ‘è¿‘æ¥çµæ„Ÿæ¯ç«­ï¼Œé¢å¯¹ç”»å·/ç´è°±ï¼Œç«Ÿæ— ä¸€ç¬”/ä¸€éŸ³å¯å‡ºï¼Œå®åœ¨è‹¦é—·ã€‚`,
        responses: {
            wisdom: { text: "åˆ†æè¿‡å»çš„ä½œå“ï¼Œæ€»ç»“é£æ ¼ï¼Œå¯»æ±‚çªç ´ã€‚", outcome: { title: "æŠ€æ³•åˆ†æ", log: "ä½ çš„åˆ†æå¾ˆæœ‰é“ç†ï¼Œä½†TAè§‰å¾—è‰ºæœ¯å¹¶éå…¨ç„¶æ˜¯æŠ€å·§ä¹‹äº‹ã€‚", effects: { favor: 3, trust: 5 } } },
            charm:  { text: "â€œä¸å¦‚æ”¾ä¸‹ç¬”å¢¨ï¼Œæˆ‘é™ªä½ ç™»å±±ä¸´æ°´ï¼Œäºå¤©åœ°é—´å¯»æ‰¾ä½³å…´ã€‚â€", outcome: { title: "çµæ„Ÿä¹‹æ³‰", log: "ä½ çš„æè®®è®©TAçœ¼å‰ä¸€äº®ï¼Œå†³å®šä¸ä½ åŒæ¸¸ã€‚TAæ„Ÿåˆ°æ— æ¯”çš„æ”¾æ¾ä¸æ…°è—‰ã€‚", effects: { favor: 15, emotionValue: 20 } } },
            virtue: { text: "â€œå¤©é“é…¬å‹¤ï¼Œåªéœ€å‹¤åŠ ç»ƒä¹ ï¼Œçµæ„Ÿè‡ªä¼šå›æ¥ã€‚â€", outcome: { title: "å‹¤èƒ½è¡¥æ‹™", log: "ä½ çš„é¼“åŠ±è®©TAæŒ¯ä½œäº†ç²¾ç¥ï¼Œå†³å®šç»§ç»­åŸ‹å¤´è‹¦ç»ƒã€‚", effects: { favor: 5, trust: 8 } } }
        }
    },
    {
        id: 'past_mistake', bestType: 'virtue',
        desc: `æˆ‘æ—¶å¸¸ä¼šæƒ³èµ·å¹´è½»æ—¶çŠ¯ä¸‹çš„ä¸€ä¸ªé”™ï¼Œè™½äº‹è¿‡å¢ƒè¿ï¼Œä½†è‡³ä»Šä»æ— æ³•é‡Šæ€€ã€‚`,
        responses: {
            wisdom: { text: "â€œäººæ— æ³•æ”¹å˜è¿‡å»ï¼Œä½†èƒ½å†³å®šå°†æ¥å¦‚ä½•å¼¥è¡¥ã€‚â€", outcome: { title: "ç€çœ¼æœªæ¥", log: "ä½ çš„è¯è®©TAå°†ç›®å…‰ä»è¿‡å»è½¬å‘äº†æœªæ¥ã€‚", effects: { favor: 8, trust: 12 } } },
            charm:  { text: "åˆ†äº«ä½ è‡ªå·±çš„ä¸€ä¸ªç³—äº‹ï¼Œè®©TAé‡Šç„¶ã€‚", outcome: { title: "åŒç†ä¹‹å¿ƒ", log: "ä½ çš„è‡ªå˜²è®©TAç¬‘å‡ºå£°æ¥ï¼ŒåŸæ¥äººäººéƒ½æœ‰ä¸å ªå›é¦–çš„è¿‡å¾€ã€‚", effects: { favor: 10, emotionValue: 15 } } },
            virtue: { text: "â€œçŸ¥é”™èƒ½æ”¹ï¼Œå–„è«å¤§ç„‰ï¼Œé‡è¦çš„æ˜¯ä½ å·²éæ˜¨æ—¥ä¹‹äººã€‚â€", outcome: { title: "åœ£äººä¹‹è¨€", log: "ä½ ç”¨åœ£äººä¹‹è¨€å¼€è§£TAï¼ŒTAæ„Ÿåˆ°å†…å¿ƒçš„æ·é”è¢«æ‰“å¼€äº†ã€‚", effects: { favor: 12, trust: 15, emotionValue: 10 } } }
        }
    },
    {
        id: 'fear_of_aging', bestType: 'charm',
        desc: `è¿‘æ—¥ç…§é•œï¼Œå¿½è§é¬“è¾¹æ·»äº†ç™½å‘ï¼Œä¸å…æ„Ÿå¹å²æœˆæ— æƒ…ï¼ŒéŸ¶åæ˜“é€ã€‚`,
        responses: {
            wisdom: { text: "â€œç”Ÿè€ç—…æ­»ï¼Œæœ¬æ˜¯è‡ªç„¶è§„å¾‹ï¼Œæ— éœ€ä»‹æ€€ã€‚â€", outcome: { title: "å¹³å¸¸å¿ƒ", log: "ä½ çš„è¯å¾ˆæœ‰é“ç†ï¼Œä½†å¹¶ä¸èƒ½å®Œå…¨é©±æ•£TAçš„ä¼¤æ„Ÿã€‚", effects: { favor: 3, trust: 5 } } },
            charm:  { text: "â€œåœ¨æˆ‘çœ¼ä¸­ï¼Œå²æœˆåªä¸ºä½ å¢æ·»äº†é£éŸµã€‚â€", outcome: { title: "æƒ…äººçœ¼é‡Œå‡ºè¥¿æ–½", log: "ä½ çš„ç”œè¨€èœœè¯­è®©TAè½¬å¿§ä¸ºå–œï¼Œå¯¹ä½ å¥½æ„Ÿå€å¢ã€‚", effects: { favor: 18, emotionValue: 20 } } },
            virtue: { text: "â€œå¾·è¡Œä¸æ™ºæ…§ï¼Œæ‰æ˜¯å²æœˆæœ€å¥½çš„é¦ˆèµ ã€‚â€", outcome: { title: "å†…åœ¨ä¹‹ç¾", log: "ä½ çš„è¯è®©TAå¼€å§‹å®¡è§†å†…åœ¨çš„ä»·å€¼ï¼Œé¢‡æœ‰æ„Ÿæ‚Ÿã€‚", effects: { favor: 8, trust: 10 } } }
        }
    },
    // --- è´¢åŠ¡/ç‰©è´¨ç±» ---
    {
        id: 'financial_loss', bestType: 'wisdom',
        desc: `æˆ‘çš„ä¸€ç¬”æŠ•èµ„è¡€æœ¬æ— å½’ï¼Œè¿‘æ¥æ‰‹å¤´é¢‡ä¸ºæ‹®æ®ã€‚`,
        responses: {
            wisdom: { text: "â€œèƒœè´¥ä¹ƒå…µå®¶å¸¸äº‹ï¼Œå¤ç›˜å¾—å¤±ï¼Œä»¥å›¾å†èµ·ã€‚â€", outcome: { title: "å¤ç›˜", log: "ä½ å¸®TAåˆ†æäº†å¤±è´¥çš„åŸå› ï¼ŒTAè§‰å¾—å—ç›ŠåŒªæµ…ã€‚", effects: { favor: 10, trust: 12 } } },
            charm:  { text: "â€œé’±è´¢æ•£å°½è¿˜å¤æ¥ï¼Œè«ä¸ºæ­¤äº‹ä¼¤ç¥ã€‚â€", outcome: { title: "æ´’è„±", log: "ä½ çš„æ´’è„±è®©TAå¿ƒæƒ…å¥½äº†è®¸å¤šã€‚", effects: { favor: 5, emotionValue: 8 } } },
            virtue: { text: "ä¸»åŠ¨æ‹¿å‡ºä¸€äº›é’±è´¢èµ„åŠ©TAã€‚", outcome: { title: "é›ªä¸­é€ç‚­", log: "ä½ çš„ä»—ä¹‰ç–è´¢è®©TAå¤§ä¸ºæ„ŸåŠ¨ï¼Œè§†ä½ ä¸ºç”Ÿæ­»ä¹‹äº¤ã€‚", effects: { favor: 20, trust: 25 } } }
        }
    },
    {
        id: 'risky_investment', bestType: 'wisdom',
        desc: `æˆ‘å‘ç°ä¸€ä¸ªæµ·å¤–è´¸æ˜“çš„æœºä¼šï¼Œåˆ©æ¶¦æå¤§ï¼Œä½†é£é™©ä¹Ÿæé«˜ï¼Œæ­£åœ¨çŠ¹è±«æ˜¯å¦è¦æŠ¼ä¸Šå…¨éƒ¨èº«å®¶ã€‚`,
        responses: {
            wisdom: { text: "â€œé¸¡è›‹ä¸èƒ½æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œï¼Œç†åº”åˆ†æ•£é£é™©ã€‚â€", outcome: { title: "åˆ†æ•£é£é™©", log: "ä½ çš„ç†æ™ºåŠå‘Šè®©TAå†·é™ä¸‹æ¥ï¼Œå†³å®šå…ˆå°è§„æ¨¡å°è¯•ã€‚", effects: { favor: 12, trust: 15 } } },
            charm:  { text: "â€œæˆ‘ç›¸ä¿¡ä½ çš„çœ¼å…‰ï¼Œæ— è®ºç»“æœå¦‚ä½•ï¼Œæˆ‘éƒ½ä¼šæ”¯æŒä½ ã€‚â€", outcome: { title: "æ— æ¡ä»¶æ”¯æŒ", log: "ä½ çš„æ”¯æŒç»™äº†TAå·¨å¤§çš„å‹‡æ°”ã€‚", effects: { favor: 10, emotionValue: 15 } } },
            virtue: { text: "â€œå›å­çˆ±è´¢ï¼Œå–ä¹‹æœ‰é“ï¼Œæ­¤äº‹éœ€ç¡®ä¿åˆä¹é“ä¹‰ã€‚â€", outcome: { title: "é“ä¹‰ä¸ºå…ˆ", log: "ä½ æé†’TAè¦è€ƒè™‘å…¶ä¸­çš„é“ä¹‰é—®é¢˜ã€‚", effects: { favor: 5, trust: 8 } } }
        }
    },
    {
        id: 'loan_pressure', bestType: 'virtue',
        desc: `æˆ‘çš„ä¸€ä½æ—äº²å‰æ¥å€Ÿé’±ï¼Œæ•°é¢ä¸å°ï¼Œæˆ‘æ‹…å¿ƒTAæ— åŠ›å¿è¿˜ï¼Œåˆä¸å¥½æ„æ€æ‹’ç»ã€‚`,
        responses: {
            wisdom: { text: "â€œæˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”ï¼Œä¸å¦‚å¸®TAæ‰¾ä¸ªè¥ç”Ÿã€‚â€", outcome: { title: "æˆäººä»¥æ¸”", log: "ä½ çš„å»ºè®®ä¸ºTAæä¾›äº†ä¸€ä¸ªå…¨æ–°çš„æ€è·¯ã€‚", effects: { favor: 10, trust: 10 } } },
            charm:  { text: "â€œæ­¤äº‹ç¡®å®ä¸¤éš¾ï¼Œä¸å¦‚æˆ‘æ›¿ä½ æƒ³ä¸ªè¯´è¾ï¼Ÿâ€", outcome: { title: "è§£å›´", log: "ä½ ä¸ºTAæƒ³äº†ä¸€ä¸ªå¾—ä½“çš„å€Ÿå£ï¼Œå¸®TAè§£äº†å›´ã€‚", effects: { favor: 8, emotionValue: 10 } } },
            virtue: { text: "â€œæ•‘æ€¥ä¸æ•‘ç©·ï¼Œè‹¥æ˜¯æ€¥ç”¨ï¼Œç†å½“ç›¸åŠ©ã€‚â€", outcome: { title: "æ•‘æ€¥", log: "ä½ å»ºè®®TAé—®æ¸…ç¼˜ç”±ï¼Œè‹¥æ˜¯æ€¥ç”¨åˆ™åº”å½“å¸®åŠ©ã€‚TAè®¤ä¸ºæ­¤è¨€ç”šæ˜¯ã€‚", effects: { favor: 12, trust: 15 } } }
        }
    },
// --- æ–°å¢15ä¸ªäº‹ä»¶ ---
    {
        id: 'pet_sickness', bestType: 'charm',
        desc: `æˆ‘å…»äº†å¤šå¹´çš„çˆ±å® è¿‘æ¥ç²¾ç¥èé¡ï¼ŒèŒ¶é¥­ä¸æ€ï¼Œè¯·äº†å‡ ä¸ªå¤§å¤«ä¹Ÿç§ä¸å‡ºæ‰€ä»¥ç„¶ã€‚`,
        responses: {
            wisdom: { text: "â€œæˆ–è®¸å¯ä»¥è¯•è¯•æ°‘é—´çš„åæ–¹ï¼Ÿâ€", outcome: { title: "åæ–¹", log: "ä½ ä¸ºTAæä¾›äº†ä¸€äº›åæ–¹æ€è·¯ï¼ŒTAå†³å®šå»è¯•è¯•ã€‚", effects: { favor: 5, trust: 8 } } },
            charm:  { text: "â€œæˆ‘é™ªä½ ä¸€èµ·ç…§é¡¾å®ƒï¼Œå®ƒä¼šå¥½èµ·æ¥çš„ã€‚â€", outcome: { title: "æ¸©æŸ”çš„é™ªä¼´", log: "ä½ çš„é™ªä¼´å’Œæ¸©æŸ”çš„è¯è¯­ç»™äº†TAå·¨å¤§çš„å®‰æ…°ï¼ŒTAè§‰å¾—æœ‰ä½ åœ¨çœŸå¥½ã€‚", effects: { favor: 12, emotionValue: 15 } } },
            virtue: { text: "â€œä¸‡ç‰©çš†æœ‰çµï¼Œä¸ºå®ƒç¥ˆç¦å§ã€‚â€", outcome: { title: "ç¥ˆç¦", log: "ä½ å»ºè®®ä¸ºå® ç‰©ç¥ˆç¦ï¼ŒTAè§‰å¾—å¿ƒè¯šåˆ™çµã€‚", effects: { favor: 3, trust: 5 } } }
        }
    },
    {
        id: 'lost_item', bestType: 'wisdom',
        desc: `æˆ‘çš„ä¸€ä»¶é‡è¦ä¿¡ç‰©ä¸æ…é—å¤±ï¼Œæ‰¾äº†è®¸ä¹…ä¹Ÿæ‰¾ä¸åˆ°ï¼Œå¿ƒä¸­ç„¦æ€¥ä¸‡åˆ†ã€‚`,
        responses: {
            wisdom: { text: "â€œåˆ«æ€¥ï¼Œæˆ‘ä»¬ä¸€èµ·å›å¿†ä½ æœ€åè§åˆ°å®ƒçš„åœ°æ–¹ï¼Œå†ç”»å‡ºè·¯çº¿å›¾å¯»æ‰¾ã€‚â€", outcome: { title: "ç¼œå¯†åˆ†æ", log: "åœ¨ä½ çš„å¸®åŠ©ä¸‹ï¼ŒTAç«Ÿç„¶çœŸçš„æ‰¾åˆ°äº†ä¿¡ç‰©ï¼TAå¯¹ä½ çš„æ™ºæ…§é’¦ä½©ä¸å·²ã€‚", effects: { favor: 15, trust: 20 } } },
            charm:  { text: "â€œæ—§çš„ä¸å»ï¼Œæ–°çš„ä¸æ¥ï¼Œæˆ‘å†é€ä½ ä¸€ä»¶æ›´å¥½çš„ã€‚â€", outcome: { title: "ç ´è´¢æ¶ˆç¾", log: "ä½ çš„æ…·æ…¨è®©TAå¾ˆæ„ŸåŠ¨ï¼Œä½†é—å¤±çš„é—æ†¾ä»åœ¨ã€‚", effects: { favor: 8, emotionValue: 10 } } },
            virtue: { text: "â€œå¤±ç‰©è‡ªæœ‰å¤©æ„ï¼Œæˆ–è®¸å®ƒå»äº†è¯¥å»çš„åœ°æ–¹ã€‚â€", outcome: { title: "é¡ºå…¶è‡ªç„¶", log: "ä½ çš„è¯è®©TAçš„å¿ƒæƒ…å¹³é™äº†äº›è®¸ã€‚", effects: { favor: 4, trust: 6 } } }
        }
    },
    {
        id: 'bad_dream', bestType: 'charm',
        desc: `æ˜¨å¤œæˆ‘åšäº†ä¸€ä¸ªå™©æ¢¦ï¼Œè‡³ä»Šå¿ƒæœ‰ä½™æ‚¸ã€‚`,
        responses: {
            wisdom: { text: "â€œæ¢¦å¢ƒçš†è™šå¦„ï¼Œä¸è¿‡æ˜¯æ—¥æœ‰æ‰€æ€ç½¢äº†ã€‚â€", outcome: { title: "ç§‘å­¦è§£é‡Š", log: "ä½ çš„è§£é‡Šå¾ˆæœ‰é“ç†ï¼Œä½†TAçš„æƒ…ç»ªå¹¶æœªå®Œå…¨å¹³å¤ã€‚", effects: { favor: 2, trust: 5 } } },
            charm:  { text: "â€œåˆ«æ€•ï¼Œæœ‰æˆ‘åœ¨ï¼Œæˆ‘ä¼šä¿æŠ¤ä½ ã€‚â€", outcome: { title: "åšå®çš„è‡‚è†€", log: "ä½ æ¸©æš–è€Œæœ‰åŠ›çš„æ‰¿è¯ºï¼Œè®©TAæ„Ÿåˆ°æ— æ¯”å®‰å¿ƒï¼Œæ‰€æœ‰çš„ææƒ§éƒ½çƒŸæ¶ˆäº‘æ•£ã€‚", effects: { favor: 15, emotionValue: 18 } } },
            virtue: { text: "â€œæ®è¯´ä½©æˆ´ç‰å™¨å¯ä»¥å®‰ç¥é©±é‚ªã€‚â€", outcome: { title: "ä¼ ç»Ÿæ™ºæ…§", log: "ä½ å»ºè®®TAä½©æˆ´ç‰å™¨ï¼ŒTAè§‰å¾—æ˜¯ä¸ªå¥½ä¸»æ„ã€‚", effects: { favor: 5, trust: 8 } } }
        }
    },
    {
        id: 'new_skill_frustration', bestType: 'virtue',
        desc: `æˆ‘æœ€è¿‘åœ¨å­¦ä¹ ä¸€é—¨æ–°çš„æŠ€è‰ºï¼Œä½†è¿›å±•ç¼“æ…¢ï¼Œæ—¶å¸¸æ„Ÿåˆ°æŒ«è´¥ã€‚`,
        responses: {
            wisdom: { text: "â€œæˆ–è®¸æ˜¯æ–¹æ³•ä¸å¯¹ï¼Ÿæˆ‘ä»¬ä¸€èµ·åˆ†æä¸€ä¸‹ã€‚â€", outcome: { title: "æ–¹æ³•è®º", log: "ä½ ä»¬ä¸€èµ·åˆ†æï¼Œæ‰¾åˆ°äº†é—®é¢˜çš„ç—‡ç»“æ‰€åœ¨ã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œè¿™æœ‰ä»€ä¹ˆéš¾çš„ï¼Œæˆ‘æ¥æ•™ä½ ã€‚â€", outcome: { title: "è‡ªå¤§çš„ç‚«æŠ€", log: "ä½ çš„ç‚«è€€è®©TAæ„Ÿåˆ°æœ‰äº›ä¸å¿«ã€‚", effects: { favor: -5, trust: 2 } } },
            virtue: { text: "â€œä¸‡äº‹å¼€å¤´éš¾ï¼ŒåšæŒä¸‹å»ï¼Œå¿…æœ‰æ‰€æˆã€‚â€", outcome: { title: "é¼“åŠ±", log: "ä½ çš„é¼“åŠ±æ˜¯TAåšæŒä¸‹å»çš„åŠ¨åŠ›ï¼ŒTAå¯¹ä½ å……æ»¡æ„Ÿæ¿€ã€‚", effects: { favor: 12, trust: 15 } } }
        }
    },
    {
        id: 'social_event_anxiety', bestType: 'charm',
        desc: `æˆ‘å³å°†å‚åŠ ä¸€åœºé‡è¦çš„å®´ä¼šï¼Œä½†ä¸€æƒ³åˆ°è¦ä¸é‚£ä¹ˆå¤šé™Œç”Ÿäººåº”é…¬ï¼Œå°±æ„Ÿåˆ°ç´§å¼ ã€‚`,
        responses: {
            wisdom: { text: "â€œæå‰äº†è§£å®¾å®¢èƒŒæ™¯ï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚â€", outcome: { title: "æœªé›¨ç»¸ç¼ª", log: "ä½ å»ºè®®TAæå‰åšåŠŸè¯¾ï¼ŒTAè®¤ä¸ºæ­¤æ³•ç”šå¥½ã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œåˆ«æ‹…å¿ƒï¼Œåˆ°æ—¶æˆ‘ä¼šä¸€ç›´é™ªåœ¨ä½ èº«è¾¹ã€‚â€", outcome: { title: "å®‰å¿ƒçš„æ‰¿è¯º", log: "ä½ çš„æ‰¿è¯ºè®©TAçš„ç´§å¼ æ„Ÿä¸€æ‰«è€Œç©ºï¼Œå¯¹ä½ å……æ»¡ä¾èµ–ã€‚", effects: { favor: 15, emotionValue: 18 } } },
            virtue: { text: "â€œå¹³å¸¸å¿ƒå¯¹å¾…å³å¯ï¼Œä¸å¿…è¿‡äºåœ¨æ„ä»–äººçœ‹æ³•ã€‚â€", outcome: { title: "å¹³å¸¸å¿ƒ", log: "ä½ åŠTAæ”¾å®½å¿ƒï¼ŒTAç‚¹äº†ç‚¹å¤´ã€‚", effects: { favor: 5, trust: 8 } } }
        }
    },
    {
        id: 'justice_vs_rules', bestType: 'virtue',
        desc: `æˆ‘å‘ç°ä¸€ä½æœ‰åŠŸä¹‹è‡£å› è§¦çŠ¯äº†ä¸€æ¡é™ˆè…çš„è§„å®šè€Œå°†å—é‡ç½šï¼Œäºå¿ƒä¸å¿ã€‚`,
        responses: {
            wisdom: { text: "â€œè§„å®šæ˜¯æ­»çš„ï¼Œäººæ˜¯æ´»çš„ï¼Œå¯å¯»æ±‚å˜é€šä¹‹æ³•ã€‚â€", outcome: { title: "å¯»æ±‚å˜é€š", log: "ä½ å»ºè®®TAåœ¨è§„åˆ™çš„æ¡†æ¶å†…å¯»æ‰¾å¯ä»¥å˜é€šçš„åœ°æ–¹ã€‚", effects: { favor: 10, trust: 12 } } },
            charm:  { text: "â€œæ­¤äº‹ä¸ä½ æˆ‘æ— å…³ï¼Œè¿˜æ˜¯ä¸è¦æ’æ‰‹ä¸ºå¥½ã€‚â€", outcome: { title: "æ˜å“²ä¿èº«", log: "ä½ çš„å»ºè®®è®©TAæ„Ÿåˆ°å¤±æœ›ã€‚", effects: { favor: -8, trust: 2 } } },
            virtue: { text: "â€œä¸ºè‰¯è‡£è¯·å‘½ï¼Œä¹ƒæˆ‘è¾ˆåˆ†å†…ä¹‹äº‹ã€‚â€", outcome: { title: "ä»—ä¹‰æ‰§è¨€", log: "ä½ çš„æ­£ä¹‰æ„Ÿä¸TAä¸è°‹è€Œåˆï¼ŒTAå†³å®šä¸ºä½ å¥”èµ°å‘¼å·ã€‚", effects: { favor: 18, trust: 25 } } }
        }
    },
    {
        id: 'old_friend_changed', bestType: 'charm',
        desc: `æˆ‘ä¸ä¸€ä½å¤šå¹´æœªè§çš„æŒšå‹é‡é€¢ï¼Œå´å‘ç°ä»–å˜å¾—åŠŸåˆ©è€Œé™Œç”Ÿï¼Œå¿ƒä¸­å¾ˆæ˜¯å¤±è½ã€‚`,
        responses: {
            wisdom: { text: "â€œäººæ€»æ˜¯ä¼šå˜çš„ï¼Œå¹³å¸¸å¿ƒçœ‹å¾…å³å¯ã€‚â€", outcome: { title: "å¹³å¸¸å¿ƒ", log: "ä½ çš„è¯å¾ˆæœ‰é“ç†ï¼Œä½†TAçš„å¤±è½å¹¶æœªå‡å°‘ã€‚", effects: { favor: 2, trust: 5 } } },
            charm:  { text: "â€œç‰©æ˜¯äººéï¼Œä½†åº†å¹¸çš„æ˜¯ï¼Œä½ æˆ‘æƒ…è°Šæœªå˜ã€‚â€", outcome: { title: "çæƒœçœ¼å‰äºº", log: "ä½ å°†TAçš„æ³¨æ„åŠ›æ‹‰å›åˆ°ä½ ä»¬çš„æƒ…è°Šä¸Šï¼ŒTAæ„Ÿåˆ°è«å¤§çš„å®‰æ…°ã€‚", effects: { favor: 15, emotionValue: 18 } } },
            virtue: { text: "â€œæˆ–è®¸ä»–æœ‰è‡ªå·±çš„è‹¦è¡·ï¼Œåº”å½“ç†è§£ã€‚â€", outcome: { title: "å®½å®¹", log: "ä½ åŠTAå¤šä¸€ä»½ç†è§£ï¼ŒTAè‹¥æœ‰æ‰€æ€ã€‚", effects: { favor: 5, trust: 8 } } }
        }
    },
    {
        id: 'unworthy_task', bestType: 'wisdom',
        desc: `ä¸Šå¸äº¤ç»™æˆ‘ä¸€ä»¶å¤§æå°ç”¨çš„å·®äº‹ï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±çš„æ‰èƒ½è¢«æµªè´¹äº†ã€‚`,
        responses: {
            wisdom: { text: "â€œäºç»†å¾®å¤„è§çœŸç« ï¼Œå°†æ­¤äº‹åšåˆ°æè‡´ï¼Œäº¦æ˜¯å±•ç°èƒ½åŠ›ã€‚â€", outcome: { title: "ç»†èŠ‚è§çœŸç« ", log: "ä½ çš„è¯è®©TAèŒ…å¡é¡¿å¼€ï¼Œå†³å®šå°†å°äº‹ä¹Ÿåšå‡ºå½©ã€‚", effects: { favor: 12, trust: 15 } } },
            charm:  { text: "â€œä¸å¦‚ç›´æ¥å‘ä¸Šå¸è¡¨æ˜ä½ çš„æƒ³æ³•ï¼Ÿâ€", outcome: { title: "ç›´æ¥æ²Ÿé€š", log: "ä½ çš„å»ºè®®æœ‰äº›ç›´æ¥ï¼ŒTAæ‹…å¿ƒä¼šå¾—ç½ªä¸Šå¸ã€‚", effects: { favor: -3, trust: 2 } } },
            virtue: { text: "â€œæ—¢æ˜¯åˆ†å†…ä¹‹äº‹ï¼Œä¾¿å½“å°½åŠ›å®Œæˆã€‚â€", outcome: { title: "å®‰åˆ†å®ˆå·±", log: "ä½ åŠTAå®‰åˆ†å®ˆå·±ï¼ŒTAç‚¹äº†ç‚¹å¤´ã€‚", effects: { favor: 5, trust: 8 } } }
        }
    },
    {
        id: 'empty_wealth', bestType: 'charm',
        desc: `æˆ‘å¦‚ä»Šå·²ä¸å†ä¸ºç”Ÿè®¡å‘æ„ï¼Œä½†ä¸ºä½•å†…å¿ƒåè€Œæ—¶å¸¸æ„Ÿåˆ°ç©ºè™šï¼Ÿ`,
        responses: {
            wisdom: { text: "â€œç‰©è´¨æ»¡è¶³åï¼Œç²¾ç¥è¿½æ±‚ä¾¿å‡¸æ˜¾äº†ã€‚â€", outcome: { title: "ç²¾ç¥è¿½æ±‚", log: "ä½ ä¸TAæ¢è®¨äº†ç²¾ç¥è¿½æ±‚çš„é‡è¦æ€§ï¼ŒTAé¢‡æœ‰æ„Ÿæ‚Ÿã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œå› ä¸ºä½ ç¼ºå°‘äº†æˆ‘çš„é™ªä¼´å‘€ã€‚â€", outcome: { title: "ç©ç¬‘", log: "ä½ ä¸€å¥ç©ç¬‘è¯ï¼Œé€—å¾—TAç¬‘äº†èµ·æ¥ï¼Œå¿ƒä¸­çš„ç©ºè™šä¼¼ä¹ä¹Ÿæ¶ˆæ•£äº†ä¸å°‘ã€‚", effects: { favor: 15, emotionValue: 18 } } },
            virtue: { text: "â€œä¸å¦‚å°†è´¢å¯Œç”¨äºå¸®åŠ©æ›´å¤šçš„äººï¼Ÿâ€", outcome: { title: "æ…ˆå–„", log: "ä½ å»ºè®®TAæŠ•èº«æ…ˆå–„ï¼ŒTAè®¤ä¸ºè¿™æ˜¯ä¸ªå¾ˆå¥½çš„æ–¹å‘ã€‚", effects: { favor: 10, trust: 12 } } }
        }
    },
    {
        id: 'choosing_gift', bestType: 'charm',
        desc: `æˆ‘å°†è¦å»æ‹œè®¿ä¸€ä½å¾·é«˜æœ›é‡çš„é•¿è¾ˆï¼Œå´ä¸çŸ¥è¯¥é€ä»€ä¹ˆç¤¼ç‰©æ‰å¥½ã€‚`,
        responses: {
            wisdom: { text: "åˆ†æé‚£ä½é•¿è¾ˆçš„èƒŒæ™¯ä¸å–œå¥½ã€‚", outcome: { title: "æŠ•å…¶æ‰€å¥½", log: "ä½ ä¸ºTAåˆ†æäº†é•¿è¾ˆçš„å–œå¥½ï¼ŒTAçŸ¥é“è¯¥å¦‚ä½•å‡†å¤‡äº†ã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œç¤¼ç‰©ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä½ çš„å¿ƒæ„ã€‚â€", outcome: { title: "å¿ƒæ„", log: "ä½ çš„è¯è®©TAä¸å†çº ç»“äºç¤¼ç‰©æœ¬èº«ã€‚", effects: { favor: 10, emotionValue: 12 } } },
            virtue: { text: "â€œäº²æ‰‹åˆ¶ä½œä¸€ä»¶å°ç¤¼ç‰©ï¼Œæœ€æ˜¾è¯šæ„ã€‚â€", outcome: { title: "è¯šæ„", log: "ä½ å»ºè®®TAäº²æ‰‹å‡†å¤‡ç¤¼ç‰©ï¼ŒTAè§‰å¾—æ­¤æ³•ç”šå¥½ã€‚", effects: { favor: 6, trust: 8 } } }
        }
    },
    {
        id: 'too_much_praise', bestType: 'wisdom',
        desc: `è¿‘æ¥å¤–ç•Œå¯¹æˆ‘çš„èµèª‰ä¹‹å£°é¢‡å¤šï¼Œæˆ‘åè€Œæœ‰äº›ä¸å®‰ï¼Œæ‹…å¿ƒåä¸å‰¯å®ã€‚`,
        responses: {
            wisdom: { text: "â€œç››åä¹‹ä¸‹ï¼Œå½“æ€å±ã€‚ä¿æŒè°¦é€Šï¼Œä¸æ–­ç²¾è¿›å³å¯ã€‚â€", outcome: { title: "å±…å®‰æ€å±", log: "ä½ çš„æé†’è®©TAä¿æŒäº†æ¸…é†’ï¼ŒTAå¯¹ä½ çš„æ™ºæ…§å¾ˆæ˜¯ä½©æœã€‚", effects: { favor: 12, trust: 18 } } },
            charm:  { text: "â€œé‚£äº›èµèª‰éƒ½æ˜¯ä½ åº”å¾—çš„ã€‚â€", outcome: { title: "è‚¯å®š", log: "ä½ çš„è‚¯å®šè®©TAå®‰ä¸‹å¿ƒæ¥ã€‚", effects: { favor: 8, emotionValue: 10 } } },
            virtue: { text: "â€œå°†èµèª‰åŒ–ä¸ºåŠ¨åŠ›ï¼Œå»å¸®åŠ©æ›´å¤šçš„äººã€‚â€", outcome: { title: "åŒ–ä¸ºåŠ¨åŠ›", log: "ä½ å»ºè®®TAå°†åæœ›ç”¨äºå–„äº‹ã€‚", effects: { favor: 5, trust: 8 } } }
        }
    },
    {
        id: 'faced_with_temptation', bestType: 'virtue',
        desc: `æˆ‘é‡åˆ°äº†ä¸€ä¸ªå·¨å¤§çš„è¯±æƒ‘ï¼Œè‹¥èƒ½æŠŠæ¡ï¼Œä¾¿å¯ä¸€æ­¥ç™»å¤©ï¼Œä½†éœ€å¾—ç‰ºç‰²ä¸€äº›åŸåˆ™ã€‚`,
        responses: {
            wisdom: { text: "â€œæ€è€ƒä¸€ä¸‹ï¼Œä½ å°†å¾—åˆ°çš„ï¼Œæ˜¯å¦å€¼å¾—ä½ å°†å¤±å»çš„ã€‚â€", outcome: { title: "æƒè¡¡", log: "ä½ å¼•å¯¼TAæƒè¡¡å¾—å¤±ï¼ŒTAé™·å…¥äº†æ·±æ·±çš„æ€è€ƒã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œæ— è®ºä½ åšä»€ä¹ˆå†³å®šï¼Œæˆ‘éƒ½æ”¯æŒä½ ã€‚â€", outcome: { title: "æ— æ¡ä»¶æ”¯æŒ", log: "ä½ çš„æ— æ¡ä»¶æ”¯æŒè®©TAå¾ˆæ„ŸåŠ¨ã€‚", effects: { favor: 10, emotionValue: 15 } } },
            virtue: { text: "â€œå›å­æœ‰æ‰€ä¸ºï¼Œæœ‰æ‰€ä¸ä¸ºã€‚åˆ‡è«ä¸ºä¸€æ—¶ä¹‹åˆ©ï¼Œæ‚”æ¨ç»ˆç”Ÿã€‚â€", outcome: { title: "è­¦é’Ÿ", log: "ä½ çš„è¯å¦‚å½“å¤´æ£’å–ï¼Œè®©TAåšå®ˆä½äº†åº•çº¿ã€‚", effects: { favor: 15, trust: 20 } } }
        }
    },
    {
        id: 'unwilling_social', bestType: 'charm',
        desc: `æˆ‘å®åœ¨åŒçƒ¦äº†é‚£äº›è™šä¼ªçš„åº”é…¬ï¼Œä½†åˆèº«ä¸ç”±å·±ã€‚`,
        responses: {
            wisdom: { text: "â€œå°†åº”é…¬è§†ä¸ºä¸€ç§ä¿®è¡Œï¼Œè§‚å¯Ÿä¼—ç”Ÿç™¾æ€ã€‚â€", outcome: { title: "è½¬å˜å¿ƒæ€", log: "ä½ ä¸ºTAæä¾›äº†æ–°çš„è§†è§’ã€‚", effects: { favor: 6, trust: 8 } } },
            charm:  { text: "â€œé‚£ä»Šæ™šå°±åªé™ªæˆ‘ä¸€äººï¼Œå¯å¥½ï¼Ÿâ€", outcome: { title: "ç‹¬å ", log: "ä½ çš„â€œéœ¸é“â€è¦æ±‚è®©TAå¿ƒä¸­ä¸€ç”œï¼Œæ¬£ç„¶åº”å…ã€‚", effects: { favor: 15, emotionValue: 18 } } },
            virtue: { text: "â€œèº«åœ¨æ±Ÿæ¹–ï¼Œå¿ƒåœ¨å±±æ—ã€‚ä¿æŒæœ¬å¿ƒå³å¯ã€‚â€", outcome: { title: "ä¿æŒæœ¬å¿ƒ", log: "ä½ åŠTAä¿æŒå†…å¿ƒçš„å¹³é™ã€‚", effects: { favor: 8, trust: 10 } } }
        }
    },
    {
        id: 'witnessed_injustice', bestType: 'virtue',
        desc: `æˆ‘ä»Šæ—¥è§åˆ°ä¸€æ¡©å†¤æ¡ˆï¼Œå¿ƒä¸­æ„¤æ‡‘ä¸å¹³ï¼Œå´åˆäººå¾®è¨€è½»ï¼Œæ— å¯å¥ˆä½•ã€‚`,
        responses: {
            wisdom: { text: "â€œä¸å¯åŠ›æ•Œï¼Œä¾¿å½“æ™ºå–ã€‚æ­¤äº‹éœ€ä»é•¿è®¡è®®ã€‚â€", outcome: { title: "ä»é•¿è®¡è®®", log: "ä½ å»ºè®®TAä¸å¯é²è½ï¼ŒTAå†·é™äº†ä¸‹æ¥ã€‚", effects: { favor: 8, trust: 12 } } },
            charm:  { text: "â€œæ­¤äº‹é™©æ¶ï¼Œä¸è¦å¼•ç«çƒ§èº«ã€‚â€", outcome: { title: "åŠé€€", log: "ä½ çš„åŠé€€è®©TAæ„Ÿåˆ°å¤±æœ›ã€‚", effects: { favor: -8, trust: 2 } } },
            virtue: { text: "â€œå¤©ä¸‹å…´äº¡ï¼ŒåŒ¹å¤«æœ‰è´£ã€‚å³ä¾¿åŠ¿å•åŠ›è–„ï¼Œä¹Ÿå½“å‘å‡ºè‡ªå·±çš„å£°éŸ³ã€‚â€", outcome: { title: "åŒ¹å¤«æœ‰è´£", log: "ä½ çš„æ­£ä¹‰æ„Ÿä¸TAå…±é¸£ï¼ŒTAå†³å®šä¸ºæ­¤äº‹å¥”èµ°ã€‚", effects: { favor: 18, trust: 25 } } }
        }
    },
    {
        id: 'busy_and_tired', bestType: 'charm',
        desc: `æœ€è¿‘å®åœ¨å¤ªè¿‡å¿™ç¢Œï¼Œå¿ƒåŠ›äº¤ç˜ï¼Œæ„Ÿè§‰å¿«è¦æ’‘ä¸ä½äº†ã€‚`,
        responses: {
            wisdom: { text: "â€œäº‹æœ‰è½»é‡ç¼“æ€¥ï¼Œä¸å¦‚å°†äº‹åŠ¡åˆ†ä¸ªä¸»æ¬¡ã€‚â€", outcome: { title: "åˆ†æ¸…ä¸»æ¬¡", log: "ä½ å¸®TAç†æ¸…äº†å¤´ç»ªã€‚", effects: { favor: 8, trust: 10 } } },
            charm:  { text: "â€œåˆ«ç¡¬æ’‘äº†ï¼Œä»Šæ™šå¥½å¥½ä¼‘æ¯ï¼Œä¸€åˆ‡æœ‰æˆ‘ã€‚â€", outcome: { title: "æ¸©æš–çš„æ¸¯æ¹¾", log: "ä½ çš„è¯è¯­å’Œæ¸©æŸ”çš„çœ¼ç¥ï¼Œæ˜¯æ²»æ„ˆä¸€åˆ‡çš„è‰¯è¯ã€‚", effects: { favor: 18, emotionValue: 20 } } },
            virtue: { text: "â€œèº«ä½“æ˜¯æ ¹æœ¬ï¼Œä¸‡ä¸å¯å› ä¿—äº‹ä¼¤äº†èº«å­ã€‚â€", outcome: { title: "å…³å¿ƒ", log: "ä½ çš„å…³å¿ƒè®©TAæ„Ÿåˆ°æ¸©æš–ã€‚", effects: { favor: 10, trust: 12 } } }
        }
    }
];


const POETRY_QUIZ_DATA = [
    // --- æ‚¨åŸæœ‰çš„5ä¸ªé—®é¢˜ï¼ˆå·²ä¿ç•™ï¼‰ ---
    { question: "èº«æ— å½©å‡¤åŒé£ç¿¼", answer: "å¿ƒæœ‰çµçŠ€ä¸€ç‚¹é€š", options: ["å¤©æ¶¯ä½•å¤„è§…çŸ¥éŸ³", "æ­¤äº‹å¤éš¾å…¨"] },
    { question: "å¤©æ¶¯ä½•å¤„æ— èŠ³è‰", answer: "ä½•å¿…å•æ‹ä¸€æèŠ±", options: ["æ˜¥é£åˆç»¿æ±Ÿå—å²¸", "åªæ˜¯å½“æ—¶å·²æƒ˜ç„¶"] },
    { question: "ä¸¤æƒ…è‹¥æ˜¯ä¹…é•¿æ—¶", answer: "åˆå²‚åœ¨æœæœæš®æš®", options: ["ä¾¿èƒœå´äººé—´æ— æ•°", "æ­¤æ¨ç»µç»µæ— ç»æœŸ"] },
    { question: "æ›¾ç»æ²§æµ·éš¾ä¸ºæ°´", answer: "é™¤å´å·«å±±ä¸æ˜¯äº‘", options: ["ä½†æ„¿äººé•¿ä¹…", "æ­¤æ—¶æ­¤å¤œéš¾ä¸ºæƒ…"] },
    { question: "åœ¨å¤©æ„¿ä½œæ¯”ç¿¼é¸Ÿ", answer: "åœ¨åœ°æ„¿ä¸ºè¿ç†æ", options: ["æ­¤æƒ…å¯å¾…æˆè¿½å¿†", "ä¸ºä¼Šæ¶ˆå¾—äººæ†”æ‚´"] },

    // --- æ–°å¢50ä¸ªé—®é¢˜ ---
    // --- çˆ±æƒ…ä¸æ€å¿µ ---
    { question: "æ­¤æƒ…æ— è®¡å¯æ¶ˆé™¤", answer: "æ‰ä¸‹çœ‰å¤´ï¼Œå´ä¸Šå¿ƒå¤´", options: ["æ—§æ—¶ç‹è°¢å ‚å‰ç‡•", "å½“æ—¶æ˜æœˆåœ¨"] },
    { question: "è¡£å¸¦æ¸å®½ç»ˆä¸æ‚”", answer: "ä¸ºä¼Šæ¶ˆå¾—äººæ†”æ‚´", options: ["åªæ˜¯å½“æ—¶å·²æƒ˜ç„¶", "äººç”Ÿè‹¥åªå¦‚åˆè§"] },
    { question: "å±±æœ‰æœ¨å…®æœ¨æœ‰æ", answer: "å¿ƒæ‚¦å›å…®å›ä¸çŸ¥", options: ["å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²", "ç²ç‘éª°å­å®‰çº¢è±†"] },
    { question: "ç²ç‘éª°å­å®‰çº¢è±†", answer: "å…¥éª¨ç›¸æ€çŸ¥ä¸çŸ¥", options: ["æ˜¥å¿ƒè«å…±èŠ±äº‰å‘", "ä¸€å¯¸ç›¸æ€ä¸€å¯¸ç°"] },
    { question: "å¤©æ¶¯åœ°è§’æœ‰ç©·æ—¶", answer: "åªæœ‰ç›¸æ€æ— å°½å¤„", options: ["æ­¤æ—¶æ­¤å¤œéš¾ä¸ºæƒ…", "æµ·ä¸Šç”Ÿæ˜æœˆ"] },
    { question: "çº¢è±†ç”Ÿå—å›½", answer: "æ˜¥æ¥å‘å‡ æ", options: ["æ„¿å›å¤šé‡‡æ’·", "æ­¤ç‰©æœ€ç›¸æ€"] },
    { question: "é’é’å­è¡¿ï¼Œæ‚ æ‚ æˆ‘å¿ƒ", answer: "ä½†ä¸ºå›æ•…ï¼Œæ²‰åŸè‡³ä»Š", options: ["ä½•ä»¥è§£å¿§ï¼Œå”¯æœ‰æœåº·", "æœˆä¸ŠæŸ³æ¢¢å¤´"] },
    { question: "æœˆä¸ŠæŸ³æ¢¢å¤´", answer: "äººçº¦é»„æ˜å", options: ["å»å¹´å…ƒå¤œæ—¶", "èŠ±å¸‚ç¯å¦‚æ˜¼"] },
    { question: "æ„¿å¾—ä¸€äººå¿ƒ", answer: "ç™½é¦–ä¸ç›¸ç¦»", options: ["å±±æ— æ£±ï¼Œå¤©åœ°åˆ", "ä¸å›é•¿ç›¸å®ˆ"] },
    { question: "é‡‘é£ç‰éœ²ä¸€ç›¸é€¢", answer: "ä¾¿èƒœå´äººé—´æ— æ•°", options: ["æŸ”æƒ…ä¼¼æ°´ï¼Œä½³æœŸå¦‚æ¢¦", "å¿é¡¾é¹Šæ¡¥å½’è·¯"] },

    // --- è±ªæƒ…ä¸æŠ±è´Ÿ ---
    { question: "å¤§æ±Ÿä¸œå»ï¼Œæµªæ·˜å°½", answer: "åƒå¤é£æµäººç‰©", options: ["ä¸€æ—¶å¤šå°‘è±ªæ°", "å°ä¹”åˆå«äº†"] },
    { question: "è€å¤«èŠå‘å°‘å¹´ç‹‚", answer: "å·¦ç‰µé»„ï¼Œå³æ“è‹", options: ["é”¦å¸½è²‚è£˜ï¼Œåƒéª‘å·å¹³å†ˆ", "ä¼šæŒ½é›•å¼“å¦‚æ»¡æœˆ"] },
    { question: "ä¼šæŒ½é›•å¼“å¦‚æ»¡æœˆ", answer: "è¥¿åŒ—æœ›ï¼Œå°„å¤©ç‹¼", options: ["ä¸ºæŠ¥å€¾åŸéšå¤ªå®ˆ", "äº²å°„è™ï¼Œçœ‹å­™éƒ"] },
    { question: "ä»°å¤©å¤§ç¬‘å‡ºé—¨å»", answer: "æˆ‘è¾ˆå²‚æ˜¯è“¬è’¿äºº", options: ["äººç”Ÿå¾—æ„é¡»å°½æ¬¢", "åƒé‡‘æ•£å°½è¿˜å¤æ¥"] },
    { question: "é†‰å§æ²™åœºå›è«ç¬‘", answer: "å¤æ¥å¾æˆ˜å‡ äººå›", options: ["è‘¡è„ç¾é…’å¤œå…‰æ¯", "æ¬²é¥®çµç¶é©¬ä¸Šå‚¬"] },
    { question: "é»„æ²™ç™¾æˆ˜ç©¿é‡‘ç”²", answer: "ä¸ç ´æ¥¼å…°ç»ˆä¸è¿˜", options: ["é’æµ·é•¿äº‘æš—é›ªå±±", "ä½†ä½¿é¾™åŸé£å°†åœ¨"] },
    { question: "ä½†ä½¿é¾™åŸé£å°†åœ¨", answer: "ä¸æ•™èƒ¡é©¬åº¦é˜´å±±", options: ["ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³", "ä¸‡é‡Œé•¿å¾äººæœªè¿˜"] },
    { question: "ä¸‰ååŠŸåå°˜ä¸åœŸ", answer: "å…«åƒé‡Œè·¯äº‘å’Œæœˆ", options: ["è«ç­‰é—²ï¼Œç™½äº†å°‘å¹´å¤´", "æ€’å‘å†²å† ï¼Œå‡­æ å¤„"] },
    { question: "ç”·å„¿ä½•ä¸å¸¦å´é’©", answer: "æ”¶å–å…³å±±äº”åå·", options: ["è¯·å›æš‚ä¸Šå‡ŒçƒŸé˜", "è‹¥ä¸ªä¹¦ç”Ÿä¸‡æˆ·ä¾¯"] },
    { question: "æƒ³å½“å¹´ï¼Œé‡‘æˆˆé“é©¬", answer: "æ°”åä¸‡é‡Œå¦‚è™", options: ["å…ƒå˜‰è‰è‰ï¼Œå°ç‹¼å±…èƒ¥", "èµ¢å¾—ä»“çš‡åŒ—é¡¾"] },

    // --- å“²ç†ä¸äººç”Ÿ ---
    { question: "äººæœ‰æ‚²æ¬¢ç¦»åˆ", answer: "æœˆæœ‰é˜´æ™´åœ†ç¼º", options: ["æ­¤äº‹å¤éš¾å…¨", "ä½†æ„¿äººé•¿ä¹…"] },
    { question: "ä¸è¯†åºå±±çœŸé¢ç›®", answer: "åªç¼˜èº«åœ¨æ­¤å±±ä¸­", options: ["æ¨ªçœ‹æˆå²­ä¾§æˆå³°", "è¿œè¿‘é«˜ä½å„ä¸åŒ"] },
    { question: "æ²‰èˆŸä¾§ç•”åƒå¸†è¿‡", answer: "ç—…æ ‘å‰å¤´ä¸‡æœ¨æ˜¥", options: ["ä»Šæ—¥å¬å›æ­Œä¸€æ›²", "æš‚å‡­æ¯é…’é•¿ç²¾ç¥"] },
    { question: "å±±é‡æ°´å¤ç–‘æ— è·¯", answer: "æŸ³æš—èŠ±æ˜åˆä¸€æ‘", options: ["è«ç¬‘å†œå®¶è…Šé…’æµ‘", "ä¸°å¹´ç•™å®¢è¶³é¸¡è±š"] },
    { question: "äººç”Ÿå¾—æ„é¡»å°½æ¬¢", answer: "è«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆ", options: ["å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨", "åƒé‡‘æ•£å°½è¿˜å¤æ¥"] },
    { question: "å¤•é˜³æ— é™å¥½", answer: "åªæ˜¯è¿‘é»„æ˜", options: ["å‘æ™šæ„ä¸é€‚", "é©±è½¦ç™»å¤åŸ"] },
    { question: "æ˜¥èš•åˆ°æ­»ä¸æ–¹å°½", answer: "èœ¡ç‚¬æˆç°æ³ªå§‹å¹²", options: ["æ™“é•œä½†æ„äº‘é¬“æ”¹", "å¤œåŸåº”è§‰æœˆå…‰å¯’"] },
    { question: "é‡‡èŠä¸œç¯±ä¸‹", answer: "æ‚ ç„¶è§å—å±±", options: ["å±±æ°”æ—¥å¤•ä½³", "é£é¸Ÿç›¸ä¸è¿˜"] },
    { question: "å‰ä¸è§å¤äºº", answer: "åä¸è§æ¥è€…", options: ["å¿µå¤©åœ°ä¹‹æ‚ æ‚ ", "ç‹¬æ€†ç„¶è€Œæ¶•ä¸‹"] },
    { question: "æµ·å†…å­˜çŸ¥å·±", answer: "å¤©æ¶¯è‹¥æ¯”é‚»", options: ["æ— ä¸ºåœ¨æ­§è·¯", "å„¿å¥³å…±æ²¾å·¾"] },

    // --- å†™æ™¯ä¸é£å…‰ ---
    { question: "ç©ºå±±æ–°é›¨å", answer: "å¤©æ°”æ™šæ¥ç§‹", options: ["æ˜æœˆæ¾é—´ç…§", "ç«¹å–§å½’æµ£å¥³"] },
    { question: "æ˜æœˆæ¾é—´ç…§", answer: "æ¸…æ³‰çŸ³ä¸Šæµ", options: ["ç«¹å–§å½’æµ£å¥³", "è²åŠ¨ä¸‹æ¸”èˆŸ"] },
    { question: "å¤§æ¼ å­¤çƒŸç›´", answer: "é•¿æ²³è½æ—¥åœ†", options: ["å¾è“¬å‡ºæ±‰å¡", "å½’é›å…¥èƒ¡å¤©"] },
    { question: "æ—¥å‡ºæ±ŸèŠ±çº¢èƒœç«", answer: "æ˜¥æ¥æ±Ÿæ°´ç»¿å¦‚è“", options: ["èƒ½ä¸å¿†æ±Ÿå—", "æ±Ÿå—å¥½ï¼Œé£æ™¯æ—§æ›¾è°™"] },
    { question: "ä¸¤ä¸ªé»„é¹‚é¸£ç¿ æŸ³", answer: "ä¸€è¡Œç™½é¹­ä¸Šé’å¤©", options: ["çª—å«è¥¿å²­åƒç§‹é›ª", "é—¨æ³Šä¸œå´ä¸‡é‡Œèˆ¹"] },
    { question: "åœè½¦åçˆ±æ«æ—æ™š", answer: "éœœå¶çº¢äºäºŒæœˆèŠ±", options: ["è¿œä¸Šå¯’å±±çŸ³å¾„æ–œ", "ç™½äº‘ç”Ÿå¤„æœ‰äººå®¶"] },
    { question: "æ˜¥é£åˆç»¿æ±Ÿå—å²¸", answer: "æ˜æœˆä½•æ—¶ç…§æˆ‘è¿˜", options: ["äº¬å£ç“œæ´²ä¸€æ°´é—´", "é’Ÿå±±åªéš”æ•°é‡å±±"] },
    { question: "å°è·æ‰éœ²å°–å°–è§’", answer: "æ—©æœ‰èœ»èœ“ç«‹ä¸Šå¤´", options: ["æ³‰çœ¼æ— å£°æƒœç»†æµ", "æ ‘é˜´ç…§æ°´çˆ±æ™´æŸ”"] },
    { question: "æ˜¥è‰²æ»¡å›­å…³ä¸ä½", answer: "ä¸€æçº¢æå‡ºå¢™æ¥", options: ["åº”æ€œå±é½¿å°è‹è‹”", "å°æ‰£æŸ´æ‰‰ä¹…ä¸å¼€"] },
    { question: "æ¥å¤©è²å¶æ— ç©·ç¢§", answer: "æ˜ æ—¥è·èŠ±åˆ«æ ·çº¢", options: ["æ¯•ç«Ÿè¥¿æ¹–å…­æœˆä¸­", "é£å…‰ä¸ä¸å››æ—¶åŒ"] },

    // --- ç¦»åˆ«ä¸æ„ç»ª ---
    { question: "åŠå›æ›´å°½ä¸€æ¯é…’", answer: "è¥¿å‡ºé˜³å…³æ— æ•…äºº", options: ["æ¸­åŸæœé›¨æµ¥è½»å°˜", "å®¢èˆé’é’æŸ³è‰²æ–°"] },
    { question: "æ˜¥é£å¾—æ„é©¬è¹„ç–¾", answer: "ä¸€æ—¥çœ‹å°½é•¿å®‰èŠ±", options: ["æ˜”æ—¥é¾Œé¾Šä¸è¶³å¤¸", "ä»Šæœæ”¾è¡æ€æ— æ¶¯"] },
    { question: "æ¡ƒèŠ±æ½­æ°´æ·±åƒå°º", answer: "ä¸åŠæ±ªä¼¦é€æˆ‘æƒ…", options: ["æç™½ä¹˜èˆŸå°†æ¬²è¡Œ", "å¿½é—»å²¸ä¸Šè¸æ­Œå£°"] },
    { question: "è«æ„å‰è·¯æ— çŸ¥å·±", answer: "å¤©ä¸‹è°äººä¸è¯†å›", options: ["åƒé‡Œé»„äº‘ç™½æ—¥æ››", "åŒ—é£å¹é›é›ªçº·çº·"] },
    { question: "æ´›é˜³äº²å‹å¦‚ç›¸é—®", answer: "ä¸€ç‰‡å†°å¿ƒåœ¨ç‰å£¶", options: ["å¯’é›¨è¿æ±Ÿå¤œå…¥å´", "å¹³æ˜é€å®¢æ¥šå±±å­¤"] },
    { question: "å•†å¥³ä¸çŸ¥äº¡å›½æ¨", answer: "éš”æ±ŸçŠ¹å”±ååº­èŠ±", options: ["çƒŸç¬¼å¯’æ°´æœˆç¬¼æ²™", "å¤œæ³Šç§¦æ·®è¿‘é…’å®¶"] },
    { question: "ä¸œé£ä¸ä¸å‘¨éƒä¾¿", answer: "é“œé›€æ˜¥æ·±é”äºŒä¹”", options: ["æŠ˜æˆŸæ²‰æ²™é“æœªé”€", "è‡ªå°†ç£¨æ´—è®¤å‰æœ"] },
    { question: "æŠ½åˆ€æ–­æ°´æ°´æ›´æµ", answer: "ä¸¾æ¯æ¶ˆæ„æ„æ›´æ„", options: ["äººç”Ÿåœ¨ä¸–ä¸ç§°æ„", "æ˜æœæ•£å‘å¼„æ‰èˆŸ"] },
    { question: "å§‘è‹åŸå¤–å¯’å±±å¯º", answer: "å¤œåŠé’Ÿå£°åˆ°å®¢èˆ¹", options: ["æœˆè½ä¹Œå•¼éœœæ»¡å¤©", "æ±Ÿæ«æ¸”ç«å¯¹æ„çœ "] },
    { question: "åå¹´ç”Ÿæ­»ä¸¤èŒ«èŒ«", answer: "ä¸æ€é‡ï¼Œè‡ªéš¾å¿˜", options: ["åƒé‡Œå­¤åŸï¼Œæ— å¤„è¯å‡„å‡‰", "çºµä½¿ç›¸é€¢åº”ä¸è¯†"] }
];
// æ‰©å……åçš„æƒ…äººäº‹ä»¶åº“ (èŠ‚é€‰äº†æ–‡æ¡£ä¸­çš„ä»£è¡¨æ€§äº‹ä»¶)
// ===================== ã€ç¬¬ä¸€æ­¥ï¼ˆ1/3ï¼‰ï¼šæ–°å¢çº¦ä¼šåœ°ç‚¹æ•°æ®ã€‘ =====================
const DATE_LOCATIONS = {
    'lake_pavilion': { name: 'æ¹–å¿ƒäº­', icon: 'fa-water', tags: ['é£é›…ä¹‹äº‹', 'è‡ªç„¶é£å…‰'] },
    'market': { name: 'ç¹åå¸‚é›†', icon: 'fa-store-alt', tags: ['å¸‚äº•è§é—»', 'è´­ç‰©æ¶ˆè´¹'] },
    'bamboo_forest': { name: 'å¹½é™ç«¹æ—', icon: 'fa-leaf', tags: ['è‡ªç„¶é£å…‰', 'ç§å¯†å€¾è¯‰'] },
    'temple_fair': { name: 'å¯ºåº™åº™ä¼š', icon: 'fa-gopuram', tags: ['å¸‚äº•è§é—»', 'ç¥ˆç¦è®¸æ„¿'] },
    'opera_house': { name: 'æ¢¨å›­æˆæ¥¼', icon: 'fa-theater-masks', tags: ['é£é›…ä¹‹äº‹', 'å¸‚äº•è§é—»'] },
    'suburb_outing': { name: 'éƒŠå¤–è¸é’', icon: 'fa-hiking', tags: ['è‡ªç„¶é£å…‰', 'æ„å¤–å†’é™©'] }
};
// ===================== ã€ç¬¬ä¸€æ­¥ï¼ˆ2/3ï¼‰ï¼šè¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢ã€‘ =====================
// æ‰©å……åçš„æƒ…äººäº‹ä»¶åº“ (V3.0 - å·²åˆ†ç±»)
const LOVER_EVENTS_EXPANDED = {
    // ==================== é£é›…ä¹‹äº‹ (é€‚åˆæˆæ¥¼ã€æ¹–å¿ƒäº­) ====================
    'boat_serenade': { category: 'é£é›…ä¹‹äº‹', title: 'ç”»èˆ«æƒŠé¸¿', desc: 'ä¸€è‰˜ç”»èˆ«ç»è¿‡ï¼Œä¸Šé¢çš„æ­Œå¦“å”±èµ·ä¸€é¦–å“€å©‰çš„æ›²å­ï¼Œè§¦åŠ¨äº†å¯¹æ–¹çš„å¿ƒäº‹ã€‚', options: [
        { text: 'ä¸ºå…¶èµ‹è¯—ä¸€é¦–', req: { talent: 80 }, effects: { favor: 20 }, log: 'ä½ çš„è¯—æ‰ä»¤å¯¹æ–¹æ·±æ·±æŠ˜æœã€‚' },
        { text: 'é‚€å…¶å…±èˆä¸€æ›²', req: { charm: 70 }, effects: { favor: 20 }, log: 'ä½ ä»¬åœ¨æœˆå…‰ä¸‹å…±èˆï¼Œèº«å§¿ç¿©è·¹ï¼Œæƒ…æ„ç»µç»µã€‚' }
    ]},
    'teach_hobby': { category: 'é£é›…ä¹‹äº‹', title: 'ä¼ æˆé›…å¥½', desc: 'TAå¯¹ä½ çš„æŸé¡¹æ‰è‰ºï¼ˆå¦‚ç´æ£‹ä¹¦ç”»ï¼‰è¡¨ç°å‡ºæµ“åšçš„å…´è¶£ï¼Œå¸Œæœ›ä½ èƒ½æ•™TAã€‚', options: [
        { text: 'ã€è€å¿ƒæ•™å¯¼ã€‘', req: { talent: 60 }, effects: { favor: 12, devotion: 8 }, log: 'ä½ ä»¬åœ¨æ•™å­¦ä¸­è¿‘è·ç¦»æ¥è§¦ï¼Œæƒ…æ„æ›´æµ“ã€‚' },
        { text: 'ã€å€Ÿå£æ¨è¾ã€‘', effects: { favor: -5 }, log: 'ä½ ä»¥â€œæ‰ç–å­¦æµ…â€ä¸ºç”±æ¨è¾äº†ï¼ŒTAæœ‰äº›å¤±æœ›ã€‚' }
    ]},
    'same_hobby': { category: 'é£é›…ä¹‹äº‹', title: 'å…±åŒçš„çˆ±å¥½', desc: 'ä½ å‘ç°ä½ ä»¬ç«Ÿç„¶éƒ½å–œæ¬¢åŒä¸€ä½å†·é—¨è¯—äººçš„ä½œå“ã€‚', effects: { favor: 10, devotion: 5, talent: 2 }, log: 'å…±åŒçš„çˆ±å¥½è®©ä½ ä»¬æ„Ÿè§‰å½¼æ­¤æ˜¯å¤©é€ åœ°è®¾çš„ä¸€å¯¹ã€‚' },
    
    // ==================== å¸‚äº•è§é—» (é€‚åˆå¸‚é›†ã€åº™ä¼šã€æˆæ¥¼) ====================
    'buy_for_lover': { category: 'å¸‚äº•è§é—»', title: 'å¸‚é›†èµ ç¤¼', desc: 'å¯¹æ–¹çœ‹ä¸Šäº†ä¸€ä»¶æ˜‚è´µçš„é¦–é¥°/å…µå™¨ï¼Œä½†å›Šä¸­ç¾æ¶©ã€‚', options: [
        { text: 'è±ªæ·åƒé‡‘ï¼Œä¹°ä¸‹ç›¸èµ ', req: { wealth: 1000 }, effects: { wealth: -1000, favor: 25, devotion: 15 }, log: 'ä½ çš„æ…·æ…¨è®©å¯¹æ–¹æ„ŸåŠ¨ä¸å·²ã€‚' },
        { text: 'å›Šä¸­ç¾æ¶©ï¼Œå©‰è¨€æ‹’ç»', effects: { favor: -10 }, log: 'ä½ çš„æ‹’ç»è®©å¯¹æ–¹æœ‰äº›å¤±è½ã€‚' }
    ]},
    'fireworks': { category: 'å¸‚äº•è§é—»', title: 'æ²³è¾¹çƒŸç«', desc: 'èŠ‚æ—¥é‡Œï¼ŒTAæ‚„æ‚„çº¦ä½ åœ¨æ²³è¾¹è§é¢ï¼Œä¸ºä½ ä¸ºä½ å‡†å¤‡äº†ä¸€åœºç»šçƒ‚çš„çƒŸç«ã€‚', options: [
        { text: 'ã€æ·±å—æ„ŸåŠ¨ã€‘', effects: { favor: 20, devotion: 15 }, log: 'çƒŸç«ä¹‹ä¸‹ï¼ŒTAçš„çœ¼çœ¸æ¯”çƒŸç«æ›´äº®ï¼Œä½ æ„Ÿè§‰æ­¤åˆ»ä¾¿æ˜¯æ°¸æ’ã€‚' },
        { text: 'ã€æ‹…å¿ƒè¢«äººå‘ç°ã€‘', effects: { favor: 5, virtue: 2 }, log: 'ä½ è™½ç„¶æ„ŸåŠ¨ï¼Œä½†æ›´æ‹…å¿ƒè¢«äººå‘ç°ï¼Œå‚¬ä¿ƒTAå°½å¿«ç»“æŸã€‚' }
    ]},
    'pet': { category: 'å¸‚äº•è§é—»', title: 'ä¸€åªå°çŒ«', desc: 'ä½ ä»¬ä¸€èµ·æ”¶å…»äº†ä¸€åªæµæµªçš„å°çŒ«ï¼Œå¹¶ä¸ºå®ƒå–äº†åå­—ã€‚', effects: { favor: 8, devotion: 5, virtue: 2 }, log: 'è¿™åªå°çŒ«æˆä¸ºäº†ä½ ä»¬ç§˜å¯†å…³ç³»ä¸­çš„ä¸€ä¸ªå°å°è§è¯ã€‚' },

    // ==================== è‡ªç„¶é£å…‰ (é€‚åˆæ¹–å¿ƒäº­ã€ç«¹æ—ã€éƒŠå¤–) ====================
    'moon_drink': { category: 'è‡ªç„¶é£å…‰', title: 'æœˆä¸‹å¯¹é…Œ', desc: 'ä½ ä»¬åœ¨æ¹–å¿ƒäº­èµæœˆå°é…Œï¼Œå¯¹æ–¹å€Ÿç€é…’æ„ï¼Œå‘ä½ åéœ²äº†ä¸€æ®µä¸ä¸ºäººçŸ¥çš„å¾€äº‹ã€‚', options: [
        { text: 'å®‰æ…°å¹¶åˆ†äº«ä½ çš„ç§˜å¯†', effects: { favor: 15, devotion: 10 }, log: 'ä½ ä»¬äº¤æ¢äº†å½¼æ­¤æœ€æ·±çš„ç§˜å¯†ï¼Œå¿ƒä¸å¿ƒè´´å¾—æ›´è¿‘äº†ã€‚' },
        { text: 'é»˜é»˜å€¾å¬', effects: { favor: 8 }, log: 'ä½ çš„å€¾å¬ç»™äº†å¯¹æ–¹è«å¤§çš„å®‰æ…°ã€‚' }
    ]},
    'rainy_day': { category: 'è‡ªç„¶é£å…‰', title: 'é›¨ä¸­å…±ä¼', desc: 'ä¸€åœºçªå¦‚å…¶æ¥çš„å¤§é›¨ï¼Œä½ ä»¬åœ¨å±‹æªä¸‹å¶é‡ï¼Œå…±æ’‘ä¸€æŠŠæ²¹çº¸ä¼ã€‚', effects: { favor: 8, devotion: 5 }, log: 'ç‹­å°çš„ç©ºé—´é‡Œï¼Œä½ ä»¬çš„å‘¼å¸äº¤ç»‡åœ¨ä¸€èµ·ï¼Œæ°”æ°›æš§æ˜§è€Œæ¸©é¦¨ã€‚' },
    'disguised_trip': { category: 'è‡ªç„¶é£å…‰', title: 'ä¸€æ¬¡è¿œè¡Œ', desc: 'ä½ ä»¬ä¹”è£…æ‰“æ‰®ï¼Œåƒæ™®é€šå¤«å¦»ä¸€æ ·å»é‚»è¿‘çš„åŸé•‡è¿›è¡Œäº†ä¸€æ¬¡çŸ­æš‚çš„æ—…è¡Œã€‚', options: [
        { text: 'ã€èŠ±è´¹1500ä¸¤ã€‘', req: { wealth: 1500 }, effects: { wealth: -1500, favor: 30, devotion: 20 }, log: 'è¿™æ¬¡çŸ­æš‚çš„â€œæ­£å¸¸ç”Ÿæ´»â€æˆä¸ºäº†ä½ ä»¬æœ€çè´µçš„å›å¿†ã€‚' },
        { text: 'ã€å› æ•…å–æ¶ˆã€‘', effects: { favor: -5 }, log: 'è®¡åˆ’å› æ•…å–æ¶ˆï¼Œä½ ä»¬éƒ½æ„Ÿåˆ°å¾ˆé—æ†¾ã€‚' }
    ]},
    
    // ==================== ç§å¯†å€¾è¯‰ (é€‚åˆç«¹æ—ã€éƒŠå¤–) ====================
    'shared_memory': { category: 'ç§å¯†å€¾è¯‰', title: 'è¿½å¿†å¾€æ˜”', desc: 'æƒ…äººä¸ä½ èŠèµ·ä½ ä»¬åˆæ¬¡ç›¸é‡æ—¶çš„åœºæ™¯ï¼Œæ„Ÿæ…¨ä¸‡åƒã€‚', options: [
        { text: 'ä¸€åŒå›å¿†', effects: { favor: 10, devotion: 5 }, log: 'ä½ ä»¬ä¸€åŒæ²‰æµ¸åœ¨ç¾å¥½çš„å›å¿†ä¸­ï¼Œæ„Ÿæƒ…å‡æ¸©ã€‚' },
        { text: 'æ‰“è¶£TAå½“åˆçš„çª˜æ€', effects: { favor: 12, devotion: 3 }, log: 'ä½ çš„æ‰“è¶£è®©TAåˆç¾åˆç¬‘ï¼Œæ°”æ°›ååˆ†æš§æ˜§ã€‚' }
    ]},
    'dream_of_you': { category: 'ç§å¯†å€¾è¯‰', title: 'æ¢¦ä¸­çš„ä½ ', desc: 'ä½ çš„æƒ…äººå‘Šè¯‰ä½ ï¼Œæ˜¨å¤œæ¢¦åˆ°äº†ä½ ï¼Œæ¢¦é‡Œçš„ä½ ä»¬...', options: [
        { text: 'è¿½é—®æ¢¦å¢ƒç»†èŠ‚', effects: { favor: 10, devotion: 5 }, log: 'TAåœ¨ä½ è€³è¾¹ä½è¯­äº†æ¢¦ä¸­çš„ç»†èŠ‚ï¼Œä½ ä»¬çš„å…³ç³»æ›´åŠ äº²å¯†ã€‚' },
        { text: 'ä¸€ç¬‘ç½®ä¹‹', effects: { favor: 2 }, log: 'ä½ ç¬‘ç€è¯´è¿™ä¸è¿‡æ˜¯æ—¥æœ‰æ‰€æ€å¤œæœ‰æ‰€æ¢¦ç½¢äº†ã€‚' }
    ]},
    'future_child_name': { category: 'ç§å¯†å€¾è¯‰', title: 'æœªæ¥çš„å­©å­', condition: (gs, npc) => npc.devotion > 70, desc: 'é—²èŠæ—¶ï¼Œä½ ä»¬åŠå¼€ç©ç¬‘åœ°ä¸ºä½ ä»¬â€œæœªæ¥â€çš„å­©å­å–åå­—ã€‚', effects: { favor: 10, devotion: 15 }, log: 'è¿™ä¸ªå…³äºæœªæ¥çš„ç©ç¬‘ï¼Œè®©ä½ ä»¬éƒ½æ„Ÿåˆ°ä¸€ä¸ç”œèœœä¸å¿ƒé…¸ã€‚' },
    
    // ==================== æ„å¤–å†’é™© (é€‚åˆéƒŠå¤–ã€å¸‚é›†) ====================
    'protect_you': { category: 'æ„å¤–å†’é™©', title: 'æŒºèº«è€Œå‡º', desc: 'ä½ é‡åˆ°å±é™©æ—¶ï¼ŒTAæ¯«ä¸çŠ¹è±«åœ°æŒ¡åœ¨äº†ä½ çš„èº«å‰ã€‚', effects: { favor: 25, devotion: 25 }, log: 'TAå¥‹ä¸é¡¾èº«çš„ä¿æŠ¤è®©ä½ æ— æ¯”åŠ¨å®¹ã€‚' },
    'meet_family': { category: 'æ„å¤–å†’é™©', title: 'å¶é‡å®¶äºº', desc: 'ä½ ä¸TAç§ä¼šæ—¶ï¼Œæ„å¤–æ’è§äº†TAçš„å…„é•¿/å§å¦¹ï¼', options: [
        { text: 'ã€é•‡å®šåº”å¯¹ã€‘', req: { charm: 70 }, effects: { favor: 5 }, log: 'ä½ å¾—ä½“çš„åº”å¯¹ç»™å¯¹æ–¹ç•™ä¸‹äº†ä¸é”™çš„å°è±¡ã€‚' },
        { text: 'ã€ä»“çš‡é€ƒç¦»ã€‘', effects: { favor: -5 }, log: 'ä½ ä»¬çš„ä»“çš‡é€ƒç¦»åè€Œæ›´å¼•äººæ€€ç–‘ã€‚' }
    ]},
    'shared_secret': { category: 'æ„å¤–å†’é™©', title: 'å…±åŒçš„ç§˜å¯†', desc: 'ä½ ä»¬æ— æ„ä¸­å…±åŒå‘ç°äº†ä¸€ä¸ªåˆ«äººçš„ç§˜å¯†ã€‚', effects: { favor: 5, devotion: 8 }, log: 'è¿™ä¸ªå…±åŒçš„ç§˜å¯†è®©ä½ ä»¬çš„å…³ç³»æ›´åŠ ç´§å¯†äº†ã€‚' },
    
    // ==================== ç¥ˆç¦è®¸æ„¿ (é€‚åˆå¯ºåº™) ====================
    'temple_pray': { category: 'ç¥ˆç¦è®¸æ„¿', title: 'å¤å¯ºç¥ˆç¦', desc: 'ä½ ä»¬åœ¨å¤å¯ºä¸­ä¸€åŒä¸ºå½¼æ­¤çš„æœªæ¥ç¥ˆç¦ã€‚', options: [
        { text: 'ã€ä¸ºTAç¥ˆç¦ã€‘', effects: { favor: 15, devotion: 10 }, log: 'ä½ è™”è¯šåœ°ä¸ºTAç¥ˆç¦ï¼Œå¯¹æ–¹çœ‹åœ¨çœ¼é‡Œï¼Œæ„ŸåŠ¨åœ¨å¿ƒã€‚' },
        { text: 'ã€ä¸ºä½ ä»¬çš„æœªæ¥ç¥ˆç¦ã€‘', effects: { favor: 10, devotion: 15 }, log: 'ä½ ä»¬ä¸€åŒè®¸ä¸‹äº†å¯¹æœªæ¥çš„æœŸç›¼ï¼Œå…³ç³»æ›´åŠ ç¨³å›ºã€‚' }
    ]},
    
    // ==================== æ— åˆ†ç±»é€šç”¨äº‹ä»¶ (ä»»ä½•åœ°ç‚¹éƒ½å¯èƒ½è§¦å‘) ====================
    'late_visit': { category: 'é€šç”¨', title: 'æ·±å¤œæ¢è®¿', condition: (gs, npc) => npc.favor > 60, desc: 'å¤œæ·±äººé™ï¼Œä½ çš„æƒ…äººçªç„¶åˆ°è®¿ï¼Œåªä¸ºèƒ½è§ä½ ä¸€é¢ã€‚', effects: { favor: 5, devotion: 5 }, log: 'TAå†’é™©å‰æ¥ï¼Œåªä¸ºè§ä½ ä¸€é¢ï¼Œä½ ä»¬çš„æƒ…æ„æ›´æ·±äº†ã€‚' },
    'sickness_care': { category: 'é€šç”¨', title: 'ç—…ä¸­ç…§æ–™', desc: 'ä½ çš„æƒ…äººç”Ÿç—…äº†ï¼Œä½ å¬é—»åï¼Œæƒ³åŠæ³•å‰å»æ‚‰å¿ƒç…§æ–™ã€‚', effects: { favor: 15, devotion: 20 }, log: 'ä½ æ— å¾®ä¸è‡³çš„ç…§æ–™è®©TAå¤§ä¸ºæ„ŸåŠ¨ï¼Œå¯¹ä½ æ›´åŠ æ­»å¿ƒå¡Œåœ°ã€‚' },
    'special_gift': { category: 'é€šç”¨', title: 'ç‰¹æ®Šçš„å¿ƒæ„', desc: 'æƒ…äººä¸ºä½ é€æ¥ä¸€ä»½äº²æ‰‹åˆ¶ä½œçš„ç¤¼ç‰©ï¼ˆç”»/å‰‘ç©—/é¦™å›Šï¼‰ï¼Œè™½ä¸è´µé‡ï¼Œå´é¥±å«å¿ƒæ„ã€‚', options: [
        { text: 'çè—èµ·æ¥', effects: { favor: 15, devotion: 10 }, log: 'ä½ å°†ç¤¼ç‰©çè—èµ·æ¥ï¼Œå¯¹æ–¹è§ä½ å¦‚æ­¤çè§†ï¼Œæ„ŸåŠ¨ä¸å·²ã€‚' },
        { text: 'å½“é¢ä½¿ç”¨', effects: { favor: 20, devotion: 5 }, log: 'ä½ ç«‹åˆ»å°±å°†ç¤¼ç‰©ä½©æˆ´/ä½¿ç”¨èµ·æ¥ï¼Œè¿™æ˜¯å¯¹TAå¿ƒæ„æœ€å¥½çš„å›åº”ã€‚' }
    ]},
    'secret_nickname': { category: 'é€šç”¨', title: 'ç§˜å¯†æ˜µç§°', desc: 'åœ¨ä¸€æ¬¡ç§ä¼šæ—¶ï¼ŒTAä¸ºä½ å–äº†ä¸€ä¸ªåªæœ‰ä½ ä»¬ä¸¤äººçŸ¥é“çš„äº²å¯†æ˜µç§°ã€‚', effects: { favor: 7, devotion: 7 }, log: 'è¿™ä¸ªç§˜å¯†çš„æ˜µç§°è®©ä½ ä»¬çš„å…³ç³»æ›´åŠ ä¸ä¼—ä¸åŒã€‚' },
    'celebrate_birthday': { category: 'é€šç”¨', title: 'åº†ç¥ç”Ÿè¾°', desc: 'ä½ è®°ä¸‹äº†TAçš„ç”Ÿè¾°ï¼Œå¹¶æ‚„æ‚„ä¸ºTAå‡†å¤‡äº†ä¸€ä»½ç”Ÿæ—¥æƒŠå–œã€‚', options: [
        { text: 'ã€èŠ±è´¹500ä¸¤ã€‘å‡†å¤‡é‡ç¤¼', req: { wealth: 500 }, effects: { wealth: -500, favor: 25, devotion: 10 }, log: 'TAæ²¡æƒ³åˆ°ä½ ç«Ÿå¦‚æ­¤ä¸Šå¿ƒï¼Œæ„ŸåŠ¨å¾—æ— ä»¥å¤åŠ ã€‚' },
        { text: 'ã€äº²æ‰‹åˆ¶ä½œã€‘é•¿å¯¿é¢', effects: { favor: 15, devotion: 15 }, log: 'ä¸€ç¢—ç®€å•çš„é•¿å¯¿é¢ï¼Œå´è®©TAæ„Ÿå—åˆ°äº†å®¶çš„æ¸©æš–ã€‚' }
    ]},
    'close_call': { category: 'é€šç”¨', title: 'æƒŠé™©ä¸€åˆ»', condition: (gs, npc) => gs.marriage.isMarried, desc: 'ä½ ä¸æƒ…äººç§ä¼šæ—¶ï¼Œä½™å…‰ç«Ÿç¥è§ä½ çš„é…å¶æ­£è¦è½¬è¿‡è¡—è§’ï¼', options: [
        { text: 'æ‹‰ç€TAä»åé—¨æºœèµ°', effects: { favor: 5 }, log: 'ä½ ä»¬ç‹¼ç‹ˆåœ°ä»åé—¨æºœèµ°ï¼Œè™½ç„¶æƒŠé™©ï¼Œå´ä¹Ÿåˆºæ¿€ã€‚' },
        { text: 'è®©TAå…ˆèº²èµ·æ¥', req: { wisdom: 60 }, effects: { favor: 2, suspicion: -5 }, log: 'ä½ è®©æƒ…äººèº²å¥½ï¼Œè‡ªå·±åˆ™ä»å®¹åœ°ä¸é…å¶å‘¨æ—‹ï¼Œå®Œç¾åœ°æ©é¥°äº†è¿‡å»ã€‚ä½ é…å¶çš„ç–‘å¿ƒç”šè‡³è¿˜é™ä½äº†ã€‚' }
    ]},
    'public_awkwardness': { category: 'é€šç”¨', title: 'ä¸æœŸè€Œé‡', condition: (gs, npc) => gs.marriage.isMarried, desc: 'ä½ æ­£ä¸é…å¶æ•£æ­¥ï¼Œè¿é¢ç«Ÿæ’ä¸Šäº†ä½ çš„æƒ…äººï¼', options: [
        { text: 'ä»‹ç»ä¸ºâ€œè¿œæˆ¿äº²æˆšâ€', req: { charm: 70 }, effects: { suspicion: 5 }, log: 'ä½ é•‡å®šåœ°ä»‹ç»ï¼Œä¸‰äººå¯’æš„å‡ å¥ååˆ†å¼€ï¼Œä½†ä½ çš„é…å¶ä¼¼ä¹æœ‰äº›æ€€ç–‘ã€‚' },
        { text: 'çœ¼ç¥ç¤ºæ„ï¼Œè®©å…¶ç¦»å¼€', effects: { favor: -5, devotion: 3 }, log: 'TAä¼šæ„åœ°å…ˆè¡Œç¦»å¼€ï¼Œå¿ƒä¸­è™½å¤±è½ï¼Œä½†ä¹Ÿä¸ºä½ ç€æƒ³ã€‚' }
    ]},
    'servant_discovery': { category: 'é€šç”¨', title: 'å¿ƒè…¹çš„å‘ç°', desc: 'ä½ çš„ä¸€ä½å¿ƒè…¹ä¸‹äººä¼¼ä¹å‘ç°äº†ä½ ä¸æƒ…äººçš„ç§æƒ…ï¼Œå‰æ¥å‘ä½ ç¦€æŠ¥ã€‚', options: [
        { text: 'ã€å°å£ã€‘(-300ä¸¤)', req: { wealth: 300 }, effects: { wealth: -300, virtue: -5 }, log: 'ä½ ç”¨é’±å°ä½äº†ä¸‹äººçš„å£ï¼Œä½†æ­¤äº‹ç»ˆç©¶æ˜¯ä¸ªéšæ‚£ã€‚' },
        { text: 'ã€å¦ç™½å¹¶æ”¶ä¹°ã€‘', req: { charm: 80 }, effects: { favor: 5 }, log: 'ä½ å°†ä¸‹äººæ”¶ä¸ºå¿ƒè…¹ï¼Œè´Ÿè´£ä¸ºä½ ä»¬ä¼ é€’æ¶ˆæ¯ï¼Œåè€Œæ›´åŠ æ–¹ä¾¿äº†ã€‚' },
        { text: 'ã€å¤„ç†æ‰ã€‘', req: { scheming: 90 }, effects: { virtue: -20 }, log: 'ä½ ç”¨ç‹ è¾£æ‰‹æ®µå¤„ç†æ‰äº†è¿™ä¸ªéšæ‚£ï¼Œä½†å†…å¿ƒéš¾å®‰ã€‚' }
    ]},
    'token_found': { category: 'é€šç”¨', title: 'ä¿¡ç‰©é£æ³¢', condition: (gs, npc) => gs.marriage.isMarried, desc: 'ä½ çš„é…å¶åœ¨ä½ ä¹¦æˆ¿/å¦†å°å‘ç°äº†ä¸€ä»¶ä¸å±äºä½ çš„ã€æ˜æ˜¾æ˜¯å¼‚æ€§æ‰€èµ çš„ä¿¡ç‰©ï¼', options: [
        { text: 'ã€è°ç§°æ˜¯å‹äººæ‰€èµ ã€‘', req: { charm: 90 }, effects: { suspicion: 10 }, log: 'ä½ ç”¨é«˜è¶…çš„è¨€è¯­æŠ€å·§æš‚æ—¶è’™æ··è¿‡å…³ï¼Œä½†é…å¶çš„ç–‘å¿ƒå€¼å¢åŠ äº†ã€‚' },
        { text: 'ã€æ‰¿è®¤å¹¶è¯·æ±‚åŸè°…ã€‘', effects: { favor: -50, suspicion: 50 }, log: 'ä¸€åœºå·¨å¤§çš„å®¶åº­é£æš´çˆ†å‘äº†ï¼ä½ ä»¬çš„å…³ç³»é™è‡³å†°ç‚¹ã€‚' }
    ]},
    'rumors_spreading': { category: 'é€šç”¨', title: 'æµè¨€èœšè¯­', desc: 'åŠé—´å¼€å§‹æµä¼ ä¸€äº›å…³äºä½ å’ŒæŸä½å¼‚æ€§äº¤å¾€è¿‡å¯†çš„é£è¨€é£è¯­ã€‚', effects: { reputation: -10, suspicion: 10 }, log: 'æµè¨€å¯¹ä½ çš„å£°æœ›é€ æˆäº†å½±å“ï¼Œä¹Ÿä¼ åˆ°äº†ä½ é…å¶çš„è€³ä¸­ã€‚' },
    'jealousy_provoke': { category: 'é€šç”¨', title: 'æ—æ•²ä¾§å‡»', desc: 'æƒ…äººâ€œæ— æ„â€ä¸­æèµ·ï¼Œæœ€è¿‘ä¼¼ä¹æœ‰ä½æ‰ä¿Š/ä½³äººæ­£åœ¨è¿½æ±‚TAã€‚', options: [
        { text: 'è¡¨ç°å‡ºå¼ºçƒˆçš„å æœ‰æ¬²', effects: { favor: 10 }, log: 'ä½ çš„é†‹æ„è®©TAæš—è‡ªçªƒå–œï¼ŒçŸ¥é“ä½ æ˜¯åœ¨ä¹TAçš„ã€‚' },
        { text: 'å‡è£…ä¸åœ¨æ„', effects: { favor: -8, devotion: -5 }, log: 'ä½ çš„â€œå¤§æ–¹â€è®©TAæœ‰äº›å¤±æœ›ï¼Œä¸ç¡®å®šä½ æ˜¯å¦çœŸçš„åœ¨ä¹ã€‚' }
    ]},
    'jealousy_of_spouse': { category: 'é€šç”¨', title: 'æƒ…äººçš„é†‹æ„', condition: (gs, npc) => gs.marriage.isMarried, desc: 'ä½ ä¸æ­£å¦»/å¤«å›ä¸€åŒå‡ºè¡Œçš„äº‹ä¼ åˆ°äº†æƒ…äººçš„è€³ä¸­ï¼ŒTAä¼¼ä¹æœ‰äº›ä¸æ‚¦ã€‚', options: [
        { text: 'å†™ä¿¡å®‰æŠš', effects: { favor: 8, devotion: 5 }, log: 'ä½ çš„æƒ…ä¹¦åŒ–è§£äº†TAçš„é†‹æ„ã€‚' },
        { text: 'èµ é€ç¤¼ç‰© (-300ä¸¤)', req: { wealth: 300 }, effects: { wealth: -300, favor: 12 }, log: 'æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸€ä¸ªç¤¼ç‰©è§£å†³ä¸äº†çš„ã€‚' },
        { text: 'ä¸äºˆç†ä¼š', effects: { favor: -10 }, log: 'ä½ çš„å†·å¤„ç†è®©TAæ›´åŠ ä¼¤å¿ƒã€‚' }
    ]},
    'misunderstanding': { category: 'é€šç”¨', title: 'ä¸€åœºè¯¯ä¼š', desc: 'TAè¯¯ä¼šäº†ä½ ä¸å¦ä¸€ä½å¼‚æ€§çš„å…³ç³»ï¼Œå¯¹ä½ äº§ç”Ÿäº†éš”é˜‚ã€‚', options: [
        { text: 'ã€è€å¿ƒè§£é‡Šã€‘', effects: { favor: 10, devotion: 5 }, log: 'ç»è¿‡ä¸€ç•ªè§£é‡Šï¼Œè¯¯ä¼šç»ˆäºè§£å¼€ï¼Œä½ ä»¬çš„ä¿¡ä»»æ›´æ·±äº†ã€‚' },
        { text: 'ã€è®¤ä¸ºTAæ— ç†å–é—¹ã€‘', effects: { favor: -15 }, log: 'ä½ çš„ä¸è€çƒ¦è®©è¯¯ä¼šåŠ æ·±ï¼Œä½ ä»¬å¤§åµä¸€æ¶ã€‚' }
    ]},
    'lifestyle_difference': { category: 'é€šç”¨', title: 'ç†å¿µä¹‹äº‰', desc: 'ä½ ä»¬åœ¨å¯¹å¾…é‡‘é’±æˆ–æœªæ¥çš„ç†å¿µä¸Šäº§ç”Ÿäº†åˆ†æ­§ã€‚', options: [
        { text: 'ã€æ±‚åŒå­˜å¼‚ã€‘', effects: { favor: 5, wisdom: 2 }, log: 'ä½ ä»¬é€‰æ‹©å°Šé‡å½¼æ­¤çš„å·®å¼‚ï¼Œå…³ç³»æ›´åŠ æˆç†Ÿã€‚' },
        { text: 'ã€è¯•å›¾è¯´æœå¯¹æ–¹ã€‘', effects: { favor: -5 }, log: 'ä½ ä»¬éƒ½æœªèƒ½è¯´æœå¯¹æ–¹ï¼Œä¸æ¬¢è€Œæ•£ã€‚' }
    ]},
    'future_pressure': { category: 'é€šç”¨', title: 'æœªæ¥çš„æœŸç›¼', desc: 'â€œæˆ‘ä»¬...ä»¥åä¼šå¦‚ä½•ï¼Ÿâ€ æƒ…äººæœ›ç€è¿œæ–¹ï¼Œè½»å£°é—®ä½ ï¼Œçœ¼ä¸­å¸¦ç€æœŸç›¼ä¸ä¸å®‰ã€‚', options: [
        { text: 'è®¸ä¸‹æ‰¿è¯º', effects: { favor: 15, devotion: 10 }, log: 'ä½ çš„æ‰¿è¯ºè®©TAæš‚æ—¶å®‰å¿ƒï¼Œå¯¹ä½ çš„ç—´æƒ…åº¦å¤§å¢ã€‚' },
        { text: 'æ²‰é»˜ä¸è¯­', effects: { favor: -15, devotion: -10 }, log: 'ä½ çš„æ²‰é»˜è®©TAçš„å¿ƒæ²‰äº†ä¸‹å»ï¼Œä½ ä»¬çš„å…³ç³»å‡ºç°äº†è£‚ç—•ã€‚' },
        { text: 'é¡¾å·¦å³è€Œè¨€ä»–', effects: { favor: -8 }, log: 'ä½ å·§å¦™åœ°è½¬ç§»äº†è¯é¢˜ï¼Œä½†TAçœ¼ä¸­çš„å…‰èŠ’é»¯æ·¡äº†ä¸‹å»ã€‚' }
    ]},
    'family_pressure': { category: 'é€šç”¨', title: 'å®¶ä¸­çš„å‹åŠ›', desc: 'æƒ…äººæœ€è¿‘çœ‹èµ·æ¥å¿ƒäº‹é‡é‡ï¼ŒåŸæ¥æ˜¯å®¶ä¸­æ­£åœ¨ä¸ºTAå®‰æ’å©šäº‹ã€‚', options: [
        { text: 'æ‰¿è¯ºä¼šç»™TAä¸€ä¸ªååˆ†', effects: { favor: 15, devotion: 10 }, log: 'ä½ çš„æ‰¿è¯ºè®©TAæš‚æ—¶å®‰å¿ƒã€‚' },
        { text: 'åŠTAä¸ºäº†å®¶æ—å¦¥å', effects: { favor: -20, devotion: -15, breakup: true }, log: 'ä½ çš„åŠè¯´è®©TAå½»åº•å¿ƒç¢ï¼Œä½ ä»¬çš„å…³ç³»èµ°åˆ°äº†å°½å¤´ã€‚' }
    ]},
    'sacrifice_marriage': { category: 'é€šç”¨', title: 'ä¸ºçˆ±ç‰ºç‰²', condition: (gs, npc) => npc.favor > 80, desc: 'ä½ å¾—çŸ¥ï¼Œæƒ…äººä¸ºäº†ç­‰ä½ ï¼Œæ‹’ç»äº†ä¸€é—¨å¯¹å…¶å®¶æ—ææœ‰åŠ©ç›Šçš„å©šäº‹ï¼Œå› æ­¤å¤‡å—å®¶æ—å‹åŠ›ã€‚', options: [
        { text: 'æ·±å—æ„ŸåŠ¨ï¼Œè®¸ä»¥é‡è¯º', effects: { favor: 25, devotion: 20 }, log: 'TAçš„ç‰ºç‰²è®©ä½ æ·±å—æ„ŸåŠ¨ï¼Œä½ å‘TAè®¸ä¸‹é‡è¯ºï¼Œæ­¤ç”Ÿç»ä¸è´ŸTAã€‚' },
        { text: 'åŠTAä»¥å®¶æ—ä¸ºé‡', effects: { favor: -30, devotion: -20, breakup: true }, log: 'ä½ çš„åŠè¯´è®©TAå½»åº•å¿ƒæ­»ï¼Œä½ ä»¬çš„å…³ç³»èµ°åˆ°äº†å°½å¤´ã€‚' }
    ]},
    'secret_child': { category: 'é€šç”¨', title: 'ç§ç”Ÿå­çš„è®¨è®º', condition: (gs, npc) => gs.player.gender === 'female' && npc.favor > 85, desc: 'TAæŠ±ç€ä½ ï¼Œè½»å£°é—®ï¼šâ€œå¦‚æœ...å¦‚æœæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå­©å­ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿâ€', options: [
        { text: 'ã€â€œæˆ‘ä¼šç”Ÿä¸‹æ¥â€ã€‘', effects: { favor: 20, devotion: 25 }, log: 'ä½ çš„å›ç­”è®©TAæ„ŸåŠ¨åˆå¿ƒç–¼ï¼Œå¯¹ä½ çš„çˆ±æ„è¾¾åˆ°äº†é¡¶å³°ã€‚' },
        { text: 'ã€â€œæˆ‘ä¸æ•¢æƒ³...â€ã€‘', effects: { favor: -10 }, log: 'ä½ çš„çŠ¹è±«è®©TAæ„Ÿåˆ°ä¸å®‰ã€‚' }
    ]},
    'elopement_proposal': { category: 'é€šç”¨', title: 'ç§å¥”çš„æè®®', condition: (gs, npc) => npc.devotion > 80, desc: 'â€œæˆ‘ä»¬ç¦»å¼€è¿™é‡Œå§ï¼å»ä¸€ä¸ªæ²¡äººè®¤è¯†æˆ‘ä»¬çš„åœ°æ–¹ï¼Œè¿‡æˆ‘ä»¬è‡ªå·±çš„ç”Ÿæ´»ï¼â€ TAçš„çœ¼ä¸­é—ªçƒç€ç–¯ç‹‚è€Œçƒ­åˆ‡çš„å…‰èŠ’ã€‚', options: [
        { text: 'ã€ç­”åº”TAã€‘', effects: { endgame: 'elopement' }, log: 'ä½ å†³å®šä¸ºçˆ±æ”¾å¼ƒä¸€åˆ‡ï¼Œä¸TAè¿œèµ°é«˜é£ã€‚' },
        { text: 'ã€æ‹’ç»TAã€‘', effects: { favor: -25, devotion: -20 }, log: 'ä½ çš„æ‹’ç»å¦‚ä¸€ç›†å†·æ°´ï¼Œæµ‡ç†„äº†TAæ‰€æœ‰çš„çƒ­æƒ…ã€‚' }
    ]},
    'career_help': { category: 'é€šç”¨', title: 'äº‹ä¸šä¸Šçš„æ´æ‰‹', desc: 'ä½ åœ¨äº‹ä¸šä¸Šé‡åˆ°äº†ä¸€ä¸ªéš¾é¢˜ï¼ŒTAå¾—çŸ¥åï¼Œåˆ©ç”¨è‡ªå·±çš„å…³ç³»ç½‘/æ™ºæ…§ä¸ºä½ æä¾›äº†å…³é”®çš„å¸®åŠ©ã€‚', effects: { favor: 10, career_performance: 20 }, log: 'åœ¨TAçš„å¸®åŠ©ä¸‹ï¼Œä½ é¡ºåˆ©è§£å†³äº†éš¾é¢˜ï¼ŒåŠŸç»©æå‡ã€‚' },
    'financial_trouble': { category: 'é€šç”¨', title: 'æƒ…äººçš„æ±‚åŠ©', desc: 'ä½ çš„æƒ…äººä¼¼ä¹é‡åˆ°äº†éº»çƒ¦ï¼Œæ€¥éœ€ 1000 ä¸¤é“¶å­å‘¨è½¬ï¼Œå‘ä½ å¼€å£æ±‚åŠ©ã€‚', options: [
        { text: 'ã€æ…·æ…¨è§£å›Šã€‘', req: { wealth: 1000 }, effects: { wealth: -1000, favor: 15, devotion: 10 }, log: 'ä½ å¸®åŠ©TAæ¸¡è¿‡äº†éš¾å…³ï¼ŒTAå¯¹ä½ æ„Ÿæ¿€ä¸å°½ï¼Œæ›´åŠ å€¾å¿ƒã€‚' },
        { text: 'ã€è¡¨ç¤ºæ— èƒ½ä¸ºåŠ›ã€‘', effects: { favor: -15 }, log: 'ä½ çš„æ‹’ç»è®©TAæ„Ÿåˆ°å¤±æœ›ï¼Œä½ ä»¬çš„å…³ç³»å‡ºç°äº†è£‚ç—•ã€‚' }
    ]},
    'defend_reputation': { category: 'é€šç”¨', title: 'ç»´æŠ¤åå£°', desc: 'æœ‰äººåœ¨èƒŒåè¯´ä½ çš„åè¯ï¼ŒTAå¾—çŸ¥åï¼Œåœ¨å…¬å¼€åœºåˆä¸ºä½ è¾©è§£ã€‚', effects: { favor: 12, devotion: 8 }, log: 'TAçš„ç»´æŠ¤è®©ä½ ååˆ†æ„ŸåŠ¨ã€‚' },
    'joint_investment': { category: 'é€šç”¨', title: 'ç§˜å¯†çš„åˆä½œ', desc: 'æƒ…äººå‘Šè¯‰ä½ ä¸€ä¸ªç§˜å¯†çš„èµšé’±æœºä¼šï¼Œé‚€è¯·ä½ ä¸€åŒæŠ•èµ„ï¼Œä½œä¸ºä½ ä»¬æœªæ¥çš„â€œå°é‡‘åº“â€ã€‚', options: [
        { text: 'æŠ•å…¥1000ä¸¤', req: { wealth: 1000 }, effects: { wealth: -1000, random: [{chance: 0.7, wealth: 1800, log: 'åˆä½œå…±èµ¢ï¼ä½ ä»¬çš„â€œå°é‡‘åº“â€æ›´åŠ å……è£•äº†ã€‚'}, {chance: 0.3, log: 'ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ¬¡æŠ•èµ„å¤±è´¥äº†ã€‚'}] } },
        { text: 'è®¤ä¸ºé£é™©å¤ªå¤§ï¼Œæ‹’ç»', effects: { favor: -5 }, log: 'ä½ æ‹’ç»äº†è¿™æ¬¡æŠ•èµ„ï¼ŒTAè¡¨ç¤ºç†è§£ä½†æœ‰äº›å¤±æœ›ã€‚' }
    ]},
    'illness_care': { category: 'é€šç”¨', title: 'ç—…ä¸­å…³æ€€', desc: 'ä½ ç”Ÿäº†ä¸€åœºå°ç—…ï¼ŒTAå¬é—»åå¿ƒæ€¥å¦‚ç„šï¼Œæƒ³å°½åŠæ³•ä¸ºä½ é€æ¥åè´µçš„è¯æã€‚', effects: { favor: 15, devotion: 10, health: 5 }, log: 'TAçš„å…³æ€€è®©ä½ åœ¨ç—…ä¸­æ„Ÿåˆ°äº†å·¨å¤§çš„æ¸©æš–ã€‚' },
    'cooking_for_you': { category: 'é€šç”¨', title: 'æ´—æ‰‹ä½œç¾¹æ±¤', desc: 'TAç¬¬ä¸€æ¬¡ä¸ºä½ ä¸‹å¨ï¼Œè™½ç„¶æ‰‹å¿™è„šä¹±ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯ä¸ºä½ ç«¯ä¸Šäº†ä¸€æ¡Œèœã€‚', options: [
        { text: 'ã€å¤§åŠ ç§°èµã€‘', effects: { favor: 12, devotion: 5 }, log: 'ä½ çš„ç§°èµè®©TAååˆ†å¼€å¿ƒï¼Œè§‰å¾—ä¸€åˆ‡è¾›è‹¦éƒ½å€¼å¾—ã€‚' },
        { text: 'ã€å–„æ„åœ°æŒ‡å‡ºä¸è¶³ã€‘', effects: { favor: 2 }, log: 'TAæ¥å—äº†ä½ çš„æ„è§ï¼Œå¹¶è¡¨ç¤ºä¸‹æ¬¡ä¼šåšå¾—æ›´å¥½ã€‚' }
    ]},
    'jealousy_from_player': { category: 'é€šç”¨', title: 'ä½ çš„é†‹æ„', desc: 'ä½ çœ‹åˆ°TAä¸åˆ«äººç›¸è°ˆç”šæ¬¢ï¼Œå¿ƒä¸­ä¸ç¦æ³›èµ·ä¸€ä¸é…¸æ¥šã€‚', options: [
        { text: 'ã€ä¸Šå‰å®£ç¤ºä¸»æƒã€‘', effects: { favor: 8, devotion: 5 }, log: 'ä½ çš„å°å°é†‹æ„è®©TAæš—è‡ªå¼€å¿ƒã€‚' },
        { text: 'ã€äº‹åæ—æ•²ä¾§å‡»ã€‘', effects: { favor: 5 }, log: 'ä½ äº‹åè¯¢é—®ï¼ŒTAå‘ä½ è§£é‡Šäº†æƒ…å†µã€‚' }
    ]},
    'understanding': { category: 'é€šç”¨', title: 'æ— å£°çš„ç†è§£', desc: 'ä½ å› æŸäº‹å¿ƒæƒ…ä¸ä½³ï¼ŒTAæ²¡æœ‰å¤šé—®ï¼Œåªæ˜¯é»˜é»˜åœ°é™ªåœ¨ä½ èº«è¾¹ã€‚', effects: { favor: 10, devotion: 10 }, log: 'è¿™ä»½æ— å£°çš„ç†è§£æ¯”ä»»ä½•è¨€è¯­éƒ½æ›´è®©ä½ æ„Ÿåˆ°å®‰æ…°ã€‚' },
    'affair_exposed': { category: 'é€šç”¨', title: 'ä¸œçª—äº‹å‘', condition: (gs, npc) => gs.marriage.isMarried, desc: 'ä½ ä¸æƒ…äººçš„å…³ç³»è¢«ä½ çš„æ­£å¦»/æ­£å¤«å‘ç°ï¼ä¸€åœºé£æš´å³å°†æ¥ä¸´ã€‚', options: [
        { text: 'èŠ±è´¹å·¨é¢é‡‘é’±å¹³æ¯', req: { wealth: 10000 }, effects: { favor: -30, wealth: -10000 }, log: 'ä½ ç”¨é’±æš‚æ—¶å¹³æ¯äº†äº‹ç«¯ï¼Œä½†å¤«å¦»å…³ç³»å·²é™è‡³å†°ç‚¹ã€‚' },
        { text: 'å’Œç¦»', callback: (npcId) => { confirmDivorce(); } }
    ]}
};
const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];
const formatNumber = (num, isFloat=false) => {
    num = Number(num);
    if(isNaN(num)) return "0";
    if (num >= 10000 && !isFloat) return (num / 10000).toFixed(1) + 'ä¸‡';
    return isFloat ? num.toFixed(2) : Math.floor(num).toString();
};

function showToast(message, duration = 2000) {
    const toast = document.getElementById('toast');
    if (!toast) return;
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, duration);
};

function generateRandomName(gender, existingNames) {
    let name;
    let attempts = 0;
    const namePool = gender === 'female' ? nameData.girlNames : nameData.boyNames;
    do {
        const surname = getRandomElement(nameData.surnames);
        const givenName = getRandomElement(namePool);
        name = surname + givenName;
        attempts++;
    } while (existingNames.has(name) && attempts < 50);
    if(attempts >= 50) name = name + 'Â·' + getRandomElement(['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±']); // fallback for large npc counts
    existingNames.add(name);
    return name;
};

const NPC_BACKGROUND_DESCRIPTIONS = [
 "æ®è¯´æ˜¯ä½å®¶é“ä¸­è½çš„è´µæ—åè£”ï¼Œçœ‰å®‡é—´æ€»å¸¦ç€ä¸€æŠ¹æŒ¥ä¹‹ä¸å»çš„å¿§éƒã€‚",
    "å¸¸å¹´åœ¨æ±Ÿæ¹–è¡Œèµ°çš„ä¾ å®¢ï¼Œçœ¼ç¥é”åˆ©ï¼Œè…°é—´æ€»æ˜¯é…ç€ä¸€æŠŠä¸èµ·çœ¼çš„çŸ­å‰‘ã€‚",
    "äº¬åŸæœ‰åçš„æ‰å­/æ‰å¥³ï¼Œè¯—ç”»åŒç»ï¼Œå¼•å¾—æ— æ•°åé—¨å­å¼Ÿ/é—ºç§€å€¾å¿ƒã€‚",
    "çœ‹ä¼¼å¤©çœŸçƒ‚æ¼«çš„å¹´è½»äººï¼Œä½†å¶å°”æµéœ²å‡ºçš„çœ¼ç¥å´æ·±é‚ƒå¾—ä¸åƒå…¶å¹´çºªã€‚",
    "ä¸€ä½æ²‰é»˜å¯¡è¨€çš„æ­¦äººï¼Œæ®è¯´æ›¾åœ¨è¾¹å…³ç«‹ä¸‹èµ«èµ«æˆ˜åŠŸã€‚",
    "å‡ºèº«æ±Ÿå—æ°´ä¹¡çš„å¯Œå•†ï¼Œè°ˆåé£é›…ï¼Œç²¾äºç®—è®¡ï¼Œæ˜¯å•†åœºä¸Šçš„å‰å®³è§’è‰²ã€‚",
    "æ€»æ˜¯åœ¨é…’æ¥¼ç‹¬è‡ªä¹°é†‰çš„å¤±æ„æ–‡äººï¼Œä¼¼ä¹æ€€æ‰ä¸é‡ï¼Œæ»¡è…¹ç‰¢éªšã€‚",
    "åŒ»æœ¯é«˜è¶…ä½†æ€§æ ¼å¤æ€ªçš„åŒ»å¸ˆï¼Œåªæ•‘çœ‹å¾—é¡ºçœ¼çš„äººã€‚",
    "æ¥è‡ªå¼‚åŸŸçš„ç¥ç§˜èˆè€…ï¼Œä¸€èˆåŠ¨äº¬åŸï¼Œæ— äººçŸ¥å…¶æ¥å†ã€‚",
    "è¡¨é¢ä¸Šæ˜¯å›½å­ç›‘çš„æ™®é€šå­¦å­ï¼Œæš—åœ°é‡Œä¼¼ä¹ä¸æœä¸­æŸè‚¡åŠ¿åŠ›æœ‰è”ç³»ã€‚",
"ä¸€ä½é€€éšå±±æ—çš„æ™ºè€…ï¼Œå¶å°”ä¼šå‡ºç°åœ¨å¸‚é›†ä¸Šï¼Œæ²¡äººçŸ¥é“å…¶æ›¾æ˜¯å¨éœ‡ä¸€æ–¹çš„å¤§ä¾ ã€‚"
];
// ===================== ã€ç¬¬ä¸€æ­¥ï¼šè¯·å°†æ­¤å‡½æ•°å®Œæ•´ç²˜è´´åˆ°æ‚¨çš„ä»£ç ä¸­ã€‘ =====================
/**
 * [æ–°å¢] åˆ›å»ºä¸€ä¸ªå­©å­/å­™è¾ˆçš„åŸºç¡€å¯¹è±¡
 * @param {object} options - åŒ…å«çˆ¶æ¯ã€æ€§åˆ«ç­‰ä¿¡æ¯çš„å¯¹è±¡
 * @returns {object} - è¿”å›ä¸€ä¸ªå®Œæ•´çš„å­©å­å¯¹è±¡
 */
function generateChild(options = {}) {
    const { mother, father, gender, isSecret = false } = options;

    const newChild = {
        id: `child_${Date.now()}_${getRandomInt(1000, 9999)}`,
        name: 'å¾…å‘½å', // åç»­å°†ç”±å‘½åå‡½æ•°èµ‹äºˆæ­£å¼åå­—
        gender: gender,
        age: 0,
        isDead: false,
        motherId: mother.id,
        fatherId: father.id, // åˆæ³•çˆ¶äº²
        biologicalFatherId: father.id, // ç”Ÿç‰©å­¦çˆ¶äº²
        isSecret: isSecret,
        attributes: {},
        personality: [],
        cultivationLog: [],
        marriage: { isMarried: false, spouseId: null, spouseInfo: null }, // ç¡®ä¿spouseInfoä¹Ÿåˆå§‹åŒ–
        education: null,
        allowance: 0,
        career: null,
        avatar: getRandomElement(avatarPools[gender])
    };

    // æ ¹æ®çˆ¶æ¯å±æ€§ï¼Œç”Ÿæˆå­å—£çš„åˆå§‹å±æ€§
    const p1_attrs = mother.attributes || {};
    const p2_attrs = father.attributes || {};
    newChild.attributes = {
        talent: Math.floor(((p1_attrs.talent || 20) + (p2_attrs.talent || 20)) / 10) + getRandomInt(1, 5),
        wisdom: Math.floor(((p1_attrs.wisdom || 20) + (p2_attrs.wisdom || 20)) / 10) + getRandomInt(1, 5),
        charm: Math.floor(((p1_attrs.charm || 20) + (p2_attrs.charm || 20)) / 10) + getRandomInt(1, 5),
        health: 100,
        etiquette: 0,
        virtue: 0,
        martial: 0
    };

    return newChild;
}
function generateNPC(options = {}) {
    const gender = options.gender || (Math.random() > 0.5 ? 'male' : 'female');
    const id = options.id || `npc_${Date.now()}_${getRandomInt(1000, 9999)}`;
    
    if (gameState.npcs[id]) {
        return gameState.npcs[id];
    }
    
    let name = options.name;
    if (!name) {
        name = generateRandomName(gender, gameState.flags.allNames);
    } else {
        if (gameState.flags.allNames.has(name)) {
            let uniqueName = name;
            let i = 2;
            do {
                uniqueName = `${name}Â·${i}`;
                i++;
            } while (gameState.flags.allNames.has(uniqueName));
            name = uniqueName;
        }
        gameState.flags.allNames.add(name);
    }
    
    const allPersonalities = [...personalityTraits.positive, ...personalityTraits.negative];
    
    const rarityRoll = Math.random();
    let rarity = 'common';
    if (rarityRoll > 0.9) rarity = 'legendary';
    else if (rarityRoll > 0.6) rarity = 'rare';
    
    const npc = {
        id: id,
        name: name,
        title: options.title || (gender === 'male' ? 'å…¬å­' : 'å§‘å¨˜'),
        rarity: options.rarity || rarity,
        gender: gender,
        age: options.age || getRandomInt(16, 40),
        personality: options.personality ? [options.personality] : [getRandomElement(allPersonalities)],
        background: { desc: getRandomElement(NPC_BACKGROUND_DESCRIPTIONS) }, 
        favor: options.favor || 0,
        relationship: options.relationship || 'stranger',
        isDead: false,
        lastInteractedTurn: gameState.date.turn,
        avatar: options.avatar || getRandomElement(avatarPools[gender]),
        ...options,
        attributes: {
            talent: getRandomInt(20, 60),
            charm: getRandomInt(20, 60),
            wisdom: getRandomInt(20, 60),
            virtue: getRandomInt(20, 60),
            martial: getRandomInt(20,60),
            ...options.attributes
        }
    };
    
    // ã€ä¿®å¤ã€‘ä¸ºæ‰€æœ‰æ–°ç”Ÿæˆçš„NPCæ·»åŠ å–œå¥½è®¾å®š
    const allGoods = Object.keys(TRADING_GOODS_DATA);
    const shuffledGoods = allGoods.sort(() => 0.5 - Math.random());
    npc.preferences = {
        likes: shuffledGoods.slice(0, getRandomInt(1, 2)),
        dislikes: shuffledGoods.slice(2, 3),
        known: false
    };

    gameState.npcs[npc.id] = npc;
    return npc;
}
// =======================================================================
// ================= GAME INITIALIZATION & STATE MANAGEMENT ===============
// =======================================================================

function initGame() {
    const autoSave = localStorage.getItem(SAVE_SLOT_KEY_PREFIX + 'auto');
    if (autoSave) {
        if (confirm("æ£€æµ‹åˆ°æœ‰è‡ªåŠ¨å­˜æ¡£ï¼Œæ˜¯å¦ç»§ç»­ä¸Šä¸€æ¬¡çš„æ¸¸æˆï¼Ÿ")) {
            loadGame('auto', true);
            document.getElementById('loadingOverlay').style.display = 'none';
            return;
        }
    }
    document.getElementById('loadingOverlay').style.display = 'none';
    showOverlay('genderSelectionOverlay');
}

function startNewGame(gender, inheritanceData = null, options = {}) {
    if (isProcessing) return;
    isProcessing = true;
    closeAllOverlays();
    document.getElementById('loadingOverlay').style.display = 'flex';

    setTimeout(() => {
        setupNewGame(gender, inheritanceData, options); // <--- ç¡®ä¿å‚æ•°éƒ½ä¼ é€’
        document.getElementById('loadingOverlay').style.display = 'none';
        isProcessing = false;
    }, 500);
}
// ä¿®æ”¹ setupNewGame å‡½æ•°ï¼Œå¢åŠ  options å‚æ•°
// [æ›¿æ¢]
function showGiftGivingOverlay(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return;
    const warehouseItems = gameState.tradingSystem.warehouse;
    const inventoryItems = gameState.inventory || []; 
    
    if (warehouseItems.length === 0 && inventoryItems.length === 0) {
        showToast("ä½ çš„ä»“åº“å’Œè—å®é˜é‡Œéƒ½æ²¡æœ‰å¯ä»¥èµ é€çš„ç‰©å“ã€‚");
        return;
    }

    let itemsHTML = '';
    
    if (warehouseItems.length > 0) {
        itemsHTML += `<div class="section-header"><i class="fas fa-warehouse"></i> å•†ä¼šä»“åº“</div>`;
        itemsHTML += warehouseItems.map(item => {
            const itemDef = TRADING_GOODS_DATA[item.id];
            if (!itemDef) return '';
            return `
                <div class="marketplace-item">
                    <span>
                        <strong>${itemDef.name}</strong><br>
                        <small>è´­å…¥ä»·: ${item.buyPrice} ä¸¤</small>
                    </span>
                    <button class="control-btn" onclick="giveGift('${npcId}', '${item.id}', '${item.instanceId}', 'warehouse')">èµ é€</button>
                </div>
            `;
        }).join('');
    }
    
    if (inventoryItems.length > 0) {
        itemsHTML += `<div class="section-header" style="margin-top:15px;"><i class="fas fa-gem"></i> è—å®é˜</div>`;
        itemsHTML += inventoryItems.map(item => {
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åŒæ ·ï¼Œå¦‚æœITEM_DATAé‡Œæ‰¾ä¸åˆ°ï¼Œå°±ç”¨ç‰©å“è‡ªèº«ä¿¡æ¯
            const itemDef = ITEM_DATA[item.id] || item;
            
            if (!itemDef || itemDef.type === 'æ–‡ä¹¦') return ''; 
             return `
                <div class="marketplace-item">
                    <span>
                        <strong>${itemDef.name}</strong> (x${item.amount})<br>
                        <small>${itemDef.desc}</small>
                    </span>
                    <button class="control-btn" onclick="giveGift('${npcId}', '${item.id}', '${item.instanceId}', 'inventory')">èµ é€</button>
                </div>
            `;
        }).join('');
    }

    const content = `
        <p>é€‰æ‹©ä¸€ä»¶ç‰©å“é€ç»™ <strong class="highlight-npc">${npc.name}</strong>ï¼š</p>
        <div style="max-height: 50vh; overflow-y: auto;">${itemsHTML}</div>
    `;
    showDecisionCard(`èµ é€ç¤¼ç‰©`, 'fa-gift', content, []);
}
// ã€æ–°å¢ã€‘å¤„ç†èµ é€ç¤¼ç‰©é€»è¾‘çš„å‡½æ•°
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function giveGift(npcId, itemId, instanceIdStr, source) {
    const npc = gameState.npcs[npcId];
    if (!npc) {
        showToast("æ“ä½œå¤±è´¥ï¼Œäººç‰©ä¸å­˜åœ¨ã€‚");
        return;
    }

    let itemDef, favorChange, resultText;
    let itemRemoved = false;
    const instanceId = isNaN(parseInt(instanceIdStr)) ? instanceIdStr : parseInt(instanceIdStr);
    
    if (source === 'warehouse') {
        const itemIndex = gameState.tradingSystem.warehouse.findIndex(i => i.instanceId === instanceId);
        if (itemIndex > -1) {
            itemDef = TRADING_GOODS_DATA[itemId];
            gameState.tradingSystem.warehouse.splice(itemIndex, 1);
            itemRemoved = true;
        }
    } else if (source === 'inventory') {
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨è¿™é‡Œé‡å†™äº†ä»è—å®é˜èµ é€ç‰©å“çš„é€»è¾‘
        const itemIndex = gameState.inventory.findIndex(i => i.instanceId == instanceId); // ä½¿ç”¨éä¸¥æ ¼ç­‰äºä»¥å…¼å®¹æ•°å­—å’Œå­—ç¬¦ä¸²
        if (itemIndex > -1) {
            const itemInstance = gameState.inventory[itemIndex];
            // å…ˆè·å–ç‰©å“å®šä¹‰ï¼Œä½¿ç”¨æˆ‘ä»¬æ–°çš„ fallback é€»è¾‘
            itemDef = ITEM_DATA[itemInstance.id] || itemInstance;
            
            // ç„¶åå¤„ç†ç§»é™¤
            itemInstance.amount -= 1;
            if (itemInstance.amount <= 0) {
                gameState.inventory.splice(itemIndex, 1);
            }
            itemRemoved = true;
        }
    }

    if (!itemRemoved || !itemDef) {
        showToast("æ“ä½œå¤±è´¥ï¼Œç‰©å“ä¸å­˜åœ¨æˆ–å·²é€å‡ºã€‚");
        return;
    }

    if (itemDef.sincerity) { 
        favorChange = 10 + Math.floor(itemDef.sincerity / 2);
        resultText = `è¿™ä»½äº²æ‰‹åˆ¶ä½œçš„ç¤¼ç‰©é¥±å«å¿ƒæ„ï¼Œå¯¹æ–¹æ„ŸåŠ¨ä¸å·²ï¼`;
    } else if (npc.preferences && npc.preferences.likes.includes(itemId)) {
        favorChange = getRandomInt(15, 25);
        resultText = `è¿™æ­£æ˜¯TAå¿ƒå¤´æ‰€å¥½ï¼å¯¹æ–¹çœ‹èµ·æ¥æ¬£å–œè‹¥ç‹‚ã€‚`;
    } else if (npc.preferences && npc.preferences.dislikes.includes(itemId)) {
        favorChange = -getRandomInt(5, 10);
        resultText = `TAçš„è„¸è‰²æ²‰äº†ä¸‹æ¥ï¼Œä¼¼ä¹å¹¶ä¸å–œæ¬¢è¿™ä¸ªç¤¼ç‰©ã€‚`;
    } else {
        favorChange = getRandomInt(1, 5);
        resultText = `æ”¶ä¸‹äº†ä½ çš„ç¤¼ç‰©ï¼Œå¯¹ä½ è¡¨ç¤ºæ„Ÿè°¢ã€‚`;
    }
    
    applyEffects({ relationship: { targetId: npcId, favor: favorChange } });
    
    showEventCard('èµ ç¤¼ç»“æœ', 'fa-gift',
        `ä½ å°†ã€${itemDef.name}ã€‘é€ç»™äº† ${npc.name}ã€‚<br>${resultText}<br>å¥½æ„Ÿåº¦ ${favorChange > 0 ? '+' : ''}${favorChange}ã€‚`
    );
    
    if (document.getElementById('npcDetailOverlay').style.display === 'flex') {
       showNPCDetails(npcId);
    }
}
// ã€æ–°å¢ã€‘NPCå›ç¤¼çš„æ£€æŸ¥å‡½æ•°
function checkForNpcGifting() {
    if (!gameState.social.relationships) return;

    Object.keys(gameState.social.relationships).forEach(npcId => {
        const npc = gameState.npcs[npcId];
        if (npc && !npc.isDead && npc.favor > 70 && Math.random() < 0.05) { // å¥½æ„Ÿåº¦>70, 5%å‡ ç‡
            const warehouse = gameState.tradingSystem.warehouse;
            if (warehouse.length >= gameState.tradingSystem.warehouseCapacity) return;

            const giftId = getRandomElement(Object.keys(TRADING_GOODS_DATA));
            const giftDef = TRADING_GOODS_DATA[giftId];

            warehouse.push({
                instanceId: Date.now(),
                id: giftId,
                buyPrice: 0, // è·èµ çš„ç‰©å“æˆæœ¬ä¸º0
                boughtAt: { ...gameState.date }
            });

            showEventCard('æ„å¤–ä¹‹å–œ', 'fa-gift', 
                `<strong class="highlight-npc">${npc.name}</strong>å‰æ¥æ‹œè®¿ï¼Œå¹¶ä¸ºä½ å¸¦æ¥äº†ä¸€ä»¶ç¤¼ç‰©ã€${giftDef.name}ã€‘ï¼Œä»¥æ„Ÿè°¢ä½ ä¸€ç›´ä»¥æ¥çš„æƒ…è°Šã€‚`
            );
        }
    });
}
function generateInitialNPCs() {
    gameState.suitors = [];
    // The initial 5 suitors are removed as per request.
    // New ones will be generated via events.
}

function getSweetheartEvents() {
    const sweetheart = gameState.npcs[gameState.flags.childhoodSweetheartId];
    if (!sweetheart) return [];

    return [
        {
            id: 'study_together',
            title: 'ä¹¦æ–‹å…±è¯»',
            description: `çª—å¤–ç»†é›¨è¿ç»µï¼Œä½ ä¸ <strong class="highlight-npc">${sweetheart.name}</strong> æ­£åœ¨ä¹¦æˆ¿ä¸€åŒæ¸©ä¹ åŠŸè¯¾ã€‚å¥¹æœ‰ä¸€å¤„ç»ä¹‰ä¸è§£ï¼Œå‘ä½ è¯·æ•™ã€‚`,
            options: [
                { text: 'ã€è€å¿ƒè®²è§£ã€‘', req: { wisdom: 40 }, effects: { favor: 5, bond: 10, player_wisdom: 1 }, log: 'å¥¹å¯¹ä½ çš„æ‰å­¦é’¦ä½©ä¸å·²ï¼Œä½ ä»¬çš„ç¾ç»Šæ›´æ·±äº†ã€‚' },
                { text: 'ã€å€Ÿæœºè°ƒä¾ƒã€‘', req: { charm: 40 }, effects: { favor: 8, bond: 5 }, log: 'ä½ æ‰“è¶£å¥¹ï¼Œå¥¹ä½¯æ€’æ¶ä½ ï¼Œæ°”æ°›æš§æ˜§ã€‚' },
                { text: 'ã€æˆ‘ä¹Ÿä¸æ‡‚ã€‘', req: {}, effects: { bond: 5 }, log: 'ä½ ä»¬ç›¸è§†ä¸€ç¬‘ï¼Œå†³å®šä¸€èµ·å»è¯·æ•™å…ˆç”Ÿã€‚' }
            ]
        },
        {
            id: 'lantern_festival',
            title: 'å…ƒå®µç¯ä¼š',
            description: `å…ƒå®µä½³èŠ‚ï¼Œäººæ½®æ±¹æ¶Œï¼Œä½ ä¸ <strong class="highlight-npc">${sweetheart.name}</strong> ä¸æ…åœ¨ç¯ä¼šä¸Šèµ°æ•£ã€‚`,
            options: [
                { text: 'ã€å†·é™å¯»æ‰¾ã€‘', req: {}, effects: { favor: 10, bond: 10 }, log: 'ä½ æœ€ç»ˆåœ¨æ¡¥è¾¹æ‰¾åˆ°äº†ç„¦æ€¥çš„å¥¹ï¼Œå¥¹æ‰‘å…¥ä½ çš„æ€€ä¸­ã€‚' },
                // This option requires an item system, for now we simplify it
                { text: 'ã€å¤§å£°å‘¼å–Šã€‘', req: {}, effects: { favor: 5, bond: 5 }, log: 'ä½ åœ¨äººç¾¤ä¸­å¤§å£°å‘¼å–Šå¥¹çš„åå­—ï¼Œç»ˆäºæ‰¾åˆ°äº†å½¼æ­¤ã€‚' }
            ]
        },
        {
            id: 'unjust_blame',
            title: 'æ— å¦„ä¹‹ç¾',
            description: `å¥¹å› è¯¯ä¼šè€Œè¢«é•¿è¾ˆè´£ç½šï¼Œç‹¬è‡ªåœ¨èŠ±å›­å‚æ³ªã€‚`,
            options: [
                { text: 'ã€æŒºèº«è€Œå‡ºï¼Œä¸ºå¥¹è¾©è§£ã€‘', req: {}, effects: { favor: 15, bond: 20 }, log: 'ä½ ä¸ºå¥¹æ‰¿æ‹…äº†è´£ä»»ï¼Œå¥¹è§†ä½ ä¸ºå”¯ä¸€çš„ä¾é ã€‚' },
                { text: 'ã€é»˜é»˜é™ªä¼´å®‰æ…°ã€‘', req: {}, effects: { favor: 8, bond: 8 }, log: 'ä½ çš„é™ªä¼´ç»™äº†å¥¹åŠ›é‡ã€‚' }
            ]
        }
    ];
}
// =======================================================================
// ===================== ã€æ–°å¢ã€‘æƒ…äººä¸“å±éšæœºäº‹ä»¶è§¦å‘å™¨ ==================
// =======================================================================
// ===================== ã€ç¬¬äºŒæ­¥ï¼šæ–°å¢çº¦ä¼šåœºæ™¯è§¦å‘å‡½æ•°ã€‘ =====================
/**
 * [æ–°å¢] å¯åŠ¨ä¸€ä¸ªéšæœºçš„çº¦ä¼šåœºæ™¯
 * @param {string} npcId - æƒ…äººID
 * @param {string} locationId - åœ°ç‚¹ID (æ¥è‡ª DATE_LOCATIONS)
 */
function startDatingScene(npcId, locationId) {
    const location = DATE_LOCATIONS[locationId];
    if (!location) return;

    // 1. ç­›é€‰å‡ºæ‰€æœ‰ç¬¦åˆåœ°ç‚¹æ ‡ç­¾çš„äº‹ä»¶ï¼Œä»¥åŠæ‰€æœ‰â€œé€šç”¨â€äº‹ä»¶
    const possibleEvents = Object.entries(LOVER_EVENTS_EXPANDED).filter(([key, event]) => {
        return event.category === 'é€šç”¨' || (location.tags && location.tags.includes(event.category));
    });

    if (possibleEvents.length === 0) {
        showEventCard('å¹³æ·¡çš„ä¸€æ—¥', location.icon, `ä½ ä¸æƒ…äººåœ¨${location.name}åº¦è¿‡äº†ä¸€ä¸ªå¹³æ·¡çš„ä¸‹åˆï¼Œæœªæœ‰ç‰¹æ®Šä¹‹äº‹å‘ç”Ÿã€‚`, []);
        return;
    }

    // 2. ä»ç¬¦åˆæ¡ä»¶çš„äº‹ä»¶ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ª
    const [eventKey, eventData] = getRandomElement(possibleEvents);

    // 3. è°ƒç”¨æˆ‘ä»¬å·²æœ‰çš„ triggerLoverEvent å‡½æ•°æ¥æ˜¾ç¤ºè¿™ä¸ªéšæœºé€‰å‡ºçš„äº‹ä»¶
    //    è¿™é‡Œæˆ‘ä»¬å°±ä¸éœ€è¦å†å†™ä¸€éæ˜¾ç¤ºå¼¹çª—çš„é€»è¾‘äº†ï¼Œå®ç°äº†ä»£ç å¤ç”¨
    triggerLoverEvent(npcId, eventKey);
}
function triggerLoverEvents() {
    if (!gameState.social.secretLovers || gameState.social.secretLovers.length === 0) return;
    // æ¯å›åˆä¸ºæ¯ä¸ªæƒ…äººè®¡ç®—ä¸€æ¬¡è§¦å‘å‡ ç‡
    gameState.social.secretLovers.forEach(loverId => {
        const npc = gameState.npcs[loverId];
        if (!npc || npc.isDead) return;
        // åŸºç¡€è§¦å‘ç‡5%ï¼Œå¥½æ„Ÿåº¦è¶Šé«˜å‡ ç‡è¶Šå¤§
        const triggerChance = 0.05 + (npc.favor / 500); 
        if (Math.random() < triggerChance) {
            // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤ã€‘è¿™é‡Œæ˜¯é—®é¢˜çš„å…³é”®ï¼æˆ‘ä»¬å°†å…¶ä» LOVER_EVENTS æ”¹ä¸º LOVER_EVENTS_EXPANDED â–¼â–¼â–¼
            const allEvents = Object.values(LOVER_EVENTS_EXPANDED);
            // â–²â–²â–² ã€ä¿®å¤ç»“æŸã€‘ â–²â–²â–²
            const eventData = getRandomElement(allEvents);
            // æ£€æŸ¥äº‹ä»¶è§¦å‘æ¡ä»¶
            if (eventData.condition && !eventData.condition(gameState, npc)) {
                return; // ä¸æ»¡è¶³æ¡ä»¶åˆ™è·³è¿‡
            }
            
            // æ‰¾åˆ°äº†ä¸€ä¸ªå¯è§¦å‘çš„äº‹ä»¶
            let options = [];
            if (eventData.options) {
                options = eventData.options.map(opt => {
                    // æ£€æŸ¥é€‰é¡¹è¦æ±‚
                    let canSelect = true;
                    if (opt.req) {
                        for (const key in opt.req) {
                            if ((gameState.player.attributes[key] || gameState.finances[key] || 0) < opt.req[key]) {
                                canSelect = false;
                                break;
                            }
                        }
                    }
                    return {
                        htmlContent: `<span class="option-text">${opt.text}</span>`,
                        disabled: !canSelect,
                        callback: () => {
                            let resultLog = opt.log;
                            if (opt.effects) {
                                if (opt.effects.favor) applyEffects({ relationship: { targetId: loverId, favor: opt.effects.favor }});
                                if (opt.effects.devotion) {
                                    const rel = gameState.social.relationships[loverId];
                                    if (rel) rel.emotionValue = (rel.emotionValue || 0) + (opt.effects.devotion * 1.5);
                                }
                                if (opt.effects.wealth) applyEffects({ wealth: opt.effects.wealth });
                            }
                            if (opt.callback) {
                                opt.callback(loverId); // å¤„ç†ç‰¹æ®Šå›è°ƒï¼Œå¦‚å’Œç¦»
                            }
                            showEventCard(eventData.title, 'fa-heart-broken', resultLog);
                        }
                    };
                });
            } else {
                 // å¦‚æœäº‹ä»¶æ²¡æœ‰é€‰é¡¹ï¼Œåªæœ‰ä¸€ä¸ªé»˜è®¤ç»“æœ
                 if (eventData.effects) {
                    if (eventData.effects.favor) applyEffects({ relationship: { targetId: loverId, favor: eventData.effects.favor }});
                 }
            }
            // å°†äº‹ä»¶æ¨å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…æ˜¾ç¤º
            eventQueue.push(() => {
                if (eventData.options) {
                    showDecisionCard(eventData.title, 'fa-mask', eventData.desc, options);
                } else {
                    showEventCard(eventData.title, 'fa-mask', eventData.desc);
                }
            });
        }
    });
}
// ===================== ã€ç¬¬äºŒæ­¥ï¼šæ›¿æ¢æ­¤å‡½æ•°ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function triggerSweetheartEvent() {
    const playerAge = gameState.player.age;
    const bondValue = gameState.flags.bondValue || 0;
    const triggeredEvents = gameState.flags.triggeredSweetheartEvents || [];

    const eventPool = gameState.player.gender === 'female' 
        ? CHILDHOOD_SWEETHEART_EVENTS_FEMALE_PERSPECTIVE 
        : CHILDHOOD_SWEETHEART_EVENTS;

    const availableEvents = Object.values(eventPool).filter(event => {
        const inAgeRange = playerAge >= event.age_range[0] && playerAge <= event.age_range[1];
        const notTriggered = !triggeredEvents.includes(event.id);
        const bondMet = !event.bond_req || bondValue >= event.bond_req;
        const careerMet = !event.is_career_related || (gameState.career.path && gameState.career.level > 0);
        return inAgeRange && notTriggered && bondMet && careerMet;
    });

    if (availableEvents.length === 0) return;
    let eventToTrigger = availableEvents.find(e => e.is_final);
    if (!eventToTrigger) {
        eventToTrigger = availableEvents.find(e => !e.is_random);
    }
    if (!eventToTrigger && Math.random() < 0.3) {
        eventToTrigger = getRandomElement(availableEvents.filter(e => e.is_random));
    }

    if (!eventToTrigger) return;
    
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†äº‹ä»¶å­˜å…¥ social ä»“åº“
    addUiEvent('social', () => {
        gameState.flags.triggeredSweetheartEvents.push(eventToTrigger.id);
        let options = [];
        if (eventToTrigger.is_final) {
            const sweetheart = gameState.npcs[gameState.flags.childhoodSweetheartId];
            if (!gameState.marriage.isMarried) {
                options.push({ text: `ã€å‰å¾€æäº²ï¼Œç«‹ä¸ºæ­£å¦»ã€‘`, req: { bond: 80, wealth: 5000 }, effects: { proposal: 'wife' }, log: `ä½ å†³å®šä¸è´ŸéŸ¶åï¼Œå‰å¾€${sweetheart.name}å®¶ä¸­æäº²ã€‚` });
            }
            if (gameState.marriage.isMarried && sweetheart.relationship !== 'spouse') {
                options.push({ text: `ã€çº³ä»–ä¸ºå¦¾ã€‘`, req: { bond: 70 }, effects: { proposal: 'concubine' }, log: `ä½ å·²å¨¶å¦»ï¼Œä½†ä»æ”¾ä¸ä¸‹ä»–ï¼Œå†³å®šå°†ä»–çº³ä¸ºå¦¾å®¤ã€‚` });
            }
            if (gameState.player.attributes.virtue > 60) {
                options.push({ text: `ã€èµ é‡‘ç¥ç¦ï¼Œæ­¤ç”Ÿä¸ºå‹ã€‘`, req: {}, effects: { proposal: 'friend' }, log: `ä½ é€ä¸Šä¸€ä»½åšç¤¼ï¼Œç¥ç¦ä»–è§…å¾—è‰¯äººã€‚ä½ ä»¬å°†æˆä¸ºä¸€ç”Ÿçš„çŸ¥å·±ã€‚` });
            }
            if(gameState.marriage.isMarried && sweetheart.relationship === 'spouse') {
                showEventCard("å‘½è¿å¼„äºº", "fa-cloud-rain", "æŸä¸ªé›¨å¤œï¼Œä½ ä¸ä»–åœ¨è¡—è§’å¶é‡ï¼Œå½¼æ­¤å·²æ˜¯ä»–äººå¤«/å¦‡ã€‚ä½ ä»¬ç›¸è§†ä¸€ç¬‘ï¼Œæ„Ÿå¹å‘½è¿å¼„äººï¼Œä»æ­¤å…³ç³»å›ºå®šä¸ºâ€œçŸ¥å·±â€ï¼Œä¸å†æœ‰çˆ±æƒ…åç»­ã€‚");
                return;
            }
        } else {
            options = eventToTrigger.options;
        }

        let decisionOptions = options.map(opt => {
            let canSelect = true;
            let reqText = "";
            if (opt.req) {
                for (const attr in opt.req) {
                    const requiredValue = opt.req[attr];
                    const playerValue = attr === 'wealth' ? gameState.finances.wealth : (gameState.player.attributes[attr] || 0);
                    if (playerValue < requiredValue) {
                        canSelect = false;
                        reqText += `${attr === 'wealth' ? 'è´¢å¯Œ' : ATTR_MAP[attr]}â‰¥${requiredValue} `;
                    }
                }
            }
            return {
                htmlContent: `<span class="option-text">${opt.text}${reqText ? `<div><small>(è¦æ±‚: ${reqText})</small></div>` : ''}</span>`,
                disabled: !canSelect,
                callback: () => handleSweetheartEventResult(eventToTrigger.id, opt)
            };
        });
        showDecisionCard('é’æ¢…ç«¹é©¬', 'fa-hand-holding-heart', eventToTrigger.description, decisionOptions);
    });
}
// [æ›¿æ¢] æ‰¾åˆ°è¿™ä¸ªå‡½æ•°å¹¶ç”¨ä¸‹é¢çš„ä»£ç å®Œæ•´æ›¿æ¢
// [æ›¿æ¢æ­¤å‡½æ•°]
// ===================== ã€ä¿®å¤ä¸€ï¼šè¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢æ‚¨çš„ handleSweetheartEventResult å‡½æ•°ã€‘ =====================
function handleSweetheartEventResult(eventId, option) {
    const sweetheartId = gameState.flags.childhoodSweetheartId;
    let effects = { ...option.effects }; // å¤åˆ¶æ•ˆæœå¯¹è±¡
    // å¤„ç†éšæœºæ•ˆæœ
    if (effects.random) {
        let roll = Math.random();
        let cumulativeChance = 0;
        for (const outcome of effects.random) {
            cumulativeChance += outcome.chance;
            if (roll < cumulativeChance) {
                effects.bond = (effects.bond || 0) + outcome.bond;
                option.log = outcome.log;
                break;
            }
        }
    }
    if (effects.bond) {
        gameState.flags.bondValue = (gameState.flags.bondValue || 0) + effects.bond;
    }
    if (effects.attributes) {
        applyEffects({ attributes: effects.attributes });
    }
    if (effects.wealth) {
        applyEffects({ wealth: effects.wealth });
    }
    if (effects.flag) {
        gameState.flags[effects.flag] = true;
    }
    if (effects.item) {
        addItemToInventory(effects.item.id, 1, effects.item);
    }
    if (effects.proposal) {
        const sweetheart = gameState.npcs[sweetheartId];
        const proposalType = effects.proposal;
        if (gameState.player.gender === 'female') {
            let successChance = 0.5 + (gameState.flags.bondValue / 250); 
            if (sweetheart.personality.includes('æœæ•¢')) successChance += 0.2;
            if (sweetheart.personality.includes('å†…æ•›')) successChance -= 0.1;
            if (Math.random() < successChance) {
                option.log = `ä½ å¤šå¹´çš„ç­‰å¾…ç»ˆæœ‰ç»“æœï¼Œ${sweetheart.name}å¸¦ç€åšç¤¼å‰æ¥æäº²ï¼Œä½ æ¬£ç„¶åº”å…ã€‚`;
                marrySuitor(sweetheartId);
                return; 
            } else {
                option.log = `${sweetheart.name}è™½å¯¹ä½ æœ‰æ„ï¼Œä½†å› ç§ç§åŸå› æœªèƒ½å‰æ¥æäº²ï¼Œä½ ä»¬ç»ˆæ˜¯æœ‰ç¼˜æ— åˆ†ã€‚`;
                gameState.suitors = gameState.suitors.filter(id => id !== sweetheartId); 
            }
        } 
        else { // ç”·æ€§ç©å®¶é€»è¾‘
            switch(proposalType) {
                case 'wife':
                    let successChance = 0.6 + (gameState.flags.bondValue / 200);
                    if (gameState.flags.proposal_bonus) successChance += 0.1;
                    if (gameState.flags.mother_support) successChance += 0.15;
                    if (gameState.family.reputation > 100) successChance += 0.1;
                    if (Math.random() < successChance) {
                        marrySuitor(sweetheartId); 
                        option.log = `æäº²æˆåŠŸï¼ä½ ä¸${sweetheart.name}çš„çˆ±æƒ…ä¿®æˆæ­£æœã€‚`;
                        return; 
                    } else {
                        option.log = `æäº²å¤±è´¥ï¼Œ${sweetheart.name}è¢«è®¸é…ç»™äº†ä»–äººï¼Œä½ ä»¬æœ‰ç¼˜æ— åˆ†ã€‚`;
                        gameState.suitors = gameState.suitors.filter(id => id !== sweetheartId);
                    }
                    break;
                case 'concubine':
                    if (gameState.flags.bondValue > 70) {
                        option.log = `${sweetheart.name}å§”èº«äºä½ ï¼Œä½†å†…å¿ƒå……æ»¡å§”å±ˆã€‚`;
                        acquireConcubine(sweetheartId);
                        applyEffects({ relationship: { targetId: sweetheartId, favor: -30 } });
                    } else {
                        option.log = `${sweetheart.name}æ‹’ç»äº†ä½ çš„è¯·æ±‚ï¼Œä¸æ„¿ä¸ºå¦¾ã€‚`;
                    }
                    break;
                case 'friend':
                    applyEffects({wealth: -1000}); 
                    option.log = `ä½ é€ä¸Šåšç¤¼ï¼Œä»æ­¤ä½ ä»¬æˆä¸ºä¸€ç”Ÿçš„çŸ¥å·±ã€‚`;
                    if(gameState.social.relationships[sweetheartId]) {
                        gameState.social.relationships[sweetheartId].type = 'red_confidante';
                        gameState.social.relationships[sweetheartId].level = 4;
                    }
                    break;
            }
        }
    }
    
    // â–¼â–¼â–¼ æ ¸å¿ƒä¿®å¤ â–¼â–¼â–¼
    // å°†ç»“æœå¼¹çª—æ¨å…¥äº‹ä»¶é˜Ÿåˆ—çš„æœ€å‰ç«¯ï¼Œç„¶åå…³é—­å½“å‰çª—å£ä»¥è§¦å‘é˜Ÿåˆ—
    eventQueue.unshift(() => {
        showEventCard('é’æ¢…ç«¹é©¬', 'fa-hand-holding-heart', option.log);
    });
    closeAllOverlays();
    // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
}
// [æ–°å¢] æ£€æŸ¥å¹¶è§¦å‘å¾’å¼Ÿè¯•ç‚¼äº‹ä»¶çš„å‡½æ•°
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function checkForApprenticeTrials() {
    const activeApprentices = gameState.apprentices.filter(a => a.state === 'learning');
    if (activeApprentices.length === 0) return;

    const apprentice = getRandomElement(activeApprentices);
    if (Math.random() < 0.15) {
        let potentialTrials = [];
        if (apprentice.attributes.talent < 60 && apprentice.age > 15) {
            potentialTrials.push('talent');
        }
        if (apprentice.attributes.martial < 60 && apprentice.age > 15) {
            potentialTrials.push('martial');
        }
        if (potentialTrials.length > 0) {
            const trialType = getRandomElement(potentialTrials);
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†äº‹ä»¶å­˜å…¥ social ä»“åº“
            addUiEvent('social', () => {
                triggerApprenticeTrial(apprentice.id, trialType);
            });
        }
    }
}
// [æ›¿æ¢]
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
// [æ–°å¢æ­¤å‡½æ•°]
function applyPassiveBonuses() {
    // æ£€æŸ¥å¾¡èµæ–‡æˆ¿å››å®
    if (hasItemInInventory('yu_ci_wen_fang_si_bao')) {
        const talentGain = 5;
        const reputationGain = 10;
        applyEffects({ attributes: { talent: talentGain }, reputation: reputationGain });
        logEvent(`ä½ çš„<strong class="value">ã€å¾¡èµæ–‡æˆ¿å››å®ã€‘</strong>è®©ä½ æ–‡æ€æ³‰æ¶Œï¼Œåå£°è¿œæ‰¬ï¼Œæ‰æƒ…+${talentGain}ï¼Œå£°æœ›+${reputationGain}ã€‚`, true);
    }
    // æ£€æŸ¥åå¸ˆåŒ¾é¢
    if (gameState.inventory.some(item => item.id === 'ming_shi_bian_e')) {
        const reputationGain = 5 * gameState.inventory.filter(item => item.id === 'ming_shi_bian_e').length;
        applyEffects({ reputation: reputationGain });
        logEvent(`ä½ çš„<strong class="value">ã€åå¸ˆåŒ¾é¢ã€‘</strong>ä¸ºä½ å¸¦æ¥äº† ${reputationGain} ç‚¹å£°æœ›ã€‚`, true);
    }
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function advanceTime() {
    checkForApprenticeTrials();
    checkForApprenticeSocialEvents();
    processMaritimeTradeCycle(); 
    delete gameState.flags.ateGoldenFriesThisTurn;
    gameState.player.age += 0.5;
    gameState.date.turn = gameState.date.turn === 1 ? 2 : 1;
    if (gameState.date.turn === 1) {
        gameState.date.year++;
        let annualIncome = gameState.family.annualIncome;
        if (hasItemInInventory('liang_huai_yan_yin')) {
            const saltIncome = 50000;
            annualIncome += saltIncome;
            logEvent(`ä½ æŒæœ‰çš„<strong class="value">ã€ä¸¤æ·®ç›å¼•ã€‘</strong>ä¸ºä½ å¸¦æ¥äº† <span class="value">${saltIncome}</span> ä¸¤çš„å·¨é¢å¹´æ”¶ç›Šã€‚`, true);
        }
        applyEffects({ wealth: annualIncome });
        applyPassiveBonuses();
        logEvent(`å¹´åˆç»“ç®—ï¼Œä½ çš„å®¶æ—å¹´æ”¶å…¥ <span class="value">${annualIncome}</span> ä¸¤å·²å…¥è´¦ã€‚`);
        processAssetAppreciation();
        processInvestmentReturns();
        updateNPCs();
        updateFriendships();
    }

    // ä¿¸ç¦„ä¸é€€ä¼‘é‡‘ç»“ç®—é€»è¾‘
    if (gameState.career.path && gameState.career.level > -1) {
        if (gameState.player.age >= 55) {
            // ã€æ–°å¢ã€‘åªè®°å½•ä¸€æ¬¡çš„é€€ä¼‘äº‹ä»¶
            if (!gameState.flags.retirementLogged) {
                const careerData = careerPaths[gameState.player.gender][gameState.career.path];
                const finalLevelData = careerData.levels[gameState.career.level];
                logEvent(`ä½ å¹´äº‹å·²é«˜ï¼Œä»ã€${careerData.name} - ${finalLevelData.title}ã€‘çš„èŒä½ä¸Šè£ä¼‘ï¼Œä»æ­¤é¢å…»å¤©å¹´ã€‚`, true);
                gameState.flags.retirementLogged = true; // æ ‡è®°å·²è®°å½•è¿‡
            }

            if (gameState.date.turn === 1) {
                const careerData = careerPaths[gameState.player.gender][gameState.career.path];
                const finalLevelData = careerData.levels[gameState.career.level];
                const pension = Math.floor(finalLevelData.salary * 0.5) * 2;
                if (pension > 0) {
                    applyEffects({ wealth: pension });
                    // ã€æ–°å¢ã€‘è®°å½•æ¯å¹´çš„é€€ä¼‘é‡‘
                    logEvent(`ä½ å·²è£ä¼‘ï¼Œæœ¬å¹´åº¦æ”¶åˆ°æœå»·å‘æ”¾çš„é€€ä¼‘é‡‘ <span class="value">${pension}</span> ä¸¤ã€‚`, true);
                }
            }
        } else {
            // æœªé€€ä¼‘ï¼Œæ­£å¸¸ç»“ç®—æ¯å›åˆçš„ä¿¸ç¦„
            const currentLevelData = careerPaths[gameState.player.gender][gameState.career.path].levels[gameState.career.level];
            const turnSalary = currentLevelData.salary;
            if (turnSalary > 0) {
                gameState.career.unclaimedSalary = (gameState.career.unclaimedSalary || 0) + turnSalary;
                logEvent(`æœ¬å›åˆä¿¸ç¦„ <span class="value">${turnSalary}</span> ä¸¤å·²å­˜å…¥é’±æŸœï¼Œå¾…é¢†å–ã€‚`);
            }
        }
    }
    
    // Reset flags
    gameState.flags.actionUsed_study = 0;
    gameState.flags.actionUsed_apprentice = 0;
    gameState.flags.actionUsed_family = false;
    gameState.flags.actionUsed_work = 0;
    gameState.flags.wishingWellThisTurn = false;
    gameState.flags.npcInteractionCounts = {}; 
    delete gameState.flags.confessionAttemptedThisTurn;
    delete gameState.flags.actionUsed_household;
    delete gameState.flags.marketItemsBoughtThisTurn;
    delete gameState.flags.actionUsed_trustActions;
    delete gameState.flags.intimacyActionsUsedThisTurn;
}
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘advanceTime å‡½æ•° END =====================
// ===================== ã€æ–°å¢ã€‘NPCäº’åŠ¨è®¡æ•°å™¨å‡½æ•° START =====================
/**
 * æ£€æŸ¥å¹¶æ¶ˆè€—æŒ‡å®šNPCçš„ä¸€ä¸ªè¡ŒåŠ¨ç‚¹
 * @param {string} npcId - è¦æ£€æŸ¥çš„NPCçš„ID
 * @param {number} limit - è¯¥NPCçš„äº’åŠ¨ä¸Šé™ï¼Œé»˜è®¤ä¸º2
 * @returns {boolean} - æ˜¯å¦å¯ä»¥æ‰§è¡Œè¯¥è¡ŒåŠ¨
 */
function checkAndUseNpcActionPoint(npcId, limit = 2) {
// ç¡®ä¿è®¡æ•°å™¨å¯¹è±¡å­˜åœ¨
if (gameState.flags.debug_unlimitedActions) {
        return true;
    }

    if (!gameState.flags.npcInteractionCounts) {
        gameState.flags.npcInteractionCounts = {};
    }
    
    const currentCount = gameState.flags.npcInteractionCounts[npcId] || 0;
    
    if (currentCount >= limit) {
        const npc = gameState.npcs[npcId];
        showToast(`æœ¬å›åˆä¸ ${npc.name} çš„äº’åŠ¨æ¬¡æ•°å·²ç”¨å°½ã€‚`);
        return false;
    }
    
    // æ¬¡æ•°åŠ ä¸€å¹¶è®°å½•
    gameState.flags.npcInteractionCounts[npcId] = currentCount + 1;
    return true;
}
// ===================== ã€æ–°å¢ã€‘NPCäº’åŠ¨è®¡æ•°å™¨å‡½æ•° END =====================

// =======================================================================
// ========================= MAIN GAME LOOP ==============================
// =======================================================================
let eventQueue = [];
let isProcessingEvent = false;

// [æ›¿æ¢]
// ===================== ã€ç¬¬ä¸€æ­¥ï¼šè¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢æ‚¨çš„ nextTurn å‡½æ•°ã€‘ =====================
// ===================== ã€ç¬¬ä¸‰æ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€æ–°å¢ã€‘äº‹ä»¶å…¥åº“å‡½æ•° =====================
/**
 * å°†ä¸€ä¸ªå¾…å¤„ç†çš„ç•Œé¢äº‹ä»¶æ·»åŠ åˆ°å¯¹åº”çš„ä»“åº“ä¸­
 * @param {string} tabId - äº‹ä»¶å¯¹åº”çš„æ ‡ç­¾é¡µID ('social', 'career', etc.)
 * @param {Function} eventCallback - å½“ç©å®¶ç‚¹å‡»æ ‡ç­¾é¡µæ—¶è¦æ‰§è¡Œçš„å‡½æ•°
 */
function addUiEvent(tabId, eventCallback) {
    if (!gameState.pendingUiEvents) {
        gameState.pendingUiEvents = {};
    }
    if (!gameState.pendingUiEvents[tabId]) {
        gameState.pendingUiEvents[tabId] = [];
    }
    // å°†è¦æ‰§è¡Œçš„å‡½æ•°å­˜å…¥ä»“åº“
    gameState.pendingUiEvents[tabId].push(eventCallback);
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (2/2)ã€‘ =====================
function nextTurn() {
    if (isProcessing) return;

    // ã€ä¿®æ”¹ã€‘å°†å¥åº·è­¦å‘Šå’Œæ­»äº¡åˆ¤å®šç§»è‡³æ–°å‡½æ•°ï¼Œå¹¶åœ¨è¿™é‡Œè°ƒç”¨
    if (updateHealthCapsAndCheckDeath()) {
        return; // å¦‚æœåˆ¤å®šæ­»äº¡ï¼Œåˆ™ä¸­æ–­åç»­æµç¨‹
    }
    checkLowHealthWarning();
    
    // ã€æ–°å¢ã€‘æ­»äº¡é¢„è­¦æç¤º
    if (gameState.flags.impendingDoom && gameState.flags.impendingDoom > 1) {
        eventQueue.push(() => {
            showEventCard('èº«ä½“é¢„è­¦', 'fa-heartbeat', 'ä½ è¿‘æ¥æ—¶å¸¸æ„Ÿåˆ°å¿ƒæ‚¸ä¹åŠ›ï¼Œä¼¼ä¹å¤§é™å°†è‡³ã€‚ä¸å¦¨å¤šä¸å®¶äººç›¸ä¼´ï¼Œå¤„ç†å¥½æœªäº†ä¹‹äº‹ã€‚');
        });
        gameState.flags.impendingDoom--; // å€’è®¡æ—¶å‡ä¸€
    } else if (gameState.flags.impendingDoom === 1) {
        gameState.flags.impendingDoom--; // æœ¬å›åˆç»“æŸåï¼Œä¸‹ä¸€å›åˆå°†æ˜¯é«˜é£é™©å›åˆ
    }

    isProcessing = true;
    eventQueue = [];
    pendingEvents = [];
    if (gameState.pendingUiEvents) {
        Object.keys(gameState.pendingUiEvents).forEach(key => {
            gameState.pendingUiEvents[key] = [];
        });
    }

    let birthHappened = false;
    if (pregnancyCheck('player', gameState.player.isSecretPregnancy)) birthHappened = true;
    if (gameState.player.gender === 'male') {
        if (gameState.marriage.isMarried && gameState.marriage.spouseId) {
            if (pregnancyCheck(gameState.marriage.spouseId, false)) birthHappened = true;
        }
        (gameState.marriage.concubines || []).map(id => gameState.npcs[id]).forEach(conc => {
            if (conc && pregnancyCheck(conc.id, false)) birthHappened = true;
        });
        (gameState.social.secretLovers || []).map(id => gameState.npcs[id]).forEach(lover => {
            if (lover && pregnancyCheck(lover.id, true)) birthHappened = true;
        });
    }

    if (!birthHappened) {
        generateAndQueueHubEvents();
        if (gameState.flags.childhoodSweetheartId) {
            triggerSweetheartEvent();
        }
        checkForFatedLoverEvent();
        if (gameState.player.age >= 16) {
            checkForApprenticeTrials();
            checkForApprenticeSocialEvents();
        }
        triggerInnerCourtEvent();
        if (gameState.marriage.isMarried) {
            triggerSpouseEvent();
            checkForSecretLoverDiscovery();
            updateInfidelityRisk();
            updateHusbandSuspicion();
        }
        if (gameState.player.gender === 'female' && gameState.marriage.isMarried && gameState.marriage.householdAuthority.progress < 100) {
            const authority = gameState.marriage.householdAuthority;
            const favor = gameState.marriage.favor;
            const wisdom = gameState.player.attributes.wisdom;
            if (favor > 60 && wisdom > 70 && Math.random() < 0.15) {
                const authorityTypes = ['personnel', 'finance', 'procurement'];
                const randomAuthority = getRandomElement(authorityTypes);
                if ((authority[randomAuthority] || 0) < 100) {
                    authority[randomAuthority] = (authority[randomAuthority] || 0) + 1;
                    authority.progress = Math.floor(((authority.personnel||0) + (authority.finance||0) + (authority.procurement||0)) / 3);
                    logEvent(`ä½ æŒå®¶æœ‰é“ï¼Œåœ¨æ½œç§»é»˜åŒ–ä¸­å¯¹å¤«å®¶çš„${{personnel:'äººäº‹', finance:'è´¢åŠ¡', procurement:'é‡‡åŠ'}[randomAuthority]}äº‹åŠ¡æœ‰äº†æ›´å¤šäº†è§£ã€‚`);
                }
            }
        }
    }

    if (gameState.buffs) {
        for (const buffId in gameState.buffs) {
            gameState.buffs[buffId].duration--;
            if (gameState.buffs[buffId].duration <= 0) {
                delete gameState.buffs[buffId];
                logEvent(`ä½ çš„ã€${{partner_luck:'å§»ç¼˜', career_luck:'åŠŸå', wealth_luck:'è´¢è¿'}[buffId] || 'ç¥ç¦'}ã€‘æ•ˆæœå·²ç»“æŸã€‚`);
            }
        }
    }

    const nextTurnButton = document.querySelector('.control-btn[onclick="nextTurn()"]');
    if (nextTurnButton) nextTurnButton.classList.add('button-loading');

    advanceTime();

    if (gameState.date.turn === 1) {
        updateMarketStatus();
    } else {
        gameState.tradingSystem.isTradingPeriod = false;
    }

    gameState.player.health = Math.max(0, gameState.player.health - getRandomInt(0, 1));
    if (gameState.player.age > 40) gameState.player.attributes.charm -= getRandomInt(0, 1);

    handleDisease();
    updateApprentices();
    childrenGrowUp();
    checkHusbandTakesConcubine();
    updateHusbandState();
    updateHaremStatus();
    checkForAuthorityTransfer_Male();
    checkForInvestigationCompletion();
    updateFriendships();
    checkRelationshipBreakup();
    checkForNpcGifting();
    checkForNpcInitiatedEvents();
    checkForPromotion();
    checkMilestoneEvent();

    if (gameState.date.turn === 2) {
        calculateAndDeductExpenses();
        updateFinancialTier();
    }

    updateRankings();

    if (checkEndGame()) {
        isProcessing = false;
        if (nextTurnButton) nextTurnButton.classList.remove('button-loading');
        return;
    }

    gameState.flags.autoSaveCounter++;
    if (gameState.flags.autoSaveCounter >= 2) {
        gameState.flags.autoSaveCounter = 0;
        autoSaveGame();
        showToast("æ¸¸æˆå·²è‡ªåŠ¨å­˜æ¡£ã€‚");
    }

    if (pendingEvents.length > 0 && !birthHappened) {
        // No auto-popup, handled by red dot
    }

    processEventQueue(nextTurnButton);
}
function generateAndQueueHubEvents() {
    let potentialEvents = [];
    const gs = gameState;

    // 1. åªä» HUB_EVENTS ä¸­ç­›é€‰ç¬¦åˆæ¡ä»¶çš„äº‹ä»¶
    for (const eventKey in HUB_EVENTS) {
        const eventTemplate = HUB_EVENTS[eventKey];
        if (eventTemplate.condition(gs)) {
            potentialEvents.push(eventTemplate);
        }
    }
    
    // 2. ä¸ºäº†ä¿è¯å¤šæ ·æ€§ï¼ŒæŒ‰ç±»å‹åˆ†ç»„
    const groupedEvents = potentialEvents.reduce((acc, event) => {
        acc[event.type] = acc[event.type] || [];
        acc[event.type].push(event);
        return acc;
    }, {});

    let selectedEvents = [];
    // 3. æ¯ç§ç±»å‹æœ€å¤šé€‰ä¸€ä¸ª
    for(const type in groupedEvents) {
        selectedEvents.push(getRandomElement(groupedEvents[type]));
    }
    
    // 4. æ‰“ä¹±å¹¶é™åˆ¶æ•°é‡ï¼Œç„¶åç”Ÿæˆæœ€ç»ˆäº‹ä»¶
    selectedEvents.sort(() => 0.5 - Math.random());
    const eventCount = Math.min(selectedEvents.length, 2); // æ¯å›åˆæœ€å¤šç”Ÿæˆ2ä¸ªä¿¡æ¯ä¸­å¿ƒäº‹ä»¶
    
    selectedEvents.slice(0, eventCount).forEach(eventTemplate => {
        // 5. ç¡®ä¿åªå¯¹æœ‰ .generate æ–¹æ³•çš„å¯¹è±¡è°ƒç”¨å®ƒ
        if (eventTemplate && typeof eventTemplate.generate === 'function') {
            const finalEvent = eventTemplate.generate(gs);
            addPendingEvent(finalEvent); // æ·»åŠ åˆ°ä¿¡æ¯ä¸­å¿ƒå¾…åŠåˆ—è¡¨
        } else {
            console.warn("ä¸€ä¸ªHUBäº‹ä»¶æ¨¡æ¿ç¼ºå°‘ generate å‡½æ•°:", eventTemplate);
        }
    });
}
// â–²â–²â–² æ›¿æ¢ç»“æŸ â–²â–²â–²
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function processEventQueue(nextTurnButton) {
    // å¦‚æœäº‹ä»¶é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ–è€…ä¸Šä¸€ä¸ªäº‹ä»¶çš„å¼¹çª—è¿˜åœ¨æ˜¾ç¤ºä¸­ï¼Œåˆ™ç›´æ¥è¿”å›
    if (eventQueue.length === 0 || isProcessingEvent) {
        // å½“é˜Ÿåˆ—ä¸ºç©ºï¼Œä¸”æ²¡æœ‰äº‹ä»¶æ­£åœ¨å¤„ç†æ—¶ï¼Œè¯´æ˜æ‰€æœ‰äº‹ä»¶éƒ½å·²ç»“æŸ
        if (eventQueue.length === 0 && !isProcessingEvent) { 
            // å¦‚æœä¸æ˜¯åœ¨æ‰¹é‡è·³è¿‡å›åˆçš„æ¨¡å¼ä¸‹ï¼Œå°±æ¢å¤æŒ‰é’®å’Œç•Œé¢
            if (!gameState.flags.isBatchProcessing) {
                if (nextTurnButton) nextTurnButton.classList.remove('button-loading');
                renderGame();
            }
            isProcessing = false; // è§£é”â€œä¸‹ä¸€å›åˆâ€æŒ‰é’®
        }
        return;
    }

    // æ ‡è®°ï¼šå¼€å§‹å¤„ç†ä¸€ä¸ªæ–°çš„å¼¹çª—äº‹ä»¶
    isProcessingEvent = true;
    
    // ä»é˜Ÿåˆ—ä¸­å–å‡ºç¬¬ä¸€ä¸ªäº‹ä»¶
    const eventCallback = eventQueue.shift();

    // å¦‚æœæ˜¯æ‰¹é‡è·³è¿‡å›åˆæ¨¡å¼ï¼Œç›´æ¥æ‰§è¡Œé€»è¾‘ï¼Œä¸æ˜¾ç¤ºUI
    if (gameState.flags.isBatchProcessing) {
        if (eventCallback) eventCallback();
        isProcessingEvent = false; // æ‰¹é‡æ¨¡å¼ä¸‹ï¼Œç«‹åˆ»æ ‡è®°ä¸ºå¤„ç†å®Œæ¯•
        processEventQueue(nextTurnButton); // ç«‹åˆ»å¤„ç†ä¸‹ä¸€ä¸ª
    } else {
        // æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºUI
        // ç¨ä½œå»¶è¿Ÿï¼Œç­‰å¾…ä¸Šä¸€ä¸ªå¼¹çª—å…³é—­åŠ¨ç”»å®Œæˆï¼Œé˜²æ­¢é—ªçƒ
        setTimeout(() => { 
            if (eventCallback) eventCallback();
            // æ³¨æ„ï¼šè¿™é‡Œä¸å†è‡ªåŠ¨è°ƒç”¨ä¸‹ä¸€ä¸ªäº‹ä»¶ï¼Œè€Œæ˜¯ç­‰å¾…å¼¹çª—è¢«ç©å®¶å…³é—­
        }, 50); 
    }
}
function updateNPCs() {
    if (!gameState.npcs) return;
    Object.keys(gameState.npcs).forEach(npcId => {
        const npc = gameState.npcs[npcId];
        if (!npc || npc.id === 'player' || npc.isDead) return;
        npc.age += 1;
        
        // ã€ä¿®æ”¹ã€‘ç§»é™¤åŸæœ‰çš„æ­»äº¡åˆ¤å®šï¼Œæ­¤é€»è¾‘å·²ç§»è‡³æ–°çš„ updateHealthCapsAndCheckDeath å‡½æ•°
        // let deathChance = 0;
        // if (npc.age > 90) deathChance = 0.5;
        // else if (npc.age > 80) deathChance = 0.2;
        // else if (npc.age > 70) deathChance = 0.05;
        // if (Math.random() < deathChance) { ... }
        // ä»¥ä¸Šä»£ç å·²è¢«ç§»é™¤
    });
}

function handleBirthEvent(motherId, isSecret) {
    const motherNPC = motherId === 'player' ? gameState.player : gameState.npcs[motherId];
    const motherAge = motherNPC.age;
    let miscarriageChance = 0;
    if (motherAge >= 40 && motherAge < 50) miscarriageChance = 0.08;
    else if (motherAge >= 50 && motherAge < 60) miscarriageChance = 0.18;
    else if (motherAge >= 60) miscarriageChance = 0.28;

    if (Math.random() < miscarriageChance) {
        const motherName = motherNPC.name;
        const isPlayerMother = (motherId === 'player');
        const decisionText = `ä½ çš„${isPlayerMother && gameState.player.gender === 'female' ? '' : (gameState.npcs[motherId]?.role || 'å¦¾å®¤')} <strong class="highlight-npc">${motherName}</strong> éš¾äº§äº†ï¼Œæƒ…å†µå±æ€¥ï¼ä½ å†³å®š...`;
        const options = [
            { htmlContent: '<i class="fas fa-baby"></i> ä¿å­©å­', callback: () => handleChildbirthDecision(true, motherId, isSecret) },
            { htmlContent: '<i class="fas fa-heart"></i> ä¿å¤§äºº', callback: () => handleChildbirthDecision(false, motherId, isSecret) }
        ];
        showDecisionCard('ç”Ÿæ­»æŠ‰æ‹©', 'fa-heartbeat', decisionText, options);
    } else {
        handleChildbirthSuccess(motherId, isSecret);
    }
}
function handleChildbirthSuccess(motherId, isSecret) {
    const motherNPC = motherId === 'player' ? gameState.player : gameState.npcs[motherId];
    let fatherNPC, biologicalFatherId;

    if (motherId === 'player') { // å¦‚æœæ¯äº²æ˜¯ç©å®¶
        fatherNPC = gameState.marriage.isMarried ? gameState.npcs[gameState.marriage.spouseId] : null; // åˆæ³•çˆ¶äº²æ˜¯ä¸ˆå¤«
        biologicalFatherId = motherNPC.biologicalFatherOfUnborn || (fatherNPC ? fatherNPC.id : null); // ç”Ÿç‰©å­¦çˆ¶äº²æ˜¯æƒ…äººæˆ–ä¸ˆå¤«
        delete motherNPC.biologicalFatherOfUnborn; // æ¸…ç†æ ‡è®°
    } else { // å¦‚æœæ¯äº²æ˜¯NPCï¼ˆç©å®¶ä¸ºç”·æ€§ï¼‰
        fatherNPC = gameState.player;
        biologicalFatherId = fatherNPC.id; // ç”Ÿç‰©å­¦çˆ¶äº²å°±æ˜¯ç©å®¶
    }

    const gender = Math.random() > 0.5 ? 'male' : 'female';
    const newChild = {
        id: `child_${Date.now()}`, gender: gender, age: 0, isDead: false,
        motherId: motherId, 
        fatherId: fatherNPC ? fatherNPC.id : null, // åˆæ³•çˆ¶äº²
        biologicalFatherId: biologicalFatherId, // [æ–°å¢] ç”Ÿç‰©å­¦çˆ¶äº²
        isSecret: isSecret,
        attributes: {}, personality: [], cultivationLog: [],
        marriage: { isMarried: false, spouseId: null },
        education: null, allowance: 0, career: null,
        avatar: getRandomElement(avatarPools[gender])
    };

    const p1_attrs = motherNPC.id === 'player' ? gameState.player.attributes : (motherNPC.attributes || {});
    // å¦‚æœæ˜¯ç§ç”Ÿå­ä¸”æ²¡æœ‰åˆæ³•çˆ¶äº²ï¼Œåˆ™ä½¿ç”¨ç”Ÿç‰©å­¦çˆ¶äº²çš„å±æ€§
    const p2_source = fatherNPC || gameState.npcs[biologicalFatherId];
    const p2_attrs = p2_source ? (p2_source.id === 'player' ? gameState.player.attributes : (p2_source.attributes || {})) : { talent: 20, wisdom: 20, charm: 20 };

    newChild.attributes = {
        talent: Math.floor(((p1_attrs.talent || 20) + (p2_attrs.talent || 20)) / 10) + getRandomInt(1, 5),
        wisdom: Math.floor(((p1_attrs.wisdom || 20) + (p2_attrs.wisdom || 20)) / 10) + getRandomInt(1, 5),
        charm: Math.floor(((p1_attrs.charm || 20) + (p2_attrs.charm || 20)) / 10) + getRandomInt(1, 5),
        health: 100, etiquette: 0, virtue: 0, martial: 0
    };

    gameState.children.push(newChild);

    if (motherNPC.relationship === 'concubine' && isSecret) {
        showNameChildOverlay(newChild.id, motherNPC.name, true);
    } else {
        showNameChildOverlay(newChild.id, motherNPC.name, false);
    }
}
function handleChildbirthDecision(saveChild, motherId, isSecret) {
    const motherNPC = motherId === 'player' ? gameState.player : gameState.npcs[motherId];
    const motherName = motherNPC.name;

    if (saveChild) {
        motherNPC.isDead = true;
        showEventCard('ä¿ä½å­©å­', 'fa-baby-carriage', `ä½ å†³å®šä¿ä½å­©å­ã€‚å­©å­å¹³å®‰é™ç”Ÿï¼Œä½†æ¯äº²${motherName}å´é¦™æ¶ˆç‰æ®’...ä½ æ‚²ç—›ä¸‡åˆ†ã€‚`);
        handleChildbirthSuccess(motherId, isSecret); // å­©å­å­˜æ´»ï¼Œç»§ç»­åç»­æµç¨‹
        // ä»é…å¶æˆ–å¦¾å®¤åˆ—è¡¨ä¸­ç§»é™¤
        if(motherId !== 'player') {
            if(gameState.marriage.spouseId === motherId) {
                gameState.marriage.isMarried = false;
                gameState.marriage.spouseId = null;
            }
            gameState.marriage.concubines = gameState.marriage.concubines.filter(id => id !== motherId);
        }
    } else {
        // ä¿å¤§äºº
        showEventCard('ä¿ä½å¤§äºº', 'fa-heart', `ä½ å†³å®šä¿ä½å¤§äººã€‚åœ¨åŒ»å®˜çš„åŠªåŠ›ä¸‹ï¼Œæ¯äº²${motherName}è„±ç¦»äº†å±é™©ï¼Œä½†å­©å­æœªèƒ½ä¿ä½ã€‚`);
        motherNPC.health = Math.max(0, motherNPC.health - 20); // æ¯äº²å¥åº·ä¸‹é™
    }
    closeAllOverlays();
    renderGame();
}
// ã€æ–°å¢ã€‘å…³ç³»ç ´è£‚æ£€æŸ¥å‡½æ•°
function checkRelationshipBreakup() {
    if (!gameState.social.relationships) return;
    
    for (const npcId in gameState.social.relationships) {
        const rel = gameState.social.relationships[npcId];
        const npc = gameState.npcs[npcId];
        if (!npc || npc.isDead) continue;
        
        let shouldBreak = false;
        let breakReason = "";
        
        // æ¡ä»¶1: å¥½æ„Ÿåº¦ä½äº-50
        if (npc.favor <= -50) {
            shouldBreak = true;
            breakReason = "ä½ ä»¬ä¹‹é—´å·²æ— æƒ…åˆ†å¯è¨€ã€‚";
        }
        
        // æ¡ä»¶2: é•¿æœŸä¸äº’åŠ¨ï¼Œæƒ…æ„Ÿå€¼é™ä¸º0
        const currentTurn = gameState.date.year * 2 + gameState.date.turn;
        if (currentTurn - (npc.lastInteractedTurn || 0) > 6) { // è¶…è¿‡3å¹´æœªäº’åŠ¨
            rel.emotionValue = Math.max(0, (rel.emotionValue || 0) - 10); // æ¯å¹´æƒ…æ„Ÿå€¼ä¸‹é™
            if (rel.emotionValue <= 0 && rel.level <= 1) { // å…³ç³»ä¸æ·±æ—¶æ‰ä¼šå› ä¸è”ç³»è€Œç ´è£‚
                shouldBreak = true;
                breakReason = "ç”±äºé•¿æœŸä¸è”ç³»ï¼Œä½ ä»¬çš„æƒ…è°Šå·²æ¸æ¸æ¶ˆæ•£ã€‚";
            }
        }
        
        if (shouldBreak) {
            const oldRelName = RELATIONSHIP_DATA[rel.type]?.name || "æ—§å‹";
            showEventCard('å…³ç³»ç ´è£‚', 'fa-user-slash', `ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong>ï¼ˆ${oldRelName}ï¼‰çš„å…³ç³»èµ°åˆ°äº†å°½å¤´ã€‚${breakReason}`);
            
            // ä»å…³ç³»å¯¹è±¡ä¸­åˆ é™¤
            delete gameState.social.relationships[npcId];
            
            // ä»å…·ä½“çš„åˆ†ç±»åˆ—è¡¨ä¸­ä¹Ÿç§»é™¤
            gameState.social.friends = (gameState.social.friends || []).filter(id => id !== npcId);
            gameState.social.secretLovers = (gameState.social.secretLovers || []).filter(id => id !== npcId);
            // ...å¯ä»¥ä¸ºå…¶ä»–å…³ç³»ç±»å‹æ·»åŠ ç±»ä¼¼çš„æ¸…ç†é€»è¾‘...
        }
    }
}
function checkForNpcInitiatedEvents() {
    Object.values(gameState.npcs).forEach(npc => {
        if (npc && !npc.isDead && npc.id !== 'player' && Math.random() < 0.05) { // æ¯å›åˆ5%å‡ ç‡è§¦å‘
            const rel = gameState.social.relationships[npc.id];
            if (rel && (rel.level || 0) >= 3) { // åªæœ‰äº²å¯†å…³ç³»ä»¥ä¸Šæ‰ä¼šä¸»åŠ¨æ‰¾ä½ 
                eventQueue.push(() => {
                     showEventCard('å‹äººæ¥è®¿', 'fa-envelope-open-text', `<strong class="highlight-npc">${npc.name}</strong>å‰æ¥æ‹œè®¿ï¼Œä¸ä½ é—²èŠå®¶å¸¸ï¼Œä½ ä»¬çš„å…³ç³»æ›´åŠ äº²å¯†äº†ã€‚`);
                     applyEffects({relationship: {targetId: npc.id, favor: 5, trust: 2}});
                });
            }
        }
    });
}
function updateFriendships() {
    if (!gameState.social || !gameState.social.relationships) return;

    // ä»æ–°çš„ relationships å¯¹è±¡ä¸­è·å–æ‰€æœ‰éœ€è¦ç»´æŠ¤å…³ç³»çš„äººçš„ID
    const allRelationshipIds = Object.keys(gameState.social.relationships);

    allRelationshipIds.forEach(id => {
        const npc = gameState.npcs[id];
        if (npc && !npc.isDead) {
            const currentTurnCount = (gameState.date.year * 2) + gameState.date.turn;
            const lastInteraction = npc.lastInteractedTurn || 0;
            const rel = gameState.social.relationships[id];

            // é•¿æœŸä¸äº’åŠ¨ï¼Œæƒ…æ„Ÿå€¼ä¼šä¸‹é™
            if (currentTurnCount - lastInteraction > 4) { // è¶…è¿‡2å¹´
                if (rel) {
                    rel.emotionValue = Math.max(0, (rel.emotionValue || 0) - 5);
                    // æƒ…æ„Ÿå€¼å½’é›¶åï¼Œå…³ç³»ç­‰çº§ä¹Ÿå¯èƒ½ä¸‹é™
                    updateRelationshipLevel(id); 
                }
            }
        }
    });
}
// =======================================================================
// ====================== UI RENDERING FUNCTIONS =========================
// =======================================================================
// ===================== ã€è¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢ã€‘ =====================

function renderStatusBar() {
    const tier = financialTiers.find(t => t.level === gameState.finances.financialTier) || { name: 'æœªçŸ¥' };
    const dateText = `${gameState.date.year}å¹´${gameState.date.turn === 1 ? 'ä¸ŠåŠå¹´' : 'ä¸‹åŠå¹´'}`;
    let statusHTML = `
        <div class="status-item"><i class="fas fa-calendar-alt"></i> ${dateText}</div>
        <div class="status-item"><i class="fas fa-coins"></i> ç§äº§: ${formatNumber(gameState.finances.wealth)}</div>
        <div class="status-item"><i class="fas fa-wallet"></i> è´¢åŠ›: ${tier.name}</div>
        <div class="status-item"><i class="fas fa-star"></i> å£°æœ›: ${gameState.family.reputation}</div>`;
    if (gameState.status.disease) {
        const diseaseName = diseases[gameState.status.disease.id]?.name || 'æœªçŸ¥ç–¾ç—…';
        statusHTML += `<div class="status-item disease"><i class="fas fa-lungs-virus"></i> çŠ¶æ€: ${diseaseName}</div>`;
    }
    return `<div class="status-bar">${statusHTML}</div>`;
}

function renderGame() {
    if (!gameState.flags || !gameState.flags.gameStarted) return;
    const container = document.getElementById('game-container');
    if (!container) return;
    const currentTheme = document.body.dataset.theme || 'spring';
    container.innerHTML = `
        <div class="theme-switcher">
            <div id="theme-spring" class="theme-icon" onclick="setTheme('spring')">æ˜¥</div>
            <div id="theme-summer" class="theme-icon" onclick="setTheme('summer')">å¤</div>
            <div id="theme-autumn" class="theme-icon" onclick="setTheme('autumn')">ç§‹</div>
            <div id="theme-winter" class="theme-icon" onclick="setTheme('winter')">å†¬</div>
            <div id="theme-night" class="theme-icon" onclick="setTheme('night')"><i class="fas fa-moon"></i></div>
        </div>
        <div class="game-block character-card">
            ${renderCharacterInfo()}
            ${renderAttributes()}
        </div>
        <div class="game-block status-card">
            ${renderStatusBar()}
        </div>
        <div class="game-block main-content-card">
            <div class="tab-container" id="tabContainer"></div>
            <div id="tabContentContainer"></div>
        </div>
        <div class="game-block controls-card">
            <div class="controls">
                <button class="control-btn" onclick="nextTurn()"><i class="fas fa-hourglass-half"></i> ä¸‹ä¸€å›åˆ</button>
                <button class="control-btn" onclick="showRestartOptions()"><i class="fas fa-feather-alt"></i> ä¸‹ä¸€äººç”Ÿ</button>
                <button class="control-btn" onclick="showSaveLoadOverlay(true)"><i class="fas fa-save"></i> å­˜æ¡£</button>
                <button class="control-btn" onclick="showSaveLoadOverlay(false)"><i class="fas fa-folder-open"></i> è¯»æ¡£</button>
            </div>
        </div>`;
    
    setTheme(currentTheme); 
    
    renderTabs();
    updateActiveTab(gameState.flags.activeTab || 'main');
}
/**
 * [æ›¿æ¢æ­¤å‡½æ•°]
 * ä¿®å¤äº†â€œä¸‹ä¸€äººç”Ÿâ€æŒ‰é’®ä¸ç»è¿‡â€œæ‰¿ä¸–ä¹¦â€çš„é—®é¢˜ã€‚
 * ç°åœ¨å®ƒä¼šç»Ÿä¸€è°ƒç”¨æ¸¸æˆç»“æŸæµç¨‹ï¼Œä»è€Œå¯åŠ¨â€œå¤©å‘½è½®å›å½•â€ç³»ç»Ÿã€‚
 */
function showRestartOptions() {
    const options = [
        {
            htmlContent: `<i class="fas fa-redo"></i> ç»“æŸæ­¤ç”Ÿï¼Œè¿›å…¥è½®å›`,
            callback: () => {
                // ç›´æ¥è°ƒç”¨æ¸¸æˆç»“æŸçš„æ€»å‡½æ•°ï¼Œå®ƒä¼šè‡ªåŠ¨å¯åŠ¨å°˜ç¼˜é•œå’Œæ‰¿ä¸–ä¹¦
                showEndGame({ title: "è‡ªä¸»é€‰æ‹©", text: "ä½ é€‰æ‹©ä¸»åŠ¨ç»“æŸè¿™ä¸€ä¸–ï¼Œå¼€å¯æ–°çš„è½®å›ã€‚" });
            }
        },
        {
            htmlContent: `<i class="fas fa-times"></i> æˆ‘å†æƒ³æƒ³`,
            style: `background:var(--control-bg);`,
            callback: () => closeAllOverlays()
        }
    ];
    showDecisionCard(
        'äººç”ŸæŠ‰æ‹©',
        'ğŸ”„',
        '<p>ä½ ç¡®å®šè¦ç»“æŸå½“å‰çš„äººç”Ÿï¼Œè¿›å…¥â€œå¤©å‘½è½®å›å½•â€è¿›è¡Œè¯„åˆ¤ä¸ç»§æ‰¿å—ï¼Ÿ</p>',
        options
    );
}
function renderCharacterInfo() {
    const p = gameState.player;
    let avatarContent = `
        <img class="avatar-image" src="${p.avatar || ''}" style="${p.avatar ? 'display:block;' : 'display:none;'}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        <svg class="avatar-svg" viewBox="0 0 100 100" style="${p.avatar ? 'display:none;' : 'display:block;'}">
            <defs>
                <linearGradient id="avatarGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="var(--avatar-bg)" />
                    <stop offset="100%" stop-color="var(--highlight-strong)" />
                </linearGradient>
            </defs>
            <circle cx="50" cy="50" r="48" fill="url(#avatarGradient)" />
            <text x="50" y="65" font-family="'Ma Shan Zheng', cursive" font-size="50" fill="white" text-anchor="middle">${p.name.slice(0, 1)}</text>
        </svg>`;

    return `
    <div class="character-info">
        <div class="avatar-wrapper" onclick="handleAvatarClick()">
            ${avatarContent}
        </div>
        <div class="info-details">
            <div class="info-row">
                <span class="info-label"><i class="fas fa-user"></i> å§“å:</span>
                <span class="value">${p.name}</span>
            </div>
            <div class="info-row">
                <span class="info-label"><i class="fas fa-birthday-cake"></i> å¹´é¾„:</span>
                <span class="value">${Math.floor(p.age)} å²</span>
            </div>
            <div class="info-row">
                <span class="info-label"><i class="fas fa-heartbeat"></i> å¥åº·:</span>
                <span class="value">${p.health} / 100</span>
            </div>
            <div class="info-row">
                <span class="info-label"><i class="fas fa-home"></i> å‡ºèº«:</span>
                <span class="value">${gameState.family.title}</span>
            </div>
        </div>
    </div>`;
}
function renderAttributes() {
    const attrs = gameState.player.attributes;
    return `
    <div class="attributes-grid">
        ${renderAttributeBar('æ‰æƒ…', attrs.talent, 'talent-fill', 'fa-pencil-alt')}
        ${renderAttributeBar('ç¤¼ä»ª', attrs.etiquette, 'etiquette-fill', 'fa-hands-helping')}
        ${renderAttributeBar('æ™ºæ…§', attrs.wisdom, 'wisdom-fill', 'fa-lightbulb')}
        ${renderAttributeBar('å“å¾·', attrs.virtue, 'virtue-fill', 'fa-leaf')}
        ${renderAttributeBar('é­…åŠ›', attrs.charm, 'charm-fill', 'fa-grin-stars')}
        ${renderAttributeBar('æ­¦å­¦', attrs.martial, 'martial-fill', 'fa-khanda')}
${gameState.player.gender === 'male' ?
            renderAttributeBar('æƒè°‹', attrs.strategy, 'wisdom-fill', 'fa-chess') +
            renderAttributeBar('å®¶å¨', attrs.prestige, 'etiquette-fill', 'fa-crown') :
            renderAttributeBar('å¿ƒè®¡', attrs.scheming, 'wisdom-fill', 'fa-brain')
        }
    </div>
    `;
}
function showNameChildOverlay(childId, motherName, isSecret) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;
    
    // è·å–çˆ¶æ¯å§“åï¼Œç”¨äºæ˜¾ç¤º
    let fatherName = 'ä½ ';
    if (gameState.player.gender === 'female') {
        // å¦‚æœç©å®¶æ˜¯å¥³æ€§ï¼Œåˆæ³•çˆ¶äº²æ˜¯ä¸ˆå¤«ï¼Œç”Ÿç‰©å­¦çˆ¶äº²å¯èƒ½æ˜¯æƒ…äºº
        const legalFather = gameState.marriage.isMarried ? gameState.npcs[gameState.marriage.spouseId] : null;
        fatherName = legalFather ? legalFather.name : 'æœªçŸ¥';
    }
    const genderText = child.gender === 'male' ? 'éºŸå„¿' : 'åƒé‡‘';
    const parentNameText = isSecret ? `ä½ ` : `${motherName}å’Œ${fatherName}`;
    
    // æ›´æ–°å¼¹çª—å†…å®¹
    document.getElementById('birthResultContent').innerHTML = `
        <p>æ­å–œï¼Œ${parentNameText}å–œå¾—ä¸€${genderText}ï¼</p>
        <p>è¿™æ˜¯ä½ çš„ç¬¬ <strong class="value">${gameState.children.filter(c => !c.isSecret && !c.isDead).length}</strong> ä¸ªå­å—£ã€‚</p>`;
    
    const namingSection = document.getElementById('childNamingSection');
    const secretDecision = document.getElementById('secretChildDecision');
    const closeBtn = document.getElementById('closeBirthOverlayBtn');
    
    // éšè—å…³é—­æŒ‰é’®ï¼Œå®ç°å¼ºåˆ¶é€‰æ‹©
    closeBtn.style.display = 'none';
    
    if (isSecret) {
        // ç§ç”Ÿå­çš„å¤„ç†æµç¨‹
        namingSection.style.display = 'none';
        secretDecision.style.display = 'block';
        secretDecision.innerHTML = `
            <p class="comment">æ­¤å­èº«ä»½ç‰¹æ®Šï¼Œä½ å†³å®šå¦‚ä½•å¤„ç½®ï¼Ÿ</p>
            <button class="option" onclick="handleSecretChildDecision('${childId}', 'keep')"><i class="fas fa-hand-holding-heart"></i> è®¤é¢†å¹¶å…»è‚²</button>
            <button class="option" onclick="handleSecretChildDecision('${childId}', 'abandon')"><i class="fas fa-user-times"></i> é—å¼ƒ</button>
        `;
    } else {
        // æ­£å¸¸çš„å­©å­å‡ºç”Ÿï¼Œæ˜¾ç¤ºæ–°çš„å‘½åUIï¼Œä¸å†æ˜¯äºŒé€‰ä¸€
        secretDecision.style.display = 'none';
        namingSection.style.display = 'block';
        namingSection.innerHTML = `
            <p><strong>è¯·ä¸ºæ–°ç”Ÿå„¿å®šåï¼š</strong></p>
            <div class.input-group">
                 <input type="text" id="newChildNameInput" placeholder="è¯·è¾“å…¥1-3ä¸ªå­—çš„å..." maxlength="3" style="width: calc(100% - 20px); padding: 12px; margin: 15px auto; display: block; border-radius: 10px; border: 1px solid var(--border-color-light); font-size: 1.1rem; color: var(--text-color); text-align: center;">
            </div>
            <div class="options" style="flex-direction:row; justify-content:center; gap: 15px;">
                <button class="option" onclick="confirmPlayerNaming('${childId}')">
                    <i class="fas fa-check"></i> ç¡®è®¤æ­¤å
                </button>
                <button class="option" onclick="autoNameBySpouse('${childId}')">
                    <i class="fas fa-user-graduate"></i> äº¤ç”±é…å¶
                </button>
            </div>
        `;
    }
    showOverlay('nameChildOverlay');
}// [æ–°å¢]
function promptPlayerForChildName(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    // ä½¿ç”¨ prompt å¼¹çª—å¼ºåˆ¶ç©å®¶è¾“å…¥
    const newGivenName = prompt(`è¯·ä¸ºä½ çš„${child.gender === 'male' ? 'å„¿å­' : 'å¥³å„¿'}è¾“å…¥ä¸€ä¸ªåå­—ï¼ˆ1-3ä¸ªå­—ï¼Œä¸å«å§“æ°ï¼‰ï¼š`);

    if (newGivenName === null) {
        // å¦‚æœç©å®¶ç‚¹å‡»äº†â€œå–æ¶ˆâ€ï¼Œåˆ™è§†ä¸ºäº¤ç”±é…å¶å‘½å
        autoNameBySpouse(childId);
        return;
    }

    let trimmedName = newGivenName.trim();
    if (trimmedName.length === 0 || trimmedName.length > 3) {
        showToast("åå­—é•¿åº¦ä¸åˆè§„ï¼Œå·²äº¤ç”±é…å¶å‘½åã€‚");
        autoNameBySpouse(childId);
        return;
    }

    // åå­—åˆè§„ï¼Œè°ƒç”¨åŸæœ‰çš„ç¡®è®¤å‘½åé€»è¾‘
    // ä¸ºäº†å¤ç”¨ï¼Œæˆ‘ä»¬æŠŠåŸ confirmChildName çš„æ ¸å¿ƒé€»è¾‘æå–å‡ºæ¥
    finalizeChildName(childId, trimmedName, 'ä½ ');
}
// [æ–°å¢]
function autoNameBySpouse(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    let namerName = 'ä½ ';
    if (gameState.player.gender === 'female') {
        const husband = gameState.marriage.isMarried ? gameState.npcs[gameState.marriage.spouseId] : null;
        namerName = husband ? husband.name : "ä½ ";
    }

    const namePool = child.gender === 'female' ? nameData.girlNames : nameData.boyNames;
    const newGivenName = getRandomElement(namePool);
    
    finalizeChildName(childId, newGivenName, namerName);
}// [æ–°å¢]
// ===================== ã€2. æ›¿æ¢æ­¤å‡½æ•°ã€‘ =====================
function finalizeChildName(childId, givenName, namer) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;
    let surname = '';
    const legalFather = child.fatherId ? (gameState.npcs[child.fatherId] || (child.fatherId === 'player' ? gameState.player : null)) : null;
    const biologicalFather = child.biologicalFatherId ? gameState.npcs[child.biologicalFatherId] : null;
    if (legalFather && legalFather.name) {
        surname = legalFather.name.slice(0, 1);
    } 
    else if (biologicalFather && biologicalFather.name) {
        surname = biologicalFather.name.slice(0, 1);
    } 
    else {
        surname = gameState.player.name.slice(0, 1);
    }
    let finalName = surname + givenName;
    let i = 2;
    const originalGivenName = givenName;
    while (gameState.flags.allNames.has(finalName)) {
        givenName = originalGivenName + (i === 2 ? 'äºŒ' : 'ä¸‰');
        finalName = surname + givenName;
        i++;
    }
    child.name = finalName;
    gameState.flags.allNames.add(finalName);
    
    const message = namer === 'ä½ '
        ? `ä½ ä¸ºæ–°ç”Ÿå„¿å–åä¸º <strong class="value">${child.name}</strong>ã€‚`
        : `${namer}æ€ç´¢ç‰‡åˆ»ï¼Œä¸ºå­©å­å–åä¸º <strong class="value">${child.name}</strong>ã€‚`;
        
    showEventCard('å¤©èµä½³å', 'fa-pen-fancy', message);
    
    // â–¼â–¼â–¼ ã€æ–°å¢ã€‘è®°äº‹åŠŸèƒ½ â–¼â–¼â–¼
    const genderText = child.gender === 'male' ? 'éºŸå„¿' : 'åƒé‡‘';
    logEvent(`å–œå¾—${genderText}ï¼Œå–åä¸º <strong class="highlight-npc">${child.name}</strong>ã€‚`, true);
    // â–²â–²â–² ã€æ–°å¢ç»“æŸã€‘ â–²â–²â–²
    
    closeAllOverlays();
    renderGame();
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderAttributeBar(name, value, className, icon, maxVal = 200) {
    // ã€ä¿®æ”¹ã€‘å¦‚æœæ˜¯å¥åº·æ¡ï¼Œåˆ™ä½¿ç”¨åŠ¨æ€ä¸Šé™
    if (name === 'å¥åº·') {
        maxVal = gameState.player.attributes.healthMax || 100;
    }
    const numericValue = Number(value) || 0;
    return `
    <div class="attribute">
        <div class="attribute-name">
            <span><i class="fas ${icon}"></i> ${name}</span>
            <span>${Math.floor(numericValue)}</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill ${className}" style="width: ${Math.min(100, (numericValue / maxVal) * 100)}%;"></div>
        </div>
    </div>`;
}
function updateActiveTab(tabId) {
    gameState.flags.activeTab = tabId;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.tab[data-tab="${tabId}"]`)?.classList.add('active');

    const contentContainer = document.getElementById('tabContentContainer');
    let content = '';

    switch (tabId) {
        case 'main': content = renderMainTab(); break;
        case 'social': content = renderSocialTab(); break;
        case 'career': content = renderCareerTab(); break;
        case 'marriage': content = renderMarriageTab(); break;
        case 'children': content = renderChildrenTab(); break;
        case 'merchant': content = renderMerchantTab(); break;
        case 'log': content = renderLogTab(); break;
        case 'eventHub': // ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæ‰“å¼€ä¿¡æ¯ä¸­å¿ƒ
            openEventHub(); 
            // å› ä¸ºå†…å®¹åœ¨æ‚¬æµ®çª—é‡Œï¼Œæ‰€ä»¥ä¸»ç•Œé¢å†…å®¹å¯ä»¥ä¸ºç©º
            content = `<p class="comment" style="text-align:center; padding-top: 50px;">è¯·åœ¨ä¿¡æ¯ä¸­å¿ƒå¤„ç†å¾…åŠäº‹é¡¹ã€‚</p>`; 
            break; 
    }
    contentContainer.innerHTML = `<div class="tab-content active">${content}</div>`;
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (2/2)ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (1/2)ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderTabs() {
    const isMale = gameState.player.gender === 'male';
    const marriageTabName = isMale ? 'åºœé‚¸' : 'å†…åºœ';
    const canAccessMarriage = gameState.marriage.isMarried || (isMale && gameState.marriage.concubines.length > 0);
    const hasChildren = gameState.children.filter(c => !c.isDead).length > 0;
    // ã€æ–°å¢ã€‘åœ¨æ¸²æŸ“å‰ï¼Œå…ˆç¡®ä¿äº‹ä»¶ä»“åº“å¯¹è±¡å­˜åœ¨
    if (!gameState.pendingUiEvents) {
        gameState.pendingUiEvents = {};
    }

    const tabs = [
        { id: 'main', name: 'æ—¥å¸¸', icon: 'fa-home' },
        { id: 'social', name: 'äººé™…', icon: 'fa-users' },
        { id: 'career', name: 'äº‹ä¸š', icon: 'fa-briefcase' },
        { id: 'marriage', name: marriageTabName, icon: 'fa-heart', disabled: !canAccessMarriage },
        { id: 'children', name: 'å­å—£', icon: 'fa-baby-carriage', disabled: !hasChildren },
        { id: 'merchant', name: 'å•†ä¼š', icon: 'fa-store-alt' }
    ];
    const utilityTabs = [
        { id: 'log', name: 'è®°äº‹', icon: 'fa-book-open' },
        { id: 'eventHub', name: 'ä¿¡æ¯ä¸­å¿ƒ', icon: 'fa-envelope-open-text' },
    ];

    const tabContainer = document.getElementById('tabContainer');
    let mainTabsHTML = tabs.map(tab => {
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ£€æŸ¥æ˜¯å¦æœ‰å¾…å¤„ç†äº‹ä»¶
        const hasPendingEvents = gameState.pendingUiEvents[tab.id] && gameState.pendingUiEvents[tab.id].length > 0;
        return `
            <div class="tab ${tab.disabled ? 'disabled' : ''}" data-tab="${tab.id}" onclick="${tab.disabled ? '' : `updateActiveTab('${tab.id}')`}">
                <i class="fas ${tab.icon}"></i> ${tab.name}
                ${hasPendingEvents ? '<span class="red-dot"></span>' : ''}
            </div>
        `;
    }).join('');

    let utilityTabsHTML = utilityTabs.map(tab => {
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä¿¡æ¯ä¸­å¿ƒä¹Ÿéœ€è¦çº¢ç‚¹æç¤º
        const hasPendingEvents = tab.id === 'eventHub' && pendingEvents.length > 0;
        return `
            <div class="tab ${tab.disabled ? 'disabled' : ''}" data-tab="${tab.id}" onclick="${tab.disabled ? '' : `updateActiveTab('${tab.id}')`}">
                <i class="fas ${tab.icon}"></i> ${tab.name}
                ${hasPendingEvents ? '<span class="red-dot"></span>' : ''}
            </div>
        `;
    }).join('');

    tabContainer.innerHTML = `
        <div class="main-tabs-group">${mainTabsHTML}</div>
        <div class="utility-tabs-group">${utilityTabsHTML}</div>
    `;

    // ä¿æŒåŸæœ‰çš„æ ·å¼è°ƒæ•´é€»è¾‘
    const mainGroup = tabContainer.querySelector('.main-tabs-group');
    const utilityGroup = tabContainer.querySelector('.utility-tabs-group');
    if(mainGroup) {
        mainGroup.style.display = 'flex';
        mainGroup.style.flexWrap = 'wrap';
    }
    if(utilityGroup) {
        utilityGroup.style.display = 'flex';
        utilityGroup.style.flexDirection = 'column';
        utilityGroup.style.marginLeft = 'auto';
        utilityGroup.style.paddingBottom = '4px';
    }
}
function updateActiveTab(tabId) {
    gameState.flags.activeTab = tabId;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.tab[data-tab="${tabId}"]`)?.classList.add('active');

    const contentContainer = document.getElementById('tabContentContainer');
    let content = '';

    switch (tabId) {
        case 'main': content = renderMainTab(); break;
        case 'social': content = renderSocialTab(); break;
        case 'career': content = renderCareerTab(); break;
        case 'marriage': content = renderMarriageTab(); break;
        case 'children': content = renderChildrenTab(); break;
        case 'merchant': content = renderMerchantTab(); break;
        case 'log': content = renderLogTab(); break;
case 'eventHub': openEventHub(); content = ``; break; 
    }
    contentContainer.innerHTML = `<div class="tab-content active">${content}</div>`;

}

// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (1/2)ã€‘ =====================
// ===================== ã€ç¬¬ä¸€æ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderMainTab() {
    const isMale = gameState.player.gender === 'male';
    const studyDisabled = (gameState.flags.actionUsed_study || 0) >= 2 ? 'disabled' : '';
    const genderSpecificActions = isMale ?
    `
    <button class="option" onclick="performAction('martial')" ${studyDisabled}>
        <i class="fas fa-khanda"></i><span class="option-text">ä¿®ä¹ æ­¦è‰º <div><small>+æ­¦å­¦/å¥åº·</small></div></span>
    </button>
    <button class="option" onclick="performAction('strategy')" ${studyDisabled}>
        <i class="fas fa-chess"></i><span class="option-text">é’»ç ”æƒè°‹ <div><small>+æƒè°‹/é­…åŠ›</small></div></span>
    </button>
    ` :
    `
    <button class="option" onclick="performAction('needlework')" ${studyDisabled}>
        <i class="fas fa-cut"></i><span class="option-text">ç»ƒä¹ å¥³çº¢ <div><small>+æ‰æƒ…/é­…åŠ›</small></div></span>
    </button>
    <button class="option" onclick="performAction('scheming')" ${studyDisabled}>
        <i class="fas fa-brain"></i><span class="option-text">ç²¾ç ”å¿ƒè®¡ <div><small>+å¿ƒè®¡/æ™ºæ…§</small></div></span>
    </button>
    `;
    return `
    <h3 class="card-header">${isMale ? 'å…¬å­' : 'é—ºé˜'}æ—¥å¸¸</h3>
    <div class="section-header"><i class="fas fa-book-reader"></i>ä¿®èº« (æœ¬å›åˆå‰©ä½™ ${2 - (gameState.flags.actionUsed_study || 0)} æ¬¡)</div>
    <div class="options">
        <button class="option" onclick="performAction('study')" ${studyDisabled}><i class="fas fa-book"></i><span class="option-text">ç ”ä¹ è¯—ä¹¦ <div><small>+æ™ºæ…§/æ‰æƒ…</small></div></span></button>
        <button class="option" onclick="performAction('etiquette')" ${studyDisabled}><i class="fas fa-pray"></i><span class="option-text">å­¦ä¹ ç¤¼æ³• <div><small>+ç¤¼ä»ª/å“å¾·</small></div></span></button>
        ${genderSpecificActions}
        </div>
    <div class="section-header"><i class="fas fa-shoe-prints"></i>å¤–å‡º</div>
    <div class="options">
        <button class="option" onclick="handleOuting('market')"><i class="fas fa-shopping-bag"></i> é€›å¸‚é›†</button>
        <button class="option" onclick="handleOuting('restaurant')"><i class="fas fa-utensils"></i> å»é£Ÿè‚†</button>
        <button class="option" onclick="handleOuting('temple')"><i class="fas fa-gopuram"></i> å‚æ‹œå¯ºåº™</button>
        <button class="option" onclick="handleOuting('clinic')"><i class="fas fa-clinic-medical"></i> å‰å¾€åŒ»é¦†</button>
        ${isMale && gameState.player.age >= 16 ? `<button class="option" onclick="handleOuting('fengyuejian')"><i class="fas fa-fan"></i> é£æœˆé‰´</button>`: ''}
    </div>
    <div class="section-header"><i class="fas fa-home"></i>å®¶æ—äº‹åŠ¡</div>
      <div class="options">
        <button class="option" onclick="showAssetsOverlay()"><i class="fas fa-landmark"></i> æŸ¥çœ‹èµ„äº§</button>
        ${renderFamilyActions()}
      </div>
 <div class="section-header"><i class="fas fa-hand-sparkles"></i> å·§æ‰‹åˆ¶ä½œ</div>
    <div class="options">
        <button class="option" onclick="showCraftingUI()">
            <i class="fas fa-cut"></i><span class="option-text">åˆ¶ä½œä¿¡ç‰©<div><small>ä½¿ç”¨èŒä¸šææ–™åˆ¶ä½œç‰¹æ®Šç‰©å“</small></div></span>
        </button>
    </div>
    
    ${gameState.player.age >= 16 ? `
     <div class="section-header"><i class="fas fa-user-graduate"></i> å¸ˆå¾’ç³»ç»Ÿ</div>
        <div class="options">
            <button class="option" onclick="showApprenticeSystem()">
                <i class="fas fa-graduation-cap"></i> æ”¶å¾’ç³»ç»Ÿ
            </button>
        </div>
    ` : ''}
    `;
}
/**
 * ã€æ–°å¢å‡½æ•°ã€‘æ˜¾ç¤ºå·§æ‰‹åˆ¶ä½œç•Œé¢
 */
function showCraftingUI() {
    let content = '<p class="comment">ä½ å¯ä»¥åˆ©ç”¨èŒä¸šç›¸å…³çš„ç‰¹æ®Šææ–™ï¼Œåˆ¶ä½œèƒ½å¤Ÿå¢è¿›æƒ…è°Šçš„ä¿¡ç‰©ã€‚</p>';
    content += '<div class="inventory-container">';

    Object.entries(TOKEN_DATA).forEach(([id, data]) => {
        const requiredItemId = data.req.item;
        const requiredItemDef = ITEM_DATA[requiredItemId];
        const canCraft = hasItemInInventory(requiredItemId); // æ£€æŸ¥èƒŒåŒ…é‡Œæ˜¯å¦æœ‰ææ–™

        content += `
        <div class="inventory-item">
            <div class="inventory-item-icon"><i class="fas fa-gift"></i></div>
            <div class="inventory-item-details">
                <div class="inventory-item-name">${data.name}</div>
                <div class="inventory-item-desc">éœ€è¦ææ–™: <strong class="value">${requiredItemDef ? requiredItemDef.name : 'æœªçŸ¥ææ–™'}</strong></div>
            </div>
            <button class="control-btn" style="padding: 8px 12px; font-size: 0.9rem;" ${!canCraft ? 'disabled' : ''} onclick="craftSpecialItem('${id}')">
                ${canCraft ? 'åˆ¶ä½œ' : 'ææ–™ä¸è¶³'}
            </button>
        </div>
        `;
    });

    content += '</div>';
    showDecisionCard('å·§æ‰‹åˆ¶ä½œ', 'fa-hand-sparkles', content, []);
}

/**
 * ã€æ–°å¢å‡½æ•°ã€‘å¤„ç†åˆ¶ä½œç‰¹æ®Šç‰©å“çš„é€»è¾‘
 */
function craftSpecialItem(tokenId) {
    const data = TOKEN_DATA[tokenId];
    if (!data) return;
    const requiredItemId = data.req.item;
    
    // 1. æ¶ˆè€—ææ–™
    if (!removeItemFromInventory(requiredItemId, 1)) {
        showToast("åˆ¶ä½œå¤±è´¥ï¼Œææ–™ä¸è¶³ï¼");
        return;
    }

    // 2. è®¡ç®—å¿ƒæ„å€¼
    const qualityBonus = Math.floor((gameState.player.attributes[data.quality_attr] || 0) / 10);
    const finalSincerity = (data.stats.sincerity || 0) + qualityBonus;

    // 3. ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç›´æ¥å°†ä¸€ä¸ªå®Œæ•´çš„ã€åŒ…å«æ‰€æœ‰ä¿¡æ¯çš„ç‰©å“å¯¹è±¡æ·»åŠ åˆ° inventory
    const newItem = {
        id: tokenId, // ä¿ç•™IDç”¨äºè¯†åˆ«
        name: data.name,
        desc: `ä¸€ä»½ä½ äº²æ‰‹åˆ¶ä½œçš„ä¿¡ç‰©ï¼Œè•´å«ç€ ${finalSincerity} ç‚¹å¿ƒæ„ã€‚`,
        type: 'çå“',
        icon: 'fa-gift',
        sincerity: finalSincerity, // ä¿å­˜å¿ƒæ„å€¼ï¼Œèµ é€æ—¶å¯ä»¥ç”¨
        amount: 1,
        instanceId: `item_${Date.now()}` // å”¯ä¸€çš„å®ä¾‹ID
    };

    // æˆ‘ä»¬ä¸å†ä½¿ç”¨ addItemToInventory, è€Œæ˜¯ç›´æ¥æ“ä½œ gameState.inventory
    if (!gameState.inventory) gameState.inventory = [];
    gameState.inventory.push(newItem);

    showEventCard('åˆ¶ä½œæˆåŠŸ', 'fa-check', `ä½ æ¶ˆè€—äº†ã€${ITEM_DATA[requiredItemId].name}ã€‘ï¼ŒæˆåŠŸåˆ¶ä½œäº†<strong class="value">ã€${data.name}ã€‘</strong>ï¼Œå¹¶æ”¾å…¥äº†ä½ çš„è—å®é˜ã€‚`);
    
    // åˆ·æ–°åˆ¶ä½œç•Œé¢
    showCraftingUI();
}
function renderFamilyActions() {
    const isMale = gameState.player.gender === 'male';
    if (!gameState.marriage.isMarried && isMale && gameState.marriage.concubines.length === 0) {
        return `<p class="comment">ä½ å°šæœªæˆå®¶ï¼Œæš‚æ— å®¶äº‹å¯ç†ã€‚</p>`;
    }
    if (!gameState.marriage.isMarried && !isMale) {
        return `<p class="comment">å¾…å«é—ºä¸­ï¼Œæš‚æ— å®¶äº‹å¯ç†ã€‚</p>`;
    }

    let html = `<button class="option" onclick="manageFamilyChest()"><i class="fas fa-donate"></i> ç®¡ç†å®¶åº“</button>`;

    if(!isMale) {
        const spouse = gameState.npcs[gameState.marriage.spouseId];
        if (spouse) {
            html += `
            <button class="option" onclick="askForMoney()" ${gameState.flags.actionUsed_family ? 'disabled' : ''}>
                <i class="fas fa-hand-holding-usd"></i><span class="option-text">ç´¢è¦å®¶ç”¨<div><small>å¢åŠ å®¶åº“èµ„é‡‘ï¼Œå¯èƒ½å½±å“æ©çˆ±å€¼</small></div></span>
            </button>`;
            if (spouse.concubines && spouse.concubines.length > 0) {
                 html += `<button class="option" onclick="handleSpouseConcubines()" ${gameState.flags.actionUsed_family ? 'disabled' : ''}><i class="fas fa-user-times"></i> å¤„ç†å¦¾å®¤</button>`;
            }
        }
    }
    return html;

}

// [æ›¿æ¢] renderNpcCard å‡½æ•°
// ===================== ã€ç¬¬2æ­¥ï¼šæ›¿æ¢æ­¤å‡½æ•°ã€‘ =====================
function renderNpcCard(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return ''; 

    let roleDisplay = npc.role || '';
    if (gameState.marriage.isMarried && npc.id === gameState.marriage.spouseId) {
        roleDisplay = gameState.player.gender === 'male' ? 'æ­£å¦»' : 'å¤«å›';
    }

    if (npc.isDead) {
        const isParent = npc.id === gameState.family.members.fatherId || npc.id === gameState.family.members.motherId;
        const clickAction = isParent ? `showMemorialInteraction('${npc.id}')` : `showToast('æ–¯äººå·²é€ï¼Œæ— æ³•äº’åŠ¨ã€‚')`;
        
        return `
        <div class="suitor" style="opacity: 0.6; cursor: pointer;" onclick="${clickAction}">
            <div class="suitor-avatar-wrapper" style="background-color:#7f8c8d;">
                <div class="suitor-avatar-text" style="line-height:60px;">${npc.name.slice(0, 1)}</div>
            </div>
            <div class="suitor-details">
                <div class="suitor-name">[å·²æ•…] ${roleDisplay}: ${npc.name}</div>
                <div class="suitor-desc">äº«å¹´ ${Math.floor(npc.age)} å²</div>
            </div>
        </div>`;
    }

    const relationshipType = npc.relationship || 'stranger';
    const colorMap = {
        'suitor': '#e06c9e', 'friend': '#a7c957', 'sworn': '#f4a261', 'lover': '#c0392b',
        'family': npc.gender === 'male' ? '#6a9ac9' : '#e06c9e', 'spouse': '#d84381',
        'concubine': '#d84381', 'courtesan': '#9b59b6', 'supervisor': '#778899'
    };
    const avatarColor = npc.color || colorMap[relationshipType] || '#ccc';

    const avatarContent = npc.avatar
        ? `<img src="${npc.avatar}" class="suitor-avatar" alt="${npc.name} avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
           <div class="suitor-avatar-text" style="display:none; line-height:60px;">${npc.name.slice(0, 1)}</div>`
        : `<div class="suitor-avatar-text" style="line-height:60px;">${npc.name.slice(0, 1)}</div>`;

    let rankDisplay = '';
    // åˆ¤æ–­æ˜¯å¦ä¸ºç”·æ€§ç©å®¶è§†è§’ä¸‹çš„å¦¾å®¤
    if (gameState.player.gender === 'male' && gameState.marriage.concubines.includes(npc.id)) {
        const rankIndex = npc.rankIndex || 0;
        const rankName = CONCUBINE_RANKS[rankIndex]?.name || 'ä¾å¦¾';
        rankDisplay = ` (${rankName})`; // å‡†å¤‡è¦æ˜¾ç¤ºçš„ä½ä»½æ–‡æœ¬
        roleDisplay = 'å¦¾å®¤'; // ç»Ÿä¸€è§’è‰²æ˜¾ç¤ºä¸ºå¦¾å®¤
    }

    return `
    <div class="suitor" onclick="showNPCDetails('${npc.id}')">
        <div class="suitor-avatar-wrapper" style="background-color:${avatarColor};">${avatarContent}</div>
        <div class="suitor-details">
            <div class="suitor-name">${roleDisplay ? `${roleDisplay}: ` : ''}${npc.name}${rankDisplay} (${Math.floor(npc.age)}å²)</div>
            <div class="suitor-desc">å¥½æ„Ÿ: ${npc.favor}</div>
        </div>
    </div>`;
}
function showMemorialInteraction(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc || !npc.isDead) return;

    const options = [
        {
            htmlContent: `<i class="fas fa-praying-hands"></i> æ‰«å¢“/ç¥­æ‹œ`,
            callback: () => {
                let logText = `æ¸…æ˜æ—¶èŠ‚ï¼Œä½ æ¥åˆ°${npc.name}çš„å¢“å‰ï¼Œç„šé¦™ç¥­æ‹œï¼Œè¿½å¿†å¾€æ˜”ã€‚`;
                if (Math.random() < 0.5) {
                    const repGain = getRandomInt(2, 5);
                    applyEffects({ reputation: repGain });
                    logText += `\nä½ çš„å­è¡Œè¢«ä¹¡é‚»çœ‹åœ¨çœ¼é‡Œï¼Œäº¤å£ç§°èµã€‚å£°æœ›+${repGain}ã€‚`;
                }
                showEventCard('è¿½æ€æ•…äºº', 'ğŸ•¯ï¸', logText);
            }
        },
        {
            htmlContent: `<i class="fas fa-times"></i> ç¦»å¼€`,
            callback: () => closeAllOverlays()
        }
    ];

    showDecisionCard(`ç¼…æ€€ ${npc.name}`, 'ğŸ•¯ï¸', `çœ‹ç€å†°å†·çš„å¢“ç¢‘ï¼Œå¾€äº‹å†å†åœ¨ç›®...`, options);
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderSocialTab() {
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨æ¸²æŸ“å‰æ£€æŸ¥æ˜¯å¦æœ‰å¾…å¤„ç†çš„ç¤¾äº¤äº‹ä»¶
    if (gameState.pendingUiEvents && gameState.pendingUiEvents.social && gameState.pendingUiEvents.social.length > 0) {
        const nextEventCallback = gameState.pendingUiEvents.social.shift();
        if (typeof nextEventCallback === 'function') {
            nextEventCallback();
        }
        return '';
    }

    // --- ä»¥ä¸‹ä¸ºåŸæœ‰çš„ã€æ— äº‹ä»¶æ—¶çš„æ¸²æŸ“é€»è¾‘ ---
    const relationships = gameState.social.relationships || {};
    const groupedNpcs = {
        family: Object.values(gameState.family.members).filter(id => id),
        spouse: [],
        concubine: gameState.player.gender === 'male' ? gameState.marriage.concubines : [],
        confidante: [],
        brother: [],
        blue_confidante: [],
        red_confidante: [],
        lover: [],
        sworn_sibling: [],
        former_apprentice: []
    };
    const processedIds = new Set(groupedNpcs.family);

    for (const npcId in relationships) {
        if (processedIds.has(npcId)) continue;
        const rel = relationships[npcId];
        if (rel.type && groupedNpcs.hasOwnProperty(rel.type)) {
            if (!groupedNpcs[rel.type].includes(npcId)) {
                groupedNpcs[rel.type].push(npcId);
                processedIds.add(npcId);
            }
        }
    }

    if (gameState.marriage.isMarried && gameState.marriage.spouseId && !processedIds.has(gameState.marriage.spouseId)) {
        groupedNpcs.spouse.push(gameState.marriage.spouseId);
    }

    const renderGroup = (title, icon, npcIdList) => {
        if (!Array.isArray(npcIdList) || npcIdList.length === 0) return '';
        const validNpcs = npcIdList.filter(id => gameState.npcs[id]);
        if (validNpcs.length === 0) return '';
        let html = `<div class="section-header"><i class="fas ${icon}"></i> ${title}</div>`;
        html += validNpcs.map(id => renderNpcCard(id)).join('');
        return html;
    };

    let html = `
    <h3 class="card-header">äººé™…å…³ç³»</h3>
    <div class="options">
        <button class="option" onclick="strollForEncounters()"><i class="fas fa-walking"></i><span class="option-text">äº¬åŸé—²é€›<div><small>ä¸»åŠ¨ç»“è¯†æ–°æœ‹å‹</small></div></span></button>
        <button class="option" onclick="showMatchmaker()"><i class="fas fa-user-friends"></i><span class="option-text">æ‹œè®¿åª’å©†<div><small>é€šè¿‡åª’äººä»‹ç»å¯¹è±¡</small></div></span></button>
        <button class="option" onclick="showRankings()"><i class="fas fa-trophy"></i><span class="option-text">æŸ¥çœ‹${gameState.player.gender === 'male' ? 'æ‰ä¿Šæ¦œ' : 'è´µå¥³æ¦œ'}</span></button>
    </div>
    <div style="max-height: 50vh; overflow-y: auto; padding: 5px;">
        ${renderGroup('å®¶äºº', 'fa-users', groupedNpcs.family)}
        ${renderGroup('é…å¶', 'fa-heart', groupedNpcs.spouse)}
        ${renderGroup('å¦¾å®¤', 'fa-female', groupedNpcs.concubine)}
        ${renderGroup('ä¹‰ç»“é‡‘å…°', 'fa-hands-helping', groupedNpcs.sworn_sibling)}
        ${renderGroup('é—ºä¸­å¯†å‹', 'fa-comments', groupedNpcs.confidante)}
        ${renderGroup('å…„å¼ŸåŒè¢', 'fa-fist-raised', groupedNpcs.brother)}
        ${renderGroup('è“é¢œçŸ¥å·±', 'fa-paint-brush', groupedNpcs.blue_confidante)}
        ${renderGroup('çº¢é¢œçŸ¥å·±', 'fa-wine-glass', groupedNpcs.red_confidante)}
        ${renderGroup('ç§˜å¯†æƒ…äºº', 'fa-mask', groupedNpcs.lover)}
        ${renderGroup('å‡ºå¸ˆå¼Ÿå­', 'fa-user-graduate', groupedNpcs.former_apprentice)}
        ${renderApprenticesInSocialTab()}
    </div>`;

    const knownNpcIds = new Set(Object.keys(relationships).concat(groupedNpcs.family, groupedNpcs.spouse, groupedNpcs.concubine));
    const potentialFriends = gameState.suitors.filter(id => !knownNpcIds.has(id));
    if (potentialFriends.length > 0) {
        html += renderGroup('å¯ç»“äº¤å¯¹è±¡', 'fa-user-plus', potentialFriends);
    }

    return html;
}
function performReputationWork() {
    if (gameState.flags.actionUsed_work >= 2) {
        showToast("ä½ ä»Šå¤©å·²ç»å¾ˆç´¯äº†ã€‚");
        return;
    }
    const cost = 200;
    if (gameState.finances.wealth < cost) {
        showToast(`ç»è¥å£°æœ›éœ€è¦èŠ±è´¹${cost}ä¸¤ï¼Œä½ çš„èµ„é‡‘ä¸è¶³ã€‚`);
        return;
    }

    gameState.flags.actionUsed_work++;
    const reputationGain = getRandomInt(5, 10);
    applyEffects({ wealth: -cost, reputation: reputationGain });
    showEventCard('ç»è¥å£°æœ›', 'fa-bullhorn', `ä½ èŠ±è´¹ ${cost} ä¸¤ï¼Œé€šè¿‡ä¸€ç³»åˆ—è¿ä½œï¼ˆå¦‚ç»“äº¤åå£«ã€å…¬å¼€æ¼”è¯´ç­‰ï¼‰ï¼ŒæˆåŠŸæå‡äº† ${reputationGain} ç‚¹å£°æœ›ã€‚`);
    renderGame();
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (2/2)ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·å°†æ­¤æ–°å¢å‡½æ•°ç²˜è´´åˆ°æ‚¨çš„ä»£ç ä¸­ã€‘ =====================
function handleCareerSelectionAttempt(careerId) {
    if (gameState.player.age < 16) {
        showToast("éœ€å¹´æ»¡16å²æ–¹å¯é€‰æ‹©èŒä¸šã€‚");
        return;
    }
    // å¦‚æœæ»¡è¶³å¹´é¾„è¦æ±‚ï¼Œåˆ™æ­£å¸¸æ‰§è¡Œé€‰æ‹©èŒä¸šçš„å‡½æ•°
    startCareer(careerId);
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderCareerTab() {
    if (gameState.pendingUiEvents && gameState.pendingUiEvents.career && gameState.pendingUiEvents.career.length > 0) {
        const nextEventCallback = gameState.pendingUiEvents.career.shift();
        if (typeof nextEventCallback === 'function') {
            nextEventCallback();
        }
        return '';
    }
    
    const c = gameState.career;
    
    // ã€æ–°å¢ã€‘é€€ä¼‘çŠ¶æ€åˆ¤æ–­
    if (gameState.player.age >= 55 && c.path) {
        const currentPathData = PROFESSION_DATA[c.path];
        const currentPathLevels = careerPaths[gameState.player.gender][c.path];
        const finalLevel = currentPathLevels.levels[c.level];
        const pension = Math.floor(finalLevel.salary * 0.5) * 2; // å¹´é€€ä¼‘é‡‘

        return `
            <h3 class="card-header">è£ä¼‘</h3>
            <div class="event" style="text-align:center;">
                <p>ä½ å·²å¹´æ»¡55å²ï¼Œä» <strong class="value">${currentPathData.name} - ${finalLevel.title}</strong> çš„èŒä½ä¸Šå…‰è£èº«é€€ã€‚</p>
                <p class="comment">æœå»·æ„Ÿå¿µä½ ä¸€ç”Ÿçš„è´¡çŒ®ï¼Œæ¯å¹´å°†ä¸ºä½ å‘æ”¾ <strong class="value">${pension}</strong> ä¸¤çš„é€€ä¼‘é‡‘ï¼Œé¢å…»å¤©å¹´ã€‚</p>
                <p style="margin-top: 20px;">æ±Ÿæ¹–å·²è¿œï¼Œæ˜¯æ—¶å€™äº«å—äººç”Ÿï¼Œé™ªä¼´å®¶äººï¼ŒåŸ¹å…»å­å—£äº†ã€‚</p>
            </div>
            <div class="section-header"><i class="fas fa-gem"></i> è—å®é˜</div>
            ${renderInventoryTab()}
        `;
    }

    if (!c.path) {
        const availableCareers = Object.entries(PROFESSION_DATA)
            .filter(([key, value]) => value.gender === gameState.player.gender)
            .map(([key, value]) => ({ id: key, ...value }));
        const canStartCareer = gameState.player.age >= 16;
        let optionsHTML = availableCareers.map(career => {
            return `
                <button class="option" ${!canStartCareer ? 'disabled' : ''} onclick="handleCareerSelectionAttempt('${career.id}')">
                    <i class="fas ${career.icon}"></i>
                    <span class="option-text">
                        ${career.name}
                        ${!canStartCareer ? '<div><small>éœ€å¹´æ»¡16å²</small></div>' : ''}
                    </span>
                </button>
            `;
        }).join('');
        return `
            <h3 class="card-header">é€‰æ‹©ä½ çš„äº‹ä¸š</h3>
            <p class="comment">ä¸€æ—¦é€‰å®šï¼Œå°†å¼€å¯å…¨æ–°çš„äººç”Ÿç¯‡ç« ã€‚</p>
            <div class="options">${optionsHTML}</div>
        `;
    }
    const currentPathData = PROFESSION_DATA[c.path];
    const currentPathLevels = careerPaths[gameState.player.gender][c.path];
    if (!currentPathData || !currentPathLevels) {
        return `<p class="comment">èŒä¸šæ•°æ®åŠ è½½é”™è¯¯ã€‚</p>`;
    }
    const currentLevel = currentPathLevels.levels[c.level];
    const nextLevel = c.level < currentPathLevels.levels.length - 1 ? currentPathLevels.levels[c.level + 1] : null;
    const supervisor = c.supervisorId ? gameState.npcs[c.supervisorId] : null;
    let promotionButtonHTML = '';
    if (c.level < currentPathLevels.levels.length - 1) {
        const performanceMet = c.performance >= nextLevel.promotion_points;
        const visualDisabledClass = !performanceMet ? 'disabled' : '';
        promotionButtonHTML = `
            <button class="control-btn ${visualDisabledClass}" style="display: inline-block; padding: 5px 12px; font-size: 0.9em; margin-left: 15px; vertical-align: middle;" onclick="handlePromotionClick()">
                <i class="fas fa-arrow-up"></i> å‡èŒ
            </button>
        `;
    }
    let supervisorHTML = '';
    if (supervisor) {
        supervisorHTML = `
            <div class="section-header"><i class="fas fa-user-tie"></i> ç›´å±ä¸Šå¸</div>
            ${renderNpcCard(c.supervisorId)}
            <div class="options" style="margin-top:10px; flex-direction:row; flex-wrap:wrap;justify-content:center;gap:10px;">
                <button class="control-btn" style="min-width: calc(50% - 10px); background:var(--option-bg);" onclick="interactWithSupervisor('chat')"><i class="fas fa-comments"></i> æ±‡æŠ¥å·¥ä½œ</button>
                <button class="control-btn" style="min-width: calc(50% - 10px); background:var(--option-bg);" onclick="interactWithSupervisor('gift')"><i class="fas fa-gift"></i> èµ é€ç¤¼ç‰©</button>
            </div>`;
    }
    let promotionReqHTML = '';
    if (nextLevel) {
        const reqs = Object.entries(nextLevel.req).map(([attr, val]) => {
            let playerVal = 0;
            if (attr === 'reputation') {
                playerVal = gameState.family.reputation || 0;
            } else {
                playerVal = gameState.player.attributes[attr] || 0;
            }
            const attrName = ATTR_MAP[attr] || attr;
            return `<span style="color:${playerVal >= val ? 'green' : 'red'};">${attrName}â‰¥${val}</span>`;
        }).join(', ');
        promotionReqHTML = `<p><strong>æ™‹å‡è¦æ±‚:</strong> ${reqs}</p>`;
    } else {
        promotionReqHTML = `<p><strong>å·²æ˜¯æœ€é«˜èŒä½ï¼Œåæ‰¬å¤©ä¸‹ã€‚</strong></p>`;
    }
    const promotionProgress = nextLevel ? Math.min(100, (c.performance / nextLevel.promotion_points) * 100) : 100;
    const unclaimedSalary = gameState.career.unclaimedSalary || 0;
    let salaryHTML = `
        <div class="section-header"><i class="fas fa-coins"></i> ä¿¸ç¦„</div>
        <div class="trading-info-box" style="margin-bottom: 10px;">
            <h4>å¾…é¢†å–ä¿¸ç¦„</h4>
            <div class="value">${formatNumber(unclaimedSalary)} ä¸¤</div>
        </div>
        <div class="options">
             <button class="option" ${unclaimedSalary <= 0 ? 'disabled' : ''} onclick="claimSalary()">
                <i class="fas fa-hand-holding-usd"></i> é¢†å–ä¿¸ç¦„
            </button>
        </div>
    `;
    return `
        <h3 class="card-header">${currentPathData.dashboard_name || 'æˆ‘çš„äº‹ä¸š'}</h3>
        <p><strong>èŒä¸š:</strong> ${currentPathData.name} ${promotionButtonHTML}</p>
        <p><strong>èŒä½:</strong> ${currentLevel.title}</p>
        <p><strong>æ¯å›åˆä¿¸ç¦„:</strong> ${currentLevel.salary} ä¸¤</p>
        ${promotionReqHTML}
        <div class="attribute" style="margin-top:20px;">
            <div class="attribute-name"><span><i class="fas fa-chart-line"></i> åŠŸç»©</span><span>${c.performance} / ${nextLevel ? nextLevel.promotion_points : 'MAX'}</span></div>
            <div class="progress-bar"><div class="progress-fill charm-fill" style="width: ${promotionProgress}%;"></div></div>
        </div>
        <div class="section-header"><i class="fas fa-briefcase"></i> æ—¥å¸¸å…¬åŠ¡ (å‰©ä½™ ${2 - (gameState.flags.actionUsed_work||0)} æ¬¡)</div>
        <div class="options">
            <button class="option" onclick="triggerProfessionEvent()">
                <i class="fas fa-scroll"></i>
                <span class="option-text">å¤„ç†å…¬åŠ¡<div><small>è§¦å‘éšæœºèŒä¸šäº‹ä»¶</small></div></span>
            </button>
            <button class="option" onclick="performReputationWork()">
                <i class="fas fa-bullhorn"></i>
                <span class="option-text">ç»è¥å£°æœ›<div><small>æ¶ˆè€—é‡‘é’±ä¸ç²¾åŠ›ï¼Œæå‡å£°æœ›</small></div></span>
            </button>
        </div>
        ${salaryHTML}
        ${supervisorHTML}
        <div class="section-header"><i class="fas fa-gem"></i> è—å®é˜</div>
        ${renderInventoryTab()}
    `;
}
// REPLACE the existing renderMarriageTab function

// =======================================================================
// ===================== ã€æ›¿æ¢ã€‘å…¨æ–°çš„åºœé‚¸/å†…åºœæ ‡ç­¾é¡µ =====================
// =======================================================================

// [æ–°å¢] showWifeInteractionUI å‡½æ•°
function showWifeInteractionUI() {
    const wife = gameState.npcs[gameState.marriage.spouseId];
    if (!wife || wife.isDead) {
        showToast("ä½ å°šæœªå¨¶å¦»æˆ–å¦»å­å·²æ•…ã€‚");
        return;
    }

    const renderCategory = (category) => {
        let html = '';
        WIFE_INTERACTION_DATA[category].forEach(action => {
            let disabled = false;
            let reason = '';
            // æ£€æŸ¥å„ç§æ¡ä»¶
            if (action.req) {
                 if (action.req.favor && wife.favor < action.req.favor) {
                    disabled = true;
                    reason = `(æ©çˆ±å€¼â‰¥${action.req.favor}) `;
                }
                if (action.req.prestige && gameState.player.attributes.prestige < action.req.prestige) {
                    disabled = true;
                    reason = `(å®¶å¨â‰¥${action.req.prestige}) `;
                }
                if (action.req.authority_holder && gameState.marriage.householdAuthorityHolder !== 'wife') {
                    disabled = true;
                    reason = `(å¦»å­éœ€ä¸ºæŒäº‹è€…) `;
                }
            }
            html += `
                <button class="option" ${disabled ? 'disabled' : ''} onclick="handleWifeInteraction('${action.id}')">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span class="option-text"><strong>${action.name}</strong><div><small>${action.desc} ${reason.trim()}</small></div></span>
                </button>
            `;
        });
        return html;
    };

    const content = `
        <div class="status-item" style="justify-content:center; margin-bottom:15px;">æ­£å¦»å½“å‰çŠ¶æ€: <strong class="value">${wife.mood || 'å¹³å’Œ'}</strong></div>
        <div style="max-height: 50vh; overflow-y: auto; padding-right:5px;">
            <div class="section-header"><i class="fas fa-heart"></i> æ—¥å¸¸æƒ…æ„Ÿ</div>
            ${renderCategory('daily_affection')}
            <div class="section-header"><i class="fas fa-home"></i> å†…å®…è®®äº‹</div>
            ${renderCategory('household_discussion')}
            <div class="section-header"><i class="fas fa-briefcase"></i> äº‹ä¸šä¸æ”¯æŒ</div>
            ${renderCategory('career_support')}
        </div>
    `;
    showDecisionCard(`ä¸æ­£å¦» (${wife.name}) äº’åŠ¨`, 'fa-user-friends', content, []);
}

// [æ–°å¢] handleWifeInteraction å‡½æ•°
function handleWifeInteraction(actionId) {
    const wife = gameState.npcs[gameState.marriage.spouseId];
    if (!wife || !checkAndUseNpcActionPoint(wife.id)) return;

    const action = [...WIFE_INTERACTION_DATA.daily_affection, ...WIFE_INTERACTION_DATA.household_discussion, ...WIFE_INTERACTION_DATA.career_support].find(a => a.id === actionId);
    if (!action) return;

    let resultText = '';

    switch(actionId) {
        case 'praise_publicly':
            resultText = 'ä½ åœ¨å®¶äººé¢å‰ç§°èµäº†å¥¹çš„è´¤æƒ ï¼Œå¥¹é¢éœ²å¨‡ç¾ï¼Œååˆ†æ¬¢å–œã€‚';
            applyEffects({ relationship: { targetId: wife.id, favor: 8 }, attributes: { prestige: 2 } });
            break;
        case 'accompany_back':
            resultText = 'ä½ çš„é™ªä¼´è®©å¦»å­åœ¨å¨˜å®¶éå¸¸æœ‰é¢å­ï¼Œå¥¹å¯¹ä½ æ›´æ·»çˆ±æ„ã€‚';
            applyEffects({ relationship: { targetId: wife.id, favor: 12 }, reputation: 5 });
            break;
        case 'listen_troubles':
            resultText = 'ä½ è€å¿ƒå€¾å¬å¥¹ç®¡ç†åå®…çš„çƒ¦æ¼ï¼Œå¹¶ç»™äºˆäº†æ”¯æŒï¼Œå¥¹æ„Ÿåˆ°ååˆ†æ…°è—‰ã€‚';
            applyEffects({ relationship: { targetId: wife.id, favor: 6 }, marriage: { familyHarmony: 5 } });
            break;
        case 'give_personal_gift':
             if (gameState.player.privateAssets < 200) { showToast("ä½ çš„ç§äº§ä¸è¶³200ä¸¤ã€‚"); return; }
             applyEffects({ privateAssets: -200, relationship: { targetId: wife.id, favor: 10 } });
             resultText = 'ä½ ç”¨ç§äº§ä¸ºå¥¹å‡†å¤‡äº†ä¸€ä»½è´´å¿ƒçš„ç¤¼ç‰©ï¼Œå¥¹ååˆ†æƒŠå–œã€‚';
            break;
        case 'delegate_authority':
            if (gameState.marriage.householdAuthorityHolder !== 'wife') {
                 gameState.marriage.householdAuthorityHolder = 'wife';
                 resultText = `ä½ å°†æŒå®¶æƒæ­£å¼äº¤äºˆ${wife.name}ï¼Œå¥¹å¯¹æ­¤æ„Ÿæ¿€ä¸å·²ï¼Œå†³å¿ƒä¸ºä½ æ‰“ç†å¥½åå®…ã€‚`;
                 applyEffects({ relationship: { targetId: wife.id, favor: 20 } });
            } else {
                 resultText = `${wife.name}å·²æ˜¯æŒäº‹è€…ï¼Œæ— éœ€å†ä¸‹æ”¾æƒåŠ›ã€‚`;
            }
            break;
        case 'discuss_concubines':
            resultText = `ä½ å°†å¦¾å®¤çš„ä¸€äº›äº‹å®œäº¤ç”±${wife.name}å®šå¤ºï¼Œå¥¹æ„Ÿå—åˆ°äº†ä½ çš„ä¿¡ä»»å’Œå°Šé‡ã€‚`;
            applyEffects({ relationship: { targetId: wife.id, favor: 10 }, marriage: { familyHarmony: 8 } });
            break;
        case 'plan_banquet':
            resultText = 'ä½ ä»¬ä¸€åŒç­–åˆ’äº†ä¸€åœºæˆåŠŸçš„å®¶å®´ï¼Œè¿‡ç¨‹è™½æœ‰åˆ†æ­§ï¼Œä½†æœ€ç»ˆç›¸è§†ä¸€ç¬‘ï¼Œæ„Ÿæƒ…æ›´åŠ æ·±åšã€‚';
            applyEffects({ relationship: { targetId: wife.id, favor: 7 } });
            break;
        case 'provide_funds':
            if (gameState.player.privateAssets < 300) { showToast("ä½ çš„ç§äº§ä¸è¶³300ä¸¤ã€‚"); return; }
            applyEffects({ privateAssets: -300 });
            resultText = `ä½ æ‹¨ä»˜äº†300ä¸¤ç§äº§æ”¯æŒ${wife.name}çš„çˆ±å¥½ï¼Œå¥¹å¯¹ä½ çš„ä½“è´´éå¸¸æ„ŸåŠ¨ã€‚`;
            applyEffects({ relationship: { targetId: wife.id, favor: 9 } });
            break;
        case 'praise_management':
            resultText = `ä½ å…¬å¼€èµæ‰¬äº†${wife.name}çš„æŒå®¶ä¹‹èƒ½ï¼Œè®©å¥¹åœ¨åå®…çš„å¨ä¿¡æ›´é«˜äº†ã€‚`;
            applyEffects({ relationship: { targetId: wife.id, favor: 6 } });
            break;
    }
    showEventCard(action.name, 'fa-users', resultText);
    renderGame();
}

// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘renderMarriageTab å‡½æ•° START =====================
function renderMarriageTab() {
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨æ¸²æŸ“å‰æ£€æŸ¥æ˜¯å¦æœ‰å¾…å¤„ç†çš„å©šå§»/å®…æ–—äº‹ä»¶
    if (gameState.pendingUiEvents && gameState.pendingUiEvents.marriage && gameState.pendingUiEvents.marriage.length > 0) {
        const nextEventCallback = gameState.pendingUiEvents.marriage.shift();
        if (typeof nextEventCallback === 'function') {
            nextEventCallback();
        }
        return '';
    }
    // --- ä»¥ä¸‹ä¸ºåŸæœ‰çš„ã€æ— äº‹ä»¶æ—¶çš„æ¸²æŸ“é€»è¾‘ ---
    const isMale = gameState.player.gender === 'male';
    const trustActionsHTML = `
        <div class="section-header"><i class="fas fa-shield-alt"></i> ç»´ç³»ä¿¡ä»» (å‰©ä½™ ${2 - (gameState.flags.actionUsed_trustActions || 0)} æ¬¡)</div>
        <div class="options">
            <button class="option" ${ (gameState.flags.actionUsed_trustActions || 0) >= 2 ? 'disabled' : ''} onclick="triggerTrustEvent('gift')">
                <i class="fas fa-gift"></i><span class="option-text">èµ é€ç¤¼ç‰©<div><small>ç²¾å¿ƒå‡†å¤‡ä¸€ä»½ç¤¼ç‰©ï¼Œè¡¨è¾¾å¿ƒæ„</small></div></span>
            </button>
            <button class="option" ${ (gameState.flags.actionUsed_trustActions || 0) >= 2 ? 'disabled' : ''} onclick="triggerTrustEvent('talk')">
                <i class="fas fa-comments"></i><span class="option-text">å¦è¯šäº¤è°ˆ<div><small>åˆ†äº«å½¼æ­¤çš„å¿ƒäº‹ï¼Œå¢è¿›äº†è§£</small></div></span>
            </button>
            <button class="option" ${ (gameState.flags.actionUsed_trustActions || 0) >= 2 ? 'disabled' : ''} onclick="triggerTrustEvent('accompany')">
                <i class="fas fa-walking"></i><span class="option-text">å…±åº¦æ—¶å…‰<div><small>é™ªä¼´æ˜¯æœ€é•¿æƒ…çš„å‘Šç™½</small></div></span>
            </button>
        </div>
    `;
    if (!isMale) {
        const husband = gameState.npcs[gameState.marriage.spouseId];
        let husbandHTML = '';
        if (gameState.marriage.isMarried && husband && !husband.isDead) {
            let suspicionDesc = "é£å¹³æµªé™";
            if(husband.suspicionValue > 80) suspicionDesc = "ä¿¡ä»»å´©å¡Œ";
            else if(husband.suspicionValue > 50) suspicionDesc = "æš—æµæ¶ŒåŠ¨";
            else if(husband.suspicionValue > 20) suspicionDesc = "å¶æœ‰å¾®è¯";
            husbandHTML = `
            <div class="section-header"><i class="fas fa-male"></i> æˆ‘çš„å¤«å›</div>
            ${renderNpcCard(husband.id)}
            <div class="attribute" style="margin-top:15px;">
                ${renderAttributeBar('æ©çˆ±å€¼', gameState.marriage.favor, 'charm-fill', 'fa-heart', 100)}
            </div>
            <div class="attribute">
                ${renderAttributeBar('ç–‘å¿ƒå€¼', husband.suspicionValue || 0, 'martial-fill', 'fa-eye', 100)}
                <p class="comment" style="text-align:center;">å½“å‰é˜¶æ®µ: ${suspicionDesc}</p>
            </div>
            <div class="options" style="margin-top:10px;">
                <button class="option" onclick="showHusbandInteractionUI()">
                    <i class="fas fa-user-friends"></i><span class="option-text">ä¸å¤«å›äº’åŠ¨<div><small>ç»è¥æ„Ÿæƒ…ï¼Œå½±å“å†³ç­–</small></div></span>
                </button>
                <button class="option" onclick="triggerSpouseIntimacyEvent('${husband.id}')" style="background: linear-gradient(135deg, #ff9ebf, #d84381);">
                    <i class="fas fa-moon"></i><span class="option-text">é±¼æ°´ä¹‹æ¬¢<div><small>æå‡æƒ…æ„Ÿï¼Œå¯èƒ½å­•è‚²å­å—£</small></div></span>
                </button>
            </div>
            `;
        }
        let managementHTML = `<div class="section-header"><i class="fas fa-chess-queen"></i> å†…å®…ç®¡ç†</div>`;
        const authority = gameState.marriage.householdAuthority;
        managementHTML += `<div class="attribute">${renderAttributeBar('æŒå®¶æƒæ€»è§ˆ', authority.progress, 'virtue-fill', 'fa-key', 100)}</div>`;
        let authorityBreakdown = `
            <div class="attributes-grid" style="grid-template-columns: 1fr 1fr; margin: 10px 0;">
                <div class="status-item" style="flex-direction:column; align-items:center; text-align:center;"><i class="fas fa-users-cog"></i> äººäº‹æƒ: ${authority.personnel}%</div>
                <div class="status-item" style="flex-direction:column; align-items:center; text-align:center;"><i class="fas fa-file-invoice-dollar"></i> è´¢åŠ¡æƒ: ${authority.finance}%</div>
                <div class="status-item" style="flex-direction:column; align-items:center; text-align:center;"><i class="fas fa-shopping-basket"></i> é‡‡åŠæƒ: ${authority.procurement}%</div>
            </div>`;
        managementHTML += authorityBreakdown;
        if(authority.progress >= 100){
             managementHTML += `<div class="options"><button class="option" onclick="showAdvancedMatronUI()"><i class="fas fa-crown"></i> å½“å®¶ä¸»æ¯å†³ç­–</button></div>`;
        } else {
            managementHTML += `<div class="options"><button class="option" onclick="showHouseholdAuthorityTasks()"><i class="fas fa-tasks"></i> åç†å®¶åŠ¡ (æå‡æŒå®¶æƒ)</button></div>`;
        }
        let concubineHTML = '';
        const rivalConcubines = (husband && husband.concubines) ? husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead) : [];
        if (rivalConcubines.length > 0) {
             concubineHTML += `<div class="section-header"><i class="fas fa-users"></i> å¤«å›çš„å¦¾å®¤</div>`;
             concubineHTML += rivalConcubines.map(conc => renderNpcCard(conc.id)).join('');
             concubineHTML += `
                <div class="options" style="margin-top:15px;">
                    <button class="option" onclick="showConcubineManagementUI_Female()">
                        <i class="fas fa-users-cog"></i><span class="option-text">ç®¡ç†å¦¾å®¤<div><small>èµç½šç¦è¶³ï¼Œé‡å¡‘åå®…ç§©åº</small></div></span>
                    </button>
                </div>`;
        }
        return `
        <h3 class="card-header">æˆ‘çš„å†…åºœ</h3>
        <div style="max-height: 70vh; overflow-y: auto; padding: 5px;">
            ${husbandHTML}
            ${trustActionsHTML}
            ${concubineHTML}
            ${managementHTML}
        </div>`;
    } else {
        const wife = gameState.npcs[gameState.marriage.spouseId];
        let wifeHTML = '';
        if (gameState.marriage.isMarried && wife && !wife.isDead) {
            let suspicionDesc = "é£å¹³æµªé™";
            if(wife.suspicionValue > 80) suspicionDesc = "ä¿¡ä»»å´©å¡Œ";
            else if(wife.suspicionValue > 50) suspicionDesc = "æš—æµæ¶ŒåŠ¨";
            else if(wife.suspicionValue > 20) suspicionDesc = "å¶æœ‰å¾®è¯";
            wifeHTML = `
            <div class="section-header"><i class="fas fa-chess-queen"></i> æ­£å¦»</div>
            ${renderNpcCard(wife.id)}
            <div class="attribute" style="margin-top:15px;">
                ${renderAttributeBar('ç–‘å¿ƒå€¼', wife.suspicionValue || 0, 'martial-fill', 'fa-eye', 100)}
                <p class="comment" style="text-align:center;">å½“å‰é˜¶æ®µ: ${suspicionDesc}</p>
            </div>
            <div class="options" style="margin-top:10px;">
                 <button class="option" onclick="showWifeInteractionUI()">
                    <i class="fas fa-user-friends"></i><span class="option-text">ä¸æ­£å¦»äº’åŠ¨<div><small>ç»´ç³»æ„Ÿæƒ…ï¼Œå…±ç†å®¶äº‹</small></div></span>
                </button>
            </div>
            `;
        }
        let concubinesHTML = `<div class="section-header"><i class="fas fa-female"></i> å¦¾å®¤</div>`;
        const aliveConcubines = gameState.marriage.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
        if (aliveConcubines.length > 0) {
            concubinesHTML += aliveConcubines.map(conc => renderNpcCard(conc.id)).join('');
        } else {
            concubinesHTML += `<p class="comment">åé™¢å°šæ— å¦¾å®¤ã€‚</p>`;
        }
        let authorityHolderName = "ä½ ";
        if(gameState.marriage.householdAuthorityHolder === 'wife' && wife) {
            authorityHolderName = wife.name;
        } else if (gameState.marriage.householdAuthorityHolder === 'mother') {
            const mother = gameState.npcs[gameState.family.members.motherId];
            if(mother) authorityHolderName = mother.name;
        }
        const intimacyActionsLeft = 2 - (gameState.flags.intimacyActionsUsedThisTurn || 0);
        let intimateOptions = `
            <div class="section-header"><i class="fas fa-moon"></i> æ¸©å­˜ (å‰©ä½™ ${intimacyActionsLeft} æ¬¡)</div>
            <div class="options">
        `;
        if (wife && !wife.isDead) {
             intimateOptions += `<button class="option" ${intimacyActionsLeft <= 0 ? 'disabled' : ''} onclick="triggerSpouseIntimacyEvent('${wife.id}')"><i class="fas fa-ring"></i> ä¸ ${wife.name} æ¸©å­˜</button>`;
        }
        aliveConcubines.forEach(conc => {
             intimateOptions += `<button class="option" ${intimacyActionsLeft <= 0 ? 'disabled' : ''} onclick="handleIntimateInteraction('${conc.id}')"><i class="fas fa-feather"></i> ä¸ ${conc.name} æ¸©å­˜</button>`;
        });
        intimateOptions += `</div>`;
        let managementOptions = `
            <div class="section-header"><i class="fas fa-gavel"></i> å®¶ä¸»å†³ç­–</div>
            <div class="options">
                <button class="option" onclick="showHouseholdManagement_Male()">
                    <i class="fas fa-key"></i><span class="option-text">è¡Œä½¿æŒå®¶æƒ<div><small>å¤„ç†äººäº‹ã€è´¢åŠ¡ä¸é‡‡åŠ</small></div></span>
                </button>
                <button class="option" onclick="showConcubineManagementUI()">
                    <i class="fas fa-users-cog"></i><span class="option-text">ç®¡ç†å¦¾å®¤<div><small>å‡é™ä½ä»½ã€èµç½šç¦è¶³</small></div></span>
                </button>
                <button class="option" onclick="showMatchmaker(true)"><i class="fas fa-plus-circle"></i> çº³å¦¾</button>
            </div>`;
        return `
        <h3 class="card-header">å†…å¸·ç®¡ç†</h3>
        <div style="max-height: 70vh; overflow-y: auto; padding: 5px;">
            <div class="attributes-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 15px;">
                <div class="status-item" style="padding: 10px 15px; border-radius: 12px; flex-direction: column; align-items: center; text-align: center;">
                    <div><i class="fas fa-key"></i> æŒäº‹è€…</div><strong class="value" style="margin-top:5px;">${authorityHolderName}</strong>
                </div>
                <div class="status-item" style="padding: 10px 15px; border-radius: 12px; flex-direction: column; align-items: center; text-align: center;">
                    <div><i class="fas fa-users"></i> å†…å®…å’Œè°</div><strong class="value" style="margin-top:5px;">${Math.floor(gameState.marriage.familyHarmony)}</strong>
                </div>
            </div>
            ${wifeHTML}
            ${concubinesHTML}
            ${intimateOptions}
            ${trustActionsHTML}
            ${managementOptions}
        </div>
        `;
    }
}
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘renderMarriageTab å‡½æ•° END =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘renderMarriageTab å‡½æ•° END =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘renderMarriageTab å‡½æ•° END =====================
function showHouseholdManagement_Male() {
    const options = [
        {
            htmlContent: `<i class="fas fa-users-cog"></i><span class="option-text"><strong>äººäº‹æƒ</strong><div><small>å®‰æ’çœ¼çº¿ã€æ”¶ä¹°/è°ƒç¦»ä¸‹äºº</small></div></span>`,
            callback: () => showAuthorityActions_Male('personnel')
        },
        {
            htmlContent: `<i class="fas fa-file-invoice-dollar"></i><span class="option-text"><strong>è´¢åŠ¡æƒ</strong><div><small>è®¾ç«‹ç§åº“ã€æ··æ·†è´¦ç›®ã€å¢åŠ æœˆä¾‹</small></div></span>`,
            callback: () => showAuthorityActions_Male('finance')
        },
        {
            htmlContent: `<i class="fas fa-shopping-basket"></i><span class="option-text"><strong>é‡‡åŠæƒ</strong><div><small>å€Ÿæ•…é‡‡åŠã€æŠ•å…¶æ‰€å¥½</small></div></span>`,
            callback: () => showAuthorityActions_Male('procurement')
        }
    ];
    showDecisionCard('è¡Œä½¿æŒå®¶æƒ', 'fa-key', 'ä½œä¸ºä¸€å®¶ä¹‹ä¸»ï¼Œä½ å¯ä»¥é€šè¿‡æ‰‹ä¸­çš„æƒåŠ›æ¥ç®¡ç†å†…å®…ï¼Œç»´æŠ¤ç¨³å®šæˆ–æ©ç›–ç§˜å¯†ã€‚', options);
}

/**
 * ã€ç”·æ€§ç©å®¶ã€‘æ˜¾ç¤ºå…·ä½“æƒåŠ›ä¸‹çš„æŒ‡ä»¤
 * @param {string} type - 'personnel', 'finance', 'procurement'
 */
// =======================================================================
// ===================== ã€æ–°å¢ã€‘å½“å®¶ä¸»æ¯é«˜é˜¶ç©æ³•æ ¸å¿ƒå‡½æ•° =====================
// =======================================================================

function showAdvancedMatronUI() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) {
        showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚");
        return;
    }
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²

    const options = [
        {
            htmlContent: `<i class="fas fa-chart-line"></i><span class="option-text"><strong>å®¶æ—å½±å“åŠ›æŠ•èµ„</strong><div><small>è¾…ä½å¤«å›ã€è§„åˆ’å­å—£</small></div></span>`,
            callback: () => showFamilyInvestmentUI()
        },
        {
            htmlContent: `<i class="fas fa-theater-masks"></i><span class="option-text"><strong>åå®…ç§©åºé‡å¡‘</strong><div><small>æ•²å±±éœ‡è™ã€æ©å¨å¹¶æ–½ã€é‡œåº•æŠ½è–ª</small></div></span>`,
            callback: () => showHaremReshapingUI()
        },
        {
            htmlContent: `<i class="fas fa-user-secret"></i><span class="option-text"><strong>ç§˜å¯†ç½‘ç»œæ·±åŒ–</strong><div><small>æš—åº¦é™ˆä»“ï¼Œèµ„åŠ©æƒ…äºº</small></div></span>`,
            callback: () => showSecretNetworkUI()
        }
    ];
    showDecisionCard('å½“å®¶ä¸»æ¯å†³ç­–', 'fa-crown', 'ä½ å·²æ˜¯å®¶æ—çš„æ ¸å¿ƒå†³ç­–è€…ï¼Œç©æ³•å°†ä»â€œç”Ÿå­˜â€è½¬å‘â€œç»è¥ä¸å¸ƒå±€â€ã€‚', options);
}

/**
 * æ˜¾ç¤ºâ€œå®¶æ—å½±å“åŠ›æŠ•èµ„â€ç•Œé¢
 */
function showFamilyInvestmentUI() {
    const options = [
        {
            htmlContent: `<i class="fas fa-user-tie"></i><span class="option-text"><strong>è¾…ä½å¤«å›</strong><div><small>ä¸ºå¤«å›çš„å®˜åœºä¹‹è·¯è¿›è¡ŒæŠ•èµ„</small></div></span>`,
            callback: () => handleAssistHusband()
        },
        {
            htmlContent: `<i class="fas fa-users-cog"></i><span class="option-text"><strong>è§„åˆ’å­å—£</strong><div><small>ä¸ºå·²æˆå¹´çš„å­å¥³é“ºè·¯</small></div></span>`,
            callback: () => handlePlanOffspring()
        }
    ];
    showDecisionCard('å®¶æ—å½±å“åŠ›æŠ•èµ„', 'fa-chart-line', 'ä½ ä¸å†ä»…ä»…æ˜¯åå®…çš„ç®¡ç†è€…ï¼Œæ›´æ˜¯å®¶æ—å…´è¡°çš„æ“ç›˜æ‰‹ã€‚', options);
}

/**
 * å¤„ç†â€œè¾…ä½å¤«å›â€çš„é€»è¾‘
 */
function handleAssistHusband() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) { showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚"); return; }
    gameState.flags.actionUsed_household = (gameState.flags.actionUsed_household || 0) + 1;
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    const husband = gameState.npcs[gameState.marriage.spouseId];
    if (!husband) return;
    const options = [
        {
            htmlContent: `<strong>æ‰“ç‚¹ä¸Šå¸</strong><div><small>èŠ±è´¹2000-10000ä¸¤ï¼Œæå‡å¤«å›åŠŸç»©</small></div>`,
            callback: () => {
                const cost = getRandomInt(2000, 10000);
                if (gameState.family.moneyChest < cost) { showToast("å®¶åº“èµ„é‡‘ä¸è¶³ï¼"); return; }
                gameState.family.moneyChest -= cost;
                if(husband.career) husband.career.performance = (husband.career.performance || 0) + 20;
                let log = `ä½ èŠ±è´¹ <span class="value">${cost}</span> ä¸¤å®¶åº“èµ„é‡‘ä¸ºå¤«å›çš„ä¸Šå¸é€å»åšç¤¼ï¼Œå¤«å›çš„åŠŸç»©æå‡äº†ã€‚`;
                if ((husband.attributes.virtue || 50) > 80) {
                    applyEffects({marriage: {favor: -5}});
                    log += `ä½†å¤«å›å“å¾·é«˜å°šï¼Œå¯¹æ­¤ä¸¾ç•¥æœ‰ä¸æ»¡ï¼Œæ©çˆ±å€¼ä¸‹é™ã€‚`;
                }
                showEventCard('è¾…ä½å¤«å›', 'fa-user-tie', log);
            }
        },
        {
            htmlContent: `<strong>å®´è¯·åŒåƒš</strong><div><small>èŠ±è´¹1000ä¸¤ï¼Œæå‡å¤«å›å£°æœ›</small></div>`,
            callback: () => {
                const cost = 1000;
                if (gameState.family.moneyChest < cost) { showToast("å®¶åº“èµ„é‡‘ä¸è¶³ï¼"); return; }
                gameState.family.moneyChest -= cost;
                applyEffects({reputation: 15});
                showEventCard('è¾…ä½å¤«å›', 'fa-user-tie', `ä½ èŠ±è´¹ <span class="value">${cost}</span> ä¸¤å®¶åº“èµ„é‡‘ä¸¾åŠå®´å¸­ï¼Œä¸ºå¤«å›è¥é€ äº†è‰¯å¥½çš„äººé™…å…³ç³»ï¼Œå®¶æ—å£°æœ›æå‡ã€‚`);
            }
        },
        {
            htmlContent: `<strong>æ”¶é›†æ”¿æ•Œé»‘æ–™</strong><div><small>éœ€è¦å¿ƒè®¡>90</small></div>`,
            disabled: (gameState.player.attributes.scheming || 0) < 90,
            callback: () => {
                 if (Math.random() < 0.2) {
                     showEventCard('è°ƒæŸ¥å¤±è´¥', 'fa-user-secret', `ä½ çš„å¿ƒè…¹åœ¨è°ƒæŸ¥æ—¶è¢«å¯¹æ–¹åä¾¦å¯Ÿï¼Œä¸ºå¤«å›æ ‘ç«‹äº†å¼ºæ•Œã€‚`);
                  } else {
                     addItemToInventory('tan_fu_xian_suo', 1);
                     showEventCard('è°ƒæŸ¥æˆåŠŸ', 'fa-user-secret', `ä½ çš„å¿ƒè…¹æˆåŠŸè·å¾—äº†ä¸€ä»½å…³äºå¤«å›æ”¿æ•Œçš„<strong class="value">[è´ªè…çº¿ç´¢]</strong>ï¼`);
                 }
            }
        }
    ];
    showDecisionCard('è¾…ä½å¤«å›', 'fa-user-tie', `ä½ æŸ¥é˜…å¤«å›çš„å®˜åœºå…³ç³»ç½‘ï¼Œå¹¶é€‰æ‹©æ€§åœ°è¿›è¡ŒæŠ•èµ„ã€‚`, options);
}

/**
 * å¤„ç†â€œè§„åˆ’å­å—£â€çš„é€»è¾‘
 */
function handlePlanOffspring() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) { showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚"); return; }
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²

    const adultChildren = gameState.children.filter(c => c.age >= 16 && !c.isDead);
    if (adultChildren.length === 0) {
        showToast("ä½ æš‚æ— å·²æˆå¹´çš„å­å¥³å¯è§„åˆ’ã€‚");
        return;
    }

    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨é€‰æ‹©å­å¥³åæ¶ˆè€—æ¬¡æ•° â–¼â–¼â–¼
    const childOptions = adultChildren.map(child => ({
        htmlContent: `<i class="fas fa-${child.gender}"></i> ${child.name} (${Math.floor(child.age)}å²)`,
        callback: () => {
            gameState.flags.actionUsed_household = (gameState.flags.actionUsed_household || 0) + 1;
            showOffspringPlanningOptions(child.id);
        }
    }));
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²

    showDecisionCard('è§„åˆ’å­å—£', 'fa-users-cog', 'é€‰æ‹©ä¸€ä½å­å¥³ä¸ºå…¶è§„åˆ’æœªæ¥ï¼š', childOptions);
}

function showOffspringPlanningOptions(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    let options = [];

    if (child.gender === 'male') {
        options.push({
            htmlContent: `<strong>å®‰æ’å®˜èŒ</strong><div><small>èŠ±è´¹5000ä¸¤ï¼Œå®¶æ—å£°æœ›-20</small></div>`,
            disabled: gameState.family.moneyChest < 5000,
            callback: () => {
                applyEffects({reputation: -20});
                gameState.family.moneyChest -= 5000;
                // ç®€åŒ–å¤„ç†ï¼Œç›´æ¥èµ‹äºˆèŒä¸š
                child.career = { path: 'civilian', name: 'æ–‡å®˜', level: 0, performance: 0, salary: 200 };
                showEventCard('å®‰æ’å®˜èŒ', 'fa-user-tie', `ä½ ä¸º ${child.name} æäº†ä¸€ä¸ªå®˜ï¼Œä»–ä»æ­¤è¿›å…¥ä»•é€”ï¼Œä½†èµ·ç‚¹è¾ƒä½ä¸”ä¼šè¢«æ¸…æµçœ‹ä¸èµ·ã€‚`);
            }
        });
    }

    options.push({
        htmlContent: `<strong>å¯»è§…è‰¯ç¼˜</strong><div><small>ä¸¾åŠèµèŠ±å®´ï¼Œè¿›è¡Œæˆ˜ç•¥è”å§»</small></div>`,
        callback: () => {
            // ç›´æ¥è°ƒç”¨å·²æœ‰çš„è®®äº²ç•Œé¢
            openChildMarriageMenu(child.id);
        }
    });

    options.push({
        htmlContent: `<strong>æŠ•èµ„äº§ä¸š</strong><div><small>èŠ±è´¹3000ä¸¤ï¼Œä¸ºå…¶è´­ç½®äº§ä¸š</small></div>`,
        disabled: gameState.family.moneyChest < 3000,
        callback: () => {
            gameState.family.moneyChest -= 3000;
            // ç®€åŒ–å¤„ç†ï¼Œç›´æ¥ç»™å­©å­åŠ é’±
            child.personalWealth = (child.personalWealth || 0) + 5000;
            showEventCard('æŠ•èµ„äº§ä¸š', 'fa-store', `ä½ ä¸º ${child.name} è´­ç½®äº†ä¸€é—´é“ºå­ï¼Œä»–/å¥¹ä»æ­¤æœ‰äº†ç‹¬ç«‹çš„ç»æµæ¥æºã€‚`);
        }
    });

    showDecisionCard(`ä¸º ${child.name} è§„åˆ’`, 'fa-users-cog', 'åˆ©ç”¨å®¶æ—èµ„æºï¼Œä¸ºTAçš„æœªæ¥é“ºè·¯ã€‚', options);
}

function handleAssertDominance() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) { showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚"); return; }
    gameState.flags.actionUsed_household = (gameState.flags.actionUsed_household || 0) + 1;
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    const targetOptions = concubines.map(conc => ({
        htmlContent: conc.name,
        callback: () => {
            applyEffects({attributes: {prestige: 10}, marriage: {favor: -10}});
            concubines.forEach(c => {
                c.ambition = Math.max(0, (c.ambition || 30) - 5);
            });
            showEventCard('æ•²å±±éœ‡è™', 'fa-gavel', `ä½ å¯»äº†ä¸ªç”±å¤´ï¼Œå…¬å¼€æƒ©ç½šäº† ${conc.name}ã€‚æ‰€æœ‰å¦¾å®¤çš„é‡å¿ƒæš‚æ—¶é™ä½ï¼Œä½ çš„å®¶å¨æå‡ï¼Œä½†å¤«å›å¯¹ä½ ç•¥æœ‰ä¸æ»¡ã€‚`);
        }
    }));
    showDecisionCard('é€‰æ‹©æƒ©ç½šå¯¹è±¡', 'fa-gavel', 'é€‰æ‹©ä¸€ä½å¦¾å®¤ä»¥å„†æ•ˆå°¤ã€‚', targetOptions);
}

function handleCarrotAndStick() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) { showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚"); return; }
    gameState.flags.actionUsed_household = (gameState.flags.actionUsed_household || 0) + 1;
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    showToast("åŠŸèƒ½å¼€å‘ä¸­ï¼šè°ƒæ•´å¦¾å®¤æœˆä¾‹ã€‚");
}

function handleUndermine() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) { showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚"); return; }
    gameState.flags.actionUsed_household = (gameState.flags.actionUsed_household || 0) + 1;
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    const targetOptions = concubines.map(conc => ({
        htmlContent: conc.name,
        callback: () => {
            gameState.flags.investigatingConcubine = { targetId: conc.id, turnsLeft: 2 };
            showEventCard('å¼€å§‹è°ƒæŸ¥', 'fa-search-minus', `ä½ å·²æ´¾å¿ƒè…¹æš—ä¸­è°ƒæŸ¥ ${conc.name} çš„èƒŒæ™¯ï¼Œé¢„è®¡2å›åˆåä¼šæœ‰ç»“æœã€‚`);
        }
    }));
    showDecisionCard('é€‰æ‹©è°ƒæŸ¥å¯¹è±¡', 'fa-search-minus', 'é€‰æ‹©ä¸€ä½å¦¾å®¤ï¼Œæ·±å…¥è°ƒæŸ¥å¥¹çš„èƒŒæ™¯ï¼Œå¯»æ‰¾å¥¹çš„å¼±ç‚¹ã€‚', targetOptions);
}

function showSecretNetworkUI() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) { showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚"); return; }
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    const hasLover = gameState.social.secretLovers.length > 0;
    const options = [
        {
            htmlContent: `<i class="fas fa-box-open"></i><span class="option-text"><strong>æš—åº¦é™ˆä»“</strong><div><small>ç§˜å¯†å°†å®¶åº“èµ„é‡‘æˆ–ç‰©å“è½¬ç§»ç»™æƒ…äºº</small></div></span>`,
            disabled: !hasLover,
            callback: () => handleFunnelResources() // æ¬¡æ•°æ£€æŸ¥ç§»åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°
        }
    ];
    showDecisionCard('ç§˜å¯†ç½‘ç»œæ·±åŒ–', 'fa-user-secret', 'æŒå®¶æƒå°†æˆä¸ºä½ ä»¬ç§æƒ…çš„æœ€ä½³ä¿æŠ¤ä¼ï¼Œç”šè‡³èƒ½åŠ©ä»–å¹³æ­¥-é’äº‘ã€‚', options);
}

function handleFunnelResources() {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) { showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚"); return; }
    gameState.flags.actionUsed_household = (gameState.flags.actionUsed_household || 0) + 1;
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    const loverId = gameState.social.secretLovers[0];
    const lover = gameState.npcs[loverId];
    if (!lover) return;
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const amountStr = prompt(`ä½ æ‰“ç®—ä»å®¶åº“ä¸­æŒªç”¨å¤šå°‘èµ„é‡‘ç»™ ${lover.name}ï¼Ÿ\n(å½“å‰å®¶åº“: ${gameState.family.moneyChest} ä¸¤)`, "1000");
    const amount = parseInt(amountStr);
    if(isNaN(amount) || amount <= 0 || amount > gameState.family.moneyChest) {
        showToast("è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢ä¸”å®¶åº“èµ„é‡‘éœ€è¶³å¤Ÿã€‚");
        return;
    }
    gameState.family.moneyChest -= amount;
    lover.wealth = (lover.wealth || 0) + amount;
    let log = `ä½ æˆåŠŸä»å®¶åº“ä¸­æŒªç”¨ <span class="value">${amount}</span> ä¸¤ï¼Œç§˜å¯†è½¬ç§»ç»™äº† ${lover.name}ã€‚`;
    const discoveryChance = 0.1 + ((husband.suspicionValue || 0) / 1000);
    if ((husband.attributes.strategy || 50) > gameState.player.attributes.wisdom && Math.random() < discoveryChance) {
        log += `<br><strong style="color:red;">ä½†æ­¤äº‹è¢«å¤«å›å¯Ÿè§‰ï¼Œç›´æ¥è§¦å‘äº†æœ€ç»ˆå¯¹å³™ï¼</strong>`;
        triggerInnerCourtEvent('ä¸€çº¸ä¼‘ä¹¦', true);
    }
    showEventCard('æš—åº¦é™ˆä»“', 'fa-box-open', log);
}
function showAuthorityActions_Male(type) {
    let title = '';
    let description = '';
    let options = [];
    const wife = gameState.npcs[gameState.marriage.spouseId];
    switch(type) {
        case 'personnel':
            title = 'äººäº‹æƒæŒ‡ä»¤';
            description = 'æ§åˆ¶ä¿¡æ¯æµåŠ¨ï¼Œæ¸…é™¤æ½œåœ¨å¨èƒã€‚';
            options = [
                { text: 'å®‰æ’çœ¼çº¿ (-200ä¸¤)', cost: 200, action: () => { 
                    applyEffects({wealth: -200, attributes:{prestige: -2}}); 
                    // æ­¤å¤„å¯ä»¥æ·»åŠ ä¸€ä¸ªbuffï¼Œç”¨äºé¢„è­¦äº‹ä»¶
                    return "ä½ æˆåŠŸåœ¨åºœä¸­å®‰æ’äº†çœ¼çº¿ï¼Œå¯ä»¥æå‰é¢„è­¦éƒ¨åˆ†äº‹ä»¶ã€‚";
                }},
                { text: 'æ”¶ä¹°ä¸‹äºº (-100-500ä¸¤)', cost: 100, action: () => { 
                    applyEffects({wealth: -getRandomInt(100,500), attributes:{virtue: -3}});
                    if(wife) wife.suspicionValue = Math.max(0, wife.suspicionValue - 5);
                    return "ä½ æˆåŠŸæ”¶ä¹°äº†ä¸€ä½å…³é”®ä¸‹äººï¼Œæš‚æ—¶å‹ä¸‹äº†ä¸€äº›å¯¹ä½ ä¸åˆ©çš„è¨€è®ºã€‚";
                }},
                { text: 'å‘å–/è°ƒç¦»ä¸‹äºº', cost: 0, action: () => {
                    applyEffects({attributes:{prestige: -5}});
                    if(wife && Math.random() < 0.2) wife.suspicionValue += 10;
                    return "ä½ æ‰¾äº†ä¸ªç”±å¤´å°†ä¸€ä¸ªçœ‹ä¸é¡ºçœ¼çš„ä¸‹äººè°ƒç¦»äº†ã€‚é¢‘ç¹æˆ–æ— ç†ç”±çš„è°ƒåŠ¨å¯èƒ½å¼•èµ·æ€€ç–‘ã€‚";
                }},
            ];
            break;
        case 'finance':
            title = 'è´¢åŠ¡æƒæŒ‡ä»¤';
            description = 'æ©ç›–èŠ±è´¹ï¼Œå¹¶ä¸ºå±æœºå…¬å…³æä¾›èµ„é‡‘ã€‚';
            options = [
                { text: 'è®¾ç«‹ç§åº“', req: { wisdom: 80 }, action: () => {
                    const amount = Math.floor(gameState.family.moneyChest * 0.1);
                    gameState.family.moneyChest -= amount;
                    applyEffects({privateAssets: amount});
                    // FIX: Changed 'gs' to 'gameState'
                    gameState.flags.privateChestEstablished = true;
                    return `ä½ ä»å®¶åº“ä¸­æŒªç”¨ ${amount} ä¸¤ï¼Œå»ºç«‹äº†â€œå°é‡‘åº“â€ï¼Œæå¤§é™ä½äº†é£é™©ã€‚`;
                }},
                { text: 'æ··æ·†è´¦ç›®', req: { strategy: 60 }, action: () => {
                    if(wife && (wife.attributes.wisdom || 60) > gameState.player.attributes.strategy && Math.random() < 0.3) {
                        gameState.flags.triggerLedgerScrutiny = true;
                        return "ä½ çš„æ“ä½œå¼•èµ·äº†å¦»å­çš„æ€€ç–‘ï¼Œå¥¹å¯èƒ½ä¼šåœ¨å¹´åº•å½»æŸ¥è´¦ç›®ï¼";
                    }
                    return "ä½ æˆåŠŸå°†ä¸€ç¬”ç»™æƒ…äººçš„èŠ±é”€ä¼ªè£…æˆå…¬è´¦æ”¯å‡ºã€‚";
                }},
                { text: 'å¢åŠ æ­£å¦»æœˆä¾‹', cost: 500, action: () => {
                    applyEffects({wealth: -500});
                    if(wife) { applyEffects({relationship: {targetId: wife.id, favor: 10}}); wife.suspicionValue -= 5; }
                    return "ä½ å¢åŠ äº†æ­£å¦»çš„æœˆé’±ï¼Œå¥¹ååˆ†é«˜å…´ï¼Œå¯¹ä½ çš„ç–‘å¿ƒä¹Ÿå‡å°‘äº†ã€‚";
                }},
            ];
            break;
        case 'procurement':
            title = 'é‡‡åŠæƒæŒ‡ä»¤';
            description = 'åˆ›é€ å¤–å‡ºçš„åˆç†å€Ÿå£ï¼Œå¹¶é€šè¿‡é‡‡åŠå®‰æŠšæ­£å¦»ã€‚';
            options = [
                { text: 'å€Ÿæ•…é‡‡åŠ', action: () => {
                    // å¢åŠ ä¸€ä¸ªbuffï¼Œé™ä½ä¸‹æ¬¡ç§ä¼šè¢«å‘ç°çš„å‡ ç‡
                    gameState.flags.procurementExcuse = true;
                    return "ä½ è·å¾—äº†ä¸€æ¬¡åˆç†çš„å¤–å‡ºæœºä¼šã€‚åœ¨æ­¤æœŸé—´ä¸æƒ…äººç§ä¼šï¼Œè¢«å‘ç°çš„å‡ ç‡é™ä½50%ã€‚";
                }},
                { text: 'æŠ•å…¶æ‰€å¥½ (-800ä¸¤)', cost: 800, action: () => {
                    applyEffects({wealth: -800});
                    if(wife) { applyEffects({relationship: {targetId: wife.id, favor: 15}}); wife.suspicionValue -= 8; }
                    return "ä½ å€Ÿé‡‡åŠä¹‹åï¼Œè´­ä¹°äº†æ­£å¦»å¿ƒä»ªå·²ä¹…çš„ç‰©å“ï¼Œå¥¹æƒŠå–œä¸å·²ã€‚";
                }},
            ];
            break;
    }
    const decisionOptions = options.map(opt => ({
        htmlContent: `<span class="option-text">${opt.text}</span>`,
        disabled: (opt.cost && gameState.finances.wealth < opt.cost) || (opt.req && !checkSuccess(gameState.player.attributes[Object.keys(opt.req)[0]], Object.values(opt.req)[0])),
        callback: () => {
            const resultLog = opt.action();
            showEventCard(title, 'fa-key', resultLog);
        }
    }));
    showDecisionCard(title, 'fa-key', description, decisionOptions);
}
/**
 * ã€ç”·æ€§ç©å®¶ã€‘æ˜¾ç¤ºç®¡ç†å¦¾å®¤çš„ç•Œé¢
 */
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * ã€ç”·æ€§ç©å®¶ã€‘æ˜¾ç¤ºç®¡ç†å¦¾å®¤çš„ç•Œé¢
 */
// ===================== ã€ç¬¬2æ­¥ï¼šæ›¿æ¢æ­¤å‡½æ•°ã€‘ =====================
/**
 * ã€ç”·æ€§ç©å®¶ã€‘æ˜¾ç¤ºç®¡ç†å¦¾å®¤çš„ç•Œé¢
 */
function showConcubineManagementUI() {
    const concubines = gameState.marriage.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    if (concubines.length === 0) {
        showToast("ä½ å°šæ— å¦¾å®¤å¯ç®¡ç†ã€‚");
        // å¦‚æœæ²¡æœ‰å¦¾å®¤äº†ï¼Œå°±å…³é—­çª—å£
        closeAllOverlays();
        return;
    }
    let html = concubines.map(conc => {
        // ===================== ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸ STARTã€‘ =====================
        // ç¡®ä¿æ–°çº³çš„å¦¾å®¤ä¹Ÿæœ‰é»˜è®¤ä½ä»½
        if (typeof conc.rankIndex === 'undefined') conc.rankIndex = 0;
        const rankName = CONCUBINE_RANKS[conc.rankIndex].name;
        // ===================== ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸ ENDã€‘ =====================

        return `
            <div class="concubine-card">
             <div class="concubine-name"><i class="fas fa-female"></i> ${conc.name} (${rankName})</div>
                <div class="concubine-details">
                    <p>æ©çˆ±: ${conc.favor} | é‡å¿ƒ: ${conc.ambition || 30} | å–„å¦’: ${conc.jealousy || 30}</p>
                    <div class="options" style="flex-direction:row; flex-wrap:wrap; margin-top:10px;">
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction('${conc.id}', 'promote')">æå‡ä½ä»½</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction('${conc.id}', 'demote')">é™ä½ä½ä»½</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction('${conc.id}', 'reward')">èµèµ</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction('${conc.id}', 'punish')">ç½šä¿¸</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction('${conc.id}', 'ground')">ç¦è¶³</button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    // ä½¿ç”¨ showDecisionCard æ¥æ˜¾ç¤ºï¼Œè¿™æ ·å¯ä»¥ä¿æŒå¼¹çª—é£æ ¼ç»Ÿä¸€
    showDecisionCard('ç®¡ç†å¦¾å®¤', 'fa-users-cog', html, []);
}
/**
 * ã€ç”·æ€§ç©å®¶ã€‘å¤„ç†å¦¾å®¤ç®¡ç†æŒ‡ä»¤
 */
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * ã€ç”·æ€§ç©å®¶ã€‘å¤„ç†å¦¾å®¤ç®¡ç†æŒ‡ä»¤
 */
// ===================== ã€ç¬¬3æ­¥ï¼šæ›¿æ¢æ­¤å‡½æ•°ã€‘ =====================
/**
 * ã€ç”·æ€§ç©å®¶ã€‘å¤„ç†å¦¾å®¤ç®¡ç†æŒ‡ä»¤
 */
function manageConcubineAction(concubineId, action) {
    const conc = gameState.npcs[concubineId];
    if(!conc) return;

    if (typeof conc.rankIndex === 'undefined') conc.rankIndex = 0;
    if (typeof conc.punishmentCount === 'undefined') conc.punishmentCount = 0;
    let resultLog = '';
    const currentRank = CONCUBINE_RANKS[conc.rankIndex];

    switch(action) {
        case 'promote':
            if (conc.rankIndex < CONCUBINE_RANKS.length - 1) {
                const nextRank = CONCUBINE_RANKS[conc.rankIndex + 1];
                const hasChild = gameState.children.some(c => c.motherId === conc.id);
                if (conc.favor >= currentRank.promotionFavorReq && (!currentRank.promotionChildReq || hasChild)) {
                    
                    const oldRank = CONCUBINE_RANKS[conc.rankIndex];
                    conc.rankIndex++; 
                    const newRank = CONCUBINE_RANKS[conc.rankIndex];
                    conc.favor += newRank.favorBonus;

                    // è°ƒç”¨æ–°å¢çš„å†Œå°ä»ªå¼å‡½æ•°
                    showPromotionCeremony(conc, oldRank, newRank);
                    return; // æå‰ç»“æŸå‡½æ•°ï¼Œä¸å†æ‰§è¡Œä¸‹é¢çš„æ—§å¼¹çª—

                } else {
                    let reason = '';
                    if (conc.favor < currentRank.promotionFavorReq) reason += `æ©å® éœ€è¾¾åˆ°${currentRank.promotionFavorReq} `;
                    if (currentRank.promotionChildReq && !hasChild) reason += `ä¸”éœ€è¯ä¸‹å­å—£`;
                    resultLog = `${conc.name} çš„æ¡ä»¶ä¸è¶³ä»¥æ™‹å‡ã€‚(${reason.trim()})`;
                }
            } else {
                resultLog = `${conc.name} å·²æ˜¯æœ€é«˜ä½ä»½ã€‚`;
            }
            break;
        case 'demote':
            if (conc.rankIndex > 0) {
                const oldRank = CONCUBINE_RANKS[conc.rankIndex];
                conc.rankIndex--;
                const newRank = CONCUBINE_RANKS[conc.rankIndex];

                conc.punishmentCount++;
                applyEffects({ relationship: { targetId: conc.id, favor: -15 } });

                // è°ƒç”¨æ–°å¢çš„é™ä½ä»ªå¼å‡½æ•°
                showDemotionCeremony(conc, oldRank, newRank);
                return; // æå‰ç»“æŸï¼Œä¸å†æ‰§è¡Œä¸‹é¢çš„æ—§å¼¹çª—

            } else {
                resultLog = `${conc.name} å·²æ˜¯æœ€ä½ä½ä»½ã€‚`;
            }
            break;
        case 'reward':
            showRewardConcubineOverlay(conc.id);
            return; 
        case 'punish':
            conc.isPunishedWithSalary = true;
            conc.punishmentCount++;
            applyEffects({relationship:{targetId: conc.id, favor: -10}});
            resultLog = `ä½ ç½šæ²¡äº† ${conc.name} ä»Šå¹´çš„ä»½ä¾‹ï¼Œå¥¹å¯¹ä½ å¥½æ„Ÿä¸‹é™ã€‚`;
            break;
        case 'ground':
            conc.isGrounded = true;
            conc.groundedTurns = 2;
            conc.punishmentCount++;
            conc.ambition = Math.max(0, (conc.ambition || 30) - 10);
            resultLog = `ä½ ä¸‹ä»¤å°† ${conc.name} ç¦è¶³ä¸€å¹´ï¼ŒæœŸé—´æ— æ³•äº’åŠ¨ï¼Œå¥¹çš„é‡å¿ƒæœ‰æ‰€æ”¶æ•›ã€‚`;
            break;
    }
    // åªæœ‰éæ™‹å‡/é™ä½ç­‰æœ‰ä¸“é—¨ä»ªå¼çš„æ“ä½œæ‰ä¼šèµ°åˆ°è¿™é‡Œ
    showEventCard('å¦¾å®¤ç®¡ç†', 'fa-users-cog', resultLog);
    showConcubineManagementUI();
}
// ===================== ã€æ–°å¢ã€‘æ‰€æœ‰æ–°åŠŸèƒ½ç›¸å…³å‡½æ•° =====================

// ------------------- æ€€å­•ä¸æ¸©å­˜é€»è¾‘ -------------------
function triggerBirth(partnerId, isSecret = false) {
    const partner = gameState.npcs[partnerId];
    if (!partner) return;

    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ£€æŸ¥å…¨å±€æ€€å­•æ ‡å¿—
    if (gameState.flags.isAnyonePregnant) {
        logEvent('åºœä¸­å·²æœ‰å–œè„‰ï¼Œæœªèƒ½æœ‰å­•ã€‚');
        return;
    }

    logEvent(`<div class="intimate-scene"><i class="fas fa-moon"></i> å¤œè‰²æ·±æ²‰ï¼Œçº¢çƒ›æ‘‡æ›³...</div>`);

    const totalCapacity = gameState.finances.assets.filter(c => c.type === 'residence').reduce((sum, r) => sum + r.capacity, 5);
    const currentOccupants = 1 + (gameState.marriage.isMarried ? 1 : 0) + gameState.marriage.concubines.length + gameState.children.filter(c=>!c.isDead).length;
    if (currentOccupants >= totalCapacity) { showToast("å®¶ä¸­å·²æ— å¤„å¯ä½ï¼Œæ— æ³•å†æ·»ä¸äº†ã€‚è¯·å…ˆè´­ç½®æ›´å¤§çš„åºœé‚¸ã€‚"); return; }

    const motherNPC = gameState.player.gender === 'female' ? gameState.player : partner;
    const fatherNPC = gameState.player.gender === 'male' ? gameState.player : partner;

    const playerChildrenCount = gameState.children.filter(c => (c.motherId === 'player' || c.fatherId === 'player') && !c.isDead).length;

    if (playerChildrenCount >= 10) { showToast("ä½ å·²è‚²æœ‰åä¸ªå­©å­ï¼Œéš¾ä»¥å†æœ‰å­•ã€‚"); return; }
    if (gameState.player.gender === 'male' && partner.relationship === 'concubine' && gameState.children.filter(c => c.motherId === partnerId).length >= 3) { showToast(`å¦¾å®¤${partner.name}å·²è¯ä¸‹ä¸‰èƒï¼Œå†éš¾æœ‰å­•ã€‚`); return; }
    if (motherNPC.isPregnant) {
        showToast(`${motherNPC.name}å·²èº«æ€€å…­ç”²ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚`);
        return;
    }

    let baseConceptionChance = 0.35;
    if (motherNPC.age > 35) baseConceptionChance *= 0.5;
    if (motherNPC.age > 45) baseConceptionChance *= 0.3;
    if (motherNPC.age > 55) baseConceptionChance = 0.1;
    if (motherNPC.age >= 70) baseConceptionChance = 0;

    if (playerChildrenCount >= 7) baseConceptionChance *= 0.7;

    if (Math.random() < baseConceptionChance) {
        motherNPC.isPregnant = true;
        motherNPC.pregnancyTurnsLeft = 2; 
        motherNPC.isSecretPregnancy = isSecret;
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘è®¾ç½®å…¨å±€æ€€å­•æ ‡å¿—
        gameState.flags.isAnyonePregnant = true;
        logEvent(`<strong class="highlight-npc">${motherNPC.name}</strong>å·²èº«æ€€å…­ç”²ï¼Œä½ å¯¹æ–°ç”Ÿå‘½çš„åˆ°æ¥å……æ»¡æœŸå¾…ã€‚`);
    } else {
        logEvent(`ä¼¼ä¹å¤©æ„æœªè‡³ï¼Œ<strong class="highlight-npc">${motherNPC.name}</strong>æœ¬å›åˆæœªèƒ½æ€€ä¸Šã€‚`);
    }
    renderGame();
}

function pregnancyCheck(motherId, isSecret) {
    const mother = motherId === 'player' ? gameState.player : gameState.npcs[motherId];
    if (mother && mother.isPregnant) {
        mother.pregnancyTurnsLeft--;
        if (mother.pregnancyTurnsLeft <= 0) {
            // å°†åˆ†å¨©äº‹ä»¶æ¨å…¥äº‹ä»¶é˜Ÿåˆ—çš„æœ€å‰ç«¯ï¼Œç¡®ä¿å®ƒæœ€å…ˆæ‰§è¡Œ
            eventQueue.unshift(() => {
                handleBirthEvent(motherId, mother.isSecretPregnancy);
                // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åˆ†å¨©åé‡ç½®å…¨å±€æ ‡å¿—
                gameState.flags.isAnyonePregnant = false;
            });
            
            // æ¸…ç†æ€€å­•çŠ¶æ€
            delete mother.isPregnant;
            delete mother.pregnancyTurnsLeft;
            delete mother.miscarriageChance;
            delete mother.isSecretPregnancy;
            
            // è¿”å›trueï¼Œå‘Šè¯‰ä¸»å¾ªç¯æœ¬å›åˆæœ‰é‡å¤§äº‹ä»¶å‘ç”Ÿ
            return true; 
        }
    }
    // æ²¡æœ‰åˆ†å¨©äº‹ä»¶å‘ç”Ÿ
    return false;
}
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘triggerSpouseIntimacyEvent å‡½æ•° START =====================
function triggerSpouseIntimacyEvent(spouseId) {
    // 1. æ£€æŸ¥å¹¶æ¶ˆè€—å…¨å±€æ¸©å­˜æ¬¡æ•°
    if ((gameState.flags.intimacyActionsUsedThisTurn || 0) >= 2) {
        showToast("ä½ ç²¾åŠ›æœ‰é™ï¼Œæœ¬å›åˆæ¸©å­˜æ¬¡æ•°å·²ç”¨å°½ã€‚");
        return;
    }
    const spouse = gameState.npcs[spouseId];
    if (!spouse) return;

    // 2. æ ¹æ®ç©å®¶æ€§åˆ«é€‰æ‹©å¯¹åº”çš„äº‹ä»¶åº“
     const eventPool = gameState.player.gender === 'female' ? SPOUSE_INTIMACY_EVENTS.husband : SPOUSE_INTIMACY_EVENTS.wife;
    if (!eventPool || eventPool.length === 0) {
        showToast("æš‚æ— æ›´å¤šäº’åŠ¨å‰§æƒ…ã€‚");
        return;
    }
    const event = getRandomElement(eventPool);

    // 3. æ„å»ºå¹¶æ˜¾ç¤ºé€‰é¡¹
    const options = event.options.map(opt => {
        let canChoose = true;
        let reason = '';
        // æ£€æŸ¥æˆæœ¬
        if (opt.cost && gameState.finances.wealth < opt.cost) {
            canChoose = false;
            reason = `(ç§äº§ä¸è¶³ ${opt.cost} ä¸¤)`;
        }
        // æ£€æŸ¥å±æ€§è¦æ±‚
        if (opt.req) {
            for (const attr in opt.req) {
                if ((gameState.player.attributes[attr] || 0) < opt.req[attr]) {
                    canChoose = false;
                    reason = `(${ATTR_MAP[attr] || attr}éœ€â‰¥${opt.req[attr]})`;
                    break;
                }
            }
        }
        return {
            htmlContent: `<span class="option-text">${opt.text} ${reason}</span>`,
            disabled: !canChoose,
            callback: () => {
                // 4. åœ¨å›è°ƒå‡½æ•°ä¸­å¤„ç†æ‰€æœ‰é€»è¾‘
                // a. å¢åŠ äº’åŠ¨è®¡æ•°
                gameState.flags.intimacyActionsUsedThisTurn = (gameState.flags.intimacyActionsUsedThisTurn || 0) + 1;
                // b. æ‰£é™¤æˆæœ¬
                if (opt.cost) applyEffects({ wealth: -opt.cost });
                // c. åº”ç”¨æ•ˆæœ
                if (opt.effects) {
                    let effectsToApply = { relationship: { targetId: spouseId, favor: opt.effects.favor || 0 } };
                    if (opt.effects.health) effectsToApply.attributes = { health: opt.effects.health };
                    if (opt.effects.virtue) effectsToApply.attributes = { ...(effectsToApply.attributes || {}), virtue: opt.effects.virtue };
                    applyEffects(effectsToApply);
                }
                // d. æ˜¾ç¤ºç»“æœ
                showEventCard(event.title, 'fa-heart', opt.log);
                // e. ã€é‡è¦ã€‘ä¿ç•™æ€€å­•åˆ¤å®šåŠŸèƒ½
                const motherId = gameState.player.gender === 'female' ? 'player' : spouseId;
                triggerBirth(motherId, false);
                // f. åˆ·æ–°æ¸¸æˆç•Œé¢
                renderGame();
            }
        };
    });

    // 5. æ˜¾ç¤ºå†³ç­–å¼¹çª—
    showDecisionCard(event.title, 'fa-moon', event.desc, options);
}
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘handleIntimateInteraction å‡½æ•° START =====================
function handleIntimateInteraction(npcId) {
    // 1. æ£€æŸ¥å…¨å±€æ¸©å­˜æ¬¡æ•°
    if ((gameState.flags.intimacyActionsUsedThisTurn || 0) >= 2) {
        showToast("ä½ ç²¾åŠ›æœ‰é™ï¼Œæœ¬å›åˆæ¸©å­˜æ¬¡æ•°å·²ç”¨å°½ã€‚");
        return;
    }
    const npc = gameState.npcs[npcId];
    if (!npc) return;
    // 2. æ£€æŸ¥ç¦è¶³çŠ¶æ€
    if (npc.isGrounded) {
        showToast(`${npc.name}æ­£åœ¨ç¦è¶³ä¸­ï¼Œæ— æ³•äº’åŠ¨ã€‚`);
        return;
    }
    // 3. å¢åŠ äº’åŠ¨è®¡æ•°
    gameState.flags.intimacyActionsUsedThisTurn = (gameState.flags.intimacyActionsUsedThisTurn || 0) + 1;
    
    // 4. ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ­¤å¤„ä¸ºä¸å¦¾å®¤çš„ç®€åŒ–äº’åŠ¨é€»è¾‘ (ä¿ç•™åŸæœ‰åŠŸèƒ½)
    let text = "";
    let favorChange = 0;
    let healthChange = 0;
    let harmonyChange = 0;
    const personality = npc.personality && npc.personality.length > 0 ? npc.personality[0] : 'æ¸©æŸ”';
    const favor = npc.favor || 0;

    if (personality === 'æ¸©é¡º' || personality === 'æ¸©æŸ”') {
        text = `å¤œè‰²æ·±æ²‰ï¼Œå¥¹ä¸ºä½ ç«¯æ¥ä¸€ç¢—è²å­ç¾¹ï¼ŒæŸ”å£°é“ï¼šâ€œå¤«å›è¾›è‹¦äº†ã€‚â€ä½ å¿ƒä¸­ä¸€æš–ã€‚`;
        favorChange = 3;
        healthChange = 2;
    } else if ((personality === 'å–„å¦’' || personality === 'æ´»æ³¼') && npc.jealousy > 50) {
        text = `ä½ èµ°è¿›æˆ¿ä¸­ï¼Œå¥¹å´å†·ç€è„¸ï¼Œè¨€è¯­é—´å¤¹æªå¸¦æ£’ï¼Œå¥å¥ä¸ç¦»å…¶ä»–å§å¦¹ã€‚`;
        favorChange = -2;
        harmonyChange = -1;
    } else if ((personality === 'æ‰æƒ…' || personality === 'èªæ…§') && favor > 60) {
        text = `ä½ ä»¬æœˆä¸‹å¯¹å¼ˆï¼Œæ£‹é€¢å¯¹æ‰‹ï¼Œç›¸è§†ä¸€ç¬‘ï¼Œåªè§‰çŸ¥å·±éš¾è§…ã€‚`;
        favorChange = 5;
        applyEffects({ attributes: { talent: 1 } });
    } else {
        text = `ä½ ä»¬å…±åº¦äº†ä¸€ä¸ªå¹³é™çš„å¤œæ™šã€‚`;
        favorChange = 2;
    }

    let resultText = `<div class="intimate-scene"><i class="fas fa-moon"></i> ${text}</div>`;
    applyEffects({ relationship: { targetId: npcId, favor: favorChange } });
    if (healthChange !== 0) applyEffects({ attributes: { health: healthChange } });
    gameState.marriage.familyHarmony = Math.max(0, Math.min(100, gameState.marriage.familyHarmony + harmonyChange));
    resultText += `</br>æ©çˆ±å€¼ ${favorChange >= 0 ? '+' : ''}${favorChange}ã€‚`;
    if (healthChange > 0) resultText += `å¥åº· +${healthChange}ã€‚`;
    if (harmonyChange !== 0) resultText += `å®¶å®…å’Œè°åº¦ ${harmonyChange}ã€‚`;
    
    // 5. ã€é‡è¦ã€‘ä¿ç•™å¦¾å®¤çš„æ€€å­•åˆ¤å®šåŠŸèƒ½
    triggerBirth(npcId, false);
    
    showEventCard('æ¸©å­˜', 'fa-heart', resultText);
    renderGame();
}
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘handleIntimateInteraction å‡½æ•° END =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘handleIntimateInteraction å‡½æ•° END =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘handleIntimateInteraction å‡½æ•° END =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘handleIntimateInteraction å‡½æ•° END =====================
/**
 * ã€æ–°å¢ã€‘ä¸ºå¥³æ€§ç©å®¶å¤„ç†å¦¾å®¤ç®¡ç†æŒ‡ä»¤
 */
// ===================== ã€ç¬¬1æ­¥ï¼šæ–°å¢è¿™ä¸¤ä¸ªå‡½æ•°ã€‘ =====================
/**
 * [æ–°å¢] æ˜¾ç¤ºå¦¾å®¤æ™‹å‡çš„å†Œå°ä»ªå¼å¼¹çª—
 * @param {object} concubine - æ™‹å‡çš„å¦¾å®¤å¯¹è±¡
 * @param {object} oldRank - æ—§çš„ä½ä»½æ•°æ®
 * @param {object} newRank - æ–°çš„ä½ä»½æ•°æ®
 */
function showPromotionCeremony(concubine, oldRank, newRank) {
    const content = `
        <p>å‰æ—¶å·²åˆ°ï¼Œä½ äºæ­£å…ä¹‹ä¸­å®£è¯»è°•ä»¤ï¼š</p>
        <blockquote style="text-align:center; font-style:italic;">
            â€œå¦¾ ${concubine.name}ï¼Œæ€§èµ„æ•æ…§ï¼ŒæŒèº¬æ·‘æ…...<br>ä»Šç‰¹æ™‹å…¶ä½ä»½ä¸º <strong class="value">${newRank.name}</strong>ï¼Œé’¦æ­¤ã€‚â€
        </blockquote>
        <p>${concubine.name} é—»è¨€ï¼Œå–œä¸è‡ªèƒœï¼Œè¿å¿™è·ªä¸‹è°¢æ©ï¼šâ€œè°¢ä¸»å›éš†æ©ï¼Œå¦¾èº«å®šå½“å°½å¿ƒä¾å¥‰ï¼Œä¸è´Ÿæ©æ³½ï¼â€</p>
        <hr style="margin: 10px 0; border-top: 1px dashed var(--border-color-light);">
        <p>æ©çˆ±å€¼ +${newRank.favorBonus}ï¼Œæ¯å¹´ä»½ä¾‹æå‡è‡³ <span class="value">${newRank.allowance}</span> ä¸¤ã€‚</p>
    `;
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç‚¹å‡»â€œçŸ¥é“äº†â€æŒ‰é’®åï¼Œä¼šå›è°ƒå¹¶åˆ·æ–°ç®¡ç†ç•Œé¢
    showEventCard('æ™‹å°ä¹‹å–œ', 'fa-crown', content, [{ text: 'ç¤¼æˆ', callback: showConcubineManagementUI }]);
}

/**
 * [æ–°å¢] æ˜¾ç¤ºå¦¾å®¤é™ä½çš„æ–¥é™å‰§æƒ…å¼¹çª—
 * @param {object} concubine - é™ä½çš„å¦¾å®¤å¯¹è±¡
 * @param {object} oldRank - æ—§çš„ä½ä»½æ•°æ®
 * @param {object} newRank - æ–°çš„ä½ä»½æ•°æ®
 */
function showDemotionCeremony(concubine, oldRank, newRank) {
    const content = `
        <p>ä½ äºæ­£å…ä¹‹ä¸­ï¼Œé¢è‰²å†·å³»åœ°å®£å¸ƒäº†å†³å®šï¼š</p>
        <blockquote style="text-align:center; font-style:italic;">
            â€œå¦¾ ${concubine.name}ï¼Œè¡Œäº‹ä¸ç«¯ï¼Œæœ‰è´Ÿæ©æ³½...<br>å³æ—¥èµ·ï¼Œé™å…¶ä½ä»½ä¸º <strong class="value">${newRank.name}</strong>ï¼Œä»¥å„†æ•ˆå°¤ï¼â€
        </blockquote>
        <p>${concubine.name} é—»è¨€ï¼Œé¢å¦‚æ­»ç°ï¼Œè·ªå€’åœ¨åœ°ï¼Œçœ¼ä¸­æ»¡æ˜¯æ€¨æ€¼ä¸ä¸ç”˜ã€‚</p>
        <hr style="margin: 10px 0; border-top: 1px dashed var(--border-color-light);">
        <p>æ©çˆ±å€¼ -15ï¼Œæ¯å¹´ä»½ä¾‹é™è‡³ <span class="value">${newRank.allowance}</span> ä¸¤ã€‚</p>
    `;
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç‚¹å‡»â€œçŸ¥é“äº†â€æŒ‰é’®åï¼Œä¼šå›è°ƒå¹¶åˆ·æ–°ç®¡ç†ç•Œé¢
    showEventCard('æ–¥é™ä¹‹ç½š', 'fa-gavel', content, [{ text: 'é€€ä¸‹', callback: showConcubineManagementUI }]);
}
function manageConcubineAction_Female(concubineId, action) {
    const conc = gameState.npcs[concubineId];
    if(!conc) return;
    const authority = gameState.marriage.householdAuthority.progress || 0;
    let resultLog = '';
    
    // æ£€æŸ¥æƒé™
    if (authority < 30) {
        showToast("æŒå®¶æƒä¸è¶³ï¼Œä½ çš„æŒ‡ä»¤æ— æ³•ç”Ÿæ•ˆã€‚");
        return;
    }
    const ranks = ['ä¾å¦¾', 'è‰¯å¨£', 'è´µå«”'];
    let currentRankIndex = ranks.indexOf(conc.rank || 'ä¾å¦¾');
    switch(action) {
        case 'promote':
            if (authority < 80) { resultLog = `ä½ çš„æŒå®¶æƒä¸è¶³ä»¥å†Œå°ä½ä»½ (éœ€80ç‚¹)ã€‚`; break; }
            if (currentRankIndex < ranks.length - 1) {
                conc.rank = ranks[currentRankIndex + 1];
                resultLog = `ä½ å°† ${conc.name} çš„ä½ä»½æå‡ä¸º ${conc.rank}ï¼Œä»¥å½°å…¶å¾·ã€‚`;
            } else {
                resultLog = `${conc.name} å·²æ˜¯æœ€é«˜ä½ä»½ã€‚`;
            }
            break;
        case 'demote':
            if (authority < 90) { resultLog = `ä½ çš„æŒå®¶æƒä¸è¶³ä»¥è¤«å¤ºä½ä»½ (éœ€90ç‚¹)ã€‚`; break; }
            if (currentRankIndex > 0) {
                conc.rank = ranks[currentRankIndex - 1];
                resultLog = `ä½ å°† ${conc.name} çš„ä½ä»½é™ä½ä¸º ${conc.rank}ï¼Œä»¥å„†æ•ˆå°¤ã€‚`;
            } else {
                resultLog = `${conc.name} å·²æ˜¯æœ€ä½ä½ä»½ã€‚`;
            }
            break;
        case 'reward':
            if (gameState.family.moneyChest < 100) { showToast("å®¶åº“èµ„é‡‘ä¸è¶³ä»¥èµèµã€‚"); return; }
            gameState.family.moneyChest -= 100;
            applyEffects({relationship: {targetId: conc.id, favor: 5}});
            resultLog = `ä½ ä»å®¶åº“ä¸­æ”¯å–100ä¸¤èµèµäº† ${conc.name}ã€‚`;
            break;
        case 'punish':
            if (authority < 50) { resultLog = `ä½ çš„æŒå®¶æƒä¸è¶³ä»¥ç½šä¿¸ï¼Œåªæ˜¯å£å¤´è­¦å‘Šäº† ${conc.name}ã€‚`; break; }
            applyEffects({relationship: {targetId: conc.id, favor: -8}});
            resultLog = `ä½ ä¸‹ä»¤ç½šæ²¡äº† ${conc.name} çš„æœˆä¿¸ï¼Œå¥¹å¯¹ä½ å¥½æ„Ÿä¸‹é™ã€‚`;
            break;
        case 'ground':
            if (authority < 70) { resultLog = `ä½ çš„æŒå®¶æƒä¸è¶³ä»¥ç¦è¶³ï¼Œ${conc.name} å¯¹ä½ çš„å‘½ä»¤é˜³å¥‰é˜´è¿ã€‚`; break; }
            conc.ambition = Math.max(0, (conc.ambition || 30) - 8);
            resultLog = `ä½ ä¸‹ä»¤å°† ${conc.name} ç¦è¶³ä¸€æœˆï¼Œå¥¹çš„é‡å¿ƒæœ‰æ‰€æ”¶æ•›ã€‚`;
            break;
    }
    showEventCard('å¦¾å®¤ç®¡ç†', 'fa-users-cog', resultLog);
    showConcubineManagementUI_Female(); // åˆ·æ–°ç®¡ç†ç•Œé¢
}

/**
 * ã€æ–°å¢ã€‘ä¸ºå¥³æ€§ç©å®¶æ˜¾ç¤ºç®¡ç†å¦¾å®¤çš„ç•Œé¢
 */
function showConcubineManagementUI_Female() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband ? husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead) : [];
    if (concubines.length === 0) {
        showToast("å¤«å›å°šæ— å¦¾å®¤å¯ç®¡ç†ã€‚");
        return;
    }
    const authority = gameState.marriage.householdAuthority.progress || 0;
    
    let html = `<p class="comment" style="text-align:center;">ä½ å½“å‰çš„æŒå®¶æƒä¸º <strong class="value">${authority}%</strong>ï¼Œè¿™å†³å®šäº†ä½ æŒ‡ä»¤çš„æ•ˆåŠ›ã€‚</p>`;
    html += concubines.map(conc => {
        return `
            <div class="concubine-card">
                <div class="concubine-name"><i class="fas fa-female"></i> ${conc.name} (${conc.rank || 'ä¾å¦¾'})</div>
                <div class="concubine-details">
                    <p>æ©å® : ${conc.favor} | é‡å¿ƒ: ${conc.ambition || 30}</p>
                    <div class="options" style="flex-direction:row; flex-wrap:wrap; margin-top:10px;">
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'promote')">æå‡ä½ä»½</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'demote')">é™ä½ä½ä»½</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'reward')">èµèµ</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'punish')">ç½šä¿¸</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'ground')">ç¦è¶³</button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    showDecisionCard('ç®¡ç†å¦¾å®¤', 'fa-users-cog', html, []);
}
// ------------------- å¦¾å®¤ç®¡ç†ä¸ç§é€ƒé€»è¾‘ -------------------
function showRewardConcubineOverlay(concubineId) {
    const concubine = gameState.npcs[concubineId];
    if (!concubine) return;

    const ts = gameState.tradingSystem;
    const warehouse = ts.warehouse;
    if (warehouse.length === 0) {
        showToast("ä½ çš„å•†ä¼šä»“åº“ä¸­æ²¡æœ‰ä»»ä½•ç‰©å“å¯ä»¥èµèµã€‚");
        return;
    }

    // éšæœºæŒ‘é€‰æœ€å¤š5ä»¶ç‰©å“ä½œä¸ºèµèµé€‰é¡¹
    const shuffled = [...warehouse].sort(() => 0.5 - Math.random());
    const options = shuffled.slice(0, 5);

    let itemsHTML = options.map(item => {
        const itemDef = TRADING_GOODS_DATA[item.id];
        return `
            <div class="marketplace-item">
                <span><strong>${itemDef.name}</strong> <small>(${itemDef.type})</small></span>
                <button class="control-btn" style="padding: 8px 12px; font-size: 0.9rem;" 
                        onclick="confirmRewardConcubine('${concubineId}', '${item.instanceId}')">èµèµæ­¤ç‰©</button>
            </div>
        `;
    }).join('');

    const content = `
        <p>ä»ä½ çš„å•†ä¼šä»“åº“ä¸­é€‰æ‹©ä¸€ä»¶ç‰©å“èµèµç»™ <strong class="highlight-npc">${concubine.name}</strong>ï¼š</p>
        <div style="max-height: 50vh; overflow-y: auto;">${itemsHTML}</div>
    `;
    showDecisionCard(`èµèµ ${concubine.name}`, 'fa-gift', content, []);
}

function confirmRewardConcubine(concubineId, instanceIdStr) {
    const instanceId = parseInt(instanceIdStr);
    const concubine = gameState.npcs[concubineId];
    const itemIndex = gameState.tradingSystem.warehouse.findIndex(i => i.instanceId === instanceId);
    if (!concubine || itemIndex === -1) {
        showToast("æ“ä½œå¤±è´¥ï¼Œç‰©å“æˆ–äººç‰©ä¸å­˜åœ¨ã€‚");
        return;
    }

    const item = gameState.tradingSystem.warehouse[itemIndex];
    const itemDef = TRADING_GOODS_DATA[item.id];

    // 1. ä»ä»“åº“ç§»é™¤ç‰©å“
    gameState.tradingSystem.warehouse.splice(itemIndex, 1);

    // 2. æ ¹æ®ç‰©å“ä»·å€¼è®¡ç®—å¥½æ„Ÿåº¦
    const favorGain = Math.ceil(item.buyPrice / 15) + getRandomInt(3, 8);
    applyEffects({ relationship: { targetId: concubineId, favor: favorGain } });

    // 3. æ˜¾ç¤ºç»“æœ
    showEventCard('èµèµæˆåŠŸ', 'fa-gift', 
        `ä½ å°†ã€${itemDef.name}ã€‘èµèµç»™äº† ${concubine.name}ï¼Œå¥¹å–œä¸è‡ªèƒœï¼Œå¯¹ä½ æ›´åŠ å¿ å¿ƒã€‚<br>å¥½æ„Ÿåº¦ +${favorGain}ã€‚`
    );

    // åˆ·æ–°ç®¡ç†ç•Œé¢
    closeAllOverlays();
    showConcubineManagementUI();
}

function checkConcubineRunaway() {
    if (gameState.player.gender !== 'male' || gameState.marriage.concubines.length === 0) return;

    const concubines = gameState.marriage.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);

    for (const conc of concubines) {
        if (conc.isGrounded) {
            conc.groundedTurns--;
            if (conc.groundedTurns <= 0) {
                conc.isGrounded = false;
                logEvent(`å¦¾å®¤ ${conc.name} çš„ç¦è¶³å·²ç»“æŸã€‚`);
            }
        }

        // è®¡ç®—ç§é€ƒå€¾å‘
        let runawayChance = 0;
        if (conc.favor < 10) runawayChance += 0.1;
        if (conc.favor < -20) runawayChance += 0.15;
        if (conc.rankIndex === 0) runawayChance += 0.05; // ä½ä»½ä½
        if ((conc.punishmentCount || 0) > 5) runawayChance += 0.1 * (conc.punishmentCount - 5); // æƒ©ç½šæ¬¡æ•°è¶Šå¤šï¼Œå‡ ç‡è¶Šå¤§

        if (runawayChance > 0 && Math.random() < runawayChance) {
            // è§¦å‘ç§é€ƒäº‹ä»¶
            const stolenAmount = Math.floor(gameState.player.privateAssets * 0.1);
            applyEffects({ privateAssets: -stolenAmount });

            const childrenWithHer = gameState.children.filter(c => c.motherId === conc.id);
            const childrenNames = childrenWithHer.map(c => c.name).join('ã€');

            let eventText = `ä½ å‘ç°å¦¾å®¤ <strong class="highlight-npc">${conc.name}</strong> ä¸å ªå—è¾±ï¼Œå·²è¿å¤œé€ƒç¦»åºœé‚¸ï¼Œå¹¶å·èµ°äº†ä½  <span class="value">${stolenAmount}</span> ä¸¤ç§äº§ï¼`;
            if (childrenWithHer.length > 0) {
                eventText += ` å¥¹è¿˜å¸¦èµ°äº†è‡ªå·±çš„å­©å­ <strong class="highlight-npc">${childrenNames}</strong>ã€‚`;
            }

            // ä»æ¸¸æˆä¸­å½»åº•ç§»é™¤
            gameState.marriage.concubines = gameState.marriage.concubines.filter(id => id !== conc.id);
            gameState.children = gameState.children.filter(c => c.motherId !== conc.id);
            delete gameState.npcs[conc.id];
            delete gameState.social.relationships[conc.id];

            // ä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—æ˜¾ç¤ºï¼Œé¿å…å†²çª
            eventQueue.push(() => {
                showEventCard('å¦¾å®¤ç§é€ƒ', 'fa-running', eventText);
            });
            
            // ä¸€å›åˆåªå¤„ç†ä¸€ä¸ªç§é€ƒäº‹ä»¶
            return;
        }
    }
}
/**
 * ã€æ–°å¢ã€‘ä¸ºå¥³æ€§ç©å®¶æ˜¾ç¤ºç®¡ç†å¦¾å®¤çš„ç•Œé¢
 */
function showConcubineManagementUI_Female() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband ? husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead) : [];

    if (concubines.length === 0) {
        showToast("å¤«å›å°šæ— å¦¾å®¤å¯ç®¡ç†ã€‚");
        return;
    }

    const authority = gameState.marriage.householdAuthority.progress || 0;
    
    let html = `<p class="comment" style="text-align:center;">ä½ å½“å‰çš„æŒå®¶æƒä¸º <strong class="value">${authority}%</strong>ï¼Œè¿™å†³å®šäº†ä½ æŒ‡ä»¤çš„æ•ˆåŠ›ã€‚</p>`;
    html += concubines.map(conc => {
        return `
            <div class="concubine-card">
                <div class="concubine-name"><i class="fas fa-female"></i> ${conc.name} (${conc.rank || 'ä¾å¦¾'})</div>
                <div class="concubine-details">
                    <p>æ©å® : ${conc.favor} | é‡å¿ƒ: ${conc.ambition || 30}</p>
                    <div class="options" style="flex-direction:row; flex-wrap:wrap; margin-top:10px;">
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'reward')">èµèµ</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'punish')">ç½šä¿¸</button>
                        <button class="control-btn" style="min-width:auto;" onclick="manageConcubineAction_Female('${conc.id}', 'ground')">ç¦è¶³</button>
                    </div>
                </div>
            </div>
        `;
    }).join('');

    showDecisionCard('ç®¡ç†å¦¾å®¤', 'fa-users-cog', html, []);
}

/**
 * ã€æ–°å¢ã€‘ä¸ºå¥³æ€§ç©å®¶å¤„ç†å¦¾å®¤ç®¡ç†æŒ‡ä»¤
 */
function manageConcubineAction_Female(concubineId, action) {
    const conc = gameState.npcs[concubineId];
    if(!conc) return;

    const authority = gameState.marriage.householdAuthority.progress || 0;
    let resultLog = '';
    
    // æ£€æŸ¥æƒé™
    if (authority < 30) {
        showToast("æŒå®¶æƒä¸è¶³ï¼Œä½ çš„æŒ‡ä»¤æ— æ³•ç”Ÿæ•ˆã€‚");
        return;
    }

    switch(action) {
        case 'reward':
            if (gameState.family.moneyChest < 100) { showToast("å®¶åº“èµ„é‡‘ä¸è¶³ä»¥èµèµã€‚"); return; }
            gameState.family.moneyChest -= 100;
            applyEffects({relationship: {targetId: conc.id, favor: 5}});
            resultLog = `ä½ ä»å®¶åº“ä¸­æ”¯å–100ä¸¤èµèµäº† ${conc.name}ã€‚`;
            break;
        case 'punish':
            if (authority < 50) { resultLog = `ä½ çš„æŒå®¶æƒä¸è¶³ä»¥ç½šä¿¸ï¼Œåªæ˜¯å£å¤´è­¦å‘Šäº† ${conc.name}ã€‚`; break; }
            applyEffects({relationship: {targetId: conc.id, favor: -8}});
            resultLog = `ä½ ä¸‹ä»¤ç½šæ²¡äº† ${conc.name} çš„æœˆä¿¸ï¼Œå¥¹å¯¹ä½ å¥½æ„Ÿä¸‹é™ã€‚`;
            break;
        case 'ground':
            if (authority < 70) { resultLog = `ä½ çš„æŒå®¶æƒä¸è¶³ä»¥ç¦è¶³ï¼Œ${conc.name} å¯¹ä½ çš„å‘½ä»¤é˜³å¥‰é˜´è¿ã€‚`; break; }
            conc.ambition = Math.max(0, (conc.ambition || 30) - 8);
            resultLog = `ä½ ä¸‹ä»¤å°† ${conc.name} ç¦è¶³ä¸€æœˆï¼Œå¥¹çš„é‡å¿ƒæœ‰æ‰€æ”¶æ•›ã€‚`;
            break;
    }
    showEventCard('å¦¾å®¤ç®¡ç†', 'fa-users-cog', resultLog);
    showConcubineManagementUI_Female(); // åˆ·æ–°ç®¡ç†ç•Œé¢
}
function handleHouseholdManagement(action) {
    const wife = gameState.npcs[gameState.marriage.spouseId];
    const authorityHolderId = gameState.marriage.householdAuthorityHolder;
    const manager = authorityHolderId === 'wife' ? wife : gameState.npcs[gameState.family.members.motherId];

    switch (action) {
        case 'check_ledger': {
            // æŸ¥é˜…è´¦æœ¬
            const wisdomCheck = gameState.player.attributes.wisdom + gameState.player.attributes.strategy;
            let eventText = `ä½ è¦æ±‚æŒäº‹è€… <strong class="highlight-npc">${manager.name}</strong> å‘ˆä¸Šè´¦æœ¬ã€‚`;
            if (wisdomCheck > 100 && Math.random() < 0.3) {
                // å‘ç°è´ªå¢¨äº‹ä»¶
                showDecisionCard('è´¦ç›®å¼‚å¸¸', 'fa-file-invoice-dollar',
                    'ä½ å‘ç°è´¦ç›®ä¸Šæœ‰ä¸€ç¬”ç”¨äºä¿®ç¼®èŠ±å›­çš„å¼€æ”¯å¼‚å¸¸å·¨å¤§ï¼Œä¼¼ä¹è¿œè¶…å®é™…æ‰€éœ€ã€‚',
                    [
                        { htmlContent: 'ã€ä¸åŠ¨å£°è‰²ï¼Œæš—ä¸­è°ƒæŸ¥ã€‘', callback: () => {
                            showEventCard('æ°´è½çŸ³å‡º', 'fa-search', 'ä½ æ´¾å¿ƒè…¹æŸ¥æ˜ï¼Œæ˜¯å¼ ç®¡äº‹ä¸å·¥åŒ å‹¾ç»“ï¼Œä¸­é¥±ç§å›Šã€‚ä½ æŒæ¡äº†è¯æ®ï¼Œå¯ä»¥é€‰æ‹©å…¬å¼€å¤„ç½®æˆ–ç§ä¸‹æ•²æ‰“æ”¶ä¸ºå·±ç”¨ã€‚');
                            gameState.marriage.servantLoyalty += 10;
                        }},
                        { htmlContent: 'ã€ç›´æ¥è´¨é—®æŒäº‹è€…ã€‘', callback: () => {
                            applyEffects({ relationship: { targetId: manager.id, favor: -10 } });
                            showEventCard('å…³ç³»ç´§å¼ ', 'fa-angry', `ä½ å°†è´¦æœ¬æ‘”åœ¨${manager.name}é¢å‰ï¼Œå¥¹æ„Ÿåˆ°ä¸è¢«ä¿¡ä»»ï¼Œä½ ä»¬çš„å…³ç³»ä¸‹é™ã€‚`);
                        }},
                        { htmlContent: 'ã€çä¸€åªçœ¼é—­ä¸€åªçœ¼ã€‘', callback: () => {
                            applyEffects({ attributes: { virtue: -8 } });
                            gameState.marriage.householdEfficiency -= 5;
                            showEventCard('å§‘æ¯å…»å¥¸', 'fa-eye-slash', 'ä½ è®¤ä¸ºæ°´è‡³æ¸…åˆ™æ— é±¼ï¼Œä½†è´ªå¢¨ä¹‹é£å¯èƒ½æ„ˆæ¼”æ„ˆçƒˆã€‚');
                        }}
                    ]
                );
            } else {
                eventText += ' è´¦ç›®æ¸…æ™°ï¼Œå¹¶æ— é”™æ¼ã€‚';
                showEventCard('æŸ¥é˜…è´¦æœ¬', 'fa-book-open', eventText);
            }
            break;
        }
        case 'inspect_servants': {
            // è€ƒæ ¡ä¸‹äºº
            const prestigeCheck = gameState.player.attributes.prestige;
            if (prestigeCheck > 60 && Math.random() < 0.35) {
                showDecisionCard('ç’ç‰ä¸å¥¸ç»†', 'fa-users-cog',
                    'åœ¨è€ƒæ ¡ä¸­ï¼Œä½ å‘ç°ä¸€ä¸ªæ´’æ‰«å°å®å¯¹ç­”å¦‚æµï¼Œé¢‡æœ‰æ‰æ™ºï¼›åŒæ—¶ï¼Œä¸€ä¸ªçœ‹ä¼¼å¿ åšçš„è€ä»†ï¼Œçœ¼ç¥å´æ€»æ˜¯èº²é—ªã€‚',
                    [
                        { htmlContent: 'ã€ææ‹”å°å®ï¼Œæ–¥é€€è€ä»†ã€‘', callback: () => {
                            showEventCard('æ…§çœ¼è¯†äºº', 'fa-user-plus', 'ä½ ææ‹”äº†æœ‰æ‰çš„å°å®ï¼Œå¹¶æ¸…é™¤äº†å¯èƒ½æ˜¯å¥¸ç»†çš„è€ä»†ï¼Œä¸‹äººä»¬å¯¹ä½ çš„çœ¼å…‰æ›´ä¸ºæ•¬ç•ã€‚');
                            gameState.marriage.servantLoyalty += 5;
                        }},
                        { htmlContent: 'ã€åˆ†åˆ«ç§ä¸‹è°ˆè¯ã€‘', req: { wisdom: 70 }, callback: () => {
                            showEventCard('æ´å¯Ÿäººå¿ƒ', 'fa-brain', 'ä½ é€šè¿‡è¯æœ¯å¥—å‡ºäº†çœŸç›¸ï¼šå°å®æ˜¯å®¶é“ä¸­è½çš„è¯»ä¹¦äººï¼Œè€ä»†åˆ™æ˜¯å› å®¶äººè¢«æ”¿æ•Œæ§åˆ¶ã€‚ä½ å¯ä»¥é€‰æ‹©èµ„åŠ©å°å®æˆ–åˆ©ç”¨è€ä»†ä¼ é€’å‡æƒ…æŠ¥ã€‚');
                        }}
                    ]
                );
            } else {
                showEventCard('è€ƒæ ¡ä¸‹äºº', 'fa-users-cog', 'ä½ å¯¹ä¸‹äººè¿›è¡Œäº†ä¸€ç•ªè€ƒæ ¡ï¼Œæœªå‘ç°å¼‚å¸¸ï¼Œä½†ä½ çš„å®¶å¨è®©ä¸‹äººä»¬æ›´åŠ æ•¬ç•ã€‚');
                applyEffects({ attributes: { prestige: 2 } });
            }
            break;
        }
        case 'convene_concubines': {
            // å¬é›†å¦¾å®¤
            const concubines = gameState.marriage.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
            if (concubines.length === 0) {
                showToast("ä½ å°šæ— å¦¾å®¤å¯å¬é›†ã€‚");
                return;
            }
            showDecisionCard('å¬é›†å¦¾å®¤', 'fa-comments', 'ä½ å°†æ‰€æœ‰å¦¾å®¤å¬é›†åˆ°æ­£å…ï¼Œæ‰“ç®—...',
                [
                    { htmlContent: 'ã€è®­è¯ã€‘', req: { prestige: 60 }, callback: () => {
                        applyEffects({ attributes: { prestige: -5 } });
                        gameState.marriage.familyHarmony = Math.min(100, gameState.marriage.familyHarmony + 10);
                        showEventCard('å®¶ä¸»ä¹‹å¨', 'fa-gavel', 'ä½ çš„ä¸€ç•ªè®­è¯æš‚æ—¶å‹åˆ¶äº†å†…å®…çš„äº‰æ–—ï¼Œå’Œè°åº¦æå‡ï¼Œä½†æ¶ˆè€—äº†ä½ çš„å®¶å¨ã€‚');
                    }},
                    { htmlContent: 'ã€èµèµã€‘', callback: () => {
                        // æ­¤å¤„å¯ä»¥åšä¸€ä¸ªæ›´å¤æ‚çš„èµèµç•Œé¢ï¼Œæš‚æ—¶ç®€åŒ–
                        applyEffects({ wealth: -500 });
                        concubines.forEach(c => applyEffects({ relationship: { targetId: c.id, favor: 5 } }));
                        showEventCard('é›¨éœ²å‡æ²¾', 'fa-gifts', 'ä½ èŠ±è´¹500ä¸¤å¹³å‡èµèµäº†æ‰€æœ‰å¦¾å®¤ï¼Œå¥¹ä»¬éƒ½å¾ˆé«˜å…´ã€‚');
                    }},
                    { htmlContent: 'ã€å®¶å®´ã€‘', callback: () => holdFamilyBanquet() }
                ]
            );
            break;
        }
        case 'chat_with_wife': {
            // ä¸å¦»é—²èŠ
            if (!wife || wife.isDead) return;
            showDecisionCard('ä¸å¦»é—²èŠ', 'fa-coffee', `ä½ æ¥åˆ°æ­£å¦»${wife.name}çš„é™¢è½ï¼Œä¸å¥¹é—²èŠã€‚ä½ ä»¬èŠäº›ä»€ä¹ˆå‘¢ï¼Ÿ`,
                [
                    { htmlContent: 'ã€èŠèŠå®¶äº‹ã€‘', callback: () => {
                        applyEffects({ relationship: { targetId: wife.id, favor: 5 } });
                        showEventCard('å®¶å¸¸é—²è¯', 'fa-home', 'å¥¹å‘ä½ æ±‡æŠ¥äº†æœ€è¿‘çš„å®¶åŠ¡çäº‹ï¼Œä½ ä»¬çš„æ„Ÿæƒ…æ›´åŠ äº²è¿‘äº†ã€‚æ©çˆ±å€¼+5');
                    }},
                    { htmlContent: 'ã€è°ˆè°ˆå¤–ç•Œè¶£é—»ã€‘', callback: () => {
                        applyEffects({ relationship: { targetId: wife.id, favor: 8 }, attributes: { talent: 1 } });
                        showEventCard('æ‰æƒ…å…±é¸£', 'fa-paint-brush', 'ä½ ä»¬ä»ä¸€é¦–æ–°è¯—èŠåˆ°ä¸€å¹…å¤ç”»ï¼Œç›¸è°ˆç”šæ¬¢ã€‚æ©çˆ±å€¼+8ï¼Œä½ çš„æ‰æƒ…+1ã€‚');
                    }},
                    { htmlContent: 'ã€è¯´è¯´ä½ çš„äº‹ä¸šã€‘', callback: () => {
                        applyEffects({ relationship: { targetId: wife.id, favor: 12 } });
                        showEventCard('è´¤å¦»è‰¯è¨€', 'fa-lightbulb', 'åˆ†äº«ä½ åœ¨äº‹ä¸šä¸Šçš„å¾—æ„æˆ–å¤±æ„ï¼Œå¥¹æ€»èƒ½ç»™å‡ºç‹¬ç‰¹çš„å»ºè®®ã€‚æ©çˆ±å€¼å¤§å¹…æå‡ã€‚');
                    }}
                ]
            );
            break;
        }
        case 'discuss_affairs': {
            // å•†è®®å®¶äº‹
            if (!wife || wife.isDead || authorityHolderId !== wife.id) return;
            showDecisionCard('å•†è®®å®¶äº‹', 'fa-scroll', 'ä½ å°†æ­£å¦»å«åˆ°ä¹¦æˆ¿ï¼Œæ­£å¼å•†è®®å†…å®…çš„ç®¡ç†æ–¹é’ˆã€‚',
                [
                    { htmlContent: 'ã€æŒ‡ç¤ºï¼šå¼€æºèŠ‚æµã€‘', callback: () => {
                        // ç®€åŒ–é€»è¾‘ï¼ŒæŒå®¶é«˜åˆ™æˆåŠŸ
                        if (wife.attributes.virtue > 70) {
                            showEventCard('æŒå®¶æœ‰é“', 'fa-coins', 'åœ¨å¦»å­çš„æ‰“ç†ä¸‹ï¼Œå¹´åº•å®¶åº“èµ„äº§å¢åŠ äº†10%ã€‚');
                            gameState.family.moneyChest = Math.floor(gameState.family.moneyChest * 1.1);
                        } else {
                            showEventCard('äº‹ä¸æ„¿è¿', 'fa-frown', 'å¦»å­å…‹æ‰£è¿‡å¤šå¯¼è‡´ä¸‹äººå¿ è¯šä¸‹é™ï¼Œå¦¾å®¤å…¬å¼€æŠ±æ€¨ã€‚');
                            gameState.marriage.servantLoyalty -= 10;
                        }
                    }},
                    { htmlContent: 'ã€æˆäºˆâ€œæ•²æ‰“å¦¾å®¤â€ä¹‹æƒã€‘', callback: () => {
                        showEventCard('æˆäºˆæƒåŠ›', 'fa-gavel', 'è¿™æ˜¯ä¸€ä¸ªåŒåˆƒå‰‘ã€‚èƒ½é”»ç‚¼å¦»å­çš„èƒ½åŠ›ï¼Œä½†ä¹Ÿå¯èƒ½è®©å¥¹ä¸å…¶ä»–å¦¾å®¤å…³ç³»å½»åº•ç ´è£‚ã€‚');
                        // å¯ä»¥åœ¨æ­¤è®¾ç½®ä¸€ä¸ªflagï¼Œå½±å“åç»­å†…æ–—äº‹ä»¶
                    }}
                ]
            );
            break;
        }
        case 'rectify_conduct': {
            // æ•´é¡¿å®¶é£
            const cost = 1000;
            if (gameState.finances.wealth < cost || gameState.player.attributes.prestige < 80) {
                showToast("ä½ çš„è´¢å¯Œæˆ–å®¶å¨ä¸è¶³ä»¥ä¸¾è¡Œå®¶åº­ä¼šè®®ã€‚");
                return;
            }
            applyEffects({ wealth: -cost, attributes: { prestige: -10 } });
            gameState.marriage.familyHarmony = 60; // å¼ºåˆ¶æå‡åˆ°åŠæ ¼çº¿
            showEventCard('é›·éœ†æ‰‹æ®µ', 'fa-bolt', `ä½ èŠ±è´¹å·¨èµ„å’Œå®¶å¨ä¸¾è¡Œäº†ä¸€æ¬¡ä¸¥è‚ƒçš„å®¶åº­ä¼šè®®ï¼Œä»¥é›·éœ†æ‰‹æ®µæ•´é¡¿äº†å®¶é£ï¼Œå†…å®…æš‚æ—¶æ¢å¤å¹³é™ã€‚`);
            break;
        }
    }
    renderGame(); // æ¯æ¬¡æ“ä½œååˆ·æ–°ç•Œé¢
}

// ã€æ–°å¢ã€‘æ£€æŸ¥å¹¶è§¦å‘â€œæƒåŠ›äº¤æ¥â€äº‹ä»¶çš„å‡½æ•°
function checkForAuthorityTransfer_Male() {
    if (gameState.player.gender !== 'male' || gameState.marriage.householdAuthorityHolder !== 'mother_in_law') return;

    const wife = gameState.npcs[gameState.marriage.spouseId];
    if (!wife || wife.isDead) return;

    const hasHeir = gameState.children.some(c => c.motherId === wife.id && c.gender === 'male');
    const wifeSkill = (wife.attributes.virtue || 50) + (wife.attributes.wisdom || 50) + (wife.attributes.etiquette || 50);

    if (hasHeir || wifeSkill > 200) {
        const mother = gameState.npcs[gameState.family.members.motherId];
        eventQueue.push(() => {
            showDecisionCard('äº¤æ¥ä¸­é¦ˆ', 'fa-key',
                `${mother.name}å¹´äº‹å·²é«˜ï¼ˆæˆ–ï¼šè§ä½ å«¡å­å·²å‡º/æ­£å¦»è´¤æƒ ï¼‰ï¼Œä¸»åŠ¨æå‡ºå°†æŒå®¶æƒäº¤ç”±æ­£å¦»${wife.name}æ‰“ç†ã€‚`,
                [
                    { htmlContent: 'ã€åŒæ„ã€‘', callback: () => {
                        gameState.marriage.householdAuthorityHolder = 'wife';
                        // å¦»å­çš„â€œæŒå®¶â€èƒ½åŠ›ç”±å…¶ä¸‰é¡¹å±æ€§å†³å®š
                        gameState.marriage.managerSkill = Math.floor(wifeSkill / 3); 
                        showEventCard('æƒåŠ›äº¤æ¥', 'fa-key', `ä½ åŒæ„äº†æ¯äº²çš„æè®®ï¼Œä»æ­¤åºœå†…ä¸­é¦ˆç”±æ­£å¦»${wife.name}æŒç®¡ã€‚`);
                    }},
                    { htmlContent: 'ã€æŒ½ç•™æ¯äº²ã€‘', callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 10 } });
                        showEventCard('ä¸€ç‰‡å­å¿ƒ', 'fa-heart', 'ä½ çš„æŒ½ç•™è®©æ¯äº²å¾ˆæ„ŸåŠ¨ï¼Œå¥¹å†³å®šå†ä¸ºä½ æ“åŠ³å‡ å¹´ã€‚');
                    }}
                ]
            );
        });
    }
}
// [æ›¿æ¢]
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function triggerInnerCourtEvent() {
    if ((!gameState.marriage.isMarried && gameState.marriage.concubines.length === 0)) return;
    if (Math.random() > 0.4) return;
    
    const struggles = INNER_COURT_STRUGGLES[gameState.player.gender];
    if (!struggles) return;
    
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if(!spouse && gameState.player.gender === 'female') return;

    const possibleEvents = Object.values(struggles).filter(event => 
        event.trigger && event.trigger(gameState)
    );

    if (possibleEvents.length > 0) {
        const eventToTrigger = getRandomElement(possibleEvents);
        const eventInstance = eventToTrigger.trigger(gameState);
        if (!eventInstance) return;

        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†äº‹ä»¶å­˜å…¥ marriage ä»“åº“
        addUiEvent('marriage', () => {
            const options = eventToTrigger.options.map(opt => ({
                htmlContent: `<span class="option-text">${opt.text}</span>`,
                disabled: opt.req && (
                    (opt.req.hasAuthority && gameState.marriage.householdAuthorityHolder !== 'player') ||
                    !Object.entries(opt.req).every(([key, val]) => {
                        if (key === 'favor_gt') return spouse.favor > val;
                        return (gameState.player.attributes[key] || gameState.player[key] || 0) >= val;
                    })
                ),
                callback: () => {
                    const resultLog = opt.action(eventInstance.involved);
                    if (!eventToTrigger.isFinal) {
                         showEventCard(eventToTrigger.title, 'fa-theater-masks', resultLog);
                    }
                }
            }));
            showDecisionCard(eventToTrigger.title, 'fa-theater-masks', eventInstance.description, options);
        });
    }
}
// ==================== MALE PLAYER FUNCTIONS ====================
// "æ¸©å­˜" (Flip Card) Interaction Logic
function handleIntimateInteraction(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return;
    let text = "";
    let favorChange = 0;
    let healthChange = 0;
    let harmonyChange = 0;
    const personality = npc.personality && npc.personality.length > 0 ? npc.personality[0] : 'æ¸©æŸ”';
    const favor = npc.favor || 0;
    if (personality === 'æ¸©é¡º' || personality === 'æ¸©æŸ”') {
        text = `å¤œè‰²æ·±æ²‰ï¼Œå¥¹ä¸ºä½ ç«¯æ¥ä¸€ç¢—è²å­ç¾¹ï¼ŒæŸ”å£°é“ï¼šâ€œå¤«å›è¾›è‹¦äº†ã€‚â€ä½ å¿ƒä¸­ä¸€æš–ã€‚`;
        favorChange = 3;
        healthChange = 2;
    } else if ((personality === 'å–„å¦’' || personality === 'æ´»æ³¼') && npc.jealousy > 50) {
        text = `ä½ èµ°è¿›æˆ¿ä¸­ï¼Œå¥¹å´å†·ç€è„¸ï¼Œè¨€è¯­é—´å¤¹æªå¸¦æ£’ï¼Œå¥å¥ä¸ç¦»å…¶ä»–å§å¦¹ã€‚`;
        favorChange = -2;
        harmonyChange = -1;
    } else if ((personality === 'æ‰æƒ…' || personality === 'èªæ…§') && favor > 60) {
        text = `ä½ ä»¬æœˆä¸‹å¯¹å¼ˆï¼Œæ£‹é€¢å¯¹æ‰‹ï¼Œç›¸è§†ä¸€ç¬‘ï¼Œåªè§‰çŸ¥å·±éš¾è§…ã€‚`;
        favorChange = 5;
        applyEffects({ attributes: { talent: 1 } });
    } else {
        text = `ä½ ä»¬å…±åº¦äº†ä¸€ä¸ªå¹³é™çš„å¤œæ™šã€‚`;
        favorChange = 2;
    }
    let resultText = `<div class="intimate-scene"><i class="fas fa-moon"></i> ${text}</div>`;
    applyEffects({ relationship: { targetId: npcId, favor: favorChange } });
    if (healthChange !== 0) applyEffects({ attributes: { health: healthChange } });
    gameState.marriage.familyHarmony = Math.max(0, Math.min(100, gameState.marriage.familyHarmony + harmonyChange));
    resultText += `</br>æ©çˆ±å€¼ ${favorChange >= 0 ? '+' : ''}${favorChange}ã€‚`;
    if (healthChange > 0) resultText += `å¥åº· +${healthChange}ã€‚`;
    if (harmonyChange !== 0) resultText += `å®¶å®…å’Œè°åº¦ ${harmonyChange}ã€‚`;
    triggerBirth(npcId, false);
    showEventCard('æ¸©å­˜', 'fa-heart', resultText);
    renderGame();
}
// ==================== FEMALE PLAYER FUNCTIONS ====================

// Show tasks to gain Household Authority
function showHouseholdAuthorityTasks() {
    const motherInLaw = gameState.npcs[gameState.family.members.motherId];
    if (!motherInLaw) {
        showToast("æš‚æ— å®¶åŠ¡å¯åç†ã€‚");
        return;
    }

    const options = [
        {
            htmlContent: `<strong>åç†é‡‡åŠ</strong><div><small>è€ƒéªŒä½ çš„ç²¾æ˜ä¸è´¢åŠ›</small></div>`,
            callback: () => handleAuthorityTask('procurement')
        },
        {
            htmlContent: `<strong>åç†äººäº‹</strong><div><small>è€ƒéªŒä½ çš„å¿ƒè®¡ä¸äººè„‰</small></div>`,
            callback: () => handleAuthorityTask('personnel')
        },
        {
            htmlContent: `<strong>ç®¡ç†è´¦ç›®</strong><div><small>è€ƒéªŒä½ çš„æ™ºæ…§</small></div>`,
            callback: () => handleAuthorityTask('finance')
        }
    ];

    showDecisionCard('åç†å®¶åŠ¡', 'fa-tasks', `å©†å©† <strong class="highlight-npc">${motherInLaw.name}</strong> è§ä½ è´¤æƒ ï¼Œæ‰“ç®—äº¤ç»™ä½ ä¸€äº›å®¶åŠ¡è®©ä½ å†ç»ƒä¸€ç•ªã€‚`, options);
}

// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function handleAuthorityTask(taskType) {
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒæ–°å¢ä»£ç ã€‘ â–¼â–¼â–¼
    if ((gameState.flags.actionUsed_household || 0) >= 2) {
        showToast("æœ¬å›åˆå†…å®…ç®¡ç†æ¬¡æ•°å·²ç”¨å°½ã€‚");
        return;
    }
    gameState.flags.actionUsed_household = (gameState.flags.actionUsed_household || 0) + 1;
    // â–²â–²â–² ã€æ–°å¢ç»“æŸã€‘ â–²â–²â–²

    const eventPool = HOUSEHOLD_TASKS_EVENTS[taskType];
    if (!eventPool || eventPool.length === 0) {
        showToast("æš‚æ— ç›¸å…³å®¶åŠ¡å¯å¤„ç†ã€‚");
        return;
    }
    const event = getRandomElement(eventPool);
    const options = event.options.map(opt => ({
        htmlContent: `<span class="option-text">${opt.text}</span>`,
        callback: () => {
            const authority = gameState.marriage.householdAuthority;
            const motherInLaw = gameState.npcs[gameState.family.members.motherId];
            // åº”ç”¨æ•ˆæœ
            const effect = opt.effects;
            if (effect.procurement) authority.procurement += effect.procurement;
            if (effect.personnel) authority.personnel += effect.personnel;
            if (effect.finance) authority.finance += effect.finance;
            // åº”ç”¨å¯¹ç©å®¶å±æ€§çš„å½±å“
            applyEffects({ attributes: { wisdom: effect.wisdom || 0, charm: effect.charm || 0, virtue: effect.virtue || 0, scheming: effect.scheming || 0 }});
            // åº”ç”¨å¯¹å©†å©†å¥½æ„Ÿçš„å½±å“
            if(motherInLaw) {
                applyEffects({ relationship: { targetId: motherInLaw.id, favor: effect.favor_mil || 0 } });
            }
            // æ›´æ–°æ€»è¿›åº¦
            authority.progress = Math.floor((authority.personnel + authority.finance + authority.procurement) / 3);
            showEventCard(event.title, 'fa-tasks', opt.result);
            renderGame();
        }
    }));
    showDecisionCard(event.title, 'fa-tasks', event.desc, options);
}
/**
 * ã€æ–°å¢å‡½æ•°ã€‘ä¸ºç©å®¶æœ¬äººæ˜¾ç¤ºè®®äº²å€™é€‰äººåˆ—è¡¨
 */
function showPlayerArrangedMarriage() {
    closeAllOverlays(); // å…ˆå…³é—­åª’å©†çª—å£
    const gender = gameState.player.gender;
    const partnerGender = gender === 'male' ? 'female' : 'male';
    let partnersHTML = `<h4>åª’å©†ä¸ºä½ å¯»æ¥äº†ä¸‰ä½å®¶ä¸–æ¸…ç™½çš„å€™é€‰äºº:</h4>`;
    let potentialPartners = [];

    for(let i=0; i < 3; i++) {
        const bg = getRandomElement(childSpousePools[partnerGender]);
        potentialPartners.push({
            name: generateRandomName(partnerGender, gameState.flags.allNames),
            desc: bg.desc,
            attributes: { ...bg.attributes, family: bg.family },
            isArranged: true,
            hiddenTrait: bg.hidden_trait,
            avatar: getRandomElement(avatarPools[partnerGender]),
            source: 'matchmaker' // å…³é”®æ ‡è®°ï¼šæŒ‡æ˜æ­¤äººç”±åª’å©†ä»‹ç»
        });
    }

    partnersHTML += potentialPartners.map(p => renderPlayerCandidateCard(p)).join('');

    // ä½¿ç”¨ arrangedMarriageOverlay å¼¹çª—æ¥æ˜¾ç¤º
    document.getElementById('arrangedMarriageContent').innerHTML = `<div style="max-height: 70vh; overflow-y:auto; padding:5px;">${partnersHTML}</div>`;
    showOverlay('arrangedMarriageOverlay');
}

/**
 * ã€æ–°å¢å‡½æ•°ã€‘æ¸²æŸ“ç©å®¶æœ¬äººçš„è®®äº²å¯¹è±¡å¡ç‰‡
 */
function renderPlayerCandidateCard(partner) {
    const partnerScore = Object.values(partner.attributes).reduce((a, b) => a + b, 0);
    const playerScore = Object.values(gameState.player.attributes).reduce((a, b) => a + b, 0);
    const compatibility = Math.min(100, Math.max(10, 50 + (playerScore - partnerScore) / 5));
    const partnerInfoString = JSON.stringify(partner).replace(/'/g, "&apos;");

    return `<div class="suitor" style="cursor:pointer;" data-partner='${partnerInfoString}' onclick='proposeToPlayerPartner(this)'>
        <div class="suitor-avatar-wrapper">
            <img src="${partner.avatar}" class="suitor-avatar">
        </div>
        <div class="suitor-details">
            <div class="suitor-name">${partner.name} <small>(åŒ¹é…åº¦: ${Math.floor(compatibility)}%)</small></div>
            <div class="suitor-desc">${partner.desc}</div>
            <div class="suitor-stats">
                <span class="stat"><i class="fas fa-home"></i> å®¶ä¸–: ${partner.attributes.family}</span>
                <span class="stat"><i class="fas fa-grin-stars"></i> é­…åŠ›: ${partner.attributes.charm}</span>
                <span class="stat"><i class="fas fa-pencil-alt"></i> æ‰æƒ…: ${partner.attributes.talent}</span>
            </div>
            <button class="control-btn" style="padding: 5px 10px; font-size: 0.8em; margin-top: 8px; width: 120px;" 
                onclick="event.stopPropagation(); investigatePlayerCandidate(this.parentElement.parentElement)">
                <i class="fas fa-search"></i> æš—ä¸­è°ƒæŸ¥
            </button>
        </div>
    </div>`;
}

/**
 * ã€æ–°å¢å‡½æ•°ã€‘å¤„ç†å¯¹ç©å®¶æœ¬äººçš„è®®äº²å¯¹è±¡çš„æäº²é€»è¾‘
 */
function proposeToPlayerPartner(cardElement) {
    const partnerInfo = JSON.parse(cardElement.dataset.partner);
    // ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„NPCå¯¹è±¡ç”¨äºç»“å©šæµç¨‹
    const newNpc = generateNPC({
        name: partnerInfo.name,
        gender: partnerInfo.gender,
        age: getRandomInt(gameState.player.age, gameState.player.age + 5),
        favor: 50,
        source: partnerInfo.source, // ç»§æ‰¿ 'matchmaker' æ ‡è®°
        attributes: partnerInfo.attributes,
        relationship: 'suitor',
        avatar: partnerInfo.avatar
    });

    if (confirm(`ä½ ç¡®å®šè¦å‘ ${newNpc.name} æäº²å—ï¼Ÿ`)) {
        marrySuitor(newNpc.id);
    }
}

/**
 * ã€æ–°å¢å‡½æ•°ã€‘å¤„ç†å¯¹ç©å®¶æœ¬äººçš„è®®äº²å¯¹è±¡çš„è°ƒæŸ¥é€»è¾‘
 */
function investigatePlayerCandidate(cardElement) {
    const cost = 200;
    if(gameState.finances.wealth < cost) { 
        showToast("è°ƒæŸ¥éœ€è¦200ä¸¤ï¼Œå½“å‰ç§äº§ä¸è¶³"); 
        return;
    }
    const partnerData = JSON.parse(cardElement.dataset.partner);
    const button = cardElement.querySelector('.control-btn');
    button.disabled = true;
    button.classList.add('button-loading');

    setTimeout(() => {
        applyEffects({ wealth: -cost });
        const event = getRandomElement(INVESTIGATION_EVENTS);
        const desc = event.desc.replace(/ã€å¯¹è±¡å§“åã€‘/g, `<strong class="highlight-npc">${partnerData.name}</strong>`);
        const finalDesc = `${desc}<br><br><strong>è°ƒæŸ¥ç»“æœï¼š</strong>${event.effect_text || 'æƒ…å†µå¦‚ä¸Šï¼Œè¯·æ‚¨å®šå¤ºã€‚'}`;

        const options = [
            {
                htmlContent: `<i class="fas fa-check"></i> åŒæ„æ­¤é—¨äº²äº‹`,
                callback: () => proposeToPlayerPartner(cardElement)
            },
            {
                htmlContent: `<i class="fas fa-times"></i> æ‹’ç»æ­¤é—¨äº²äº‹`,
                callback: () => {
                    showToast(`ä½ å†³å®šä¸è€ƒè™‘ ${partnerData.name} äº†ã€‚`);
                    closeAllOverlays();
                }
            }
        ];

        // å¦‚æœè°ƒæŸ¥å‡ºçš„äº‹ä»¶æœ¬èº«æœ‰é€‰é¡¹ï¼ˆä¾‹å¦‚å‘ç°å¯¹æ–¹å·²æœ‰å¿ƒä¸Šäººï¼‰ï¼Œåˆ™ä¼˜å…ˆæ˜¾ç¤ºäº‹ä»¶é€‰é¡¹
        if (event.options) {
            const eventOptions = event.options.map(opt => ({
                htmlContent: opt.text,
                callback: () => {
                    showEventCard(event.title, 'fa-user-secret', `${desc}<br><br><strong>ä½ çš„å†³å®šï¼š</strong>${opt.log}`);
                }
            }));
            showDecisionCard(event.title, 'fa-user-secret', desc, eventOptions);
        } else {
            // å¦åˆ™æ˜¾ç¤ºé€šç”¨çš„è®®äº²å†³ç­–
            showDecisionCard(event.title, 'fa-user-secret', finalDesc, options);
        }
        button.classList.remove('button-loading');
        button.innerHTML = '<i class="fas fa-check"></i> å·²è°ƒæŸ¥';
    }, 1000);
}
// Check for automatic authority transfer (e.g., birth of heir)
function checkAuthorityTransfer_Male() {
    if (gameState.player.gender !== 'male' || gameState.marriage.householdAuthorityHolder !== 'mother') return;
    const wife = gameState.npcs[gameState.marriage.spouseId];
    if (!wife || wife.isDead) return;
    const hasHeir = gameState.children.some(c => c.motherId === wife.id && c.gender === 'male');
    const wifeSkill = (wife.attributes.virtue || 50) + (wife.attributes.wisdom || 50) + (wife.attributes.etiquette || 50);

    if ((hasHeir || wifeSkill > 200) && Math.random() < 0.25) { // å¢åŠ ä¸€ä¸ªéšæœºæ€§ï¼Œé¿å…æ¯å¹´éƒ½è§¦å‘
        const mother = gameState.npcs[gameState.family.members.motherId];
        eventQueue.push(() => {
            showDecisionCard('äº¤æ¥ä¸­é¦ˆ', 'fa-key',
                `${mother.name}å¹´äº‹å·²é«˜ï¼ˆæˆ–ï¼šè§ä½ å«¡å­å·²å‡º/æ­£å¦»è´¤æƒ ï¼‰ï¼Œä¸»åŠ¨æå‡ºå°†æŒå®¶æƒäº¤ç”±æ­£å¦»${wife.name}æ‰“ç†ã€‚`,
                [
                    { htmlContent: 'ã€åŒæ„ã€‘', callback: () => {
                        gameState.marriage.householdAuthorityHolder = 'wife';
                        gameState.marriage.managerSkill = Math.floor(wifeSkill / 3); 
                        showEventCard('æƒåŠ›äº¤æ¥', 'fa-key', `ä½ åŒæ„äº†æ¯äº²çš„æè®®ï¼Œä»æ­¤åºœå†…ä¸­é¦ˆç”±æ­£å¦»${wife.name}æŒç®¡ã€‚`);
                    }},
                    { htmlContent: 'ã€æŒ½ç•™æ¯äº²ã€‘', callback: () => {
                        applyEffects({ relationship: { targetId: mother.id, favor: 10 } });
                        showEventCard('ä¸€ç‰‡å­å¿ƒ', 'fa-heart', 'ä½ çš„æŒ½ç•™è®©æ¯äº²å¾ˆæ„ŸåŠ¨ï¼Œå¥¹å†³å®šå†ä¸ºä½ æ“åŠ³å‡ å¹´ã€‚');
                    }}
                ]
            );
        });
    }
}
function checkAuthorityTransfer() {
    const player = gameState.player;
    if (player.gender !== 'female') return;
    
    const hasHeir = gameState.children.some(c => c.motherId === 'player' && c.gender === 'male');
    const motherInLaw = gameState.npcs[gameState.family.members.motherId];

    if (hasHeir && gameState.marriage.householdAuthority.progress < 100) {
        // Trigger event
        const options = [
             {
                htmlContent: `<strong>æ¬£ç„¶æ¥å—</strong>`,
                callback: () => {
                    gameState.marriage.householdAuthority.progress = 100;
                    gameState.marriage.householdAuthorityHolder = 'player';
                    showEventCard('å¤§æƒåœ¨æ¡', 'fa-key', 'ä½ æ­£å¼æ¥ç®¡äº†åºœä¸­æ‰€æœ‰æŒå®¶æƒï¼Œæˆä¸ºäº†çœŸæ­£çš„å¥³ä¸»äººï¼');
                }
            },
            {
                htmlContent: `<strong>è°¦è™šæ¨è¾</strong>`,
                callback: () => {
                    gameState.marriage.householdAuthority.progress = Math.min(100, gameState.marriage.householdAuthority.progress + 50);
                    applyEffects({relationship: {targetId: motherInLaw.id, favor: 20}});
                    showEventCard('è°¦é€Šä¹‹å¾·', 'fa-praying-hands', 'ä½ çš„è°¦é€Šè®©å©†å©†éå¸¸æ»¡æ„ï¼Œå¥¹å°†å¤§éƒ¨åˆ†æƒåŠ›äº¤ç»™äº†ä½ ï¼Œä½†ä»ä¿ç•™äº†æ ¸å¿ƒäººäº‹æƒã€‚');
                }
            }
        ];
        eventQueue.push(() => {
            showDecisionCard('æƒåŠ›äº¤æ¥', 'fa-key', 'ä½ æˆåŠŸè¯ä¸‹å«¡å­ï¼Œå©†å©†å–œä¸è‡ªèƒœï¼Œä¸»åŠ¨æå‡ºè¦å°†æŒå®¶æƒäº¤ç»™ä½ ã€‚', options);
        });
    }
}


// =======================================================================
// ===================== ã€æ–°åŠŸèƒ½ã€‘å®…æ–—ç³»ç»Ÿå‡½æ•° END ========================
// =======================================================================

// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
// ===================== ã€ç¬¬ä¸€æ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * [V2.0] æ¸²æŸ“å­å—£æ ‡ç­¾é¡µå‡½æ•° - æ–°å¢å­™è¾ˆæ˜¾ç¤ºé€»è¾‘
 */
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderChildrenTab() {
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨æ¸²æŸ“å‰æ£€æŸ¥æ˜¯å¦æœ‰å¾…å¤„ç†çš„å­å—£äº‹ä»¶
    if (gameState.pendingUiEvents && gameState.pendingUiEvents.children && gameState.pendingUiEvents.children.length > 0) {
        const nextEventCallback = gameState.pendingUiEvents.children.shift();
        if (typeof nextEventCallback === 'function') {
            nextEventCallback();
        }
        return '';
    }
    
    // --- ä»¥ä¸‹ä¸ºåŸæœ‰çš„ã€æ— äº‹ä»¶æ—¶çš„æ¸²æŸ“é€»è¾‘ ---
    const aliveChildren = gameState.children.filter(c => !c.isDead);
    if (aliveChildren.length === 0) {
        return `<h3 class="card-header">å­å—£</h3><p class="comment" style="text-align:center;">æš‚æ— å­å—£ã€‚</p>`;
    }

    const childrenHTML = aliveChildren.map(child => {
        if (!child.attributes) return '';
        const isDirectChild = child.fatherId === 'player' || child.motherId === 'player' || child.fatherId === gameState.marriage.spouseId || child.motherId === gameState.marriage.spouseId;
        let status = '';
        let parentInfoHTML = '';
        if (isDirectChild) {
            const mother = gameState.npcs[child.motherId] || (child.motherId === 'player' ? gameState.player : { name: 'æœªçŸ¥' });
            parentInfoHTML += `<p><strong>ç”Ÿæ¯:</strong> ${mother.name}</p>`;
            if (child.isSecret) {
                status = '<span class="highlight-secret">[ç§]</span>';
                const biologicalFather = gameState.npcs[child.biologicalFatherId];
                if (biologicalFather) {
                    parentInfoHTML += `<p><strong>ç”Ÿçˆ¶:</strong> <span class="highlight-secret">${biologicalFather.name}</span></p>`;
                }
            } else if (mother.id === gameState.marriage.spouseId || mother.id === 'player') {
                status = ' <span style="color:var(--highlight-strong);">[å«¡]</span>';
            } else {
                status = ' <span style="color:var(--text-comment);">[åº¶]</span>';
            }
        } else {
            status = ' <span style="color:#27ae60; font-weight:bold;">[å­™]</span>';
            const grandchildsFather = gameState.npcs[child.fatherId];
            const grandchildsMother = gameState.npcs[child.motherId];
            if (grandchildsFather) parentInfoHTML += `<p><strong>çˆ¶äº²:</strong> ${grandchildsFather.name}</p>`;
            if (grandchildsMother) parentInfoHTML += `<p><strong>æ¯äº²:</strong> ${grandchildsMother.name}</p>`;
        }

        const childDisplayName = child.name || 'æœªå‘½å';
        const nameInitial = child.name ? child.name.slice(child.name.length - 1) : 'ï¼Ÿ';
        let careerDisplay = 'æœªæˆå¹´';
        if (child.career) {
            if (child.career.path === 'unemployed') {
                careerDisplay = 'å¾…ä¸š';
            } else {
                const careerData = careerPaths[child.gender][child.career.path];
                if (careerData) {
                    const levelTitle = careerData.levels[child.career.level].title;
                    careerDisplay = `${child.career.name} - ${levelTitle}`;
                } else {
                    careerDisplay = child.career.name;
                }
            }
        }
        
        const avatarContent = `
            <div class="avatar-wrapper" style="width: 60px; height: 60px; flex-shrink: 0; border-width: 2px;">
            ${child.avatar ? `<img src="${child.avatar}" class="avatar-image" style="display:block;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <svg class="avatar-svg" viewBox="0 0 100 100" style="display:none;">` :
            `<svg class="avatar-svg" viewBox="0 0 100 100" style="display:block;">`}
            <circle cx="50" cy="50" r="48" fill="${child.gender === 'male' ? '#add8e6' : '#ffc0cb'}" />
            <text x="50" y="65" font-family="'Ma Shan Zheng', cursive" font-size="50" fill="white" text-anchor="middle">${nameInitial}</text>
            </svg>
            </div>`;

        let marriageInfo = '';
        if (child.marriage.isMarried && child.marriage.spouseId) {
            const spouse = gameState.npcs[child.marriage.spouseId];
            if (spouse) {
                 marriageInfo = `<p><strong>é…å¶:</strong> ${spouse.name}</p>`;
            }
        }
        
        return `
        <div class="child-card">
            ${avatarContent}
            <div class="child-details">
                <div class="child-name"><i class="fas fa-${child.gender === 'male' ? 'male' : 'female'}"></i> ${childDisplayName} (${Math.floor(child.age)}å²)${status}</div>
                ${parentInfoHTML}
                <p><strong>äº²å¯†åº¦:</strong> ${child.favor || 50}</p>
                <p><strong>èŒä¸š:</strong> ${careerDisplay}</p>
                ${marriageInfo}
            </div>
            <div class="child-btn-group">
                <button class="child-cultivate-btn" onclick="showChildRearing('${child.id}')">äº’åŠ¨/åŸ¹å…»</button>
                <button class="child-cultivate-btn" style="background:#555;" onclick="showRenameChildOverlay('${child.id}')">æ”¹å</button>
                ${child.age >= 16 && !child.marriage.isMarried ? `<button class="child-cultivate-btn" style="background:linear-gradient(135deg, #a7c957, #6a9ac9);" onclick="openChildMarriageMenu('${child.id}')">è®®äº²</button>` : ''}
            </div>
        </div>
        `;
    }).join('');
    
    return `<h3 class="card-header">å­å—£</h3><div class="children-container" style="max-height: 400px; overflow-y: auto; padding: 5px;">${childrenHTML}</div>`;
}
function renameChild(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    // å¼¹çª—æç¤ºè¾“å…¥æ–°åå­—
    const oldName = child.name;
    const newNameGiven = prompt(`è¯·ä¸º${oldName}è¾“å…¥æ–°åå­— (ä¸å«å§“æ°ï¼Œ1-4ä¸ªå­—)`, oldName.slice(1));
    
    if (newNameGiven === null) return; // ç”¨æˆ·å–æ¶ˆ

    let newName = newNameGiven.trim();

    if (newName.length === 0 || newName.length > 4) {
        showToast("è¯·è¾“å…¥1-4ä¸ªå­—çš„åå­—ã€‚");
        return;
    }
    
    const father = gameState.npcs[child.fatherId];
    if (!father) {
        showToast("æ— æ³•è·å–çˆ¶äº²ä¿¡æ¯ã€‚");
        return;
    }
    const finalName = father.name.slice(0, 1) + newName;

    if (gameState.flags.allNames.has(finalName)) {
        showToast("è¿™ä¸ªåå­—å·²ç»æœ‰äººç”¨å•¦ï¼Œæ¢ä¸€ä¸ªå§ã€‚");
        return;
    }

    // ç§»é™¤æ—§åå­—ï¼Œæ·»åŠ æ–°åå­—
    if (child.name) {
        gameState.flags.allNames.delete(child.name);
    }
    child.name = finalName;
    gameState.flags.allNames.add(finalName);
    
    showEventCard('æ”¹åæˆåŠŸ', 'fa-pen-fancy', `ä½ å°† <strong class="value">${oldName}</strong> çš„åå­—æ”¹ä¸ºäº† <strong class="value">${finalName}</strong>ã€‚`);
    renderGame();
}
// [æ›¿æ¢] æ‰¾åˆ°è¿™ä¸ªå‡½æ•°å¹¶ç”¨ä¸‹é¢çš„ä»£ç å®Œæ•´æ›¿æ¢
function showRenameChildOverlay(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    // [ä¿®å¤] å¢åŠ äº†å®‰å…¨æ£€æŸ¥ï¼Œé˜²æ­¢ child.name ä¸º undefined æ—¶è°ƒç”¨ .slice() å‡ºé”™
    const oldGivenName = child.name ? child.name.slice(1) : 'æœªå‘½å';

    document.getElementById('renameChildOldName').textContent = child.name || 'è¿™ä¸ªå­©å­';
    document.getElementById('renameChildInput').value = oldGivenName === 'æœªå‘½å' ? '' : oldGivenName;

    const confirmBtn = document.getElementById('confirmRenameBtn');
    confirmBtn.onclick = () => {
        confirmNewName(childId);
    };

    showOverlay('renameChildOverlay');
}
// æ–°å¢å‡½æ•°ï¼šç¡®è®¤æ–°åå­—çš„é€»è¾‘
function confirmNewName(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    const newNameInput = document.getElementById('renameChildInput');
    const newGivenName = newNameInput.value.trim();

    if (newGivenName.length === 0 || newGivenName.length > 3) {
        showToast("è¯·è¾“å…¥1-3ä¸ªå­—çš„æ–°åã€‚");
        return;
    }

    const surname = child.name.slice(0, 1);
    const finalName = surname + newGivenName;

    if (gameState.flags.allNames.has(finalName) && finalName !== child.name) {
        showToast("è¿™ä¸ªåå­—å·²ç»æœ‰äººç”¨å•¦ï¼Œæ¢ä¸€ä¸ªå§ã€‚");
        return;
    }
    
    // ä»å…¨å±€åå­—æ± ä¸­ç§»é™¤æ—§åå­—
    gameState.flags.allNames.delete(child.name);

    // æ›´æ–°å­©å­çš„åå­—å’Œå…¨å±€åå­—æ± 
    const oldName = child.name;
    child.name = finalName;
    gameState.flags.allNames.add(finalName);
    
    showEventCard('æ”¹åæˆåŠŸ', 'fa-pen-fancy', `ä½ å°† <strong class="value">${oldName}</strong> çš„åå­—æ”¹ä¸ºäº† <strong class="value">${finalName}</strong>ã€‚`);
    
    // å…³é—­æ‰€æœ‰å¼¹çª—å¹¶åˆ·æ–°ç•Œé¢
    closeAllOverlays();
    renderGame();
}
// è¿™æ˜¯ä¿®å¤åçš„ä»£ç 
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderMerchantTab() {
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨æ¸²æŸ“å‰æ£€æŸ¥æ˜¯å¦æœ‰å¾…å¤„ç†çš„å•†ä¼šäº‹ä»¶
    if (gameState.pendingUiEvents && gameState.pendingUiEvents.merchant && gameState.pendingUiEvents.merchant.length > 0) {
        const nextEventCallback = gameState.pendingUiEvents.merchant.shift();
        if (typeof nextEventCallback === 'function') {
            nextEventCallback();
        }
        return '';
    }

    // --- ä»¥ä¸‹ä¸ºåŸæœ‰çš„ã€æ— äº‹ä»¶æ—¶çš„æ¸²æŸ“é€»è¾‘ ---
    return `
    <h3 class="card-header">å•†ä¼šç®¡ç†</h3>
    <p class="comment">è¿ç­¹å¸·å¹„ï¼Œæ–¹èƒ½å¯Œç”²ä¸€æ–¹ã€‚</p>
    <div class="options">
        <button class="option" onclick="openTradingMainUI()">
            <i class="fas fa-handshake"></i><span class="option-text">è¿›å…¥å•†ä¼šäº¤æ˜“<div><small>ä½ä¹°é«˜å–ï¼Œç§¯ç´¯è´¢å¯Œ</small></div></span>
        </button>
        <button class="option" onclick="handleMerchantAction('invest')">
            <i class="fas fa-store"></i><span class="option-text">äº§ä¸šæŠ•èµ„<div><small>è´­ç½®å•†é“ºï¼Œè·å–ç¨³å®šæ”¶ç›Š</small></div></span>
        </button>
        <button class="option" onclick="handleMerchantAction('farm')">
            <i class="fas fa-map-marked-alt"></i><span class="option-text">å†œäº‹ç»è¥<div><small>è´­ä¹°åœŸåœ°ï¼Œç§æ¤ä½œç‰©</small></div></span>
        </button>
        <button class="option" onclick="handleMerchantAction('explore')">
            <i class="fas fa-ship"></i><span class="option-text">è¿œæ´‹æ¢ç´¢<div><small>æ¢ç´¢æœªçŸ¥æµ·åŸŸï¼Œå¯»æ±‚å·¨é¢å›æŠ¥</small></div></span>
        </button>
    </div>
    <div class="section-header"><i class="fas fa-book"></i> äº§ä¸šæ—¥å¿—</div>
    <div class="event-log">${gameState.finances.merchantLog.length > 0 ? gameState.finances.merchantLog.map(e =>`<div class="event">${e}</div>` ).join('') : '<p class="comment">æš‚æ— è®°å½•ã€‚</p>'}</div>
    `;
}
// ã€æ›¿æ¢ã€‘æ‰¾åˆ°è¿™ä¸ªå‡½æ•°å¹¶ç”¨ä¸‹é¢çš„ä»£ç å®Œæ•´æ›¿æ¢
function openTradingMainUI() {
    if (!gameState.tradingSystem.isTradingPeriod) {
        showToast("ç°åœ¨æ˜¯ä¼‘å¸‚æœŸé—´ï¼Œæ— æ³•äº¤æ˜“ã€‚");
        return;
    }
    const ts = gameState.tradingSystem;
    const card = document.getElementById('tradingOverlayCard');
    
    // [æ ¸å¿ƒä¿®å¤] é‡‡ç”¨ä¸å•†ä¼šå†…éƒ¨ä¸€è‡´çš„å®æ—¶è®¡ç®—é€»è¾‘
    let fluctuationsHTML = ts.marketStatus.fluctuations.length > 0
        ? ts.marketStatus.fluctuations.map(f => {
            const goodDef = TRADING_GOODS_DATA[f.id];
            const currentPrice = ts.marketStatus.prices[f.id];
            // ä½¿ç”¨å¹³å‡åŸºç¡€ä»·è¿›è¡Œè®¡ç®—ï¼Œç¡®ä¿æ•°æ®æºç»Ÿä¸€
            const basePrice = goodDef.basePrice; 
            
            // è®¡ç®—å®é™…æ¶¨è·Œå¹…
            const change = (currentPrice - basePrice) / basePrice;
            const changePercent = (change * 100).toFixed(0);
            
            const trendClass = change > 0 ? 'text-gain' : 'text-loss';
            const icon = change > 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
            return `<li><i class="${icon} ${trendClass}"></i> ${f.name} <span class="${trendClass}">${changePercent}%</span> <small>(${f.reason})</small></li>`;
        }).join('')
        : '<li>å¸‚åœºå¹³ç¨³ï¼Œæš‚æ— é‡å¤§æ¶ˆæ¯ã€‚</li>';

    const guilds = [
        { id: 'east', name: 'ä¸œå¸‚å•†ä¼š' }, { id: 'west', name: 'è¥¿å¸‚å•†ä¼š' },
        { id: 'south', name: 'å—æ´‹å•†ä¼š' }, { id: 'north', name: 'å¡åŒ—å•†ä¼š' }
    ];
    card.innerHTML = `
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="overlay-header">   äº¬åŸå•†ä¼š   </div>
        <div class="overlay-content-wrapper" style="padding: 0 5px;">
            <p style="text-align:center;">å½“å‰å‘¨æœŸ: <strong>${gameState.date.year}å¹´ ${gameState.date.turn === 1 ? 'ä¸ŠåŠå¹´' : 'ä¸‹åŠå¹´'}</strong></p>
            <div class="trading-main-grid">
                <div class="trading-info-box">
                    <h4><i class="fas fa-cash-register"></i> é’±æŸœèµ„é‡‘</h4>
                    <div class="value">${formatNumber(ts.moneyChest)} ä¸¤</div>
                </div>
                <div class="trading-info-box">
                    <h4><i class="fas fa-boxes"></i> ä»“åº“å®¹é‡</h4>
                    <div class="value">${ts.warehouse.length} / ${ts.warehouseCapacity}</div>
                </div>
                <div class="trading-info-box market-fluctuation-card">
                    <h4><i class="fas fa-bullhorn"></i> å¸‚åœºæ³¢åŠ¨ä¿¡æ¯</h4>
                    <ul>${fluctuationsHTML}</ul>
                </div>
                ${guilds.map(guild => `
                    <div class="guild-button" onclick="openGuildTradeUI('${guild.id}')">
                        ${guild.name}
                        <div class="guild-favor-bar">
                            <div class="guild-favor-fill" style="width:${ts.guildFavor[guild.id]}%"></div>
                        </div>
                    </div>
                `).join('')}
            </div>
            <div class="trading-controls">
                <button class="control-btn" onclick="showWarehouseUI()"><i class="fas fa-warehouse"></i> ä»“åº“ç®¡ç†/å‡çº§</button>
                <button class="control-btn" onclick="showTradeLogUI()"><i class="fas fa-history"></i> äº¤æ˜“è®°å½•</button>
                <button class="control-btn" onclick="showMoneyChestUI()"><i class="fas fa-exchange-alt"></i> é’±æŸœå­˜å–</button>
            </div>
        </div>
    `;
    showOverlay('tradingOverlay');
}

// æ”¾ç½®åœ¨æ‚¨çš„å•†ä¼šäº¤æ˜“ç³»ç»Ÿå‡½æ•°åŒºåŸŸ
function openGuildTradeUI(guildId) {
    const ts = gameState.tradingSystem;
    const card = document.getElementById('tradingOverlayCard');
    const guildName = {east:'ä¸œå¸‚å•†ä¼š', west:'è¥¿å¸‚å•†ä¼š', south:'å—æ´‹å•†ä¼š', north:'å¡åŒ—å•†ä¼š'}[guildId];

    let goodsHTML = Object.entries(TRADING_GOODS_DATA)
        .filter(([id, data]) => data.guild === guildId)
        .map(([id, data]) => {
            const currentPrice = ts.marketStatus.prices[id];
            const change = (currentPrice - data.basePrice) / data.basePrice;
            const changePercent = (change * 100).toFixed(0);
            const trendClass = change > 0 ? 'text-gain' : (change < 0 ? 'text-loss' : '');
            const icon = change > 0 ? 'â–²' : (change < 0 ? 'â–¼' : '');
            
            return `
            <div class="marketplace-item">
                <span>
                    <strong>${data.name}</strong> (${data.type})<br>
                    <small>å½“å‰ä»·æ ¼: <span class="${trendClass}">${currentPrice} ä¸¤</span> ${icon}${changePercent}%</small>
                </span>
                <div>
                    <button class="control-btn" style="padding: 8px 12px; font-size: 0.9rem;" onclick="showBuySellModal('${id}', 'buy')">ä¹°å…¥</button>
                    <button class="control-btn" style="padding: 8px 12px; font-size: 0.9rem; background: var(--control-bg);" onclick="showBuySellModal('${id}', 'sell')">å–å‡º</button>
                </div>
            </div>`;
        }).join('');

    card.innerHTML = `
        <button class="overlay-close-btn" onclick="openTradingMainUI()">â€¹ è¿”å›</button>
        <div class="overlay-header">   ${guildName}   </div>
        <div class="overlay-content-wrapper">
             <div class="attribute" style="margin-top:10px;">
                ${renderAttributeBar('äº²å¯†åº¦', ts.guildFavor[guildId], 'charm-fill', 'fa-heart', 100)}
             </div>
            ${goodsHTML}
        </div>
    `;
}// æ”¾ç½®åœ¨æ‚¨çš„å•†ä¼šäº¤æ˜“ç³»ç»Ÿå‡½æ•°åŒºåŸŸ
function showBuySellModal(goodId, type) {
    const good = TRADING_GOODS_DATA[goodId];
    const ts = gameState.tradingSystem;
    const currentPrice = ts.marketStatus.prices[goodId];
    let contentHTML = '';

    if (type === 'buy') {
        const maxCanBuyByMoney = Math.floor(ts.moneyChest / currentPrice);
        const maxCanBuyBySpace = ts.warehouseCapacity - ts.warehouse.length;
        const maxCanBuy = Math.min(maxCanBuyByMoney, maxCanBuyBySpace);

        contentHTML = `
            <p>å½“å‰ä»·æ ¼: <span class="value">${currentPrice}</span> ä¸¤</p>
            <p>é’±æŸœä½™é¢: ${ts.moneyChest} ä¸¤ | ä»“åº“å‰©ä½™: ${maxCanBuyBySpace} æ ¼</p>
            <p class="comment">æœ€å¤šå¯ä¹°: ${maxCanBuy} ä»¶</p>
            <div class="quantity-slider-container">
                <input type="range" id="tradeQuantitySlider" value="1" min="1" max="${maxCanBuy}" oninput="this.nextElementSibling.value = this.value">
                <input type="number" id="tradeQuantityInput" value="1" min="1" max="${maxCanBuy}" oninput="this.previousElementSibling.value = this.value">
            </div>
        `;
        const options = [{
            htmlContent: 'ç¡®è®¤è´­ä¹°',
            disabled: maxCanBuy <= 0,
            callback: () => {
                const quantity = parseInt(document.getElementById('tradeQuantityInput').value);
                if (isNaN(quantity) || quantity <= 0 || quantity > maxCanBuy) {
                    showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„è´­ä¹°æ•°é‡ã€‚"); return;
                }
                processTrade(goodId, 'buy', quantity, currentPrice);
            }
        }];
        showDecisionCard(`è´­ä¹° ${good.name}`, 'fa-shopping-cart', contentHTML, options);

    } else { // sell
        const itemsToSell = ts.warehouse.filter(item => item.id === goodId);
        const totalQuantity = itemsToSell.length;
        if (totalQuantity === 0) {
            showToast(`ä½ çš„ä»“åº“é‡Œæ²¡æœ‰ ${good.name}ã€‚`); return;
        }

        const totalValue = totalQuantity * currentPrice;

        contentHTML = `
            <p>å½“å‰å”®ä»·: <span class="value">${currentPrice}</span> ä¸¤</p>
            <p>ä½ å…±æŒæœ‰: ${totalQuantity} ä»¶ (æ€»ä»·å€¼: ${totalValue} ä¸¤)</p>
            <div class="quantity-slider-container">
                <input type="range" id="tradeQuantitySlider" value="1" min="1" max="${totalQuantity}" oninput="this.nextElementSibling.value = this.value">
                <input type="number" id="tradeQuantityInput" value="1" min="1" max="${totalQuantity}" oninput="this.previousElementSibling.value = this.value">
            </div>
        `;
        const options = [{
            htmlContent: 'ç¡®è®¤å‡ºå”®',
            callback: () => {
                const quantity = parseInt(document.getElementById('tradeQuantityInput').value);
                if (isNaN(quantity) || quantity <= 0 || quantity > totalQuantity) {
                    showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„å‡ºå”®æ•°é‡ã€‚"); return;
                }
                processTrade(goodId, 'sell', quantity, currentPrice);
            }
        }];
        showDecisionCard(`å‡ºå”® ${good.name}`, 'fa-tag', contentHTML, options);
    }
}
// æ ¸å¿ƒäº¤æ˜“å¤„ç†å‡½æ•°
function processTrade(goodId, type, quantity, price, instanceId = null) {
    const ts = gameState.tradingSystem;
    const good = TRADING_GOODS_DATA[goodId];
    let finalPrice = price; 

    if (type === 'buy') {
        const totalCost = finalPrice * quantity;
        ts.moneyChest -= totalCost;
        for (let i = 0; i < quantity; i++) {
            ts.warehouse.push({
                instanceId: Date.now() + i,
                id: goodId,
                buyPrice: finalPrice,
                boughtAt: { ...gameState.date }
            });
        }
        ts.tradeLog.unshift(`ä¹°å…¥ ${quantity} ä»¶ ${good.name}ï¼ŒèŠ±è´¹ ${totalCost} ä¸¤ã€‚`);
        showToast(`æˆåŠŸè´­ä¹° ${quantity} ä»¶ ${good.name}ã€‚`);
    } else { // sell
        let totalProfit = 0;
        let itemsToRemove = [];
        // æ‰¾åˆ°æ‰€æœ‰è¯¥ç‰©å“çš„å®ä¾‹
        const allMatchingItems = ts.warehouse.filter(item => item.id === goodId);
        // é»˜è®¤æŒ‰å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰å–å‡ºï¼Œä¹Ÿå°±æ˜¯ç§»é™¤æ•°ç»„å‰é¢çš„å…ƒç´ 
        itemsToRemove = allMatchingItems.slice(0, quantity);

        itemsToRemove.forEach(item => {
            totalProfit += (finalPrice - item.buyPrice);
        });

        // ä»ä»“åº“ä¸­ç§»é™¤è¿™äº›ç‰©å“
        itemsToRemove.forEach(itemToRemove => {
            const index = ts.warehouse.findIndex(item => item.instanceId === itemToRemove.instanceId);
            if (index > -1) {
                ts.warehouse.splice(index, 1);
            }
        });

        const totalIncome = finalPrice * quantity;
        ts.moneyChest += totalIncome;

        const profitText = totalProfit > 0 ? `ç›ˆåˆ© ${totalProfit}` : (totalProfit < 0 ? `äºæŸ ${-totalProfit}` : `ä¸èµšä¸äº`);
        ts.tradeLog.unshift(`å–å‡º ${quantity} ä»¶ ${good.name}ï¼Œè·å¾— ${totalIncome} ä¸¤ï¼Œ${profitText}ã€‚`);
        showToast(`æˆåŠŸå–å‡º ${quantity} ä»¶ ${good.name}ã€‚`);
    }

    const guildId = good.guild;
    const favorGain = Math.ceil((finalPrice * quantity) / 200);
    ts.guildFavor[guildId] = Math.min(100, (ts.guildFavor[guildId] || 0) + favorGain);

    closeAllOverlays();
    openGuildTradeUI(guildId); // åˆ·æ–°å½“å‰å•†ä¼šç•Œé¢
}
function showWarehouseUI() {
    const ts = gameState.tradingSystem;
    const currentLevelIndex = WAREHOUSE_LEVELS.findIndex(l => l.capacity === ts.warehouseCapacity);
    const currentLevel = WAREHOUSE_LEVELS[currentLevelIndex] || WAREHOUSE_LEVELS[0];
    const nextLevel = WAREHOUSE_LEVELS[currentLevelIndex + 1];
    
    const groupedItems = ts.warehouse.reduce((acc, item) => {
        if (!acc[item.id]) {
            acc[item.id] = { items: [], total: 0, totalCost: 0 };
        }
        acc[item.id].items.push(item);
        acc[item.id].total++;
        acc[item.id].totalCost += item.buyPrice;
        return acc;
    }, {});

    let itemsHTML = Object.keys(groupedItems).length > 0
        ? Object.entries(groupedItems).map(([goodId, data]) => {
            const good = TRADING_GOODS_DATA[goodId];
            const avgCost = (data.totalCost / data.total).toFixed(2);
            // ã€æ–°å¢ã€‘è·å–å½“å‰å¸‚ä»·
            const currentPrice = ts.marketStatus.prices[goodId] || good.basePrice;
            const potentialProfit = (currentPrice - avgCost) * data.total;
            const profitClass = potentialProfit > 0 ? 'text-gain' : (potentialProfit < 0 ? 'text-loss' : '');

            return `
            <div class="event" style="margin-bottom: 10px; padding: 12px;">
                <div class="inventory-item-name" style="font-size: 1.1em; display:flex; justify-content:space-between; align-items:center;">
                    ${good.name} <span style="font-weight:normal;">(å…± ${data.total} ä»¶)</span>
                    
                </div>
                <div class="inventory-item-desc">
                    å¹³å‡æˆæœ¬: ${avgCost} ä¸¤ | <strong>å½“å‰å¸‚ä»·: ${currentPrice} ä¸¤</strong>
                    <br>
                    <span class="${profitClass}">é¢„è®¡æ€»åˆ©æ¶¦: ${potentialProfit.toFixed(0)} ä¸¤</span>
                </div>
                <button class="control-btn" style="padding: 8px 12px; font-size: 0.9rem; margin-top: 10px; background: var(--control-shadow-hover);" 
                        onclick="showSellFromWarehouseModal('${goodId}')">
                     <i class="fas fa-tag"></i> å–å‡º
                </button>
            </div>`;
        }).join('')
        : '<p class="comment" style="text-align:center; padding: 20px 0;">ä½ çš„ä»“åº“ç©ºç©ºå¦‚ä¹Ÿã€‚</p>';

    let upgradeHTML = '';
    if (nextLevel) {
        upgradeHTML = `
            <div class="section-header" style="margin-top:20px;"><i class="fas fa-arrow-up"></i> ä»“åº“å‡çº§</div>
            <div class="event">
                <p>ä¸‹ä¸€ç­‰çº§: <strong>${nextLevel.name}</strong></p>
                <p>å®¹é‡æå‡è‡³: <span class="value">${nextLevel.capacity}</span></p>
                <p>å‡çº§è´¹ç”¨: <span class="value">${nextLevel.upgradeCost}</span> ä¸¤</p>
                <button class="option" style="width:100%; margin-top:10px;" 
                    ${gameState.finances.wealth < nextLevel.upgradeCost ? 'disabled' : ''}
                    onclick="upgradeWarehouse(${currentLevelIndex + 1})">
                    <i class="fas fa-hammer"></i> æ”¯ä»˜å‡çº§
                </button>
            </div>
        `;
    } else {
        upgradeHTML = `<p class="comment" style="text-align:center; margin-top:20px;">ä»“åº“å·²æ˜¯æœ€é«˜ç­‰çº§ã€‚</p>`;
    }

    const content = `
        <p style="text-align:center;">å½“å‰ç­‰çº§: <strong>${currentLevel.name}</strong> | å®¹é‡: ${ts.warehouse.length} / ${ts.warehouseCapacity}</p>
        <div class="overlay-content-wrapper" style="margin-top: 15px; max-height: 40vh;">${itemsHTML}</div>
        ${upgradeHTML}
    `;
    
    showDecisionCard('ä»“åº“ç®¡ç†', 'fa-warehouse', content, []);
}// ===================== ã€æ–°å¢ã€‘showSellFromWarehouseModal å‡½æ•° START =====================
function showSellFromWarehouseModal(goodId) {
    const good = TRADING_GOODS_DATA[goodId];
    const ts = gameState.tradingSystem;
    const currentPrice = ts.marketStatus.prices[goodId];
    
    const itemsToSell = ts.warehouse.filter(item => item.id === goodId);
    const totalQuantity = itemsToSell.length;
    if (totalQuantity === 0) {
        showToast(`ä½ çš„ä»“åº“é‡Œæ²¡æœ‰ ${good.name}ã€‚`); return;
    }

    const totalValue = totalQuantity * currentPrice;

    const contentHTML = `
        <p>å½“å‰å”®ä»·: <span class="value">${currentPrice}</span> ä¸¤</p>
        <p>ä½ å…±æŒæœ‰: ${totalQuantity} ä»¶ (æ€»ä»·å€¼: ${totalValue} ä¸¤)</p>
        <div class="quantity-slider-container">
            <input type="range" id="tradeQuantitySlider" value="${totalQuantity}" min="1" max="${totalQuantity}" oninput="this.nextElementSibling.value = this.value">
            <input type="number" id="tradeQuantityInput" value="${totalQuantity}" min="1" max="${totalQuantity}" oninput="this.previousElementSibling.value = this.value">
        </div>
    `;
    const options = [{
        htmlContent: 'ç¡®è®¤å‡ºå”®',
        callback: () => {
            const quantity = parseInt(document.getElementById('tradeQuantityInput').value);
            if (isNaN(quantity) || quantity <= 0 || quantity > totalQuantity) {
                showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„å‡ºå”®æ•°é‡ã€‚");
                return;
            }
            processTradeFromWarehouse(goodId, 'sell', quantity, currentPrice);
        }
    }];
    showDecisionCard(`å‡ºå”® ${good.name}`, 'fa-tag', contentHTML, options);
}
// ===================== ã€æ–°å¢ã€‘showSellFromWarehouseModal å‡½æ•° END =====================
// ===================== ã€æ–°å¢ã€‘processTradeFromWarehouse å‡½æ•° START =====================
function processTradeFromWarehouse(goodId, type, quantity, price) {
    const ts = gameState.tradingSystem;
    const good = TRADING_GOODS_DATA[goodId];
    
    let totalProfit = 0;
    // æ‰¾åˆ°æ‰€æœ‰è¯¥ç‰©å“çš„å®ä¾‹
    const allMatchingItems = ts.warehouse.filter(item => item.id === goodId);
    // æŒ‰å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰å–å‡º
    const itemsToRemove = allMatchingItems.slice(0, quantity);

    itemsToRemove.forEach(item => {
        totalProfit += (price - item.buyPrice);
    });

    // ä»ä»“åº“ä¸­ç§»é™¤è¿™äº›ç‰©å“
    itemsToRemove.forEach(itemToRemove => {
        const index = ts.warehouse.findIndex(item => item.instanceId === itemToRemove.instanceId);
        if (index > -1) {
            ts.warehouse.splice(index, 1);
        }
    });

    const totalIncome = price * quantity;
    ts.moneyChest += totalIncome;

    const profitText = totalProfit > 0 ? `ç›ˆåˆ© ${totalProfit}` : (totalProfit < 0 ? `äºæŸ ${-totalProfit}` : `ä¸èµšä¸äº`);
    ts.tradeLog.unshift(`å–å‡º ${quantity} ä»¶ ${good.name}ï¼Œè·å¾— ${totalIncome} ä¸¤ï¼Œ${profitText}ã€‚`);
    showToast(`æˆåŠŸå–å‡º ${quantity} ä»¶ ${good.name}ã€‚`);

    closeAllOverlays();
    // åˆ·æ–°ä»“åº“ç•Œé¢
    showWarehouseUI();
}
// ===================== ã€æ–°å¢ã€‘processTradeFromWarehouse å‡½æ•° END =====================
function upgradeWarehouse(levelIndex) {
    const ts = gameState.tradingSystem;
    const levelData = WAREHOUSE_LEVELS[levelIndex];
    if (!levelData) return;
    if (gameState.finances.wealth < levelData.upgradeCost) {
        showToast("å‡çº§èµ„é‡‘ä¸è¶³ï¼");
        return;
    }
    applyEffects({ wealth: -levelData.upgradeCost });
    ts.warehouseCapacity = levelData.capacity;
    showEventCard('ä»“åº“å‡çº§æˆåŠŸ', 'fa-hammer', `ä½ èŠ±è´¹ ${levelData.upgradeCost} ä¸¤ï¼Œå°†ä»“åº“å‡çº§ä¸ºã€${levelData.name}ã€‘ï¼Œå®¹é‡æ‰©å¤§è‡³ ${levelData.capacity}ï¼`);
    // å‡çº§ååˆ·æ–°ä»“åº“ç®¡ç†ç•Œé¢
    showWarehouseUI();
}
function showTradeLogUI() {
    const ts = gameState.tradingSystem;
    const card = document.getElementById('tradingOverlayCard');

    let logHTML = ts.tradeLog.length > 0
        ? ts.tradeLog.map(log => `<div class="event-content" style="padding: 5px 0; border-bottom: 1px dashed var(--border-color-light);">${log}</div>`).join('')
        : '<p class="comment">æš‚æ— äº¤æ˜“è®°å½•ã€‚</p>';

    card.innerHTML = `
        <button class="overlay-close-btn" onclick="openTradingMainUI()">â€¹ è¿”å›</button>
        <div class="overlay-header">   äº¤æ˜“è®°å½•   </div>
        <div class="overlay-content-wrapper event-log">${logHTML}</div>
    `;
}

function showMoneyChestUI() {
    const ts = gameState.tradingSystem;
    const card = document.getElementById('tradingOverlayCard');

    card.innerHTML = `
        <button class="overlay-close-btn" onclick="openTradingMainUI()">â€¹ è¿”å›</button>
        <div class="overlay-header">   é’±æŸœå­˜å–   </div>
        <div class="overlay-content-wrapper">
            <div class="trading-main-grid">
                <div class="trading-info-box"><h4><i class="fas fa-wallet"></i> ç§äº§</h4><div class="value">${formatNumber(gameState.finances.wealth)}</div></div>
                <div class="trading-info-box"><h4><i class="fas fa-cash-register"></i> é’±æŸœ</h4><div class="value">${formatNumber(ts.moneyChest)}</div></div>
            </div>
            <p class="comment" style="text-align:center;">èµ„é‡‘äº’è½¬éœ€ç¼´çº³1%çš„æ‰‹ç»­è´¹ã€‚</p>
            <div class="input-group" style="margin: 15px 0;">
                <input type="number" id="transferAmountInput" placeholder="è¾“å…¥è½¬ç§»é‡‘é¢" style="width: 100%;">
            </div>
            <div class="controls">
                <button class="control-btn" onclick="transferMoney('toChest')">å­˜å…¥é’±æŸœ â†’</button>
                <button class="control-btn" onclick="transferMoney('fromChest')">â† å–å‡ºç§äº§</button>
            </div>
        </div>
    `;
}

function transferMoney(direction) {
    const amount = parseInt(document.getElementById('transferAmountInput').value);
    if (isNaN(amount) || amount <= 0) {
        showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ã€‚");
        return;
    }

    const fee = Math.ceil(amount * 0.01);
    const ts = gameState.tradingSystem;

    if (direction === 'toChest') {
        if (gameState.finances.wealth < amount + fee) {
            showToast("ç§äº§ä¸è¶³ä»¥æ”¯ä»˜é‡‘é¢å’Œæ‰‹ç»­è´¹ã€‚");
            return;
        }
        gameState.finances.wealth -= (amount + fee);
        ts.moneyChest += amount;
        showToast(`æˆåŠŸå­˜å…¥ ${amount} ä¸¤ï¼Œæ‰‹ç»­è´¹ ${fee} ä¸¤ã€‚`);
    } else { // fromChest
        if (ts.moneyChest < amount) {
            showToast("é’±æŸœèµ„é‡‘ä¸è¶³ã€‚");
            return;
        }
        if (gameState.finances.wealth < fee) {
            showToast("ç§äº§ä¸è¶³ä»¥æ”¯ä»˜æ‰‹ç»­è´¹ã€‚");
            return;
        }
        ts.moneyChest -= amount;
        gameState.finances.wealth += (amount - fee);
        showToast(`æˆåŠŸå–å‡º ${amount} ä¸¤ï¼Œæ‰‹ç»­è´¹ ${fee} ä¸¤ã€‚`);
    }

    // åˆ·æ–°é’±æŸœç•Œé¢
    showMoneyChestUI();
}
function renderLogTab() {
    if (gameState.log.length === 0) {
        return '<h3 class="card-header">è®°äº‹ç°¿</h3><p class="comment" style="text-align:center;">å°šæœªæœ‰ä»»ä½•è®°å½•ã€‚</p>';
    }
    return `
    <h3 class="card-header">è®°äº‹ç°¿</h3>
    <div class="event-log">
        ${gameState.log.map(e =>`
        <div class="event" ${e.isYear ? `style="text-align:center; border-left-color: var(--highlight-strong);"` : ''}>
            <div class="event-content">${e.content}</div>
        </div>
        `).join('')}
    </div>`;
}

// =======================================================================
// ====================== PLAYER ACTION & CAREER =========================
// =======================================================================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (2/2)ã€‘ =====================
// ===================== ã€æ–°å¢ã€‘æ¿’æ­»æé†’å‡½æ•° START =====================
function checkLowHealthWarning() {
    if (gameState.player.health < 20 && !gameState.flags.lowHealthWarnedThisTurn) {
        gameState.flags.lowHealthWarnedThisTurn = true; // æ ‡è®°æœ¬å›åˆå·²è­¦å‘Šè¿‡ï¼Œé˜²æ­¢é‡å¤å¼¹çª—
        eventQueue.unshift(() => { // ä½¿ç”¨ unshift ç¡®ä¿æ­¤äº‹ä»¶æœ€å…ˆè§¦å‘
            const options = [
                { htmlContent: `<i class="fas fa-clinic-medical"></i> å‰å¾€åŒ»é¦†`, callback: () => showClinic() },
                { htmlContent: `<i class="fas fa-shopping-bag"></i> é€›å¸‚é›†è´­ä¹°è¡¥å“`, callback: () => showMarket() },
                { htmlContent: `<i class="fas fa-bed"></i> é™å¿ƒä¼‘å…»`, callback: () => {
                    applyEffects({attributes: {health: 5}});
                    showEventCard('é™å¿ƒä¼‘å…»', 'fa-bed', 'ä½ å†³å®šé™å¿ƒä¼‘å…»ï¼Œæ¢å¤äº†5ç‚¹å¥åº·ã€‚');
                }}
            ];
            showDecisionCard(
                'ç”Ÿå‘½å‚å±è­¦å‘Š',
                'fa-heartbeat',
                'ä½ çš„å¥åº·çŠ¶å†µå·²æå·®ï¼Œæœ‰æ€§å‘½ä¹‹è™ï¼è¯·ç«‹åˆ»è®¾æ³•è°ƒç†ï¼š<br>- å‰å¾€åŒ»é¦†å¯»åŒ»é—®è¯<br>- åœ¨å¸‚é›†è´­ä¹°äººå‚ç­‰è¡¥å“<br>- é€šè¿‡ä¿®èº«å…»æ€§æ¢å¤',
                options
            );
        });
    } else if (gameState.player.health >= 20) {
        delete gameState.flags.lowHealthWarnedThisTurn; // å¥åº·æ¢å¤åï¼Œé‡ç½®è­¦å‘Šæ ‡è®°
    }
}
// ===================== ã€æ–°å¢ã€‘æ¿’æ­»æé†’å‡½æ•° END =====================

function performAction(actionType) {
 if (gameState.flags.debug_unlimitedActions) {
        gameState.flags.actionUsed_study = 0;
    }
    let effects = {};
    let logText = '';
    const studyActions = ['study', 'art', 'etiquette', 'martial', 'needlework', 'strategy', 'scheming'];
    if (studyActions.includes(actionType)) {
        if ((gameState.flags.actionUsed_study || 0) >= 2) {
            showToast("æœ¬å›åˆä¿®èº«æ¬¡æ•°å·²ç”¨å°½ã€‚");
            return;
        }
        gameState.flags.actionUsed_study++;
        const isInspired = Math.random() < 0.1;
        const multiplier = isInspired ? 3 : 1;
        let inspirationText = isInspired ? '<strong class="value">ä½ ä»Šæ—¥æ–‡æ€æ³‰æ¶Œï¼Œç«Ÿæœ‰æ‰€é¡¿æ‚Ÿï¼</strong><br>' : '';

        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸï¼šé‡æ–°å¹³è¡¡å±æ€§å¢é•¿ã€‘ â–¼â–¼â–¼
        switch (actionType) {
            case 'study':
                effects = { wisdom: getRandomInt(6, 8) * multiplier, talent: getRandomInt(3, 6) * multiplier };
                logText = 'ä½ é™å¿ƒç ”è¯»è¯—ä¹¦ï¼Œå¯¹ä¸–äº‹æ´å¯Ÿæ›´æ·±ï¼Œæ–‡é‡‡æ–ç„¶ã€‚';
                break;
            case 'etiquette':
                effects = { etiquette: getRandomInt(6, 8) * multiplier, virtue: getRandomInt(3, 6) * multiplier };
                logText = 'ä½ å­¦ä¹ å¾…äººæ¥ç‰©çš„ç¤¼æ³•ï¼Œä¸ä»…ä¸¾æ­¢å¾—ä½“ï¼Œå“å¾·ä¹Ÿæ½œç§»é»˜åŒ–åœ°å¢é•¿ã€‚';
                break;
            case 'martial': // ç”·æ€§
                effects = { martial: getRandomInt(6, 8) * multiplier, health: getRandomInt(3, 6) * multiplier };
                logText = 'ä½ å‹¤ç»ƒæ­¦è‰ºï¼Œæ„Ÿè§‰èº«æ‰‹æ›´åŠ çŸ«å¥ï¼Œä½“é­„ä¹Ÿæ›´å¼ºå£®äº†ã€‚';
                break;
            case 'strategy': // ç”·æ€§
                effects = { strategy: getRandomInt(6, 8) * multiplier, charm: getRandomInt(3, 6) * multiplier };
                logText = 'ä½ ç ”è¯»å…µæ³•ï¼Œæ£æ‘©äººå¿ƒï¼Œæƒè°‹ä¹‹æœ¯ä¸äº¤é™…é­…åŠ›ä¸€å¹¶æå‡ã€‚';
                break;
            case 'needlework': // å¥³æ€§
                effects = { talent: getRandomInt(6, 8) * multiplier, charm: getRandomInt(3, 6) * multiplier };
                logText = 'é£é’ˆèµ°çº¿ä¹‹é—´ï¼Œä½ çš„ç»£å·¥åˆç²¾è¿›äº†ä¸å°‘ï¼Œæ°”è´¨ä¹Ÿæ„ˆå‘æ¸©å©‰åŠ¨äººã€‚';
                break;
            case 'scheming': // å¥³æ€§
                effects = { scheming: getRandomInt(6, 8) * multiplier, wisdom: getRandomInt(3, 6) * multiplier };
                logText = 'ä½ é™æ€å†…å®…ä¹‹äº‹ï¼Œæ´å¯Ÿäººå¿ƒï¼Œå¿ƒè®¡ä¸æ™ºæ…§éƒ½æ·±äº†ä¸€å±‚ã€‚';
                break;
            // â€œç´æ£‹ä¹¦ç”»â€è¢«ç§»é™¤ï¼Œå…¶åŠŸèƒ½å·²è¢«åˆå¹¶
        }
        // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²

        applyEffects({ attributes: effects });

        let effectsLog = Object.entries(effects).map(([k, v]) => `${ATTR_MAP[k] || k}+${v}`).join('ï¼Œ');
        showEventCard("ä¿®èº«æœ‰æˆ", "fa-book-reader", `${inspirationText}${logText}<br/>${effectsLog}`);

        renderGame();
    }
}
function startCareer(pathId) {
    if (gameState.career.path) {
        showToast("ä½ å·²ç»é€‰æ‹©äº†èŒä¸šï¼Œæ— æ³•æ›´æ”¹ã€‚");
        return;
    }
    if (gameState.player.age < 16) {
        showToast("éœ€å¹´æ»¡16å²æ–¹å¯é€‰æ‹©èŒä¸šã€‚");
        return;
    }

    const careerData = PROFESSION_DATA[pathId];
    if (!careerData) return;

    gameState.career.path = pathId;
    // ã€ä¿®å¤ã€‘èŒä¸šç­‰çº§ä»0å¼€å§‹
    gameState.career.level = 0; 
    gameState.career.currentAct = 0;
    gameState.career.performance = 0;
    
    // åˆå§‹åŒ–æ ¸å¿ƒèµ„æº
    careerData.core_resources.forEach(res => {
        gameState.career.core_resources[res] = 0;
    });

    showEventCard('å¼€å¯äº‹ä¸š', careerData.icon, `ä½ çš„äººç”Ÿç¿»å¼€äº†æ–°çš„ç¯‡ç« ï¼Œæ­£å¼è¸ä¸Šäº†ã€${careerData.name}ã€‘ä¹‹è·¯ï¼`);
    renderGame();
    updateActiveTab('career');
}
function work(type) {
    const { path, level } = gameState.career;
    if (!path) return;

    if(type==='regular') {
        if (gameState.flags.actionUsed_work >= 2) { showToast("ä½ ä»Šå¤©å·²ç»å¾ˆç´¯äº†ã€‚"); return; }
        gameState.flags.actionUsed_work++;
        const currentLevelData = careerPaths[gameState.player.gender][path].levels[level];
        const earnings = Math.floor(currentLevelData.salary * (getRandomInt(5, 15) / 100));
        const performanceGain = getRandomInt(3, 8);
        applyEffects({ wealth: earnings, attributes: { health: -1 } });
        gameState.career.performance += performanceGain;
        showEventCard('æ½œå¿ƒå·¥ä½œ', 'fa-pencil-ruler', `ä½ å‹¤å¥‹å·¥ä½œï¼Œä¸šç»©æå‡ã€‚åŠŸç»©+${performanceGain}ï¼Œå¹¶èµšå–äº† <span class="value">${earnings}</span> ä¸¤ã€‚`);
        logEvent(logText);
        
        showEventCard('æ½œå¿ƒå·¥ä½œ', 'fa-pencil-ruler', logText);
checkForPromotion();
    } else { // challenge
        const allChallenges = careerChallenges[path] || careerChallenges[Object.keys(careerChallenges)[0]]; // Fallback
        const availableChallenges = allChallenges.filter(c => c.level <= level);
        if (availableChallenges.length === 0) {
            showToast("å½“å‰æš‚æ— åˆé€‚çš„æŒ‘æˆ˜ã€‚");
            return;
        }
        const challenge = getRandomElement(availableChallenges);
        let challengeOptions = challenge.options.map((opt, index) => {
             const canAttempt = Object.entries(opt.req).every(([attr, val]) => (gameState.player.attributes[attr] || 0) >= val);
             const reqText = Object.entries(opt.req).map(([attr, val]) => `${ATTR_MAP[attr] || attr}â‰¥${val}`).join(', ');
             return {
                htmlContent: `<i class="fas fa-hand-pointer"></i><span class="option-text">${opt.text} <div><small>è¦æ±‚: ${reqText}</small></div></span>`,
                disabled: !canAttempt,
                callback: () => handleCareerChallengeResult(opt)
             };
        });
        
        const card = document.getElementById('careerChallengeOverlay');
        card.querySelector('#careerChallengeHeader').innerText = challenge.title;
        card.querySelector('#careerChallengeAnimation').innerHTML = 'âš”ï¸';
        card.querySelector('#careerChallengeContent').innerHTML = challenge.desc;
        showDecisionCard(challenge.title, 'âš”ï¸', challenge.desc, challengeOptions)
    }
}
function handleCareerChallengeResult(option) {
    const success = Object.entries(option.req).every(([attr, val]) => (gameState.player.attributes[attr] || 0) >= val * (0.8 + Math.random()*0.4));
    
     let resultText;
     let effectsToApply = {};
     if(success) {
        effectsToApply = option.success;
        resultText = "æŒ‘æˆ˜æˆåŠŸï¼"
     } else {
        effectsToApply = option.failure;
        resultText = "æŒ‘æˆ˜å¤±è´¥..."
     }
     
     if (effectsToApply.performance) {
        gameState.career.performance += effectsToApply.performance;
        resultText += `åŠŸç»©${effectsToApply.performance > 0 ? '+' : ''}${effectsToApply.performance}ã€‚`;
        delete effectsToApply.performance;
     }

     if (Object.keys(effectsToApply).length > 0) {
        applyEffects({attributes: effectsToApply});
        resultText += Object.entries(effectsToApply).map(([k,v]) => `${ATTR_MAP[k] || k}${v > 0 ? '+' : ''}${v}`).join(', ');
     }
    
     // [æ ¸å¿ƒä¿®æ”¹] å°† checkForPromotion ä½œä¸ºå›è°ƒå‡½æ•°ä¼ å…¥
     showEventCard('èŒä¸šæŒ‘æˆ˜', 'âš”ï¸', resultText, [{ text: 'çŸ¥é“äº†', callback: checkForPromotion }]);
}

function interactWithSupervisor(actionType) {
    const supervisor = gameState.npcs[gameState.career.supervisorId];
    if (!supervisor) return;
    supervisor.lastInteractedTurn = (gameState.date.year * 2) + gameState.date.turn;

    if (actionType === 'chat') {
        const favorGain = getRandomInt(2, 5) + (gameState.player.attributes.charm > 50 ? 2 : 0);
        applyEffects({relationship: {targetId: supervisor.id, favor: favorGain}});
        showEventCard('æ±‡æŠ¥å·¥ä½œ', 'fa-comments', `ä½ å‘ä¸Šå¸${supervisor.name}æ±‡æŠ¥äº†å·¥ä½œï¼Œå¯¹æ–¹å¯¹ä½ å°è±¡ä¸é”™ï¼Œå¥½æ„Ÿ+${favorGain}`);
    } else if (actionType === 'gift') {
        const costStr = prompt("è¯·è¾“å…¥èµ ç¤¼é‡‘é¢ (é‡‘é¢è¶Šé«˜æ•ˆæœè¶Šå¥½)", "100");
        const cost = parseInt(costStr);
        if(isNaN(cost) || cost <= 0) return;
        if(gameState.finances.wealth < cost) { showToast("èµ„é‡‘ä¸è¶³"); return; }
        
        const favorGain = Math.floor(cost / 20) + getRandomInt(1,5);
        applyEffects({wealth: -cost, relationship: {targetId: supervisor.id, favor: favorGain}});
        if(cost > 1000 && gameState.player.attributes.virtue < 50) {
            applyEffects({attributes: {virtue: -10}});
            showEventCard('èµ é€é‡ç¤¼', 'fa-gift', `ä½ èŠ±è´¹${cost}ä¸¤ä¸ºä¸Šå¸é€ä¸Šé‡ç¤¼ï¼Œå¯¹æ–¹æ¬£ç„¶æ”¶ä¸‹ï¼Œå¥½æ„Ÿ+${favorGain}ã€‚ä½†æ­¤ä¸¾æœ‰æŸå®˜å¾·ï¼Œå“å¾·-10ã€‚`);
        } else {
            showEventCard('èµ é€ç¤¼ç‰©', 'fa-gift', `ä½ èŠ±è´¹${cost}ä¸¤ä¸ºä¸Šå¸é€ä¸Šè–„ç¤¼ï¼Œå¯¹æ–¹å¯¹ä½ çš„å¥½æ„Ÿ+${favorGain}ã€‚`);
        }
    }
    renderGame();
}

// ===================== ã€æ–°å¢ã€‘æ¿’æ­»æé†’å‡½æ•° START =====================
function checkLowHealthWarning() {
    if (gameState.player.health < 20 && !gameState.flags.lowHealthWarnedThisTurn) {
        gameState.flags.lowHealthWarnedThisTurn = true; // æ ‡è®°æœ¬å›åˆå·²è­¦å‘Šè¿‡ï¼Œé˜²æ­¢é‡å¤å¼¹çª—
        eventQueue.unshift(() => { // ä½¿ç”¨ unshift ç¡®ä¿æ­¤äº‹ä»¶æœ€å…ˆè§¦å‘
            const options = [
                { htmlContent: `<i class="fas fa-clinic-medical"></i> å‰å¾€åŒ»é¦†`, callback: () => showClinic() },
                { htmlContent: `<i class="fas fa-shopping-bag"></i> é€›å¸‚é›†è´­ä¹°è¡¥å“`, callback: () => showMarket() },
                { htmlContent: `<i class="fas fa-bed"></i> é™å¿ƒä¼‘å…»`, callback: () => {
                    applyEffects({attributes: {health: 5}});
                    showEventCard('é™å¿ƒä¼‘å…»', 'fa-bed', 'ä½ å†³å®šé™å¿ƒä¼‘å…»ï¼Œæ¢å¤äº†5ç‚¹å¥åº·ã€‚');
                }}
            ];
            showDecisionCard(
                'ç”Ÿå‘½å‚å±è­¦å‘Š',
                'fa-heartbeat',
                'ä½ çš„å¥åº·çŠ¶å†µå·²æå·®ï¼Œæœ‰æ€§å‘½ä¹‹è™ï¼è¯·ç«‹åˆ»è®¾æ³•è°ƒç†ï¼š<br>- å‰å¾€åŒ»é¦†å¯»åŒ»é—®è¯<br>- åœ¨å¸‚é›†è´­ä¹°äººå‚ç­‰è¡¥å“<br>- é€šè¿‡ä¿®èº«å…»æ€§æ¢å¤',
                options
            );
        });
    } else if (gameState.player.health >= 20) {
        delete gameState.flags.lowHealthWarnedThisTurn; // å¥åº·æ¢å¤åï¼Œé‡ç½®è­¦å‘Šæ ‡è®°
    }
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€ç¬¬ä¸€æ­¥ï¼šè¯·å°†æ­¤å‡½æ•°å®Œæ•´ç²˜è´´åˆ° checkForPromotion çš„ä¸Šæ–¹ã€‘ =====================
// ===================== ã€æ–°å¢ã€‘å‡èŒæŒ‰é’®ç»Ÿä¸€å¤„ç†å‡½æ•° =====================
function handlePromotionClick() {
    const c = gameState.career;
    if (!c.path) return;

    const currentPathLevels = careerPaths[gameState.player.gender][c.path];
    if (!currentPathLevels) return;

    const nextLevel = c.level < currentPathLevels.levels.length - 1 ? currentPathLevels.levels[c.level + 1] : null;
    if (!nextLevel) return; // å·²æ˜¯æœ€é«˜ç­‰çº§

    const performanceMet = c.performance >= nextLevel.promotion_points;

    if (performanceMet) {
        // å¦‚æœåŠŸç»©æ»¡è¶³ï¼Œåˆ™è°ƒç”¨åŸæœ‰çš„æ™‹å‡æ£€æŸ¥å‡½æ•°
        manualPromotionCheck();
    } else {
        // å¦‚æœåŠŸç»©ä¸æ»¡è¶³ï¼Œåˆ™å¼¹å‡ºæç¤º
        showToast('åŠŸç»©æœªæ»¡ï¼Œæ— æ³•æ™‹å‡ã€‚');
    }
}
/**
 * [æ–°å¢] æ‰‹åŠ¨æ™‹å‡æ£€æŸ¥å‡½æ•°
 * å½“ç©å®¶ç‚¹å‡»â€œå‡èŒâ€æŒ‰é’®æ—¶è§¦å‘
 */
function manualPromotionCheck() {
    const c = gameState.career;
    if (!c.path) return;

    const currentPath = careerPaths[gameState.player.gender][c.path];
    if (!currentPath || c.level >= currentPath.levels.length - 1) return;

    const nextLevel = currentPath.levels[c.level + 1];

    // æ£€æŸ¥åŠŸç»©æ˜¯å¦è¾¾æ ‡
    if (c.performance < nextLevel.promotion_points) {
        showToast("åŠŸç»©å°šæœªè¾¾æ ‡ï¼Œæ— æ³•æ™‹å‡ã€‚");
        return;
    }
    
    // æ£€æŸ¥å±æ€§æ˜¯å¦è¾¾æ ‡
    const canPromote = Object.entries(nextLevel.req).every(([attr, val]) => {
        let playerVal = 0;
        if (attr === 'reputation') {
            playerVal = gameState.family.reputation || 0;
        } else {
            playerVal = gameState.player.attributes[attr] || 0;
        }
        return playerVal >= val;
    });

    let headerText, contentText;
    if (canPromote) {
        // åŠŸç»©å’Œå±æ€§éƒ½è¾¾æ ‡ï¼Œè§¦å‘æ™‹å‡æŒ‘æˆ˜
        headerText = 'æ™‹å‡æŒ‘æˆ˜';
        contentText = `ä½ çš„åŠŸç»©å·²ç»è¾¾åˆ°è¦æ±‚ï¼Œä½†è¦æ›´è¿›ä¸€æ­¥ï¼Œè¿˜éœ€è¦é€šè¿‡ä¸€ä¸ªæŒ‘æˆ˜ã€‚ä½ æ˜¯å¦æ¥å—è¿™ä¸ªæŒ‘æˆ˜ï¼Ÿ<br><br><strong>æŒ‘æˆ˜æˆåŠŸï¼š</strong> æˆåŠŸæ™‹å‡ï¼Œå£°æœ›å¤§æ¶¨ã€‚<br><strong>æŒ‘æˆ˜å¤±è´¥ï¼š</strong> åŠŸç»©æ¸…é›¶ï¼Œç•™å®ˆåŸèŒï¼Œä½†ä¼šè·å¾—ä¸€ç¬”å®‰æŠšé‡‘ã€‚`;
        const options = [
            {
                htmlContent: '<i class="fas fa-gavel"></i> æ¥å—æŒ‘æˆ˜',
                callback: () => handlePromotionChallenge(canPromote)
            },
            {
                htmlContent: '<i class="fas fa-times"></i> æ‹’ç»æŒ‘æˆ˜',
                callback: () => {
                    showEventCard('è°¨æ…è¡Œäº‹', 'fa-arrow-down', 'ä½ é€‰æ‹©æš‚æ—¶ä¸æŒ‘æˆ˜æ™‹å‡ï¼ŒåŠŸç»©è¢«æ¸…é›¶ï¼Œä½†ä½ ä¿ä½äº†å½“å‰çš„ä¸€åˆ‡ã€‚');
                    c.performance = 0;
                    closeAllOverlays();
                    renderGame();
                }
            }
        ];
        showDecisionCard(headerText, 'fa-arrow-up', contentText, options);
    } else {
        // åŠŸç»©è¾¾æ ‡ï¼Œä½†å±æ€§ä¸è¶³
        headerText = 'èƒ½åŠ›ä¸è¶³';
        contentText = `ä½ çš„åŠŸç»©å·²ç»è¾¾åˆ°è¦æ±‚ï¼Œä½†èƒ½åŠ›å°šæœ‰ä¸è¶³ï¼Œæ— æ³•æŒ‘æˆ˜æ™‹å‡ã€‚ä½ å°†è·å¾—ä¸€ç¬”åŠ è–ªä½œä¸ºå¥–åŠ±ã€‚`;
        const salaryGain = Math.floor(currentPath.levels[c.level].salary * 0.05);
        applyEffects({ wealth: salaryGain });
        c.performance = nextLevel.promotion_points - 20; // åŠŸç»©ç•¥å¾®é™ä½ï¼Œé˜²æ­¢é‡å¤åˆ·é’±
        showEventCard('åŠŸç»©å“è‘—', 'fa-award', contentText + `è·å¾—åŠ è–ª <span class="value">${salaryGain * 2}</span> ä¸¤ã€‚`);
        renderGame();
    }
}
function checkForPromotion() {
    const c = gameState.career;
    if (!c.path) return;

    const currentPath = careerPaths[gameState.player.gender][c.path];
    if (!currentPath || c.level >= currentPath.levels.length - 1) return;

    const nextLevel = currentPath.levels[c.level + 1];

    // ç¡®ä¿åŠŸç»©ä¸ä¼šè¶…å‡ºä¸Šé™
    if (c.performance > nextLevel.promotion_points) {
        c.performance = nextLevel.promotion_points;
    }

    // æ£€æŸ¥åŠŸç»©æ˜¯å¦è¾¾æ ‡
    if (c.performance >= nextLevel.promotion_points) {
        
        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤åŒºåŸŸã€‘ â–¼â–¼â–¼
        // æ­¤å¤„é‡å†™äº†å±æ€§æ£€æŸ¥çš„é€»è¾‘ï¼Œä½¿å…¶æ›´æ¸…æ™°ä¸”æ— è¯¯
        const canPromote = Object.entries(nextLevel.req).every(([attr, val]) => {
            let playerVal = 0;
            // å¦‚æœè¦æ±‚çš„æ˜¯â€œå£°æœ›â€ï¼Œåˆ™ä» family å¯¹è±¡ä¸­è·å–
            if (attr === 'reputation') {
                playerVal = gameState.family.reputation || 0;
            } else {
                // å¦åˆ™ï¼Œä» player.attributes å¯¹è±¡ä¸­è·å–
                playerVal = gameState.player.attributes[attr] || 0;
            }
            return playerVal >= val;
        });
        // â–²â–²â–² ã€ä¿®å¤ç»“æŸã€‘ â–²â–²â–²

        let headerText, contentText;
        if (canPromote) {
            headerText = 'æ™‹å‡æŒ‘æˆ˜';
            contentText = `ä½ çš„åŠŸç»©å·²ç»è¾¾åˆ°è¦æ±‚ï¼Œä½†è¦æ›´è¿›ä¸€æ­¥ï¼Œè¿˜éœ€è¦é€šè¿‡ä¸€ä¸ªæŒ‘æˆ˜ã€‚ä½ æ˜¯å¦æ¥å—è¿™ä¸ªæŒ‘æˆ˜ï¼Ÿ<br><br><strong>æŒ‘æˆ˜æˆåŠŸï¼š</strong> æˆåŠŸæ™‹å‡ï¼Œå£°æœ›å¤§æ¶¨ã€‚<br><strong>æŒ‘æˆ˜å¤±è´¥ï¼š</strong> åŠŸç»©æ¸…é›¶ï¼Œç•™å®ˆåŸèŒï¼Œä½†ä¼šè·å¾—ä¸€ç¬”å®‰æŠšé‡‘ã€‚`;
        } else {
            headerText = 'èƒ½åŠ›ä¸è¶³';
            contentText = `ä½ çš„åŠŸç»©å·²ç»è¾¾åˆ°è¦æ±‚ï¼Œä½†èƒ½åŠ›å°šæœ‰ä¸è¶³ï¼Œæ— æ³•æŒ‘æˆ˜æ™‹å‡ã€‚ä½ å°†è·å¾—ä¸€ç¬”åŠ è–ªä½œä¸ºå¥–åŠ±ã€‚`;
            const salaryGain = Math.floor(currentPath.levels[c.level].salary * 0.05);
            applyEffects({ wealth: salaryGain });
            c.performance = nextLevel.promotion_points - 20;
            showEventCard('åŠŸç»©å“è‘—', 'fa-award', contentText + `è·å¾—åŠ è–ª <span class="value">${salaryGain * 2}</span> ä¸¤ã€‚`);
            renderGame();
            return;
        }

        const options = [
            {
                htmlContent: '<i class="fas fa-gavel"></i> æ¥å—æŒ‘æˆ˜',
                callback: () => handlePromotionChallenge(canPromote)
            },
            {
                htmlContent: '<i class="fas fa-times"></i> æ‹’ç»æŒ‘æˆ˜',
                callback: () => {
                    if (canPromote) {
                        showEventCard('è°¨æ…è¡Œäº‹', 'fa-arrow-down', 'ä½ é€‰æ‹©æš‚æ—¶ä¸æŒ‘æˆ˜æ™‹å‡ï¼ŒåŠŸç»©è¢«æ¸…é›¶ï¼Œä½†ä½ ä¿ä½äº†å½“å‰çš„ä¸€åˆ‡ã€‚');
                        c.performance = 0;
                    }
                    closeAllOverlays();
                    renderGame();
                }
            }
        ];
        showDecisionCard(headerText, 'fa-arrow-up', contentText, options);
    }
}// æ–°å¢å‡½æ•°ï¼šå¤„ç†æ™‹å‡æŒ‘æˆ˜çš„å®é™…é€»è¾‘
// [æ›¿æ¢æ­¤å‡½æ•°]
function handlePromotionChallenge(canPromote) {
    const c = gameState.career;
    const currentPath = careerPaths[gameState.player.gender][c.path];
    const nextLevel = currentPath.levels[c.level + 1];
    const coreStats = CAREER_CORE_STATS[c.path] || ['wisdom'];
    let totalCoreStatValue = 0;
    coreStats.forEach(attr => {
        totalCoreStatValue += (gameState.player.attributes[attr] || 0);
    });
    let successRate = 0.4 + (totalCoreStatValue / coreStats.length) / 200;
    successRate = Math.min(0.95, successRate);
    if (Math.random() < successRate) {
        c.level++;
        c.performance = 0;
        const newTitle = currentPath.levels[c.level].title;
        const salaryGain = currentPath.levels[c.level].salary - currentPath.levels[c.level - 1].salary;
        applyEffects({ wealth: salaryGain, reputation: 20 });
        const msg = `æ­å–œï¼ä½ æˆåŠŸé€šè¿‡æ™‹å‡æŒ‘æˆ˜ï¼Œæ™‹å‡ä¸º<strong class="value">${newTitle}</strong>ï¼ä¿¸ç¦„æå‡ï¼Œå¹¶è·å¾—å¥–åŠ± <span class="value">${salaryGain * 2}</span> ä¸¤ã€‚`;
        
        // â–¼â–¼â–¼ ã€æ–°å¢ã€‘è®°äº‹åŠŸèƒ½ â–¼â–¼â–¼
        logEvent(`ä½ åœ¨äº‹ä¸šä¸Šå–å¾—é‡å¤§çªç ´ï¼Œæ™‹å‡ä¸ºã€${newTitle}ã€‘ï¼`, true);
        // â–²â–²â–² ã€æ–°å¢ç»“æŸã€‘ â–²â–²â–²
        
        showEventCard(' æ™‹å‡ä¹‹å–œ ', 'fa-crown', msg);
    } else {
        const salaryGain = Math.floor(currentPath.levels[c.level].salary * 0.1);
        applyEffects({ wealth: salaryGain });
        c.performance = 0;
        const msg = `æŒ‘æˆ˜å¤±è´¥ï¼ä½ ç•™å®ˆåŸèŒï¼ŒåŠŸç»©æ¸…é›¶ï¼Œä½†è·å¾—äº†ä¸€ç¬” <span class="value">${salaryGain * 2}</span> ä¸¤çš„å®‰æŠšé‡‘ã€‚`;
        showEventCard('æŒ‘æˆ˜å¤±è´¥', 'fa-frown', msg);
    }
    renderGame();
}
function showAssetsOverlay() {
    let html = ``;
    const residenceData = [
        { id: 'small_courtyard', name: 'å°å·§åº­é™¢', cost: 20000, capacity: 5, type: 'residence' },
        { id: 'three_entry_mansion', name: 'ä¸‰è¿›åºœé‚¸', cost: 100000, capacity: 15, type: 'residence' },
        { id: 'prince_manor', name: 'äº²ç‹è§„åˆ¶å®…é‚¸', cost: 500000, capacity: 30, type: 'residence' },
    ];
    html += `<div class="section-header"><i class="fas fa-home"></i> æˆ¿äº§</div>`;
    const ownedResidences = gameState.finances.assets.filter(c => c.type === 'residence');
    if (ownedResidences.length > 0) {
        html += ownedResidences.map(r => `<div class="marketplace-item"><span>${r.name} (å¯å®¹çº³${r.capacity}äºº)</span><span>å·²è´­ç½®</span></div>`).join('');
    } else {
        html += `<p class="comment" style="padding-left:15px;">æš‚æœªè´­ç½®åºœé‚¸ã€‚</p>`;
    }
    const currentOccupants = 1 + (gameState.marriage.isMarried ? 1 : 0) + gameState.marriage.concubines.length + gameState.children.filter(c=>!c.isDead).length;
    const totalCapacity = ownedResidences.reduce((sum, r) => sum + r.capacity, 5);
    html += `<p class="comment" style="padding-left:15px;">å½“å‰å±…ä½: ${currentOccupants}äºº / æ€»å®¹é‡: ${totalCapacity}äºº</p>`;
    html += `<div class="options" style="flex-direction: column; gap: 10px;">`;
    residenceData.forEach(r => {
            html += `<button class="option" ${gameState.finances.wealth < r.cost ? 'disabled' : ''} onclick="buyAsset('${r.id}')"><i class="fas fa-key"></i>${r.name} (-${formatNumber(r.cost)}ä¸¤)</button>`;
    });
    html += `</div>`;
    html += `<div class="section-header"><i class="fas fa-gem"></i> è—å“</div>`;
    const collectibles = gameState.finances.assets.filter(c => c.type === 'collectible');
    if (collectibles.length > 0) {
        html += collectibles.map(item => `
        <div class="marketplace-item">
            <span>${item.name}</span>
            <span>è´­å…¥: ${formatNumber(item.purchasePrice)} | ç°å€¼: ${formatNumber(item.currentValue)}</span>
        </div>`).join('');
    } else {
        html += `<p class="comment" style="padding-left:15px;">æš‚æ— æ”¶è—ã€‚</p>`;
    }
    html += `<p class="comment" style="padding-left:15px; margin-top:10px;">å¯å‰å¾€å¸‚é›†æœç½—å¤è‘£å­—ç”»ã€‚</p>`;

    document.getElementById('assetsContent').innerHTML = html;
    showOverlay('assetsOverlay');

}
function buyAsset(assetId) {
    const allItems = [
        ...marketItems.common, ...marketItems.female, ...marketItems.male,
        { id: 'small_courtyard', name: 'å°å·§åº­é™¢', cost: 20000, capacity: 5, type: 'residence' },
        { id: 'three_entry_mansion', name: 'ä¸‰è¿›åºœé‚¸', cost: 100000, capacity: 15, type: 'residence' },
        { id: 'prince_manor', name: 'äº²ç‹è§„åˆ¶å®…é‚¸', cost: 500000, capacity: 30, type: 'residence' },
    ];
    const item = allItems.find(i => i.id === assetId);
    if (!item) return;
    const cost = item.price || item.cost;
    if (gameState.finances.wealth < cost) { showToast("èµ„é‡‘ä¸è¶³ã€‚"); return; }
    if (item.type !== 'residence' && gameState.finances.assets.some(c => c.id === assetId)) { showToast("ä½ å·²ç»æ‹¥æœ‰æ­¤ç‰©ã€‚"); return; }
    applyEffects({ wealth: -cost });
    let newAsset;
    if (item.type === 'residence') {
        newAsset = { id: `residence_${item.id}_${Date.now()}`, name: item.name, type: item.type, purchasePrice: cost, currentValue: cost, baseAppreciation: item.baseAppreciation || 0, capacity: item.capacity || 0 };
        
        // â–¼â–¼â–¼ ã€æ–°å¢ã€‘è®°äº‹åŠŸèƒ½ â–¼â–¼â–¼
        logEvent(`ä½ è´­ç½®äº†ä¸€å¥—æ–°çš„åºœé‚¸ï¼šã€${item.name}ã€‘ã€‚`, true);
        // â–²â–²â–² ã€æ–°å¢ç»“æŸã€‘ â–²â–²â–²
        
    } else {
        newAsset = { id: item.id, name: item.name, type: item.type, purchasePrice: cost, currentValue: cost, baseAppreciation: item.baseAppreciation || 0, capacity: item.capacity || 0 };
    }
    gameState.finances.assets.push(newAsset);
    showEventCard('è´­ç½®æˆåŠŸ', 'fa-key', `ä½ èŠ±è´¹ <span class='value'>${cost}</span> ä¸¤ï¼Œè´­å…¥äº†${item.name}ã€‚`);
    showAssetsOverlay();
}
function processAssetAppreciation() {
    gameState.finances.assets.forEach(asset => {
        if (asset.type === 'collectible') {
            const eventRoll = Math.random();
            let multiplier = 1.0 + asset.baseAppreciation;
            if (eventRoll < 0.1) { multiplier = 0.7; logEvent(`å¸‚åœºåŠ¨è¡ï¼Œä½ çš„${asset.name}è´¬å€¼äº†ã€‚`, true); }
            else if (eventRoll > 0.9) { multiplier = 1.2; logEvent(`å¸‚åœºæ™¯æ°”ï¼Œä½ çš„${asset.name}å¤§å¹…å¢å€¼äº†ã€‚`, true);}
            asset.currentValue = Math.floor(asset.currentValue * multiplier);
        } else if (asset.type === 'residence') {
            asset.currentValue = Math.floor(asset.currentValue * 1.02);
        }
    });
}
function updateFinancialTier() {
    const totalAssets = gameState.finances.wealth + gameState.finances.assets.reduce((sum, c) => sum + (c.currentValue || 0), 0);
    let newTier = financialTiers[0];
    for (const tier of financialTiers) {
        if (totalAssets >= tier.threshold) {
            newTier = tier;
        } else {
            break;
        }
    }

    if (!gameState.finances.financialTier || gameState.finances.financialTier !== newTier.level) {
        gameState.finances.financialTier = newTier.level;
        // åªæœ‰åœ¨æ¸¸æˆå·²ç»å¼€å§‹ï¼Œå¹¶ä¸”DOMå…ƒç´ å­˜åœ¨æ—¶ï¼Œæ‰æ˜¾ç¤ºäº‹ä»¶å¡ç‰‡
        if (document.getElementById('eventCardOverlay')) {
            showEventCard('è´¢åŠ›å˜åŒ–', 'fa-chart-line', `ä½ çš„å®¶æ—è´¢åŠ›å˜æ›´ä¸º <strong class="value">${newTier.name}</strong>ï¼æ—¥å¸¸å¼€é”€å°†éšä¹‹è°ƒæ•´ã€‚`);
        }
    }
}
function calculateAndDeductExpenses() {
    const tier = financialTiers.find(t => t.level === gameState.finances.financialTier);
    if (!tier) return;
    const exp = tier.expenses;
    let totalExpenses = 0;
    let breakdown = [];
    const isMale = gameState.player.gender === 'male';

    // 1. ä¸ªäººå¼€é”€
    totalExpenses += exp.personal;
    breakdown.push(`ä¸ªäºº: ${exp.personal}`);

    // 2. é…å¶ä¸å¦¾å®¤å¼€é”€ (ä»…é™ç”·ç©å®¶)
    if (isMale) {
        if (gameState.marriage.isMarried && gameState.npcs[gameState.marriage.spouseId] && !gameState.npcs[gameState.marriage.spouseId].isDead) {
            totalExpenses += exp.spouse;
            breakdown.push(`é…å¶: ${exp.spouse}`);
        }
        
        const concubines = gameState.marriage.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
        if (concubines.length > 0) {
            let concubineExpenses = 0;
            concubines.forEach(conc => {
                // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ£€æŸ¥ç½šä¿¸æ ‡è®°
                if (conc.isPunishedWithSalary) {
                    logEvent(`å¦¾å®¤ ${conc.name} å› è¢«ç½šä¿¸ï¼Œæœ¬å¹´åº¦ä¸è®¡å¼€é”€ã€‚`);
                    conc.isPunishedWithSalary = false; // é‡ç½®æ ‡è®°
                } else {
                    const rankData = CONCUBINE_RANKS[conc.rankIndex || 0];
                    concubineExpenses += rankData.allowance;
                }
            });
            if (concubineExpenses > 0) {
                totalExpenses += concubineExpenses;
                breakdown.push(`å¦¾å®¤: ${concubineExpenses}`);
            }
        }
    }

    // 3. çˆ¶æ¯èµ¡å…»è´¹
    if (gameState.player.age >= 15) {
        const livingParents = [gameState.family.members.fatherId, gameState.family.members.motherId].filter(id => id && gameState.npcs[id] && !gameState.npcs[id].isDead).length;
        if (livingParents > 0) {
            const parentExpenses = livingParents * exp.parent;
            totalExpenses += parentExpenses;
            breakdown.push(`çˆ¶æ¯: ${parentExpenses}`);
        }
    }

    // 4. å­å¥³æŠšå…»è´¹
    const childrenToSupport = gameState.children.filter(c => !c.isDead && c.age < 18 && !c.isSecret && (isMale || c.motherId === 'player'));
    if (childrenToSupport.length > 0) {
        let childTotal = 0;
        childrenToSupport.forEach(child => {
            const edu = child.education || { cost: 0 };
            childTotal += exp.child_base + edu.cost;
        });
        if (childTotal > 0) {
            totalExpenses += childTotal;
            breakdown.push(`å­å¥³: ${childTotal}`);
        }
    }

    // 5. æœ€ç»ˆç»“ç®—
    applyEffects({ wealth: -totalExpenses });
    if (totalExpenses > 0) {
        logEvent(`å¹´åº¦å¼€é”€ç»“ç®—ï¼šæ€»è®¡æ”¯å‡º <span class="value">${totalExpenses}</span> ä¸¤ã€‚<br><small>(${breakdown.join(', ')})</small>`, true);
    }
}
function manageFamilyChest() {
    const action = prompt(`å®¶åº“ç›®å‰æœ‰ ${gameState.family.moneyChest} ä¸¤ã€‚\nè¯·è¾“å…¥è¦å­˜å…¥(+)æˆ–å–å‡º(-)çš„é‡‘é¢ï¼š`, '100');
    const amount = parseInt(action);
    if (isNaN(amount) || amount === 0) return;

    if(amount > 0) {
        if(gameState.finances.wealth < amount) { showToast("ä½ çš„ç§äº§ä¸è¶³ã€‚"); return; }
        applyEffects({wealth: -amount});
        gameState.family.moneyChest += amount;
        if(gameState.player.gender === 'female' && gameState.marriage.isMarried) applyEffects({relationship: { targetId: gameState.marriage.spouseId, favor: Math.floor(amount/100) }});
        showEventCard('å­˜å…¥å®¶åº“', 'fa-donate', `ä½ å‘å®¶åº“ä¸­å­˜å…¥äº† ${amount} ä¸¤ã€‚${gameState.player.gender === 'female' && gameState.marriage.isMarried ? 'å¤«å¦»æ©çˆ±å€¼ç•¥æœ‰æå‡ã€‚':''}`);
    } else {
        if(gameState.family.moneyChest < -amount) { showToast("å®¶åº“ä¸­æ²¡æœ‰è¿™ä¹ˆå¤šé’±ã€‚"); return; }
        applyEffects({wealth: -amount});
        gameState.family.moneyChest += amount;
        if(gameState.player.gender === 'female' && gameState.marriage.isMarried) applyEffects({relationship: { targetId: gameState.marriage.spouseId, favor: -Math.floor(-amount/100) }});
        showEventCard('å–è‡ªå®¶åº“', 'fa-hand-holding-usd', `ä½ ä»å®¶åº“ä¸­å–å‡ºäº† ${-amount} ä¸¤ã€‚${gameState.player.gender === 'female' && gameState.marriage.isMarried ? 'å¤«å¦»æ©çˆ±å€¼ç•¥æœ‰ä¸‹é™ã€‚':''}`);
    }
    renderGame();
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function askForMoney() {
    if (gameState.flags.actionUsed_family) { showToast("æœ¬å›åˆå·²å¤„ç†è¿‡å®¶äº‹ã€‚"); return; }
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if(!spouse) return;
    gameState.flags.actionUsed_family = true;

    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ï¼šåŠ¨æ€è®¡ç®—å®¶ç”¨ã€‘ â–¼â–¼â–¼
    // 1. åŸºç¡€é‡‘é¢ (ä¸å¤«å›èŒä¸šç­‰çº§å’Œå®¶ä¸–æŒ‚é’©)
    let baseAmount = 50; // é»˜è®¤åŸºç¡€
    if (spouse.career && spouse.career.path && spouse.career.level >= 0) {
        const careerData = careerPaths['male'][spouse.career.path];
        if (careerData) {
            baseAmount += Math.floor(careerData.levels[spouse.career.level].salary * 0.1); // è–ªæ°´çš„10%
        }
    }
    baseAmount += (spouse.attributes.family || 50) * 2; // æ¯ç‚¹å®¶ä¸–å€¼2ä¸¤

    // 2. æ©çˆ±å€¼ä¿®æ­£ (0.5 åˆ° 1.5 å€)
    const favor = gameState.marriage.favor || 0;
    const favorMultiplier = 0.5 + (favor / 100);

    // 3. æ€§æ ¼ä¿®æ­£
    let personalityMultiplier = 1.0;
    if (spouse.personality.includes('æ…·æ…¨å¤§æ–¹') || spouse.personality.includes('æ¸©æŸ”')) {
        personalityMultiplier = 1.3;
    } else if (spouse.personality.includes('å‡‰è–„') || spouse.personality.includes('ç°å®')) {
        personalityMultiplier = 0.7;
    }

    // 4. æœ€ç»ˆé‡‘é¢
    const finalAmount = Math.floor(baseAmount * favorMultiplier * personalityMultiplier * (0.8 + Math.random() * 0.4)); // åŠ å…¥å°å¹…éšæœºæ³¢åŠ¨
    const favorChange = -getRandomInt(1, 4) + (favor > 80 ? 1 : 0); // éå¸¸æ©çˆ±æ—¶ï¼Œç´¢è¦å®¶ç”¨ç”šè‡³ä¸æ‰å¥½æ„Ÿ

    gameState.family.moneyChest += finalAmount;
    applyEffects({relationship: { targetId: spouse.id, favor: favorChange }});
    showEventCard('ç´¢è¦å®¶ç”¨', 'fa-hand-holding-usd', `ä½ å‘å¤«å›ç´¢è¦å®¶ç”¨ï¼Œä»–ç»™äº†ä½  <span class="value">${finalAmount}</span> ä¸¤ã€‚ä½ ä»¬çš„æ©çˆ±å€¼ ${favorChange >= 0 ? 'å¢åŠ äº†' : 'å‡å°‘äº†'}${Math.abs(favorChange)}ã€‚`);
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
    renderGame();
}
function handleSpouseConcubines() {
    if (gameState.flags.actionUsed_family) { showToast("æœ¬å›åˆå·²å¤„ç†è¿‡å®¶äº‹ã€‚"); return; }
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    const concubines = spouse.concubines.filter(id => gameState.npcs[id] && !gameState.npcs[id].isDead);
    if (!concubines || concubines.length === 0) return;

    const target = getRandomElement(concubines.map(id => gameState.npcs[id]));
    const options = [
        { text: "æ•²æ‰“ä¸€ç•ª", action: {favor: -10, virtue: -2}, log: `ä½ æ•²æ‰“äº†å¦¾å®¤${target.name}ä¸€ç•ªï¼Œç«‹äº†ä¸»æ¯çš„å¨ä¸¥ï¼Œä½†æ˜¾å¾—æœ‰äº›åˆ»è–„ã€‚`},
        { text: "èµèµæ‹‰æ‹¢", action: {favor: 5, wealth: -100}, log: `ä½ èŠ±è´¹100ä¸¤èµèµäº†${target.name}ï¼Œå¥¹å¯¹ä½ æ›´åŠ æ­é¡ºã€‚`},
        { text: "ç½®ä¹‹ä¸ç†", action: {}, log: "ä½ å†³å®šåå®…ä¹‹äº‹ï¼Œå¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹ã€‚"}
    ];

    let optionObjects = options.map((opt, i) => {
        return {
            htmlContent: `<span class="option-text">${opt.text}</span>`,
            callback: () => handleConcubineAction(opt, target.id)
        };
    });

    showDecisionCard('å¤„ç†å¦¾å®¤', 'fa-user-times', `ä½ æ­£æƒ³ç€å¦‚ä½•å¤„ç†å¤«å›çš„å¦¾å®¤ <strong class="highlight-npc">${target.name}</strong>...`, optionObjects);

}
function handleConcubineAction(option, targetId) {
    gameState.flags.actionUsed_family = true;

     if(option.action.wealth && gameState.finances.wealth < -option.action.wealth) {
         showToast("é“¶é’±ä¸è¶³ã€‚");
         return;
     }

     if(option.action.wealth) applyEffects({wealth: option.action.wealth});
     if(option.action.favor) applyEffects({relationship: {targetId:targetId, favor: option.action.favor}});
     if(option.action.virtue) applyEffects({attributes: {virtue: option.action.virtue}});
     
     showEventCard('åå®…é£äº‘', 'fa-users', option.log);
     renderGame();
}
// =======================================================================
// ========================== MARRIAGE & FAMILY ==========================
// =======================================================================
// ADD THESE NEW FUNCTIONS

function updateHaremStatus() {
    // This function is called every turn to update moods, harmony, etc.
    if (gameState.player.gender !== 'male' || (!gameState.marriage.isMarried && gameState.marriage.concubines.length === 0)) return;

    const allLadies = [gameState.npcs[gameState.marriage.spouseId], ...gameState.marriage.concubines.map(id => gameState.npcs[id])].filter(Boolean);
    if (allLadies.length <= 1) {
        gameState.marriage.familyHarmony = Math.min(100, gameState.marriage.familyHarmony + 2);
        if(allLadies.length === 1) allLadies[0].mood = 'å¹³å’Œ';
        return;
    }

    // 1. Distribute Favor & Update Moods
    // Simple system: find the most favored one
    let mostFavored = null;
    let highestFavor = -101;
    allLadies.forEach(lady => {
        if (lady.favor > highestFavor) {
            highestFavor = lady.favor;
            mostFavored = lady;
        }
    });

    let totalFavorDiff = 0;
    allLadies.forEach(lady => {
        if (lady === mostFavored) {
            lady.mood = lady.favor > 80 ? 'å¾—æ„' : 'å¹³å’Œ';
        } else {
            const favorDifference = mostFavored.favor - lady.favor;
            totalFavorDiff += favorDifference;
            if (favorDifference > 50) {
                lady.mood = 'å“€æ€¨';
                lady.jealousy = (lady.jealousy || 0) + 5;
            } else if (favorDifference > 20) {
                lady.mood = 'å«‰å¦’';
                lady.jealousy = (lady.jealousy || 0) + 2;
            } else {
                lady.mood = 'å¹³å’Œ';
                lady.jealousy = Math.max(0, (lady.jealousy || 0) - 1);
            }
        }
    });

    // 2. Calculate Family Harmony
    // Harmony is high when favor differences are low
    gameState.marriage.familyHarmony = Math.max(0, 100 - Math.floor(totalFavorDiff / allLadies.length));
}

function triggerHaremEvent() {
    if (gameState.player.gender !== 'male' || Math.random() > 0.3) return; // 30% chance per turn

    const wife = gameState.npcs[gameState.marriage.spouseId];
    const concubines = gameState.marriage.concubines.map(id => gameState.npcs[id]).filter(Boolean);

    let triggeredEvent = null;
    let eventData = null;
    let involvedConcubine = null;

    // Check for high-intensity scheming events first
    for (const concubine of concubines) {
        if (triggeredEvent) break;
        for (const event of HAREM_EVENT_DATA.scheming) {
            if (event.trigger(concubine, wife)) {
                triggeredEvent = event;
                eventData = event;
                involvedConcubine = concubine;
                break;
            }
        }
    }

    // If no scheming, check for low-intensity jealousy events
    if (!triggeredEvent) {
        for (const concubine of concubines) {
            if (triggeredEvent) break;
            for (const event of HAREM_EVENT_DATA.jealousy) {
                if (event.trigger(concubine)) {
                    triggeredEvent = event;
                    eventData = event;
                    involvedConcubine = concubine;
                    break;
                }
            }
        }
    }

    if (triggeredEvent && eventData && involvedConcubine) {
        const description = eventData.description(involvedConcubine, wife);
        const options = eventData.options.map(opt => ({
            htmlContent: `<span class="option-text">${opt.text}</span>`,
            callback: () => opt.action(involvedConcubine, wife)
        }));
        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤ç‚¹ã€‘å°†ç›´æ¥æ˜¾ç¤ºå¼¹çª—æ”¹ä¸ºæ¨å…¥äº‹ä»¶é˜Ÿåˆ— â–¼â–¼â–¼
        eventQueue.push(() => {
            showDecisionCard(eventData.title, 'fa-theater-masks', description, options);
        });
    }
}

function holdFamilyBanquet() {
    const cost = 200;
    if (gameState.family.moneyChest < cost) {
        showToast(`å®¶åº“èµ„é‡‘ä¸è¶³${cost}ä¸¤ï¼Œæ— æ³•ä¸¾åŠå®¶å®´ã€‚`);
        return;
    }
    gameState.family.moneyChest -= cost;
    
    const allFamily = [
        gameState.npcs[gameState.family.members.motherId],
        gameState.npcs[gameState.marriage.spouseId],
        ...gameState.marriage.concubines.map(id => gameState.npcs[id])
    ].filter(Boolean);

    allFamily.forEach(member => {
        applyEffects({ relationship: { targetId: member.id, favor: getRandomInt(2, 5) } });
    });

    gameState.marriage.familyHarmony = Math.min(100, gameState.marriage.familyHarmony + 10);
    showEventCard('å®¶å®´', 'fa-users', `ä½ ä¸¾åŠäº†ä¸€åœºå®¶å®´ï¼Œé˜–å®¶æ¬¢ä¹ï¼Œå®¶åº­å’Œè°åº¦æå‡ã€‚`);
    renderGame();
}
// [æ›¿æ¢] åŸæœ‰çš„ triggerSpouseEvent å‡½æ•°
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function triggerSpouseEvent() {
    if (!gameState.marriage.isMarried || !gameState.npcs[gameState.marriage.spouseId]) return;
    if (Math.random() < 0.25) { // æ¯å›åˆæœ‰25%å‡ ç‡è§¦å‘
        const spouse = gameState.npcs[gameState.marriage.spouseId];
        const isMalePlayer = gameState.player.gender === 'male';
        const eventTypes = ['daily', 'crisis', 'child_edu'];
        const randomEventType = getRandomElement(eventTypes);
        
        let decisionTitle, decisionDesc, decisionOptions;

        switch (randomEventType) {
            case 'daily': // æ—¥å¸¸é—®å€™
                decisionTitle = 'æ—¥å¸¸é—®å€™';
                decisionDesc = isMalePlayer ? 'å¤«äººä¸ºä½ å‡†å¤‡äº†æ—©è†³ï¼Œå«æƒ…è„‰è„‰åœ°çœ‹ç€ä½ ã€‚' : 'å¤«å›è§ä½ å¤œè¯»è¾›åŠ³ï¼Œç‰¹åœ°ä¸ºä½ æŠ«ä¸Šå¤–è¡£ï¼Œé™ªä¼´åœ¨ä¾§ã€‚';
                decisionOptions = [
                    { htmlContent: 'ã€æ¸©æƒ…å›åº”ã€‘', callback: () => {
                        showEventCard('å²æœˆé™å¥½', 'fa-sun', 'ä½ ä»¬ç›¸è§†ä¸€ç¬‘ï¼Œä¸€åˆ‡å°½åœ¨ä¸è¨€ä¸­ã€‚å¤«å¦»æƒ…æ„Ÿ+5ï¼Œå¥åº·+5ã€‚');
                        applyEffects({ marriage: { emotionValue: 5 }, attributes: { health: 5 } });
                    }},
                    { htmlContent: 'ã€æ¼ ç„¶å¤„ä¹‹ã€‘', callback: () => {
                        showEventCard('æ¼ ä¸å…³å¿ƒ', 'fa-snowflake', 'ä½ çš„å†·æ·¡è®©å¯¹æ–¹æœ‰äº›å¤±è½ã€‚å¤«å¦»æƒ…æ„Ÿ-5ã€‚');
                        applyEffects({ marriage: { emotionValue: -5 } });
                    }},
                    { htmlContent: 'ã€èµ é€å°ç¤¼ã€‘', callback: () => {
                        if (gameState.finances.wealth >= 100) {
                            showEventCard('ç”œèœœæƒŠå–œ', 'fa-gift', 'ä½ é€ä¸Šçš„å°ç¤¼ç‰©è®©å¯¹æ–¹æƒŠå–œä¸å·²ã€‚å¤«å¦»æƒ…æ„Ÿ+10ã€‚');
                            applyEffects({ wealth: -100, marriage: { emotionValue: 10, favor: 2 } });
                        } else {
                            showToast("ä½ çš„ç§äº§ä¸è¶³100ä¸¤ã€‚");
                        }
                    }}
                ];
                break;
            case 'crisis': // å®¶åº­å±æœº
                 if ((gameState.career.core_resources.jia_zu_sheng_wang || gameState.family.reputation) < 30) return; // å£°æœ›å¤ªä½ä¸è§¦å‘
                 decisionTitle = 'å®¶åº­å±æœº';
                 const isFinanceCrisis = Math.random() < 0.5;
                 decisionDesc = isFinanceCrisis ? 'å®¶ä¸­é­é‡æ„å¤–ï¼Œè´¢åŠ¡ä¸Šå‡ºç°äº†å·¨å¤§çš„ç¼ºå£ï¼Œå‘¨è½¬å›°éš¾ã€‚' : 'å› ä¸€æ¡©ä¸‘é—»ï¼Œå®¶æ—å£°æœ›å—æŸï¼Œåœ¨äº¬ä¸­å¤‡å—éè®®ã€‚';
                 decisionOptions = [
                    { htmlContent: 'ã€å…±åŒæ‰¿æ‹…ã€‘', callback: () => {
                        showEventCard('åŒèˆŸå…±æµ', 'fa-hands-helping', 'ä½ ä»¬å†³å®šå…±åŒé¢å¯¹ï¼Œæ‚£éš¾è§çœŸæƒ…ã€‚å¤«å¦»æƒ…æ„Ÿ+20ã€‚');
                        applyEffects({ marriage: { emotionValue: 20, favor: 5 } });
                    }},
                    { htmlContent: 'ã€è´£å¤‡å¯¹æ–¹ã€‘', callback: () => {
                        showEventCard('äº’ç›¸æŒ‡è´£', 'fa-angry', 'ä½ ä»¬äº’ç›¸æŒ‡è´£ï¼Œå°†è´£ä»»æ¨ç»™å¯¹æ–¹ï¼Œå…³ç³»å‡ºç°è£‚ç—•ã€‚å¤«å¦»æƒ…æ„Ÿ-20ã€‚');
                        applyEffects({ marriage: { emotionValue: -20, favor: -10 } });
                    }},
                    { htmlContent: 'ã€å¯»æ±‚å¤–æ´ã€‘', callback: () => {
                        if ((gameState.player.attributes.charm + gameState.player.attributes.reputation) > 150) {
                            showEventCard('è´µäººç›¸åŠ©', 'fa-user-friends', 'ä½ å‡­å€Ÿäººè„‰ï¼ŒæˆåŠŸåŒ–è§£äº†æ­¤æ¬¡å±æœºã€‚å¤«å¦»æƒ…æ„Ÿ+10ã€‚');
                            applyEffects({ marriage: { emotionValue: 10 } });
                        } else {
                            showEventCard('æ±‚åŠ©æ— é—¨', 'fa-door-closed', 'ä½ çš„äººè„‰ä¸è¶³ä»¥è§£å†³é—®é¢˜ï¼Œå±æœºä¾ç„¶å­˜åœ¨ã€‚');
                        }
                    }}
                 ];
                 break;
            case 'child_edu': // å­å¥³æ•™è‚²åˆ†æ­§
                const children = gameState.children.filter(c => !c.isDead && c.age >= 6 && c.age < 16);
                if (children.length === 0) return; // æ²¡æœ‰å­¦é¾„å„¿ç«¥åˆ™ä¸è§¦å‘
                const child = getRandomElement(children);
                decisionTitle = 'å­å—£æ•™è‚²åˆ†æ­§';
                decisionDesc = `å…³äº <strong class="highlight-npc">${child.name}</strong> çš„æ•™è‚²é—®é¢˜ï¼Œä½ ä¸é…å¶äº§ç”Ÿäº†åˆ†æ­§ã€‚`;
                decisionOptions = [
                    { htmlContent: 'ã€å¦¥åã€‘', callback: () => {
                        showEventCard('ä»¥å’Œä¸ºè´µ', 'fa-handshake', `ä½ é€‰æ‹©å¦¥åï¼Œ${spouse.name}å¯¹ä½ çš„é€€è®©è¡¨ç¤ºæ„Ÿæ¿€ã€‚å­©å­å±æ€§è·å¾—éšæœºæå‡ã€‚`);
                        applyEffects({ marriage: { favor: 5 } });
                        const randomAttr = getRandomElement(['talent', 'wisdom', 'etiquette', 'virtue']);
                        child.attributes[randomAttr] += 5;
                    }},
                    { htmlContent: 'ã€åšæŒå·±è§ã€‘', callback: () => {
                        showEventCard('åšæŒå·±è§', 'fa-gavel', 'ä½ åšæŒäº†è‡ªå·±çš„çœ‹æ³•ï¼Œä½†é…å¶å¯¹æ­¤æ„Ÿåˆ°ä¸æ»¡ã€‚');
                        applyEffects({ marriage: { favor: -10 } });
                         child.attributes['wisdom'] += 8;
                    }},
                    { htmlContent: 'ã€è¯·é•¿è¾ˆå®šå¤ºã€‘', callback: () => {
                        const father = gameState.npcs[gameState.family.members.fatherId];
                        if (father && father.favor > 50) {
                            showEventCard('é•¿è¾ˆçš„æ™ºæ…§', 'fa-user-tie', 'åœ¨é•¿è¾ˆçš„è°ƒè§£ä¸‹ï¼Œä½ ä»¬è¾¾æˆäº†å…±è¯†ã€‚');
                            applyEffects({ marriage: { favor: 5 } });
                            child.attributes['wisdom'] += 4;
                            child.attributes['virtue'] += 4;
                        } else {
                            showEventCard('æ— äººå¯ä¾', 'fa-times-circle', 'é•¿è¾ˆä¸æ„¿æ’æ‰‹ä½ ä»¬çš„å®¶äº‹ã€‚');
                        }
                    }}
                ];
                break;
        }

        if (decisionTitle) {
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†äº‹ä»¶å­˜å…¥ marriage ä»“åº“
            addUiEvent('marriage', () => {
                showDecisionCard(decisionTitle, 'fa-users', decisionDesc, decisionOptions);
            });
        }
    }
}
// REPLACE THIS ENTIRE FUNCTION
// [æ›¿æ¢] marrySuitor å‡½æ•°
// [æ›¿æ¢] marrySuitor å‡½æ•°
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢] marrySuitor å‡½æ•°
function marrySuitor(suitorId) {
    const suitor = gameState.npcs[suitorId];
    if (!suitor) return;

    if(gameState.player.age < 16) { showToast("ä½ å°šæœªåŠç¬„/è¡Œå† ç¤¼ï¼Œä¸å¯æˆå©šã€‚"); return; }
    if(gameState.marriage.isMarried) { showToast("ä½ å·²æˆå©šã€‚"); return; }

    // æ ¹æ®ç»“è¯†æ¥æºå†³å®šè˜ç¤¼/å«å¦†åŸºç¡€å¼€é”€
    const cost = suitor.source === 'matchmaker' ? 3000 : 5000 + Math.floor(Math.random() * (100000 / (suitor.attributes.family || 20)));

    if (gameState.finances.wealth < cost) { showToast("ä½ çš„è´¢åŠ›ä¸è¶³ä»¥æ”¯æ’‘è¿™é—¨å©šäº‹ã€‚"); return; }
    applyEffects({wealth: -cost});

    // --- é€šç”¨ç»“å©šé€»è¾‘ ---
    suitor.relationship = 'spouse';
    gameState.marriage.isMarried = true;
    gameState.marriage.spouseId = suitor.id;
    suitor.suspicionValue = 0; // åˆå§‹åŒ–ç–‘å¿ƒå€¼

    // ä»å…¶ä»–å…³ç³»åˆ—è¡¨ä¸­æ¸…ç†
    gameState.suitors = gameState.suitors.filter(id => id !== suitorId);
    gameState.social.friends = gameState.social.friends.filter(id => id !== suitorId);
    gameState.social.secretLovers = gameState.social.secretLovers.filter(id => id !== suitorId);
    if (gameState.social.relationships[suitorId]) {
        delete gameState.social.relationships[suitorId];
    }
    // æ­£å¼å»ºç«‹é…å¶å…³ç³»
    gameState.social.relationships[suitorId] = {
        type: 'spouse',
        favor: 50,
        emotionValue: 100,
        level: 1,
    };
    
    // --- æ€§åˆ«å·®å¼‚åŒ–é€»è¾‘ ---
    if (gameState.player.gender === 'female') {
        suitor.dynamicState = 'é—²æƒ…é€¸è‡´'; // å¤«å›åˆå§‹çŠ¶æ€

        // **ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ ¹æ®ç»“å©šæ–¹å¼å†³å®šæœ‰æ— å¦¾å®¤**
        if (suitor.source === 'matchmaker') {
            // é€šè¿‡åª’äººæˆå©šï¼Œå¤«å›è‡ªå¸¦å¦¾å®¤ï¼Œå¼€å¯â€œåšå¼ˆå¼€å±€â€
            logEvent(`ä½ é€šè¿‡åª’äººå«å…¥é«˜é—¨ï¼Œå¼€å¯äº†â€œåšå¼ˆå¼€å±€â€ï¼Œä¸€è¿›é—¨å°±è¦é¢å¯¹ä¸¤ä½è™è§†çœˆçœˆçš„å¦¾å®¤ã€‚`);
            gameState.marriage.favor = 30; // æ„Ÿæƒ…åŸºç¡€è¾ƒå¼±
            
            const standardAllowance = financialTiers.find(t => t.level === gameState.finances.financialTier)?.expenses.concubine || 50;

            const zhao = generateNPC({
                gender: 'female', age: suitor.age - 2,
                name: 'èµµ' + getRandomElement(nameData.girlNames), role: 'èµµå§¨å¨˜',
                relationship: 'concubine', favor: 40, personality: ['ç¬‘é‡Œè—åˆ€', 'è…¹é»‘'],
                ambition: 75, jealousy: 60, monthlyAllowance: standardAllowance,
                background: {desc: 'å©†å©†çš„è¿œæˆ¿ä¾„å¥³ï¼Œæ·±å¾—å©†å©†ä¿¡ä»»ã€‚'}
            });
            
            const li = generateNPC({
                gender: 'female', age: suitor.age - 1,
                name: 'æ' + getRandomElement(nameData.girlNames), role: 'æå§¨å¨˜',
                relationship: 'concubine', favor: 60, personality: ['åˆè›®æ³¼è¾£', 'å–„å¦’'],
                ambition: 50, jealousy: 80, monthlyAllowance: standardAllowance,
                background: {desc: 'å¤«å›çš„æ˜”æ—¥ä¸«é¬Ÿï¼Œæƒå® è€Œéª„ã€‚'}
            });
            
            suitor.concubines = [zhao.id, li.id];
        } else {
            // è‡ªç”±æ‹çˆ±/é’æ¢…ç«¹é©¬æˆå©šï¼Œåé™¢æ¸…å‡€ï¼Œå¼€å¯â€œèœœæœˆå¼€å±€â€
            logEvent(`ä½ ä¸å¿ƒä¸Šäººå–œç»“è¿ç†ï¼Œå¼€å¯äº†â€œèœœæœˆå¼€å±€â€ï¼Œåˆå§‹æ©å® å€¼å¾ˆé«˜ï¼Œä¸”å¤«å›åé™¢æš‚æ— å¥¹äººã€‚`);
            gameState.marriage.favor = 80; // æ„Ÿæƒ…åŸºç¡€æ·±åš
            suitor.concubines = []; // åˆå§‹æ²¡æœ‰å¦¾å®¤
        }

    } else { // ç”·æ€§ç©å®¶
         gameState.marriage.favor = 50;
    }
    
    const groom = gameState.player.gender === 'male' ? gameState.player.name : suitor.name;
    const bride = gameState.player.gender === 'female' ? gameState.player.name : suitor.name;

    showWeddingOverlay(groom, bride);
logEvent(`ä½ èŠ±è´¹ <span class="value">${Math.floor(cost)}</span> ä¸¤ï¼Œä¸ <strong class="highlight-npc">${suitor.name}</strong> å–œç»“è¿ç†ã€‚`);
logEvent(`ä½ ä¸ <strong class="highlight-npc">${suitor.name}</strong> å–œç»“è¿ç†ï¼Œå…±èµ´ç™½é¦–ã€‚`, true);
    renderGame(); 
}
function checkHusbandTakesConcubine() {
    // ä»…å¯¹å·²å©šçš„å¥³ç©å®¶ç”Ÿæ•ˆ
    if (gameState.player.gender !== 'female' || !gameState.marriage.isMarried) {
        return;
    }

    const husband = gameState.npcs[gameState.marriage.spouseId];
    if (!husband || husband.isDead) {
        return;
    }

    // æ£€æŸ¥åºœé‚¸å®¹é‡æ˜¯å¦å·²æ»¡
    const totalCapacity = (gameState.finances.assets.find(a => a.type === 'residence')?.capacity || 5);
    const currentOccupants = 1 + 1 + (husband.concubines ? husband.concubines.length : 0);
    if (currentOccupants >= totalCapacity) {
        return; // åºœé‚¸ä½ä¸ä¸‹äº†
    }

    const favor = gameState.marriage.favor;
    let chance = 0;

    // æ ¹æ®æ©çˆ±å€¼å†³å®šçº³å¦¾å‡ ç‡
    if (favor < 30) chance = 0.15; // æ„Ÿæƒ…ä¸ç¦ï¼Œæœ‰15%å‡ ç‡
    if (favor < 10) chance = 0.30; // æ„Ÿæƒ…ç ´è£‚ï¼Œæœ‰30%å‡ ç‡

    if (Math.random() < chance) {
        // è§¦å‘çº³å¦¾äº‹ä»¶
        const newConcubine = generateNPC({
            gender: 'female',
            age: husband.age - getRandomInt(3, 8),
            role: 'æ–°çº³ä¾å¦¾',
            relationship: 'concubine',
            favor: 50,
            personality: [getRandomElement(personalityTraits.positive)],
            ambition: getRandomInt(20, 50),
            jealousy: getRandomInt(20, 50)
        });

        if (!husband.concubines) {
            husband.concubines = [];
        }
        husband.concubines.push(newConcubine.id);

        // ä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—ï¼Œç¡®ä¿å¼¹çª—åœ¨æ‰€æœ‰å›åˆç»“ç®—åæ˜¾ç¤º
        eventQueue.push(() => {
            showEventCard('åé™¢èµ·ç«', 'fa-sad-cry', `å› ä½ ä¸å¤«å› <strong class="highlight-npc">${husband.name}</strong> æ„Ÿæƒ…ä¸ç¦ï¼Œä»–ä»å¤–é¢å¸¦å›ä¸€ä½å¥³å­ <strong class="highlight-npc">${newConcubine.name}</strong>ï¼Œçº³ä¸ºå¦¾å®¤ã€‚`);
        });
    }
}
function handleCarrotAndStick() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    const currentTier = financialTiers.find(t => t.level === gameState.finances.financialTier);
    const standardAllowance = currentTier?.expenses.concubine || 50; // è·å–å½“å‰è´¢åŠ›ç­‰çº§ä¸‹çš„æ ‡å‡†æœˆä¾‹

    let contentHTML = `<p class="comment">ä½ å¯ä»¥è°ƒæ•´å¦¾å®¤ä»¬çš„æœˆä¾‹ä»½ä¾‹ï¼Œä»¥è¾¾åˆ°æ‹‰æ‹¢æˆ–æ‰“å‹çš„ç›®çš„ã€‚æ ‡å‡†æœˆä¾‹ä¸º <span class="value">${standardAllowance}</span> ä¸¤ã€‚</p>`;

    concubines.forEach(conc => {
        // å¦‚æœå¦¾å®¤æ²¡æœ‰æœˆä¾‹å±æ€§ï¼Œåˆ™åˆå§‹åŒ–
        if (typeof conc.monthlyAllowance === 'undefined') {
            conc.monthlyAllowance = standardAllowance;
        }
        contentHTML += `
            <div style="margin: 20px 0; padding-bottom: 15px; border-bottom: 1px dashed var(--border-color-light);">
                <strong>${conc.name}</strong> (æ©çˆ±: ${conc.favor})
                <div class="quantity-slider-container">
                    <input type="range" id="allowance_slider_${conc.id}" value="${conc.monthlyAllowance}" min="0" max="${standardAllowance * 2}" step="10"
                           oninput="document.getElementById('allowance_input_${conc.id}').value = this.value">
                    <input type="number" id="allowance_input_${conc.id}" value="${conc.monthlyAllowance}" min="0" max="${standardAllowance * 2}"
                           oninput="document.getElementById('allowance_slider_${conc.id}').value = this.value">
                </div>
            </div>
        `;
    });
    
    const options = [{
        htmlContent: `<i class="fas fa-check"></i> ç¡®è®¤è°ƒæ•´`,
        callback: () => confirmAllowanceAdjustments()
    }];

    showDecisionCard('æ©å¨å¹¶æ–½', 'fa-balance-scale', contentHTML, options);
}

/**
 * ç¡®è®¤å¹¶åº”ç”¨æœˆä¾‹è°ƒæ•´
 */
function confirmAllowanceAdjustments() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    const currentTier = financialTiers.find(t => t.level === gameState.finances.financialTier);
    const standardAllowance = currentTier?.expenses.concubine || 50;
    
    let logParts = [];

    concubines.forEach(conc => {
        const oldAllowance = conc.monthlyAllowance;
        const newAllowance = parseInt(document.getElementById(`allowance_input_${conc.id}`).value);
        
        if (isNaN(newAllowance) || newAllowance < 0) return;

        conc.monthlyAllowance = newAllowance;

        if (newAllowance > oldAllowance) {
            const favorGain = Math.floor((newAllowance - oldAllowance) / 20);
            applyEffects({relationship: {targetId: conc.id, favor: favorGain}});
            logParts.push(`<strong class="highlight-npc">${conc.name}</strong>çš„æœˆä¾‹å¢åŠ ï¼Œå¥¹å¯¹ä½ æ›´åŠ æ­é¡ºã€‚`);
        } else if (newAllowance < oldAllowance) {
            const favorLoss = Math.floor((oldAllowance - newAllowance) / 15);
            applyEffects({relationship: {targetId: conc.id, favor: -favorLoss}});
            logParts.push(`<strong class="highlight-npc">${conc.name}</strong>çš„æœˆä¾‹è¢«å‰Šå‡ï¼Œå¥¹å¿ƒæ€€ä¸æ»¡ã€‚`);
        }
    });

    if (logParts.length > 0) {
        showEventCard('è°ƒæ•´ä»½ä¾‹', 'fa-balance-scale', 'ä½ é‡æ–°è°ƒæ•´äº†åå®…çš„ä»½ä¾‹ï¼š<br> - ' + logParts.join('<br> - '));
    } else {
        showToast("æœªåšä»»ä½•è°ƒæ•´ã€‚");
    }
}

// ===================== ã€æ›¿æ¢ã€‘interactWithSpouse å‡½æ•° START =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘interactWithSpouse å‡½æ•° START =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘interactWithSpouse å‡½æ•° START =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘interactWithSpouse å‡½æ•° START =====================
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘interactWithSpouse å‡½æ•° START =====================
function interactWithSpouse(action) {
    if (!gameState.marriage.isMarried) return;
    const spouseId = gameState.marriage.spouseId;
    if(!spouseId) return;
    
    // ã€ä¿ç•™åŠŸèƒ½ã€‘å¤„ç†é—²èŠ
    if (action === 'chat') {
        const events = gameState.player.gender === 'male' ? wifeInteractionEvents : husbandInteractionEvents;
        const event = getRandomElement(events);
        applyEffects({ relationship: { targetId: spouseId, favor: event.favor_change } });
        showEventCard('å¤«å¦»é—²èŠ', 'fa-comments', event.text + ` æ©çˆ±å€¼${event.favor_change > 0 ? '+' : ''}${event.favor_change}ã€‚`);
    } 
    // ã€ä¿ç•™åŠŸèƒ½ã€‘å¤„ç†é™ªä¼´
    else if (action === 'accompany') {
        logEvent("ä½ ä¸ºæ­£åœ¨è¯»ä¹¦çš„å¤«å›çº¢è¢–æ·»é¦™ï¼Œä»–æŠ¬çœ¼æœ›ä½ ï¼Œçœ¼ä¸­æ»¡æ˜¯æŸ”æƒ…ã€‚");
        applyEffects({ relationship: { targetId: spouseId, favor: 2 } });
        showToast("æ©çˆ±å€¼+2");
    }
    renderGame();
}
// ===================== ã€æ›¿æ¢ç”¨ä»£ç å—ã€‘interactWithSpouse å‡½æ•° END 

function showConcubineAcquisition() {
    if (gameState.marriage.concubines.length >= 5) {
        showToast("å¦¾å®¤åé¢å·²æ»¡ã€‚"); return;
    }
    showMatchmaker(true);
}
// =======================================================================
// ================== ã€æ–°å¢ã€‘å¥³æ€§è§†è§’-å¤«å›äº’åŠ¨æ ¸å¿ƒå‡½æ•° ==================
// =======================================================================

function updateHusbandState() {
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if (!spouse || gameState.player.gender !== 'female') return;

    // ä¼˜å…ˆå¤„ç†è´Ÿé¢çŠ¶æ€
    if (spouse.health < 50) {
        spouse.dynamicState = 'èº«å¿ƒä¿±ç–²';
        return;
    }
    const rel = gameState.social.relationships[spouse.id];
    if (rel && rel.trust < 30) {
        spouse.dynamicState = 'ç–‘çª¦ä¸›ç”Ÿ';
        return;
    }
    
    // æ ¹æ®äº‹ä¸šçŠ¶å†µåˆ¤æ–­
    const career = spouse.career; // å‡è®¾ä¸ˆå¤«ä¹Ÿæœ‰ç®€åŒ–çš„careerå¯¹è±¡
    if (career && career.performance > 150) { // å‡è®¾åŠŸç»©é«˜
        spouse.dynamicState = 'æ„æ°”é£å‘';
    } else if (career && career.performance < 20) { // å‡è®¾åŠŸç»©ä½
        spouse.dynamicState = 'å¿ƒçƒ¦æ„ä¹±';
    } else {
        spouse.dynamicState = 'é—²æƒ…é€¸è‡´';
    }
}

function showHusbandInteractionUI() {
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if (!spouse) return;

    updateHusbandState(); // æ¯æ¬¡æ‰“å¼€éƒ½åˆ·æ–°çŠ¶æ€
    
    const renderCategory = (category) => {
        let html = '';
        HUSBAND_INTERACTION_DATA[category].forEach(action => {
            let disabled = false;
            let reason = '';
            
            // æ£€æŸ¥çŠ¶æ€è¦æ±‚
            if (action.req.state && !action.req.state.includes(spouse.dynamicState)) {
                disabled = true;
                reason += `(å¤«å›éœ€${action.req.state.join('/')}) `;
            }
            if (action.req.state_not && action.req.state_not.includes(spouse.dynamicState)) {
                disabled = true;
                reason += `(å¤«å›ä¸å¯${action.req.state_not.join('/')}) `;
            }
            // æ£€æŸ¥å±æ€§è¦æ±‚
            if (action.req.wisdom && gameState.player.attributes.wisdom < action.req.wisdom) {
                disabled = true;
                reason += `(æ™ºæ…§â‰¥${action.req.wisdom}) `;
            }
            if (action.req.charm && gameState.player.attributes.charm < action.req.charm) {
                disabled = true;
                reason += `(é­…åŠ›â‰¥${action.req.charm}) `;
            }
            // æ£€æŸ¥æ©å® å€¼è¦æ±‚
            if (action.req.favor && gameState.marriage.favor < action.req.favor) {
                disabled = true;
                reason += `(æ©å® å€¼â‰¥${action.req.favor}) `;
            }
            // â–¼â–¼â–¼ æ ¸å¿ƒä¿®æ”¹ â–¼â–¼â–¼
            // æ£€æŸ¥æŒå®¶æƒè¦æ±‚
            if (action.req.authority && (gameState.marriage.householdAuthority.progress || 0) < action.req.authority) {
                disabled = true;
                reason += `(æŒå®¶æƒâ‰¥${action.req.authority}) `;
            }
            // æ£€æŸ¥è¯æ®è¦æ±‚
            if (action.req.has_evidence && !gameState.flags.hasConcubineEvidence) {
                disabled = true;
                reason += `(ç¼ºå°‘ç½ªè¯) `;
            }
            // â–²â–²â–² ä¿®æ”¹ç»“æŸ â–²â–²â–²

            html += `
                <button class="option" ${disabled ? 'disabled' : ''} onclick="handleHusbandInteraction('${category}', '${action.id}')">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span class="option-text"><strong>${action.name}</strong><div><small>${action.desc} ${reason.trim()}</small></div></span>
                </button>
            `;
        });
        return html;
    };
    
    const content = `
        <div class="status-item" style="justify-content:center; margin-bottom:15px;">å¤«å›å½“å‰çŠ¶æ€: <strong class="value">${spouse.dynamicState}</strong></div>
        <div style="max-height: 50vh; overflow-y: auto; padding-right:5px;">
            <div class="section-header"><i class="fas fa-heart"></i> æ—¥å¸¸æƒ…æ„Ÿ</div>
            ${renderCategory('daily_affection')}
            <div class="section-header"><i class="fas fa-briefcase"></i> äº‹ä¸šè¾…ä½</div>
            ${renderCategory('career_support')}
            <div class="section-header"><i class="fas fa-gavel"></i> å†…å®…è®®äº‹</div>
            ${renderCategory('household_discussion')}
        </div>
    `;

    showDecisionCard(`ä¸å¤«å› (${spouse.name}) äº’åŠ¨`, 'fa-user-friends', content, []);
}

function handleHusbandInteraction(category, actionId) {
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if (!spouse) return;
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä½¿ç”¨æ–°çš„ per-NPC è®¡æ•°å™¨
    if (!checkAndUseNpcActionPoint(spouse.id)) {
        return;
    }
    const action = HUSBAND_INTERACTION_DATA[category]?.find(a => a.id === actionId);
    if (!action) {
        console.error("æ— æ³•æ‰¾åˆ°äº’åŠ¨é¡¹:", actionId);
        return;
    }
    if (action.req) {
        if (action.req.favor && gameState.marriage.favor < action.req.favor) {
            showToast(`æ©å® å€¼ä¸è¶³ ${action.req.favor}`); return;
        }
        if (action.req.authority && (gameState.marriage.householdAuthority.progress || 0) < action.req.authority) {
            showToast(`æŒå®¶æƒä¸è¶³ ${action.req.authority}`); return;
        }
        if (action.req.has_evidence && !gameState.flags.hasConcubineEvidence) {
            showToast("ç¼ºå°‘å…³é”®ç½ªè¯"); return;
        }
    }
    let resultText = '';
    switch(actionId) {
        case 'care_inquiry':
            if (spouse.dynamicState === 'å¿ƒçƒ¦æ„ä¹±') {
                resultText = `ä»–å¹äº†å£æ°”ï¼Œå‘ä½ æŠ±æ€¨å·¥ä½œçš„çƒ¦æ¼ã€‚ä½ è½»æŸ”åœ°ä¸ºä»–æŒ‰æ‰å¤ªé˜³ç©´ï¼ŒåŠä»–æ”¾å®½å¿ƒã€‚`;
                applyEffects({ marriage: { favor: 5 }});
            } else {
                resultText = `ä»–ç¬‘ç€ä¸ä½ åˆ†äº«ä»Šæ—¥çš„è¶£äº‹ï¼Œå¹¶ç§°èµä½ çš„å…³æ€€å¤‡è‡³ã€‚`;
                applyEffects({ marriage: { favor: 3 }});
            }
            break;
        case 'red_sleeve':
            resultText = `ä½ åœ¨ä¹¦æˆ¿ä¸ºä»–çº¢è¢–æ·»é¦™ï¼Œä»–è¯»ä¹¦ä¹‹ä½™ï¼ŒæŠ¬å¤´æœ›ä½ ï¼Œçœ¼ä¸­æ»¡æ˜¯æŸ”æƒ…ã€‚`;
            applyEffects({ marriage: { favor: 4 }, attributes: { talent: 1 }});
            break;
        case 'drink_chess':
            if (gameState.player.attributes.talent > (spouse.attributes.talent || 50)) {
                resultText = `ä½ ä»¬æ£‹é€¢å¯¹æ‰‹ï¼Œé…£ç•…æ·‹æ¼“ã€‚ä»–å¯¹ä½ çš„æ£‹è‰ºå¤§åŠ èµèµã€‚`;
                applyEffects({ marriage: { favor: 8 }, attributes: { talent: 2 }});
            } else {
                resultText = `ä½ è™½è´¥äº†åŠå­ï¼Œä½†è¿‡ç¨‹ç²¾å½©ï¼Œäº¦æ˜¯ä¹äº‹ã€‚`;
                applyEffects({ marriage: { favor: 4 }});
            }
            break;
        case 'give_gift':
            if (gameState.finances.wealth < 300) { showToast("ä½ çš„ç§äº§ä¸è¶³300ä¸¤ã€‚"); return; }
            applyEffects({ wealth: -300, marriage: { favor: 6 }});
            resultText = 'ä½ ç”¨ç§äº§ä¸ºä»–å‡†å¤‡äº†ä¸€ä»½è´´å¿ƒçš„ç¤¼ç‰©ï¼Œä»–ååˆ†æ¬¢å–œã€‚';
            break;
        // [æ–°å¢]
        case 'prepare_meal':
            resultText = 'ä½ äº²æ‰‹ä¸ºä»–å‡†å¤‡äº†ä»–æœ€çˆ±çš„ç‚¹å¿ƒï¼Œä»–å¤¸èµä½ çš„æ‰‹è‰ºã€‚';
            applyEffects({ marriage: { favor: 5 }, attributes: { virtue: 1 }});
            break;
        // [æ–°å¢]
        case 'play_music':
            resultText = 'ä½ çš„ç´å£°æ‚ æ‰¬ï¼Œä¸ºä»–é©±æ•£äº†ç–²æƒ«ï¼Œè®©ä»–å¯¹ä½ æ›´æ·»çˆ±æ„ã€‚';
            applyEffects({ marriage: { favor: 10 }, attributes: { talent: 2 }});
            break;
        case 'manage_network':
            if (gameState.player.privateAssets < 500) { showToast("ç§äº§ä¸è¶³ã€‚"); return; }
            applyEffects({ privateAssets: -500, marriage: { favor: 15 }});
            if (spouse.career) spouse.career.performance = (spouse.career.performance || 0) + 20;
            resultText = `ä½ èŠ±è´¹500ä¸¤ç§äº§ï¼Œä»¥ä½ çš„åä¹‰ä¸ºå¤«å›çš„ä¸Šå¸é€å»åšç¤¼ã€‚å¤«å›çš„äº‹ä¸šå› æ­¤é¡ºé‚ä¸å°‘ï¼Œå¯¹ä½ æ„Ÿæ¿€ä¸å°½ã€‚`;
            break;
        case 'analyze_situation':
            resultText = 'ä½ ä¸ºä»–åˆ†æäº†æœå ‚ä¸Šçš„åˆ©å®³å…³ç³»ï¼Œå¹¶æå‡ºäº†åº”å¯¹ä¹‹ç­–ï¼Œä»–èŒ…å¡é¡¿å¼€ï¼ŒæˆåŠŸåŒ–è§£å±æœºã€‚';
            applyEffects({ marriage: { favor: 20 }, attributes: { scheming: 2 } });
            break;
        // [æ–°å¢]
        case 'use_family_ties':
            resultText = 'ä½ åŠ¨ç”¨å¨˜å®¶çš„å…³ç³»ï¼Œä¸ºå¤«å›è§£å†³äº†ä¸€ä¸ªéš¾é¢˜ï¼Œä»–åœ¨å®¶æ—ä¸­çš„åœ°ä½ä¹Ÿå› æ­¤æ›´åŠ ç¨³å›ºã€‚';
            applyEffects({ marriage: { favor: 18 }, reputation: 10 });
            break;
        // [æ–°å¢]
        case 'praise_husband':
            resultText = 'ä½ åœ¨è´µå¦‡åœˆä¸­æœ‰æ„æ— æ„åœ°ç§°èµå¤«å›ï¼Œä¸ºä»–è¥é€ äº†è‰¯å¥½çš„åå£°ã€‚';
            applyEffects({ marriage: { favor: 7 }, reputation: 5 });
            break;
        case 'pillow_talk':
            showDecisionCard('å¹æ•è¾¹é£', 'fa-bed', 'å¤œæ·±äººé™ï¼Œä½ æ‰“ç®—å‘å¤«å›æš—ç¤ºäº›ä»€ä¹ˆï¼Ÿ', [
                {htmlContent: 'ã€æš—ç¤ºæŒå®¶æƒã€‘', callback: () => {
                    resultText = 'â€œæ¯äº²å¤§äººå¹´çºªå¤§äº†ï¼ŒæŒç®¡è¿™ä¹ˆå¤§çš„å®¶ä¸šå®åœ¨è¾›åŠ³ã€‚å¦¾èº«çœŸå¸Œæœ›èƒ½ä¸ºæ¯äº²åˆ†å¿§ã€‚â€ä½ çš„è¯è¯­å·§å¦™åœ°æé†’äº†å¤«å›ã€‚';
                    gameState.flags.authorityTransferHint = (gameState.flags.authorityTransferHint || 0) + 1;
                    showEventCard('æ•è¾¹é£', 'fa-bed', resultText);
                }},
                {htmlContent: 'ã€æŠ±æ€¨å¦¾å®¤ã€‘', callback: () => {
                    const concubines = spouse.concubines.map(id => gameState.npcs[id]).filter(Boolean);
                    if (concubines.length > 0) {
                        const target = getRandomElement(concubines);
                        resultText = `ä½ å·§å¦™åœ°æŠ±æ€¨äº†${target.name}çš„æŸäº›è¡Œä¸ºï¼Œå¤«å›è™½æœªå¤šè¨€ï¼Œä½†å·²è®°åœ¨å¿ƒé‡Œã€‚`;
                        applyEffects({relationship: { targetId: target.id, favor: -5 }});
                    } else {
                        resultText = 'ä½ å¹¶æ— å¦¾å®¤å¯æŠ±æ€¨ã€‚';
                    }
                    showEventCard('æ•è¾¹é£', 'fa-bed', resultText);
                }}
            ]);
            return; 
        // [æ–°å¢]
        case 'discuss_children_edu':
            const children = gameState.children.filter(c => !c.isDead && c.age > 5 && c.age < 16);
            if (children.length > 0) {
                const child = getRandomElement(children);
                resultText = `ä½ ä»¬ä¸€åŒä¸º ${child.name} çš„æœªæ¥åšè§„åˆ’ï¼Œç›¸è°ˆç”šæ¬¢ï¼Œè®©ä»–æ„Ÿå—åˆ°äº†å®¶åº­çš„æ¸©æš–ã€‚`;
                applyEffects({ marriage: { favor: 10 } });
            } else {
                resultText = 'ä½ ä»¬æš‚æ—¶æ²¡æœ‰éœ€è¦è§„åˆ’å‰ç¨‹çš„å­å¥³ã€‚';
            }
            break;
        // [æ–°å¢]
        case 'request_authority':
            if ((gameState.marriage.householdAuthorityHolder || 'mother') === 'mother') {
                resultText = 'ä½ å‘å¤«å›è¡¨è¾¾äº†å¸Œæœ›æ‰§æŒå®¶äº‹çš„æ„æ„¿ï¼Œä»–è¡¨ç¤ºä¼šè€ƒè™‘ã€‚';
                gameState.flags.authorityTransferHint = (gameState.flags.authorityTransferHint || 0) + 2;
                applyEffects({ marriage: { favor: 5 } });
            } else {
                resultText = 'ä½ å·²æ˜¯å½“å®¶ä¸»æ¯ï¼Œæ— éœ€å†è¯·æ±‚ã€‚';
            }
            break;
        case 'expel_concubine':
            triggerExpelConcubineEvent();
            return;
        default:
            resultText = `ä½ ä¸å¤«å›è¿›è¡Œäº†ä¸€æ¬¡æ·±å…¥çš„äº¤æµã€‚`;
            break;
    }
    showEventCard(action.name, 'fa-users', resultText);
    renderGame();
}

function acquireConcubine(npcId) {
    const npc = gameState.npcs[npcId];
    const wife = gameState.marriage.isMarried ? gameState.npcs[gameState.marriage.spouseId] : null;

    if(gameState.marriage.concubines.length >= 5) { showToast("å¦¾å®¤åé¢å·²æ»¡ã€‚"); return; }

    const cost = { 'fyj': 10000, 'matchmaker': 1500, 'friend': 5000 }[npc.source] || 1500;
    if(gameState.finances.wealth < cost) { showToast("çº³å¦¾è´¹ç”¨ä¸è¶³ã€‚"); return; }

    if (wife && wife.favor < 50 && Math.random() < 0.3) {
        const bribeStr = prompt(`${wife.name}å¯¹æ­¤äº‹é¢‡æœ‰å¾®è¯ï¼Œä½ æ„¿æ„èŠ±è´¹å¤šå°‘æ¥å®‰æŠšå¥¹ï¼Ÿï¼ˆå½“å‰ç§äº§ï¼š${gameState.finances.wealth}ï¼‰`, '1000');
        const bribeCost = parseInt(bribeStr);
        if (isNaN(bribeCost) || bribeCost <= 0) {
            showEventCard('çº³å¦¾å¤±è´¥', 'fa-times-circle', `${wife.name}è§ä½ æ¯«æ— è¯šæ„ï¼Œåšå†³ä¸åŒæ„çº³å¦¾ã€‚`); return;
        }
        if (gameState.finances.wealth < cost + bribeCost) { showToast("ä½ çš„ç§äº§ä¸è¶³ä»¥æ”¯ä»˜çº³å¦¾åŠå®‰æŠšè´¹ç”¨ã€‚"); return; }
        
        applyEffects({wealth: -bribeCost, relationship: {targetId: wife.id, favor: -20 + Math.floor(bribeCost / 100)}});
        showEventCard('åå®…é£æ³¢', 'fa-donate', `ä½ èŠ±è´¹ <span class='value'>${bribeCost}</span> ä¸¤å®‰æŠšäº†${wife.name}ï¼Œå¥¹æœ€ç»ˆåŒæ„ä½ çº³${npc.name}ä¸ºå¦¾ã€‚`);
    }

    applyEffects({wealth: -cost});
    gameState.marriage.concubines.push(npcId);
    npc.relationship = 'concubine';

    ["suitors", "friends", "secretLovers"].forEach(listName => {
        gameState.social[listName] = gameState.social[listName]?.filter(id => id !== npcId);
    });

    showEventCard('å–œå¾—æ–°å¦‡', 'fa-user-plus', `ä½ èŠ±è´¹<span class='value'>${cost}</span>ä¸¤ï¼Œå°† <strong class="highlight-npc">${npc.name}</strong> çº³ä¸ºå¦¾å®¤ã€‚`);
    closeAllOverlays();
    renderGame();
    updateActiveTab('marriage');
}

function handleDivorce() {
    const spouse = gameState.npcs[gameState.marriage.spouseId];

    if (!spouse || spouse.isDead) {
        showToast("æ–¯äººå·²é€ï¼Œå°˜ç¼˜å·²äº†ã€‚");
        renderGame();
        return;
    }

    const warningText = `å’Œç¦»ä¹ƒäººç”Ÿå¤§äº‹ï¼Œä½ çœŸçš„å†³å®šè¦ä¸ <strong class="highlight-npc">${spouse.name}</strong> ä¸€åˆ«ä¸¤å®½å—ï¼Ÿ<br><br>
                         <small>æ­¤ä¸¾å°†ä¸¥é‡å½±å“ä½ çš„å£°èª‰ä¸äº‹ä¸šï¼Œå®¶åº“è´¢äº§ä¼šè¢«åˆ†å‰²ï¼Œä½ è¿˜å¯èƒ½å¤±å»éƒ¨åˆ†å­å¥³çš„æŠšå…»æƒã€‚</small>`;
    
    const options = [
        {
            htmlContent: `<i class="fas fa-heart-broken"></i> ç¡®è®¤å’Œç¦»`,
            style: 'background:linear-gradient(135deg, #e74c3c, #c0392b);',
            callback: () => confirmDivorce()
        },
        {
            htmlContent: `<i class="fas fa-times"></i> æˆ‘å†æƒ³æƒ³`,
            callback: () => closeAllOverlays()
        }
    ];

    showDecisionCard('å†³æ„å’Œç¦»', 'ğŸ’”', warningText, options);
}
// [æ›¿æ¢]
// [æ–°å¢æ­¤å‡½æ•°]
function triggerPunishment_Female(gs, type) {
    const husband = gs.npcs[gs.marriage.spouseId];
    const motherInLaw = gs.npcs[gs.family.members.motherId];
    let content = `ä½ ä¸æƒ…äººä¹‹äº‹ä¸œçª—äº‹å‘ï¼Œå¤«å®¶éœ‡æ€’ï¼Œ<strong class="highlight-npc">${husband.name}</strong>å°†ä¸€çº¸ä¼‘ä¹¦ï¼ˆæˆ–ä¸€æ¯æ¯’é…’ï¼‰æ‘†åœ¨ä½ é¢å‰ã€‚åœ¨è¿™ç”Ÿæ­»å…³å¤´ï¼Œä½ å†³å®š...`;
    let options = [];

    // é€‰é¡¹1: æ±‚åŠ©å©†å©† (éœ€è¦ä¸å©†å©†å…³ç³»å¥½)
    if (motherInLaw && motherInLaw.favor > 60) {
        options.push({
            htmlContent: `<i class="fas fa-praying-hands"></i> å‘å©†å©†æ±‚æƒ…`,
            callback: () => {
                // å©†å©†å‡ºé¢ï¼Œæƒ©ç½šé™çº§
                showEventCard('å©†å©†å‡ºé¢', 'fa-shield-alt', 'åœ¨å©†å©†çš„åŠ›ä¿ä¹‹ä¸‹ï¼Œä½ å…äºä¸€æ­»ï¼Œä½†ä»è¢«ä¼‘å¼ƒï¼Œå‡€èº«å‡ºæˆ·ã€‚');
                gs.flags.playerStatus = 'divorced';
                // æ¸…ç†å©šå§»çŠ¶æ€
                gameState.marriage.isMarried = false;
                gameState.marriage.spouseId = null;
                gameState.children = gs.children.filter(c => c.fatherId !== husband.id);
                renderGame();
            }
        });
    }

    // é€‰é¡¹2: ç”¨æŒå®¶æƒåšå¼ˆ
    if ((gs.marriage.householdAuthority.progress || 0) >= 100) {
        options.push({
            htmlContent: `<i class="fas fa-key"></i> åŠ¨ç”¨æŒå®¶æƒ`,
            callback: () => {
                showEventCard('é±¼æ­»ç½‘ç ´', 'fa-bomb', 'ä½ ä»¥æŒå®¶æƒå’Œåºœä¸­ç§˜å¯†ç›¸è¦æŒŸï¼Œå¤«å®¶æŠ•é¼ å¿Œå™¨ï¼Œæœ€ç»ˆæ­¤äº‹ä¸äº†äº†ä¹‹ï¼Œä½†ä½ ä»¬çš„å¤«å¦»å…³ç³»å·²åå­˜å®äº¡ã€‚');
                applyEffects({ marriage: { favor: -100 } }); // æ©çˆ±å€¼é™åˆ°æœ€ä½
                husband.suspicionValue = 100;
            }
        });
    }

    // é€‰é¡¹3: æ ½èµƒé™·å®³ (é«˜å¿ƒè®¡)
    if (gs.player.attributes.scheming > 120) {
        options.push({
            htmlContent: `<i class="fas fa-theater-masks"></i> æ ½èµƒå¦¾å®¤`,
            callback: () => {
                const concubines = husband.concubines.map(id=>gs.npcs[id]).filter(c=>c&&!c.isDead);
                if(concubines.length > 0) {
                    const scapegoat = getRandomElement(concubines);
                    scapegoat.isDead = true; // æˆä¸ºæ›¿ç½ªç¾Š
                     husband.concubines = husband.concubines.filter(id => id !== scapegoat.id);
                    showEventCard('æ ½èµƒé™·å®³', 'fa-user-secret', `ä½ ç”¨é«˜æ˜æ‰‹æ®µï¼Œå°†ä¸€åˆ‡æ ½èµƒç»™å¦¾å®¤<strong class="highlight-npc">${scapegoat.name}</strong>ï¼Œå¥¹æˆäº†ä½ çš„æ›¿ç½ªç¾Šã€‚ä½ æš‚æ—¶å®‰å…¨äº†ï¼Œä½†å“å¾·å¤§æŸã€‚`);
                    applyEffects({ attributes: { virtue: -30 } });
                } else {
                     showEventCard('æ— è®¡å¯æ–½', 'fa-times', `åé™¢å¹¶æ— å¥¹äººï¼Œä½ æ‰¾ä¸åˆ°å¯ä»¥æ ½èµƒçš„å¯¹è±¡ã€‚`);
                }
            }
        });
    }

    // é»˜è®¤é€‰é¡¹
    options.push({
        htmlContent: `<i class="fas fa-gavel"></i> æŸæ‰‹å°±æ“’`,
        callback: () => {
             if (type === 'ä¼‘å¼ƒ') {
                showEventCard('ä¸€çº¸ä¼‘ä¹¦', 'fa-file-signature', 'ä½ è¢«å‡€èº«å‡ºæˆ·ï¼Œå¤±å»æ‰€æœ‰å­å¥³ï¼Œå£°æœ›å°½æ¯ï¼Œä½†æ€»ç®—ä¿ä½äº†æ€§å‘½ã€‚');
                gs.flags.playerStatus = 'divorced';
                gameState.marriage.isMarried = false;
                gameState.marriage.spouseId = null;
                gameState.children = gs.children.filter(c => c.fatherId !== husband.id);
            } else if (type === 'èµæ­»') {
                showEndGame({ title: "çº¢é¢œè–„å‘½", text: `ä½ å› â€œä¸è´â€è¢«å¤«å®¶èµæ­»ï¼Œå¹´ä»…${Math.floor(gs.player.age)}å²ã€‚` });
            }
        }
    });

    showDecisionCard('ç”Ÿæ­»å…³å¤´', 'fa-heartbeat', content, options);
}
function confirmDivorce() {
    const exSpouseId = gameState.marriage.spouseId;
    const exSpouse = gameState.npcs[exSpouseId];

    applyEffects({attributes: {reputation: -50, virtue: -20}});
    if(gameState.career.path) {
        gameState.career.performance = Math.max(0, gameState.career.performance - 50);
        applyEffects({relationship:{targetId: gameState.career.supervisorId, favor: -20}});
    }

    const moneyToKeep = Math.floor(gameState.family.moneyChest * (gameState.player.gender === 'female' ? 0.7 : 0.3));
    gameState.family.moneyChest = 0;
    applyEffects({ wealth: moneyToKeep });

    const childrenOfMarriage = gameState.children.filter(c => (c.motherId === exSpouseId || (c.fatherId === 'player' && c.motherId === exSpouse.id)));
    let childrenWithPlayer = gameState.children.filter(c => !childrenOfMarriage.includes(c));
    let childrenWithSpouse = [];

    childrenOfMarriage.forEach(child => {
        (gameState.player.attributes.virtue > exSpouse.attributes.virtue || Math.random() < 0.7 ? childrenWithPlayer : childrenWithSpouse).push(child);
    });
    gameState.children = childrenWithPlayer;
    
    const lostChildrenNames = childrenWithSpouse.length > 0 ? `ä½ çš„å­©å­ ${childrenWithSpouse.map(c => c.name).join('ã€')} å°†ç”±å¯¹æ–¹æŠšå…»ã€‚` : '';
    const breakupLog = `ä½ ä¸<strong class="highlight-npc">${exSpouse.name}</strong>å’Œç¦»ï¼Œåˆ†å‰²å®¶äº§åä½ åˆ†å¾— <span class='value'>${moneyToKeep}</span> ä¸¤ã€‚${lostChildrenNames}æ­¤äº‹åœ¨äº¬ä¸­å¼•èµ·è®®è®ºï¼Œä½ çš„å£°æœ›å—åˆ°å½±å“ã€‚`;
    
    showEventCard('ä¸€åˆ«ä¸¤å®½', 'fa-heart-broken', breakupLog);
    
    gameState.marriage.isMarried = false;
    gameState.marriage.spouseId = null;
    gameState.marriage.favor = 0;
    applyEffects({relationship: { targetId: exSpouseId, favor: -100 }});
    exSpouse.relationship = 'stranger';

    if (gameState.player.gender === 'male' && gameState.marriage.concubines.length > 0) {
        const concubineToPromote = gameState.marriage.concubines.map(id => gameState.npcs[id]).sort((a,b) => b.favor - a.favor)[0];
        if (concubineToPromote) {
            const options = [
                {htmlContent: `æ‰¶ä¸ºæ­£å¦»`, callback: () => promoteConcubine(concubineToPromote.id)},
                {htmlContent: `æš‚ä¸è€ƒè™‘`, callback: () => closeAllOverlays()}
            ];
            showDecisionCard('æ‰¶æ­£å¦¾å®¤', 'fa-chess-queen', `ä½ å¦‚ä»Šå­‘ç„¶ä¸€èº«ï¼Œæ˜¯å¦è¦å°†å¦¾å®¤${concubineToPromote.name}æ‰¶ä¸ºæ­£å¦»ï¼Ÿ`, options);
        }
    }
    renderGame();
}
/**
 * ã€æ–°å¢ã€‘è§¦å‘â€œç»´ç³»ä¿¡ä»»â€éšæœºäº‹ä»¶çš„æ ¸å¿ƒå‡½æ•°
 * @param {string} type - 'gift', 'talk', 'accompany'
 */
function triggerTrustEvent(type) {
    // [ä¿®å¤] æ£€æŸ¥ç‹¬ç«‹çš„ä¿¡ä»»äº’åŠ¨è®¡æ•°å™¨
    if ((gameState.flags.actionUsed_trustActions || 0) >= 2) {
        showToast("æœ¬å›åˆç»´ç³»ä¿¡ä»»çš„æ¬¡æ•°å·²ç”¨å°½ã€‚");
        return;
    }

    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if (!spouse) {
        showToast("ä½ å°šæœªæˆå®¶ã€‚");
        return;
    }

    // æ ¹æ®ç©å®¶æ€§åˆ«é€‰æ‹©äº‹ä»¶åº“
    const eventPool = gameState.player.gender === 'male' ? MALE_TRUST_EVENTS[type] : FEMALE_TRUST_EVENTS[type];
    if (!eventPool || eventPool.length === 0) {
        showToast("æš‚æ— æ­¤ç±»äº’åŠ¨äº‹ä»¶ã€‚");
        return;
    }

    const event = getRandomElement(eventPool);

    const options = event.options.map(opt => {
        let canChoose = true;
        let reason = '';
        if (opt.cost) {
            if (opt.cost.wealth && gameState.finances.wealth < opt.cost.wealth) {
                canChoose = false;
                reason = `(ç§äº§ä¸è¶³ ${opt.cost.wealth} ä¸¤)`;
            }
        }
        if (opt.req) {
            for (const attr in opt.req) {
                if ((gameState.player.attributes[attr] || 0) < opt.req[attr]) {
                    canChoose = false;
                    reason = `(${ATTR_MAP[attr]}éœ€â‰¥${opt.req[attr]})`;
                    break;
                }
            }
        }

        return {
            htmlContent: `<span class="option-text">${opt.text} ${reason}</span>`,
            disabled: !canChoose,
            callback: () => {
                // [ä¿®å¤] åœ¨å›è°ƒå‡½æ•°å†…éƒ¨ï¼Œå…ˆå¢åŠ ä½¿ç”¨æ¬¡æ•°
                gameState.flags.actionUsed_trustActions = (gameState.flags.actionUsed_trustActions || 0) + 1;

                // æ‰£é™¤æˆæœ¬
                if (opt.cost && opt.cost.wealth) {
                    applyEffects({ wealth: -opt.cost.wealth });
                }

                // åº”ç”¨æ•ˆæœ
                if (opt.effects) {
                    if (opt.effects.suspicion) {
                        spouse.suspicionValue = Math.max(0, (spouse.suspicionValue || 0) + opt.effects.suspicion);
                    }
                    if (opt.effects.favor) {
                        applyEffects({ marriage: { favor: opt.effects.favor }});
                    }
                    if (opt.effects.reputation) {
                        applyEffects({ reputation: opt.effects.reputation });
                    }
                }

                showEventCard(event.title, 'fa-shield-alt', opt.log);
                renderGame();
            }
        };
    });

    showDecisionCard(event.title, 'fa-shield-alt', event.desc, options);
}
function promoteConcubine(concubineId) {
    const concubineToPromote = gameState.npcs[concubineId];
    gameState.marriage.isMarried = true;
    gameState.marriage.spouseId = concubineToPromote.id;
    applyEffects({ relationship: { targetId: concubineId, favor: 20 } });
    gameState.marriage.concubines = gameState.marriage.concubines.filter(cid => cid !== concubineId);
    concubineToPromote.relationship = 'spouse';

    gameState.children.forEach(child => {
        if(child.motherId === concubineId) child.isSecret = false; 
    });

    showEventCard('å–œç»“è¿ç†', 'fa-ring', `ä½ å°†<strong class="highlight-npc">${concubineToPromote.name}</strong>æ‰¶ä¸ºæ­£å¦»ã€‚å¥¹çš„å­©å­ä»¬ä¹Ÿæˆä¸ºäº†å«¡å‡ºã€‚`);
    renderGame();
}
function updateInfidelityRisk() {
    if (gameState.player.gender !== 'male' || !gameState.marriage.isMarried) return;
    const wife = gameState.npcs[gameState.marriage.spouseId];
    if(!wife) return;
    if (gameState.flags.brothelVisitCount > 30 && Math.random() < 0.3) {
        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤ç‚¹ã€‘å°†ç›´æ¥æ˜¾ç¤ºå¼¹çª—æ”¹ä¸ºæ¨å…¥äº‹ä»¶é˜Ÿåˆ— â–¼â–¼â–¼
        eventQueue.push(() => {
            showEventCard('åå®…ä¸å®', 'ğŸ’”', `ä½ æµè¿é£æœˆåœºæ‰€ä¹‹äº‹ç»ˆç©¶ä¼ åˆ°äº†å¤«äºº<strong class="highlight-npc">${wife.name}</strong>è€³ä¸­ï¼Œå¥¹å¿ƒç°æ„å†·ï¼Œå‘ä½ æå‡ºå’Œç¦»ã€‚`);
            confirmDivorce();
        });
        // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
        return;
    }
    const mostFavoredConcubine = gameState.marriage.concubines
        .map(id => gameState.npcs[id])
        .filter(c => c && !c.isDead)
        .sort((a, b) => b.favor - a.favor)[0];

    if (mostFavoredConcubine && mostFavoredConcubine.favor > wife.favor + 20 && wife.favor < 60) {
        wife.infidelityRisk = (wife.infidelityRisk || 0) + 1; // 1 turn is half a year
        if (wife.infidelityRisk >= 6) { // 3 years
            wife.infidelityRisk = 0;
            // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤ç‚¹ã€‘å°†ç›´æ¥æ˜¾ç¤ºå¼¹çª—æ”¹ä¸ºæ¨å…¥äº‹ä»¶é˜Ÿåˆ— â–¼â–¼â–¼
            eventQueue.push(() => {
                showEventCard('åå®…èµ·ç«', 'ğŸ˜±', `ä½ å‘ç°æ­£å¦»${wife.name}å› è¢«å†·è½ï¼Œä¸äººæœ‰æŸ“ï¼æ©çˆ±å€¼å¤§å¹…ä¸‹é™ã€‚`);
            });
            // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
            applyEffects({relationship:{targetId: wife.id, favor: -50}, attributes: {reputation: -20}});
        }
        if(wife.infidelityRisk >= 30) { // 15 years...
            const targetChild = gameState.children.find(c => c.motherId === wife.id && c.age >= 16);
            if(targetChild) {
                targetChild.fatherId = `unknown_${Date.now()}`;
                // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤ç‚¹ã€‘å°†ç›´æ¥æ˜¾ç¤ºå¼¹çª—æ”¹ä¸ºæ¨å…¥äº‹ä»¶é˜Ÿåˆ— â–¼â–¼â–¼
                eventQueue.push(() => {
                    showEventCard('æƒŠå¤©ç§˜é—»', 'ğŸ˜±', `ä½ å¶ç„¶å‘ç°ï¼Œä½ æŠšå…»å¤šå¹´çš„å«¡å­/å¥³ <strong class="highlight-npc">${targetChild.name}</strong> ç«Ÿéä½ äº²ç”Ÿï¼`);
                });
                // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
                applyEffects({attributes: {health: -20}});
                wife.infidelityRisk = -999; // event triggered
            }
        }
    } else {
        if(wife.infidelityRisk > 0) wife.infidelityRisk--;
    }
}
// ================= ã€æœ€ç»ˆå†³å®šç‰ˆÂ·å®…æ–—ç³»ç»Ÿå®Œæ•´æ¨¡å—ã€‘ =================
function hasAnyConcubineKeyEvidence() {
    // ä¼˜å…ˆæ£€æŸ¥å®˜æ–¹çš„é€»è¾‘æ ‡è®°
    if (gameState.flags.hasConcubineEvidence) {
        return true;
    }
    // å¦‚æœé€»è¾‘æ ‡è®°ä¸å­˜åœ¨ï¼ˆæ¯”å¦‚é€šè¿‡æ—§çš„å¼€å‘è€…æ¨¡å¼ç”Ÿæˆï¼‰ï¼Œåˆ™æ£€æŸ¥æ‰€æœ‰å¦¾å®¤æ˜¯å¦æœ‰â€œæ˜¾ç¤ºæ ‡è®°â€
    const husband = gameState.npcs[gameState.marriage.spouseId];
    if (!husband || !husband.concubines) return false;
    
    return husband.concubines
        .map(id => gameState.npcs[id])
        .some(c => c && !c.isDead && c.keyEvidence);
}
function updateExpelButtonState() {
    const expelButton = document.getElementById('expel-concubine-btn');
    const expelButtonDesc = document.getElementById('expel-concubine-desc');
    if (!expelButton || !expelButtonDesc) return;

    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä½¿ç”¨æ–°çš„ã€æ›´å¯é çš„æ£€æŸ¥å‡½æ•°
    const canExpel = hasAnyConcubineKeyEvidence();

    if (canExpel) {
        expelButton.disabled = false;
        expelButtonDesc.innerHTML = 'è¯æ®ç¡®å‡¿ï¼Œå¯ä»¥å¤„ç½®äº†ï¼';
    } else {
        expelButton.disabled = true;
        expelButtonDesc.innerHTML = 'éœ€: åˆæˆå…³é”®ç½ªè¯';
    }
}

/**
 * ã€ä¿®å¤åçš„å¼€å‘è€…å‡½æ•°ã€‘
 * ä¿®å¤äº†æ‚¨ä¹‹å‰ç‰ˆæœ¬åªæ”¹æ˜¾ç¤ºã€ä¸æ”¹é€»è¾‘çš„é—®é¢˜ã€‚
 * æ³¨æ„ï¼šhasConcubineEvidence æ ‡è®°ä¸€æ¬¡åªèƒ½æŒ‡å‘ä¸€ä¸ªäººã€‚
 */
function debug_generateAllEvidence() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    if (!husband || !husband.concubines || husband.concubines.length === 0) {
        showToast("é”™è¯¯ï¼šå¤«å›ä¸å­˜åœ¨æˆ–å°šæ— å¦¾å®¤ã€‚");
        return;
    }
    
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    if (concubines.length === 0) {
        showToast("æ²¡æœ‰å¦¾å®¤å¯ä»¥ç”Ÿæˆè¯æ®ã€‚");
        return;
    }

    let names = [];
    concubines.forEach((conc, index) => {
        // 1. è®¾ç½®UIæ˜¾ç¤ºå±æ€§
        conc.keyEvidence = 'ç½ªè¯ç¡®å‡¿ï¼Œå·²æ•´ç†æˆå†Œ (ç”±å¼€å‘è€…æ¨¡å¼ç”Ÿæˆ)';
        names.push(conc.name);
        
        // 2. ã€æ ¸å¿ƒä¿®å¤ã€‘åŒæ—¶è®¾ç½®åå°é€»è¾‘æ ‡è®°ï¼
        // é»˜è®¤å°†æ ‡è®°æŒ‡å‘ç¬¬ä¸€ä¸ªè¢«å¤„ç†çš„å¦¾å®¤
        if (index === 0) {
            gameState.flags.hasConcubineEvidence = conc.id;
        }
    });

    showToast(`å·²ä¸º ${names.join(' å’Œ ')} ç”Ÿæˆäº†å…³é”®ç½ªè¯ï¼`);
    
    // 3. ã€æ ¸å¿ƒä¿®å¤ã€‘ç”Ÿæˆè¯æ®åï¼Œç«‹åˆ»è°ƒç”¨æ£€æŸ¥æœºåˆ¶åˆ·æ–°æŒ‰é’®ï¼
    updateExpelButtonState();
    closeAllOverlays();
    renderGame();
}

function showHaremReshapingUI() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband ? husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead) : [];

    const options = [
        {
            htmlContent: `<i class="fas fa-gavel"></i><span class="option-text"><strong>æ•²å±±éœ‡è™</strong><div><small>å…¬å¼€æƒ©ç½šä¸€ä½å¦¾å®¤ä»¥ç«‹å¨</small></div></span>`,
            disabled: concubines.length === 0,
            callback: () => handleAssertDominance()
        },
        {
            htmlContent: `<i class="fas fa-balance-scale"></i><span class="option-text"><strong>æ©å¨å¹¶æ–½</strong><div><small>è°ƒæ•´å¦¾å®¤ä»¬çš„æœˆä¾‹ä»½ä¾‹</small></div></span>`,
            disabled: concubines.length === 0,
            callback: () => handleCarrotAndStick()
        },
        {
            htmlContent: `<i class="fas fa-search-minus"></i><span class="option-text"><strong>é‡œåº•æŠ½è–ª</strong><div><small>æš—ä¸­è°ƒæŸ¥å¦¾å®¤ï¼Œæ”¶é›†é›¶æ•£è¯æ®</small></div></span>`,
            disabled: concubines.length === 0 || (gameState.player.attributes.scheming || 0) < 60,
            callback: () => startInvestigation()
        },
        {
            htmlContent: `<i class="fas fa-folder-open"></i><span class="option-text"><strong>ç½ªè¯ç®¡ç†</strong><div><small>æŸ¥çœ‹å¹¶æ•´åˆä½ æ”¶é›†åˆ°çš„æ‰€æœ‰è¯æ®</small></div></span>`,
            callback: () => showEvidenceManagementUI()
        },
        {
            // ä¸ºæŒ‰é’®å’Œæè¿°æ·»åŠ äº†IDï¼Œä»¥ä¾¿JSå¯ä»¥ç²¾ç¡®æ§åˆ¶å®ƒä»¬
            htmlContent: `<button id="expel-concubine-btn" class="option" style="width:100%; padding:0; border:none; background:transparent; color:white;" onclick="triggerExpelConcubineEvent()">
                            <i class="fas fa-user-times"></i><span class="option-text"><strong>é©±èµ¶æ¶å¦¾</strong>
                            <div id="expel-concubine-desc"><small>éœ€: åˆæˆå…³é”®ç½ªè¯</small></div></span>
                         </button>`
        }
    ];
    
    let optionsHTML = '';
    options.forEach(opt => {
        if(opt.callback) {
            optionsHTML += `<button class="option" ${opt.disabled ? 'disabled' : ''} onclick="this.disabled=true; (${opt.callback.toString()})()">${opt.htmlContent}</button>`;
        } else {
            optionsHTML += opt.htmlContent;
        }
    });

    showDecisionCard('åå®…ç§©åºé‡å¡‘', 'fa-theater-masks', 'ä½ æ‰‹æ¡ç”Ÿæ€å¤§æƒï¼Œåå®…çš„æ¯ä¸€ä¸ªè§’è½éƒ½å¿…é¡»åœ¨ä½ çš„æŒæ§ä¹‹ä¸­ã€‚', optionsHTML);

    // ã€æ ¸å¿ƒæ£€æŸ¥ç‚¹1ã€‘ç•Œé¢æ˜¾ç¤ºåï¼Œç«‹åˆ»è°ƒç”¨æ£€æŸ¥æœºåˆ¶æ›´æ–°æŒ‰é’®åˆå§‹çŠ¶æ€
    setTimeout(updateExpelButtonState, 50);
}
function compileKeyEvidence(concubineId) {
    const target = gameState.npcs[concubineId];
    if (!target) return;
    
    // åŒæ—¶è®¾ç½®åå°é€»è¾‘flagå’ŒUIæ˜¾ç¤ºå±æ€§ï¼Œç¡®ä¿ç»Ÿä¸€
    gameState.flags.hasConcubineEvidence = target.id;
    target.keyEvidence = 'ç½ªè¯ç¡®å‡¿ï¼Œå·²æ•´ç†æˆå†Œ';
    
    if (target.evidence) { target.evidence = { morality: [], finance: [], background: [] }; }
    
    showEventCard('ç½ªè¯ç¡®å‡¿', 'fa-gavel', `ä½ å·²å°†æ‰€æœ‰å…³äº <strong class="highlight-npc">${target.name}</strong> çš„é›¶æ•£è¯æ®æ•´ç†æˆå†Œï¼Œå½¢æˆäº†è¶³ä»¥å®šç½ªçš„å…³é”®è¯æ®ï¼`);
    showEvidenceManagementUI();
    updateExpelButtonState();
}

function showEvidenceManagementUI() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    if (!husband || !husband.concubines || husband.concubines.length === 0) {
        showToast("åå®…å°šæ— å¦¾å®¤å¯ç®¡ç†ç½ªè¯ã€‚");
        return;
    }
    let contentHTML = `<p class="comment" style="text-align:center;">æ­¤å¤„é™ˆåˆ—ç€ä½ æš—ä¸­æ”¶é›†çš„ã€å…³äºå„ä½å¦¾å®¤çš„è¯æ®ã€‚é›†é½ä¸‰ç±»ç½ªè¯ï¼Œæ–¹å¯åˆæˆå…³é”®è¯æ®ï¼Œå°†å…¶å®šç½ªã€‚</p>`;
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    concubines.forEach(conc => {
        if (!conc.evidence) conc.evidence = { morality: [], finance: [], background: [] };
        const evidence = conc.evidence;
        const canCompile = evidence.morality.length > 0 && evidence.finance.length > 0 && evidence.background.length > 0;
        contentHTML += `<div class="section-header" style="margin-top:20px;">${conc.name}</div>`;
        if (conc.keyEvidence) {
            contentHTML += `<div class="inventory-container" style="max-height:none;"><div class="inventory-item" style="border-left: 4px solid #c0392b;"><div class="inventory-item-icon"><i class="fas fa-gavel"></i></div><div class="inventory-item-details"><div class="inventory-item-name">å…³é”®ç½ªè¯</div><div class="inventory-item-desc">${conc.keyEvidence}</div></div></div></div>`;
        } else {
            contentHTML += `<div class="inventory-container" style="max-height:none;"><div class="inventory-item"><div class="inventory-item-icon"><i class="fas fa-theater-masks"></i></div><div class="inventory-item-details"><div class="inventory-item-name">ç§å¾·ä¸ç«¯ <span class="inventory-item-type">${evidence.morality.length}/1</span></div><div class="inventory-item-desc">${evidence.morality.join('ã€') || 'æš‚æ— '}</div></div></div><div class="inventory-item"><div class="inventory-item-icon"><i class="fas fa-file-invoice-dollar"></i></div><div class="inventory-item-details"><div class="inventory-item-name">è´ªå¢¨è´¢ç‰© <span class="inventory-item-type">${evidence.finance.length}/1</span></div><div class="inventory-item-desc">${evidence.finance.join('ã€') || 'æš‚æ— '}</div></div></div><div class="inventory-item"><div class="inventory-item-icon"><i class="fas fa-user-secret"></i></div><div class="inventory-item-details"><div class="inventory-item-name">èƒŒæ™¯ä¸çº¯ <span class="inventory-item-type">${evidence.background.length}/1</span></div><div class="inventory-item-desc">${evidence.background.join('ã€') || 'æš‚æ— '}</div></div></div></div>${!conc.keyEvidence && canCompile ? `<button class="option" style="margin-top:10px; background: linear-gradient(135deg, #e74c3c, #c0392b);" onclick="compileKeyEvidence('${conc.id}')"><i class="fas fa-gavel"></i> åˆæˆå…³é”®ç½ªè¯</button>` : ''}`;
        }
    });
    showDecisionCard('ç½ªè¯ç®¡ç†', 'fa-folder-open', contentHTML, []);
}

/**
 * è§¦å‘é©±é€å¦¾å®¤çš„æœ€ç»ˆå¼¹çª— (ä¿æŒæœ€æ–°)
 */
function triggerExpelConcubineEvent() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    if (!husband || !husband.concubines) return;

    let targetConcubine = null;

    // ä¼˜å…ˆé€šè¿‡å®˜æ–¹çš„é€»è¾‘æ ‡è®°æŸ¥æ‰¾
    if (gameState.flags.hasConcubineEvidence) {
        targetConcubine = gameState.npcs[gameState.flags.hasConcubineEvidence];
    } 
    // å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™é€šè¿‡â€œæ˜¾ç¤ºæ ‡è®°â€è¿›è¡Œåå¤‡æŸ¥æ‰¾
    else {
        targetConcubine = husband.concubines
            .map(id => gameState.npcs[id])
            .find(c => c && !c.isDead && c.keyEvidence);
    }
    
    if (!targetConcubine) {
        showToast("é”™è¯¯ï¼šæœªæ‰¾åˆ°æŒæœ‰å…³é”®ç½ªè¯çš„ç›®æ ‡ã€‚è¯·é‡æ–°è¿›å…¥æ­¤ç•Œé¢ã€‚");
        delete gameState.flags.hasConcubineEvidence;
        updateExpelButtonState();
        return;
    }
    
    const options = [
        {
            htmlContent: `ã€é©±é€ã€‘`, 
            style: 'background: linear-gradient(135deg, #e74c3c, #c0392b);', 
            callback: () => {
                const motherInLaw = gameState.npcs[gameState.family.members.motherId];
                let resultText;
                if (motherInLaw && (motherInLaw.favor || 50) < 0) {
                    resultText = `é“è¯å¦‚å±±ï¼Œä½†å©†å©†å´åšå†³ç»´æŠ¤${targetConcubine.name}ã€‚åœ¨å¥¹çš„é˜»æŒ ä¸‹ï¼Œæœ€ç»ˆ${targetConcubine.name}ä»…è¢«é€å¾€å®¶åº™ï¼Œç»ˆèº«ç›‘ç¦ã€‚`;
                } else {
                    resultText = `é“è¯å¦‚å±±ï¼Œ${targetConcubine.name}è¢«å‰¥å¤ºèº«ä»½ï¼Œé€å‡ºå®¶é—¨ï¼Œæ°¸ä¸è®¸å›ã€‚`;
                }
                husband.concubines = husband.concubines.filter(id => id !== targetConcubine.id);
                targetConcubine.isDead = true; 
                gameState.marriage.familyHarmony = Math.min(100, gameState.marriage.familyHarmony + 20);
                applyEffects({ reputation: 10 });
                delete gameState.flags.hasConcubineEvidence;
                targetConcubine.keyEvidence = null;
                showEventCard('æ¸…ç†é—¨æˆ·', 'fa-gavel', resultText);
                updateActiveTab('marriage');
            }
        },
        {
            htmlContent: 'ã€å®½æ•ã€‘', 
            callback: () => {
                showEventCard('å¦‡äººä¹‹ä»', 'fa-hand-holding-heart', 'ä½ é€‰æ‹©äº†å†ç»™å¥¹ä¸€æ¬¡æœºä¼šï¼Œä½†å¥¹æœªå¿…ä¼šæ„Ÿæ©ã€‚ä½ é”€æ¯äº†è¯æ®ã€‚');
                delete gameState.flags.hasConcubineEvidence;
                targetConcubine.keyEvidence = null;
                showHaremReshapingUI();
            }
        }
    ];

    showDecisionCard(`å¤„ç½® ${targetConcubine.name}`, 'fa-gavel', `ä½ å·²æŒæ¡å¦¾å®¤<strong class="highlight-npc">${targetConcubine.name}</strong>çš„è‡´å‘½ç½ªè¯ã€‚ä½ å†³å®šå¦‚ä½•å¤„ç½®å¥¹ï¼Ÿ`, options);
}
/**
 * å¯åŠ¨è°ƒæŸ¥æµç¨‹ (ä¿æŒæœ€æ–°)
 */
function startInvestigation() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);

    if (gameState.flags.investigatingConcubine) {
        const target = gameState.npcs[gameState.flags.investigatingConcubine.targetId];
        showToast(`ä½ å·²ç»åœ¨è°ƒæŸ¥ ${target.name} äº†ï¼Œè¯·è€å¿ƒç­‰å¾…ç»“æœã€‚`);
        return;
    }

    const options = concubines.map(conc => ({
        htmlContent: `<div class="suitor" style="padding:5px; margin-bottom:0; cursor:pointer;"><div class="suitor-details" style="text-align:left;"><strong>${conc.name}</strong><br><small>æ©å® :${conc.favor} | é‡å¿ƒ:${conc.ambition}</small></div></div>`,
        style: `padding:10px; height:auto;`,
        callback: () => chooseInvestigationMethod(conc.id)
    }));

    showDecisionCard('é€‰æ‹©è°ƒæŸ¥å¯¹è±¡', 'fa-search-minus', 'ä½ è¦å¯¹è°è¿›è¡Œæ·±å…¥è°ƒæŸ¥ï¼Ÿ', options);
}


/**
 * é€‰æ‹©è°ƒæŸ¥æ–¹å¼ (ä¿æŒæœ€æ–°)
 */
function chooseInvestigationMethod(concubineId) {
    const target = gameState.npcs[concubineId];

    const content = `
        <p>ä½ å†³å®šæš—ä¸­è°ƒæŸ¥ <strong class="highlight-npc">${target.name}</strong>ã€‚è¯·é€‰æ‹©ä½ çš„è°ƒæŸ¥æ–¹å¼ä¸æ–¹å‘ï¼š</p>
        
        <div class="section-header" style="margin-top:15px; font-size:1rem;">é€‰æ‹©çœ¼çº¿ (å†³å®šæˆåŠŸç‡)</div>
        <select id="investigation_spy" class="self-compose-input">
            <option value="maid" data-cost="200">æ™®é€šä¸«é¬Ÿ (èŠ±è´¹200ä¸¤ï¼ŒæˆåŠŸç‡è¾ƒä½)</option>
            <option value="mommy" data-cost="500">å¿ƒè…¹å¬·å¬· (èŠ±è´¹500ä¸¤ï¼ŒæˆåŠŸç‡ä¸­ç­‰)</option>
            <option value="betrayer" data-cost="1000" ${gameState.player.attributes.scheming < 80 ? 'disabled' : ''}>æ”¶ä¹°å¯¹æ–¹çš„ä¸«é¬Ÿ (èŠ±è´¹1000ä¸¤ï¼Œå¿ƒè®¡â‰¥80ï¼Œé£é™©é«˜å›æŠ¥é«˜)</option>
        </select>

        <div class="section-header" style="margin-top:15px; font-size:1rem;">é€‰æ‹©è°ƒæŸ¥æ–¹å‘ (å†³å®šç½ªè¯ç±»å‹)</div>
        <select id="investigation_direction" class="self-compose-input">
            <option value="morality">è°ƒæŸ¥ç§å¾· (é€šå¥¸, è™ä»†)</option>
            <option value="finance">è°ƒæŸ¥è´¢åŠ¡ (å·ç›—, è´ªå¢¨)</option>
            <option value="background">è°ƒæŸ¥èº«ä¸– (ä¼ªé€ èƒŒæ™¯, éšè—è¿‡å¾€)</option>
        </select>
    `;

    const options = [{
        htmlContent: `<i class="fas fa-check"></i> å¼€å§‹å¸ƒå±€`,
        callback: () => confirmInvestigation(concubineId)
    }];

    showDecisionCard('å¸ƒå±€è°ƒæŸ¥', 'fa-users-cog', content, options);
}


/**
 * ç¡®è®¤è°ƒæŸ¥ (ä¿æŒæœ€æ–°)
 */
function confirmInvestigation(concubineId) {
    const spySelect = document.getElementById('investigation_spy');
    const directionSelect = document.getElementById('investigation_direction');

    const spyType = spySelect.value;
    const direction = directionSelect.value;
    const cost = parseInt(spySelect.options[spySelect.selectedIndex].getAttribute('data-cost'));
    
    if (gameState.player.privateAssets < cost) {
        showToast("ä½ çš„ç§äº§ä¸è¶³ä»¥æ”¯ä»˜çœ¼çº¿çš„è´¹ç”¨ï¼");
        return;
    }

    applyEffects({ privateAssets: -cost });

    gameState.flags.investigatingConcubine = {
        targetId: concubineId,
        spyType: spyType,
        direction: direction,
        turnsLeft: 2, 
        progress: 0,
        alertness: 0 
    };

    showEventCard('å¼€å§‹è°ƒæŸ¥', 'fa-search-minus', `ä½ èŠ±è´¹ <span class="value">${cost}</span> ä¸¤ç§äº§ï¼Œæ´¾å‡ºäº†çœ¼çº¿æš—ä¸­è°ƒæŸ¥ã€‚é¢„è®¡2å›åˆåä¼šæœ‰ç»“æœã€‚`);
    renderGame();
}


/**
 * æ¯å›åˆæ£€æŸ¥è°ƒæŸ¥è¿›åº¦ (ä¿æŒæœ€æ–°)
 */
function checkForInvestigationCompletion() {
    const investigation = gameState.flags.investigatingConcubine;
    if (!investigation) return;

    investigation.turnsLeft--;
    const target = gameState.npcs[investigation.targetId];
    if (!target) {
        delete gameState.flags.investigatingConcubine;
        return;
    }

    let eventText = null;
    const roll = Math.random();

    if (roll < 0.2) { 
        if (investigation.spyType === 'betrayer' && Math.random() < 0.3) {
            investigation.alertness += 50; 
            const husband = gameState.npcs[gameState.marriage.spouseId];
            husband.suspicionValue = (husband.suspicionValue || 0) + 15;
            eventText = `ä½ çš„çœ¼çº¿ç«Ÿæ˜¯ä¸ªåŒé¢é—´è°ï¼å¥¹å°†ä½ çš„è®¡åˆ’å‘ŠçŸ¥äº†<strong class="highlight-npc">${target.name}</strong>ï¼Œå¯¹æ–¹åœ¨ä½ å¤«å›é¢å‰å“­è¯‰ä½ å¦’å¿Œè´¤èƒ½ï¼Œå¤«å›å¯¹ä½ çš„ç–‘å¿ƒå¢åŠ äº†ï¼`;
            eventQueue.push(() => showEventCard('åé—´è®¡', 'fa-exclamation-triangle', eventText));
        } else {
            investigation.alertness += 20;
            eventText = `ä½ çš„çœ¼çº¿è¡Œäº‹ä¸å¯†ï¼Œä¼¼ä¹æƒŠåŠ¨äº†<strong class="highlight-npc">${target.name}</strong>ï¼Œå¥¹æœ€è¿‘è­¦æƒ•äº†è®¸å¤šã€‚`;
            eventQueue.push(() => showEventCard('æ‰“è‰æƒŠè›‡', 'fa-eye', eventText));
        }
    }

    if (investigation.turnsLeft <= 0) {
        let successRate = 0;
        switch (investigation.spyType) {
            case 'maid': successRate = 0.4; break;
            case 'mommy': successRate = 0.65; break;
            case 'betrayer': successRate = 0.85; break;
        }
        successRate -= investigation.alertness / 100;
        let resultTitle, resultIcon, resultContent;

        if (Math.random() < successRate) {
            const secrets = {
                morality: ["ä¸€å°ä¸æŠ¤é™¢çš„ç§ä¿¡", "è™å¾…ç²—ä½¿ä¸«é¬Ÿçš„è¯è¯", "ä¸€ä¸ªå†™æœ‰å«¡å­ç”Ÿè¾°å…«å­—çš„å·«è›Šå¨ƒå¨ƒ"],
                finance: ["ä¸€å¼ å¥¹ç§è—çš„å½“ç¥¨", "ä¸€ä»½å¥¹å…‹æ‰£ä¸‹äººæœˆé’±çš„è´¦æœ¬"],
                background: ["ä¸€å°è¯æ˜å¥¹ä¼ªé€ å‡ºèº«çš„ä¿¡ä»¶", "ä¸€ä»½å¥¹æ›¾ä¸äººæœ‰è¿‡å©šçº¦çš„æ—§å‡­è¯"]
            };
            const foundSecret = getRandomElement(secrets[investigation.direction]);
            
            resultTitle = 'é‡œåº•æŠ½è–ª';
            resultIcon = 'fa-file-signature';
            resultContent = `è°ƒæŸ¥æœ‰äº†ç»“æœï¼ä½ æˆåŠŸè·å¾—äº†å…³äº <strong class="highlight-npc">${target.name}</strong> çš„ä¸€ä»½è¯æ®ï¼š<strong class="value">ã€${foundSecret}ã€‘</strong>ã€‚`;
            
            if (!target.evidence) {
                target.evidence = { morality: [], finance: [], background: [] };
            }
            target.evidence[investigation.direction].push(foundSecret);
        } else {
            resultTitle = 'ä¸€æ— æ‰€è·';
            resultIcon = 'fa-times-circle';
            resultContent = `ä½ çš„çœ¼çº¿å›æŠ¥ï¼Œ<strong class="highlight-npc">${target.name}</strong> è¡Œäº‹æ»´æ°´ä¸æ¼ï¼Œæœªèƒ½æ‰¾åˆ°ä»»ä½•æŠŠæŸ„ã€‚`;
        }

        eventQueue.push(() => {
            showEventCard(resultTitle, resultIcon, resultContent);
        });
        delete gameState.flags.investigatingConcubine;
    }
}

// ================= ã€æœ€ç»ˆå†³å®šç‰ˆÂ·å®…æ–—ç³»ç»Ÿå®Œæ•´æ¨¡å—ã€‘ END =================// ========================= CHILDREN & HEIRS ============================
// =======================================================================
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
function setChildEducation(childId, eduName, eduCost) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;
    
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä¸ºå­©å­å¯¹è±¡å¢åŠ â€œæŠšå…»æˆæœ¬â€å±æ€§å¹¶ç´¯åŠ 
    if (!child.upbringingCost) {
        child.upbringingCost = 0;
    }
    child.upbringingCost += eduCost;
    // --- ä¿®æ”¹ç»“æŸ ---

    child.education = {
        name: eduName,
        cost: eduCost
    };
    
    showToast(`${child.name}çš„æ•™è‚²æ–¹é’ˆå·²è®¾å®šä¸ºã€${eduName}ã€‘ã€‚`);
    // åˆ·æ–°ç•Œé¢ä»¥æ˜¾ç¤ºæœ€æ–°é€‰æ‹©
    showChildRearing(childId);
}
function triggerBirth(partnerId, isSecret = false) {
    const partner = gameState.npcs[partnerId];
    if (!partner) return;

    // æ·»åŠ æ—¥å¿—ï¼Œè®©ç©å®¶çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
    logEvent(`<div class="intimate-scene"><i class="fas fa-moon"></i> å¤œè‰²æ·±æ²‰ï¼Œçº¢çƒ›æ‘‡æ›³...</div>`);

    const totalCapacity = gameState.finances.assets.filter(c => c.type === 'residence').reduce((sum, r) => sum + r.capacity, 5);
    const currentOccupants = 1 + (gameState.marriage.isMarried ? 1 : 0) + gameState.marriage.concubines.length + gameState.children.filter(c=>!c.isDead).length;
    if (currentOccupants >= totalCapacity) { showToast("å®¶ä¸­å·²æ— å¤„å¯ä½ï¼Œæ— æ³•å†æ·»ä¸äº†ã€‚è¯·å…ˆè´­ç½®æ›´å¤§çš„åºœé‚¸ã€‚"); return; }

    const motherNPC = gameState.player.gender === 'female' ? gameState.player : partner;
    const fatherNPC = gameState.player.gender === 'male' ? gameState.player : partner;

    const playerChildrenCount = gameState.children.filter(c => (c.motherId === 'player' || c.fatherId === 'player') && !c.isDead).length;

    if (playerChildrenCount >= 10) { showToast("ä½ å·²è‚²æœ‰åä¸ªå­©å­ï¼Œéš¾ä»¥å†æœ‰å­•ã€‚"); return; }
    if (gameState.player.gender === 'male' && partner.relationship === 'concubine' && gameState.children.filter(c => c.motherId === partnerId).length >= 3) { showToast(`å¦¾å®¤${partner.name}å·²è¯ä¸‹ä¸‰èƒï¼Œå†éš¾æœ‰å­•ã€‚`); return; }
    if (motherNPC.isPregnant) {
        showToast(`${motherNPC.name}å·²èº«æ€€å…­ç”²ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚`);
        return;
    }

    let baseConceptionChance = 0.35;
    if (motherNPC.age > 35) baseConceptionChance *= 0.5;
    if (motherNPC.age > 45) baseConceptionChance *= 0.3;
    if (motherNPC.age > 55) baseConceptionChance = 0.1;
    if (motherNPC.age >= 70) baseConceptionChance = 0; // 70å²ä¸èƒ½æ€€å­•

    if (playerChildrenCount >= 7) baseConceptionChance *= 0.7;

    if (Math.random() < baseConceptionChance) {
        // æ€€å­•æˆåŠŸï¼Œåªè®¾ç½®çŠ¶æ€ï¼Œä¸ç«‹å³ç”Ÿäº§ï¼
        motherNPC.isPregnant = true;
        motherNPC.pregnancyTurnsLeft = 2; 
        motherNPC.isSecretPregnancy = isSecret;
        logEvent(`<strong class="highlight-npc">${motherNPC.name}</strong>å·²èº«æ€€å…­ç”²ï¼Œä½ å¯¹æ–°ç”Ÿå‘½çš„åˆ°æ¥å……æ»¡æœŸå¾…ã€‚`);
    } else {
        logEvent(`ä¼¼ä¹å¤©æ„æœªè‡³ï¼Œ<strong class="highlight-npc">${motherNPC.name}</strong>æœ¬å›åˆæœªèƒ½æ€€ä¸Šã€‚`);
    }
    renderGame();
}
function triggerBirthSuccess(motherId, isSecret) {
    const motherNPC = motherId === 'player' ? gameState.player : gameState.npcs[motherId];
    const fatherNPC = gameState.player.gender === 'male' ? gameState.player : gameState.npcs[partnerId];

    const gender = Math.random() > 0.5 ? 'male' : 'female';
    const newChild = {
        id: `child_${Date.now()}`, gender: gender, age: 0, isDead:false,
        motherId: motherId, fatherId: fatherNPC.id,
        isSecret: isSecret,
        attributes: {}, personality: [], cultivationLog: [],
        marriage: { isMarried: false, spouseId: null },
        education: null, allowance: 0, career: null,
        avatar: getRandomElement(avatarPools[gender])
    };
    // ... å­©å­å±æ€§ç”Ÿæˆä»£ç  ...
    gameState.children.push(newChild);
    showNameChildOverlay(newChild.id, motherNPC.name, newChild.isSecret);
}

// æ–°å¢å‡½æ•°ï¼šå¤„ç†éš¾äº§æŠ‰æ‹©
// [æ›¿æ¢] æ‰¾åˆ°è¿™ä¸ªå‡½æ•°å¹¶ç”¨ä¸‹é¢çš„ä»£ç å®Œæ•´æ›¿æ¢
function pregnancyCheck(motherId, isSecret) {
    const mother = motherId === 'player' ? gameState.player : gameState.npcs[motherId];
    if (mother && mother.isPregnant) {
        mother.pregnancyTurnsLeft--;
        if (mother.pregnancyTurnsLeft <= 0) {
            // å°†åˆ†å¨©äº‹ä»¶æ¨å…¥äº‹ä»¶é˜Ÿåˆ—çš„æœ€å‰ç«¯ï¼Œç¡®ä¿å®ƒæœ€å…ˆæ‰§è¡Œ
            eventQueue.unshift(() => {
                handleBirthEvent(motherId, mother.isSecretPregnancy);
            });
            
            // æ¸…ç†æ€€å­•çŠ¶æ€
            delete mother.isPregnant;
            delete mother.pregnancyTurnsLeft;
            delete mother.miscarriageChance;
            delete mother.isSecretPregnancy;
            
            // è¿”å›trueï¼Œå‘Šè¯‰ä¸»å¾ªç¯æœ¬å›åˆæœ‰é‡å¤§äº‹ä»¶å‘ç”Ÿ
            return true; 
        }
    }
    // æ²¡æœ‰åˆ†å¨©äº‹ä»¶å‘ç”Ÿ
    return false;
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢] childrenGrowUp å‡½æ•°
// ===================== ã€æ–°åŠŸèƒ½ã€‘å­å¥³èŒä¸šè§„åˆ’å‡½æ•° =====================
function triggerChildCareerChoice(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    const careerList = childCareerAssignment[child.gender];
    let optionsHTML = [];

    for (const pathId in careerList) {
        if (pathId === "å¾…ä¸š") continue;
        const careerData = careerList[pathId];
        const reqText = Object.entries(careerData.req).map(([attr, val]) => `${ATTR_MAP[attr]}â‰¥${val}`).join(', ');

        // [ä¿®å¤] ä¿®æ­£äº†è·å–èŒä¸šå›¾æ ‡çš„é”™è¯¯è·¯å¾„
        const careerIcon = PROFESSION_DATA[pathId] ? PROFESSION_DATA[pathId].icon : 'fa-question-circle';

        optionsHTML.push({
            htmlContent: `
                <i class="fas ${careerIcon}"></i>
                <span class="option-text">
                    <strong>${pathId}</strong>
                    <div><small>è¦æ±‚: ${reqText}</small></div>
                </span>`,
            callback: () => {
                child.careerPathChosen = pathId;
                showEventCard('ç«‹ä¸‹å¿—å‘', 'fa-flag', `ä½ ä¸º${child.name}å®šä¸‹äº†æˆä¸ºä¸€åã€${pathId}ã€‘çš„ç›®æ ‡ï¼ŒTAå°†åœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œä¸ºæ­¤åŠªåŠ›ã€‚`);
                renderGame();
            }
        });
    }

    showDecisionCard(
        'å‰è·¯æŠ‰æ‹©', 
        'fa-graduation-cap', 
        `ä½ çš„å­©å­ <strong class="value">${child.name}</strong> å·²ç»15å²ï¼Œåˆ°äº†è§„åˆ’æœªæ¥çš„å¹´çºªã€‚ä½ å¸Œæœ›TAå‘å“ªä¸ªæ–¹å‘å‘å±•ï¼Ÿ<br><small>ï¼ˆè¿™ä¼šå½±å“TAæœªæ¥ä¸‰å¹´çš„å±æ€§æˆé•¿ä¾§é‡ï¼‰</small>`,
        optionsHTML
    );
}
// ===================== ã€ç¬¬äºŒæ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * [V4.1] å­å¥³æˆé•¿å‡½æ•° - ä¿®æ­£äº†å¯¹ generateChild çš„è°ƒç”¨æ–¹å¼
 */
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function childrenGrowUp() {
    gameState.children.forEach(child => {
        if(child.isDead) return;
        child.age += 0.5;
        
        let growthRates = { wisdom: 1, talent: 1, charm: 1, health: 1, etiquette: 1, virtue: 1, martial: 1, reputation: 0.1 };
        if (child.education) {
            const currentTier = financialTiers.find(t => t.level === gameState.finances.financialTier) || financialTiers[0];
            if (currentTier) {
                const eduOption = currentTier.expenses.child_edu.find(e => e.name === child.education.name);
                if (eduOption && eduOption.effect) {
                    for (const attr in eduOption.effect) {
                        growthRates[attr] = (growthRates[attr] || 1) + (eduOption.effect[attr] || 0);
                    }
                }
            }
        }
        if (child.careerPathChosen && child.careerPathChosen !== 'pending') {
            const careerReq = childCareerAssignment[child.gender][child.careerPathChosen].req;
            for (const attr in careerReq) {
                growthRates[attr] = (growthRates[attr] || 1) * 2;
            }
        }
        for (const attr in growthRates) {
            const growth = Math.random() * growthRates[attr];
            child.attributes[attr] = (child.attributes[attr] || 0) + growth;
            child.attributes[attr] = Math.max(0, child.attributes[attr]);
        }
        child.attributes.health = Math.min(100, (child.attributes.health || 100) + 1);
        if (child.age < 5 && child.attributes.health < 80 && Math.random() < 0.02) {
            child.isDead = true;
            logEvent(`å¤©æœ‰ä¸æµ‹ï¼Œä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> ä¸å¹¸å¤­æŠ˜ã€‚`, true);
            eventQueue.push(() => {
                showEventCard('å¤©æœ‰ä¸æµ‹', 'ğŸ•¯ï¸', `å¤©æœ‰ä¸æµ‹é£äº‘ï¼Œä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> ä¸å¹¸å¤­æŠ˜äº†...ä½ æ‚²ç—›ä¸‡åˆ†ã€‚`);
            });
            applyEffects({attributes: {virtue: -10}});
            return;
        }

        const ageMilestone = Math.floor(child.age);
        if (!child.triggeredEvents) child.triggeredEvents = [];
        if (CHILD_LIFE_EVENTS[ageMilestone] && !child.triggeredEvents.includes(ageMilestone)) {
            child.triggeredEvents.push(ageMilestone);
            const eventPool = CHILD_LIFE_EVENTS[ageMilestone];
            const event = getRandomElement(eventPool);
            
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†äº‹ä»¶å­˜å…¥ children ä»“åº“
            addUiEvent('children', () => {
                const eventDesc = event.desc.replace(/{childName}/g, `<strong class="value">${child.name}</strong>`);
                const options = event.options.map((opt, index) => ({
                    htmlContent: `<span class="option-text">${opt.text}</span>`,
                    callback: () => handleChildLifeEventResult(child.id, event.id, index)
                }));
                showDecisionCard(event.title, 'fa-child', eventDesc, options);
            });
        }

        if (child.age >= 15 && !child.careerPathChosen) {
            child.careerPathChosen = 'pending';
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘èŒä¸šè§„åˆ’äº‹ä»¶ä¹Ÿå­˜å…¥ children ä»“åº“
            addUiEvent('children', () => triggerChildCareerChoice(child.id));
        }

        if (child.age >= 18 && child.careerPathChosen && child.careerPathChosen !== 'pending' && !child.career) {
            assignChildCareer(child);
        }

        if (child.age >= 18 && child.career && child.career.path && child.career.path !== 'unemployed') {
            const careerData = careerPaths[child.gender][child.career.path];
            if (careerData && child.career.level < careerData.levels.length - 1) {
                const nextLevel = careerData.levels[child.career.level + 1];
                const coreAttr = Object.keys(nextLevel.req)[0] || 'wisdom';
                const performanceGain = getRandomInt(5, 15) + Math.floor((child.attributes[coreAttr] || 0) / 10);
                child.career.performance = (child.career.performance || 0) + performanceGain;
                if (child.career.performance >= nextLevel.promotion_points) {
                    const meetsAttrReqs = Object.entries(nextLevel.req).every(([attr, val]) => (child.attributes[attr] || 0) >= val);
                    if (meetsAttrReqs) {
                        child.career.level++;
                        child.career.performance = 0;
                        child.career.salary = careerData.levels[child.career.level].salary;
                        logEvent(`ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> å‹¤å‹‰èƒ½å¹²ï¼Œæ™‹å‡ä¸º <strong class="value">${careerData.levels[child.career.level].title}</strong>ï¼`);
                    } else {
                        child.career.performance = nextLevel.promotion_points - 10;
                    }
                }
            }
            if (gameState.date.turn === 1 && child.career.salary > 0) {
                 const baseSupport = Math.floor(child.career.salary * 2 * 0.1);
                 const favorBonus = Math.floor(baseSupport * ((child.favor || 50) / 1000));
                 const costReturn = Math.floor((child.upbringingCost || 0) / 20);
                 const totalSupport = baseSupport + favorBonus + costReturn;
                 if (totalSupport > 0) {
                    applyEffects({ wealth: totalSupport });
                    logEvent(`ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> é€æ¥äº† <span class="value">${totalSupport}</span> ä¸¤èµ¡å…»è´¹ï¼Œä»¥æŠ¥ç­”ä½ çš„å…»è‚²ä¹‹æ©ã€‚`);
                 }
            }
        }

        if (child.age >= 16 && !child.marriage.isMarried && (!child.marriage.lastProposalTurn || (gameState.date.year * 2 + gameState.date.turn) > child.marriage.lastProposalTurn + 4) && Math.random() < 0.2) {
            child.marriage.lastProposalTurn = (gameState.date.year * 2 + gameState.date.turn);
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘è®®äº²äº‹ä»¶å­˜å…¥ children ä»“åº“
            addUiEvent('children', () => triggerChildInitiatedMarriage(child.id));
        }

        if (child.marriage.isMarried) {
            if (typeof child.marriage.turnsSinceMarried === 'undefined') child.marriage.turnsSinceMarried = 0;
            if (typeof child.marriage.grandchildrenBorn === 'undefined') child.marriage.grandchildrenBorn = 0;
            
            child.marriage.turnsSinceMarried++;
            let shouldGiveBirth = false;
            if (child.marriage.turnsSinceMarried <= 6 && child.marriage.grandchildrenBorn === 0) {
                if (child.marriage.turnsSinceMarried === getRandomInt(3, 6)) shouldGiveBirth = true;
            }
            else if (child.marriage.turnsSinceMarried <= 10 && child.marriage.grandchildrenBorn === 1) {
                if (child.marriage.turnsSinceMarried === getRandomInt(7, 10)) shouldGiveBirth = true;
            }
            else if (child.marriage.grandchildrenBorn >= 2) {
                if (child.marriage.grandchildTimer && child.marriage.grandchildTimer > 0) {
                    child.marriage.grandchildTimer--;
                    if (child.marriage.grandchildTimer <= 0 && Math.random() < 0.5) {
                        shouldGiveBirth = true;
                        child.marriage.grandchildTimer = 4;
                    }
                }
                else if (Math.random() < 0.15) {
                    shouldGiveBirth = true;
                }
            }
            if (shouldGiveBirth) {
                const parent1 = child;
                const parent2 = gameState.npcs[child.marriage.spouseId];
                if (!parent2) return;
                const grandchildGender = Math.random() < 0.5 ? 'male' : 'female';
                const grandchildObj = generateChild({
                    mother: parent1.gender === 'female' ? parent1 : parent2,
                    father: parent1.gender === 'male' ? parent1 : parent2,
                    gender: grandchildGender
                });
                
                const fatherOfGrandchild = parent1.gender === 'male' ? parent1 : parent2;
                const surname = fatherOfGrandchild.name.slice(0, 1);
                const givenNamePool = grandchildGender === 'male' ? nameData.boyNames : nameData.girlNames;
                let finalName = surname + getRandomElement(givenNamePool);
                while(gameState.flags.allNames.has(finalName)) {
                    finalName = surname + getRandomElement(givenNamePool);
                }
                grandchildObj.name = finalName;
                gameState.flags.allNames.add(finalName);
                
                gameState.children.push(grandchildObj);
                gameState.npcs[grandchildObj.id] = grandchildObj;
                // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å­™è¾ˆè¯ç”Ÿäº‹ä»¶å­˜å…¥ children ä»“åº“
                addUiEvent('children', () => {
                    showEventCard('å¼€ææ•£å¶', 'fa-baby', `å–œæŠ¥ï¼ä½ çš„å­©å­ ${child.name} ä¸ºä½ æ·»äº†ä¸€ä¸ªå­™è¾ˆï¼Œå®¶æ—é¦™ç«å¾—ä»¥å»¶ç»­ï¼`);
                });
                applyEffects({reputation:10});
                logEvent(`ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> è¯ä¸‹ä¸€åå­™è¾ˆï¼Œå–åä¸º <strong class="highlight-npc">${finalName}</strong>ã€‚`, true);
                
                child.marriage.grandchildrenBorn++;
                if (child.marriage.grandchildrenBorn === 2) {
                    child.marriage.grandchildTimer = 4;
                }
            }
        }
    });

    const playerAge = Math.floor(gameState.player.age);
    const sweetheartId = gameState.flags.childhoodSweetheartId;
    if (playerAge === 12 && sweetheartId && !gameState.social.relationships[sweetheartId]) {
        const sweetheart = gameState.npcs[sweetheartId];
        if (sweetheart) {
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘é’æ¢…ç«¹é©¬åˆè¯†äº‹ä»¶å­˜å…¥ social ä»“åº“
            addUiEvent('social', () => {
                showDecisionCard('æ€»è§’ä¹‹äº¤', 'fa-child',
                    `ä½ å·²åäºŒå²ï¼Œä¸é‚»å®¶çš„ <strong class="highlight-npc">${sweetheart.name}</strong> ä¸€åŒç©è€é•¿å¤§...`,
                    [{
                        htmlContent: 'â€œä»¥åæˆ‘ä»¬å°±æ˜¯ä¸€è¾ˆå­çš„æœ‹å‹å•¦ï¼â€',
                        callback: () => {
                            const relType = sweetheart.gender === 'male' ? 'blue_confidante' : 'red_confidante';
                            gameState.social.relationships[sweetheart.id] = {
                                type: relType, favor: 60, trust: 70, emotionValue: 100, level: 2,
                            };
                            showEventCard('é’æ¢…ä¹‹çº¦', 'fa-hand-holding-heart', `ä½ ä¸ <strong class="highlight-npc">${sweetheart.name}</strong> æ­£å¼æˆä¸ºäº†çŸ¥å·±å¥½å‹...`);
                        }
                    }]
                );
            });
        }
    }
}
function handleChildLifeEventResult(childId, eventId, optionIndex) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    const age = Math.floor(child.age);
    const event = CHILD_LIFE_EVENTS[age].find(e => e.id === eventId);
    if (!event) return;

    const choice = event.options[optionIndex];
    if (!choice) return;

    // åº”ç”¨æ•ˆæœ
    if (choice.effects) {
        Object.entries(choice.effects).forEach(([key, value]) => {
            if (key === 'favor') {
                child.favor = (child.favor || 50) + value;
            } else {
                child.attributes[key] = (child.attributes[key] || 0) + value;
            }
        });
    }

    const logText = choice.log.replace(/{childName}/g, `<strong class="value">${child.name}</strong>`);
    showEventCard(event.title, 'fa-child', logText);
    renderGame();
}
// [æ›¿æ¢]
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * [V2.0 å­å—£èŒä¸šåˆ†é…å‡½æ•°] å®ç°äº†æ ¹æ®å±æ€§è‡ªåŠ¨æ‹©ä¼˜åˆ†é…èŒä¸š
 * @param {object} child - å­å—£å¯¹è±¡
 */
function assignChildCareer(child) {
    const careerList = childCareerAssignment[child.gender];
    let possibleCareers = [];
    // 1. éå†æ‰€æœ‰å¯é€‰èŒä¸šï¼Œæ£€æŸ¥å­©å­æ˜¯å¦æ»¡è¶³å…¶å…¥é—¨è¦æ±‚
    for (const pathId in careerList) {
        if (pathId === "å¾…ä¸š") continue;
        const careerData = careerList[pathId];
        const meetsReqs = Object.entries(careerData.req).every(([attr, val]) => (child.attributes[attr] || 0) >= val);
        if (meetsReqs) {
            // å¦‚æœæ»¡è¶³è¦æ±‚ï¼Œè®¡ç®—ä¸€ä¸ªâ€œåŒ¹é…åˆ†â€
            let score = 0;
            Object.entries(careerData.req).forEach(([attr, val]) => {
                score += (child.attributes[attr] || 0); // å±æ€§è¶Šé«˜ï¼Œåˆ†æ•°è¶Šé«˜
            });
            possibleCareers.push({ pathId, score });
        }
    }
    let finalCareerPath, finalCareerName, finalCareerLevelData;
    if (possibleCareers.length > 0) {
        // 2. å¦‚æœæœ‰æ»¡è¶³æ¡ä»¶çš„èŒä¸šï¼Œé€‰æ‹©åˆ†æ•°æœ€é«˜çš„é‚£ä¸ª
        possibleCareers.sort((a, b) => b.score - a.score);
        const bestCareer = possibleCareers[0];
        finalCareerPath = careerList[bestCareer.pathId].path;
        finalCareerName = bestCareer.pathId;
        finalCareerLevelData = careerPaths[child.gender][finalCareerPath].levels[0]; // ä»0çº§å¼€å§‹
    } else {
        // 3. å¦‚æœæ²¡æœ‰ä»»ä½•èŒä¸šæ»¡è¶³è¦æ±‚ï¼Œåˆ™å¾…ä¸š
        child.career = { path: 'unemployed', name: 'å¾…ä¸š', level: 0, performance: 0, salary: 50, core_resources: {} };
        showEventCard('å­å—£æˆå¹´', 'fa-user-graduate', `ä½ çš„å­©å­<strong class="value">${child.name}</strong>å› èƒ½åŠ›ä¸è¶³ï¼Œæœªèƒ½æ‰¾åˆ°åˆé€‚çš„è¥ç”Ÿï¼Œæš‚æ—¶å¾…ä¸šå®¶ä¸­ã€‚`);
        logEvent(`ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> å·²æˆå¹´ï¼Œæš‚æœªç«‹ä¸šã€‚`, true);
        return;
    }
    // 4. åˆ†é…æœ€ç»ˆèŒä¸š
    child.career = {
        path: finalCareerPath,
        name: finalCareerName,
        level: 0,
        performance: 0,
        salary: finalCareerLevelData.salary,
        core_resources: {} // This is the fix
    };
    logEvent(`ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> å·²æˆå¹´ï¼Œå‡­å€Ÿå‡ºè‰²çš„èƒ½åŠ›å…¥èŒã€${finalCareerName}ã€‘ï¼Œè¢«æˆäºˆäº† <strong class="value">${finalCareerLevelData.title}</strong> çš„èŒä½ã€‚`, true);
    showEventCard('å­å—£æˆå¹´', 'fa-user-graduate', `å¤©èµ„å“è¶Šï¼ä½ çš„å­©å­<strong class="value">${child.name}</strong>æˆåŠŸå…¥èŒã€${finalCareerName}ã€‘ï¼Œè¢«æˆäºˆäº†<strong class="value">${finalCareerLevelData.title}</strong>çš„èŒä½ï¼`);
}
function showChildRearing(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    let cultivationHTML = '';
    const age = Math.floor(child.age);
    const isMale = child.gender === 'male';
    const currentTier = financialTiers.find(t => t.level === gameState.finances.financialTier) || financialTiers[0];
    const eduOptions = currentTier.expenses.child_edu;

    cultivationHTML += `
        <div class="section-header">æ•™è‚²æ–¹é’ˆ</div>
        <p class="comment">å½“å‰æ•™è‚²: ${child.education ? child.education.name : 'åŸºç¡€æ•™å…»'}</p>
        <div class="options" style="flex-wrap: wrap; flex-direction: row; justify-content: center;">
    `;
    
    if (age >= 6 && age < 18) {
        eduOptions.forEach(opt => {
            const canAfford = gameState.finances.wealth >= opt.cost;
            const isCurrent = child.education && child.education.name === opt.name;
            const buttonStyle = isCurrent ? `background: ${isMale ? 'linear-gradient(135deg, #6a9ac9, #4169e1)' : 'linear-gradient(135deg, #ff9ebf, #ff69b4)'};` : '';
            
            cultivationHTML += `
                <button class="control-btn" style="min-width: 150px; ${buttonStyle}"
                    ${!canAfford && !isCurrent ? 'disabled' : ''} 
                    onclick="setChildEducation('${child.id}', '${opt.name}', ${opt.cost})">
                    <i class="fas fa-book"></i>
                    <span class="option-text">${opt.name}
                        <div><small>${opt.cost > 0 ? `(${opt.cost}ä¸¤/å¹´)` : ''}</small></div>
                    </span>
                </button>
            `;
        });
    } else if (age < 6) {
        cultivationHTML += `<p class="comment" style="width:100%; text-align:center;">${child.name}å°šåœ¨å¯è’™æœŸï¼Œè¯·é€šè¿‡æ—¥å¸¸äº’åŠ¨åŸ¹å…»ã€‚</p>`;
    } else {
        cultivationHTML += `<p class="comment" style="width:100%; text-align:center;">${child.name}å·²ç»æˆå¹´ï¼Œå¯ä»¥ç‹¬ç«‹ç”Ÿæ´»äº†ã€‚</p>`;
    }

    cultivationHTML += '</div>';

    const attributesHTML = `
        <div class="section-header">å½“å‰å±æ€§</div>
        <div class="attributes-grid" style="grid-template-columns: 1fr 1fr;">
            ${Object.entries(child.attributes).filter(([k,v])=> ATTR_MAP[k]).map(([key, value]) => {
                const iconMap = {talent:'fa-pencil-alt', etiquette:'fa-hands-helping', wisdom:'fa-lightbulb', virtue:'fa-leaf', charm:'fa-grin-stars', martial:'fa-khanda', health:'fa-heart'};
                const classMap = {talent:'talent-fill', etiquette:'etiquette-fill', wisdom:'wisdom-fill', virtue:'virtue-fill', charm:'charm-fill', martial:'martial-fill', health:'health-fill'};
                return renderAttributeBar(ATTR_MAP[key], value, classMap[key], iconMap[key]);
            }).join('')}
        </div>`;
    
    // ã€æ–°å¢ã€‘æ£€æŸ¥äº’åŠ¨æ˜¯å¦å·²è¢«ä½¿ç”¨
    const interactionsUsed = gameState.flags.childInteractionsUsed || {};
    const allowanceUsed = interactionsUsed[child.id + '_allowance'];
    const careUsed = interactionsUsed[child.id + '_care'];
    const playUsed = interactionsUsed[child.id + '_play'];

    document.getElementById('childRearingContent').innerHTML = `
        <h4>ä¸ <strong class="value">${child.name}</strong> çš„äº’åŠ¨</h4>
        <div style="max-height: 60vh; overflow-y: auto; padding: 5px;">
            ${cultivationHTML}
            <div class="section-header">æ—¥å¸¸äº’åŠ¨</div>
            <div class="options">
                <button class="option" ${allowanceUsed ? 'disabled' : ''} onclick="interactWithChild('${childId}', 'allowance')"><i class="fas fa-coins"></i> ç»™é›¶èŠ±é’±</button>
                <button class="option" ${careUsed ? 'disabled' : ''} onclick="interactWithChild('${childId}', 'care')"><i class="fas fa-hand-holding-heart"></i> å…³å¿ƒå­¦ä¸š/ç”Ÿæ´»</button>
                <button class="option" ${playUsed ? 'disabled' : ''} onclick="interactWithChild('${childId}', 'play')"><i class="fas fa-puzzle-piece"></i> é™ªä¼´æ¸¸ç©</button>
            </div>
            ${attributesHTML}
        </div>`;
    showOverlay('childRearingOverlay');
}
function setChildCultivationFocus(childId, focusId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;
    
    const isMale = child.gender === 'male';
    const focusOptions = isMale ? CHILD_CULTIVATION_STAGES.childhood.male : CHILD_CULTIVATION_STAGES.childhood.female;
    const focus = focusOptions.find(o => o.id === focusId);

    if (focus) {
        child.cultivationFocus = focus.focus;
        child.cultivationFocusName = focus.name;
        showToast(`${child.name}çš„åŸ¹å…»æ–¹é’ˆå·²è®¾å®šä¸ºã€${focus.name}ã€‘ã€‚`);
    } else {
        // é»˜è®¤é€‰é¡¹
        child.cultivationFocus = null;
        child.cultivationFocusName = 'åŸºç¡€æ•™å…»';
        showToast(`å·²å–æ¶ˆ${child.name}çš„åŸ¹å…»æ–¹é’ˆï¼Œæ¢å¤ä¸ºåŸºç¡€æ•™å…»ã€‚`);
    }

    showChildRearing(childId);
}
function cultivateChild(childId, actionId, cost = 0) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;
    if(cost > 0 && gameState.finances.wealth < cost) { showToast("ä½ çš„ç§äº§ä¸è¶³ã€‚"); return;}

    let logText = '';
    let appliedEffects = false;
    
    // æŸ¥æ‰¾æ‰€æœ‰é˜¶æ®µçš„åŸ¹å…»é€‰é¡¹
    const allOptions = [
        ...CHILD_CULTIVATION_STAGES.infancy.male,
        ...CHILD_CULTIVATION_STAGES.infancy.female,
        ...CHILD_CULTIVATION_STAGES.childhood.male,
        ...CHILD_CULTIVATION_STAGES.childhood.female,
        ...CHILD_CULTIVATION_STAGES.teenager.common,
    ];
    const action = allOptions.find(opt => opt.id === actionId);

    if (action) {
        if(cost > 0) applyEffects({ wealth: -cost });
        
        if (action.effects) {
            for(const [key, value] of Object.entries(action.effects)) {
                child.attributes[key] = (child.attributes[key] || 0) + value;
            }
             logText = `ä½ å¯¹ ${child.name} è¿›è¡Œäº†ã€${action.name}ã€‘ï¼ŒTAçš„å±æ€§è·å¾—äº†æå‡ã€‚`;
        }
        if (action.focus) {
            child.cultivationFocus = action.focus;
            child.cultivationFocusName = action.name;
            logText = `ä½ ä¸º ${child.name} è®¾å®šäº†æ–°çš„æ•™è‚²æ–¹é’ˆï¼šã€${action.name}ã€‘ã€‚`;
        }
        showEventCard('æ‚‰å¿ƒæ•™å…»', 'fa-graduation-cap', logText);
        appliedEffects = true;
    }

    if(appliedEffects) {
        showChildRearing(childId); // åˆ·æ–°ç•Œé¢
    }
}
function interactWithChild(childId, type) {
    const child = gameState.children.find(c => !c.isDead && c.id === childId);
    if(!child) return;

    // ã€æ–°å¢ã€‘æ£€æŸ¥å¹¶è®¾ç½®äº’åŠ¨æ ‡è®°
    if (!gameState.flags.childInteractionsUsed) gameState.flags.childInteractionsUsed = {};
    const interactionKey = child.id + '_' + type;
    if (gameState.flags.childInteractionsUsed[interactionKey]) {
        showToast("æœ¬å›åˆå·²è¿›è¡Œè¿‡æ­¤é¡¹äº’åŠ¨ã€‚");
        return;
    }
    gameState.flags.childInteractionsUsed[interactionKey] = true;

    let log = '';
    child.favor = (child.favor || 50);

    if(type==='allowance') {
        const amountStr = prompt(`ç»™${child.name}å¤šå°‘é›¶èŠ±é’±ï¼Ÿ`, '10');
        const amount = parseInt(amountStr);
        if(isNaN(amount) || amount <= 0) {
             // å¦‚æœè¾“å…¥æ— æ•ˆï¼ŒæŠŠäº’åŠ¨æ¬¡æ•°è¿˜å›å»
             delete gameState.flags.childInteractionsUsed[interactionKey];
             return;
        }
        if(gameState.finances.wealth < amount) {
            showToast('ç§äº§ä¸è¶³');
            delete gameState.flags.childInteractionsUsed[interactionKey];
            return;
        }
        applyEffects({wealth: -amount});
        child.favor += Math.floor(amount/10);
        if (amount > 100) child.attributes.virtue = Math.max(0, child.attributes.virtue -1);
        log = `ä½ ç»™äº†${child.name} ${amount} ä¸¤é›¶èŠ±é’±ã€‚`;
    } else if(type === 'care') {
        child.favor += 8;
        child.attributes.wisdom = (child.attributes.wisdom || 0) + getRandomInt(2, 4);
        child.attributes.virtue = (child.attributes.virtue || 0) + getRandomInt(2, 4);
        gameState.player.attributes.virtue += 1;
        log = `ä½ å…³å¿ƒäº†${child.name}çš„å­¦ä¸šä¸ç”Ÿæ´»ï¼ŒTAæœ‰æ‰€æ„Ÿæ‚Ÿã€‚`;
    } else if (type === 'play') {
        child.favor += 15;
        child.attributes.charm = (child.attributes.charm || 0) + getRandomInt(2, 4);
        gameState.player.attributes.health += 2;
        log = `ä½ æ”¾ä¸‹äº‹åŠ¡ï¼Œé™ª${child.name}ç—›å¿«åœ°ç©äº†ä¸€ä¸ªä¸‹åˆï¼Œäº²å­å…³ç³»æ›´åŠ èæ´½äº†ã€‚`;
    }
    child.favor = Math.min(100, child.favor);
    showEventCard('äº²å­æ—¶å…‰', 'fa-child', log);
    // åˆ·æ–°äº’åŠ¨çª—å£ä»¥æ˜¾ç¤ºæŒ‰é’®çš„ç¦ç”¨çŠ¶æ€
    showChildRearing(childId);
}
function openChildMarriageMenu(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    const options = [
        {htmlContent: `<i class="fas fa-heart"></i> è¯¢é—®TAçš„å¿ƒä¸Šäºº`, callback: () => triggerChildInitiatedMarriage(child.id, true)},
        {htmlContent: `<i class="fas fa-users"></i> ä¸ºTAå®‰æ’è®®äº²`, callback: () => showChildArrangedMarriage(child.id)},
        {htmlContent: `<i class="fas fa-times"></i> ç¨åå†è¯´`, style: `background:var(--control-bg);`, callback: () => closeAllOverlays()}
    ];
    showDecisionCard('å­å¥³å©šäº‹', '', `<p>ä½ æ­£åœ¨ä¸º${child.name}çš„å©šäº‹æ“å¿ƒï¼Œä½ æ‰“ç®—...</p>`, options);
}

// ===================== ã€ç¬¬ä¸€æ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * [V2.0] è§¦å‘å­å¥³è‡ªç”±æ‹çˆ±çš„å‡½æ•°
 * @param {string} childId - å­å—£ID
 * @param {boolean} fromMenu - æ˜¯å¦ä»èœå•ä¸»åŠ¨è§¦å‘
 */
function triggerChildInitiatedMarriage(childId, fromMenu = false) {
    const child = gameState.children.find(c => c.id === childId);
    if(!child) return;

    if (fromMenu && Math.random() < 0.3){
         showToast(`${child.name}å®³ç¾åœ°è¡¨ç¤ºï¼Œè‡ªå·±å°šæ— æ„ä¸­äººã€‚`);
         setTimeout(() => showChildArrangedMarriage(childId), 1500); // è‡ªåŠ¨è½¬åˆ°å®‰æ’è®®äº²
        return;
     }

    const partnerGender = child.gender === 'male' ? 'female' : 'male';
    const bg = getRandomElement(childSpousePools[partnerGender]);
    const partner = {
        name: generateRandomName(partnerGender, gameState.flags.allNames),
        desc: bg.desc,
        attributes: { ...bg.attributes, family: bg.family },
        isArranged: false,
        hiddenTrait: bg.hidden_trait,
        avatar: getRandomElement(avatarPools[partnerGender])
    };

    let content = `${child.name}å‰æ¥æ‰¾ä½ ï¼Œæ»¡é¢ç¾çº¢åœ°å‘Šè¯‰ä½ ï¼ŒTAæœ‰äº†å¿ƒä¸Šäººï¼Œåä¸º <strong class="value">${partner.name}</strong>ã€‚<br>`;
    content += renderSpouseCandidateCard(partner, child, true); // trueè¡¨ç¤ºè¿™æ˜¯å­©å­è‡ªå·±é€‰çš„
    content += `<p>ä½ æ˜¯å¦åŒæ„è¿™é—¨äº²äº‹ï¼Ÿ</p>`;

    // ã€æ ¸å¿ƒä¿®å¤ã€‘å°† partner å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä»¥ä¾¿ä¼ é€’ç»™å›è°ƒå‡½æ•°
    const partnerInfoString = JSON.stringify(partner);

    const options = [
        {
            htmlContent: `<i class="fas fa-check"></i> åŒæ„`,
            callback: () => handleChildMarriageDecision(true, child.id, partnerInfoString)
        },
        {
            htmlContent: `<i class="fas fa-times"></i> æ‹’ç»`,
            style: `background:linear-gradient(135deg, #e74c3c, #c0392b);`,
            // ã€ä¿®å¤ç‚¹ã€‘åœ¨è¿™é‡Œè¡¥ä¸Šäº†ç¼ºå¤±çš„ partnerInfoString å‚æ•°
            callback: () => handleChildMarriageDecision(false, child.id, partnerInfoString)
        }
    ];
    showDecisionCard(`å­å¥³æƒ…äº‹`, '', content, options);
}
// ã€æ–°å¢çš„å‡½æ•°ã€‘å¤„ç†ç©å®¶ä¸ºå­©å­åšçš„æ€§æ ¼å…»æˆé€‰æ‹©
function handleChildPersonalityChoice(childId, eventData, choiceData) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    // åº”ç”¨é€‰é¡¹æ•ˆæœ
    if (choiceData.effects && choiceData.effects.attributes) {
        for (const [attr, value] of Object.entries(choiceData.effects.attributes)) {
            child.attributes[attr] = (child.attributes[attr] || 0) + value;
        }
    }

    // æ·»åŠ æ€§æ ¼ç‰¹è´¨
    if (!child.personality) child.personality = [];
    if (!child.personality.includes(choiceData.trait)) {
        child.personality.push(choiceData.trait);
    }

    // æ ‡è®°æ­¤å¹´é¾„æ®µçš„äº‹ä»¶å·²è§¦å‘
    const ageMilestone = Math.floor(child.age);
    child.personalityEventTriggered = ageMilestone;

    // æ˜¾ç¤ºç»“æœå¼¹çª—
    let resultText = `åœ¨ä½ çš„å¼•å¯¼ä¸‹ï¼ˆâ€œ${choiceData.text}â€ï¼‰ï¼Œä½ çš„å­©å­ ${child.name} çš„æ€§æ ¼ä¸­å¢æ·»äº† <strong class="value">${choiceData.trait}</strong> çš„ç‰¹è´¨ã€‚`;
    showEventCard('æ‚‰å¿ƒæ•™å¯¼', 'fa-child', resultText);

    renderGame();
}
function handleChildMarriageDecision(agreed, childId, partnerInfoStr) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;
    const partnerInfo = JSON.parse(partnerInfoStr);

    if (agreed) {
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä¸å†è°ƒç”¨å¸¦æœ‰éšæœºæ€§çš„ proposeToChildsPartner å‡½æ•°
        // è€Œæ˜¯ç›´æ¥è¿›å…¥å‡†å¤‡è˜ç¤¼/å«å¦†çš„æµç¨‹
        const isDichu = !child.isSecret && child.motherId === gameState.marriage.spouseId;
        const minCost = isDichu ? 1000 : 200;

        let promptText = `å¯¹æ–¹å®¶æ—æ¬£ç„¶åº”å…ï¼è¯·ä¸º${child.name}å‡†å¤‡${child.gender === 'male' ? 'è˜ç¤¼' : 'å«å¦†'} (æœ€ä½${minCost}ä¸¤):`;
        const dowryInput = prompt(promptText, minCost * 5);
        if (dowryInput === null) return;
        const dowryAmount = parseInt(dowryInput);

        if (isNaN(dowryAmount) || dowryAmount < minCost) { 
            showToast(`é‡‘é¢æ— æ•ˆæˆ–ä½äºæœ€ä½è¦æ±‚ã€‚`); 
            return; 
        }
        if (gameState.finances.wealth < dowryAmount) { 
            showToast("ä½ çš„è´¢åŠ›ä¸è¶³ä»¥æ”¯æ’‘è¿™é—¨å©šäº‹ã€‚"); 
            return; 
        }

        // æ‰€æœ‰æ£€æŸ¥é€šè¿‡åï¼Œè°ƒç”¨æœ€ç»ˆçš„æˆå©šå‡½æ•°
        finalizeChildMarriage(childId, partnerInfo, dowryAmount);

    } else {
        // æ‹’ç»çš„é€»è¾‘ä¿æŒä¸å˜
        child.favor = Math.max(0, (child.favor || 50) - 30);
        if (child.favor < 20 && (child.personality.includes('å›é€†') || child.personality.includes('æœæ•¢')) && Math.random() < 0.3) {
            child.marriage.isMarried = true;
            child.marriage.spouseInfo = partnerInfo;
            child.isDead = true; 
            showEventCard('å­å¥³ç§å¥”', 'fa-running', `ä½ å¼ºç¡¬åœ°æ‹’ç»äº†${child.name}çš„è¯·æ±‚ã€‚æ•°æ—¥åï¼Œä½ å‘ç°TAä¸å¿ƒä¸Šäºº${partnerInfo.name}ä¸€åŒç§å¥”ï¼Œä»æ­¤æ³æ— éŸ³ä¿¡ï¼ä½ çš„å®¶æ—å£°æœ›å› æ­¤å¤§è·Œã€‚`);
            applyEffects({ reputation: -50 });
        } else {
            showEventCard('æ£’æ‰“é¸³é¸¯', 'fa-heart-broken', `ä½ æ‹’ç»äº†${child.name}çš„è¯·æ±‚ï¼ŒTAçœ‹èµ·æ¥ä¼¤å¿ƒæ¬²ç»ã€‚äº²å­å…³ç³»å¤§å¹…ä¸‹é™ã€‚`);
        }
    }
    closeAllOverlays();
}
function showChildArrangedMarriage(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    const partnerGender = child.gender === 'male' ? 'female' : 'male';
    let partnersHTML = `<h4>åª’å©†ä¸ºä½ å¯»æ¥äº†å‡ ä½ä¸é”™çš„å€™é€‰äºº:</h4>`;
    let potentialPartners = [];

    for(let i=0; i < 3; i++) {
        const bg = getRandomElement(childSpousePools[partnerGender]);
        potentialPartners.push({
            name: generateRandomName(partnerGender, gameState.flags.allNames),
            desc: bg.desc, attributes: { ...bg.attributes, family: bg.family }, 
            isArranged: true,
            hiddenTrait: bg.hidden_trait,
            avatar: getRandomElement(avatarPools[partnerGender])
        });
    }

    partnersHTML += potentialPartners.map(p => renderSpouseCandidateCard(p, child, false)).join('');

    document.getElementById('childMarriageContent').innerHTML = `
        <p>ä½ æ­£åœ¨ä¸º<strong class="value">${child.name}</strong>çš„å©šäº‹æ“å¿ƒã€‚</p>
        <div style="max-height: 60vh; overflow-y:auto; padding:5px;">${partnersHTML}</div>`;
    showOverlay('childMarriageOverlay');
}
function renderSpouseCandidateCard(partner, child, isFreeChoice) {
    const partnerScore = Object.values(partner.attributes).reduce((a, b) => a + b, 0);
    const childScore = Object.values(child.attributes).reduce((a, b) => a + b, 0);
    const compatibility = Math.min(100, Math.max(10, 50 + (childScore - partnerScore) / 5 + (child.favor || 50) / 2 - 25));

    // [ä¿®å¤] å°†å¤æ‚çš„ partner å¯¹è±¡æ•°æ®å­˜å‚¨åœ¨HTMLçš„ data-* å±æ€§ä¸­ï¼Œè€Œä¸æ˜¯æ··ä¹±åœ°æ”¾åœ¨ onclick é‡Œ
    const partnerInfoString = JSON.stringify(partner).replace(/'/g, "&apos;");

    return `<div class="suitor" style="cursor:pointer;" data-partner='${partnerInfoString}' onclick='proposeToChildsPartner(this, "${child.id}")'>
        <div class="suitor-avatar-wrapper" style="background-color: ${isFreeChoice ? '#ffdab9' : '#e0f7fa'}">
            <img src="${partner.avatar}" class="suitor-avatar">
        </div>
        <div class="suitor-details">
            <div class="suitor-name">${partner.name} <small>(åŒ¹é…åº¦: ${Math.floor(compatibility)}%)</small></div>
            <div class="suitor-desc">${partner.desc}</div>
            <div class="suitor-stats">
                <span class="stat"><i class="fas fa-home"></i> å®¶ä¸–: ${partner.attributes.family}</span>
                <span class="stat"><i class="fas fa-grin-stars"></i> é­…åŠ›: ${partner.attributes.charm}</span>
                <span class="stat"><i class="fas fa-pencil-alt"></i> æ‰æƒ…: ${partner.attributes.talent}</span>
            </div>
            <button class="control-btn" style="padding: 5px 10px; font-size: 0.8em; margin-top: 8px; width: 120px;" 
                onclick="event.stopPropagation(); investigateSpouseCandidate(this.parentElement.parentElement, '${child.id}')">
                <i class="fas fa-search"></i> æš—ä¸­è°ƒæŸ¥
            </button>
        </div>
    </div>`;
}
function investigateSpouseCandidate(cardElement, childId) {
    // [ä¿®å¤] å¢åŠ è°ƒæŸ¥æˆæœ¬
    const cost = 200;
    if(gameState.finances.wealth < cost) { 
        showToast("è°ƒæŸ¥éœ€è¦200ä¸¤ï¼Œå½“å‰ç§äº§ä¸è¶³"); 
        return;
    }

    const partnerData = JSON.parse(cardElement.dataset.partner);
    const button = cardElement.querySelector('.control-btn');

    button.disabled = true;
    button.classList.add('button-loading');

    setTimeout(() => {
        applyEffects({ wealth: -cost }); // [ä¿®å¤] æ‰£é™¤é‡‘é’±

        const event = getRandomElement(INVESTIGATION_EVENTS);
        const desc = event.desc.replace(/ã€å¯¹è±¡å§“åã€‘/g, `<strong class="highlight-npc">${partnerData.name}</strong>`);

        // [ä¿®å¤] å°†ç»“æœå±•ç¤ºåœ¨å†³ç­–å¼¹çª—ä¸­ï¼Œå¹¶æä¾›è®®äº²é€‰é¡¹
        const finalDesc = `${desc}<br><br><strong>è°ƒæŸ¥ç»“æœï¼š</strong>${event.effect_text || 'æƒ…å†µå¦‚ä¸Šï¼Œè¯·æ‚¨å®šå¤ºã€‚'}`;

        const options = [
            {
                htmlContent: `<i class="fas fa-check"></i> åŒæ„æ­¤é—¨äº²äº‹`,
                callback: () => {
                    // ç”±äºproposeToChildsPartneréœ€è¦ä¸€ä¸ªDOMå…ƒç´ ï¼Œæˆ‘ä»¬ç›´æ¥ä¼ é€’å…ƒç´ å’Œå­©å­ID
                    proposeToChildsPartner(cardElement, childId);
                }
            },
            {
                htmlContent: `<i class="fas fa-times"></i> æ‹’ç»æ­¤é—¨äº²äº‹`,
                callback: () => {
                    showToast(`ä½ å†³å®šä¸è€ƒè™‘ ${partnerData.name} äº†ã€‚`);
                    closeAllOverlays();
                }
            }
        ];
        
        // å¦‚æœäº‹ä»¶æœ¬èº«æœ‰é€‰é¡¹ï¼ˆæ¯”å¦‚å‘ç°å·²æœ‰å¿ƒä¸Šäººï¼‰ï¼Œåˆ™ä¼˜å…ˆå¤„ç†äº‹ä»¶é€‰é¡¹
        if (event.options) {
             const eventOptions = event.options.map(opt => ({
                htmlContent: opt.text,
                callback: () => {
                    showEventCard(event.title, 'fa-user-secret', `${desc}<br><br><strong>ä½ çš„å†³å®šï¼š</strong>${opt.log}`);
                }
            }));
            showDecisionCard(event.title, 'fa-user-secret', desc, eventOptions);
        } else {
            // å¦åˆ™æ˜¾ç¤ºè®®äº²å†³ç­–
            showDecisionCard(event.title, 'fa-user-secret', finalDesc, options);
        }

        button.classList.remove('button-loading');
        button.innerHTML = '<i class="fas fa-check"></i> å·²è°ƒæŸ¥';

    }, 1000); 
}
// [æ›¿æ¢] æ‰¾åˆ°è¿™ä¸ªå‡½æ•°å¹¶ç”¨ä¸‹é¢çš„ä»£ç å®Œæ•´æ›¿æ¢
function proposeToChildsPartner(cardElement, childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    // [ä¿®å¤] ä»å…ƒç´ çš„ data-partner å±æ€§ä¸­å®‰å…¨åœ°è¯»å–æ•°æ®
    const partnerInfo = JSON.parse(cardElement.dataset.partner);

    let successChance = 0.7;
    successChance += (gameState.family.reputation / 1000);
    const partnerScore = Object.values(partnerInfo.attributes).reduce((a, b) => a + b, 0);
    const childScore = Object.values(child.attributes).reduce((a, b) => a + b, 0);
    successChance += (childScore - partnerScore) / 500;

    if (partnerInfo.revealedTrait && partnerInfo.revealedTrait.type === 'negative') {
        successChance += 0.2;
    }

    if (Math.random() > successChance) {
        showEventCard('è®®äº²å¤±è´¥', 'fa-times-circle', `å¯¹æ–¹å®¶æ—ç»è¿‡è€ƒé‡ï¼Œå©‰æ‹’äº†è¿™é—¨äº²äº‹ã€‚æˆ–è®¸æ˜¯è§‰å¾—ä½ ä»¬é—¨ä¸å½“æˆ·ä¸å¯¹ã€‚`);
        return;
    }

    const isDichu = !child.isSecret && child.motherId === gameState.marriage.spouseId;
    const minCost = isDichu ? 1000 : 200;

    let promptText = `å¯¹æ–¹åŒæ„äº†è¿™é—¨äº²äº‹ï¼è¯·ä¸º${child.name}å‡†å¤‡${child.gender === 'male' ? 'è˜ç¤¼' : 'å«å¦†'} (æœ€ä½${minCost}ä¸¤):`;
    const dowryInput = prompt(promptText, minCost * 5);
    if (dowryInput === null) return;
    const dowryAmount = parseInt(dowryInput);

    if (isNaN(dowryAmount) || dowryAmount < minCost) { showToast(`é‡‘é¢æ— æ•ˆæˆ–ä½äºæœ€ä½è¦æ±‚ã€‚`); return; }
    if (gameState.finances.wealth < dowryAmount) { showToast("ä½ çš„è´¢åŠ›ä¸è¶³ä»¥æ”¯æ’‘è¿™é—¨å©šäº‹ã€‚"); return; }

    finalizeChildMarriage(childId, partnerInfo, dowryAmount);
}
// ===================== ã€ç¬¬ä¸€æ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * [V2.0] å­å¥³æˆå©šæœ€ç»ˆå¤„ç†å‡½æ•°
 * @param {string} childId - ç»“å©šçš„å­å—£ID
 * @param {object} partnerInfo - é…å¶çš„ä¸´æ—¶ä¿¡æ¯å¯¹è±¡
 * @param {number} cost - è˜ç¤¼/å«å¦†èŠ±è´¹
 */
function finalizeChildMarriage(childId, partnerInfo, cost) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    applyEffects({ wealth: -cost });

    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä¸ºé…å¶åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ã€å”¯ä¸€çš„NPCå¯¹è±¡
    const spouseNpc = generateNPC({
        name: partnerInfo.name,
        gender: partnerInfo.gender,
        age: child.age + getRandomInt(-2, 2),
        attributes: partnerInfo.attributes,
        avatar: partnerInfo.avatar,
        role: 'å­å—£é…å¶'
    });
    // å°†è¿™ä¸ªæ–°åˆ›å»ºçš„NPCå­˜å…¥å…¨å±€NPCåˆ—è¡¨ï¼Œç¡®ä¿TAçœŸå®å­˜åœ¨
    gameState.npcs[spouseNpc.id] = spouseNpc;

    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç°åœ¨ï¼Œæˆ‘ä»¬å°†å®Œæ•´çš„NPC IDå­˜å…¥å­©å­çš„å©šå§»ä¿¡æ¯ä¸­
    child.marriage.isMarried = true;
    child.marriage.spouseId = spouseNpc.id; // ä¸å†ä½¿ç”¨ä¸´æ—¶çš„spouseInfo
    child.marriage.grandchildTimer = 4; // å¼€å¯å­™è¾ˆè¯è‚²è®¡æ—¶å™¨

    const familyRepGain = Math.floor(cost / 100) + Math.floor(partnerInfo.attributes.family / 20);
    applyEffects({ reputation: familyRepGain });

    const eventText = `ä½ ä¸ºå­©å­<strong class="value">${child.name}</strong>ä¸<strong class="value">${partnerInfo.name}</strong>å®šä¸‹äº†ä¸€é—¨äº²äº‹ï¼ŒèŠ±è´¹äº†<span class="value">${cost}</span>ä¸¤ã€‚<br>å®¶æ—å£°æœ›å› æ­¤æå‡äº†<span class="value">${familyRepGain}</span>ç‚¹ã€‚`;

    logEvent(`ä½ çš„å­©å­ <strong class="highlight-npc">${child.name}</strong> ä¸ <strong class="highlight-npc">${partnerInfo.name}</strong> å–œç»“è¿ç†ã€‚`, true);
    showEventCard('å–œç»“è‰¯ç¼˜', 'fa-ring', eventText);
    renderGame();
}
function arrangeChildMarriage(childId, partnerInfo) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    if(partnerInfo.isArranged) {
        const partnerScore = Object.values(partnerInfo.attributes).reduce((a, b) => a + b, 0);
        const childScore = Object.values(child.attributes).reduce((a, b) => a + b, 0);
        const acceptanceChance = Math.min(0.95, 0.5 + (childScore - partnerScore) / 200);
        if(Math.random() > acceptanceChance) {
            showEventCard('è®®äº²å¤±è´¥', 'fa-times-circle', `${partnerInfo.name}çš„å®¶æ—å¯¹è¿™é—¨äº²äº‹å¹¶ä¸æ»¡æ„ï¼Œæ‹’ç»äº†ã€‚`);
            return;
        }
        if (Math.random() < 0.2) {
             showEventCard('å­å¥³æ‹’å©š', 'fa-hand-paper', `${child.name}å¯¹è¿™é—¨äº²äº‹å¹¶ä¸æ»¡æ„ï¼Œä¹Ÿæ‹’ç»äº†ã€‚`);
            return;
        }
    }

    const isSecretChild = child.isSecret;
    const mother = gameState.npcs[child.motherId];
    const isShuchu = !isSecretChild && mother && gameState.marriage.isMarried && mother.id !== gameState.marriage.spouseId;

    const isDichu = !isSecretChild && !isShuchu;
    let minCost = isShuchu ? 50 : 200;

    let promptText = `ä¸º${child.name}å‡†å¤‡${child.gender === 'male' ? 'è˜ç¤¼' : 'å«å¦†'} (æœ€ä½${minCost}ä¸¤):`;
    let hasHouseForDowry = false;
    if(isDichu && child.gender === 'female') {
        const availableHouse = gameState.finances.assets.find(a => a.type === 'residence' && !a.isOccupiedByChild);
        if(availableHouse) {
             promptText += ` (å·²å¤‡å¥½ä¸€å¥—æˆ¿äº§)`;
             hasHouseForDowry = true;
        } else {
             promptText += ` (éœ€å¦å¤‡ä¸€å¥—æˆ¿äº§, ä½†ä½ æ²¡æœ‰é—²ç½®æˆ¿äº§)`;
        }
    }

    let dowryInput = prompt(promptText, minCost*2);
    if (dowryInput === null) return;
    const dowryAmount = parseInt(dowryInput);

    if (isNaN(dowryAmount) || dowryAmount < minCost) { showToast(`é‡‘é¢æ— æ•ˆæˆ–ä½äºæœ€ä½è¦æ±‚ã€‚`); return; }
    if (gameState.finances.wealth < dowryAmount) { showToast("ä½ çš„è´¢åŠ›ä¸è¶³ä»¥æ”¯æ’‘è¿™é—¨å©šäº‹ã€‚"); return; }
    if(isDichu && child.gender === 'female' && !hasHouseForDowry) { showToast("ä½ æ²¡æœ‰é—²ç½®çš„æˆ¿äº§ä½œä¸ºå«¡å¥³å«å¦†ã€‚"); return; }

    applyEffects({wealth: -dowryAmount});
    if(isDichu && child.gender === 'female' && hasHouseForDowry) {
        const house = gameState.finances.assets.find(a => a.type === 'residence' && !a.isOccupiedByChild);
        house.isOccupiedByChild = child.id;
        showEventCard('é™ªé€å«å¦†', 'fa-key', `ä½ å°†${house.name}ä½œä¸ºå«å¦†ï¼Œé™ªå«ç»™äº†${child.name}ã€‚`);
    }

    child.marriage.isMarried = true;
    child.marriage.spouseInfo = partnerInfo;
    child.marriage.grandchildTimer = 4;

    showEventCard('å–œç»“è‰¯ç¼˜', 'fa-ring', `ä½ ä¸ºå­©å­<strong class="value">${child.name}</strong>ä¸<strong class="value">${partnerInfo.name}</strong>å®šä¸‹äº†ä¸€é—¨äº²äº‹ï¼ŒèŠ±è´¹äº†<span class="value">${dowryAmount}</span>ä¸¤ã€‚`);
    renderGame();
}
// =======================================================================
// ============================= MERCHANT GUILD ==========================
// =======================================================================
function logMerchantEvent(text) {
    gameState.finances.merchantLog.unshift(text);
    if (gameState.finances.merchantLog.length > 20) gameState.finances.merchantLog.pop();
}

let voyageChoices = {
    captain: null,
    route: null,
    cargo: {},
    investment: 0
};
function handleMerchantSpecialEvent(event, choice) {
    const outcome = choice.outcome;
    let finalEffects = { ...outcome.effects };

    // åº”ç”¨æˆæœ¬
    if (finalEffects.cost) {
        if (gameState.finances.wealth < finalEffects.cost) {
            showToast("èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œæ­¤é€‰é¡¹ï¼");
            return;
        }
        applyEffects({ wealth: -finalEffects.cost });
    }

    // åº”ç”¨å…¶ä»–æ•ˆæœ
    if (finalEffects.wealth) {
        applyEffects({ wealth: finalEffects.wealth });
    }
    if (finalEffects.reputation) {
        applyEffects({ reputation: finalEffects.reputation });
    }
    if (finalEffects.virtue) {
        applyEffects({ attributes: { virtue: finalEffects.virtue } });
    }
    // ...å¯ä»¥æ·»åŠ æ›´å¤šæ•ˆæœç±»å‹

    showEventCard(event.title, 'fa-exclamation-triangle', outcome.text);

    // è¿”å›ä¸€ä¸ªæ•ˆæœå¯¹è±¡ï¼Œè®©è°ƒç”¨è€…å¯ä»¥ä¿®æ”¹æ”¶ç›Š
    return finalEffects;
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
function handleMerchantAction(type) {
    let content;
    switch(type) {
        case 'explore':
            // æ ¸å¿ƒä¿®æ”¹ï¼šç°åœ¨è¿™ä¸ªæŒ‰é’®ä¼šæ‰“å¼€æ–°çš„ä¸»ç•Œé¢
            showMaritimeTradeUI();
            break;
        case 'trade':
            startTradeSim();
            break;
        case 'invest':
             showInvestmentDashboard();
             break;
        case 'farm':
            content = `<p>ç®¡ç†ä½ çš„ç”°åœ°ï¼Œè¿›è¡Œæ’­ç§ã€‚</p>`;
            const ownedLands = gameState.merchant.ownedLand;
            const activeCrops = gameState.merchant.activeCrops;
            const ownedLandEntries = Object.entries(ownedLands);
            if(ownedLandEntries.length > 0) {
                ownedLandEntries.forEach(([landType, totalAcres]) => {
                    const landInfo = landData.find(l => l.id === landType);
                    const plantedCropsOnType = activeCrops.filter(c => c.landType === landType);
                    const plantedAcres = plantedCropsOnType.reduce((sum, crop) => sum + crop.acres, 0);
                    const availableAcres = totalAcres - plantedAcres;
                    content += `
                        <div class="marketplace-item" style="display: block; border-bottom: 1px dashed var(--border-color-light); padding-bottom: 10px; margin-bottom: 10px;">
                            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span>${landInfo.icon} <strong>${landInfo.name}</strong> (å…± ${totalAcres} äº©)</span>
                                ${availableAcres > 0 ? `<button class="control-btn" style="padding: 5px 10px; font-size: 0.8em;" onclick="showPlantCropOverlay('${landType}')">æ’­ç§ (${availableAcres}äº©å¯ç”¨)</button>` : '<span class="comment">å·²ç§æ»¡</span>'}
                            </div>
                    `;
                    if (plantedCropsOnType.length > 0) {
                        content += '<ul>';
                        plantedCropsOnType.forEach(crop => {
                            const cropInfo = cropData.find(cd => cd.id === crop.cropId);
                            content += `<li>${cropInfo.icon} ${cropInfo.name} (x${crop.acres}äº©) - ${crop.cycleLeft}å›åˆåæˆç†Ÿ</li>`;
                        });
                        content += '</ul>';
                    }
                    content += `</div>`;
                });
            } else { 
                content += `<p class="comment">ä½ è¿˜æ²¡æœ‰åœŸåœ°ã€‚</p>`; 
            }
            content += `<div class="options"><button class="option" onclick="showBuyLandOverlay()"><i class="fas fa-plus"></i> è´­ç½®æ–°åœ°å¥‘</button></div>`;
            document.getElementById('merchantGuildContent').innerHTML = content;
            showOverlay('merchantGuildOverlay');
            break;
    }
}
// [æ–°å¢è¿™ä¸ªå‡½æ•°] äº§ä¸šæŠ•èµ„é¢æ¿æ ¸å¿ƒå‡½æ•°
function showInvestmentDashboard() {
    let html = `<div class="section-header"><i class="fas fa-store"></i> æˆ‘çš„äº§ä¸š</div>`;

    if (gameState.merchant.investments.length > 0) {
        gameState.merchant.investments.forEach(invest => {
            const type = merchantInvestmentData.types.find(t => t.id === invest.typeId);
            const level = type.levels[invest.level];
            html += `
                <div class="suitor" onclick="showInvestmentDetails('${invest.instanceId}')">
                    <div class="suitor-details">
                        <div class="suitor-name">${level.name} (Lv.${invest.level + 1})</div>
                        <div class="suitor-desc">æŒæŸœ: ${merchantInvestmentData.managers.find(m => m.id === invest.managerId).name}</div>
                    </div>
                </div>
            `;
        });
    } else {
        html += `<p class="comment">ä½ åä¸‹å°šæ— ä»»ä½•äº§ä¸šã€‚</p>`;
    }

    html += `<div class="section-header"><i class="fas fa-plus-circle"></i> å¼€è®¾æ–°äº§ä¸š</div>`;
    html += `<div class="options">`;
    merchantInvestmentData.types.forEach(type => {
        const isOwned = gameState.merchant.investments.some(i => i.typeId === type.id);
        if (!isOwned) {
            const canAfford = gameState.finances.wealth >= type.levels[0].cost;
            html += `<button class="option" ${!canAfford ? 'disabled' : ''} onclick="makeInvestment('${type.id}')">
                <i class="fas fa-building"></i>
                <span class="option-text"><strong>å¼€è®¾${type.name}</strong><div><small>æˆæœ¬: ${type.levels[0].cost} ä¸¤</small></div></span>
            </button>`;
        }
    });
    html += `</div>`;

    // ä½¿ç”¨ showDecisionCard æ¥æ˜¾ç¤ºæ„å»ºå¥½çš„å†…å®¹
    showDecisionCard("äº§ä¸šæŠ•èµ„", "fa-store-alt", html, []);
}
// ===================== ã€æ–°å¢ã€‘å…¨æ–°è¿œæ´‹å•†è·¯æ ¸å¿ƒå‡½æ•° =====================
/**
 * æ˜¾ç¤ºè¿œæ´‹å•†è·¯ä¸»ç•Œé¢
 */
function showMaritimeTradeUI() {
    const merchant = gameState.merchant;
    const fleetInfo = MARITIME_TRADE_DATA.fleetLevels[merchant.fleetLevel];
    let html = '';

    // æ˜¾ç¤ºå½“å‰èˆ°é˜ŸçŠ¶æ€å’Œå‡çº§é€‰é¡¹
    html += `<div class="section-header"><i class="fas fa-ship"></i> æˆ‘çš„èˆ°é˜Ÿ</div>`;
    if (merchant.fleetLevel === 0) {
        // è¿˜æœªç»„å»ºèˆ°é˜Ÿ
        html += `<p class="comment">ä½ å°šæœªæ‹¥æœ‰è‡ªå·±çš„èˆ¹é˜Ÿï¼Œæ— æ³•è¿›è¡Œè¿œæ´‹è´¸æ˜“ã€‚</p>
                 <div class="options">
                     <button class="option" ${gameState.finances.wealth < fleetInfo.upgradeCost || gameState.family.reputation < fleetInfo.req.reputation ? 'disabled' : ''} onclick="assembleFleet()">
                         <i class="fas fa-anchor"></i>
                         <span class="option-text"><strong>ç»„å»º${MARITIME_TRADE_DATA.fleetLevels[1].name}</strong><div><small>èŠ±è´¹: ${fleetInfo.upgradeCost} ä¸¤ | è¦æ±‚å£°æœ›: ${fleetInfo.req.reputation}</small></div></span>
                     </button>
                 </div>`;
    } else {
        // å·²æœ‰èˆ°é˜Ÿï¼Œæ˜¾ç¤ºä¿¡æ¯å’Œå‡çº§æŒ‰é’®
        html += `<div class="trading-info-box" style="margin-bottom: 10px;">
                    <h4>å½“å‰èˆ°é˜Ÿç­‰çº§</h4>
                    <div class="value">${fleetInfo.name} (Lv.${merchant.fleetLevel})</div>
                 </div>`;
        const nextLevel = MARITIME_TRADE_DATA.fleetLevels[merchant.fleetLevel];
        if (nextLevel && nextLevel.upgradeCost > 0) {
            const canUpgrade = gameState.finances.wealth >= nextLevel.upgradeCost && gameState.family.reputation >= nextLevel.req.reputation;
            html += `<div class="options">
                        <button class="option" ${!canUpgrade ? 'disabled' : ''} onclick="upgradeFleet()">
                            <i class="fas fa-arrow-up"></i>
                            <span class="option-text"><strong>å‡çº§ä¸º${nextLevel.name}</strong><div><small>èŠ±è´¹: ${nextLevel.upgradeCost} ä¸¤ | è¦æ±‚å£°æœ›: ${nextLevel.req.reputation}</small></div></span>
                        </button>
                     </div>`;
        }
    }

    // æ˜¾ç¤ºæŠ•èµ„é¡¹ç›®
    html += `<div class="section-header" style="margin-top: 20px;"><i class="fas fa-route"></i> å¼€å¯å•†è·¯</div>`;
    if (merchant.voyageCycle && merchant.voyageCycle.isOnVoyage) {
        // å¦‚æœæ­£åœ¨èˆªè¡Œä¸­
        html += `<p class="comment">ä½ çš„ <strong class="value">${merchant.voyageCycle.tierName}</strong> èˆ¹é˜Ÿæ­£åœ¨èˆªè¡Œä¸­ï¼Œå°†äº <strong class="value">${merchant.voyageCycle.turnsLeft}</strong> å›åˆåå½’æ¥ã€‚</p>`;
    } else if (merchant.fleetLevel > 0) {
        // å¦‚æœç©ºé—²ï¼Œæ˜¾ç¤ºå¯æŠ•èµ„çš„å•†è·¯
        html += `<div class="options">`;
        MARITIME_TRADE_DATA.investmentTiers.forEach(tier => {
            if (merchant.fleetLevel >= tier.level) {
                const canAfford = gameState.finances.wealth >= tier.investment;
                html += `<button class="option" ${!canAfford ? 'disabled' : ''} onclick="startMaritimeTradeCycle(${tier.level})">
                            <i class="fas fa-hand-holding-usd"></i>
                            <span class="option-text"><strong>${tier.name}</strong><div><small>æŠ•å…¥: ${tier.investment} ä¸¤ | å‘¨æœŸ: ${tier.cycle} å›åˆ</small></div></span>
                         </button>`;
            }
        });
        html += `</div>`;
    } else {
        html += `<p class="comment">è¯·å…ˆç»„å»ºä½ çš„èˆ°é˜Ÿã€‚</p>`;
    }

    showDecisionCard("è¿œæ´‹å•†è·¯", "fa-anchor", html, []);
}

/**
 * ç»„å»º/å‡çº§èˆ°é˜Ÿ
 */
function assembleFleet() {
    const currentLevel = gameState.merchant.fleetLevel;
    const targetLevelInfo = MARITIME_TRADE_DATA.fleetLevels[currentLevel];
    if (gameState.finances.wealth < targetLevelInfo.upgradeCost) { showToast("èµ„é‡‘ä¸è¶³ï¼"); return; }
    if (gameState.family.reputation < targetLevelInfo.req.reputation) { showToast("å£°æœ›ä¸è¶³ï¼"); return; }

    applyEffects({ wealth: -targetLevelInfo.upgradeCost });
    gameState.merchant.fleetLevel = 1;
    showEventCard("èˆ°é˜Ÿç»„å»ºæˆåŠŸï¼", "fa-anchor", `ä½ èŠ±è´¹ ${targetLevelInfo.upgradeCost} ä¸¤ï¼ŒæˆåŠŸç»„å»ºäº†ä½ çš„ç¬¬ä¸€æ”¯ã€${MARITIME_TRADE_DATA.fleetLevels[1].name}ã€‘ï¼`);
    showMaritimeTradeUI();
}

function upgradeFleet() {
    const currentLevel = gameState.merchant.fleetLevel;
    const nextLevelInfo = MARITIME_TRADE_DATA.fleetLevels[currentLevel];
    if (!nextLevelInfo || nextLevelInfo.upgradeCost === 0) { showToast("å·²æ˜¯æœ€é«˜ç­‰çº§èˆ°é˜Ÿã€‚"); return; }
    if (gameState.finances.wealth < nextLevelInfo.upgradeCost) { showToast("èµ„é‡‘ä¸è¶³ï¼"); return; }
    if (gameState.family.reputation < nextLevelInfo.req.reputation) { showToast("å£°æœ›ä¸è¶³ï¼"); return; }

    applyEffects({ wealth: -nextLevelInfo.upgradeCost });
    gameState.merchant.fleetLevel++;
    showEventCard("èˆ°é˜Ÿå‡çº§æˆåŠŸï¼", "fa-arrow-up", `ä½ èŠ±è´¹ ${nextLevelInfo.upgradeCost} ä¸¤ï¼ŒæˆåŠŸå°†èˆ°é˜Ÿå‡çº§ä¸ºã€${MARITIME_TRADE_DATA.fleetLevels[gameState.merchant.fleetLevel].name}ã€‘ï¼`);
    showMaritimeTradeUI();
}

/**
 * å¼€å§‹ä¸€ä¸ªæ–°çš„èˆªè¡Œå‘¨æœŸ
 */
function startMaritimeTradeCycle(tierLevel) {
    const tier = MARITIME_TRADE_DATA.investmentTiers.find(t => t.level === tierLevel);
    if (!tier) return;
    if (gameState.finances.wealth < tier.investment) { showToast("æŠ•èµ„æœ¬é‡‘ä¸è¶³ï¼"); return; }

    applyEffects({ wealth: -tier.investment });
    gameState.merchant.voyageCycle = {
        isOnVoyage: true,
        turnsLeft: tier.cycle,
        tierName: tier.name,
        investment: tier.investment,
        roi_range: tier.roi_range
    };
    showEventCard("å¼€å¯æ–°èˆªè·¯", "fa-route", `ä½ æŠ•å…¥ ${tier.investment} ä¸¤å¼€å¯äº†ã€${tier.name}ã€‘å•†è·¯ï¼Œèˆ¹é˜Ÿå·²å‡ºå‘ï¼Œé¢„è®¡ ${tier.cycle} å›åˆåå½’æ¥ã€‚`);
    showMaritimeTradeUI();
}

/**
 * æ¯å›åˆå¤„ç†èˆªè¡Œå‘¨æœŸ
 */
function processMaritimeTradeCycle() {
    const cycle = gameState.merchant.voyageCycle;
    if (cycle && cycle.isOnVoyage) {
        cycle.turnsLeft--;
        // æ¯å›åˆæœ‰å°æ¦‚ç‡è§¦å‘ä¸€ä¸ªç®€å•çš„è¿‡ç¨‹äº‹ä»¶ï¼Œå¢åŠ ä»£å…¥æ„Ÿ
        if (cycle.turnsLeft > 0 && Math.random() < 0.3) {
            const event = getRandomElement([...VOYAGE_EVENTS.positive, ...VOYAGE_EVENTS.negative, ...VOYAGE_EVENTS.neutral]);
            logEvent(`ä½ çš„è¿œæ´‹å•†é˜Ÿä¼ æ¥æ¶ˆæ¯ï¼š${event.desc}`);
            showToast(`èˆªè¡Œæ¶ˆæ¯ï¼š${event.name}`);
        }
        if (cycle.turnsLeft <= 0) {
            finalizeMaritimeTrade();
        }
    }
}

/**
 * ç»“ç®—èˆªè¡Œæ”¶ç›Š
 */
function finalizeMaritimeTrade() {
    const cycle = gameState.merchant.voyageCycle;
    if (!cycle) return;

    const roi = cycle.roi_range[0] + Math.random() * (cycle.roi_range[1] - cycle.roi_range[0]);
    let profit = Math.floor(cycle.investment * roi);
    
    // åº”ç”¨è´¢è¿ç¥ç¦
    if (gameState.buffs && gameState.buffs.wealth_luck) {
        profit = Math.floor(profit * 1.2);
        logEvent("åœ¨ã€è´¢è¿ã€‘ç¥ç¦çš„å½±å“ä¸‹ï¼Œä½ çš„è¿œæ´‹è´¸æ˜“æ”¶ç›Šå¢åŠ äº†ã€‚");
    }
    
    const totalReturn = cycle.investment + profit;
    applyEffects({ wealth: totalReturn });

    const resultText = profit >= 0 
        ? `ä¸ºä½ å¸¦æ¥äº† <strong class="value">${profit}</strong> ä¸¤çš„å‡€åˆ©æ¶¦ï¼`
        : `ä¸å¹¸äºæŸäº† <strong class="value">${-profit}</strong> ä¸¤ã€‚`;
    
    showEventCard(`å•†è·¯å½’æ¥ï¼š${cycle.tierName}`, "fa-ship", `ä½ æŠ•èµ„çš„ã€${cycle.tierName}ã€‘å•†é˜Ÿå·²å¹³å®‰å½’æ¥ï¼Œæœ¬æ¬¡èˆªè¡Œ${resultText}`);
    logMerchantEvent(`ã€${cycle.tierName}ã€‘å•†è·¯ç»“ç®—ï¼Œè·å¾— ${totalReturn} ä¸¤ï¼Œå‡€åˆ©æ¶¦ä¸º ${profit} ä¸¤ã€‚`);

    // é‡ç½®èˆªè¡ŒçŠ¶æ€
    gameState.merchant.voyageCycle = null;
}
function showDecisionCard(header, icon, content, options) {
    if (gameState.flags.isBatchProcessing) {
        console.log(`[è·³è¿‡å›åˆ] å†³ç­–: ${header} - è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€é¡¹`);
        const firstOption = options.find(opt => !opt.disabled);
        if (firstOption && firstOption.callback) {
            firstOption.callback();
        }
        return;
    }
    closeAllOverlays(); // å…ˆå…³é—­å…¶ä»–æ‰€æœ‰çª—å£
    const card = document.getElementById('decisionCardOverlay');
    if (!card) {
        console.error("Error: Could not find 'decisionCardOverlay' element.");
        return;
    }
    const headerEl = card.querySelector('#decisionCardHeader');
    const animationEl = card.querySelector('#decisionCardAnimation');
    const contentEl = card.querySelector('#decisionCardContent');
    const optionsContainer = card.querySelector('#decisionCardOptions');
    if (headerEl) headerEl.innerHTML = header;
    if (animationEl) animationEl.innerHTML = icon.startsWith('fa-') ? `<i class="fas ${icon}"></i>` : icon;
    if (contentEl) contentEl.innerHTML = content;
    if (optionsContainer) {
        optionsContainer.innerHTML = '';
        if (Array.isArray(options)) {
            options.forEach(opt => {
                const button = document.createElement('button');
                button.className = 'option';
                if (opt.htmlContent) {
                    button.innerHTML = opt.htmlContent;
                }
                if (opt.style) {
                    button.setAttribute('style', opt.style);
                }
                button.disabled = opt.disabled || false;
                if (opt.callback) {
                    // è¿™é‡Œçš„ onclick äº‹ä»¶ç¡®ä¿äº†å›è°ƒå‡½æ•°è¢«æ‰§è¡Œï¼Œä½†å¼¹çª—çš„å…³é—­
                    // å°†ç”±å›è°ƒå‡½æ•°å†…éƒ¨çš„é€»è¾‘ï¼ˆæ¯”å¦‚è°ƒç”¨å¦ä¸€ä¸ª showEventCard æˆ– closeAllOverlaysï¼‰æ¥å†³å®šï¼Œ
                    // ä»è€Œæ­£ç¡®è¡”æ¥äº‹ä»¶é˜Ÿåˆ—ã€‚
                    button.onclick = () => {
                        opt.callback();
                    };
                }
                optionsContainer.appendChild(button);
            });
        } else if (typeof options === 'string') {
            optionsContainer.innerHTML = options;
        }
    }
    showOverlay('decisionCardOverlay');
}
function startGuildTrade(guildName) {
    // å…³é—­å½“å‰çš„å†³ç­–å¼¹çª—
    closeAllOverlays();

    // ä½¿ç”¨setTimeoutç¡®ä¿æ—§å¼¹çª—å®Œå…¨å…³é—­åå†æ‰§è¡Œæ–°æ“ä½œ
    setTimeout(() => {
        // å…ˆæ¸…ç©ºå•†ä¼šå†…å®¹åŒºåŸŸï¼Œä¸ºå°æ¸¸æˆåšå‡†å¤‡
        const contentWrapper = document.getElementById('merchantGuildContent');
        if (contentWrapper) {
            contentWrapper.innerHTML = `
                <div id="miniGameContainer" style="display: none;">
                    </div>
            `;
        } else {
            console.error("æ— æ³•æ‰¾åˆ° merchantGuildContent å…ƒç´ !");
            return; // å¦‚æœæ‰¾ä¸åˆ°å®¹å™¨ï¼Œåˆ™ä¸ç»§ç»­æ‰§è¡Œ
        }

        // ç„¶åæ˜¾ç¤ºåŒ…å«äº†ç©ºç™½å®¹å™¨çš„å•†ä¼šå¼¹çª—
        showOverlay('merchantGuildOverlay');
        
        // æœ€åï¼Œåœ¨è¿™ä¸ªå¯è§çš„ã€å‡†å¤‡å¥½çš„å®¹å™¨é‡Œå¯åŠ¨å°æ¸¸æˆ
        startMiniGame(guildName); 
    }, 300); // 300æ¯«ç§’å»¶è¿Ÿç¡®ä¿è¿‡æ¸¡æµç•…
}
function makeInvestment(key) {
    const investment = merchantInvestmentData.find(i => i.id === key);
    if (!investment || gameState.finances.wealth < investment.cost) return;

    applyEffects({ wealth: -investment.cost });
    gameState.merchant.investments.push({ ...investment, purchaseDate: gameState.date.year });
    logMerchantEvent(`ä½ æŠ•èµ„ <span class='value'>${investment.cost}</span> ä¸¤ï¼Œå¼€è®¾äº†ä¸€å®¶ <strong class='value'>${investment.name}</strong>ã€‚`);
    handleMerchantAction('invest');

}
 function makeInvestment(typeId) {
    const investmentType = merchantInvestmentData.types.find(t => t.id === typeId);
    if (!investmentType) return;
    const initialLevel = investmentType.levels[0];
    if (gameState.finances.wealth < initialLevel.cost) {
        showToast("èµ„é‡‘ä¸è¶³");
        return;
    }
    applyEffects({ wealth: -initialLevel.cost });
    const newInvestment = {
        instanceId: `invest_${Date.now()}`,
        typeId: typeId,
        level: 0,
        managerId: 'frugal',
        strategy: 'stable'
    };
    gameState.merchant.investments.push(newInvestment);
    
    logMerchantEvent(`ä½ æŠ•èµ„ <span class='value'>${initialLevel.cost}</span> ä¸¤ï¼Œå¼€è®¾äº†ä¸€å®¶ <strong class='value'>${initialLevel.name}</strong>ã€‚`);
    
    // â–¼â–¼â–¼ ã€æ–°å¢ã€‘è®°äº‹åŠŸèƒ½ â–¼â–¼â–¼
    logEvent(`ä½ å¼€è®¾äº†ä¸€å®¶æ–°çš„äº§ä¸šï¼šã€${initialLevel.name}ã€‘ã€‚`, true);
    // â–²â–²â–² ã€æ–°å¢ç»“æŸã€‘ â–²â–²â–²
    
    closeAllOverlays();
    showInvestmentDashboard();
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function processInvestmentReturns() {
    if (!gameState.merchant.investments || gameState.merchant.investments.length === 0) {
        return;
    }
    if (Math.random() < 0.4) {
        const event = getRandomElement(INVESTMENT_EVENTS);
        
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†äº‹ä»¶å­˜å…¥ merchant ä»“åº“
        addUiEvent('merchant', () => {
            const options = event.options.map(opt => ({
                htmlContent: `<span class="option-text">${opt.text}</span>`,
                disabled: opt.req && opt.req.wealth && gameState.finances.wealth < opt.req.wealth,
                callback: () => {
                    const outcomeEffects = handleMerchantSpecialEvent(event, opt);
                    finalizeInvestmentReturns(outcomeEffects.multiplier || 1.0);
                }
            }));
            showDecisionCard(event.title, 'fa-store-alt', event.desc, options);
        });
    } else {
        finalizeInvestmentReturns();
    }
}
// è¿™ä¸ªå‡½æ•°æ˜¯ç»“ç®—çš„æ ¸å¿ƒï¼Œä¿ç•™äº†æ‚¨æ‰€æœ‰çš„åŸæœ‰é€»è¾‘
function finalizeInvestmentReturns(eventMultiplier = 1.0) {
if (gameState.buffs && gameState.buffs.wealth_luck) {
    eventMultiplier *= 1.2; // æŠ•èµ„åŸºç¡€æ”¶ç›Šæå‡20%
    logEvent("åœ¨ã€è´¢è¿ã€‘ç¥ç¦çš„å½±å“ä¸‹ï¼Œä½ çš„äº§ä¸šæŠ•èµ„å›æŠ¥æ›´é«˜äº†ã€‚");
}
    let totalProfit = 0;
    let yearlyLog = 'äº§ä¸šå¹´åº¦ç»“ç®—ï¼š<ul>';

    gameState.merchant.investments.forEach(invest => {
        const type = merchantInvestmentData.types.find(t => t.id === invest.typeId);
        const level = type.levels[invest.level];
        const manager = merchantInvestmentData.managers.find(m => m.id === invest.managerId);
        const strategy = merchantInvestmentData.strategies.find(s => s.id === invest.strategy);

        // ã€ä¿ç•™ã€‘æ‰£é™¤æŒæŸœè–ªé…¬
        applyEffects({ wealth: -manager.salary });

        // ã€ä¿ç•™ã€‘è®¡ç®—åŸºç¡€æ”¶ç›Šï¼Œå¹¶åº”ç”¨æŒæŸœå’Œç­–ç•¥çš„æ”¶ç›Šä¿®æ­£
        let profit = level.base_return;
        profit *= manager.effect.return_mod;
        profit *= strategy.effect.return_mod;

        // ã€ä¿ç•™ã€‘è®¡ç®—é£é™©
        let riskFactor = Math.random() * 2; // 0.0 to 2.0
        riskFactor *= manager.effect.risk_mod;
        riskFactor *= strategy.effect.risk_mod;

        // ã€ä¿ç•™ã€‘æ ¹æ®é£é™©è°ƒæ•´æœ€ç»ˆæ”¶ç›Š
        profit *= (riskFactor * 0.5 + 0.5); // ä½¿æ”¶ç›Šåœ¨50% - 150%ä¹‹é—´æ³¢åŠ¨

        // â–¼â–¼â–¼ æ–°å¢é€»è¾‘ï¼šåº”ç”¨ç‰¹æ®Šäº‹ä»¶çš„æ”¶ç›Šå€ç‡ â–¼â–¼â–¼
        profit *= eventMultiplier;
        profit = Math.floor(profit);
        // â–²â–²â–² æ–°å¢é€»è¾‘ç»“æŸ â–²â–²â–²

        // ã€ä¿ç•™ã€‘ç­–ç•¥çš„å…¶ä»–æ•ˆæœ
        if (strategy.id === 'promote') {
            applyEffects({ wealth: -strategy.cost, reputation: strategy.effect.reputation });
        }
        applyEffects({ reputation: manager.effect.reputation });

        totalProfit += profit;
        yearlyLog += `<li>${level.name}: <span class="value">${profit >= 0 ? '+' : ''}${profit}</span> ä¸¤</li>`;
    });

    yearlyLog += `</ul>æ€»è®¡æ”¶ç›Š <strong class='value'>${totalProfit}</strong> ä¸¤ã€‚`;
    applyEffects({ wealth: totalProfit });
    if(gameState.merchant.investments.length > 0) {
        logMerchantEvent(yearlyLog);
    }
    renderGame();
}
function showBuyLandOverlay() {
    let options = landData.map(land => {
        const canAfford = gameState.finances.wealth >= land.cost;
        const meetsReq = isRequirementMet({reputation: land.reputation_req});
        
        const buttonHTML = `
            <div class="marketplace-item" style="border:none; padding: 5px 0;">
                <span>${land.icon} <strong>${land.name}</strong> - ${land.cost}ä¸¤/äº©<br>
                <small>${land.desc}</small>
                ${!meetsReq ? `<br><small style="color:red;">éœ€è¦å£°æœ›: ${land.reputation_req}</small>` : ''}
                </span>
            </div>
        `;
            
        return {
            htmlContent: buttonHTML,
            style: `height:auto; padding: 10px 22px;`,
            disabled: !canAfford || !meetsReq,
            // ã€ä¿®æ”¹ã€‘è¿™é‡Œä¸å†ç›´æ¥è°ƒç”¨ buyLandï¼Œè€Œæ˜¯æ‰“å¼€ä¸€ä¸ªæ•°é‡é€‰æ‹©å¼¹çª—
            callback: () => showBuyLandQuantityModal(land.id)
        };
    });
    
    showDecisionCard('è´­ç½®åœ°å¥‘', 'fa-map-marked-alt', 'é€‰æ‹©è¦è´­ä¹°çš„åœŸåœ°ç±»å‹ï¼š', options);
}
// ===================== ã€æ–°å¢ã€‘showBuyLandQuantityModal å‡½æ•° START =====================
function showBuyLandQuantityModal(landType) {
    const landInfo = landData.find(l => l.id === landType);
    if (!landInfo) return;

    const maxCanBuy = Math.floor(gameState.finances.wealth / landInfo.cost);
    if (maxCanBuy <= 0) {
        showToast("ä½ çš„èµ„é‡‘ä¸è¶³ä»¥è´­ä¹°ä¸€äº©è¯¥ç±»åœŸåœ°ã€‚");
        return;
    }

    const contentHTML = `
        <p>è´­ç½®åœ°å¥‘: <strong class="value">${landInfo.name}</strong></p>
        <p>å•ä»·: ${landInfo.cost} ä¸¤/äº© | ç§äº§: ${gameState.finances.wealth} ä¸¤</p>
        <p class="comment">æœ€å¤šå¯è´­ä¹°: ${maxCanBuy} äº©</p>
        <div class="quantity-slider-container">
            <input type="range" id="quantitySlider" value="1" min="1" max="${maxCanBuy}" oninput="this.nextElementSibling.value = this.value">
            <input type="number" id="quantityInput" value="1" min="1" max="${maxCanBuy}" oninput="this.previousElementSibling.value = this.value">
        </div>
    `;

    const options = [{
        htmlContent: 'ç¡®è®¤è´­ç½®',
        callback: () => {
            const quantity = parseInt(document.getElementById('quantityInput').value);
            if (isNaN(quantity) || quantity <= 0 || quantity > maxCanBuy) {
                showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„è´­ä¹°æ•°é‡ã€‚");
                return;
            }
            // è°ƒç”¨ä¿®æ”¹åçš„ buyLand å‡½æ•°
            buyLand(landType, quantity);
        }
    }];
    showDecisionCard(`è´­ç½®${landInfo.name}`, 'fa-map-marked-alt', contentHTML, options);
}
// ===================== ã€æ–°å¢ã€‘showBuyLandQuantityModal å‡½æ•° END =====================
// ===================== ã€æ›¿æ¢ã€‘buyLand å‡½æ•° START =====================
function buyLand(landType, quantity) {
    const landInfo = landData.find(l => l.id === landType);
    if (!landInfo) return;

    const totalCost = landInfo.cost * quantity;

    if (gameState.finances.wealth < totalCost) {
        showToast("èµ„é‡‘ä¸è¶³");
        return;
    }

    if (!isRequirementMet({reputation: landInfo.reputation_req})) {
        showToast("å£°æœ›ä¸è¶³");
        return;
    }

    applyEffects({ wealth: -totalCost });
    gameState.merchant.ownedLand[landType] = (gameState.merchant.ownedLand[landType] || 0) + quantity;

    logMerchantEvent(`ä½ èŠ±è´¹ <span class='value'>${totalCost}</span> ä¸¤ï¼Œè´­ç½®äº† ${quantity} äº© <strong class='value'>${landInfo.name}</strong>ã€‚`);
    showEventCard('è´­ç½®æˆåŠŸ', 'fa-map-marked-alt', `ä½ æˆåŠŸè´­ç½®äº† ${quantity} äº©${landInfo.name}ï¼`);

    closeAllOverlays();
    // å»¶è¿Ÿä¸€ç‚¹å†æ‰“å¼€ï¼Œç¡®ä¿UIæµç•…
    setTimeout(() => handleMerchantAction('farm'), 300);
}
// ===================== ã€æ›¿æ¢ã€‘buyLand å‡½æ•° END =====================
// ===================== ã€æ›¿æ¢ã€‘showPlantCropOverlay å‡½æ•° START =====================
function showPlantCropOverlay(landType) {
    const ownedAcres = gameState.merchant.ownedLand[landType] || 0;
    const plantedAcres = gameState.merchant.activeCrops
        .filter(c => c.landType === landType)
        .reduce((sum, crop) => sum + crop.acres, 0);
    const availableAcres = ownedAcres - plantedAcres;

    if (availableAcres <= 0) {
        showToast("è¿™ç‰‡åœŸåœ°å·²ç»æ²¡æœ‰å¯ç”¨çš„åœ°æ–¹äº†ã€‚");
        return;
    }

    const landInfo = landData.find(l => l.id === landType);
    const wisdom = gameState.player.attributes.wisdom;

    let options = cropData.map(crop => {
        const canAfford = gameState.finances.wealth >= crop.cost;
        let hint = "";
        const adaptation = adaptationMatrix[landType]?.[crop.id] ?? 1;
        if (wisdom > 70) {
            if (adaptation > 1.2) hint = `<span style='color:green;'>[ç»é…]</span>`;
            else if (adaptation < 1) hint = `<span style='color:red;'>[ä¸é€‚]</span>`;
            else hint = `[é€‚å®œ]`;
        }

        const buttonHTML = `
            ${crop.icon} 
            <span class="option-text">
                <strong>${crop.name}</strong> (-${crop.cost}ä¸¤/äº©) ${hint}
                <div><small>${crop.desc} (å‘¨æœŸ: ${crop.cycle}å›åˆ)</small></div>
            </span>`;

        return {
            htmlContent: buttonHTML,
            disabled: !canAfford,
            // ã€ä¿®æ”¹ã€‘è¿™é‡Œä¸å†ä½¿ç”¨ promptï¼Œè€Œæ˜¯è°ƒç”¨æ–°çš„å¼¹çª—å‡½æ•°
            callback: () => {
                showPlantCropQuantityModal(landType, crop.id);
            }
        };
    });

    showDecisionCard(`ä¸º${landInfo.name}é€‰æ‹©ä½œç‰©`, 'fa-seedling', `ä½ ç›®å‰æœ‰ ${availableAcres} äº©å¯ç”¨åœŸåœ°ã€‚`, options);
}
function plantCrop(landType, cropId, acres) {
    const cropInfo = cropData.find(c => c.id === cropId);
    const totalCost = cropInfo.cost * acres;

    if (!cropInfo || gameState.finances.wealth < totalCost) {
        showToast("èµ„é‡‘ä¸è¶³ä»¥ç§æ¤è¿™ä¹ˆå¤šåœŸåœ°ã€‚");
        return;
    }

    applyEffects({ wealth: -totalCost });
    gameState.merchant.activeCrops.push({
        id: `crop_${Date.now()}`,
        landType: landType,
        cropId: cropId,
        acres: acres,
        cycleLeft: cropInfo.cycle
    });

    logMerchantEvent(`ä½ åœ¨ ${acres} äº©åœŸåœ°ä¸Šæ’­ä¸‹äº† <strong class='value'>${cropInfo.name}</strong> çš„ç§å­ã€‚`);

    closeAllOverlays();
    // å»¶è¿Ÿä¸€ç‚¹å†æ‰“å¼€ï¼Œç¡®ä¿UIæµç•…
    setTimeout(() => handleMerchantAction('farm'), 300);
}
// ===================== ã€æ–°å¢ã€‘showPlantCropQuantityModal å‡½æ•° START =====================
function showPlantCropQuantityModal(landType, cropId) {
    const ownedAcres = gameState.merchant.ownedLand[landType] || 0;
    const plantedAcres = gameState.merchant.activeCrops
        .filter(c => c.landType === landType)
        .reduce((sum, crop) => sum + crop.acres, 0);
    const availableAcres = ownedAcres - plantedAcres;
    
    const cropInfo = cropData.find(c => c.id === cropId);
    if (!cropInfo) return;

    const maxCanPlantByMoney = Math.floor(gameState.finances.wealth / cropInfo.cost);
    const maxCanPlant = Math.min(availableAcres, maxCanPlantByMoney);

    if (maxCanPlant <= 0) {
        showToast("ä½ æ²¡æœ‰è¶³å¤Ÿçš„åœŸåœ°æˆ–èµ„é‡‘æ¥ç§æ¤æ­¤ä½œç‰©ã€‚");
        return;
    }

    const contentHTML = `
        <p>ç§æ¤ä½œç‰©: <strong class="value">${cropInfo.name}</strong></p>
        <p>æ’­ç§æˆæœ¬: ${cropInfo.cost} ä¸¤/äº© | ç§äº§: ${gameState.finances.wealth} ä¸¤</p>
        <p class="comment">æœ€å¤šå¯ç§æ¤: ${maxCanPlant} äº©</p>
        <div class="quantity-slider-container">
            <input type="range" id="quantitySlider" value="1" min="1" max="${maxCanPlant}" oninput="this.nextElementSibling.value = this.value">
            <input type="number" id="quantityInput" value="1" min="1" max="${maxCanPlant}" oninput="this.previousElementSibling.value = this.value">
        </div>
    `;

    const options = [{
        htmlContent: 'ç¡®è®¤æ’­ç§',
        callback: () => {
            const quantity = parseInt(document.getElementById('quantityInput').value);
            if (isNaN(quantity) || quantity <= 0 || quantity > maxCanPlant) {
                showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„äº©æ•°ã€‚");
                return;
            }
            plantCrop(landType, cropId, quantity);
        }
    }];
    showDecisionCard(`æ’­ç§${cropInfo.name}`, 'fa-seedling', contentHTML, options);
}
// ===================== ã€æ–°å¢ã€‘showPlantCropQuantityModal å‡½æ•° END =====================
function processCropGrowth() {
    if (!gameState.merchant.activeCrops) return;

    for (let i = gameState.merchant.activeCrops.length - 1; i >= 0; i--) {
        const crop = gameState.merchant.activeCrops[i];
        crop.cycleLeft--;

        if (crop.cycleLeft <= 0) {
            if (Math.random() < 0.4) { // [é¢‘ç‡ä¿®å¤] å°†è¿™é‡Œçš„ 0.15 æå‡åˆ° 0.4
                const event = getRandomElement(FARMING_EVENTS);
                eventQueue.push(() => {
                    const options = event.options.map(opt => ({
                        htmlContent: `<span class="option-text">${opt.text}</span>`,
                        disabled: opt.req.wealth && gameState.finances.wealth < opt.req.wealth,
                        callback: () => {
                            const outcomeEffects = handleMerchantSpecialEvent(event, opt);
                            finalizeHarvest(crop, i, outcomeEffects.multiplier || 1.0);
                        }
                    }));
                    showDecisionCard(event.title, 'fa-seedling', event.desc, options);
                });
            } else {
                finalizeHarvest(crop, i);
            }
        }
    }
}
// æ–°å¢ä¸€ä¸ªè¾…åŠ©å‡½æ•°ç”¨äºæ”¶è·ç»“ç®—ï¼Œé¿å…ä»£ç é‡å¤
// ===================== ã€æ›¿æ¢ã€‘finalizeHarvest å‡½æ•° START =====================
function finalizeHarvest(crop, cropIndex, multiplier = 1.0) {
    if (gameState.buffs && gameState.buffs.wealth_luck) {
        multiplier *= 1.2; // å†œäº‹åŸºç¡€æ”¶ç›Šæå‡20%
        logEvent("åœ¨ã€è´¢è¿ã€‘ç¥ç¦çš„å½±å“ä¸‹ï¼Œä½ çš„ç”°åœ°æ”¶æˆæ›´å¥½äº†ã€‚");
    }
    const landType = crop.landType;
    const cropInfo = cropData.find(c => c.id === crop.cropId);
    const adaptation = adaptationMatrix[landType]?.[crop.cropId] ?? 1;

    // æ ¸å¿ƒä¿®æ”¹ï¼šæ”¶ç›Šä¹˜ä»¥ç§æ¤çš„äº©æ•°
    const finalYield = Math.floor(cropInfo.yield * adaptation * crop.acres * (0.8 + Math.random()*0.4) * multiplier);

    applyEffects({ wealth: finalYield });
    if(cropInfo.effect) {
        let totalEffects = {};
        for (const attr in cropInfo.effect) {
            totalEffects[attr] = cropInfo.effect[attr] * crop.acres; // å±æ€§åŠ æˆä¹Ÿä¹˜ä»¥äº©æ•°
        }
        applyEffects({attributes: totalEffects});
    }

    const harvestMsg = `ä½ ç§æ¤åœ¨${landData.find(l=>l.id===landType).name}çš„ ${crop.acres} äº© ${cropInfo.name} æˆç†Ÿäº†ï¼Œæœ€ç»ˆæ”¶è· <strong class='value'>${finalYield}</strong> ä¸¤ã€‚`;

    // ã€æ–°å¢çš„æ ¸å¿ƒä»£ç ã€‘åœ¨è¿™é‡Œå°†æ”¶è·ä¿¡æ¯è®°å½•åˆ°è®°äº‹æœ¬
    logEvent(harvestMsg);

    // ä¿ç•™åŸæœ‰çš„å¼¹çª—æç¤ºé€»è¾‘
    eventQueue.push(() => {
        showEventCard(`ğŸŒ± æ”¶è·ä¹‹æ—¶ ğŸŒ±`, cropInfo.icon, harvestMsg);
    });

    // ä»activeCropsæ•°ç»„ä¸­ç§»é™¤å·²æ”¶è·çš„ä½œç‰©
    gameState.merchant.activeCrops.splice(cropIndex, 1);
}
// ===================== ã€æ›¿æ¢ã€‘finalizeHarvest å‡½æ•° END =====================
// =======================================================================
// ===================== ã€æ–°å¢ã€‘ä¸»åŠ¨ç»“è¯†æ–°æœ‹å‹åŠŸèƒ½ ========================
// =======================================================================
function strollForEncounters() {
    const cost = 50;
    if (gameState.finances.wealth < cost) {
        showToast(`é—²é€›éœ€è¦ ${cost} ä¸¤ç›˜ç¼ ï¼Œä½ çš„é’±ä¸å¤Ÿã€‚`);
        return;
    }
    applyEffects({ wealth: -cost, attributes: { health: -1 } });

    const roll = Math.random();
    // 60% çš„é«˜å‡ ç‡é‡åˆ°æ–°æœ‹å‹
    if (roll < 0.60) {
        triggerNewEncounter();
    } 
    // 30% çš„å‡ ç‡å¬åˆ°ä¸€äº›è¶£é—»
    else if (roll < 0.90) {
        const gossip = getRandomElement(GOSSIP_DATA);
        showEventCard('è¡—è°ˆå··è®®', 'fa-comments', `ä½ åœ¨è¡—ä¸Šé—²é€›ï¼Œæ— æ„é—´å¬åˆ°ä¸€åˆ™è¶£é—»ï¼š<br><p class="comment" style="margin-top:10px;">â€œ${gossip}â€</p>`);
        applyEffects({ attributes: { wisdom: 1 } });
    } 
    // 10% çš„å‡ ç‡åªæ˜¯æ”¾æ¾äº†å¿ƒæƒ…
    else {
        showEventCard('äº¬åŸé—²é€›', 'fa-walking', 'ä½ åœ¨äº¬åŸçš„è¡—å··ä¸­æ¼«æ­¥äº†ä¸€ä¸ªä¸‹åˆï¼Œå¹¶æœªé‡åˆ°ä»€ä¹ˆç‰¹åˆ«çš„äººå’Œäº‹ï¼Œä½†å¿ƒæƒ…æ”¾æ¾äº†ä¸å°‘ã€‚');
        applyEffects({ attributes: { health: 2 } });
    }
    // æ¯æ¬¡é—²é€›åéƒ½åˆ·æ–°ä¸€ä¸‹æ¸¸æˆç•Œé¢ï¼Œä»¥é˜²ä¸‡ä¸€
    renderGame();
}
function handleOuting(location) {
    if (isProcessing) return;

    if(!gameState.flags.wishingWellThisTurn && Math.random() < 0.03) {
        gameState.flags.wishingWellThisTurn = true;
        showWishingWell(); return;
    }
    if (Math.random() < 0.1) {
        triggerNewEncounter();
        return;
    }

    switch (location) {
        case 'market': showMarket(); return;
        case 'restaurant': showRestaurant(); return;
        case 'temple':
            const templeOptions = [
                {htmlContent:`<i class="fas fa-users"></i> æ‹œç¥­å…ˆç¥–`, callback: () => handleTempleVisit('ancestors')},
                {htmlContent:`<i class="fas fa-praying-hands"></i> æ±‚ç¥æ‹œä½›`, callback: () => handleTempleVisit('buddha')}
            ];
            showDecisionCard('å‚æ‹œå¯ºåº™', 'fa-gopuram', 'ä½ æ¥åˆ°é¦™ç«é¼ç››çš„å¯ºåº™ï¼Œæ‰“ç®—...', templeOptions);
            return;
        case 'clinic': showClinic(); return;
        case 'fengyuejian': showFengYueJian(); return;
    }
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢] handleTempleVisit å‡½æ•°
function handleTempleVisit(type) {
    if (type === 'ancestors') {
        const effect = { virtue: 2 };
        const logText = "ä½ è™”è¯šåœ°æ‹œç¥­äº†åˆ—ç¥–åˆ—å®—ï¼Œå®¶æ—å£°æœ›æå‡ï¼Œå†…å¿ƒæ„Ÿåˆ°ä¸€ç‰‡å®é™ã€‚";
        applyEffects({ reputation: 5, attributes: effect });
        logEvent(logText + " å£°æœ›+5, å“å¾·+2ã€‚");
        showEventCard('å¯ºåº™ç¥ˆç¦', 'fa-gopuram', logText);
    } else { // 'buddha'
        const cost = 100; // è®¸æ„¿çš„é¦™ç«é’±
        if (gameState.finances.wealth < cost) {
            showToast("ä½ çš„é¦™ç«é’±ä¸è¶³100ä¸¤ï¼Œä½›ç¥–æœªç†ä¼šä½ çš„ç¥ˆæ±‚ã€‚");
            return;
        }

        const options = [
            {
                htmlContent: `<i class="fas fa-ring"></i> <strong>æ±‚å§»ç¼˜</strong><div><small>æå‡é‡åˆ°é«˜å±æ€§å¯¹è±¡çš„å‡ ç‡</small></div>`,
                callback: () => grantBuff('partner_luck', 'å§»ç¼˜', cost)
            },
            {
                htmlContent: `<i class="fas fa-arrow-up"></i> <strong>æ±‚åŠŸå</strong><div><small>æå‡å·¥ä½œè·å–åŠŸç»©çš„æ•ˆç‡</small></div>`,
                callback: () => grantBuff('career_luck', 'åŠŸå', cost)
            },
            {
                htmlContent: `<i class="fas fa-coins"></i> <strong>æ±‚è´¢è¿</strong><div><small>æå‡æŠ•èµ„å’Œå†œäº‹çš„æ”¶ç›Š</small></div>`,
                callback: () => grantBuff('wealth_luck', 'è´¢è¿', cost)
            }
        ];
        showDecisionCard('è™”è¯šè®¸æ„¿', 'fa-praying-hands', `ä½ èŠ±è´¹ <span class="value">${cost}</span> ä¸¤é¦™ç«é’±ï¼Œåœ¨ä½›å‰è™”è¯šç¥ˆç¥·ï¼Œä½ å¸Œæœ›æ±‚å¾—...`, options);
    }
}

// [æ–°å¢] æˆäºˆBuffçš„è¾…åŠ©å‡½æ•°
function grantBuff(buffId, buffName, cost) {
    applyEffects({ wealth: -cost, attributes: { virtue: 2 } });
    gameState.buffs[buffId] = { duration: 4 }; // BuffæŒç»­4å›åˆ(2å¹´)
    const logText = `ä½ èŠ±è´¹ ${cost} ä¸¤é¦™ç«é’±ï¼Œè™”è¯šç¥ˆç¥·ï¼Œæ±‚å¾—äº†ã€${buffName}ã€‘çš„ç¥ç¦ã€‚`;
    logEvent(logText);
    showEventCard('ä½›å…‰æ™®ç…§', 'fa-praying-hands', logText);
}
function triggerNewEncounter() {
    let encounterChance = (gameState.player.attributes.charm || 0) / 150 + 0.3;
    if(Math.random() > encounterChance) { showToast("ä½ ä»Šæ—¥å¤–å‡ºå¹¶æœªé‡åˆ°ä»€ä¹ˆç‰¹åˆ«çš„äººã€‚"); return; }

    const gender = Math.random() < 0.5 ? 'male' : 'female';

    let npcOptions = { gender: gender, age: getRandomInt(gameState.player.age - 2, gameState.player.age + 5) };
if (gameState.buffs && gameState.buffs.partner_luck) {
    npcOptions.attributes = { talent: 20, wisdom: 20, charm: 20 }; // å¢åŠ åŸºç¡€å±æ€§
    logEvent("åœ¨ã€å§»ç¼˜ã€‘ç¥ç¦çš„å½±å“ä¸‹ï¼Œä½ ä¼¼ä¹é‡åˆ°äº†ä¸€ä¸ªç‰¹åˆ«çš„äººã€‚");
}
npcOptions.favor = getRandomInt(20, 40);
const newNpc = generateNPC(npcOptions);
    const bg = getRandomElement(gender === 'male' ? suitorBackgrounds : ladyBackgrounds);

    let description = (gameState.player.attributes.charm > 80) ? `ä½ çš„é£å§¿å¸å¼•äº†å¯¹æ–¹çš„æ³¨æ„ï¼ŒTAä¸»åŠ¨å‰æ¥ä¸ä½ ç»“äº¤ã€‚` : `ä½ ä»¬åœ¨äººç¾¤ä¸­å¶ç„¶ç›¸é‡ï¼Œç›¸è°ˆç”šæ¬¢ã€‚`;
    description += `<br><br>å¯¹æ–¹åä¸º <strong class="value">${newNpc.name}</strong>ï¼Œ${bg.desc}`;

    let options = [
        {htmlContent:`<i class="fas fa-user-plus"></i> ä¸TAç»“äº¤`, callback:() => befriendNpc(newNpc.id)},
        {htmlContent:`<i class="fas fa-times"></i> å©‰è¨€è°¢ç»`, style:`background:linear-gradient(135deg, #e74c3c, #c0392b);`, callback:() => closeAllOverlays()}
    ];
    document.getElementById('newFriendEncounterHeader').innerText = `èæ°´ç›¸é€¢`;
    document.getElementById('newFriendEncounterContent').innerHTML = description;
    showDecisionCard('èæ°´ç›¸é€¢', 'fa-handshake', description, options);
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
function befriendNpc(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return;

    npc.lastInteractedTurn = (gameState.date.year * 2) + gameState.date.turn;
    const isOppositeGender = npc.gender !== gameState.player.gender;
    const isMalePlayer = gameState.player.gender === 'male';

    const relType = isOppositeGender
        ? (isMalePlayer ? 'red_confidante' : 'blue_confidante')
        : (isMalePlayer ? 'brother' : 'confidante');

    if (!gameState.social.relationships[npcId]) {
        gameState.social.relationships[npcId] = {
            type: relType,
            favor: npc.favor,
            trust: 10,      
            influence: 0,   
            emotionValue: 20,
            level: 0,        
        };
        
        // â–¼â–¼â–¼ æ ¸å¿ƒä¿®å¤ï¼šç¡®ä¿NPCè¢«æ·»åŠ åˆ°æ­£ç¡®çš„åˆ†ç±»åˆ—è¡¨ä¸­ â–¼â–¼â–¼
        if (relType === 'brother' || relType === 'confidante') {
            if (!gameState.social.friends) gameState.social.friends = [];
            gameState.social.friends.push(npcId);
        }
        // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
    }

    gameState.suitors = gameState.suitors.filter(id => id !== npcId);

    const relData = RELATIONSHIP_DATA[relType];
    showEventCard('å–œå¾—çŸ¥å·±', 'fa-user-friends', `ä½ ç»“è¯†äº†æ–°çš„å‹äºº <strong class="highlight-npc">${npc.name}</strong>ï¼Œä½ ä»¬æˆä¸ºäº†${relData ? relData.name : 'æœ‹å‹'}ã€‚`);
    renderGame();
}
function showMarket() {
    const itemsForSale = [...marketItems.common, ...(marketItems[gameState.player.gender] || [])];
    // ã€æ–°å¢ã€‘è·å–æœ¬å›åˆå·²è´­ä¹°ç‰©å“åˆ—è¡¨
    const boughtThisTurn = gameState.flags.marketItemsBoughtThisTurn || [];
    
    let html = `<p>å¸‚é›†ä¸Šäººæ¥äººå¾€ï¼Œçƒ­é—¹éå‡¡ã€‚ä½ å¯ä»¥ä¹°åˆ°å„ç§ç‰©å“ã€‚</p>`;
    html += itemsForSale.map(item => {
        const canAfford = gameState.finances.wealth >= item.price;
        // ã€æ–°å¢ã€‘æ£€æŸ¥æ˜¯å¦å·²è´­ä¹°
        const isBought = boughtThisTurn.includes(item.id);
        const isDisabled = !canAfford || isBought;
        
        return ` <div class="marketplace-item"> 
                    <span><strong>${item.name}</strong>: ${item.desc}</span> 
                    <button class="control-btn" ${isDisabled ? 'disabled' : ''} onclick="buyMarketItem('${item.id}')">
                        ${isBought ? 'æœ¬å›åˆå·²è´­' : `è´­ä¹° (-${item.price}ä¸¤)`}
                    </button> 
                 </div>`;
    }).join('');

    document.getElementById('marketContent').innerHTML = html;
    showOverlay('marketOverlay');
}
function buyMarketItem(itemId) {
    const allItems = [...marketItems.common, ...marketItems.female, ...marketItems.male];
    const item = allItems.find(i => i.id === itemId);
    if (!item) return;

    const cost = item.price || item.cost;
    if (gameState.finances.wealth < cost) {
        showToast("èµ„é‡‘ä¸è¶³ã€‚");
        return;
    }

    if (item.type === 'collectible') {
        buyAsset(item.id);
    } else {
        // ã€æ–°å¢ã€‘å°†ç‰©å“IDæ·»åŠ åˆ°å·²è´­åˆ—è¡¨
        if (!gameState.flags.marketItemsBoughtThisTurn) gameState.flags.marketItemsBoughtThisTurn = [];
        gameState.flags.marketItemsBoughtThisTurn.push(itemId);

        applyEffects({ wealth: -cost });
        if (item.effect) {
            applyEffects({ attributes: item.effect });
        }
        
        let effectText = item.effect ? Object.entries(item.effect).map(([k,v]) => `${ATTR_MAP[k]}+${v}`).join('ï¼Œ') : '';
        
        showEventCard(
            'æ”¶å…¥å›Šä¸­', 
            'fa-shopping-bag', 
            `ä½ èŠ±è´¹ <span class='value'>${cost}</span> ä¸¤ï¼Œåœ¨å¸‚é›†è´­ä¹°äº† <strong class='value'>${item.name}</strong>ã€‚<br>${effectText}`,
            // ã€ä¿®æ”¹ã€‘å›è°ƒå‡½æ•°ç°åœ¨ä¼šåˆ·æ–°å¸‚é›†ç•Œé¢ï¼Œä»¥æ˜¾ç¤ºæŒ‰é’®çš„ç¦ç”¨çŠ¶æ€
            [{ text: 'å¿ƒæ»¡æ„è¶³', callback: showMarket }]
        );
    }
}
function showRestaurant() {
    let html = `<h4><i class="fas fa-user-friends"></i> å®´è¯·ä»–äºº</h4>`;
    let peopleToInvite = [
    // å…ˆæŠŠé…å¶åŠ è¿›æ¥
    gameState.marriage.isMarried ? gameState.npcs[gameState.marriage.spouseId] : null, 
    ...Object.values(gameState.family.members).map(id => gameState.npcs[id]),
    ...gameState.social.friends.map(id => gameState.npcs[id]),
    ...gameState.suitors.map(id => gameState.npcs[id])
].filter(p => p && !p.isDead);

// ä¸ºäº†é˜²æ­¢é‡å¤ï¼Œä½¿ç”¨Setå»é‡
const uniqueIds = new Set(peopleToInvite.map(p => p.id));
peopleToInvite = Array.from(uniqueIds).map(id => gameState.npcs[id]).slice(0, 5);

    if (peopleToInvite.length > 0) {
        html += `<div class="options">`;
        peopleToInvite.forEach(person => {
            html += `<button class="option" onclick="treatToMeal('${person.id}')"><i class="fas fa-user"></i> å®´è¯· ${person.role || ''} ${person.name}</button>`;
        });
        html += `</div>`;
    } else { html += `<p class="comment">æš‚æ— å¯å®´è¯·ä¹‹äººã€‚</p>`; }

    html += `<h4 style="margin-top:20px;"><i class="fas fa-utensils"></i> ç‚¹èœè‡ªç”¨</h4>`;
    html += restaurantMenu.map(item => {
        const canAfford = gameState.finances.wealth >= item.price;
        return `<div class="marketplace-item">
            <span><strong>${item.name}</strong>: ${item.desc}</span>
            <button class="control-btn" ${!canAfford ? 'disabled' : ''} onclick="buyRestaurantItem('${item.id}')">ç‚¹èœ (-${item.price}ä¸¤)</button>
        </div>`;
    }).join('');

    document.getElementById('restaurantContent').innerHTML = html;
    showOverlay('restaurantOverlay');
}
function treatToMeal(npcId) {
    const person = gameState.npcs[npcId];
    if(!person) return;
    const cost = restaurantMenu.find(m=>m.id==='banquet').price;
    if (gameState.finances.wealth < cost) { showToast("èµ„é‡‘ä¸è¶³ã€‚"); return; }

    person.lastInteractedTurn = (gameState.date.year * 2) + gameState.date.turn;
    applyEffects({ wealth: -cost, relationship: { targetId: person.id, favor: getRandomInt(5, 10) } });

    let relationshipText = `ä½ ä¸ ${person.name} å®¾ä¸»å°½æ¬¢ï¼Œå¥½æ„Ÿæå‡äº†ã€‚`;
    if(person.role && (person.role.includes('çˆ¶') || person.role.includes('æ¯'))) {
        relationshipText = `ä½ å­æ•¬çˆ¶æ¯ï¼Œä»–ä»¬çš„å¥½æ„Ÿæå‡äº†ã€‚`;
        applyEffects({attributes: {virtue: 2}});
    }
    showEventCard('å®´è¯·å®¾å®¢', 'fa-utensils', `ä½ èŠ±è´¹ <span class='value'>${cost}</span> ä¸¤ä¸¾åŠå®´å¸­ã€‚${relationshipText}`);
renderGame(); 
    showRestaurant();
}
// [æ›¿æ¢] æ‰¾åˆ°è¿™ä¸ªå‡½æ•°å¹¶ç”¨ä¸‹é¢çš„ä»£ç å®Œæ•´æ›¿æ¢
function buyRestaurantItem(itemId) {
    const item = restaurantMenu.find(i => i.id === itemId);
    if (!item || gameState.finances.wealth < item.price) { 
        showToast("èµ„é‡‘ä¸è¶³ã€‚"); 
        return; 
    }

    // [æ–°å¢] é»„é‡‘è–¯æ¡çš„ç‰¹æ®Šé€»è¾‘
    if (itemId === 'golden_fries') {
        if (gameState.flags.ateGoldenFriesThisTurn) {
            showToast("æ­¤ç‰©è™½å¥½ï¼Œä¸å¯è´ªå¤šï¼Œä¸‹å›åˆå†æ¥å§ã€‚");
            return;
        }
        gameState.flags.ateGoldenFriesThisTurn = true;
        // ä¸ºèŒä¸šåŠŸç»©åŠ æˆ
        if (gameState.career.path) {
            gameState.career.performance = (gameState.career.performance || 0) + item.effect.performance;
        }
        // ä¸ºåŸºç¡€å±æ€§åŠ æˆ
        applyEffects({ wealth: -item.price, attributes: { talent: item.effect.talent, martial: item.effect.martial } });
        showEventCard('å¼‚åŸŸçé¦', 'fa-utensils', `ä½ äº«ç”¨äº†é»„é‡‘è–¯æ¡ï¼Œæ„Ÿè§‰æµ‘èº«å……æ»¡äº†åŠ›é‡ï¼åŠŸç»©+${item.effect.performance}ï¼Œæ‰æƒ…+${item.effect.talent}ï¼Œæ­¦å­¦+${item.effect.martial}ã€‚`);

    } else {
        // åŸæœ‰çš„æ™®é€šèœå“é€»è¾‘
        applyEffects({ wealth: -item.price, attributes: item.effect });
        showEventCard('ä¸€é¥±å£ç¦', 'fa-utensils', `ä½ äº«ç”¨äº†${item.name}ï¼Œå¿ƒæƒ…æ„‰æ‚¦ã€‚`);
    }
}
function showClinic() {
    let html = ``;
    if (gameState.status.disease) {
        const d = diseases[gameState.status.disease.id];
        html += `<h4><i class="fas fa-procedures"></i> å½“å‰ç—…æƒ…</h4>
                <p>ä½ æ‚£ä¸Šäº†<strong style="color:red;">${d.name}</strong>ï¼Œè¿˜å‰© ${gameState.status.disease.duration} å›åˆç—Šæ„ˆã€‚æ¯å›åˆå¥åº·-${d.health_decline}ã€‚</p>
                <h4><i class="fas fa-user-md"></i> å¯»åŒ»é—®è¯</h4>`;
        html += famousDoctors.map(doc => {
            const canAfford = gameState.finances.wealth >= doc.fee;
            return `<div class="marketplace-item">
                <span><strong>${doc.name}</strong>: ${doc.desc}</span>
                <button class="control-btn" ${!canAfford ? 'disabled' : ''} onclick="seekTreatment('${doc.name}')">æ±‚è¯Š (-${doc.fee}ä¸¤)</button>
            </div>`;
        }).join('');
    } else {
        html += `<h4><i class="fas fa-stethoscope"></i> å¥åº·æ£€æŸ¥</h4>
                <p>ä½ ç›®å‰èº«ä½“åº·å¥ï¼Œä½†ä¹Ÿå¯ä»¥èŠ±è´¹ <span class='value'>50</span> ä¸¤è¿›è¡Œä¸€æ¬¡å¥åº·æ£€æŸ¥ï¼Œå·©å›ºå…ƒæ°”ã€‚</p>
                <button class="option" onclick="healthCheck()"><i class="fas fa-heartbeat"></i> è¿›è¡Œå¥åº·æ£€æŸ¥</button>`;
    }
    document.getElementById('clinicContent').innerHTML = html;
    showOverlay('clinicOverlay');
}
function healthCheck() {
    const cost = 50;
    if (gameState.finances.wealth < cost) { showToast("èµ„é‡‘ä¸è¶³ã€‚"); return; }
    applyEffects({ wealth: -cost, attributes: { health: 5 } });
    showEventCard('èº«ä½“åº·å¥', 'fa-heartbeat', 'ä½ è¿›è¡Œäº†å¥åº·æ£€æŸ¥ï¼Œæ„Ÿè§‰èº«ä½“æ›´åŠ ç¡¬æœ—äº†ã€‚');
}
function seekTreatment(doctorName) {
    const doctor = famousDoctors.find(d => d.name === doctorName);
    const diseaseInfo = gameState.status.disease;
    if (!doctor || !diseaseInfo || gameState.finances.wealth < doctor.fee) { showToast("èµ„é‡‘ä¸è¶³ã€‚"); return; }

    applyEffects({ wealth: -doctor.fee });
    const disease = diseases[diseaseInfo.id];
    const cureChance = disease.initial_cure_chance + doctor.success_rate_bonus - ((gameState.player.age-20)*0.005);
    let resultText = '';
    if (Math.random() < cureChance) {
        resultText = `<strong class='value'>${doctor.name}</strong>æœç„¶åä¸è™šä¼ ï¼Œè¯åˆ°ç—…é™¤ï¼ä½ çš„<strong class='value'>${disease.name}</strong>å·²è¢«æ²»æ„ˆã€‚`;
        gameState.status.disease = null;
    } else {
        resultText = `è¿<strong class='value'>${doctor.name}</strong>ä¹Ÿå¯¹ä½ çš„ç—…ç—‡æŸæ‰‹æ— ç­–ï¼Œåªæ˜¯å¼€äº†ä¸€äº›ç¼“è§£ç—‡çŠ¶çš„è¯ç‰©ã€‚`;
    }
    showEventCard("ğŸ©º è¯Šç–—ç»“æœ ğŸ©º", "fa-file-medical", `ä½ èŠ±è´¹ <span class='value'>${doctor.fee}</span> ä¸¤æ±‚åŒ»ã€‚<br>${resultText}`);
    renderGame();
}
function handleDisease() {
    if (!gameState.status.disease && Math.random() < 0.05) {
        const diseaseKeys = Object.keys(diseases).filter(k => diseases[k].source !== 'intimate');
        const randomDiseaseKey = getRandomElement(diseaseKeys);
        gameState.status.disease = { id: randomDiseaseKey, duration: diseases[randomDiseaseKey].duration };
        showEventCard('èº«ä½“æŠ±æ™', 'fa-thermometer-half', `ä½ è¿‘æ¥æ„Ÿåˆ°èº«ä½“ä¸é€‚ï¼Œä¼¼ä¹æ˜¯æŸ“ä¸Šäº†<strong style="color:red;">${diseases[randomDiseaseKey].name}</strong>ã€‚`);
        return;
    }

    if (!gameState.status.disease) return;
    const dInfo = gameState.status.disease;
    const d = diseases[dInfo.id];
    dInfo.duration--;
    applyEffects({ attributes: { health: -d.health_decline, charm: -1 } });
    showToast(`${d.name}ä½¿ä½ æ„Ÿåˆ°è™šå¼±, å¥åº·-${d.health_decline}`);

    const deathChance = d.death_chance + (gameState.player.health < 20 ? 0.1 : 0);
    if (deathChance > 0 && Math.random() < deathChance) {
        logEvent(`ä½ ç»ˆç©¶æ²¡èƒ½æ‰›è¿‡<strong class='value'>${d.name}</strong>çš„æŠ˜ç£¨ï¼Œç—…æ•…äº†ã€‚`);
        showEndGame({ title: "è´«ç—…äº¤åŠ ", text: `ä½ å› ç—…å»ä¸–ï¼Œå¹´ä»…${Math.floor(gameState.player.age)}å²ã€‚` });
        return;
    }

    if (dInfo.duration <= 0) {
        showEventCard('å¤§ç—…åˆæ„ˆ', 'fa-sun', `ä½ çš„<strong class='value'>${d.name}</strong>ç»ˆäºè‡ªæ„ˆäº†ï¼Œä½†èº«ä½“è¿˜æ˜¯è™šå¼±äº†ä¸å°‘ã€‚`);
        gameState.status.disease = null;
    }
}
function showWishingWell() {
    const options = [
        {htmlContent:`<i class="fas fa-leaf"></i> è¿›å…¥ç§˜å¢ƒ`, callback: () => enterWishingWell()},
        {htmlContent:`<i class="fas fa-times"></i> è½¬èº«ç¦»å¼€`, style:`background: linear-gradient(135deg, #e74c3c, #c0392b);`, callback: () => closeAllOverlays()}
    ];
    showDecisionCard("ä»™æ± ç§˜å¢ƒ", "âœ¨", `<p>ä½ æ— æ„ä¸­æ­¥å…¥ä¸€å¤„ä»™æ°”ç¼­ç»•çš„ç§˜å¢ƒï¼Œä¸­å¤®æœ‰ä¸€å£å¤äº•ï¼Œä¼¼ä¹æ•£å‘ç€å¥‡å¼‚çš„å…‰èŠ’ã€‚äº•è¾¹çŸ³ç¢‘ä¸Šåˆ»ç€å­—ï¼šâ€œæŠ•æ±ä¸‰æˆä¹‹è´¢ï¼Œåœ†æ±ä¸€æ„¿ã€‚â€</p>`, options);
}
function enterWishingWell() {
    const cost = Math.floor(gameState.finances.wealth * 0.3);
    if (gameState.finances.wealth < 100) { showToast("ä½ çš„è´¢å¯Œä¸è¶³ä»¥å¼•èµ·ä»™æ± çš„æ³¨æ„ã€‚"); closeAllOverlays(); return; }

    let options = wishingWellItems.map(item => {
        return {
            htmlContent:`<span class="option-text"><strong>${item.name}</strong><div><small>${item.desc}</small></div></span>`,
            callback: () => buyWishingWellItem(item.id)
        };
    });

    showDecisionCard(
        'ä»™æ± çŒ®ç¤¼', 'âœ¨',
        `ä½ å‘äº•ä¸­æŠ•å…¥äº† <span class='value'>${cost}</span> ä¸¤ï¼Œäº•æ°´æ³›èµ·æ¶Ÿæ¼ªï¼Œæµ®ç°å‡ºå‡ æ ·å®ç‰©ã€‚è¯·é€‰æ‹©ä½ çš„æ„¿æœ›ï¼š`,
        options
    );
}

function buyWishingWellItem(itemId) {
    const item = wishingWellItems.find(i => i.id === itemId);
    if (!item) return;
    const cost = Math.floor(gameState.finances.wealth * 0.3);
    applyEffects({ wealth: -cost });
    let logText = `ä½ èŠ±è´¹ <span class='value'>${cost}</span> ä¸¤ï¼Œä»è®¸æ„¿æ± ä¸­è·å¾—äº† <strong class='value'>${item.name}</strong>ï¼`;

    if (item.effect.career_progress) {
        if (gameState.career.path) {
            gameState.career.performance += item.effect.career_progress;
            logText += " ä¸€è‚¡ç¥ç§˜çš„åŠ›é‡åŠ æŒåœ¨ä½ èº«ä¸Šï¼Œä½ çš„åŠŸç»©å¤§å¹…æå‡äº†ã€‚";
            checkForPromotion();
        } else {
            logText += " ä½ è¿˜æœªæŠ•èº«äº‹ä¸šï¼Œç¬¦å’’çš„åŠ›é‡æš‚æ—¶å‚¨å­˜äº†èµ·æ¥ã€‚";
        }
    } else if (item.effect.partner_favor) {
        const targetId = gameState.marriage.isMarried ? gameState.marriage.spouseId : (gameState.suitors.map(id => gameState.npcs[id]).sort((a, b) => b.favor - a.favor)[0]?.id || null);
        if (targetId) {
            applyEffects({
                relationship: {
                    targetId: targetId,
                    favor: item.effect.partner_favor
                }
            });
            logText += ` ä½ å°†åŒå¿ƒç»“èµ äºˆäº† <strong class="highlight-npc">${gameState.npcs[targetId].name}</strong>ï¼Œå¯¹æ–¹å¥½æ„Ÿå¤§å¢ï¼`;
        } else {
            logText += " ä½ ç›®å‰æ²¡æœ‰å¿ƒä¸Šäººï¼ŒåŒå¿ƒç»“è¢«ä½ çè—äº†èµ·æ¥ã€‚";
        }
    }
    // ===================== ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸã€‘ START =====================
    else if (item.effect.reputation) {
        // ã€æ–°å¢ä»£ç ã€‘ä¸“é—¨å¤„ç†å£°æœ›
        applyEffects({
            reputation: item.effect.reputation
        });
        logText += ` ä½ çš„å®¶æ—å£°æœ›å¤§å¹…æå‡äº†ï¼`;
    }
    // ===================== ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸã€‘ END =====================
    else {
        applyEffects({
            attributes: item.effect
        });
        logText += ` ä½ çš„${Object.keys(item.effect).map(k => ATTR_MAP[k]).join('')}å±æ€§å¤§å¹…æå‡äº†ï¼`;
    }
    showEventCard('ä»™æ± èµç¦', 'âœ¨', logText);
}
// =======================================================================
// ============================= SECRET RELATIONSHIPS ====================
// =======================================================================
function interactWithNpc(npcId, action) {
    const npc = gameState.npcs[npcId];
    if (!npc || npc.isDead) return;


    npc.lastInteractedTurn = (gameState.date.year * 2) + gameState.date.turn;
    let favorChange = 0; 
    let emotionValueChange = 0;
    let logText = '';

    switch (action) {
        case 'chat':
            favorChange = getRandomInt(1, 4);
            emotionValueChange = getRandomInt(5, 8);
            logText = `ä½ ä¸${npc.name}é—²èŠç‰‡åˆ»ï¼Œç›¸è«‡ç”šæ¬¢ã€‚`;
            break;
        case 'date':
            if(gameState.finances.wealth < 100) { showToast("èµ„é‡‘ä¸è¶³ä»¥å®‰æ’ä¸€æ¬¡åƒæ ·çš„çº¦ä¼š"); return; }
            applyEffects({wealth: -100});
            showDateScene(npc);
            return; 
    }

    if (favorChange !== 0 || emotionValueChange !== 0) {
        applyEffects({ 
            relationship: { 
                targetId: npcId, 
                favor: favorChange, 
                emotionValue: emotionValueChange
            } 
        });
        logText += ` å¥½æ„Ÿ+${favorChange}ã€‚`;
    }

    if (logText) showEventCard('äººé™…äº’åŠ¨', 'fa-users', logText);

    showNPCDetails(npcId);
}

// â–¼â–¼â–¼ è¯·åœ¨interactWithNpcå‡½æ•°åï¼Œã€æ–°å¢ã€‘ä»¥ä¸‹æ‰€æœ‰å‡½æ•° â–¼â–¼â–¼
function handleSocialInteraction(npcId, relType, interactionId) {
    const npc = gameState.npcs[npcId];
    const player = gameState.player;
    const relData = RELATIONSHIP_DATA[relType];
    const interaction = relData ? relData.interactions.find(i => i.id === interactionId) : null;
    
    if (!npc || !interaction) {
        showToast("äº’åŠ¨æ•°æ®é”™è¯¯");
        return;
    }

    const rel = gameState.social.relationships[npcId];
    if (rel) {
        rel.emotionValue = (rel.emotionValue || 0) + getRandomInt(5, 10);
        rel.eventsExperienced = (rel.eventsExperienced || 0) + 1;
    }

    switch (interactionId) {
        case 'moon_drink': {
            showDecisionCard('æœˆä¸‹å¯¹é¥®', 'fa-wine-glass-alt',
                `æ˜æœˆå½“ç©ºï¼Œ<strong class="highlight-npc">${npc.name}</strong>é‚€ä½ å°é…Œï¼Œå¸­é—´è°ˆåŠäººç”Ÿç†æƒ³ä¸é—æ†¾ã€‚`,
                [
                    { htmlContent: 'ã€å€¾è¯‰å¿ƒå£°ã€‘', callback: () => {
                        showEventCard('æ¨å¿ƒç½®è…¹', 'fa-heart', 'ä½ çš„çœŸè¯šæ‰“åŠ¨äº†å¯¹æ–¹ã€‚å¥½æ„Ÿ+10ï¼Œæƒ…æ„Ÿå€¼+15ã€‚');
                        if(rel) rel.emotionValue += 15;
                        applyEffects({ relationship: { targetId: npcId, favor: 10 } });
                    }},
                    { htmlContent: 'ã€å€Ÿé…’è°ƒä¾ƒã€‘', callback: () => {
                        if (player.attributes.charm >= 70) {
                            showEventCard('é£è¶£çš„å›åº”', 'fa-grin-wink', 'ä½ é£è¶£çš„è°ƒä¾ƒè®©å¯¹æ–¹èå°”ä¸€ç¬‘ã€‚å¥½æ„Ÿ+15ã€‚');
                            applyEffects({ relationship: { targetId: npcId, favor: 15 } });
                        } else {
                            showEventCard('å°´å°¬çš„ç©ç¬‘', 'fa-meh', 'ä½ çš„è°ƒä¾ƒç•¥æ˜¾è½»æµ®ï¼Œå¯¹æ–¹çš±äº†çš±çœ‰ã€‚å¥½æ„Ÿ-5ã€‚');
                            applyEffects({ relationship: { targetId: npcId, favor: -5 } });
                        }
                    }}
                ]
            );
            break;
        }
        case 'become_lover': {
     showDecisionCard('è·¨è¶Šç•Œçº¿', 'fa-fire',
        `åœ¨ä¸€ä¸ªæ°”æ°›æš§æ˜§çš„å¤œæ™šï¼Œä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> ä¹‹é—´ä¼¼ä¹æœ‰ä»€ä¹ˆä¸œè¥¿å°†è¦æ”¹å˜...`,
        [
            { htmlContent: 'ã€é¡ºå…¶è‡ªç„¶ã€‘', callback: () => {
                rel.type = 'lover';
                rel.level = 0;
                rel.emotionValue = 50;
                showEventCard('æƒ…æ„«æš—ç”Ÿ', 'fa-heart-broken', 'ä½ ä»¬è·¨è¶Šäº†çŸ¥å·±çš„ç•Œçº¿ï¼Œæˆä¸ºç§˜å¯†æƒ…äººã€‚');
                showNPCDetails(npcId); // <<-- æ–°å¢è¿™ä¸€è¡Œï¼Œç”¨äºåœ¨çŠ¶æ€æ›´æ–°åç«‹åˆ»åˆ·æ–°NPCè¯¦æƒ…å¡
            }},
                    { htmlContent: 'ã€æ‚¬å´–å‹’é©¬ã€‘', callback: () => {
                        showEventCard('åšå®ˆåº•çº¿', 'fa-hand-paper', 'ä½ åŠæ—¶å…‹åˆ¶ä½äº†è‡ªå·±ã€‚å¥½æ„Ÿ-10ï¼Œå“å¾·+10ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: -10 }, attributes: { virtue: 10 } });
                    }}
                ]
            );
            break;
        }
        case 'rendezvous':
            showEventCard('æœˆä¸‹ä¹‹çº¦', 'fa-kiss-wink-heart', 'ä½ ä»¬åœ¨æœˆå½±èŠ±é¦™ä¸­äº’è¯‰è¡·è‚ ï¼Œæƒ…æ„æ›´æµ“ã€‚å¥½æ„Ÿ+20ã€‚');
            applyEffects({ relationship: { targetId: npcId, favor: 20 } });
            if(Math.random() < 0.2) triggerBirth(npcId, true);
            break;
    }

    updateRelationshipLevel(npcId);
    showNPCDetails(npcId);
}

// ===================== ã€ç¬¬ä¸€æ­¥(2/2)ï¼šæ›¿æ¢æ­¤å‡½æ•°ã€‘ä¿®å¤å…³ç³»ç­‰çº§åˆ¤å®šé€»è¾‘ =====================
function updateRelationshipLevel(npcId, forceUpgrade = false) {
    const rel = gameState.social.relationships[npcId];
    if (!rel) return;
    
    // [ä¿®æ”¹] æ ¹æ®å…³ç³»ç±»å‹åŠ¨æ€é€‰æ‹©æ­£ç¡®çš„ç­‰çº§æ•°æ®ï¼Œå¹¶å¢åŠ å®‰å…¨æ£€æŸ¥
    const relDataDefinition = RELATIONSHIP_DATA[rel.type];
    if (!relDataDefinition) {
        // å¦‚æœå…³ç³»ç±»å‹æœªåœ¨ RELATIONSHIP_DATA ä¸­å®šä¹‰ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œé¿å…é”™è¯¯
        return; 
    }
    
    const levelDataType = relDataDefinition.type;
    const levelData = RELATIONSHIP_LEVELS[levelDataType] || RELATIONSHIP_LEVELS.friendship;

    let newLevel = rel.level || 0;

    for (let i = levelData.length - 1; i >= 0; i--) {
        if ((rel.emotionValue || 0) >= levelData[i].threshold) {
            newLevel = i;
            break;
        }
    }

    if (forceUpgrade) {
        newLevel = Math.min(levelData.length - 1, (rel.level || 0) + 1);
    }
    
    if (newLevel > (rel.level || 0)) {
        rel.level = newLevel;
        // [ä¿®æ”¹] ç¡®ä¿èƒ½ä»æ­£ç¡®çš„å®šä¹‰ä¸­è·å–ç­‰çº§åç§°
        const newLevelName = (relDataDefinition.levelNames && relDataDefinition.levelNames[newLevel]) || levelData[newLevel].name;
        showEventCard('å…³ç³»å‡å', 'fa-level-up-alt', `ä½ ä¸ <strong class="highlight-npc">${gameState.npcs[npcId].name}</strong> çš„å…³ç³»æå‡ä¸º <strong class="value">${newLevelName}</strong>ï¼`);
    } else if (newLevel < (rel.level || 0)) {
        rel.level = newLevel;
        const newLevelName = (relDataDefinition.levelNames && relDataDefinition.levelNames[newLevel]) || levelData[newLevel].name;
        showEventCard('å…³ç³»é™çº§', 'fa-level-down-alt', `ä½ ä¸ <strong class="highlight-npc">${gameState.npcs[npcId].name}</strong> çš„å…³ç³»é™çº§ä¸º <strong class="value">${newLevelName}</strong>ã€‚`);
    }
}

function checkForSecretLoverDiscovery() {
    if (gameState.social.secretLovers.length === 0 || !gameState.marriage.isMarried) return;
    const discoveryChance = 0.05 * gameState.social.secretLovers.length;
    if (Math.random() < discoveryChance) {
        const lover = getRandomElement(gameState.social.secretLovers.map(id => gameState.npcs[id]));
        const spouse = gameState.npcs[gameState.marriage.spouseId];
        let content = `ä½ ä¸ <strong class="highlight-npc">${lover.name}</strong> çš„ç§æƒ…ä¸æ…è¢«åºœå†…ä¸«é¬Ÿæ’è§å‘Šå¯†ï¼Œ <strong class="highlight-npc">${spouse.name}</strong> ä¼¤å¿ƒè½æ³ªï¼`;
        let options = [
            {htmlContent:`<i class="fas fa-money-bill-wave"></i> èŠ±é’±å®‰æŠš`, callback: () => handleConfrontation('bribe', lover.id)},
            {htmlContent:`<i class="fas fa-heart-broken"></i> å†³ç»å’Œç¦»`, callback: () => handleConfrontation('divorce', lover.id)},
        ];
        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤ç‚¹ã€‘å°†ç›´æ¥æ˜¾ç¤ºå¼¹çª—æ”¹ä¸ºæ¨å…¥äº‹ä»¶é˜Ÿåˆ— â–¼â–¼â–¼
        eventQueue.push(() => {
            showDecisionCard('âš¡ï¸ ä¸œçª—äº‹å‘ âš¡ï¸', 'ğŸ’”', content, options);
        });
        // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
    }
}
// =======================================================================
// ===================== ã€æ–°åŠŸèƒ½ã€‘ç¤¾äº¤äº’åŠ¨ç”Ÿæˆå‡½æ•° START =====================
// =======================================================================
// =======================================================================
// ===================== ã€æ–°åŠŸèƒ½ä»£ç ã€‘ç¤¾äº¤ç©æ³•å‡½æ•° START =====================
// =======================================================================
// ===================== ã€æ›¿æ¢ã€‘generateNpcActionButtons å‡½æ•° START =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function generateNpcActionButtons(npc) {
    const { id: npcId, favor } = npc;
    const player = gameState.player;
    const rel = gameState.social.relationships[npcId];
    let actions = [];

    // --- äº’åŠ¨æ¡ä»¶åˆ¤æ–­ ---
    const canSwearOath = rel && player.gender === npc.gender && ['brother', 'confidante', 'red_confidante', 'blue_confidante'].includes(rel.type) && favor >= 80 && player.attributes.virtue >= 20 && !npc.personality.some(p => ['å‡‰è–„', 'è…¹é»‘'].includes(p));
    const canConfess = rel && player.gender !== npc.gender && ['red_confidante', 'blue_confidante'].includes(rel.type) && favor >= 60;
    const canPropose = player.gender !== npc.gender && favor >= 80 && player.age >= 16 && !gameState.marriage.isMarried && (gameState.suitors.includes(npcId) || canConfess);
    
    if (rel && rel.type === 'former_apprentice') {
        if (player.gender === npc.gender && favor >= 90) {
            actions.push({ id: 'become_sworn_sibling', name: 'ä¹‰ç»“é‡‘å…°', icon: 'fa-hands-helping', available: true, relType: rel.type });
        }
        if (player.gender !== npc.gender && favor >= 95 && !gameState.marriage.isMarried) {
            actions.push({ id: 'propose', name: 'æäº²', icon: 'fa-ring', available: true, style: 'background: linear-gradient(135deg, #e74c3c, #c0392b);' });
        }
        if (player.gender !== npc.gender && favor >= 85) {
            actions.push({ id: 'become_lover', name: 'å‘å±•ä¸ºæƒ…äºº', icon: 'fa-mask', available: true });
        }
    }

    // --- æ ¹æ®æ¡ä»¶ç”ŸæˆæŒ‰é’® ---
    if (canConfess) {
        actions.push({ id: 'start_confession', name: 'çº¢ç¬ºå¯„æƒ…', icon: 'fa-pen-fancy', available: true });
    }

    // åŸºç¡€äº’åŠ¨æŒ‰é’®
    actions.push({ id: 'chat', name: 'äº¤è°ˆ', icon: 'fa-comments', available: true });
    actions.push({ id: 'giveGift', name: 'èµ ç¤¼', icon: 'fa-gift', available: true });

    if (favor >= 50) {
        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘å°†æ—§çš„è¯—è¯é—®ç­”æ›¿æ¢ä¸ºæ–°çš„ä¿ƒè†é•¿è°ˆå°æ¸¸æˆ â–¼â–¼â–¼
        actions.push({ id: 'conversation_game', name: 'ä¿ƒè†é•¿è°ˆ', icon: 'fa-heart', available: true });
        // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
        if (npc.attributes.wisdom >= 60) {
            actions.push({ id: 'go_game', name: 'æ‰‹è°ˆå¯¹å¼ˆ', icon: 'fa-chess', available: true });
        }
        if (player.attributes.talent >= 50) {
            actions.push({ id: 'guzheng_game', name: 'æŠšç´ä¸€æ›²', icon: 'fa-music', available: true });
        }
    }

    const friendsCount = Object.keys(gameState.social.relationships).filter(id => id !== npcId && gameState.npcs[id] && !gameState.npcs[id].isDead).length;
    actions.push({ id: 'gathering', name: 'å‘èµ·èšä¼š', icon: 'fa-users', available: friendsCount > 0 && favor > 40 });

    actions.push({ 
        id: 'askPreference', 
        name: player.gender === 'male' ? 'æ‰“å¬æ¶ˆæ¯' : 'æ—æ•²ä¾§å‡»', 
        icon: 'fa-search', 
        available: npc.preferences && !npc.preferences.known && favor > 20 
    });

    if (canSwearOath) {
        actions.push({ id: 'become_sworn_sibling', name: 'ä¹‰ç»“é‡‘å…°', icon: 'fa-hands-helping', available: true, relType: rel.type });
    }

    if (canPropose) {
        actions.push({ id: 'propose', name: 'æäº²', icon: 'fa-ring', available: true, style: 'background: linear-gradient(135deg, #e74c3c, #c0392b);' });
    }

    if (gameState.marriage.isMarried && gameState.marriage.spouseId === npcId) {
        actions.push({ id: 'divorce', name: 'å’Œç¦»', icon: 'fa-heart-broken', available: true, style: 'background: linear-gradient(135deg, #a9a9a9, #696969);' });
    }

    if (gameState.career.path === 'spy_master' && gameState.career.level >= 2) {
        const hasIntelligence = gameState.inventory.some(item => {
            const itemDef = ITEM_DATA[item.id];
            return itemDef && itemDef.type === 'æ–‡ä¹¦';
        });
        if (hasIntelligence) {
            actions.unshift({
                id: 'use_intelligence', 
                name: 'è¿ç”¨æƒ…æŠ¥', 
                icon: 'fa-user-secret', 
                available: true,
                style: 'background: linear-gradient(135deg, #8e44ad, #9b59b6);'
            });
        }
    }

    return actions.slice(0, 9);
}

// ===================== ã€æ–°åŠŸèƒ½ä»£ç ã€‘ç¤¾äº¤ç©æ³•å‡½æ•° END =======================
function handleConfrontation(choice, loverId) {
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if (choice === 'bribe') {
        const bribeAmount = Math.floor(gameState.finances.wealth * 0.5);
        if (gameState.finances.wealth < bribeAmount || bribeAmount < 1000) {
            showEventCard('ä¸œçª—äº‹å‘', '', "ä½ è¯•å›¾èŠ±é’±äº†äº‹ï¼Œä½†è´¢åŠ›ä¸è¶³ï¼Œå¯¹æ–¹ä¸ä¸ºæ‰€åŠ¨ï¼Œåšå†³è¦ä¸ä½ å’Œç¦»ã€‚");
            confirmDivorce();
        } else {
            // ä¿®å¤: ç¡®ä¿ favor åœ¨ 0 åˆ° 100 ä¹‹é—´
            applyEffects({ wealth: -bribeAmount, relationship: {targetId: spouse.id, favor: Math.max(0, spouse.favor - 50)} });
            showEventCard('ç ´è´¢æ¶ˆç¾', 'fa-shield-alt', `ä½ èŠ±è´¹äº† <span class="value">${bribeAmount}</span> ä¸¤å·¨æ¬¾ï¼Œæ€»ç®—å°†æ­¤äº‹å‹ä¸‹ï¼Œä½†ä½ ä¸ <strong class="highlight-npc">${spouse.name}</strong> çš„æ„Ÿæƒ…å·²åå­˜å®äº¡ã€‚`);
        }
    } else { confirmDivorce(); }
}
// =======================================================================
// ============================= FENG YUE JIAN ===========================
// =======================================================================
// ã€ä¿®å¤ & æ›¿æ¢ã€‘showFengYueJian å‡½æ•°
function showFengYueJian() {
    const content = document.getElementById('fengYueJianContent');
    let html = '';
    const canInteract = (npc) => !npc.isDead && npc.relationship > 20 && !gameState.social.secretLovers.includes(npc.id) && npc.id !== gameState.marriage.spouseId;

    if (gameState.player.gender === 'female') {
        html += '<p class="comment">èº«ä¸ºè´µå¥³ï¼Œåœ¨æ­¤å¤„ç»“äº¤å¼‚æ€§çŸ¥å·±ï¼Œéœ€å¾—ä¸‡åˆ†è°¨æ…ï¼Œä»¥å…å¼•ç«çƒ§èº«ã€‚</p>';
        const potentialLovers = Object.values(gameState.npcs).filter(npc => npc.gender === 'male' && canInteract(npc));
        if (potentialLovers.length > 0) {
            potentialLovers.forEach(npc => {
                html += `
                    <div class="suitor" onclick="proposeSecretLover('${npc.id}')">
                        <div class="suitor-avatar-wrapper" style="background:${getAvatarGradient(npc.id)}"><span class="suitor-avatar-text">${npc.name.charAt(0)}</span></div>
                        <div class="suitor-details">
                            <div class="suitor-name">${npc.name}</div>
                            <div class="suitor-desc">${npc.title || 'èº«ä»½ç¥ç§˜'}</div>
                            <div class="suitor-stats">
                                <span class="stat"><i class="fas fa-heart"></i> å¥½æ„Ÿ: ${npc.relationship}</span>
                                <span class="stat"><i class="fas fa-user-secret"></i> é­…åŠ›: ${npc.attributes.charm}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        } else {
            html += '<p class="comment">æš‚æ— å¯äº’åŠ¨çš„çŸ¥å·±ã€‚</p>';
        }
    } else { // ç”·æ€§è§’è‰²é€»è¾‘
        html += '<p class="comment">èº«ä¸ºç”·å­ï¼Œå‡ºå…¥é£æœˆåœºæ‰€éœ€èŠ±è´¹ç”šå·¨ï¼Œè¿˜éœ€è°¨æ…ã€‚</p>';
        const potentialLovers = Object.values(gameState.npcs).filter(npc => npc.gender === 'female' && canInteract(npc));
        if (potentialLovers.length > 0) {
            potentialLovers.forEach(npc => {
                 // ä¸ºç”·æ€§ç©å®¶å¢åŠ é‡‘é’±åˆ¤å®š
                const cost = 100 + Math.floor(npc.attributes.charm * 2);
                html += `
                    <div class="suitor" onclick="if(gameState.finances.wealth >= ${cost}) { proposeSecretLover('${npc.id}', ${cost}); } else { showToast('é“¶é’±ä¸è¶³ï¼'); }">
                        <div class="suitor-avatar-wrapper" style="background:${getAvatarGradient(npc.id)}"><span class="suitor-avatar-text">${npc.name.charAt(0)}</span></div>
                        <div class="suitor-details">
                            <div class="suitor-name">${npc.name}</div>
                            <div class="suitor-desc">${npc.title || 'èº«ä»½ç¥ç§˜'}</div>
                            <div class="suitor-stats">
                                <span class="stat"><i class="fas fa-heart"></i> å¥½æ„Ÿ: ${npc.relationship}</span>
                                <span class="stat"><i class="fas fa-user-secret"></i> é­…åŠ›: ${npc.attributes.charm}</span>
                                <span class="stat"><i class="fas fa-money-bill-wave"></i> èŠ±è´¹: ${cost}ä¸¤</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        } else {
            html += '<p class="comment">æš‚æ— å¯äº’åŠ¨çš„çº¢é¢œã€‚</p>';
        }
    }
    content.innerHTML = html;
    showOverlay('fengYueJianOverlay');
}

function proposeSecretLover(npcId, cost = 0) {
    const npc = gameState.npcs[npcId];
    const successChance = (gameState.player.attributes.charm + npc.relationship) / 200;

    if (gameState.player.gender === 'male') {
        applyEffects({ wealth: -cost });
        logEvent(`ä½ ä¸º ${npc.name} æ·ä¸‹åƒé‡‘ï¼ˆ-${cost}ä¸¤ï¼‰ï¼Œä»¥åšçº¢é¢œä¸€ç¬‘ã€‚`);
    }

    if (Math.random() < successChance) {
        gameState.social.secretLovers.push(npcId);
        npc.relationship += 20; // æˆä¸ºæƒ…äººå¢åŠ å¥½æ„Ÿ
        logEvent(`ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> äº’ç”Ÿæƒ…æ„«ï¼Œæˆä¸ºç§˜å¯†æƒ…äººã€‚`, true);
        showEventCard("æƒ…æŠ•æ„åˆ", "fa-heart", `ä½ ä¸ ${npc.name} çš„å…³ç³»æ›´è¿›ä¸€æ­¥ï¼Œä½ ä»¬æˆä¸ºäº†ç§˜å¯†æƒ…äººã€‚`);
    } else {
        npc.relationship -= 10;
        logEvent(`ä½ è¯•å›¾ä¸ <strong class="highlight-npc">${npc.name}</strong> å‘å±•æ›´æ·±çš„å…³ç³»ï¼Œä½†è¢«å©‰æ‹’äº†ã€‚`, true);
        showEventCard("ç¼˜åˆ†æœªåˆ°", "fa-heart-broken", `${npc.name} å©‰æ‹’äº†ä½ çš„å¿ƒæ„ï¼Œæˆ–è®¸ä½ ä»¬çš„ç¼˜åˆ†è¿˜æœªåˆ°ã€‚`);
    }
    closeAllOverlays();
    renderGame();
}
// ã€ä¿®å¤ä¸€ã€‘è¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢æ‚¨æ–‡ä»¶ä¸­çš„ showFengYueJian å‡½æ•°
// 
function showFengYueJian(isForGossip = false, targetNpcId = null) {
    if (gameState.player.gender !== 'male') {
        // ä¸ºå¥³æ€§ç©å®¶ä¿ç•™åŸæœ‰çš„â€œç»“äº¤çŸ¥å·±â€é€»è¾‘
        openFengYueJian();
        return;
    }
    if (gameState.finances.wealth < fengYueJianData.entry_cost && !isForGossip) {
        showToast("å›Šä¸­ç¾æ¶©ï¼Œè¿é—¨éƒ½è¿›ä¸å»ã€‚");
        return;
    }
    // å¦‚æœä¸æ˜¯ä¸ºäº†æ‰“å¬æ¶ˆæ¯ï¼Œæ‰æ‰£é—¨ç¥¨è´¹
    if (!isForGossip) {
        applyEffects({ wealth: -fengYueJianData.entry_cost });
        gameState.flags.brothelVisitCount = (gameState.flags.brothelVisitCount || 0) + 1;
    }
    // å¦‚æœåªæ˜¯ä¸ºäº†æ‰“å¬æ¶ˆæ¯ï¼Œç›´æ¥è°ƒç”¨äº’åŠ¨å‡½æ•°å¹¶è¿”å›ï¼Œä¸æ˜¾ç¤ºé£æœˆé‰´ç•Œé¢
    if (isForGossip && targetNpcId) {
        interactWithHongYi('gossip', targetNpcId);
        return;
    }
    
    let html = `<p>æœ±æ¼†å¤§é—¨ï¼Œéé‡‘ç‰ŒåŒ¾ï¼Œä¸Šä¹¦â€˜é£æœˆé‰´â€™ä¸‰å­—ã€‚ç”«ä¸€è¸å…¥ï¼Œæš–é¦™æ‰‘é¢ï¼Œä¸ç«¹ç®¡å¼¦ä¹‹å£°ä¸ç»äºè€³ã€‚ç®¡äº‹çº¢å§¨æ»¡é¢å †ç¬‘åœ°è¿ä¸Šå‰æ¥ï¼šâ€˜å“Ÿï¼Œè¿™ä½å…¬å­ï¼Œå¿«é‡Œè¾¹è¯·ï¼â€™</p>`;
    html += `<div class="section-header"><i class="fas fa-comments"></i> ä¸çº¢å§¨äº¤è°ˆ</div>
             <div class="options">
                <button class="option" onclick="interactWithHongYi('gossip')"><i class="fas fa-comment-dots"></i> <span class="option-text">æ‰“å¬æ¶ˆæ¯<div><small>-30ä¸¤</small></div></span></button>
                <button class="option" onclick="interactWithHongYi('recommend')"><i class="fas fa-user-check"></i> <span class="option-text">å¼•èä½³äºº<div><small>-100ä¸¤</small></div></span></button>
                 <button class="option" onclick="interactWithHongYi('drink')"><i class="fas fa-wine-glass-alt"></i> <span class="option-text">æµ…é…Œå¬æ›²<div><small>-20ä¸¤</small></div></span></button>
             </div>`;
    html += `<div class="section-header"><i class="fas fa-fan"></i> é‚€çº¦ä½³äºº</div>`;
    
    const courtesans = fengYueJianData.courtesans.map(c => gameState.npcs[c.id]).filter(c => c && !c.isRedeemed);
    
    if (courtesans.length > 0) {
        // â–¼â–¼â–¼ æ ¸å¿ƒä¿®å¤ç‚¹ â–¼â–¼â–¼
        // æ­¤å¤„å°†åŸæœ‰çš„ renderNpcCard è°ƒç”¨ï¼Œæ”¹ä¸ºç›´æ¥ç”Ÿæˆå¸¦æ­£ç¡®ç‚¹å‡»äº‹ä»¶çš„å¡ç‰‡HTML
        html += courtesans.map(c => {
            const courtesanData = c.baseData; // ä»NPCå¯¹è±¡ä¸­è·å–åŸºç¡€å®šä¹‰
            const cost = 100 + Math.floor(c.attributes.charm * 2);
            // ç›´æ¥ä½¿ç”¨ renderNpcCard æ¥ä¿æŒæ ·å¼ç»Ÿä¸€ï¼Œä½†ä¸ºå…¶åŒ…è£¹ä¸€ä¸ªå¸¦æ­£ç¡® onclick çš„ div
            return `<div onclick="showCourtesanDetails('${c.id}')">${renderNpcCard(c.id)}</div>`;
        }).join('');
        // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²
    } else {
        html += `<p class="comment">é£æœˆé‰´çš„ä½³äººä»¬éƒ½å·²åèŠ±æœ‰ä¸»ã€‚</p>`;
    }
    
    document.getElementById('fengYueJianContent').innerHTML = html;
    
    const overlay = document.getElementById('fengYueJianOverlay');
    if (!overlay.style.display || overlay.style.display === 'none') {
        showOverlay('fengYueJianOverlay');
    }
}
// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢] interactWithHongYi å‡½æ•°
function interactWithHongYi(action, targetNpcId = null) {
    let cost = 0, logText = "", icon = "fa-comments", title = "çº¢å§¨é—²è°ˆ";
    switch (action) {
        case 'gossip':
            cost = 30;
            if (gameState.finances.wealth < cost) {
                showToast("æ‰“å¬æ¶ˆæ¯éœ€è¦30ä¸¤ï¼Œä½ çš„é’±ä¸å¤Ÿã€‚");
                return;
            }

            if (targetNpcId && gameState.npcs[targetNpcId]) {
                const targetNpc = gameState.npcs[targetNpcId];
                applyEffects({ wealth: -cost });
                targetNpc.preferences.known = true;
                showEventCard('æ‰“æ¢æˆåŠŸ', 'fa-check', `ä½ èŠ±è´¹ ${cost} ä¸¤ï¼Œä»çº¢å§¨å£ä¸­æˆåŠŸæ¢çŸ¥äº† ${targetNpc.name} çš„å–œå¥½ã€‚`);
                closeAllOverlays();
                showNPCDetails(targetNpcId);
                return;
            } else {
                // ã€ä¿®å¤ã€‘ä»å…«å¦åº“ä¸­éšæœºè·å–ä¸€æ¡å…«å¦
                logText = `ä½ ä»çº¢å§¨é‚£å„¿å¬åˆ°äº†ä¸€åˆ™å…«å¦ï¼š â€œ${getRandomElement(GOSSIP_DATA)}â€`;
                applyEffects({ attributes: { wisdom: 1 } });
            }
            break;
        case 'recommend':
            cost = 100;
            if (gameState.finances.wealth < cost) { showToast("å¼•èä½³äººéœ€è¦100ä¸¤ï¼Œä½ çš„é’±ä¸å¤Ÿã€‚"); return; }
            const available = fengYueJianData.courtesans.map(c=>gameState.npcs[c.id]).filter(c => c && !c.isRedeemed);
            if(available.length > 0) {
                const npc = getRandomElement(available);
                applyEffects({relationship:{targetId:npc.id, favor:5}});
                logText = `çº¢å§¨ä¸ºä½ å¼•èäº† <strong class="highlight-npc">${npc.name}</strong>ï¼Œä½ ä»¬ç›¸è°ˆç”šæ¬¢ï¼ŒTAå¯¹ä½ çš„å¥½æ„Ÿæå‡äº†ã€‚`;
                title="å¾—é‡ä½³äºº"; icon="fa-user-check";
            } else {
                logText = "çº¢å§¨è¯´ï¼Œå¦‚ä»Šæ¥¼é‡Œçš„å§‘å¨˜ä»¬éƒ½å¿™ç€å‘¢ï¼Œè®©ä½ ç¨åå†æ¥ã€‚";
                cost = 0; // æ²¡æ¨èäººï¼Œä¸æ”¶è´¹
            }
            break;
        case 'drink':
            cost = 20;
            if (gameState.finances.wealth < cost) { showToast("æµ…é…Œå¬æ›²éœ€è¦20ä¸¤ï¼Œä½ çš„é’±ä¸å¤Ÿã€‚"); return; }
            logText = "ä½ æµ…é…Œå¬æ›²ï¼Œä¸ç«¹æ‚¦è€³ï¼Œå¿ƒæƒ…èˆ’ç•…ã€‚";
            applyEffects({attributes:{charm:1, talent:1}});
            title="æµ…é…Œå¬æ›²"; icon="fa-wine-glass-alt";
            break;
    }

    if (cost > 0) {
        applyEffects({ wealth: -cost });
        showEventCard(title, icon, logText);
    }
}
function showCourtesanDetails(courtesanId) {
    const courtesan = gameState.npcs[courtesanId];
    const data = courtesan.baseData;
    if (!courtesan || !data) return;

    let interactionsHTML = `<div class="section-header"><i class="fas fa-hand-holding-heart"></i> æ·±å…¥äº¤æµ</div><div class="options">`;
    fengYueJianData.interactions.forEach(inter => {
        interactionsHTML += `<button class="option" ${gameState.finances.wealth<inter.cost ? 'disabled' : ''} onclick="interactWithCourtesan('${courtesan.id}', '${inter.id}')">
            <i class="fas fa-hand-holding-heart"></i> <span class="option-text">${inter.name}<div><small>-${inter.cost}ä¸¤</small></div></span>
        </button>`;
    });

    if (courtesan.favor >= fengYueJianData.sleep.unlock_favor) {
        const cost = courtesan.firstIntimateCost;
        interactionsHTML += `<button class="option" ${gameState.finances.wealth<cost ? 'disabled' : ''} style="background:linear-gradient(135deg, #e74c3c, #c0392b);" onclick="interactWithCourtesan('${courtesan.id}', 'sleep')">
            <i class="fas fa-moon"></i> <span class="option-text">å…±åº¦è‰¯å®µ<div><small>-${cost}ä¸¤</small></div></span>
        </button>`;
    }
    if (courtesan.favor >= fengYueJianData.redeem.unlock_favor) {
        interactionsHTML += `<button class="option" ${gameState.finances.wealth<data.redemption_cost ? 'disabled' : ''} onclick="interactWithCourtesan('${courtesan.id}', 'redeem')">
            <i class="fas fa-file-invoice-dollar"></i><span class="option-text">ä¸ºå¥¹èµèº«<div><small>-${data.redemption_cost}ä¸¤</small></div></span>
        </button>`;
    }
    interactionsHTML += `</div>`;

    document.getElementById('fengYueJianContent').innerHTML = `
        <button class="control-btn" style="margin-bottom:20px;" onclick="showFengYueJian()"> <i class="fas fa-arrow-left"></i> è¿”å›åˆ—è¡¨</button>
        ${renderNpcCard(courtesanId)}
        <div class="attribute" style="margin-top:20px;">
            ${renderAttributeBar('å¥½æ„Ÿåº¦', courtesan.favor, 'charm-fill', 'fa-heart', 100)}
        </div>
        ${interactionsHTML}
    `;
    showOverlay('fengYueJianOverlay'); // Re-show overlay
}

// ===================== ã€æ›¿æ¢ç”¨ã€‘interactWithCourtesan å‡½æ•° START =====================
function interactWithCourtesan(courtesanId, action) {
    const courtesan = gameState.npcs[courtesanId];
    if (!courtesan) return;

    // èµèº«æ˜¯ç‰¹æ®Šé€»è¾‘ï¼Œä¿æŒä¸å˜
    if (action === 'redeem') {
        const cost = courtesan.baseData.redemption_cost;
        if (gameState.finances.wealth < cost) { showToast("èµ„é‡‘ä¸è¶³"); return; }
        applyEffects({ wealth: -cost });
        courtesan.isRedeemed = true;

        let options = [{ htmlContent: `<i class="fas fa-home"></i> é‡‘å±‹è—å¨‡`, callback: () => handleRedemptionChoice(courtesan.id, 'hide') }];
        if (gameState.marriage.isMarried && gameState.marriage.concubines.length < 5) {
            options.unshift({ htmlContent: `<i class="fas fa-users"></i> çº³ä¸ºå¦¾å®¤`, callback: () => handleRedemptionChoice(courtesan.id, 'concubine') });
        } else if (!gameState.marriage.isMarried) {
            options.unshift({ htmlContent: `<i class="fas fa-ring"></i> è¿å¨¶ä¸ºå¦»`, callback: () => handleRedemptionChoice(courtesan.id, 'marry') });
        }
        showDecisionCard('é‡‘é’—è„±ç±', '', `ä½ èŠ±è´¹å·¨èµ„ä¸º <strong class="highlight-npc">${courtesan.name}</strong> è„±å»äº†è´±ç±ã€‚æ¥ä¸‹æ¥ï¼Œä½ æ‰“ç®—...`, options);
        return;
    }

    // å¤„ç†å¸¦æˆæœ¬çš„äº’åŠ¨
    const interactionData = fengYueJianData.interactions.find(i => i.id === action);
    let cost = 0;
    if (interactionData) {
        cost = interactionData.cost;
    } else if (action === 'sleep') {
        cost = courtesan.firstIntimateCost;
    }
    if (gameState.finances.wealth < cost) {
        showToast("èµ„é‡‘ä¸è¶³");
        return;
    }
    if(cost > 0) {
        applyEffects({ wealth: -cost });
    }

    // --- æ–°å¢çš„å‰§æƒ…ç³»ç»Ÿé€»è¾‘ ---
    const eventPool = COURTESAN_INTERACTION_EVENTS[action];
    if (eventPool && eventPool.length > 0) {
        const possibleEvents = eventPool.filter(event => {
            if (!event.req) return true;
            return Object.entries(event.req).every(([key, value]) => (gameState.player.attributes[key] || 0) >= value);
        });

        if (possibleEvents.length > 0) {
            const event = getRandomElement(possibleEvents);

            if (action === 'sleep') {
                // â€œå…±åº¦è‰¯å®µâ€ç›´æ¥æ˜¾ç¤ºç»“æœ
                courtesan.firstIntimateCost = Math.floor(courtesan.firstIntimateCost * fengYueJianData.sleep.subsequent_cost_factor);
                let effectsToApply = { relationship: { targetId: courtesanId } };
                if(event.effects.favor) effectsToApply.relationship.favor = event.effects.favor;
                if(event.effects.charm) effectsToApply.attributes = { charm: event.effects.charm };
                if(event.effects.health) effectsToApply.attributes = { ...(effectsToApply.attributes || {}), health: event.effects.health };
                if(event.effects.virtue) effectsToApply.attributes = { ...(effectsToApply.attributes || {}), virtue: event.effects.virtue };
                if(event.effects.wisdom) effectsToApply.attributes = { ...(effectsToApply.attributes || {}), wisdom: event.effects.wisdom };
                if(event.effects.talent) effectsToApply.attributes = { ...(effectsToApply.attributes || {}), talent: event.effects.talent };

                applyEffects(effectsToApply);
                showEventCard('æ˜¥å®µä¸€åˆ»', 'fa-moon', event.desc);
                
                if (Math.random() < 0.3) {
                    gameState.status.disease = { id: 'syphilis', duration: diseases['syphilis'].duration };
                    showEventCard('èº«ä½“æŠ±æ™', 'fa-thermometer-half', 'ä½ æ„Ÿåˆ°èº«ä½“ä¸é€‚ï¼Œä¼¼ä¹æŸ“ä¸Šäº†éš¾ä»¥å¯é½¿çš„<strong style="color:red;">æ¢…ç—…</strong>...');
                }

            } else {
                // å…¶ä»–äº’åŠ¨æ˜¾ç¤ºé€‰é¡¹
                const options = event.options.map(opt => {
                    let canSelect = true;
                    let reason = "";
                    if (opt.req) {
                        if (opt.req.talent && (gameState.player.attributes.talent || 0) < opt.req.talent) {
                            canSelect = false; reason = `(æ‰æƒ…ä¸è¶³)`;
                        }
                        if (opt.req.wisdom && (gameState.player.attributes.wisdom || 0) < opt.req.wisdom) {
                            canSelect = false; reason = `(æ™ºæ…§ä¸è¶³)`;
                        }
                        if (opt.req.charm && (gameState.player.attributes.charm || 0) < opt.req.charm) {
                            canSelect = false; reason = `(é­…åŠ›ä¸è¶³)`;
                        }
                    }
                    if (opt.cost && gameState.finances.wealth < opt.cost) {
                        canSelect = false; reason = `(èµ„é‡‘ä¸è¶³)`;
                    }

                    return {
                        htmlContent: `<span class="option-text">${opt.text} ${reason}</span>`,
                        disabled: !canSelect,
                        callback: () => {
                            if (opt.cost) applyEffects({ wealth: -opt.cost });
                            if (opt.effects) {
                                let effectsToApply = { relationship: { targetId: courtesanId, favor: opt.effects.favor || 0 } };
                                if(opt.effects.player_talent) effectsToApply.attributes = { talent: opt.effects.player_talent };
                                if(opt.effects.player_virtue) effectsToApply.attributes = { ...(effectsToApply.attributes || {}), virtue: opt.effects.player_virtue };
                                applyEffects(effectsToApply);
                            }
                            showEventCard(event.title, 'fa-comments', opt.log);
                            showCourtesanDetails(courtesanId);
                        }
                    };
                });
                showDecisionCard(event.title, 'fa-comments', event.desc, options);
            }
            return;
        }
    }
    
    // å¦‚æœæ²¡æœ‰è§¦å‘ç‰¹æ®Šå‰§æƒ…ï¼Œæ‰§è¡Œé»˜è®¤çš„ç®€å•åé¦ˆ
    if (interactionData) {
        applyEffects({ relationship: { targetId: courtesanId, favor: getRandomInt(interactionData.favor[0], interactionData.favor[1]) } });
        showToast(`${courtesan.name}å¯¹ä½ çš„å¥½æ„Ÿæå‡äº†ã€‚`);
    }

    showCourtesanDetails(courtesanId);
}
// ===================== ã€æ›¿æ¢ç”¨ã€‘interactWithCourtesan å‡½æ•° END =====================// [æ›¿æ¢]
// [æ›¿æ¢æ­¤å‡½æ•°]
function handleRedemptionChoice(courtesanId, choice) {
    const courtesan = gameState.npcs[courtesanId];
    courtesan.source = 'fyj'; 
    if (choice === 'concubine') {
        acquireConcubine(courtesanId);
    } else if (choice === 'marry') {
        marrySuitor(courtesanId);
    } else { // hide
        // ã€æ ¸å¿ƒä¿®å¤ã€‘é‡å†™èƒŒå›åˆ¤å®šé€»è¾‘
        let betrayalChance = 0.35; // åŸºç¡€35%èƒŒå›ç‡
        betrayalChance -= (gameState.player.attributes.charm / 500); // ç©å®¶é­…åŠ›è¶Šé«˜ï¼Œè¶Šä¸å®¹æ˜“èƒŒå› (æœ€é«˜-0.4)
        betrayalChance += ((courtesan.ambition || 40) / 200); // å¯¹æ–¹é‡å¿ƒè¶Šé«˜ï¼Œè¶Šå®¹æ˜“èƒŒå› (æœ€é«˜+0.5)
        betrayalChance -= (courtesan.favor / 250); // å¥½æ„Ÿåº¦è¶Šé«˜ï¼Œè¶Šä¸å®¹æ˜“èƒŒå› (æœ€é«˜-0.4)
        betrayalChance = Math.max(0.05, betrayalChance); // æœ€ä½ä»æœ‰5%çš„é£é™©

        if (Math.random() < betrayalChance) {
            const loss = Math.floor(gameState.finances.wealth * 0.5);
            applyEffects({wealth: -loss});
            showEventCard('äººå»æ¥¼ç©º', 'fa-heart-broken', `ä½ å°†${courtesan.name}å®‰ç½®åœ¨åˆ«é™¢ï¼Œä½†ä¸ä¹…åå¥¹ä¾¿äººå»æ¥¼ç©ºï¼Œè¿˜å·èµ°äº†ä½  <span class='value'>${loss}</span> ä¸¤ã€‚`);
            courtesan.isDead = true;
        } else {
            gameState.social.secretLovers.push(courtesanId);
            courtesan.relationship = 'lover';
            showEventCard('é‡‘å±‹è—å¨‡', 'fa-home', `ä½ å°†${courtesan.name}å®‰ç½®åœ¨åŸå¤–åˆ«é™¢ï¼Œæ—¶å¸¸å‰å»ç§ä¼šã€‚`);

            if (gameState.marriage.isMarried && gameState.marriage.spouseId) {
                const spouse = gameState.npcs[gameState.marriage.spouseId];
                if (spouse) {
                    spouse.suspicionValue = (spouse.suspicionValue || 0) + 15; 
                    logEvent(`ä½ é‡‘å±‹è—å¨‡çš„è¡Œä¸ºè®©ä½ é…å¶çš„ç–‘å¿ƒå¤§å¹…å¢åŠ äº†ã€‚`);
                }
            }
        }
        closeAllOverlays(); 
    }
    renderGame();
}
function interactWithConcubine(concubineId, action) {
    const concubine = gameState.npcs[concubineId];
    if (!concubine || concubine.isDead) return;

    concubine.lastInteractedTurn = (gameState.date.year * 2) + gameState.date.turn;

   if (action === 'chat') {
        const favorGain = getRandomInt(2, 5);
        // ä½¿ç”¨ applyEffects ç»Ÿä¸€å¤„ç†
        applyEffects({ relationship: { targetId: concubineId, favor: favorGain } }); // <--- ä¿®æ”¹ä¸ºæ­¤è¡Œ
        showEventCard('å¦¾å®¤é—²è°ˆ', 'fa-comments', `ä½ ä¸å¦¾å®¤${concubine.name}é—²èŠç‰‡åˆ»ï¼Œå¥¹çœ‹èµ·æ¥å¾ˆå¼€å¿ƒã€‚å¥½æ„Ÿ+${favorGain}`);
    } else if (action === 'gift') {
        const giftCostStr = prompt(`è¯·è¾“å…¥è¦èµ äºˆ${concubine.name}çš„é‡‘é¢ï¼š`, "100");
        const cost = parseInt(giftCostStr);
        if(isNaN(cost) || cost <= 0) return;
        if(gameState.finances.wealth < cost) {
            showToast("ä½ çš„ç§äº§ä¸è¶³ã€‚");
            return;
        }
        const favorGain = Math.floor(cost / 15) + getRandomInt(1, 3);
        applyEffects({ wealth: -cost, relationship: { targetId: concubineId, favor: favorGain } });
        showEventCard('èµ ç¤¼', 'fa-gift', `ä½ èŠ±è´¹ ${cost} ä¸¤ä¸ºå¦¾å®¤${concubine.name}é€ä¸Šç¤¼ç‰©ï¼Œå¥¹å¯¹ä½ æ›´äº²è¿‘äº†ã€‚å¥½æ„Ÿ+${favorGain}`);
    } else if (action === 'sleep') {
        applyEffects({ relationship: { targetId: concubineId, favor: getRandomInt(5, 12) } });
        triggerBirth(concubineId);
    }
    showNPCDetails(concubineId);
}

function handleBecomeSwornSibling(npcId) {
    const cost = 200;
    if (gameState.finances.wealth < cost) {
        showToast("ç»“æ‹œä»ªå¼éœ€è¦200ä¸¤ï¼Œä½ çš„é’±ä¸å¤Ÿã€‚");
        return;
    }
    applyEffects({ wealth: -cost });
    const swornType = gameState.player.gender === 'male' ? 'ä¹‰å…„å¼Ÿ' : 'ä¹‰å§å¦¹';
    gameState.social.relationships[npcId].type = 'sworn_sibling';
    if (!gameState.social.swornSiblings) {
        gameState.social.swornSiblings = [];
    }
    if (!gameState.social.swornSiblings.includes(npcId)) {
        gameState.social.swornSiblings.push(npcId);
    }
    showEventCard('ä¹‰ç»“é‡‘å…°', 'fa-hands-helping', `ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> ç„šé¦™ç»“æ‹œï¼Œä»æ­¤ç¥¸ç¦ä¸å…±ï¼Œæˆä¸ºç”Ÿæ­»ä¸ç¦»çš„${swornType}ï¼`);
    showNPCDetails(npcId);
}

// =======================================================================
// ===================== ã€å·²ä¿®å¤ã€‘ç‰¹æ®Šäº’åŠ¨æ ¸å¿ƒé€»è¾‘ =======================
// =======================================================================

// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬å®Œæ•´æ›¿æ¢æ—§çš„ handleSpecialInteraction å‡½æ•°]
// ===================== ã€ç¬¬ä¸‰æ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function handleSpecialInteraction(npcId, actionId) {
    const npc = gameState.npcs[npcId];
    const player = gameState.player;
    if (!npc) return;

    // ä¸æƒ…äººäº’åŠ¨ä¼šå¢åŠ é…å¶çš„ç–‘å¿ƒå€¼ (ä¿ç•™åŸåŠŸèƒ½)
    if (gameState.marriage.isMarried && gameState.marriage.spouseId) {
        const spouse = gameState.npcs[gameState.marriage.spouseId];
        if (spouse) {
            spouse.suspicionValue = (spouse.suspicionValue || 0) + getRandomInt(3, 7);
            logEvent(`ä½ ä¸<strong class="highlight-npc">${npc.name}</strong>çš„äº²å¯†äº’åŠ¨è®©ä½ æœ‰äº›å¿ƒè™šï¼Œä½ é…å¶çš„ç–‘å¿ƒå¢åŠ äº†ã€‚`);
        }
    }

    switch(actionId) {
        case 'love_token': // å®šæƒ…ä¿¡ç‰© (ä¿ç•™åŸåŠŸèƒ½)
            if (gameState.finances.wealth < 500) { showToast("ä½ æ²¡æœ‰è¶³å¤Ÿçš„é’±å‡†å¤‡ä¸€ä»½åƒæ ·çš„ä¿¡ç‰©ã€‚"); return; }
            applyEffects({ wealth: -500 });
            const tokenName = `ä¸${npc.name}çš„å®šæƒ…ä¿¡ç‰©`;
            addItemToInventory(`token_${npcId}`, 1, { name: tokenName, desc: `è§è¯ä½ ä»¬æƒ…è°Šçš„ä¿¡ç‰©ã€‚`, type: 'çå“', icon: 'fa-gem' });
            showEventCard('äº¤æ¢ä¿¡ç‰©', 'fa-gem', `ä½ èŠ±è´¹500ä¸¤ï¼Œä¸${npc.name}äº¤æ¢äº†ä¿¡ç‰©ã€‚`);
            break;

        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸã€‘ â–¼â–¼â–¼
        case 'dating_location': // ç§å¯†çº¦ä¼š (è°ƒç”¨æ–°ç³»ç»Ÿ)
            // 1. ä»æ–°çš„ DATE_LOCATIONS æ•°æ®ä¸­åŠ¨æ€ç”Ÿæˆé€‰é¡¹
            const locationOptions = Object.entries(DATE_LOCATIONS).map(([id, data]) => ({
                htmlContent: `<i class="fas ${data.icon}"></i> ${data.name}`,
                // 2. ç‚¹å‡»åè°ƒç”¨æˆ‘ä»¬æ–°å¢çš„ startDatingScene å‡½æ•°
                callback: () => startDatingScene(npcId, id)
            }));
            showDecisionCard('é€‰æ‹©çº¦ä¼šåœ°ç‚¹', 'fa-map-signs', 'è‰¯è¾°ç¾æ™¯ï¼Œä½ æ‰“ç®—å¸¦TAå»å¾€ä½•å¤„ï¼Ÿ', locationOptions);
            break;
        // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²

        case 'poetry_quiz': // ç§å¯†å°æ¸¸æˆ (ä¿ç•™åŸåŠŸèƒ½)
            startPoetryMiniGame(npcId);
            break;

        case 'intimacy': // ç¼ ç»µ (ä¿ç•™åŸåŠŸèƒ½)
             if (player.gender === 'female') {
                showEventCard('ç¼ ç»µæ‚±æ»', 'fa-moon', `ä½ ä¸${npc.name}å…±åº¦è‰¯å®µ... å“å¾·-2`);
                applyEffects({ attributes: { virtue: -2 }});
                const pregnancyChance = (player.health / 500) + (npc.favor / 1000);
                if (Math.random() < pregnancyChance) {
                    player.isPregnant = true;
                    player.isSecretPregnancy = true;
                    player.pregnancyTurnsLeft = 2;
                    player.biologicalFatherOfUnborn = npcId;
                    showEventCard('ç èƒæš—ç»“', 'fa-baby', 'ä½ å‘ç°è‡ªå·±æœ‰äº†èº«å­•ï¼Œè¿™ç«Ÿæ˜¯æƒ…äººçš„å­©å­ï¼');
                }
            }
            break;

        case 'propose_marriage_lover': // (æƒ…äºº)æäº² (ä¿ç•™åŸåŠŸèƒ½)
            if (!gameState.marriage.isMarried) { marrySuitor(npcId); } 
            else { showToast("ä½ å·²æœ‰å®¶å®¤ã€‚"); }
            break;

        case 'take_as_concubine_lover': // (æƒ…äºº)çº³å¦¾ (ä¿ç•™åŸåŠŸèƒ½)
            if (gameState.marriage.isMarried) { acquireConcubine(npcId); } 
            else { showToast("éœ€å…ˆå¨¶å¦»ã€‚"); }
            break;

        case 'secret_lover_status': // (æƒ…äºº)ç§˜å¯†æƒ…äºº (ä¿ç•™åŸåŠŸèƒ½)
             if (!gameState.social.secretLovers.includes(npcId)) {
                 gameState.social.secretLovers.push(npcId);
             }
             showEventCard('ç§˜å¯†å…³ç³»', 'fa-mask', 'ä½ ä»¬çš„å…³ç³»æ›´åŠ éšç§˜è€Œç¨³å›ºï¼Œä½†ä¹Ÿå¢åŠ äº†è¢«å‘ç°çš„é£é™©ã€‚');
             const spouse = gameState.npcs[gameState.marriage.spouseId];
             if (spouse) {
                 spouse.suspicionValue = (spouse.suspicionValue || 0) + 10;
             }
             break;
        
        default:
            showToast(`ä½ ä¸ ${npc.name} è¿›è¡Œäº†ä¸€æ¬¡ç‰¹åˆ«çš„äº’åŠ¨ã€‚`);
            break;
    }
}
function startPoetryMiniGame(npcId) {
    const quiz = getRandomElement(POETRY_QUIZ_DATA);
    document.getElementById('poetryQuestion').textContent = quiz.question;
    const optionsContainer = document.getElementById('poetryOptions');
    optionsContainer.innerHTML = '';

    const answers = [quiz.answer, ...quiz.options].sort(() => Math.random() - 0.5);
    answers.forEach(ans => {
        const button = document.createElement('button');
        button.className = 'option';
        button.textContent = ans;
        button.onclick = () => {
            if (ans === quiz.answer) {
                showEventCard('å¿ƒæœ‰çµçŠ€', 'fa-check-circle', 'ä½ ç­”å¯¹äº†ï¼å¯¹æ–¹çœ¼ä¸­æ»¡æ˜¯æ¬£èµã€‚æƒ…æ„+15, ç—´æƒ…åº¦+10ã€‚');
                applyEffects({ relationship: { targetId: npcId, favor: 15, devotion: 10 } });
            } else {
                showEventCard('ç¨æœ‰é—æ†¾', 'fa-times-circle', 'ä½ ç­”é”™äº†ï¼Œä¸è¿‡å¯¹æ–¹å¹¶ä¸åœ¨æ„ã€‚');
                applyEffects({ relationship: { targetId: npcId, favor: -2 } });
            }
            closeAllOverlays();
        };
        optionsContainer.appendChild(button);
    });
    showOverlay('poetryQuizOverlay');
}

/**
 * ã€æ–°å¢ã€‘è§¦å‘æƒ…äººä¸“å±äº‹ä»¶çš„æ ¸å¿ƒå‡½æ•°
 * @param {string} loverId - æƒ…äººNPCçš„ID
 * @param {string} eventKey - è¦è§¦å‘çš„äº‹ä»¶åœ¨LOVER_EVENTSä¸­çš„é”®å
 */
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * ã€å·²å‡çº§ã€‘è§¦å‘æƒ…äººä¸“å±äº‹ä»¶çš„æ ¸å¿ƒå‡½æ•° (V2.0 - å…¼å®¹ä¸¤ç§äº‹ä»¶ç±»å‹)
 * @param {string} loverId - æƒ…äººNPCçš„ID
 * @param {string} eventKey - è¦è§¦å‘çš„äº‹ä»¶åœ¨LOVER_EVENTS_EXPANDEDä¸­çš„é”®å
 */
function triggerLoverEvent(loverId, eventKey) {
    const eventData = LOVER_EVENTS_EXPANDED[eventKey];
    if (!eventData) return;

    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤ã€‘åœ¨è¿™é‡Œå¢åŠ åˆ¤æ–­ï¼ŒåŒºåˆ†â€œé€‰æ‹©å‹â€å’Œâ€œé€šçŸ¥å‹â€äº‹ä»¶ â–¼â–¼â–¼
    if (eventData.options && Array.isArray(eventData.options)) {
        // --- è¿™æ˜¯â€œé€‰æ‹©å‹â€äº‹ä»¶çš„å¤„ç†é€»è¾‘ (ä¿ç•™åŸåŠŸèƒ½) ---
        const options = eventData.options.map(opt => {
            let canSelect = true;
            let reqText = '';
            if (opt.req) {
                 for (const attr in opt.req) {
                    const reqVal = opt.req[attr];
                    const playerVal = gameState.finances[attr] || gameState.player.attributes[attr] || 0;
                    if (playerVal < reqVal) {
                        canSelect = false;
                        reqText += `${ATTR_MAP[attr] || attr}â‰¥${reqVal} `;
                    }
                 }
            }
            return {
                htmlContent: `<span class="option-text">${opt.text}${reqText ? `<div><small>(è¦æ±‚: ${reqText})</small></div>` : ''}</span>`,
                disabled: !canSelect,
                callback: () => {
                    let log = opt.log;
                    let effects = { ...opt.effects };
                    if (effects.wealth) applyEffects({ wealth: effects.wealth });
                    if (effects.favor || effects.devotion) {
                        applyEffects({ relationship: { targetId: loverId, favor: effects.favor || 0, devotion: effects.devotion || 0 } });
                    }
                    if (opt.callback) opt.callback(loverId);
                    showEventCard(eventData.title, 'fa-mask', log); // å›¾æ ‡ç»Ÿä¸€ä¸ºæƒ…äººå›¾æ ‡
                    showNPCDetails(loverId);
                }
            };
        });
        showDecisionCard(eventData.title, 'fa-mask', eventData.desc, options);

    } else {
        // --- è¿™æ˜¯ã€æ–°å¢ã€‘çš„â€œé€šçŸ¥å‹â€äº‹ä»¶å¤„ç†é€»è¾‘ ---
        if (eventData.effects) {
            let effectsToApply = {};
            if (eventData.effects.favor || eventData.effects.devotion) {
                effectsToApply.relationship = { 
                    targetId: loverId, 
                    favor: eventData.effects.favor || 0, 
                    devotion: eventData.effects.devotion || 0 
                };
            }
            // å¯ä»¥æ ¹æ®éœ€è¦åœ¨è¿™é‡Œæ·»åŠ å¯¹å…¶ä»–æ•ˆæœï¼ˆå¦‚è´¢å¯Œã€å±æ€§ï¼‰çš„å¤„ç†
            applyEffects(effectsToApply);
        }
        showEventCard(eventData.title, 'fa-mask', eventData.log || eventData.desc);
        showNPCDetails(loverId);
    }
    // â–²â–²â–² ã€ä¿®å¤ç»“æŸã€‘ â–²â–²â–²
}
// å‘½å®šæƒ…äººç³»ç»Ÿ
function checkForFatedLoverEvent() {
    const fatedLoverId = gameState.flags.fatedLoverId;
    if (!fatedLoverId || !gameState.npcs[fatedLoverId]) return;

    const npc = gameState.npcs[fatedLoverId];
    // 1. ä¸»åŠ¨é‚€çº¦
    if (Math.random() < 0.2) { // 20%å‡ ç‡ä¸»åŠ¨é‚€çº¦
        eventQueue.push(() => {
            showEventCard('æ„å¤–ä¹‹çº¦', 'fa-envelope', `<strong class="highlight-npc">${npc.name}</strong> æ´¾äººé€ä¿¡ï¼Œé‚€ä½ ä¸€å™ã€‚ä½ ä»¬åº¦è¿‡äº†ä¸€ä¸ªæ„‰å¿«çš„ä¸‹åˆã€‚æƒ…æ„+5ã€‚`);
            applyEffects({ relationship: { targetId: fatedLoverId, favor: 5 } });
        });
    }

    // 2. ä¸“å±å‰§æƒ…é“¾ (ç¤ºä¾‹)
    const questStep = gameState.flags.fatedLoverQuestStep;
    if (questStep === 0 && npc.role === 'å°†å†›ä¹‹å­' && npc.favor > 50) {
        eventQueue.push(() => {
            showDecisionCard('æ²™åœºä¹‹å¿§', 'fa-shield-alt', `<strong class="highlight-npc">${npc.name}</strong>æ‰¾åˆ°ä½ ï¼Œç¥è‰²å‡é‡ï¼šâ€œçˆ¶äº²å³å°†å‡ºå¾ï¼Œæˆ‘å¿ƒä¸­ç”šæ˜¯æ‹…å¿§ï¼Œå´ä¸çŸ¥èƒ½ä¸ºä»–åšäº›ä»€ä¹ˆã€‚â€`, [
                { htmlContent: 'ã€ä¸ºå…¶æ±‚å¹³å®‰ç¬¦ã€‘', callback: () => {
                    gameState.flags.fatedLoverQuestStep = 1;
                    showEventCard('æ±‚å¾—å¹³å®‰', 'fa-praying-hands', 'ä½ å‰å¾€å¯ºåº™ä¸ºå°†å†›æ±‚å¾—ä¸€æšå¹³å®‰ç¬¦ï¼Œå¹¶äº¤äºˆäº†å¯¹æ–¹ã€‚ç—´æƒ…åº¦+15ã€‚');
                    applyEffects({ relationship: { targetId: fatedLoverId, devotion: 15 } });
                }},
                { htmlContent: 'ã€åˆ†æå†›æƒ…ã€‘', callback: () => {
                    gameState.flags.fatedLoverQuestStep = 1;
                    showEventCard('çº¸ä¸Šè°ˆå…µ', 'fa-map-marked-alt', 'ä½ ä¸ºä»–åˆ†æäº†å†›æƒ…åˆ©å¼Šï¼Œå¯¹æ–¹å¯¹ä½ çš„æ‰æ™ºæ›´ä¸ºé’¦ä½©ã€‚æƒ…æ„+10ã€‚');
                    applyEffects({ relationship: { targetId: fatedLoverId, favor: 10 } });
                }}
            ]);
        });
    }
}

// ä¸ˆå¤«ç–‘å¿ƒå€¼
function updateHusbandSuspicion() {
    if (gameState.player.gender !== 'female' || !gameState.marriage.isMarried) return;
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if (!spouse) return;
    spouse.suspicionValue = spouse.suspicionValue || 0;
    // æ¯æ¬¡ä¸æƒ…äººäº’åŠ¨ï¼Œåœ¨äº’åŠ¨å‡½æ•°é‡Œå¢åŠ ç–‘å¿ƒå€¼
    // æ¯å›åˆæœ‰å‡ ç‡æ ¹æ®ç–‘å¿ƒå€¼è§¦å‘äº‹ä»¶
    if (spouse.suspicionValue > 30 && Math.random() < 0.15) {
        eventQueue.push(() => {
            showDecisionCard('ä¸ˆå¤«çš„è´¨é—®', 'fa-question-circle', `â€œä½ æœ€è¿‘ä¼¼ä¹ä¸é‚£ä½...â€˜æœ‹å‹â€™èµ°å¾—å¾ˆè¿‘ï¼Ÿâ€ å¤«å›çœ‹ä¼¼ä¸ç»æ„åœ°é—®é“ã€‚`, [
                { htmlContent: 'ã€ä»å®¹åº”å¯¹ã€‘', req: { scheming: 70 }, callback: () => {
                    spouse.suspicionValue -= 10;
                    showEventCard('åŒ–è§£å±æœº', 'fa-check-circle', 'ä½ ä»å®¹ä¸è¿«åœ°åº”å¯¹è¿‡å»ï¼Œæš‚æ—¶æ‰“æ¶ˆäº†ä»–çš„ç–‘è™‘ã€‚');
                }},
                { htmlContent: 'ã€æ…Œå¼ æ©é¥°ã€‘', callback: () => {
                    spouse.suspicionValue += 10;
                    showEventCard('æ¬²ç›–å¼¥å½°', 'fa-times-circle', 'ä½ çš„æ…Œå¼ è®©ä»–æ›´åŠ æ€€ç–‘ã€‚');
                }}
            ]);
        });
    }
}

// [æ›¿æ¢æ­¤å‡½æ•°]
function applyEffects(effects, target = gameState.player) {
    if (!target) return;
    let harmonyModifier = 1.0;
    let attributeModifier = 1.0;
    let healthModifier = 0;
    if (target.id === 'player' && gameState.player.gender === 'male') {
        if (gameState.marriage.familyHarmony > 80) {
            harmonyModifier = 1.05;
        } else if (gameState.marriage.familyHarmony < 30) {
            attributeModifier = -5;
            healthModifier = -2;
            if (Math.random() < 0.1) {
                gameState.flags.exhausted = true;
            }
        }
    }
    if (effects.attributes) {
        for (const attr in effects.attributes) {
            let value = effects.attributes[attr];
            if (attr === 'health' && target.id === 'player') {
                target.health = Math.max(0, Math.min(100, (target.health || 0) + value + healthModifier));
            } else if (target.attributes) {
                let currentVal = (target.attributes[attr] || 0) + value;
                if(target.id === 'player' && attributeModifier < 0) {
                    currentVal += attributeModifier;
                }
                target.attributes[attr] = Math.max(0, currentVal); 
            }
        }
    }
    if (effects.wealth) {
        let value = effects.wealth;
        if (harmonyModifier > 1.0 && value > 0) {
            value = Math.floor(value * harmonyModifier);
        }
        gameState.finances.wealth = Math.floor(gameState.finances.wealth + value);
    }
    if(effects.privateAssets) {
        gameState.player.privateAssets = (gameState.player.privateAssets || 0) + effects.privateAssets;
    }
    if (effects.reputation) {
        let value = effects.reputation;
        gameState.family.reputation = (gameState.family.reputation || 0) + value;
    }
    if (effects.relationship && effects.relationship.targetId) {
        const npc = gameState.npcs[effects.relationship.targetId];
        const rel = gameState.social.relationships[effects.relationship.targetId];
        if (npc) {
            if (typeof effects.relationship.favor !== 'undefined') {
                npc.favor = Math.max(-100, Math.min(100, (npc.favor || 0) + effects.relationship.favor));
                if(npc.id === gameState.marriage.spouseId) gameState.marriage.favor = npc.favor;
            }
            if (typeof effects.relationship.devotion !== 'undefined' && rel) {
                rel.devotion = Math.max(0, Math.min(100, (rel.devotion || 0) + effects.relationship.devotion));
            }
            if (rel) {
                if (typeof effects.relationship.trust !== 'undefined') {
                    rel.trust = Math.max(0, Math.min(100, (rel.trust || 0) + effects.relationship.trust));
                }
                if (typeof effects.relationship.influence !== 'undefined') {
                    rel.influence = Math.max(0, Math.min(100, (rel.influence || 0) + effects.relationship.influence));
                }
                if (typeof effects.relationship.emotionValue !== 'undefined') {
                    rel.emotionValue = (rel.emotionValue || 0) + effects.relationship.emotionValue;
                }
                updateRelationshipLevel(effects.relationship.targetId);
            }
        }
    }
    if (effects.marriage) {
        if (effects.marriage.favor) {
            applyEffects({relationship: { targetId: gameState.marriage.spouseId, favor: effects.marriage.favor}});
        }
        if (effects.marriage.emotionValue) {
            const spouseRel = gameState.social.relationships[gameState.marriage.spouseId];
            if(spouseRel) {
                spouseRel.emotionValue = (spouseRel.emotionValue || 0) + effects.marriage.emotionValue;
                updateRelationshipLevel(gameState.marriage.spouseId);
            }
        }
    }
    // ã€æ–°å¢ã€‘å¤„ç†æ¸¸æˆç»“æŸæŒ‡ä»¤
    if (effects.end_game) {
        const age = Math.floor(gameState.player.age);
        const reasonMap = {
            'exile': { title: "æµæ”¾è¾¹ç–†", text: `ä½ å› æˆ˜è´¥è¢«å®šç½ªï¼Œæµæ”¾ä¸‰åƒé‡Œï¼Œæœ€ç»ˆå®¢æ­»å¼‚ä¹¡ï¼Œå¹´ä»…${age}å²ã€‚` },
            'execution': { title: "æ»¡é—¨æŠ„æ–©", text: `ä½ åœ¨æ®‹é…·çš„æ–—äº‰ä¸­å¤±è´¥ï¼Œè¢«æ»¡é—¨æŠ„æ–©ï¼Œå¹´ä»…${age}å²ã€‚` },
            'bankruptcy': { title: "ç©·å›°æ½¦å€’", text: `ä½ å› ç»è¥ä¸å–„è€Œç ´äº§ï¼Œæœ€ç»ˆç©·å›°æ½¦å€’è€Œé€ï¼Œå¹´ä»…${age}å²ã€‚` },
            'emperor': { title: "ä¹äº”ä¹‹å°Š", text: `ä½ é»„è¢åŠ èº«ï¼Œç™»åŸºä¸ºå¸ï¼Œå¼€åˆ›äº†æ–°çš„ç‹æœï¼` },
            'peaceful_retirement': { title: "å¯Œè´µé—²äºº", text: `ä½ æ”¾ä¸‹æƒæŸ„ï¼Œä»æ­¤è¿œç¦»çº·æ‰°ï¼Œä½œä¸ºå¯Œè´µé—²äººå®‰åº¦ä½™ç”Ÿã€‚` },
            'ascended': { title: "ç ´ç¢è™šç©º", text: `ä½ å‹˜ç ´æ­¦é“ä¹‹æï¼Œç ´ç¢è™šç©ºè€Œå»ï¼Œæˆä¸ºæ±Ÿæ¹–ä¸æœ½çš„ä¼ è¯´ã€‚` },
            'imprisoned': { title: "é˜¶ä¸‹ä¹‹å›š", text: `ä½ å› è§¦æ€’å¤©é¢œè¢«æ‰“å…¥å¤©ç‰¢ï¼Œæœ€ç»ˆåœ¨ç‹±ä¸­éƒéƒè€Œç»ˆã€‚` },
            'vanished_queen': { title: "æ— åä¹‹äºº", text: `ä½ æˆåŠŸæŠ¹å»äº†æ‰€æœ‰ç—•è¿¹ï¼Œä»æ­¤æ¶ˆå¤±äºä¸–é—´ï¼Œæˆä¸ºä¸€ä¸ªæ— äººçŸ¥æ™“çš„å½±å­ã€‚` },
            'faked_death': { title: "é‡‘è‰è„±å£³", text: `ä½ æˆåŠŸâ€œå‡æ­»â€è„±èº«ï¼Œæºå·¨æ¬¾è¿œèµ°é«˜é£ï¼Œè·å¾—äº†çœŸæ­£çš„è‡ªç”±ã€‚` },
            'healer_abroad': { title: "ææ—æ— ç•Œ", text: `ä½ å°†åŒ»æœ¯å¸¦å¾€äº†å¼‚å›½ä»–ä¹¡ï¼Œæˆä¸ºè¿æ¥ä¸åŒé‚¦å›½çš„å’Œå¹³æ¡¥æ¢ï¼Œåä¼ åƒå¤ã€‚` }
        };
        showEndGame(reasonMap[effects.end_game] || { title: "äººç”Ÿè½å¹•", text: "ä½ èµ°å®Œäº†ä¸å‡¡çš„ä¸€ç”Ÿã€‚" });
    }
}
function showOverlay(overlayId) {
    document.querySelectorAll('.overlay').forEach(o => o.style.display = 'none');
    const overlay = document.getElementById(overlayId);
    if(overlay) overlay.style.display = 'flex';
}
function closeAllOverlays() {
    document.querySelectorAll('.overlay').forEach(o => o.style.display = 'none');
    document.querySelectorAll('audio[id^="bgm-"]').forEach(audio => {
        if (!audio.paused) {
            audio.pause();
            audio.currentTime = 0;
        }
    });
    if (gameState.miniGame && gameState.miniGame.gameRunning) {
        gameState.miniGame.gameRunning = false;
    }
    
    // å…³é”®é€»è¾‘ï¼šå½“ä¸€ä¸ªå¼¹çª—è¢«å…³é—­åï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯äº‹ä»¶é˜Ÿåˆ—ä¸­çš„ä¸€ç¯
    if (isProcessingEvent) {
        isProcessingEvent = false; // æ ‡è®°å½“å‰äº‹ä»¶å¤„ç†å®Œæ¯•
        // ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨å½“å‰ç‚¹å‡»äº‹ä»¶çš„å †æ ˆå®Œæˆåå†æ‰§è¡Œä¸‹ä¸€ä¸ª
        // è¿™ä¼šå»è°ƒç”¨ processEventQueue() æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªäº‹ä»¶
        setTimeout(() => processEventQueue(document.querySelector('.control-btn.button-loading')), 100);
    }
}
// [æ›¿æ¢] showWeddingOverlay å‡½æ•°
function showWeddingOverlay(groomName, brideName) {
    const groom = (gameState.player.name === groomName) ? gameState.player : gameState.npcs[gameState.marriage.spouseId];
    const bride = (gameState.player.name === brideName) ? gameState.player : gameState.npcs[gameState.marriage.spouseId];

    const guests = Object.values(gameState.social.relationships)
        .map(rel => gameState.npcs[Object.keys(gameState.social.relationships).find(key => gameState.social.relationships[key] === rel)])
        .filter(npc => npc && !npc.isDead && (gameState.social.relationships[npc.id]?.level || 0) >= 2)
        .slice(0, 4);

    let guestsHTML = guests.length > 0 ? guests.map(g => {
        const nameInitial = g.name ? g.name.slice(0, 1) : '?';
        return `
        <div class="wedding-guest">
            <div class="avatar-wrapper">
                <img src="${g.avatar}" class="avatar-image" style="display:block;" data-retries="0" onerror="handleAvatarError(this)">
                <svg class="avatar-svg" viewBox="0 0 100 100" style="display:none;">
                    <circle cx="50" cy="50" r="48" fill="#eee" />
                    <text x="50" y="65" font-family="'Ma Shan Zheng', cursive" font-size="50" fill="#333" text-anchor="middle">${nameInitial}</text>
                </svg>
            </div>
            <div>${g.name}</div>
        </div>`;
    }).join('') : '<p class="comment">æš‚æ— å®¾å®¢è§‚ç¤¼</p>';

    const weddingHTML = `
    <div class="overlay-card">
        <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
        <div class="wedding-stage">
            <div class="overlay-header">ğŸŒ¸ å¤§å©šä¹‹å–œ ğŸŒ¸</div>
            <div class="overlay-animation" style="animation: float 2.5s infinite ease-in-out; font-size: 4rem;">å›</div>
            <div class="overlay-content-wrapper">
                <div class="wedding-couples">
                    <div class="wedding-person">
                        <div class="avatar-wrapper">
                            <img src="${groom.avatar}" class="avatar-image" style="display:block;" data-retries="0" onerror="handleAvatarError(this)">
                            <svg class="avatar-svg" viewBox="0 0 100 100" style="display:none;">
                                <circle cx="50" cy="50" r="48" fill="#add8e6" />
                                <text x="50" y="65" font-family="'Ma Shan Zheng', cursive" font-size="50" fill="white" text-anchor="middle">${groom.name.slice(0, 1)}</text>
                            </svg>
                        </div>
                        <div class="name">${groom.name}</div>
                    </div>
                    <div class="wedding-person">
                        <div class="avatar-wrapper">
                            <img src="${bride.avatar}" class="avatar-image" style="display:block;" data-retries="0" onerror="handleAvatarError(this)">
                             <svg class="avatar-svg" viewBox="0 0 100 100" style="display:none;">
                                <circle cx="50" cy="50" r="48" fill="#ffc0cb" />
                                <text x="50" y="65" font-family="'Ma Shan Zheng', cursive" font-size="50" fill="white" text-anchor="middle">${bride.name.slice(0, 1)}</text>
                            </svg>
                        </div>
                        <div class="name">${bride.name}</div>
                    </div>
                </div>
                <div class="overlay-content">
                    çº¢çƒ›é«˜ç…§ï¼Œå–œæ°”ç›ˆé—¨ã€‚åœ¨äº²å‹çš„è§è¯ä¸‹ï¼Œæ–°äººæ‹œå ‚æˆäº²ï¼Œç»“ä¸ºç™¾å¹´ä¹‹å¥½ï¼Œä»æ­¤ç´ç‘Ÿå’Œé¸£ï¼Œå…±èµ´ç™½é¦–ã€‚
                </div>
                <div class="wedding-guests">
                    <h4>è§‚ç¤¼å®¾å®¢</h4>
                    <div class="guest-list">${guestsHTML}</div>
                </div>
            </div>
            <button class="control-btn" onclick="completeWedding(${guests.length})" style="margin-top: 20px; background: linear-gradient(135deg, #d84381, #c71585);">
                <i class="fas fa-check"></i> ç¤¼æˆ Â· å¼€å¯æ–°ç”Ÿæ´»
            </button>
        </div>
    </div>`;

    document.getElementById('weddingOverlay').innerHTML = weddingHTML;
    showOverlay('weddingOverlay');
}

// [æ–°å¢è¿™ä¸ªå‡½æ•°] å©šç¤¼æµç¨‹ç¬¬äºŒæ­¥ï¼šå®¾å®¢å±•ç¤º
function showWeddingGuests(groomName, brideName, guestIdsJson) {
    const overlay = document.getElementById('weddingOverlay');
    const guestIds = JSON.parse(guestIdsJson);
    const guests = guestIds.map(id => gameState.npcs[id]).filter(Boolean);

    let guestsHTML = guests.length > 0 ? guests.map(g => {
        let specialNote = '';
        // å¦‚æœå®¾å®¢æ˜¯ä½ çš„ç§˜å¯†æƒ…äººï¼Œä¼šæœ‰ä¸€æ®µç‰¹æ®Šæè¿°
        if (gameState.social.secretLovers.includes(g.id)) {
            specialNote = `<small class="comment">(TAçš„çœ¼ç¥æœ‰äº›å¤æ‚...)</small>`;
        }
        return `
        <div class="wedding-guest">
            <div class="avatar-wrapper" style="width:50px; height:50px; border-width:2px;">
                <img src="${g.avatar}" class="avatar-image" style="display:block;">
            </div>
            <div>${g.name}<br>${specialNote}</div>
        </div>`;
    }).join('') : '<p class="comment">æš‚æ— å®¾å®¢è§‚ç¤¼</p>';

    const guestListHTML = `
        <div class="wedding-stage" id="wedding-stage-2">
            <div class="overlay-header">å®¾å®¢ç›ˆé—¨</div>
            <div class="overlay-content">äº²å‹ä»¬çº·çº·å‰æ¥é“è´ºï¼Œé€ä¸Šç¥ç¦ã€‚</div>
            <div class="wedding-guests" style="height: 200px; overflow-y: auto; margin: 15px 0;">
                <div class="guest-list">${guestsHTML}</div>
            </div>
            <button class="control-btn" onclick="showWeddingBanquet('${groomName}', '${brideName}', '${guestIdsJson.replace(/"/g, '\\"')}')">
                <i class="fas fa-glass-cheers"></i> å¼€å®´
            </button>
        </div>
    `;
    // æ›´æ–°å©šç¤¼å¼¹çª—çš„å†…å®¹åˆ°ç¬¬äºŒé˜¶æ®µ
    overlay.querySelector('.overlay-card').innerHTML = guestListHTML;
}

// [æ–°å¢è¿™ä¸ªå‡½æ•°] å©šç¤¼æµç¨‹ç¬¬ä¸‰æ­¥ï¼šå–œå®´ä¸å°æ¸¸æˆ
function showWeddingBanquet(groomName, brideName, guestIdsJson) {
    const overlay = document.getElementById('weddingOverlay');
    const guestIds = JSON.parse(guestIdsJson);
    
    // å–œå®´ç¯èŠ‚ï¼ŒåŒ…å«ä¸€ä¸ªç®€å•çš„å°æ¸¸æˆ
    const banquetHTML = `
        <div class="wedding-stage" id="wedding-stage-3">
            <div class="overlay-header">å–œå®´</div>
            <p>å®´å¸­ä¸Šå®¾ä¸»å°½æ¬¢ï¼Œä½ çš„å¥½å‹ä»¬å‰æ¥æ•¬é…’ï¼Œå¹¶èµ·å“„è®©æ–°äººè¡¨æ¼”ä¸€ä¸ªèŠ‚ç›®ã€‚</p>
            <div class="options" style="flex-direction: column;">
                <button class="option" onclick="handleWeddingPerformance('poem', ${guestIds.length})"><i class="fas fa-pen-fancy"></i> å…±èµ‹ä¸€è¯— (è€ƒéªŒæ‰æƒ…)</button>
                <button class="option" onclick="handleWeddingPerformance('drink', ${guestIds.length})"><i class="fas fa-wine-glass-alt"></i> è¿å¹²ä¸‰æ¯ (è€ƒéªŒå¥åº·)</button>
            </div>
        </div>
    `;
    overlay.querySelector('.overlay-card').innerHTML = banquetHTML;
    
    // åœ¨è¿›å…¥å–œå®´ç¯èŠ‚æ—¶ï¼Œå°±ç»“ç®—è´ºç¤¼
    const giftMoney = guestIds.length * getRandomInt(100, 300);
    if (giftMoney > 0) {
        applyEffects({ wealth: giftMoney });
        showToast(`æ”¶åˆ°å®¾å®¢è´ºç¤¼å…±è®¡ ${giftMoney} ä¸¤ã€‚`);
    }
}

// [æ–°å¢è¿™ä¸ªå‡½æ•°] å¤„ç†å©šç¤¼å°æ¸¸æˆçš„ç»“æœ
function handleWeddingPerformance(type, guestCount) {
    let logText = '';
    if (type === 'poem') {
        if (gameState.player.attributes.talent > 50) {
            logText = 'ä½ ä»¬ç è”ç’§åˆï¼Œä¸€é¦–è—å¤´è¯—å¼•å¾—æ»¡å ‚å–å½©ï¼';
            applyEffects({ reputation: 10 });
        } else {
            logText = 'ä½ ä»¬çš„è¯—ä½œè™½ç„¶å¹³å¹³ï¼Œä½†æƒ…çœŸæ„åˆ‡ï¼Œä¹Ÿèµ¢å¾—äº†ç¥ç¦ã€‚';
        }
    } else { // drink
        if (gameState.player.health > 60) {
            logText = 'ä½ ä»¬è±ªé¥®ä¸‰æ¯ï¼Œå°½æ˜¾è±ªæƒ…ï¼Œå®¾å®¢ä»¬å¤§å£°å«å¥½ï¼';
            applyEffects({ reputation: 5, attributes: { health: -5 } });
        } else {
            logText = 'ä½ ä»¬å‹‰å¼ºå–å®Œï¼Œå·²æ˜¯å¤´æ™•çœ¼èŠ±ï¼Œå¼•å¾—ä¼—äººå–„æ„åœ°å“„ç¬‘ã€‚';
            applyEffects({ attributes: { health: -10 } });
        }
    }
    
    showEventCard('å¤§å©šä¹‹å–œ', 'ğŸ‰', logText);
    closeAllOverlays();
}
function completeWedding(guestCount) {
    const giftMoney = guestCount * getRandomInt(100, 300);
    if (giftMoney > 0) {
        applyEffects({ wealth: giftMoney });
        const logText = `å¤§å©šä¹‹å–œï¼Œæ”¶åˆ°å®¾å®¢è´ºç¤¼å…±è®¡ <span class="value">${giftMoney}</span> ä¸¤ã€‚`;

        // ã€æ–°å¢çš„æ ¸å¿ƒä»£ç ã€‘å°†è´ºç¤¼æ”¶å…¥å†™å…¥è®°äº‹æœ¬
        logEvent(logText);
        
        // ä¿ç•™åŸæœ‰çš„å³æ—¶æç¤º
        showToast(`æ”¶åˆ°å®¾å®¢è´ºç¤¼å…±è®¡ ${giftMoney} ä¸¤ã€‚`);
    }
    closeAllOverlays();
}
// [æ›¿æ¢æ­¤å‡½æ•°]
function showEventCard(header, icon, content, options = null) {
    if (gameState.flags.isBatchProcessing) {
        console.log(`[è·³è¿‡å›åˆ] äº‹ä»¶: ${header} - ${content.replace(/<[^>]*>/g, "")}`);
        if (options && options[0] && options[0].callback) {
            options[0].callback();
        }
        return;
    }
    closeAllOverlays();
    const card = document.getElementById('eventCardOverlay');
    if (!card) {
        console.error("Error: Could not find 'eventCardOverlay' element.");
        return;
    }
    const headerEl = card.querySelector('#eventCardHeader');
    const animationEl = card.querySelector('#eventCardAnimation');
    const contentEl = card.querySelector('#eventCardContent');
    const button = card.querySelector('.control-btn');
    if (headerEl) headerEl.innerHTML = header;
    if (animationEl) animationEl.innerHTML = icon.startsWith('fa-') ? `<i class="fas ${icon}"></i>` : icon;
    if (contentEl) contentEl.innerHTML = content;
    if (button) {
        if (options && options.length > 0) {
            const opt = options[0];
            button.innerHTML = opt.text || `<i class="fas fa-check"></i> çŸ¥é“äº†`;
            button.onclick = () => {
                // åœ¨è°ƒç”¨å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œå…ˆå…³é—­å¼¹çª—ã€‚
                // closeAllOverlays å‡½æ•°å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶çš„æ˜¾ç¤ºã€‚
                if (opt.callback) {
                    opt.callback();
                }
                closeAllOverlays();
                if (!isProcessing) renderGame();
            };
        } else {
            button.innerHTML = `<i class="fas fa-check"></i> çŸ¥é“äº†`;
            button.onclick = () => {
                closeAllOverlays();
                if (!isProcessing) renderGame();
            };
        }
    }
    showOverlay('eventCardOverlay');
}
function showDateScene(npc) {
    const event = getRandomElement(romanticEvents);
    document.getElementById('dateSceneHeader').innerText = `ä¸${npc.name}çš„çº¦ä¼š`;
    document.getElementById('dateSceneContent').innerText = event;
    showOverlay('dateSceneOverlay');
}

// =======================================================================
// ===================== ã€æ–°å¢ã€‘æ˜¾ç¤ºç‰¹æ®Šå…³ç³»äº’åŠ¨å¼¹çª—çš„æ ¸å¿ƒå‡½æ•° =========
// =======================================================================
function showSpecialInteractionOverlay(npcId) {
    const npc = gameState.npcs[npcId];
    const player = gameState.player;
    const rel = gameState.social.relationships[npcId];
    if (!npc || !rel) return;
    const headerEl = document.getElementById('specialInteractionHeader');
    const contentEl = document.getElementById('specialInteractionContent');
    const optionsEl = document.getElementById('specialInteractionOptions');
    
    headerEl.innerHTML = '';
    contentEl.innerHTML = '';
    optionsEl.innerHTML = '';

    if (rel.type === 'lover') {
        headerEl.innerHTML = `<i class="fas fa-heart-pulse"></i> æƒ…äººç§è¯­`;
        contentEl.innerHTML = `å¤œè‰²å¦‚æ°´ï¼Œä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> çš„å…³ç³»ï¼Œæ˜¯æ—äººä¸çŸ¥çš„ç§˜å¯†ã€‚`;
        
        const loverInteractions = [
             // â–¼â–¼â–¼ ã€æ ¸å¿ƒæ–°å¢ä»£ç ã€‘åœ¨è¿™é‡Œå¢åŠ äº†â€œç§å¯†çº¦ä¼šâ€é€‰é¡¹ â–¼â–¼â–¼
             { id: 'dating_location', name: 'ç§å¯†çº¦ä¼š', icon: 'fa-calendar-check', min_favor: 20 },
             // â–²â–²â–² ã€æ–°å¢ç»“æŸã€‘ â–²â–²â–²
             { id: 'poetry_quiz', name: 'å¿ƒæœ‰çµçŠ€', icon: 'fa-feather-alt', min_favor: 40 },
             { id: 'intimacy', name: 'ç¼ ç»µ', icon: 'fa-moon', min_favor: 60, gender: 'female' },
             { id: 'take_as_concubine_lover', name: 'çº³ä¸ºå¦¾å®¤', icon: 'fa-user-plus', min_favor: 80, gender: 'male' },
             { id: 'propose_marriage_lover', name: 'æ±‚å¨¶ä¸ºå¦»', icon: 'fa-ring', min_favor: 90, gender: 'male' }
        ];

        loverInteractions.forEach(action => {
            let available = true;
            let reason = '';
            if (action.min_favor && npc.favor < action.min_favor) {
                available = false; reason = `(æƒ…æ„éœ€â‰¥${action.min_favor})`;
            }
            if (action.gender && action.gender !== player.gender) {
                available = false; 
            }
            if (action.id === 'propose_marriage_lover' && gameState.marriage.isMarried) {
                available = false; reason = `(ä½ å·²æˆå©š)`;
            }
            if (action.id === 'take_as_concubine_lover' && (!gameState.marriage.isMarried || gameState.marriage.concubines.length >= 5)) {
                available = false; reason = gameState.marriage.isMarried ? `(å¦¾å®¤å·²æ»¡)`: `(éœ€å…ˆå¨¶å¦»)`;
            }

            if(available) {
                const button = document.createElement('button');
                button.className = 'option';
                if (action.id === 'intimacy') {
                    button.style.background = 'linear-gradient(135deg, #ff9ebf, #d84381)';
                }
                button.innerHTML = `<i class="fas ${action.icon}"></i><span class="option-text">${action.name}<div><small>${reason}</small></div></span>`;
                // ã€ä¿®æ”¹ã€‘è¿™é‡Œçš„ onclick è°ƒç”¨çš„æ˜¯æ–°çš„æ€»å¤„ç†å‡½æ•° handleSpecialInteraction
                button.onclick = () => handleSpecialInteraction(npcId, action.id);
                optionsEl.appendChild(button);
            }
        });
    } 
    else if (rel.type === 'sworn_sibling') {
        // ... (è¿™éƒ¨åˆ†é€»è¾‘ä¿æŒä¸å˜) ...
        const swornType = player.gender === 'male' ? 'å…„å¼Ÿ' : 'å§å¦¹';
        headerEl.innerHTML = `<i class="fas fa-fist-raised"></i> é‡‘å…°ä¹‹ä¹‰`;
        contentEl.innerHTML = `ä½ ä»¬æ˜¯ç”Ÿæ­»ä¸å…±çš„${swornType}ï¼Œå…³ç³»ç‰¢ä¸å¯ç ´ã€‚`;
        const siblingInteractions = [
             { id: 'teach_skill', name: 'ä¼ æˆæŠ€èƒ½', icon: 'fa-user-graduate' },
             { id: 'overcome_difficulty', name: 'å…±æ¸¡éš¾å…³', icon: 'fa-hands-helping' },
             { id: 'ask_help', name: 'ä¸¤è‚‹æ’åˆ€', icon: 'fa-shield-alt' },
             { id: 'discuss_plan', name: 'å…±å•†å¤§äº‹', icon: 'fa-comments' },
             { id: 'borrow_money', name: 'å€¾å›Šç›¸åŠ©', icon: 'fa-coins' }
        ];
        siblingInteractions.forEach(action => {
            const button = document.createElement('button');
            button.className = 'option';
            button.innerHTML = `<i class="fas ${action.icon}"></i> ${action.name}`;
            button.onclick = () => handleSwornSiblingInteraction(npcId, action.id);
            optionsEl.appendChild(button);
        });
    }
    showOverlay('specialInteractionOverlay');
}
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function showNPCDetails(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) { showToast("æŸ¥æ— æ­¤äººã€‚"); return; }
    if (npc.isDead) { showToast("æ–¯äººå·²é€ã€‚"); return; }

    const player = gameState.player;
    const rel = gameState.social.relationships[npcId];
    npc.lastInteractedTurn = (gameState.date.year * 2) + gameState.date.turn;

    // =======================================================================
    // ===================== ã€æ–°å¢ã€‘NPCä¸»åŠ¨å‰§æƒ…è§¦å‘å™¨ START ==================
    // =======================================================================

    // ã€æ–°å¢åŠŸèƒ½1ã€‘NPCä¸»åŠ¨è¯·æ±‚ç»“æ‹œ
    if (rel && player.gender === npc.gender && ['brother', 'confidante'].includes(rel.type) && npc.favor >= 92 && !rel.isSworn) {
        if (!gameState.flags.swornProposalFrom) gameState.flags.swornProposalFrom = {};
        if (!gameState.flags.swornProposalFrom[npcId]) {
            gameState.flags.swornProposalFrom[npcId] = true; // æ ‡è®°å·²è§¦å‘è¿‡ï¼Œé˜²æ­¢é‡å¤
            triggerOathProposal(npcId);
            return; // ä¸­æ–­åç»­å‡½æ•°ï¼Œç›´æ¥æ˜¾ç¤ºç»“æ‹œä»ªå¼
        }
    }

    // ã€æ–°å¢åŠŸèƒ½2ã€‘NPCä¸»åŠ¨è¯·æ±‚æˆä¸ºç§˜å¯†æƒ…äºº
    if (rel && player.gender !== npc.gender && ['red_confidante', 'blue_confidante'].includes(rel.type) && npc.favor >= 95 && rel.type !== 'lover') {
        if (!gameState.flags.loverProposalFrom) gameState.flags.loverProposalFrom = {};
        if (!gameState.flags.loverProposalFrom[npcId]) {
            gameState.flags.loverProposalFrom[npcId] = true; // æ ‡è®°å·²è§¦å‘
            triggerLoverProposal(npcId);
            return; // ä¸­æ–­åç»­å‡½æ•°
        }
    }

    // ã€æ–°å¢åŠŸèƒ½4ã€‘ç§˜å¯†æƒ…äººä¸»åŠ¨æ±‚å©šï¼ˆä»…é™å¥³ç©å®¶ï¼‰
    if (player.gender === 'female' && rel && rel.type === 'lover' && player.age >= 16 && !gameState.marriage.isMarried && npc.favor >= 95 && (rel.emotionValue || 0) > 400) {
        if (!gameState.flags.marriageProposalFrom) gameState.flags.marriageProposalFrom = {};
        if (!gameState.flags.marriageProposalFrom[npcId]) {
            gameState.flags.marriageProposalFrom[npcId] = true; // æ ‡è®°å·²è§¦å‘
            triggerMarriageProposal(npcId);
            return; // ä¸­æ–­åç»­å‡½æ•°
        }
    }

    // ===================== ã€æ–°å¢ã€‘NPCä¸»åŠ¨å‰§æƒ…è§¦å‘å™¨ END ===================
    // =======================================================================


    // --- ä»¥ä¸‹ä¸ºåŸæœ‰çš„NPCå¡ç‰‡æ¸²æŸ“é€»è¾‘ï¼Œä¿æŒä¸å˜ ---
    const container = document.getElementById('npc-card-container');
    container.innerHTML = '';
    const rarity = npc.rarity || 'common';
    const rarityClass = `rarity-${rarity}`;

    const relData = rel ? RELATIONSHIP_DATA[rel.type] : null;
    const isLover = rel && rel.type === 'lover';
    const isSwornSibling = rel && rel.type === 'sworn_sibling';

    const scrollStyle = isLover ? `
        background-image: url('https://img.zcool.cn/community/01f66359e19a62a80120446342e472.jpg@1280w_1l_2o_100sh.jpg');
        border: 2px solid #ff85c1;
        color: #5a2d52;
    ` : (isSwornSibling ? `
        background-image: url('https://img.zcool.cn/community/01f66359e19a62a80120446342e472.jpg@1280w_1l_2o_100sh.jpg');
        border: 2px solid #d35400;
        color: #4a3c2b;
    ` : `
        background-image: url('https://img.zcool.cn/community/01f66359e19a62a80120446342e472.jpg@1280w_1l_2o_100sh.jpg');
        border: 2px solid #bda27e;
        color: #4a3c2b;
    `);

    const favorName = isLover ? 'æƒ…æ„å€¼' : (isSwornSibling ? 'æƒ…ä¹‰å€¼' : 'å¥½æ„Ÿåº¦');
    const favorIcon = isLover ? 'fa-heart-pulse' : (isSwornSibling ? 'fa-fist-raised' : 'fa-heart');
    const favorPercent = Math.max(0, Math.min(100, npc.favor));
    let favorTag = "ä¸€é¢ä¹‹ç¼˜";

    if(rel && relData) {
        const levelData = RELATIONSHIP_LEVELS[relData.type] || RELATIONSHIP_LEVELS.friendship;
        favorTag = relData.levelNames[rel.level || 0] || levelData[rel.level || 0].name;
    }

    const personalityColorMap = {
        'æ¸©æŸ”': 'tag-æ¸©æŸ”', 'æœæ•¢': 'tag-æœæ•¢', 'èªæ…§': 'tag-èªæ…§',
        'æ´»æ³¼': 'tag-æ´»æ³¼', 'å†…æ•›': 'tag-å†…æ•›',
    };

    const topSectionHTML = `
    <div class="social-card-header">
        <div class="npc-avatar-container">
            <div class="npc-avatar-frame">
                <div class="npc-avatar-halo ${rarityClass}"></div>
                <img src="${npc.avatar}" alt="${npc.name}">
            </div>
            <div class="npc-identity-tag">${npc.role || npc.title || 'æ±Ÿæ¹–äººå£«'}</div>
        </div>
        <div class="npc-info-basic">
            <h3 class="name">${npc.name}</h3>
            <p class="title">${npc.title || `å¹´é¾„: ${Math.floor(npc.age)}å²`}</p>
            <p class="description">${npc.background ? npc.background.desc : 'èº«ä¸–ç¥ç§˜ï¼Œä¼¼ä¹æœ‰ä¸ä¸ºäººçŸ¥çš„æ•…äº‹ã€‚'}</p>
            <div class="personality-tags">
                ${(npc.personality || []).map(p => `<span class="personality-tag ${personalityColorMap[p] || ''}">${p}</span>`).join('')}
            </div>
        </div>
    </div>`;

    const devotionHTML = isLover ? `
        <div class="relationship-container" style="margin-top: 15px;">
            <div class="heart-meter" style="color: #8e44ad;">
                <div class="heart-fill" style="height: ${100 - (rel.devotion || 0)}%;"></div>
                <i class="fas fa-hand-holding-heart heart-icon"></i>
            </div>
            <div class="relationship-tag">ç—´æƒ…åº¦ (${rel.devotion || 0})</div>
        </div>
    ` : '';

    const middleSectionHTML = `
        <div class="social-card-middle">
            <div class="attributes-vertical-container">
                ${Object.entries(npc.attributes || {}).filter(([key,]) => ATTR_MAP[key]).map(([key, value]) => `
                    <div class="attribute-vertical">
                        <div class="progress-bar-vertical-wrapper">
                            <div class="progress-bar-vertical-fill ${key}-fill" style="height: ${Math.min(100, (value/150)*100)}%;"></div>
                        </div>
                        <span class="name">${ATTR_MAP[key]}</span>
                        <span class="value">${Math.floor(value)}</span>
                    </div>
                `).join('')}
            </div>
            <div class="relationship-container">
                <div class="heart-meter">
                    <div class="heart-fill" style="height: ${100 - favorPercent}%;"></div>
                    <i class="fas ${favorIcon} heart-icon"></i>
                </div>
                <div class="relationship-tag">${favorTag} (${npc.favor})</div>
                <div class="relationship-trend trend-stable"><i class="fas fa-minus"></i> å…³ç³»ç¨³å®š</div>
                ${npc.status ? `<div class="special-status-display"><i class="fas fa-info-circle"></i> çŠ¶æ€: ${npc.status}</div>` : ''}
                ${devotionHTML}
            </div>
        </div>
    `;

    const actions = generateNpcActionButtons(npc);
    let bottomSectionHTML = `
        <div class="social-card-actions">
            ${actions.map(action => `
                <button class="action-button ${!action.available ? 'disabled' : ''}"
                         style="${action.style || ''}"
                        onclick="${action.available ? `handleNpcInteraction('${npc.id}', '${action.id}', '${action.relType || ''}')` : ''}">
                    <i class="fas ${action.icon}"></i>
                    <span>${action.name}</span>
                </button>
            `).join('')}
        </div>
    `;

    let specialActionsHTML = '';
    if (isLover) {
        specialActionsHTML = `
            <div class="special-actions-card">
                <button class="option" style="background: linear-gradient(135deg, #c03b2b, #e74c3c);" onclick="showSpecialInteractionOverlay('${npcId}')">
                    <i class="fas fa-heart-pulse"></i>
                    <span class="option-text">æƒ…äººç§è¯­<div><small>è¿›è¡Œç§˜å¯†äº’åŠ¨</small></div></span>
                </button>
            </div>
        `;
    }
    else if (isSwornSibling) {
        specialActionsHTML = `
            <div class="special-actions-card">
                <button class="option" style="background: linear-gradient(135deg, #d35400, #f39c12);" onclick="showSpecialInteractionOverlay('${npcId}')">
                    <i class="fas fa-fist-raised"></i>
                    <span class="option-text">é‡‘å…°ä¹‹ä¹‰<div><small>è¿›è¡Œç»“ä¹‰äº’åŠ¨</small></div></span>
                </button>
            </div>
        `;
    }

    const expandablePanelHTML = `
        <div class="expand-info-toggle" onclick="this.nextElementSibling.classList.toggle('active')">
            æŸ¥çœ‹æ›´å¤šä¿¡æ¯ <i class="fas fa-chevron-down"></i>
        </div>
        <div class="expandable-panel">
            <h5><i class="fas fa-thumbs-up"></i> å–œå¥½</h5>
            <ul><li>- ${npc.preferences.known ? npc.preferences.likes.map(id => TRADING_GOODS_DATA[id].name).join('ã€') : 'æš‚æœªæ¢çŸ¥'}</li></ul>
            <h5><i class="fas fa-thumbs-down"></i> åŒæ¶</h5>
            <ul><li>- ${npc.preferences.known ? npc.preferences.dislikes.map(id => TRADING_GOODS_DATA[id].name).join('ã€') : 'æš‚æœªæ¢çŸ¥'}</li></ul>
        </div>
    `;

    const finalHTML = `
        <div class="social-card-scroll" style="${scrollStyle}">
            <button class="overlay-close-btn" onclick="closeAllOverlays()">Ã—</button>
            <div class="theme-decorator top-right"></div>
            <div class="theme-decorator bottom-left"></div>
            ${topSectionHTML}
            ${middleSectionHTML}
            ${bottomSectionHTML}
            ${specialActionsHTML}
             ${expandablePanelHTML}
        </div>
    `;

    container.innerHTML = finalHTML;
    showOverlay('npcDetailOverlay');
}
function startGathering(initiatorNpcId) {
    const initiatorNpc = gameState.npcs[initiatorNpcId];
    const friends = Object.keys(gameState.social.relationships)
        .filter(id => id !== initiatorNpcId && gameState.npcs[id] && !gameState.npcs[id].isDead)
        .map(id => gameState.npcs[id]);

    if (friends.length === 0) {
        showToast("ä½ è¿˜æ²¡æœ‰å…¶ä»–æœ‹å‹å¯ä»¥é‚€è¯·ã€‚");
        return;
    }

    let options = friends.map(friend => ({
        htmlContent: `<div class="suitor" style="margin-bottom:0; padding:5px;"><div class="suitor-avatar-wrapper" style="width:40px;height:40px;"><img src="${friend.avatar}" class="suitor-avatar"></div><div class="suitor-details"><div class="suitor-name">${friend.name}</div></div></div>`,
        style: `padding: 5px; height: auto;`,
        callback: () => {
            showGatheringOverlay(initiatorNpc, friend);
        }
    }));

    showDecisionCard('é‚€è¯·ä½•äººï¼Ÿ', 'fa-user-plus', `ä½ æ‰“ç®—é‚€è¯·è°ä¸ <strong class="highlight-npc">${initiatorNpc.name}</strong> ä¸€åŒèšä¼šï¼Ÿ`, options);
}

function showGatheringOverlay(npc1, npc2) {
    closeAllOverlays();
    const overlay = document.getElementById('gatheringOverlay');
    const player = gameState.player;

    // éšæœºä¸€ä¸ªèšä¼šèƒŒæ™¯
    const backgrounds = ['https://img.zcool.cn/community/01a43a59a76472a8012028a92a5482.jpg@1280w_1l_2o_100sh.jpg', 'https://img.zcool.cn/community/01f41d5970371fa8012193a34a3291.jpg@1280w_1l_2o_100sh.jpg'];
    overlay.style.backgroundImage = `url(${getRandomElement(backgrounds)})`;

    overlay.innerHTML = `
        <div class="gathering-container">
            <div class="gathering-npc" style="top: 30%; left: 15%;">
                <img src="${npc1.avatar}" alt="${npc1.name}">
                <div class="name">${npc1.name}</div>
            </div>
            <div class="gathering-npc" style="top: 50%; left: 45%;">
                <img src="${player.avatar}" alt="${player.name}">
                <div class="name">${player.name}</div>
            </div>
            <div class="gathering-npc" style="top: 30%; right: 15%;">
                <img src="${npc2.avatar}" alt="${npc2.name}">
                <div class="name">${npc2.name}</div>
            </div>

            <div class="gathering-ui">
                <div class="gathering-desc">ä½ ä¸ ${npc1.name}ã€${npc2.name} åœ¨é›…é—´å°èšï¼Œæ°”æ°›æ­£å¥½ã€‚</div>
                <div class="gathering-actions">
                    <button class="control-btn" onclick="handleGatheringAction('chat', ['${npc1.id}', '${npc2.id}'])"><i class="fas fa-comments"></i> é—²èŠ</button>
                    <button class="control-btn" onclick="handleGatheringAction('drink', ['${npc1.id}', '${npc2.id}'])"><i class="fas fa-wine-glass"></i> é¥®é…’</button>
                    <button class="control-btn" onclick="handleGatheringAction('game', ['${npc1.id}', '${npc2.id}'])"><i class="fas fa-chess"></i> æ¸¸æˆ</button>
                    <button class="control-btn" style="background:var(--control-shadow-hover);" onclick="closeAllOverlays()">ç»“æŸèšä¼š</button>
                </div>
            </div>
        </div>`;
    showOverlay('gatheringOverlay');
}

function handleGatheringAction(action, npcIds) {
    const npc1 = gameState.npcs[npcIds[0]];
    const npc2 = gameState.npcs[npcIds[1]];

    switch(action) {
        case 'chat':
            showEventCard('é—²è°ˆç”šæ¬¢', 'fa-comments', `ä½ ä»¬ä¸‰äººå¤©å—æµ·åŒ—åœ°é—²èŠï¼Œæ°”æ°›ååˆ†èæ´½ã€‚<br>${npc1.name} å¥½æ„Ÿ+3, ${npc2.name} å¥½æ„Ÿ+3ã€‚`);
            applyEffects({ relationship: { targetId: npc1.id, favor: 3 } });
            applyEffects({ relationship: { targetId: npc2.id, favor: 3 } });
            break;
        case 'drink':
            showEventCard('æ¨æ¯æ¢ç›', 'fa-wine-glass', `é…’è¿‡ä¸‰å·¡ï¼Œä½ ä»¬éƒ½æœ‰äº›å¾®é†ºï¼Œè¯ä¹Ÿå¤šäº†èµ·æ¥ã€‚<br>${npc1.name} å¥½æ„Ÿ+5, ${npc2.name} å¥½æ„Ÿ+5ã€‚`);
            applyEffects({ relationship: { targetId: npc1.id, favor: 5 } });
            applyEffects({ relationship: { targetId: npc2.id, favor: 5 } });
            break;
        case 'game':
            // åœ¨è¿™é‡Œå¯ä»¥é‡æ–°è°ƒç”¨ä½ çš„å°æ¸¸æˆ
            const opponent = Math.random() > 0.5 ? npc1 : npc2;
            showToast(`ä½ é‚€è¯· ${opponent.name} æ¥ä¸€å±€å¯¹å¼ˆã€‚`);
            closeAllOverlays();
            setTimeout(() => startGoMiniGame(opponent.id), 300);
            break;
    }
}

// [æ›¿æ¢]
function handleNpcInteraction(npcId, actionId, relType = '') {
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨å‡½æ•°å¼€å¤´åŠ å…¥æ–°çš„æ£€æŸ¥
    if (!checkAndUseNpcActionPoint(npcId)) {
        return; // å¦‚æœäº’åŠ¨æ¬¡æ•°å·²æ»¡ï¼Œåˆ™ç›´æ¥é€€å‡ºå‡½æ•°
    }

    const npc = gameState.npcs[npcId];
    if (!npc) return;

    if (relType && RELATIONSHIP_DATA[relType] && RELATIONSHIP_DATA[relType].interactions.some(i => i.id === actionId)) {
        handleSocialInteraction(npcId, relType, actionId);
        return;
    }

    if (actionId === 'start_confession') {
        startConfessionProcess(npcId);
        return;
    }
    
    if (actionId === 'become_sworn_sibling') {
        triggerOathProposal(npcId);
        return;
    }
    
    switch (actionId) {
        case 'chat': interactWithNpc(npcId, 'chat'); break;
        case 'giveGift': showGiftGivingOverlay(npcId); break;
        case 'gathering': startGathering(npcId); break;
        case 'conversation_game': startConversationMiniGame(npcId); break;
        case 'go_game': startGoMiniGame(npcId); break;
        case 'guzheng_game': startGuzhengMiniGame(npcId); break;
        case 'askPreference':
            if (gameState.player.gender === 'male') {
                showFengYueJian(true, npcId);
            } else {
                if (gameState.player.attributes.charm > 40) {
                    npc.preferences.known = true;
                    showEventCard('æ—æ•²ä¾§å‡»', 'fa-ear-listen', `åœ¨ä½ çš„å·§å¦™å¼•å¯¼ä¸‹ï¼Œ${npc.name}æ— æ„ä¸­é€éœ²äº†TAçš„å–œå¥½ã€‚`);
                    showNPCDetails(npcId);
                } else {
                    showEventCard('æ—æ•²ä¾§å‡»', 'fa-times-circle', `ä½ çš„é—®é¢˜æœ‰äº›ç›´æ¥ï¼Œ${npc.name}è­¦è§‰åœ°è½¬ç§»äº†è¯é¢˜ã€‚`);
                }
            }
            break;
        case 'propose': marrySuitor(npcId); break;
        case 'divorce': handleDivorce(); break;
        default: handleSpecialInteraction(npcId, actionId); break;
    }
    renderGame();
}

// ===================== ã€æ–°åŠŸèƒ½ã€‘é‡æ„NPCäº¤äº’é€»è¾‘ =====================
// =======================================================================
// [æ›¿æ¢] åŸæœ‰çš„ generateNpcInteractionOptions å‡½æ•°
// [æ›¿æ¢] generateNpcInteractionOptions å‡½æ•°
function generateNpcInteractionOptions(npc) {
    const { id: npcId, favor } = npc;
    let optionsHTML = '';

    // åŸºç¡€äº’åŠ¨
    optionsHTML += `<button class="option" onclick="interactWithNpc('${npcId}', 'chat')"><i class="fas fa-comments"></i> é—²èŠ</button>`;
    optionsHTML += `<button class="option" onclick="interactWithNpc('${npcId}', 'gift')"><i class="fas fa-gift"></i> é€ç¤¼</button>`;
    
    const rel = gameState.social.relationships[npcId];

    // ç‰¹æ®Šé‚€çº¦ -> å°æ¸¸æˆ
    if (favor >= 50) {
        optionsHTML += `<button class="option" onclick="startConversationMiniGame('${npcId}')"><i class="fas fa-heart"></i> ä¿ƒè†é•¿è°ˆ</button>`;
        if(npc.attributes.wisdom >= 60) {
            optionsHTML += `<button class="option" onclick="startGoMiniGame('${npcId}')"><i class="fas fa-chess-go"></i> æ‰‹è°ˆå¯¹å¼ˆ</button>`;
        }
    }

    // å…³ç³»ç‰¹å®šäº’åŠ¨
    if (rel && RELATIONSHIP_DATA[rel.type]) {
        const relData = RELATIONSHIP_DATA[rel.type];
        relData.interactions.forEach(interaction => {
            if (favor >= interaction.min_favor && rel.level >= interaction.min_level) {
                optionsHTML += `<button class="option" onclick="handleSocialInteraction('${npcId}', '${rel.type}', '${interaction.id}')">
                    <i class="fas fa-handshake"></i> ${interaction.name}
                </button>`;
            }
        });
    }

    // ç»“å©š/çº³å¦¾ç­‰é€»è¾‘
    if (npc.relationship === 'suitor' && favor > 80 && gameState.player.age >= 16 && !gameState.marriage.isMarried) {
        optionsHTML += `<button class="option" style="background:linear-gradient(135deg, #e74c3c, #c0392b);" onclick="marrySuitor('${npcId}')"><i class="fas fa-ring"></i> ${gameState.player.gender === 'male' ? 'æäº²' : 'åº”å…äº²äº‹'}</button>`;
    }
    
    return optionsHTML;
}
function handleSocialInteraction(npcId, relType, interactionId) {
    const npc = gameState.npcs[npcId];
    const player = gameState.player;
    const relData = RELATIONSHIP_DATA[relType];
    const interaction = relData ? relData.interactions.find(i => i.id === interactionId) : null;

    if (!npc || !interaction) {
        showToast("äº’åŠ¨æ•°æ®é”™è¯¯");
        return;
    }

    const rel = gameState.social.relationships[npcId];
    if (rel) {
        rel.emotionValue = (rel.emotionValue || 0) + getRandomInt(5, 10);
        rel.eventsExperienced = (rel.eventsExperienced || 0) + 1;
    }

    // ===================== äº’åŠ¨é€»è¾‘åˆ¤æ–­ (Switch..Case) =====================
    switch (interactionId) {
        // --- çº¢é¢œ/è“é¢œçŸ¥å·±äº’åŠ¨ ---
        case 'moon_drink': {
            showDecisionCard('æœˆä¸‹å¯¹é¥®', 'fa-wine-glass-bottle',
                `æ˜æœˆå½“ç©ºï¼Œ<strong class="highlight-npc">${npc.name}</strong>é‚€ä½ å°é…Œï¼Œå¸­é—´è°ˆåŠäººç”Ÿç†æƒ³ä¸é—æ†¾ã€‚`,
                [
                    { htmlContent: 'ã€å€¾è¯‰å¿ƒå£°ã€‘', callback: () => {
                        showEventCard('æ¨å¿ƒç½®è…¹', 'fa-heart', 'ä½ çš„çœŸè¯šæ‰“åŠ¨äº†å¯¹æ–¹ã€‚å¥½æ„Ÿ+10ï¼Œæƒ…æ„Ÿå€¼+15ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 10, emotionValue: 15 } });
                        // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¸€ä¸ªè·å¾—â€œä¿¡ä»»â€ç‰¹è´¨çš„é€»è¾‘
                    }},
                    { htmlContent: 'ã€ç¬‘è€Œä¸è¯­ã€‘', callback: () => {
                        showEventCard('é™é»˜çš„é™ªä¼´', 'fa-moon', 'ä½ é™é™åœ°è†å¬ï¼Œæœ‰æ—¶æ— å£°èƒœæœ‰å£°ã€‚å¥½æ„Ÿ+5ï¼Œæ°”è´¨+2ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 5 }, attributes: { charm: 2 } });
                    }},
                    { htmlContent: 'ã€å€Ÿé…’è°ƒä¾ƒã€‘', callback: () => {
                        if (player.attributes.charm >= 70) {
                            showEventCard('é£è¶£çš„å›åº”', 'fa-grin-wink', 'ä½ é£è¶£çš„è°ƒä¾ƒè®©å¯¹æ–¹èå°”ä¸€ç¬‘ï¼Œæ°”æ°›æ›´åŠ èæ´½ã€‚å¥½æ„Ÿ+15ã€‚');
                            applyEffects({ relationship: { targetId: npcId, favor: 15, emotionValue: 10 } });
                        } else {
                            showEventCard('å°´å°¬çš„ç©ç¬‘', 'fa-meh', 'ä½ çš„è°ƒä¾ƒç•¥æ˜¾è½»æµ®ï¼Œå¯¹æ–¹çš±äº†çš±çœ‰ã€‚å¥½æ„Ÿ-5ã€‚');
                            applyEffects({ relationship: { targetId: npcId, favor: -5 } });
                        }
                    }}
                ]
            );
            break;
        }
        case 'receive_gift': {
             showDecisionCard('æ„å¤–èµ ç¤¼', 'fa-gift',
                `<strong class="highlight-npc">${npc.name}</strong>å°†ä¸€ä»¶è´´èº«ä¹‹ç‰©ï¼ˆå¦‚æ‰‹å¸•ã€ç‰ä½©ï¼‰èµ äºˆä½ ï¼Œçœ¼ä¸­ä¼¼æœ‰ä¸‡åƒè¨€è¯­ã€‚`,
                [
                    { htmlContent: 'ã€æ¬£ç„¶æ”¶ä¸‹ã€‘', callback: () => {
                        addItemToInventory(`token_from_${npcId}`, 1, { name: `${npc.name}çš„ä¿¡ç‰©`, desc: `æ¥è‡ª${npc.name}çš„ä¿¡ç‰©ï¼Œè§è¯ç€ä½ ä»¬çš„æƒ…è°Šã€‚`, type: 'çå“', icon: 'fa-gem'});
                        showEventCard('æƒ…è°Šä¹‹è¯', 'fa-gem', 'ä½ æ”¶ä¸‹äº†ä¿¡ç‰©ï¼Œå¯¹æ–¹çœ‹èµ·æ¥å¾ˆé«˜å…´ã€‚å¥½æ„Ÿ+10ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 10, emotionValue: 10 } });
                    }},
                    { htmlContent: 'ã€å©‰æ‹’ã€‘', callback: () => {
                        showEventCard('åšå®ˆç•Œçº¿', 'fa-hand-paper', 'ä½ å©‰æ‹’äº†è¿™ä»½è¿‡äºäº²å¯†çš„ç¤¼ç‰©ã€‚å¥½æ„Ÿ-5ï¼Œå“å¾·+5ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: -5 }, attributes: { virtue: 5 } });
                    }},
                    { htmlContent: 'ã€å›èµ æ›´é‡ä¹‹ç¤¼ã€‘', callback: () => {
                        if (gameState.finances.wealth >= 500) {
                            showEventCard('ç¤¼å°šå¾€æ¥', 'fa-exchange-alt', 'ä½ çš„æ…·æ…¨è®©å¯¹æ–¹å¤§ä¸ºæ„ŸåŠ¨ï¼Œä½ ä»¬çš„å…³ç³»å‡åä¸ºæŒšå‹ï¼å¥½æ„Ÿ+20ã€‚');
                            applyEffects({ wealth: -500, relationship: { targetId: npcId, favor: 20, emotionValue: 25 } });
                            updateRelationshipLevel(npcId, true); // å¼ºåˆ¶æå‡ç­‰çº§
                        } else {
                            showToast("ä½ çš„è´¢å¯Œä¸è¶³500ä¸¤ï¼Œæ— æ³•å›èµ é‡ç¤¼ã€‚");
                        }
                    }}
                ]
            );
            break;
        }
        case 'be_rescued': {
            showDecisionCard('ä¸ºå›è§£å›´', 'fa-shield-alt',
                `åœ¨ä¸€æ¬¡ç¤¾äº¤åœºåˆï¼Œä½ å› ä¸€æ—¶å¤±è¨€é™·å…¥å°´å°¬ï¼Œ<strong class="highlight-npc">${npc.name}</strong>å‡ å¥å·§å¦™çš„è¯è¯­ä¾¿ä¸ºä½ åŒ–è§£äº†å±æœºã€‚`,
                [
                    { htmlContent: 'ã€ç§ä¸‹è‡´è°¢ã€‘', callback: () => {
                        showEventCard('å¿ƒç…§ä¸å®£', 'fa-user-secret', 'ä½ ç§ä¸‹å‘å¯¹æ–¹è‡´è°¢ï¼Œå½¼æ­¤ä¼šå¿ƒä¸€ç¬‘ã€‚å¥½æ„Ÿ+10ï¼Œé­…åŠ›+5ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 10 }, attributes: { charm: 5 } });
                    }},
                    { htmlContent: 'ã€å…¬å¼€èµæ‰¬ã€‘', callback: () => {
                        showEventCard('å¹¿è€Œå‘Šä¹‹', 'fa-bullhorn', 'ä½ å…¬å¼€èµæ‰¬äº†å¯¹æ–¹çš„æœºæ™ºï¼Œä»¤å…¶åœ¨ä¼—äººé¢å‰å¤§æœ‰é¢å­ã€‚å¥½æ„Ÿ+15ï¼Œå¯¹æ–¹å£°æœ›+10ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 15, emotionValue: 10 } });
                        // æ­¤å¤„å¯ä»¥æ·»åŠ æå‡NPCå£°æœ›çš„é€»è¾‘
                    }},
                    { htmlContent: 'ã€æ·¡ç„¶å¤„ä¹‹ã€‘', callback: () => {
                        showEventCard('æ³¢æ¾œä¸æƒŠ', 'fa-water', 'ä½ å¯¹æ­¤æ·¡ç„¶å¤„ä¹‹ï¼Œä¼¼ä¹ä¸€åˆ‡å°½åœ¨æŒæ¡ã€‚æ°”è´¨+3ã€‚');
                        applyEffects({ attributes: { charm: 3 } });
                    }}
                ]
            );
            break;
        }

        // --- æƒ…äººäº’åŠ¨ ---
        case 'rendezvous': {
            showDecisionCard('ç§ä¼šé‚€çº¦', 'fa-moon',
                `å¤œè‰²å·²æ·±ï¼Œ<strong class="highlight-npc">${npc.name}</strong>æ´¾äººé€ä¿¡ï¼Œé‚€ä½ äºèŠ±å›­ç›¸è§ã€‚`,
                [
                    { htmlContent: 'ã€æ¬£ç„¶èµ´çº¦ã€‘', callback: () => {
                        showEventCard('æœˆä¸‹ä¹‹çº¦', 'fa-kiss-wink-heart', 'ä½ ä»¬åœ¨æœˆå½±èŠ±é¦™ä¸­äº’è¯‰è¡·è‚ ï¼Œæƒ…æ„æ›´æµ“ã€‚å¥½æ„Ÿ+20ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 20, emotionValue: 20 } });
                        // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘æ›´å…·ä½“çš„äº²å¯†äº‹ä»¶
                        if(Math.random() < 0.2) triggerBirth(npcId, true); // 20%æ€€å­•å‡ ç‡
                    }},
                    { htmlContent: 'ã€å©‰æ‹’ã€‘', callback: () => {
                        showEventCard('ç†æ™ºæˆ˜èƒœæƒ…æ„Ÿ', 'fa-hand-paper', 'ä½ æœ€ç»ˆæ²¡æœ‰èµ´çº¦ã€‚å¥½æ„Ÿ-10ï¼Œå“å¾·+10ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: -10 }, attributes: { virtue: 10 } });
                    }},
                    { htmlContent: 'ã€å¸¦å‹äººåŒå»ã€‘', callback: () => {
                        showEventCard('å¤§ç…é£æ™¯', 'fa-users-slash', 'ä½ å¸¦ç€æœ‹å‹å‡ºç°ï¼Œå¯¹æ–¹çš„è„¸è‰²ç¬é—´å˜å¾—å¾ˆéš¾çœ‹ã€‚å…³ç³»é™çº§ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: -20, emotionValue: -50 } });
                        updateRelationshipLevel(npcId);
                    }}
                ]
            );
            break;
        }
        case 'jealousy': {
             // é˜²æ­¢äº‹ä»¶è¿‡äºé¢‘ç¹
            if (gameState.social.loverStats.jealousyCooldown > 0) {
                showToast(`${npc.name}ç›®å‰å¿ƒæƒ…å°šå¥½ï¼Œå¹¶æ— é†‹æ„ã€‚`);
                return;
            }
            gameState.social.loverStats.jealousyCooldown = 4; // å†·å´2å¹´

            showDecisionCard('äº‰é£åƒé†‹', 'fa-fire',
                `<strong class="highlight-npc">${npc.name}</strong>çœ‹åˆ°ä½ ä¸æ—äººè°ˆç¬‘é£ç”Ÿï¼Œçœ¼ä¸­æµéœ²å‡ºæ˜æ˜¾çš„ä¸æ‚¦ã€‚`,
                [
                    { htmlContent: 'ã€å®‰æŠšè§£é‡Šã€‘', callback: () => {
                        showEventCard('æ¸©æŸ”å®‰æŠš', 'fa-heart', 'ä½ çš„æ¸©æŸ”è§£é‡ŠåŒ–è§£äº†TAçš„é†‹æ„ã€‚å¥½æ„Ÿ+10ï¼Œé­…åŠ›+5ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 10 }, attributes: { charm: 5 } });
                    }},
                    { htmlContent: 'ã€ä¸äºˆç†ä¼šã€‘', callback: () => {
                        showEventCard('å…³ç³»å†·å´', 'fa-snowflake', 'ä½ çš„å†·æ·¡è®©TAæ›´åŠ ä¼¤å¿ƒã€‚å¥½æ„Ÿ-15ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: -15, emotionValue: -20 } });
                    }},
                    { htmlContent: 'ã€åå®¢ä¸ºä¸»ã€‘', callback: () => {
                        if (player.attributes.charm >= 80) {
                            showEventCard('é«˜æ˜æ‰‹æ®µ', 'fa-theater-masks', 'ä½ åè¿‡æ¥è°ƒä¾ƒTAçš„é†‹æ„ï¼Œå‡ å¥èœœè¯­å°±è®©TAè½¬å—”ä¸ºå–œã€‚å¥½æ„Ÿ+20ã€‚');
                            applyEffects({ relationship: { targetId: npcId, favor: 20, emotionValue: 15 } });
                        } else {
                            showEventCard('å¼„å·§æˆæ‹™', 'fa-meh-rolling-eyes', 'ä½ çš„åå®¢ä¸ºä¸»æ˜¾å¾—è¿‡äºå¼ºåŠ¿ï¼Œè®©TAæ›´åŠ ä¸å¿«ã€‚å¥½æ„Ÿ-10ã€‚');
                            applyEffects({ relationship: { targetId: npcId, favor: -10 } });
                        }
                    }}
                ]
            );
            break;
        }
        case 'propose_elopement': {
            showDecisionCard('è¯·æ±‚ç§å¥”', 'fa-running',
                `<strong class="highlight-npc">${npc.name}</strong>å«æ³ªæœ›ç€ä½ ï¼Œè¯·æ±‚ä½ ä¸TAä¸€åŒç§å¥”ï¼Œè¿œç¦»è¿™ä¸–ä¿—çº·æ‰°ã€‚`,
                [
                    { htmlContent: 'ã€ç­”åº”ã€‘', callback: () => {
                        if (gameState.finances.wealth >= 1000) {
                            showEndGame({ title: "ä¸ºçˆ±ç§å¥”", text: `ä½ æ”¾å¼ƒäº†ç°æœ‰çš„ä¸€åˆ‡ï¼Œä¸${npc.name}ä¸€èµ·è¿œèµ°é«˜é£ï¼Œå¼€å§‹äº†æœªçŸ¥ä½†è‡ªç”±çš„æ–°ç”Ÿæ´»ã€‚` });
                        } else {
                            showToast("ä½ ä»¬è¿ç§å¥”çš„è·¯è´¹éƒ½å‡‘ä¸é½ï¼Œåªèƒ½æ— å¥ˆæ”¾å¼ƒã€‚");
                        }
                    }},
                    { htmlContent: 'ã€åŠå…¶å†·é™ã€‘', callback: () => {
                        showEventCard('å›å½’ç°å®', 'fa-cloud', 'ä½ åŠè¯´å¯¹æ–¹è¦å†·é™ï¼Œç§å¥”å¹¶éå„¿æˆã€‚å¥½æ„Ÿ-10ï¼Œå“å¾·+10ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: -10 }, attributes: { virtue: 10 } });
                    }},
                    { htmlContent: 'ã€æå‡ºæ¡ä»¶ã€‘', callback: () => {
                         if (player.attributes.wisdom >= 80) {
                            // å‡è®¾è½¬ä¸ºæ­£å¼å…³ç³»æ˜¯çº³ä¸ºå¦¾å®¤
                            if (player.gender === 'male' && gameState.marriage.concubines.length < 5) {
                                showEventCard('è°ˆåˆ¤æˆåŠŸ', 'fa-handshake', `ä½ ç”¨æ™ºæ…§è¯´æœäº†å¯¹æ–¹ï¼Œå†³å®šç»™TAä¸€ä¸ªååˆ†ã€‚`);
                                acquireConcubine(npcId);
                            } else {
                                showToast("ä½ æ— æ³•ç»™å¯¹æ–¹ä¸€ä¸ªæ­£å¼çš„ååˆ†ã€‚");
                            }
                        } else {
                             showToast("ä½ çš„æ™ºæ…§ä¸è¶³ä»¥è¯´æœå¯¹æ–¹ï¼ŒTAå¯¹ä½ çš„æè®®æ„Ÿåˆ°å¤±æœ›ã€‚");
                             applyEffects({ relationship: { targetId: npcId, favor: -15 } });
                        }
                    }}
                ]
            );
            break;
        }
        
        // --- åŒè¢/åŒäº‹äº’åŠ¨ ---
        case 'fight_together': {
            showDecisionCard('å¹¶è‚©ä½œæˆ˜', 'fa-fist-raised',
                `ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> éœ€å…±åŒåº”å¯¹ä¸€é¡¹æ£˜æ‰‹çš„ä»»åŠ¡ã€‚`,
                [
                    { htmlContent: 'ã€å…¨åŠ›é…åˆã€‘', callback: () => {
                        showEventCard('åˆä½œæ— é—´', 'fa-hands-helping', 'ä½ ä»¬é…åˆé»˜å¥‘ï¼Œåœ†æ»¡å®Œæˆäº†ä»»åŠ¡ã€‚å…³ç³»å¾—åˆ°å‡åã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: 15, emotionValue: 20 } });
                        updateRelationshipLevel(npcId, true); // å¼ºåˆ¶å‡çº§
                    }},
                    { htmlContent: 'ã€ä¿ç•™å®åŠ›ã€‘', callback: () => {
                        showEventCard('æ˜å“²ä¿èº«', 'fa-user-shield', 'ä½ ä¿ç•™äº†éƒ¨åˆ†å®åŠ›ï¼Œè™½ç„¶ä»»åŠ¡å®Œæˆäº†ï¼Œä½†å¯¹æ–¹ä¼¼ä¹æœ‰æ‰€å¯Ÿè§‰ã€‚æ™ºæ…§+5ï¼Œå¥½æ„Ÿ-5ã€‚');
                        applyEffects({ attributes: { wisdom: 5 }, relationship: { targetId: npcId, favor: -5 } });
                    }},
                    { htmlContent: 'ã€ä¸´é˜µè„±é€ƒã€‘', callback: () => {
                        showEventCard('èƒŒä¿¡å¼ƒä¹‰', 'fa-user-slash', 'ä½ é€‰æ‹©äº†ä¸´é˜µè„±é€ƒï¼Œå¯¼è‡´ä»»åŠ¡å¤±è´¥ã€‚ä½ ä»¬çš„å…³ç³»å½»åº•ç ´è£‚ã€‚');
                        applyEffects({ attributes: { reputation: -20, virtue: -15 } });
                        delete gameState.social.relationships[npcId];
                    }}
                ]
            );
            break;
        }
        
        // --- ç‰¹æ®Šå…³ç³»äº’åŠ¨ ---
        case 'teach_skill': {
             showDecisionCard('ä¼ æˆæŠ€èƒ½', 'fa-graduation-cap',
                `<strong class="highlight-npc">${npc.name}</strong>è§ä½ éª¨éª¼æ¸…å¥‡ï¼Œæ¬²ä¼ æˆä½ ä¸€é¡¹ç‹¬é—¨æŠ€è‰ºã€‚`,
                [
                    { htmlContent: 'ã€è™šå¿ƒå­¦ä¹ ã€‘', callback: () => {
                        const attrKeys = ['talent', 'wisdom', 'charm', 'martial'];
                        const randomAttr = getRandomElement(attrKeys);
                        showEventCard('å¾—ä¼ çœŸä¼ ', 'fa-book-reader', `ä½ è™šå¿ƒå­¦ä¹ ï¼Œå—ç›ŠåŒªæµ…ã€‚${ATTR_MAP[randomAttr]}+10ï¼Œå¥½æ„Ÿ+10ã€‚`);
                        applyEffects({ attributes: { [randomAttr]: 10 }, relationship: { targetId: npcId, favor: 10 } });
                    }},
                    { htmlContent: 'ã€æå‡ºäº¤æ¢ã€‘', callback: () => {
                         showEventCard('äº’é€šæœ‰æ— ', 'fa-exchange-alt', 'ä½ ä»¬äº’ç›¸äº¤æ¢å¿ƒå¾—ï¼ŒåŒæ–¹éƒ½æœ‰æ‰€ç²¾è¿›ã€‚å¥½æ„Ÿ+15ã€‚');
                         const attrKeys1 = ['talent', 'wisdom', 'charm', 'martial'];
                         const randomAttr1 = getRandomElement(attrKeys1);
                         const randomAttr2 = getRandomElement(attrKeys1);
                         applyEffects({ attributes: { [randomAttr1]: 5 }, relationship: { targetId: npcId, favor: 15 } });
                         // æ­¤å¤„å¯ä»¥ç»™NPCä¹Ÿå¢åŠ å±æ€§
                    }},
                    { htmlContent: 'ã€æ‹’ç»ã€‘', callback: () => {
                        showEventCard('å©‰æ‹’å¥½æ„', 'fa-hand-paper', 'ä½ æ‹’ç»äº†å¯¹æ–¹çš„å¥½æ„ã€‚å¥½æ„Ÿ-5ã€‚');
                        applyEffects({ relationship: { targetId: npcId, favor: -5 } });
                    }}
                ]
            );
            break;
           }
        case 'become_sworn': {
            rel.type = 'sworn_sibling';
            const swornType = player.gender === 'male' ? 'å…„å¼Ÿ' : 'å§å¦¹';
            showEventCard('ä¹‰ç»“é‡‘å…°', 'fa-hands-helping', `ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> ç„šé¦™ç»“æ‹œï¼Œä»æ­¤ç¥¸ç¦ä¸å…±ï¼Œæˆä¸ºç”Ÿæ­»ä¸ç¦»çš„${swornType}ï¼`);
            break;
        }
        // --- æƒ…äººäº’åŠ¨ ---
        case 'rendezvous':
            showEventCard('æœˆä¸‹ä¹‹çº¦', 'fa-kiss-wink-heart', 'ä½ ä»¬åœ¨æœˆå½±èŠ±é¦™ä¸­äº’è¯‰è¡·è‚ ï¼Œæƒ…æ„æ›´æµ“ã€‚å¥½æ„Ÿ+20ã€‚');
            applyEffects({ relationship: { targetId: npcId, favor: 20 } });
            if (player.gender === 'female' && Math.random() < 0.2) { // å¥³æ€§ç©å®¶æœ‰æœºä¼šæ€€å­•
                triggerBirth(npcId, true); 
            }
            break;
        // æ›´å¤šæƒ…äººäº‹ä»¶å¯ä»¥åŠ åœ¨è¿™é‡Œ...
        default:
            showToast(`ä½ å’Œ${npc.name}è¿›è¡Œäº†â€œ${interaction.name}â€äº’åŠ¨ï¼Œå¢è¿›äº†æ„Ÿæƒ…ã€‚`);
            applyEffects({ relationship: { targetId: npcId, favor: 5 } });
            break;
    }

    updateRelationshipLevel(npcId);
    showNPCDetails(npcId);
}
// ã€æ–°å¢çš„ç¼ºå¤±å‡½æ•°ã€‘å¤„ç†ç§ç”Ÿå­å†³å®š
// [æ›¿æ¢æ­¤å‡½æ•°]
function handleSecretChildDecision(childId, decision, onComplete = () => {}) {
    const childIndex = gameState.children.findIndex(c => c.id === childId);
    if (childIndex === -1) {
        if(onComplete) onComplete();
        return;
    }
    const child = gameState.children[childIndex];
    if (decision === 'keep') {
        if(gameState.player.gender === 'female'){
            child.isLegitimate = false; // æ ‡è®°ä¸ºéå©šç”Ÿ
            child.fatherId = null; // åˆæ³•çˆ¶äº²ä¸ºç©º
        }
        child.isSecret = false; // å˜ä¸ºå…¬å¼€ï¼Œä½†èº«ä»½ç‰¹æ®Š
        const motherName = gameState.npcs[child.motherId] ? gameState.npcs[child.motherId].name : 'ä½ ';
        showNameChildOverlay(childId, motherName, false); 
        logEvent(`ä½ å†³å®šè®¤ä¸‹ä¸<strong class="highlight-npc">${gameState.npcs[child.biologicalFatherId].name}</strong>çš„ç§ç”Ÿå­ï¼Œå¹¶å°†å…¶å¸¦å›åºœä¸­æŠšå…»ã€‚`);
    } else { // abandon
        gameState.children.splice(childIndex, 1);
        applyEffects({ attributes: { virtue: -20 } });
        showEventCard('ç‹ å¿ƒé—å¼ƒ', 'fa-user-times', 'ä½ ç‹ ä¸‹å¿ƒï¼Œå°†è¿™ä¸ªæ— è¾œçš„å­©å­é—å¼ƒã€‚ä½ çš„å“å¾·å¤§å¹…ä¸‹é™ã€‚');
        closeAllOverlays();
        if(onComplete) onComplete();
    }
}
function confirmPlayerNaming(childId) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    const newNameInput = document.getElementById('newChildNameInput');
    let trimmedName = newNameInput.value.trim();
    
    if (trimmedName.length === 0 || trimmedName.length > 3) {
        showToast("åå­—é•¿åº¦ä¸åˆè§„ï¼ˆ1-3ä¸ªå­—ï¼‰ï¼Œå·²äº¤ç”±é…å¶å‘½åã€‚");
        autoNameBySpouse(childId); // å¦‚æœè¾“å…¥ä¸åˆè§„ï¼Œè‡ªåŠ¨è®©é…å¶å–å
        return;
    }
    
    // åå­—åˆè§„ï¼Œè°ƒç”¨æœ€ç»ˆå‘½åé€»è¾‘
    finalizeChildName(childId, trimmedName, 'ä½ ');
}

function finalizeChildName(childId, givenName, namer) {
    const child = gameState.children.find(c => c.id === childId);
    if (!child) return;

    let surname = '';
    // ä¼˜å…ˆä½¿ç”¨åˆæ³•çˆ¶äº²çš„å§“
    const legalFather = child.fatherId ? (gameState.npcs[child.fatherId] || (child.fatherId === 'player' ? gameState.player : null)) : null;
    const biologicalFather = child.biologicalFatherId ? gameState.npcs[child.biologicalFatherId] : null;

    if (legalFather && legalFather.name) {
        surname = legalFather.name.slice(0, 1);
    } 
    // å…¶æ¬¡ä½¿ç”¨ç”Ÿç‰©å­¦çˆ¶äº²çš„å§“
    else if (biologicalFather && biologicalFather.name) {
        surname = biologicalFather.name.slice(0, 1);
    } 
    // æœ€åä½¿ç”¨ç©å®¶çš„å§“ä½œä¸ºå¤‡ç”¨
    else {
        surname = gameState.player.name.slice(0, 1);
    }

    let finalName = surname + givenName;
    
    // æŸ¥é‡
    let i = 2;
    const originalGivenName = givenName;
    while (gameState.flags.allNames.has(finalName)) {
        givenName = originalGivenName + (i === 2 ? 'äºŒ' : 'ä¸‰');
        finalName = surname + givenName;
        i++;
    }
    
    child.name = finalName;
    gameState.flags.allNames.add(finalName);
    
    const message = namer === 'ä½ '
        ? `ä½ ä¸ºæ–°ç”Ÿå„¿å–åä¸º <strong class="value">${child.name}</strong>ã€‚`
        : `${namer}æ€ç´¢ç‰‡åˆ»ï¼Œä¸ºå­©å­å–åä¸º <strong class="value">${child.name}</strong>ã€‚`;
        
    showEventCard('å¤©èµä½³å', 'fa-pen-fancy', message);
    closeAllOverlays();
    renderGame();
}
function checkRelationshipBreakup() {
    if (!gameState.social.relationships) return;

    for (const npcId in gameState.social.relationships) {
        const rel = gameState.social.relationships[npcId];
        const npc = gameState.npcs[npcId];
        if (!npc || npc.isDead) continue;

        let shouldBreak = false;
        let breakReason = "";

        if (npc.favor <= -50) {
            shouldBreak = true;
            breakReason = "ä½ ä»¬ä¹‹é—´å·²æ— æƒ…åˆ†å¯è¨€ã€‚";
        }

        const currentTurn = gameState.date.year * 2 + gameState.date.turn;
        if (currentTurn - (npc.lastInteractedTurn || 0) > 6) { // è¶…è¿‡3å¹´æœªäº’åŠ¨
             rel.emotionValue = Math.max(0, (rel.emotionValue || 0) - 10); 
             if (rel.emotionValue <= 0 && rel.level <= 1) { 
                shouldBreak = true;
                breakReason = "ç”±äºé•¿æœŸä¸è”ç³»ï¼Œä½ ä»¬çš„æƒ…è°Šå·²æ¸æ¸æ¶ˆæ•£ã€‚";
             }
        }

        if (shouldBreak) {
            const oldRelName = RELATIONSHIP_DATA[rel.type]?.name || "æ—§å‹";
            eventQueue.push(() => {
                showEventCard('å…³ç³»ç ´è£‚', 'fa-user-slash', `ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong>ï¼ˆ${oldRelName}ï¼‰çš„å…³ç³»èµ°åˆ°äº†å°½å¤´ã€‚${breakReason}`);
            });
            delete gameState.social.relationships[npcId];
            gameState.social.secretLovers = gameState.social.secretLovers.filter(id => id !== npcId);
        }
    }
}
function developRelationship(npcId, newType) {
    if (!gameState.social.relationships[npcId]) {
        gameState.social.relationships[npcId] = {
            type: newType,
            favor: gameState.npcs[npcId].favor,
            emotionValue: 0, // æ–°å¢
            level: 0,          // æ–°å¢
            eventsExperienced: 0, // æ–°å¢
            isSworn: false     // æ–°å¢
        };

        const relData = RELATIONSHIP_DATA[newType];
        if (relData) {
            showEventCard('å…³ç³»å‡æ¸©', 'fa-heart', `ä½ ä¸ <strong class="highlight-npc">${gameState.npcs[npcId].name}</strong> çš„å…³ç³»æ›´è¿›ä¸€æ­¥ï¼Œæˆä¸ºäº†${relData.name}ï¼`);
        }
        
        // ä»å¯ç»“äº¤å¯¹è±¡ä¸­ç§»é™¤
        gameState.suitors = gameState.suitors.filter(id => id !== npcId);
    }
    showNPCDetails(npcId);
}
function giveAllowanceToParent(parentId) {
    const parent = gameState.npcs[parentId];
    if (gameState.player.age < 15) { showToast("ä½ å°šæœªæˆå¹´ï¼Œè¿˜æ— éœ€æ‰¿æ‹…èµ¡å…»ä¹‹è´£ã€‚"); return; }
    const amountStr = prompt(`è¯·è¾“å…¥è¦å­æ•¬${parent.name}çš„é‡‘é¢ï¼š`, "100");
    const amount = parseInt(amountStr);
    if(isNaN(amount) || amount <= 0) return;
    if(gameState.finances.wealth < amount) { showToast("ç§äº§ä¸è¶³ã€‚"); return; }

    parent.lastInteractedTurn = (gameState.date.year * 2) + gameState.date.turn;
    applyEffects({ wealth: -amount, relationship: { targetId: parentId, favor: Math.floor(amount / 20) }, attributes: { virtue: Math.floor(amount/50)} });
    showEventCard('æ‹³æ‹³å­å¿ƒ', 'fa-hand-holding-heart', `ä½ å­æ•¬äº†${parent.name} <span class='value'>${amount}</span> ä¸¤ï¼Œä»–ä»¬å¯¹ä½ èµä¸ç»å£ã€‚`);
    showNPCDetails(parentId);
}

// ===================== ã€æ›¿æ¢ã€‘showMatchmaker å‡½æ•° =====================
function showMatchmaker(forConcubine = false) {
    let content = forConcubine
    ? `<p>ä½ æ­£åœ¨ä¸ºè‡ªå·±ç‰©è‰²å¦¾å®¤äººé€‰... ä½ å¯ä»¥èŠ±è´¹<span class="value">1500</span>ä¸¤ç›´æ¥çº³ä¸€ä½èº«å®¶æ¸…ç™½çš„å§‘å¨˜ä¸ºå¦¾ã€‚</p>`
    : `<p>åª’å©†çƒ­æƒ…åœ°æ¥å¾…äº†ä½ ï¼Œå‘ä½ ä¿è¯èƒ½ä»‹ç»åˆé€‚çš„ä¼´ä¾£ã€‚</p>`;
    let options = [];
    if (!forConcubine) {
        if(!gameState.marriage.isMarried && gameState.player.age >= 16) {
             // ã€æ ¸å¿ƒä¿®æ”¹ã€‘è¿™é‡Œçš„ callback äº‹ä»¶è¢«æ›¿æ¢äº†ï¼Œç°åœ¨ä¼šè°ƒç”¨æ–°çš„è®®äº²æµç¨‹
             options.push({
                htmlContent:`<i class="fas fa-ring"></i> å®‰æ’è®®äº² (-3000ä¸¤)`, 
                disabled:gameState.finances.wealth<3000, 
                callback:() => {
                    if (gameState.finances.wealth < 3000) {
                        showToast("ä½ çš„é’±ä¸å¤Ÿæ”¯ä»˜åª’äººè´¹ã€‚");
                        return;
                    }
                    applyEffects({wealth: -3000});
                    showPlayerArrangedMarriage(); // è°ƒç”¨æ–°å‡½æ•°ï¼Œå±•ç¤ºå€™é€‰äººåˆ—è¡¨
                }
             });
        }
    } else {
        if(gameState.marriage.concubines.length >= 5) {
            content += `<p class="comment">å¦¾å®¤åé¢å·²æ»¡ã€‚</p>`
        } else {
             options.push({htmlContent:`<i class="fas fa-user-plus"></i> ç›´æ¥çº³å¦¾ (-1500ä¸¤)`, disabled:gameState.finances.wealth<1500, callback:() => hireMatchmaker('female', true, false, 1500)});
        }
    }
    showDecisionCard("é‡‘ç‰Œåª’å©†", "ğŸ¤", content, options);
}

function hireMatchmaker(gender, forConcubine = false, forMarriage = false, cost) {
    if (gameState.finances.wealth < cost) { showToast("ä½ çš„é’±ä¸å¤Ÿæ”¯ä»˜åª’äººè´¹ã€‚"); return; }
    applyEffects({wealth: -cost});

    const backgrounds = gender === 'female' ? ladyBackgrounds : suitorBackgrounds;
    const bg = getRandomElement(backgrounds);
    const newNpc = generateNPC({ 
        gender: gender, age: getRandomInt(gameState.player.age, gameState.player.age + 5), 
        favor: 5, source: 'matchmaker',
        attributes: {...bg.attributes, family: bg.family},
        relationship: forMarriage ? 'spouse' : (forConcubine ? 'concubine' : 'suitor')
    });

    if (forMarriage) {
        marrySuitor(newNpc.id);
    } else if (forConcubine) {
        acquireConcubine(newNpc.id);
    } else {
        if(newNpc.gender !== gameState.player.gender) {
            gameState.suitors.push(newNpc.id)
        } else {
            gameState.social.friends.push(newNpc.id)
        }
        showEventCard('åª’äººå¼•è', 'fa-user-friends', `åª’å©†ä¸ºä½ ä»‹ç»äº† <strong class="highlight-npc">${newNpc.name}</strong>ï¼Œä½ ä»¬äº’æ¢äº†åå¸–ã€‚`);
    }
    renderGame();
}

// =======================================================================
// ============================= THEME & VISUALS =========================
// =======================================================================
function setTheme(theme) {
    document.body.dataset.theme = theme;
    
    const themeIcons = document.querySelectorAll('.theme-icon');
    if (themeIcons.length > 0) {
        themeIcons.forEach(icon => icon.classList.remove('active'));
        const activeIcon = document.getElementById(`theme-${theme}`);
        if (activeIcon) { 
            activeIcon.classList.add('active');
        }
    }
    
    updateParticles(theme);
}
function updateParticles(theme) {
    const container = document.getElementById('particle-container');
    if(!container) return;
    container.innerHTML = '';
    const particleConfig = {
        spring: { content: 'ğŸŒ¸', count: 15 },
        summer: { content: 'ğŸƒ', count: 15 },
        autumn: { content: 'ğŸ‚', count: 15 },
        winter: { content: 'â„ï¸', count: 20 },
        night: { content: 'âœ¨', count: 25 },
    };
    if (!particleConfig[theme]) return;
    const config = particleConfig[theme];
    for (let i = 0; i < config.count; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.innerHTML = config.content;
        particle.style.left = `${Math.random() * 100}vw`;
        const delay = Math.random() * 5;
        const duration = Math.random() * 5 + 5;
        particle.style.animation = `fall ${duration}s ${delay}s linear forwards`;
        particle.style.fontSize = `${Math.random() * 10 + 10}px`;
        container.appendChild(particle);
    }
}
// ===================== ã€æ–°å¢ã€‘å¥åº·ä¸Šé™ä¸è‡ªç„¶æ­»äº¡åˆ¤å®šæ ¸å¿ƒå‡½æ•° START =====================
function updateHealthCapsAndCheckDeath() {
    const player = gameState.player;
    let newHealthMax = 100;
    let deathChance = 0;
    const age = Math.floor(player.age);

    // 1. æ ¹æ®å¹´é¾„æ›´æ–°ç©å®¶å¥åº·ä¸Šé™
    if (age >= 100) newHealthMax = 25;
    else if (age >= 90) newHealthMax = 30;
    else if (age >= 80) newHealthMax = 45;
    else if (age >= 70) newHealthMax = 55;
    else if (age >= 60) newHealthMax = 70;
    else if (age >= 50) newHealthMax = 80;
    
    // ã€ä¿®æ”¹ã€‘å½“å¥åº·ä¸Šé™å˜åŒ–æ—¶ï¼Œå¢åŠ æ—¥å¿—è®°å½•
    if (!player.attributes.healthMax || player.attributes.healthMax !== newHealthMax) {
        player.attributes.healthMax = newHealthMax;
        logEvent(`å¹´å²æ¸é•¿ï¼Œä½ æ—¶å¸¸æ„Ÿåˆ°åŠ›ä¸ä»å¿ƒï¼Œèº«ä½“æœºèƒ½æœ‰æ‰€ä¸‹é™ï¼Œå¥åº·ä¸Šé™è°ƒæ•´ä¸º <strong class="value">${newHealthMax}</strong>ã€‚`, true);
    }
    player.health = Math.min(player.health, player.attributes.healthMax);

    // 2. åˆ¤å®šç©å®¶è‡ªç„¶æ­»äº¡
    if (age >= 80) {
        if (gameState.flags.impendingDoom === 1) {
            deathChance = 0.8; 
        } else {
            deathChance = (age - 79) * 0.02;
        }
        
        // ã€ä¿®æ”¹ã€‘è§¦å‘æ­»äº¡é¢„è­¦æ—¶ï¼Œå¢åŠ æ—¥å¿—è®°å½•
        if (age >= 79 && !gameState.flags.impendingDoom) {
            if (Math.random() < (0.3 + (age - 79) * 0.1)) {
                gameState.flags.impendingDoom = 3;
                logEvent('ä½ è¿‘æ¥æ—¶å¸¸æ„Ÿåˆ°å¿ƒæ‚¸ä¹åŠ›ï¼Œä¼¼ä¹å¤§é™å°†è‡³ï¼Œå¿ƒä¸­ä¸å…æˆšç„¶ã€‚', true);
            }
        }
    }
    
    if (deathChance > 0 && Math.random() < deathChance) {
        logEvent('å¤©å‘½å·²è‡³ï¼Œä½ åœ¨ç¡æ¢¦ä¸­å®‰è¯¦åœ°ç¦»å¼€äº†äººä¸–ã€‚', true); // ã€ä¿®æ”¹ã€‘å¢åŠ æ­»äº¡è®°å½•
        showEndGame({ title: "å¯¿ç»ˆæ­£å¯", text: `ä½ å®‰è¯¦åœ°èµ°å®Œäº†${age}å²çš„äººç”Ÿã€‚` });
        return true;
    }

    // 3. åˆ¤å®šNPCè‡ªç„¶æ­»äº¡
    Object.values(gameState.npcs).forEach(npc => {
        if (!npc || npc.isDead || npc.id === 'player') return;
        const npcAge = Math.floor(npc.age);
        let npcDeathChance = 0;
        if (npcAge >= 90) npcDeathChance = 0.6;
        else if (npcAge >= 80) npcDeathChance = 0.25;
        else if (npcAge >= 70) npcDeathChance = 0.1;

        if (npcDeathChance > 0 && Math.random() < npcDeathChance) {
            npc.isDead = true;
            const role = npc.role || 'å‹äºº';
            // ã€ä¿®æ”¹ã€‘ä¼˜åŒ–NPCæ­»äº¡è®°å½•
            logEvent(`ä½ çš„${role} <strong class="highlight-npc">${npc.name}</strong> å¯¿ç»ˆæ­£å¯ï¼Œäº«å¹´${npcAge}å²ã€‚`, true);
            eventQueue.push(() => {
                showEventCard('æ•…äººè¥¿è¾', 'ğŸ•¯ï¸', `å²æœˆæ— æƒ…ï¼Œä½ çš„${role} <strong class="highlight-npc">${npc.name}</strong> å·²å¯¿ç»ˆæ­£å¯ï¼Œä½ æ„Ÿåˆ°ååˆ†æ‚²ä¼¤ã€‚`);
            });
        }
    });

    return false;
}
// ===================== ã€æ–°å¢ã€‘å¥åº·ä¸Šé™ä¸è‡ªç„¶æ­»äº¡åˆ¤å®šæ ¸å¿ƒå‡½æ•° END =====================

// =======================================================================
// ========================== END GAME & INHERITANCE =====================
// =======================================================================
function checkEndGame() {
    let reason = null;
    const age = Math.floor(gameState.player.age);
    if (gameState.player.health <= 0) reason = { title: "æ²¹å°½ç¯æ¯", text: `ä½ å› å¥åº·è€—å°½è€Œé€ï¼Œå¹´ä»…${age}å²ã€‚` };
    if (age >= 100) reason = { title: "å¯¿ç»ˆæ­£å¯", text: `ä½ å®‰è¯¦åœ°èµ°å®Œäº†ç™¾å²äººç”Ÿï¼Œç¦å¯¿åŒå…¨ã€‚` };
    if (age >= 70 && Math.random() < ((age - 69) * 0.02) ) reason = { title: "å¯¿ç»ˆæ­£å¯", text: `ä½ å®‰è¯¦åœ°èµ°å®Œäº†${age}å²çš„äººç”Ÿã€‚` };
    if (gameState.finances.wealth < -20000) reason = { title: "å€¾å®¶è¡äº§", text: `ä½ è´Ÿå€ºç´¯ç´¯ï¼Œæœ€ç»ˆå‡„å‡‰ç¦»ä¸–ï¼Œå¹´ä»…${age}å²ã€‚` };

    if (reason) {
        showEndGame(reason);
        return true;
    }
    return false;
}
function showEndGame(reasonData) {
    // æ¸¸æˆç»“æŸæ—¶ï¼Œä¸å†æ˜¾ç¤ºæ—§çš„ç»§æ‰¿ç•Œé¢ï¼Œè€Œæ˜¯å¯åŠ¨å¤©å‘½è½®å›å½•ç³»ç»Ÿ
    startDestinyCycle();
}
function handleChildInheritance() {
    const heirs = gameState.children.filter(c => c.age >= 16 && !c.isDead);
    if (heirs.length === 0) {
        showToast("ä½ æ²¡æœ‰æˆå¹´çš„å­å—£å¯ä»¥ç»§æ‰¿ã€‚");
        return;
    }

    let options = heirs.map(heir => {
        return {
            htmlContent: `<i class="fas fa-user-graduate"></i> <strong>${heir.name}</strong> (${heir.career ? heir.career.name : 'æœªå°±èŒ'})`,
            callback: () => restartGame(heir)
        };
    });

    showDecisionCard('é€‰æ‹©ç»§æ‰¿äºº', 'fa-crown', 'è¯·é€‰æ‹©ä¸€ä½åä»£å¼€å¯æ–°çš„äººç”Ÿï¼š', options);
}


// ===================== ã€ç¬¬äºŒæ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * [V5.1 æ ¸å¿ƒç»§æ‰¿å‡½æ•°] æ–°å¢å­™è¾ˆç»§æ‰¿è§„åˆ™
 * @param {object} heirData - è¢«é€‰ä¸ºç»§æ‰¿äººçš„å­å—£å¯¹è±¡ã€‚
 * @param {object} [inheritancePackage=null] - [å¯é€‰] æ¥è‡ªâ€œæ‰¿ä¸–ä¹¦â€çš„ç»§æ‰¿åŒ…è£¹ã€‚
 */
function restartGame(heirData, inheritancePackage = null) {
    if (!heirData) {
        startNewGame(gameState.player.gender);
        return;
    }
    const oldGameState = gameState;
    const newPlayer = JSON.parse(JSON.stringify(heirData));
    newPlayer.id = 'player';
    newPlayer.favor = 50;
    newPlayer.age = heirData.age;
    newPlayer.health = heirData.attributes.health;

    let newGameState = {
        // ... (æ­¤å¤„çœç•¥äº†æ‰€æœ‰gameStateçš„åŸºç¡€ç»“æ„å®šä¹‰ï¼Œä¸æ‚¨ä¸Šä¸€ç‰ˆä»£ç ä¸€è‡´) ...
        tradingSystem: { isTradingPeriod: false, moneyChest: 1000, warehouse: [], warehouseCapacity: WAREHOUSE_LEVELS[0].capacity, tradeLog: [], guildFavor: { east: 0, west: 0, south: 0, north: 0 }, marketStatus: { fluctuations: [], prices: {} } },
        version: 11.0, player: newPlayer,
        family: { surname: newPlayer.name.slice(0, 1), title: `${oldGameState.player.name}ä¹‹å­™/å­™å¥³`, reputation: Math.floor(oldGameState.family.reputation * 0.5), annualIncome: 1000, members: {}, moneyChest: 0 },
        finances: { wealth: heirData.personalWealth || 0, financialTier: 1, assets: [], merchantLog: [] },
        merchant: { investments: [], ownedLand: {}, activeCrops: [], seaExplorationCooldown: 0, fleetLevel: 0, voyageCycle: null },
        date: { year: Math.floor(heirData.age), turn: 1 }, log: [], npcs: {},
        social: { relationships: {}, friends: [], secretLovers: [], swornSiblings: [], friendshipStats: { confidanteCount: 0, swornSiblingCount: 0 }, loverStats: { infidelityValue: 0, stimulationValue: 0, jealousyCooldown: 0 } },
        marriage: { isMarried: heirData.marriage.isMarried, spouseId: heirData.marriage.spouseId, favor: 80, concubines: heirData.marriage.concubines || [], householdAuthorityHolder: 'player', familyHarmony: 70, householdAuthority: { progress: 100, personnel: 100, finance: 100, procurement: 100 } },
        children: [],
        suitors: [],
        career: heirData.career || { path: null, level: 0, currentAct: 0, performance: 0, supervisorId: null, core_resources: {} },
        inventory: [], status: { disease: null },
        flags: { allNames: new Set([newPlayer.name]), debug_unlimitedActions: false, actionUsed_study: 0, actionUsed_family: false, actionUsed_work: 0, activeTab: 'main', gameStarted: true, autoSaveCounter: 0, brothelVisitCount: 0, wishingWellThisTurn: false, actionUsed_apprentice: 0, },
        rankings: { list: [], playerRank: -1 }, buffs: {},
    };

    if (inheritancePackage) {
        for (const attr in inheritancePackage.effects.attributes) {
            newGameState.player.attributes[attr] = (newGameState.player.attributes[attr] || 0) + inheritancePackage.effects.attributes[attr];
        }

        // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ã€‘å…¨æ–°çš„è´¢äº§ç»§æ‰¿è§„åˆ™ â–¼â–¼â–¼
        const previousPlayerTotalWealth = inheritancePackage.previousWealth || 0;
        let inheritanceRatio = 0;
        
        // 1. å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºå­™è¾ˆ
        const isDirectChild = heirData.fatherId === 'player' || heirData.motherId === 'player' || heirData.fatherId === oldGameState.marriage.spouseId || heirData.motherId === oldGameState.marriage.spouseId;

        if (!isDirectChild) {
            // æ˜¯å­™è¾ˆï¼Œåº”ç”¨80%è§„åˆ™
            inheritanceRatio = 0.8;
            logEvent(`ä½œä¸ºå­™è¾ˆï¼Œä½ ç»§æ‰¿äº†ä¸Šä¸€ä»£å®¶äº§çš„80%ã€‚`);
        } else {
            // æ˜¯äº²ç”Ÿå­å—£ï¼Œæ²¿ç”¨æ—§çš„å«¡åº¶è§„åˆ™
            if (heirData.isSecret) {
                inheritanceRatio = 1/3;
                logEvent(`ä½œä¸ºç§ç”Ÿå­ï¼Œä½ ç»§æ‰¿äº†ä¸Šä¸€ä»£å®¶äº§çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚`);
            } else if (heirData.motherId === oldGameState.marriage.spouseId || (oldGameState.player.gender === 'female' && heirData.fatherId === 'player')) {
                inheritanceRatio = 1;
                logEvent(`ä½œä¸ºå«¡å­ï¼Œä½ ç»§æ‰¿äº†ä¸Šä¸€ä»£çš„å…¨éƒ¨å®¶äº§ã€‚`);
            } else {
                inheritanceRatio = 0.5;
                logEvent(`ä½œä¸ºåº¶å‡ºå­å—£ï¼Œä½ ç»§æ‰¿äº†ä¸Šä¸€ä»£å®¶äº§çš„ä¸€åŠã€‚`);
            }
        }
        newGameState.finances.wealth += Math.floor(previousPlayerTotalWealth * inheritanceRatio);
        // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²

        newGameState.player.privateAssets = (newGameState.player.privateAssets || 0) + (inheritancePackage.effects.privateAssets || 0);
        newGameState.family.reputation += (inheritancePackage.effects.reputation || 0);
        inheritancePackage.effects.items.forEach(item => {
            if (item.type !== 'BUFF') {
                newGameState.inventory.push({ id: item.id, amount: 1, instanceId: `item_${Date.now()}` });
                if (!ITEM_DATA[item.id]) ITEM_DATA[item.id] = item;
            }
        });
        Object.assign(newGameState.flags, inheritancePackage.effects.flags);
    }
    
    // ... (åç»­çš„äººé™…å…³ç³»ã€å®¶è°±å¤„ç†é€»è¾‘ä¿æŒä¸å˜) ...
    newGameState.npcs['player'] = newPlayer;
    const fatherNPC = { id: 'father', name: oldGameState.player.name, gender: oldGameState.player.gender, age: oldGameState.player.age, isDead: true, role: 'çˆ¶äº² (ä¸Šä¸€ä»£)' };
    const motherNPC = { id: 'mother', name: oldGameState.npcs[oldGameState.marriage.spouseId]?.name || 'æ¯äº²', gender: 'female', age: oldGameState.npcs[oldGameState.marriage.spouseId]?.age || oldGameState.player.age, isDead: true, role: 'æ¯äº² (ä¸Šä¸€ä»£)' };
    newGameState.npcs[fatherNPC.id] = fatherNPC;
    newGameState.npcs[motherNPC.id] = motherNPC;
    newGameState.family.members['fatherId'] = fatherNPC.id;
    newGameState.family.members['motherId'] = motherNPC.id;
    
    const grandchildren = oldGameState.children.filter(c => c.fatherId === heirData.id || c.motherId === heirData.id);
    newGameState.children = grandchildren;
    
    const grandchildrenSpouseIds = grandchildren.map(gc => gc.marriage.spouseId).filter(id => id);
    
    const relevantNpcIds = new Set([
        newPlayer.marriage.spouseId,
        ...grandchildren.map(gc => gc.id),
        ...grandchildrenSpouseIds
    ].filter(Boolean));

    relevantNpcIds.forEach(npcId => {
        if (oldGameState.npcs[npcId]) {
            newGameState.npcs[npcId] = JSON.parse(JSON.stringify(oldGameState.npcs[npcId]));
            if (newGameState.npcs[npcId].name) {
                newGameState.flags.allNames.add(newGameState.npcs[npcId].name);
            }
        }
    });

    gameState = newGameState;
    initApprenticeSystem();
    initTradeSimState();
    updateFinancialTier();
    closeAllOverlays();
    logEvent(`ä½ ä½œä¸º <strong class="value">${newPlayer.name}</strong>ï¼Œç»§æ‰¿äº†å…ˆè¾ˆçš„é—å¿—ï¼Œä»${Math.floor(newPlayer.age)}å²å¼€å¯äº†æ–°çš„äººç”Ÿã€‚`, true);
    renderGame();
}
// =======================================================================
// ===================== ã€æ›¿æ¢æ­¤å‡½æ•°ã€‘setupNewGame =====================
// =======================================================================
// ===================== ã€setupNewGame å‡½æ•°çš„å¾®è°ƒã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function setupNewGame(gender, inheritanceData = null, options = {}) {
    const family = getRandomElement(familyTemplates);
    const allNames = new Set();
    let startAge = 10;
    let playerName, playerAvatar, initialAttributes, initialReputation;

    if (inheritanceData) {
        const { name, age, avatar, baseAttributes, effects } = inheritanceData;
        startAge = age;
        playerName = name;
        playerAvatar = avatar;
        initialAttributes = { ...baseAttributes };
        for (const attr in effects.attributes) {
            initialAttributes[attr] = (initialAttributes[attr] || 0) + effects.attributes[attr];
        }
        initialReputation = initialAttributes.reputation || 0;
    } else {
        playerName = family.surname + (gender === 'female' ? getRandomElement(nameData.girlNames) : getRandomElement(nameData.boyNames));
        playerAvatar = getRandomElement(avatarPools[gender]);
        initialAttributes = {
            talent: getRandomInt(20, 35), etiquette: getRandomInt(20, 35),
            wisdom: getRandomInt(15, 30), virtue: getRandomInt(15, 30),
            charm: getRandomInt(20, 35), martial: getRandomInt(5, 20),
        };
         initialReputation = family.reputation;
    }

    allNames.add(playerName);
    if (gender === 'male') {
        initialAttributes.strategy = initialAttributes.strategy || getRandomInt(10, 25);
        initialAttributes.prestige = initialAttributes.prestige || getRandomInt(10, 25);
    } else {
        initialAttributes.scheming = initialAttributes.scheming || getRandomInt(10, 25);
    }

    gameState = {
        tradingSystem: { isTradingPeriod: false, moneyChest: 1000, warehouse: [], warehouseCapacity: WAREHOUSE_LEVELS[0].capacity, tradeLog: [], guildFavor: { east: 0, west: 0, south: 0, north: 0 }, marketStatus: { fluctuations: [], prices: {} } },
        version: 11.0,
        player: {
            id: 'player', name: playerName, gender: gender, age: startAge,
            health: 100, attributes: initialAttributes,
            avatar: playerAvatar, level: 1, privateAssets: 0, actionPoints: 1
        },
        family: {
            surname: inheritanceData ? playerName.slice(0,1) : family.surname,
            title: family.title,
            reputation: initialReputation,
            annualIncome: family.annualIncome,
            color: family.color, members: {}, moneyChest: 0
        },
        finances: { wealth: family.wealth, financialTier: 1, assets: [], merchantLog: [] },
        merchant: { investments: [], ownedLand: {}, activeCrops: [], seaExplorationCooldown: 0, fleetLevel: 0, voyageCycle: null },
        date: { year: Math.floor(startAge), turn: 1 }, log: [], npcs: {},
        social: { relationships: {}, friends: [], secretLovers: [], swornSiblings: [], friendshipStats: { confidanteCount: 0, swornSiblingCount: 0 }, loverStats: { infidelityValue: 0, stimulationValue: 0, jealousyCooldown: 0 } },
        marriage: { isMarried: false, spouseId: null, favor: 0, concubines: [], householdAuthorityHolder: 'mother', familyHarmony: 70, householdAuthority: { progress: 0, personnel: 0, finance: 0, procurement: 0 } },
        children: [], suitors: [],
        career: { path: null, level: 0, currentAct: 0, performance: 0, supervisorId: null, core_resources: {} },
        inventory: [], status: { disease: null },
        flags: {
            allNames: allNames, debug_unlimitedActions: false, actionUsed_study: 0, actionUsed_family: false, actionUsed_work: 0, activeTab: 'main', gameStarted: true, triggeredAge12Event: false, autoSaveCounter: 0, brothelVisitCount: 0, wishingWellThisTurn: false, actionUsed_apprentice: 0, childhoodSweetheartId: null, bondValue: 0, hasMetSweetheart: false, triggeredSweetheartEvents: [], proposal_bonus: false, mother_support: false, fatedLoverId: null, fatedLoverQuestStep: 0,
            swornProposalFrom: {},
            loverProposalFrom: {},
            marriageProposalFrom: {}
        },
        // ã€æ–°å¢ã€‘ç”¨äºå­˜æ”¾å¾…å¤„ç†çš„ç•Œé¢äº‹ä»¶
        pendingUiEvents: {
            social: [], career: [], marriage: [], children: [], merchant: []
        },
        rankings: { list: [], playerRank: -1 }, buffs: {},
    };

    if (inheritanceData) {
        const { effects, previousCareerPath, previousWealth } = inheritanceData;
        gameState.finances.wealth += Math.floor(previousWealth * (effects.bonuses.wealthMultiplier || 0));
        gameState.player.privateAssets += (effects.privateAssets || 0);
        gameState.family.reputation += (effects.reputation || 0);
        Object.assign(gameState.flags, effects.flags);
        effects.items.forEach(item => {
            if (item.type !== 'BUFF') {
                addItemToInventory(item.id, 1, item);
            }
        });
        const careerNameFromInheritance = inheritanceData.career ? inheritanceData.career.name : null;
        const chosenCareer = CAREER_CHINESE_TO_ENGLISH_MAP[careerNameFromInheritance];
        if(effects.bonuses.careerLevelBonus && chosenCareer && chosenCareer === previousCareerPath) {
            gameState.career.path = chosenCareer;
            gameState.career.level = 1;
        }
    }

    initApprenticeSystem();
    initTradeSimState();
    gameState.npcs['player'] = gameState.player;
    const fatherName = options.parents?.father || (family.surname + "å…¬");
    const motherName = options.parents?.mother || (getRandomElement(nameData.surnames) + "æ°");
    const father = generateNPC({ id:'father', gender: 'male', age: gameState.player.age + 22, name: fatherName, role: 'çˆ¶äº²', relationship: 'family', favor: 50 });
    const mother = generateNPC({ id:'mother', gender: 'female', age: gameState.player.age + 20, name: motherName, role: 'æ¯äº²', relationship: 'family', favor: 50 });
    gameState.family.members['fatherId'] = father.id;
    gameState.family.members['motherId'] = mother.id;

    fengYueJianData.courtesans.forEach(courtesanDef => {
        const npc = generateNPC({ id: courtesanDef.id, name: courtesanDef.name, gender: 'female', age: getRandomInt(18, 25), title: courtesanDef.title, role: 'é£æœˆé‰´ä½³äºº', relationship: 'courtesan', favor: 30, attributes: { charm: getRandomInt(85, 98), talent: getRandomInt(70, 90), wisdom: getRandomInt(60, 85) }, baseData: courtesanDef, firstIntimateCost: fengYueJianData.sleep.first_cost, avatar: getRandomElement(avatarPools['female']) });
    });

    const sweetheartGender = gender === 'male' ? 'female' : 'male';
    const sweetheartBg = getRandomElement(sweetheartGender === 'female' ? ladyBackgrounds : suitorBackgrounds);
    const sweetheart = generateNPC({ gender: sweetheartGender, age: gameState.player.age, favor: 50, role: 'é’æ¢…ç«¹é©¬', attributes: sweetheartBg.attributes });
    gameState.flags.childhoodSweetheartId = sweetheart.id;

    if (inheritanceData) {
        logEvent(`ä½ ä½œä¸º <strong class="value">${playerName}</strong>ï¼Œç»§æ‰¿äº†å…ˆè¾ˆçš„é—å¿—ä¸éƒ¨åˆ†è´¢å¯Œï¼Œä»${Math.floor(startAge)}å²å¼€å¯äº†æ–°çš„äººç”Ÿã€‚`, true);
    } else {
        logEvent(`ä½ å‡ºç”Ÿåœ¨${gameState.family.title}ä¹‹å®¶ï¼Œåä¸º <strong class="value">${gameState.player.name}</strong>ï¼Œä»Šå¹´åå²ã€‚`, true);
    }

    generateInitialNPCs();
    updateFinancialTier();
    renderGame();
}
// ------------------- ä¿¸ç¦„é¢†å–åŠŸèƒ½ -------------------
function claimSalary() {
    const unclaimedSalary = gameState.career.unclaimedSalary || 0;
    if (unclaimedSalary <= 0) {
        showToast("æ²¡æœ‰å¯é¢†å–çš„ä¿¸ç¦„ã€‚");
        return;
    }
    applyEffects({ wealth: unclaimedSalary });
    gameState.career.unclaimedSalary = 0;
    showEventCard('ä¿¸ç¦„å…¥åº“', 'fa-coins', `ä½ é¢†å–äº†ç´¯ç§¯çš„ä¿¸ç¦„ï¼Œå…±è®¡ <span class="value">${unclaimedSalary}</span> ä¸¤ã€‚`);
    renderGame(); // åˆ·æ–°ç•Œé¢
}

// ------------------- å¨¶å¦»/å«äººé€‰æ‹©åŠŸèƒ½ -------------------
function showMarriageCandidatesWrapper(cost) {
    if (gameState.finances.wealth < cost) {
        showToast("ä½ çš„è´¢å¯Œä¸è¶³ä»¥æ”¯ä»˜åª’äººè´¹ç”¨ã€‚");
        return;
    }
    
    const partnerGender = gameState.player.gender === 'male' ? 'female' : 'male';
    const candidates = [];
    for (let i = 0; i < 5; i++) {
        const backgrounds = partnerGender === 'female' ? ladyBackgrounds : suitorBackgrounds;
        const bg = getRandomElement(backgrounds);
        const npc = generateNPC({
            gender: partnerGender,
            age: getRandomInt(gameState.player.age, gameState.player.age + 5),
            favor: 10,
            attributes: { ...bg.attributes, family: bg.family },
            title: bg.desc // ä½¿ç”¨èƒŒæ™¯æè¿°ä½œä¸ºå¤´è¡”
        });
        candidates.push(npc);
    }

    let optionsHTML = candidates.map(npc => {
        const npcDataString = JSON.stringify(npc).replace(/'/g, "&apos;");
        return {
            htmlContent: renderMarriageCandidateCard(npc),
            style: `padding: 10px; height: auto; display: block;`, // ç¡®ä¿æ¯ä¸ªé€‰é¡¹æ˜¯å—çº§å…ƒç´ 
            callback: () => confirmMarriageChoice(npc.id, cost)
        }
    });

    showDecisionCard(
        'è‰¯ç¼˜è‡ªæ‹©',
        'fa-users',
        'åª’å©†ä¸ºä½ å¯»æ¥äº†äº”ä½å®¶ä¸–èƒŒæ™¯å„ä¸ç›¸åŒçš„å€™é€‰äººï¼Œè¯·å›å®šå¤ºï¼š',
        optionsHTML
    );
}

function renderMarriageCandidateCard(npc) {
    const avatarContent = npc.avatar
        ? `<img src="${npc.avatar}" class="suitor-avatar" alt="${npc.name} avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
           <div class="suitor-avatar-text" style="display:none; line-height:60px;">${npc.name.slice(0, 1)}</div>`
        : `<div class="suitor-avatar-text" style="line-height:60px;">${npc.name.slice(0, 1)}</div>`;

    return `
    <div class="suitor" style="cursor: default; margin: 0;">
        <div class="suitor-avatar-wrapper">${avatarContent}</div>
        <div class="suitor-details" style="text-align: left;">
            <div class="suitor-name">${npc.name}</div>
            <div class="suitor-desc">${npc.title || 'èº«ä¸–ä¸å‡¡'}</div>
            <div class="suitor-stats">
                <span class="stat"><i class="fas fa-home"></i> å®¶ä¸–: ${npc.attributes.family}</span>
                <span class="stat"><i class="fas fa-grin-stars"></i> é­…åŠ›: ${npc.attributes.charm}</span>
                <span class="stat"><i class="fas fa-pencil-alt"></i> æ‰æƒ…: ${npc.attributes.talent}</span>
                <span class="stat"><i class="fas fa-lightbulb"></i> æ™ºæ…§: ${npc.attributes.wisdom}</span>
            </div>
        </div>
    </div>`;
}

function confirmMarriageChoice(npcId, cost) {
    if (gameState.finances.wealth < cost) {
        showToast("ä½ çš„è´¢å¯Œä¸è¶³ä»¥æ”¯ä»˜åª’äººè´¹ç”¨ã€‚");
        return;
    }
    applyEffects({ wealth: -cost });
    marrySuitor(npcId);
}

// ------------------- çº³å¦¾é€‰æ‹©åŠŸèƒ½ -------------------
function initiateConcubineSelection() {
    const financialTier = gameState.finances.financialTier || 1;
    if (financialTier < 5) {
        showEventCard('æ¡ä»¶ä¸è¶³', 'fa-times-circle', 'ä½ çš„è´¢åŠ›å°šæœªè¾¾åˆ°â€œè±ªé—¨å·¨å¯Œâ€ï¼Œæ— æ³•æ”¯æ’‘çº³å¦¾çš„å¼€é”€ï¼Œæ­¤äº‹æš‚ä¸”ä½œç½¢ã€‚');
        return;
    }
    if(gameState.marriage.concubines.length >= 5) {
        showToast("å¦¾å®¤åé¢å·²æ»¡ã€‚"); return;
    }
    askWifeForConcubineApproval();
}

function askWifeForConcubineApproval() {
    if (!gameState.marriage.isMarried) {
         showToast("ä½ éœ€å…ˆæœ‰æ­£å¦»ï¼Œæ–¹å¯çº³å¦¾ã€‚");
         return;
    }
    const wife = gameState.npcs[gameState.marriage.spouseId];
    if (!wife) return;

    const options = [
        {
            htmlContent: `<i class="fas fa-comments"></i> å¥½è¨€ç›¸å•†`,
            callback: () => {
                const successChance = 0.3 + (wife.favor / 200) + (gameState.player.attributes.charm / 300);
                if (Math.random() < successChance) {
                    showEventCard('æ­£å¦»åº”å…', 'fa-check-circle', 'åœ¨ä½ çš„åŠè¯´ä¸‹ï¼Œæ­£å¦»ç‚¹å¤´åº”å…äº†æ­¤äº‹ã€‚');
                    showConcubineCandidates();
                } else {
                    applyEffects({ relationship: { targetId: wife.id, favor: -15 } });
                    showEventCard('åé™¢èµ·ç«', 'fa-fire', 'æ­£å¦»é—»è¨€å¤§æ€’ï¼Œåšå†³ä¸åŒæ„ä½ çº³å¦¾ï¼ä½ ä»¬å¤§åµä¸€æ¶ï¼Œæ©çˆ±å€¼ä¸‹é™ã€‚');
                }
            }
        },
        {
            htmlContent: `<i class="fas fa-times"></i> ä½œç½¢`,
            callback: () => closeAllOverlays()
        }
    ];

    showDecisionCard('å•†è®®çº³å¦¾', 'fa-users', 'çº³å¦¾ä¹‹äº‹ï¼Œéœ€å…ˆä¸æ­£å¦»å•†è®®ã€‚', options);
}

function showConcubineCandidates() {
    const cost = 15000; // æ˜‚è´µçš„è´¹ç”¨
    if (gameState.finances.wealth < cost) {
        showEventCard('è´¢åŠ›ä¸è¶³', 'fa-coins', `çº³å¦¾éœ€èŠ±è´¹ <span class="value">${cost}</span> ä¸¤ï¼Œä½ çš„è´¢åŠ›ä¸è¶³ã€‚`);
        return;
    }
    
    const candidates = [];
    for (let i = 0; i < 3; i++) {
        const bg = getRandomElement(ladyBackgrounds);
        const npc = generateNPC({
            gender: 'female',
            age: getRandomInt(gameState.player.age - 5, gameState.player.age),
            favor: 20,
            attributes: { ...bg.attributes, family: bg.family },
            title: bg.desc
        });
        candidates.push(npc);
    }
    
    let optionsHTML = candidates.map(npc => {
        return {
            htmlContent: renderMarriageCandidateCard(npc),
            style: `padding: 10px; height: auto; display: block;`,
            callback: () => confirmConcubineChoice(npc.id, cost)
        }
    });

    showDecisionCard(
        'é´é€‰å¦¾å®¤',
        'fa-user-plus',
        `ä½ èŠ±è´¹ <span class="value">${cost}</span> ä¸¤ï¼Œè¯·åª’äººä¸ºä½ å¯»æ¥äº†ä¸‰ä½åˆé€‚çš„å¥³å­ï¼Œè¯·é€‰æ‹©ä¸€ä½çº³å…¥åå®…ï¼š`,
        optionsHTML
    );
}

function confirmConcubineChoice(npcId, cost) {
    if (gameState.finances.wealth < cost) {
        showToast("ä½ çš„è´¢å¯Œä¸è¶³ä»¥æ”¯ä»˜è´¹ç”¨ã€‚");
        return;
    }
    applyEffects({ wealth: -cost });
    acquireConcubine(npcId);
}
// =======================================================================
// ========================== SAVE/LOAD & DEBUG ==========================
// =======================================================================
function autoSaveGame() {
    try {
        // â–¼â–¼â–¼ æ ¸å¿ƒä¿®æ”¹ç‚¹ï¼šå°† 'auto' ä¿®æ”¹ä¸º 1 â–¼â–¼â–¼
        localStorage.setItem(SAVE_SLOT_KEY_PREFIX + 1, JSON.stringify(gameState));
        // â–²â–²â–² ä¿®æ”¹ç»“æŸ â–²â–²â–²
    } catch(e) { console.error("Auto-save failed", e); }
}
function showSaveLoadOverlay(isSaving) {
    document.getElementById('saveLoadHeader').innerText = isSaving ? 'é€‰æ‹©å­˜æ¡£ä½ç½®' : 'é€‰æ‹©è¯»æ¡£æ–‡ä»¶';
    const contentEl = document.getElementById('saveLoadContent');
    contentEl.innerHTML = '';
    for (let i = 1; i <= TOTAL_SAVE_SLOTS; i++) {
        const slotData = localStorage.getItem(SAVE_SLOT_KEY_PREFIX + i);
        let slotHTML = '';
        if (slotData) {
            try {
                const data = JSON.parse(slotData);
                slotHTML = ` <div class="save-slot" onclick="${isSaving ?`saveGame(${i})`:`loadGame(${i})`}"> <div class="slot-info"> <div class="slot-title">å­˜æ¡£ ${i}</div> <div class="slot-details">${data.player.name} | ${Math.floor(data.player.age)}å² | è´¢å¯Œ: ${formatNumber(data.finances.wealth)}</div> </div> <div class="slot-actions"><button onclick="event.stopPropagation(); deleteSave(${i})"><i class="fas fa-trash-alt"></i></button></div> </div>`;
            } catch(e) { slotHTML = `<div class="save-slot empty">å­˜æ¡£ ${i} [æŸå]</div>`; }
        } else {
            slotHTML = ` <div class="save-slot empty" onclick="${isSaving ?`saveGame(${i})` : ''}"> <div class="slot-info"><div class="slot-title">å­˜æ¡£ ${i}</div><div class="slot-details">[ ç©º ]</div></div> </div> `;
        }
        contentEl.innerHTML += slotHTML;
    }
    showOverlay('saveLoadOverlay');
}
function saveGame(slot) {
    if (confirm(`ç¡®å®šè¦è¦†ç›–å­˜æ¡£ ${slot} å—ï¼Ÿ`)) {
        try {
            // Convert Set to Array before saving
            const serializableGameState = { ...gameState, flags: { ...gameState.flags, allNames: Array.from(gameState.flags.allNames) } };
            localStorage.setItem(SAVE_SLOT_KEY_PREFIX + slot, JSON.stringify(serializableGameState));
            showToast(`æ¸¸æˆå·²æˆåŠŸä¿å­˜è‡³å­˜æ¡£ ${slot}ã€‚`);
            closeAllOverlays();
        } catch (e) {
            showToast("å­˜æ¡£å¤±è´¥ï¼Œå¯èƒ½æ˜¯å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚");
            console.error("Save failed: ", e);
        }
    }
}
function loadGame(slot, isAuto = false) {
    const saveData = localStorage.getItem(SAVE_SLOT_KEY_PREFIX + slot);
    if (saveData) {
        let loadedData;
        try {
            loadedData = JSON.parse(saveData);

            // [æ–°å¢] æ ¸å¿ƒå®‰å…¨æ£€æŸ¥ï¼šéªŒè¯å­˜æ¡£æ–‡ä»¶çš„åŸºæœ¬ç»“æ„
            if (!loadedData || typeof loadedData.player === 'undefined' || typeof loadedData.flags === 'undefined') {
                // å¦‚æœå­˜æ¡£ç¼ºå°‘å…³é”®éƒ¨åˆ†ï¼ˆå¦‚playerå¯¹è±¡ï¼‰ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯æŸåçš„
                throw new Error("å­˜æ¡£æ–‡ä»¶ç»“æ„ä¸å®Œæ•´æˆ–å·²æŸåã€‚");
            }

            gameState = loadedData; // éªŒè¯é€šè¿‡åï¼Œæ‰èµ‹å€¼ç»™å…¨å±€ gameState

            // ä¿ç•™æ‰€æœ‰åŸæœ‰åŠŸèƒ½ï¼šé‡æ–°ç”ŸæˆSetï¼Œåˆå§‹åŒ–ç³»ç»Ÿ
            gameState.flags.allNames = new Set(Array.from(gameState.flags.allNames || []));
            initApprenticeSystem(); 

            showToast(`å·²æˆåŠŸè¯»å–${isAuto ? 'è‡ªåŠ¨' :  `å­˜æ¡£ ${slot}`}ã€‚`);
            closeAllOverlays();
            renderGame();
        } catch(e) {
            console.error("è¯»å–å­˜æ¡£æ—¶å‡ºé”™:", e); // åœ¨æ§åˆ¶å°æ‰“å°è¯¦ç»†é”™è¯¯ï¼Œæ–¹ä¾¿è°ƒè¯•
            showToast("è¯»å–å¤±è´¥ï¼Œå­˜æ¡£æ–‡ä»¶å¯èƒ½å·²æŸåï¼Œå·²è‡ªåŠ¨æ¸…ç†ã€‚");
            localStorage.removeItem(SAVE_SLOT_KEY_PREFIX + slot); // åˆ é™¤æŸåçš„å­˜æ¡£

            // [æ–°å¢] å¦‚æœæ˜¯è‡ªåŠ¨å­˜æ¡£è¯»å–å¤±è´¥ï¼Œåˆ™å¼•å¯¼ç©å®¶é‡æ–°å¼€å§‹ï¼Œé¿å…å¡ä½
            if (isAuto) {
                closeAllOverlays();
                document.getElementById('loadingOverlay').style.display = 'none';
                showOverlay('genderSelectionOverlay');
            }
        }
    } else { 
        showToast("è¯»å–å¤±è´¥ï¼Œå­˜æ¡£ä¸ºç©ºã€‚"); 

        // [æ–°å¢] å¦‚æœæ˜¯è‡ªåŠ¨å­˜æ¡£ä¸ºç©ºï¼Œä¹Ÿç›´æ¥è¿›å…¥æ–°æ¸¸æˆæµç¨‹
        if (isAuto) {
            closeAllOverlays();
            document.getElementById('loadingOverlay').style.display = 'none';
            showOverlay('genderSelectionOverlay');
        }
    }
}
function deleteSave(slot) {
    if (confirm(`ç¡®å®šè¦åˆ é™¤å­˜æ¡£ ${slot} å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼`)) {
        localStorage.removeItem(SAVE_SLOT_KEY_PREFIX + slot);
        showToast(`å­˜æ¡£ ${slot} å·²åˆ é™¤ã€‚`);
        showSaveLoadOverlay(false);
    }
}

function handleAvatarClick() {
    const now = Date.now();
    if (now - lastAvatarClickTime < 300) avatarClickCount++;
    else avatarClickCount = 1;
    lastAvatarClickTime = now;
    if (avatarClickCount >= 5) {
        avatarClickCount = 0;
        const password = prompt("è¯·è¾“å…¥å¯†ç ï¼š");
        if(password === "HQL") showDebugOverlay();
        else {if(password) showToast("å¯†ç é”™è¯¯ã€‚");}
    }
}	
/**
 * [æ–°å¢] å¼€å‘è€…æ¨¡å¼ï¼šä¸ºå½“å‰äººç”Ÿåº”ç”¨æ‰€æœ‰â€œæ‰¿ä¸–ä¹¦â€ä¸­çš„å¤©èµ‹
 */
function debug_applyAllTalents(isSilent = false) {
    if (!isSilent && !confirm("ç¡®å®šè¦ä¸ºå½“å‰äººç”Ÿåº”ç”¨æ‰€æœ‰å¤©èµ‹å—ï¼Ÿ")) {
        return;
    }

    let effects = { attributes: {}, flags: {}, items: [], bonuses: {} };
    const baseAttrPoints = 100; // é»˜è®¤ç»™æ¯ä¸ªåŸºç¡€å±æ€§åŠ 100ç‚¹

    // 1. éå†å¹¶åˆå¹¶æ‰€æœ‰å¤©èµ‹æ•ˆæœ
    for (const branchKey in INHERITANCE_TALENT_TREE) {
        INHERITANCE_TALENT_TREE[branchKey].tiers.forEach(talent => {
            if (talent.isAttribute) {
                Object.keys(ATTR_MAP).forEach(attrKey => {
                    if (gameState.player.attributes.hasOwnProperty(attrKey)) {
                       effects.attributes[attrKey] = (effects.attributes[attrKey] || 0) + baseAttrPoints;
                    }
                });
            } else {
                Object.assign(effects.attributes, talent.effects.attributes || {});
                Object.assign(effects.flags, talent.effects.flags || {});
                if (talent.id === 'jiaxue') effects.bonuses.careerLevelBonus = 1;
                if (talent.id === 'yichan') effects.bonuses.wealthMultiplier = (effects.bonuses.wealthMultiplier || 0) + 0.02;
            }
        });
    }

    // 2. åº”ç”¨æ•ˆæœåˆ°å½“å‰æ¸¸æˆ
    applyEffects({ attributes: effects.attributes });
    Object.assign(gameState.flags, effects.flags);

    // 3. å¤„ç†ç‰¹æ®ŠåŠ æˆ
    if (effects.bonuses.careerLevelBonus && gameState.career.path) {
        gameState.career.level = Math.min(gameState.career.level + 1, careerPaths[gameState.player.gender][gameState.career.path].levels.length - 1);
    }

    if (!isSilent) {
        showToast("æ‰€æœ‰å¤©èµ‹å·²åº”ç”¨è‡³å½“å‰äººç”Ÿï¼");
        closeAllOverlays();
        renderGame();
    }
}
// [æ›¿æ¢] showDebugOverlay å‡½æ•°
function showDebugOverlay() {
    // ç©å®¶èŒä¸šä¿¡æ¯
    const paths = careerPaths[gameState.player.gender];
    let careerOptions = `<option value="">æ— èŒä¸š</option>`;
    Object.keys(paths).forEach(id => {
        careerOptions += `<option value="${id}" ${gameState.career.path === id ? 'selected': ''}>${paths[id].name}</option>`;
    });
    let levelOptions = '';
    if(gameState.career.path) {
        paths[gameState.career.path].levels.forEach((level, index) => {
            levelOptions += `<option value="${index}" ${gameState.career.level === index ? 'selected':''}>${level.title}</option>`;
        });
    }
    // NPC å¥½æ„Ÿåº¦é€‰é¡¹
    let npcOptions = Object.values(gameState.npcs).filter(n => n.id !== 'player' && n.name).map(npc => `<option value="${npc.id}">${npc.name}</option>`).join('');
    // å¾’å¼Ÿå±æ€§é€‰é¡¹
    let apprenticeOptions = gameState.apprentices.map(app => `<option value="${app.id}">${app.name}</option>`).join('');
    // å•†ä¼šå•†å“é€‰é¡¹
    let goodsOptions = Object.keys(TRADING_GOODS_DATA).map(id => `<option value="${id}">${TRADING_GOODS_DATA[id].name}</option>`).join('');
    // å­©å­å±æ€§é€‰é¡¹
    let childOptions = gameState.children.filter(c => c && !c.isDead).map(child => `<option value="${child.id}">${child.name}</option>`).join('');
    document.getElementById('debugContent').innerHTML = `
    <div class="input-group" style="max-height:60vh; overflow-y:auto; padding-right: 10px;">
        <div class="section-header">å¿«æ·è®¾ç½®</div>
        <div class="controls" style="flex-direction: column;">
             <button class="control-btn" style="background: #c0392b;" onclick="setPreset('female')">å¥³ç¥å¼€å±€ (å¥³)</button>
             <button class="control-btn" style="background: #2980b9;" onclick="setPreset('male')">å¤©ç¥å¼€å±€ (ç”·)</button>
             <button class="control-btn" style="background: #8e44ad;" onclick="debug_generateAllEvidence()">ä¸€é”®ç”Ÿæˆä¸¤ä½å¦¾å®¤çš„å…³é”®è¯æ®</button>
             <button class="control-btn" style="background: #27ae60;" onclick="debug_applyAllTalents()">åº”ç”¨æ‰€æœ‰å¤©èµ‹ (å½“å‰äººç”Ÿ)</button>
             <button class="control-btn" style="background: #f39c12;" onclick="toggleUnlimitedActions()">åˆ‡æ¢æ— é™è¡ŒåŠ¨ç‚¹</button>
             <button class="control-btn" style="background: #7f8c8d;" onclick="debug_setAllChildrenAge(15)">æ‰€æœ‰å­©å­æ”¹ä¸º15å²</button>
             </div>
        <div class="section-header">ç©å®¶å±æ€§</div>
        <p>å§“å: <input type="text" id="debug_name" value="${gameState.player.name}"></p>
        <p>å¹´é¾„: <input type="number" id="debug_age" value="${gameState.player.age}"></p>
        <p>è´¢å¯Œ: <input type="number" id="debug_wealth" value="${gameState.finances.wealth}"></p>
        <p>å¥åº·: <input type="number" id="debug_health" value="${gameState.player.health}"></p>
        <p>å£°æœ›: <input type="number" id="debug_reputation" value="${gameState.family.reputation || 0}"></p>
        ${Object.keys(ATTR_MAP).filter(attr => attr !== 'reputation').map(attr => `<p>${ATTR_MAP[attr]}: <input type="number" id="debug_${attr}" value="${gameState.player.attributes[attr]||0}"></p>`).join('')}

        <div class="section-header">ç©å®¶èŒä¸š</div>
        <p>èŒä¸š: <select id="debug_career">${careerOptions}</select></p>
        <p>ç­‰çº§: <select id="debug_career_level">${levelOptions}</select></p>
        <p>èŒä¸šä¸šç»©: <input type="number" id="debug_career_performance" value="${gameState.career.performance || 0}"></p>

        <div class="section-header">å†…åºœ/å©šå§»</div>
        <p>æŒå®¶æƒè¿›åº¦: <input type="number" id="debug_authority_progress" value="${gameState.marriage.householdAuthority.progress || 0}"></p>

        <div class="section-header">å­©å­å±æ€§</div>
        <p><select id="debug_child_select">${childOptions}</select></p>
        <p>å¹´é¾„: <input type="number" id="debug_child_age" placeholder="è¾“å…¥å­©å­å¹´é¾„"></p>
        ${Object.keys(ATTR_MAP).map(attr => `<p>${ATTR_MAP[attr]}: <input type="number" id="debug_child_${attr}" placeholder="è¾“å…¥${ATTR_MAP[attr]}å€¼"></p>`).join('')}

        <div class="section-header">NPC å¥½æ„Ÿåº¦</div>
        <p><select id="debug_npc_select">${npcOptions}</select> å¥½æ„Ÿ: <input type="number" id="debug_npc_favor" placeholder="è¾“å…¥å¥½æ„Ÿå€¼"></p>

        <div class="section-header">å¾’å¼Ÿå±æ€§</div>
        <p><select id="debug_apprentice_select">${apprenticeOptions}</select></p>
        ${Object.keys(ATTR_MAP).map(attr => `<p>${ATTR_MAP[attr]}: <input type="number" id="debug_apprentice_${attr}" placeholder="è¾“å…¥å±æ€§å€¼"></p>`).join('')}

        <div class="section-header">å•†ä¼šæ•°æ®</div>
        <p>é’±æŸœèµ„é‡‘: <input type="number" id="debug_trade_money" value="${gameState.tradingSystem.moneyChest}"></p>
        <p>ä»“åº“å®¹é‡: <input type="number" id="debug_trade_capacity" value="${gameState.tradingSystem.warehouseCapacity}"></p>
        <p>å•†å“ä»·æ ¼: <select id="debug_good_select">${goodsOptions}</select> ä»·æ ¼: <input type="number" id="debug_good_price" placeholder="è¾“å…¥æ–°ä»·æ ¼"></p>
    </div>
    `;
    showOverlay('debugOverlay');
}
/**
 * [æ–°å¢] å¼€å‘è€…æ¨¡å¼ï¼šä¸€é”®è®¾ç½®å¤©ç¥/å¥³ç¥å¼€å±€
 */
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (2/3)ã€‘ =====================
function setPreset(presetType) {
    if (!confirm(`ã€è­¦å‘Šã€‘\næ­¤æ“ä½œå°†ç«‹å³æ”¾å¼ƒå½“å‰äººç”Ÿï¼Œå¹¶å¼€å¯ä¸€ä¸ªå…¨æ–°çš„ã€${presetType === 'male' ? 'å¤©ç¥' : 'å¥³ç¥'}ã€‘äººç”Ÿï¼\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`)) {
        return;
    }
    // 1. æ„å»ºä¸€ä¸ªå®Œç¾çš„â€œç»§æ‰¿æ•°æ®åŒ…â€
    let perfectAttributes = {};
    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤åŒºåŸŸã€‘ â–¼â–¼â–¼
    // éå† ATTR_MAP ä¸­çš„æ‰€æœ‰å±æ€§é”®ï¼Œå¹¶å°†å®ƒä»¬çš„å€¼éƒ½è®¾ä¸º999
    Object.keys(ATTR_MAP).forEach(attrKey => {
        perfectAttributes[attrKey] = 999;
    });
    // â–²â–²â–² ã€ä¿®å¤ç»“æŸã€‘ â–²â–²â–²

    let allTalentEffects = { attributes: {}, flags: {}, items: [], bonuses: {} };
    for (const branchKey in INHERITANCE_TALENT_TREE) {
         INHERITANCE_TALENT_TREE[branchKey].tiers.forEach(talent => {
            if (talent.effects) {
                Object.assign(allTalentEffects.attributes, talent.effects.attributes || {});
                Object.assign(allTalentEffects.flags, talent.effects.flags || {});
                if(talent.id === 'yichan') {
                    allTalentEffects.bonuses.wealthMultiplier = (allTalentEffects.bonuses.wealthMultiplier || 0) + 0.02;
                }
            }
        });
    }
    const inheritanceData = {
        name: presetType === 'male' ? 'å¤©ç¥' : 'å¥³ç¥', // åå­—
        age: 16, // å¹´é¾„
        avatar: getRandomElement(avatarPools[presetType]), // éšæœºä¸€ä¸ªå¤´åƒ
        baseAttributes: perfectAttributes, // åŸºç¡€å±æ€§999
        effects: allTalentEffects, // æ‰€æœ‰å¤©èµ‹æ•ˆæœ
        previousCareerPath: null,
        previousWealth: 1000000000 // è´¢å¯Œ10äº¿
    };
    // 2. è°ƒç”¨å¼€å¯æ–°æ¸¸æˆçš„å‡½æ•°ï¼Œå¹¶ä¼ å…¥è¿™ä¸ªå®Œç¾çš„æ•°æ®åŒ…
    startNewGame(presetType, inheritanceData, { startAge: 16 });
}
/**
 * [æ–°å¢] å¼€å‘è€…æ¨¡å¼ï¼šä¸€é”®è®¾ç½®æ‰€æœ‰å­©å­çš„å¹´é¾„
 */
function debug_setAllChildrenAge(targetAge) {
    if (!gameState.children || gameState.children.length === 0) {
        showToast("å½“å‰æ²¡æœ‰å­©å­å¯ä¿®æ”¹å¹´é¾„ã€‚");
        return;
    }
    gameState.children.forEach(child => {
        if (child && !child.isDead) {
            child.age = targetAge;
        }
    });
    showToast(`æ‰€æœ‰å­©å­çš„å¹´é¾„å·²æˆåŠŸè®¾ç½®ä¸º ${targetAge} å²ï¼`);
    closeAllOverlays();
    renderGame();
}
function debug_generateAllEvidence() {
    const husband = gameState.npcs[gameState.marriage.spouseId];
    if (!husband || !husband.concubines || husband.concubines.length === 0) {
        showToast("é”™è¯¯ï¼šå¤«å›ä¸å­˜åœ¨æˆ–å°šæ— å¦¾å®¤ã€‚");
        return;
    }
    
    const concubines = husband.concubines.map(id => gameState.npcs[id]).filter(c => c && !c.isDead);
    if (concubines.length === 0) {
        showToast("æ²¡æœ‰å¦¾å®¤å¯ä»¥ç”Ÿæˆè¯æ®ã€‚");
        return;
    }

    let names = [];
    concubines.forEach((conc, index) => {
        // 1. è®¾ç½®UIæ˜¾ç¤ºå±æ€§
        conc.keyEvidence = 'ç½ªè¯ç¡®å‡¿ï¼Œå·²æ•´ç†æˆå†Œ (ç”±å¼€å‘è€…æ¨¡å¼ç”Ÿæˆ)';
        names.push(conc.name);
        
        // 2. ã€æ ¸å¿ƒä¿®å¤ã€‘åŒæ—¶è®¾ç½®åå°é€»è¾‘æ ‡è®°ï¼
        // é»˜è®¤å°†æ ‡è®°æŒ‡å‘ç¬¬ä¸€ä¸ªè¢«å¤„ç†çš„å¦¾å®¤
        if (index === 0) {
            gameState.flags.hasConcubineEvidence = conc.id;
        }
    });

    showToast(`å·²ä¸º ${names.join(' å’Œ ')} ç”Ÿæˆäº†å…³é”®ç½ªè¯ï¼`);
    
    // 3. ã€æ ¸å¿ƒä¿®å¤ã€‘ç”Ÿæˆè¯æ®åï¼Œç«‹åˆ»è°ƒç”¨æ£€æŸ¥æœºåˆ¶åˆ·æ–°æŒ‰é’®ï¼
    updateExpelButtonState();
    closeAllOverlays();
    renderGame();
}
// [æ–°å¢]
function skipTurns(numberOfTurns) {
    if (isProcessing) return;
    
    if (!confirm(`ç¡®å®šè¦è·³è¿‡ ${numberOfTurns} ä¸ªå›åˆå—ï¼Ÿæ¸¸æˆå°†è‡ªåŠ¨å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚`)) {
        return;
    }

    closeAllOverlays();
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');
    loadingOverlay.style.display = 'flex';
    loadingText.innerText = 'å…‰é˜´ä¼¼ç®­ï¼Œå²æœˆå¦‚æ¢­...';

    isProcessing = true;
    gameState.flags.isBatchProcessing = true; // è®¾ç½®ä¸€ä¸ªå…¨å±€æ ‡å¿—ï¼Œè®©å¼¹çª—å‡½æ•°çŸ¥é“ä¸è¦æ˜¾ç¤ºUI

    let turnsSkipped = 0;

    function processSingleTurn() {
        if (turnsSkipped >= numberOfTurns) {
            // æ‰€æœ‰å›åˆå¤„ç†å®Œæ¯•
            gameState.flags.isBatchProcessing = false;
            isProcessing = false;
            loadingOverlay.style.display = 'none';
            showToast(`æˆåŠŸè·³è¿‡äº† ${numberOfTurns} ä¸ªå›åˆï¼`);
            renderGame(); // æœ€ååˆ·æ–°ä¸€æ¬¡æ¸¸æˆç•Œé¢
            return;
        }

        // è°ƒç”¨ä½ æ¸¸æˆä¸­å·²æœ‰çš„ä¸‹ä¸€å›åˆå‡½æ•°
        // è¿™ä¸ªå‡½æ•°åŒ…å«äº†æ‰€æœ‰æ¸¸æˆé€»è¾‘ï¼Œå¦‚æ—¶é—´æ¨è¿›ã€å±æ€§å˜åŒ–ã€äº‹ä»¶ç­‰
        nextTurn();

        turnsSkipped++;
        loadingText.innerText = `å…‰é˜´ä¼¼ç®­... æ­£åœ¨å¤„ç†ç¬¬ ${turnsSkipped} / ${numberOfTurns} å›åˆ`;

        // ä½¿ç”¨ setTimeout åˆ›å»ºä¸€ä¸ªå¾®å°çš„å»¶è¿Ÿï¼Œä»¥é˜²æ­¢æµè§ˆå™¨å› å¯†é›†è®¡ç®—è€Œå¡æ­»ï¼Œå¹¶å…è®¸UIæ›´æ–°
        setTimeout(processSingleTurn, 50); 
    }

    processSingleTurn();
}

// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ (1/3)ã€‘ =====================
function applyDebugChanges() {
    // ç©å®¶å±æ€§
    gameState.player.name = document.getElementById('debug_name').value;
    gameState.player.age = parseFloat(document.getElementById('debug_age').value);
    gameState.finances.wealth = parseInt(document.getElementById('debug_wealth').value);
    gameState.player.health = parseInt(document.getElementById('debug_health').value);

    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®å¤åŒºåŸŸã€‘ â–¼â–¼â–¼
    // ä¸“é—¨å¤„ç†â€œå£°æœ›â€
    const reputationInput = document.getElementById('debug_reputation');
    if (reputationInput) {
        gameState.family.reputation = parseInt(reputationInput.value);
    }
    // éå†å¹¶åº”ç”¨æ‰€æœ‰å…¶ä»–å±æ€§ï¼ŒåŒ…æ‹¬å¿ƒè®¡ã€æƒè°‹ã€å®¶å¨ç­‰
    Object.keys(ATTR_MAP).forEach(attr => {
        if (attr === 'reputation') return; // å£°æœ›å·²å•ç‹¬å¤„ç†
        const input = document.getElementById(`debug_${attr}`);
        if (input) {
            // æ£€æŸ¥ gameState.player.attributes æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ
            if (!gameState.player.attributes) {
                gameState.player.attributes = {};
            }
            gameState.player.attributes[attr] = parseInt(input.value);
        }
    });
    // â–²â–²â–² ã€ä¿®å¤ç»“æŸã€‘ â–²â–²â–²

    // ç©å®¶èŒä¸š
    const careerPathValue = document.getElementById('debug_career').value;
    gameState.career.path = careerPathValue === "" ? null : careerPathValue;
    gameState.career.level = document.getElementById('debug_career_level').value !== '' ? parseInt(document.getElementById('debug_career_level').value) : -1;
    gameState.career.performance = parseInt(document.getElementById('debug_career_performance').value);
    // å†…åºœ/å©šå§»
    gameState.marriage.householdAuthority.progress = parseInt(document.getElementById('debug_authority_progress').value);
    // NPC å¥½æ„Ÿåº¦
    const npcId = document.getElementById('debug_npc_select').value;
    const npcFavor = parseInt(document.getElementById('debug_npc_favor').value);
    if (npcId && !isNaN(npcFavor) && gameState.npcs[npcId]) {
        gameState.npcs[npcId].favor = npcFavor;
        if (gameState.marriage.spouseId === npcId) {
            gameState.marriage.favor = npcFavor;
        }
    }
    // å­©å­å±æ€§
    const childId = document.getElementById('debug_child_select').value;
    if (childId) {
        const child = gameState.children.find(c => c.id === childId);
        if (child) {
            const childAgeInput = document.getElementById('debug_child_age');
            if (childAgeInput && childAgeInput.value !== '') {
                child.age = parseFloat(childAgeInput.value);
            }
            Object.keys(ATTR_MAP).forEach(attr => {
                const input = document.getElementById(`debug_child_${attr}`);
                if (input && input.value !== '') {
                    child.attributes[attr] = parseInt(input.value);
                }
            });
        }
    }
    // å¾’å¼Ÿå±æ€§
    const apprenticeId = document.getElementById('debug_apprentice_select').value;
    if (apprenticeId) {
        const apprentice = gameState.apprentices.find(a => a.id === apprenticeId);
        if (apprentice) {
            Object.keys(ATTR_MAP).forEach(attr => {
                const input = document.getElementById(`debug_apprentice_${attr}`);
                if (input && input.value !== '') {
                    apprentice.attributes[attr] = parseInt(input.value);
                }
            });
        }
    }
    // å•†ä¼šæ•°æ®
    gameState.tradingSystem.moneyChest = parseInt(document.getElementById('debug_trade_money').value);
    gameState.tradingSystem.warehouseCapacity = parseInt(document.getElementById('debug_trade_capacity').value);
    const goodId = document.getElementById('debug_good_select').value;
    const goodPrice = parseInt(document.getElementById('debug_good_price').value);
    if (goodId && !isNaN(goodPrice)) {
        gameState.tradingSystem.marketStatus.prices[goodId] = goodPrice;
    }
    showToast("å±æ€§ä¿®æ”¹æˆåŠŸï¼");
    closeAllOverlays();
    renderGame();
}
// =======================================================================
// ============================= RANKINGS ================================
// =======================================================================
function updateRankings() {
    let playerRankScore = Object.values(gameState.player.attributes).reduce((a, b) => a + b, 0);
    playerRankScore += gameState.family.reputation * 2 + gameState.finances.wealth / 100;

    if (!gameState.rankings.list || gameState.rankings.list.length < 10 || gameState.date.turn === 1) {
        let rankingList = [];
         for(let i=0; i<10; i++) {
            const score = Math.floor(playerRankScore * (0.9 + Math.random()*0.4));
            rankingList.push({name: generateRandomName(gameState.player.gender, new Set()), score: score});
        }
        gameState.rankings.list = rankingList;
    } else {
        gameState.rankings.list.forEach(npc => {
            if (!npc.isPlayer) {
                const fluctuation = (Math.random() - 0.5) * (npc.score * 0.05);
                npc.score = Math.max(0, Math.floor(npc.score + fluctuation));
            }
        });
    }

    const playerEntry = {name: gameState.player.name, score: Math.floor(playerRankScore), isPlayer: true};
    let combinedList = [...gameState.rankings.list.filter(r => !r.isPlayer), playerEntry];
    combinedList.sort((a,b) => b.score - a.score);
    
    gameState.rankings.list = combinedList.slice(0, 10);
    const playerRank = combinedList.findIndex(r => r.isPlayer) + 1;
    gameState.rankings.playerRank = playerRank;

    // ã€ä¿®æ”¹ã€‘æ¯å¹´å¹´åº•ç»“ç®—å¥–åŠ±
    if (gameState.date.turn === 2 && !gameState.flags.annualRankingRewardGiven) {
        let reward = null;
        if (playerRank === 1) {
            reward = { reputation: 20, wealth: 1000, title: 'æ¦œé¦–' };
        } else if (playerRank === 2) {
            reward = { reputation: 10, wealth: 500, title: 'æ¦œçœ¼' };
        } else if (playerRank === 3) {
            reward = { reputation: 5, wealth: 300, title: 'æ¢èŠ±' };
        }
        if (reward) {
            gameState.flags.annualRankingRewardGiven = true;
            applyEffects({ reputation: reward.reputation, wealth: reward.wealth });
            const logText = `ä½ åœ¨ä»Šå¹´çš„äº¬åŸ${gameState.player.gender === 'male' ? "æ‰ä¿Š" : "è´µå¥³"}æ¦œä¸­è£ç™»<strong class="value">${reward.title}</strong>ä¹‹ä½ï¼è·å¾—å¥–åŠ±ï¼šå£°æœ›+${reward.reputation}ï¼Œè´¢å¯Œ+${reward.wealth}ä¸¤ã€‚`;
            
            // ã€æ–°å¢çš„æ ¸å¿ƒä»£ç ã€‘å°†å¥–åŠ±ä¿¡æ¯å†™å…¥è®°äº‹æœ¬
            logEvent(logText);
            // ä¿ç•™åŸæœ‰çš„å¼¹çª—æç¤ºé€»è¾‘
            eventQueue.push(() => {
                showEventCard('å¹´åº¦æ®Šè£', 'fa-trophy', logText);
            });
        }
    }
}
function showRankings() {
    let listHTML = gameState.rankings.list.map((item, index) => {
        const isPlayer = item.isPlayer;
        return ` <div class="ranking-item ${isPlayer ? 'player' : ''}"> <span class="rank-num">#${index + 1}</span> <span>${item.name}</span> <span>${Math.floor(item.score)}</span> </div>`
    }).join('');

    document.getElementById('rankingsHeader').innerText = `ğŸ† äº¬åŸ${gameState.player.gender === 'male' ? "æ‰ä¿Š" : "è´µå¥³"}æ¦œ ğŸ†`;
    document.getElementById('rankingsContent').innerHTML = listHTML;
    showOverlay('rankingsOverlay');
}

function isRequirementMet(reqObject) {
    if (!reqObject) return true;

    for (const key in reqObject) {
        const requiredValue = reqObject[key];
        let playerValue = 0;

        if (key === 'reputation') {
            playerValue = gameState.family.reputation || 0;
        } else {
            playerValue = gameState.player.attributes[key] || 0;
        }

        if (playerValue < requiredValue) {
            return false;
        }
    }
    
    return true;
}


   // ã€æ£€æŸ¥å¹¶æ·»åŠ ã€‘æ‹–æ‹½åŠŸèƒ½æ‰€éœ€çš„è¾…åŠ©å‡½æ•°
function allowDrop(ev) { 
    ev.preventDefault(); 
}

function drag(ev) { 
    ev.dataTransfer.setData("text", ev.target.textContent); 
}

function drop(ev, targetElement) {
    ev.preventDefault();
    const data = ev.dataTransfer.getData("text");
    if (targetElement && !targetElement.classList.contains('filled')) {
        targetElement.textContent = data;
        targetElement.classList.add('filled');
    }
}
      // =======================================================================
// ======================= äº§ä¸šæŠ•èµ„ï¼ˆæ–°ç‰ˆç»è¥ç•Œé¢ï¼‰=========================
// =======================================================================

function showInvestmentDetails(instanceId) {
    const investment = gameState.merchant.investments.find(i => i.instanceId === instanceId);
    if (!investment) return;
    
    const type = merchantInvestmentData.types.find(t => t.id === investment.typeId);
    const currentLevel = type.levels[investment.level];
    const nextLevel = type.levels[investment.level + 1];

    let options = [];

    // 1. å‡çº§åº—é“ºé€‰é¡¹
    if (nextLevel) {
        // ã€ä¿®å¤ç‚¹ã€‘å°† nextLevel.upgrade_cost ä¿®æ”¹ä¸º currentLevel.upgrade_cost
        const upgradeCost = currentLevel.upgrade_cost; 
        options.push({
            htmlContent: `<i class="fas fa-arrow-up"></i><span class="option-text"><strong>å‡çº§ä¸º ${nextLevel.name}</strong><div><small>æˆæœ¬: ${upgradeCost} ä¸¤</small></div></span>`,
            disabled: gameState.finances.wealth < upgradeCost,
            callback: () => upgradeInvestment(instanceId)
        });
    }

    // 2. æ›´æ¢æŒæŸœé€‰é¡¹
    options.push({
        htmlContent: `<i class="fas fa-user-cog"></i><span class="option-text"><strong>æ›´æ¢æŒæŸœ</strong><div><small>å½“å‰: ${merchantInvestmentData.managers.find(m => m.id === investment.managerId).name}</small></div></span>`,
        callback: () => showManagerSelection(instanceId)
    });

    // 3. è°ƒæ•´ç»è¥æ–¹é’ˆé€‰é¡¹
    options.push({
        htmlContent: `<i class="fas fa-scroll"></i><span class="option-text"><strong>è°ƒæ•´ç»è¥æ–¹é’ˆ</strong><div><small>å½“å‰: ${merchantInvestmentData.strategies.find(s => s.id === investment.strategy).name}</small></div></span>`,
        callback: () => showStrategySelection(instanceId)
    });
    
    // 4. å˜å–äº§ä¸šé€‰é¡¹
    const sellPrice = Math.floor(currentLevel.cost * (0.8 + Math.random() * 0.4));
    options.push({
        htmlContent: `<i class="fas fa-dollar-sign"></i><span class="option-text"><strong>å˜å–äº§ä¸š</strong><div><small>é¢„è®¡å¯å¾—: ${sellPrice} ä¸¤</small></div></span>`,
        style: `background:linear-gradient(135deg, #e74c3c, #c0392b);`,
        callback: () => sellInvestment(instanceId, sellPrice)
    });
    
    let content = `<p>ç®¡ç†ä½ çš„ <strong class="value">${currentLevel.name}</strong>ã€‚</p>`;
    showDecisionCard(`ç»è¥ ${currentLevel.name}`, "fa-store", content, options);
}

function upgradeInvestment(instanceId) {
    const investment = gameState.merchant.investments.find(i => i.instanceId === instanceId);
    const type = merchantInvestmentData.types.find(t => t.id === investment.typeId);
    
    // ã€ä¿®å¤ç‚¹ã€‘è·å–å½“å‰ç­‰çº§çš„å‡çº§æˆæœ¬ï¼Œè€Œä¸æ˜¯ä¸‹ä¸€çº§çš„
    const currentLevel = type.levels[investment.level];
    const upgradeCost = currentLevel.upgrade_cost;

    if (gameState.finances.wealth < upgradeCost) {
        showToast("èµ„é‡‘ä¸è¶³ä»¥å‡çº§ã€‚");
        return;
    }
    
    applyEffects({ wealth: -upgradeCost, reputation: 10 });
    investment.level++;
    
    showEventCard('äº§ä¸šå‡çº§', 'fa-arrow-up', `ä½ èŠ±è´¹å·¨èµ„å°†åº—é“ºå‡çº§ä¸º <strong class="value">${type.levels[investment.level].name}</strong>ï¼Œå£°åè¿œæ‰¬ï¼`);
    showInvestmentDashboard();
}



function showManagerSelection(instanceId) {
    const investment = gameState.merchant.investments.find(i => i.instanceId === instanceId);
    let options = merchantInvestmentData.managers.map(manager => {
        return {
            htmlContent: `<i class="fas fa-user-tie"></i><span class="option-text"><strong>${manager.name}</strong><div><small>è–ªé…¬: ${manager.salary} ä¸¤/å¹´</small></div></span>`,
            disabled: investment.managerId === manager.id,
            callback: () => changeManager(instanceId, manager.id)
        };
    });
     showDecisionCard('æ‹›è˜æŒæŸœ', 'fa-users', 'æ…§çœ¼è¯†äººï¼Œæ–¹èƒ½è´¢æºæ»šæ»šã€‚', options);
}

function changeManager(instanceId, managerId) {
    const investment = gameState.merchant.investments.find(i => i.instanceId === instanceId);
    investment.managerId = managerId;
    const managerName = merchantInvestmentData.managers.find(m=>m.id === managerId).name;
    showEventCard('æ›´æ¢æŒæŸœ', 'fa-user-cog', `ä½ ä¸ºåº—é“ºæ›´æ¢äº†æŒæŸœï¼Œæ–°ä»»çš„æ˜¯ <strong class="value">${managerName}</strong>ã€‚`);
    showInvestmentDashboard();
}

function showStrategySelection(instanceId) {
    const investment = gameState.merchant.investments.find(i => i.instanceId === instanceId);
    let options = merchantInvestmentData.strategies.map(strategy => {
        const canAfford = !strategy.cost || gameState.finances.wealth >= strategy.cost;
        return {
            htmlContent: `<i class="fas fa-compass"></i><span class="option-text"><strong>${strategy.name}</strong><div><small>${strategy.desc}${strategy.cost ? `(-${strategy.cost}ä¸¤)` : ''}</small></div></span>`,
            disabled: investment.strategy === strategy.id || !canAfford,
            callback: () => changeStrategy(instanceId, strategy.id)
        };
    });
    showDecisionCard('è°ƒæ•´æ–¹é’ˆ', 'fa-scroll', 'å®¡æ—¶åº¦åŠ¿ï¼Œæ–¹èƒ½ç«‹äºä¸è´¥ä¹‹åœ°ã€‚', options);
}

function changeStrategy(instanceId, strategyId) {
    const investment = gameState.merchant.investments.find(i => i.instanceId === instanceId);
    investment.strategy = strategyId;
    const strategyName = merchantInvestmentData.strategies.find(s=>s.id === strategyId).name;
    showEventCard('è°ƒæ•´æ–¹é’ˆ', 'fa-scroll', `ä½ å°†åº—é“ºçš„ç»è¥æ–¹é’ˆè°ƒæ•´ä¸ºâ€œ<strong class="value">${strategyName}</strong>â€ã€‚`);
    showInvestmentDashboard();
}

function sellInvestment(instanceId, sellPrice) {
    if (confirm("ç¡®å®šè¦å˜å–è¿™ä»½äº§ä¸šå—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ã€‚")) {
        const investment = gameState.merchant.investments.find(i => i.instanceId === instanceId);
        if (!investment) return;
        const type = merchantInvestmentData.types.find(t => t.id === investment.typeId);
        const currentLevel = type.levels[investment.level];
        const investmentName = currentLevel.name;

        gameState.merchant.investments = gameState.merchant.investments.filter(i => i.instanceId !== instanceId);
        applyEffects({ wealth: sellPrice });
        
        const logText = `ä½ æˆåŠŸå˜å–äº†äº§ä¸š <strong class="value">${investmentName}</strong>ï¼Œè·å¾—èµ„é‡‘ <span class="value">${sellPrice}</span> ä¸¤ã€‚`;
        
        // ã€æ–°å¢çš„æ ¸å¿ƒä»£ç ã€‘å°†å˜å–äº§ä¸šçš„æ”¶å…¥å†™å…¥è®°äº‹æœ¬
        logEvent(logText);

        showEventCard('å˜å–äº§ä¸š', 'fa-dollar-sign', logText);
        showInvestmentDashboard();
    }
}
// =======================================================================
// =====================  ã€æ–°åŠŸèƒ½ä»£ç ã€‘ ç‰©å“ç®¡ç†æ ¸å¿ƒå‡½æ•° START  =========================
/**
 * æ£€æŸ¥ç‰©å“æ ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šç‰©å“
 * @param {string} itemId - ç‰©å“çš„ID
 * @returns {boolean} - æ˜¯å¦æ‹¥æœ‰è¯¥ç‰©å“
 */
function hasItemInInventory(itemId) {
    if (!gameState.inventory) return false;
    return gameState.inventory.some(item => item.id === itemId && item.amount > 0);
}

/**
 * å‘ç‰©å“æ æ·»åŠ ç‰©å“ï¼ˆå¤„ç†å †å ï¼‰
 * @param {string} itemId - ç‰©å“çš„ID
 * @param {number} amount - æ·»åŠ çš„æ•°é‡
 * @param {object} itemData - ç‰©å“çš„è¯¦ç»†æ•°æ®ï¼ˆä»…åœ¨é¦–æ¬¡æ·»åŠ æ—¶éœ€è¦ï¼‰
 */
function addItemToInventory(itemId, amount = 1, itemData = null) {
    if (!gameState.inventory) gameState.inventory = [];
    
    const existingItem = gameState.inventory.find(i => i.id === itemId);

    if (existingItem) {
        existingItem.amount += amount;
    } else {
        // å¦‚æœITEM_DATAé‡Œæ²¡æœ‰ï¼Œå°±ç”¨ä¼ å…¥çš„itemDataï¼ˆä¸»è¦ç”¨äºä¿¡ç‰©ææ–™ï¼‰
        if (!ITEM_DATA[itemId] && itemData) {
            ITEM_DATA[itemId] = itemData;
        }
        gameState.inventory.push({ id: itemId, amount: amount, instanceId: `item_${Date.now()}` });
    }
}

/**
 * ä»ç‰©å“æ ç§»é™¤ç‰©å“
 * @param {string} itemId - ç‰©å“çš„ID
 * @param {number} amount - ç§»é™¤çš„æ•°é‡
 * @param {string} instanceId - [å¯é€‰] å¦‚æœæä¾›äº†ï¼Œåˆ™ç²¾ç¡®ç§»é™¤è¯¥å®ä¾‹
 * @returns {boolean} - æ˜¯å¦ç§»é™¤æˆåŠŸ
 */
function removeItemFromInventory(itemId, amount = 1, instanceId = null) {
    if (!gameState.inventory) return false;

    // ä¼˜å…ˆä½¿ç”¨ instanceId ç²¾ç¡®æŸ¥æ‰¾
    if (instanceId) {
         const itemIndex = gameState.inventory.findIndex(i => i.instanceId === instanceId);
         if (itemIndex > -1) {
             gameState.inventory.splice(itemIndex, 1);
             return true;
         }
    }

    // å¦‚æœæ²¡æœ‰ instanceId æˆ–æ²¡æ‰¾åˆ°ï¼Œåˆ™æŒ‰ itemId æŸ¥æ‰¾
    const item = gameState.inventory.find(i => i.id === itemId);
    if (item && item.amount >= amount) {
        item.amount -= amount;
        if (item.amount <= 0) {
            gameState.inventory = gameState.inventory.filter(i => i.id !== itemId);
        }
        return true;
    }

    return false;
}
// [ç”¨è¿™ä¸ªæ›¿æ¢æ‰åŸæ¥çš„ renderInventoryTab å‡½æ•°]
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function renderInventoryTab() {
    let inventory = gameState.inventory || [];
    if (inventory.length === 0) {
        return `<p class="comment" style="text-align:center;">ä½ çš„è¡Œå›Šç©ºç©ºå¦‚ä¹Ÿã€‚</p>`;
    }

    let html = '<div class="inventory-container">';
    inventory.forEach((itemInstance, index) => {
        itemInstance.instanceId = itemInstance.instanceId || `item_${Date.now()}_${index}`;
        
        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘å¦‚æœITEM_DATAé‡Œæ‰¾ä¸åˆ°å®šä¹‰ï¼Œå°±ç›´æ¥ä½¿ç”¨ç‰©å“å®ä¾‹è‡ªèº«çš„ä¿¡æ¯
        const itemDef = ITEM_DATA[itemInstance.id] || itemInstance;

        if (itemDef) {
            let useButtonHTML = '';
            if (itemDef.performance_boost) {
                useButtonHTML = `<button class="control-btn" style="padding: 5px 10px; font-size: 0.8rem; margin-left: 10px;"
                                     onclick="useInventoryItemForCareer('${itemInstance.id}', '${itemInstance.instanceId}')">
                                 <i class="fas fa-arrow-up"></i> ä½¿ç”¨
                                </button>`;
            }
            html += `
            <div class="inventory-item">
                <div class="inventory-item-icon"><i class="fas ${itemDef.icon || 'fa-question-circle'}"></i></div>
                <div class="inventory-item-details">
                    <div class="inventory-item-name">
                        ${itemDef.name} 
                         <span class="inventory-item-type">${itemDef.type}</span>
                         ${itemInstance.amount > 1 ? ` (x${itemInstance.amount})` : ''}
                    </div>
                    <div class="inventory-item-desc">${itemDef.desc}</div>
                </div>
                ${useButtonHTML}
            </div>`;
        }
    });
    html += '</div>';
    return html;
}
function addItemToInventory(itemId, amount = 1) {
    if (!ITEM_DATA[itemId]) {
        console.error(`å°è¯•æ·»åŠ ä¸å­˜åœ¨çš„ç‰©å“: ${itemId}`);
        return;
    }

    const existingItem = gameState.inventory.find(i => i.id === itemId);

    if (existingItem) {
        existingItem.amount += amount;
    } else {
        gameState.inventory.push({ id: itemId, amount: amount });
    }
    
    const itemDef = ITEM_DATA[itemId];
    showToast(`è·å¾—ç‰©å“ï¼š${itemDef.name} x${amount}`);
    logEvent(`ä½ è·å¾—äº†ç‰©å“ï¼š<strong class="value">${itemDef.name}</strong> x${amount}ã€‚`);
}


// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function triggerProfessionEvent() {
    const c = gameState.career;
    if (!c.path) return;
    if (gameState.flags.actionUsed_work >= 2) {
        showToast("æœ¬å›åˆå…¬åŠ¡å¤„ç†æ¬¡æ•°å·²ç”¨å°½");
        return;
    }
    gameState.flags.actionUsed_work++;

    const professionData = PROFESSION_DATA[c.path];
    if (!professionData || !professionData.acts) {
        showEventCard("æš‚æ— å…¬åŠ¡", "fa-file-alt", "å½“å‰èŒä¸šæ•°æ®é”™è¯¯ã€‚");
        return;
    }

    // ===================== ã€æ ¸å¿ƒä¿®æ”¹é€»è¾‘ STARTã€‘ =====================
    let weightedEventPool = [];
    // æ³¨æ„ï¼šç©å®¶ç­‰çº§ c.level æ˜¯ä»0å¼€å§‹çš„ç´¢å¼•ï¼Œè€Œæ•°æ®ä¸­çš„ level_range æ˜¯ä»1å¼€å§‹çš„ç­‰çº§
    const playerLevel = c.level + 1; 

    // éå†æ‰€æœ‰èŒä¸šå¹•ï¼Œæ„å»ºåŠ æƒäº‹ä»¶æ± 
    professionData.acts.forEach(act => {
        // å®‰å…¨æ£€æŸ¥ï¼Œç¡®ä¿actå’Œå…¶å±æ€§å­˜åœ¨
        if (!act || !act.events || !act.level_range) return;

        const actMinLevel = act.level_range[0];
        const actMaxLevel = act.level_range[1];

        // åˆ¤æ–­æ˜¯å¦ä¸ºå½“å‰å¹•ï¼šç©å®¶ç­‰çº§åœ¨è¿™ä¸€å¹•çš„èŒƒå›´å†…
        if (playerLevel >= actMinLevel && playerLevel <= actMaxLevel) {
            // è¿™æ˜¯å½“å‰å¹•çš„äº‹ä»¶ï¼Œç»™äºˆé«˜æƒé‡ï¼ˆå‡ºç°æ¦‚ç‡æœ€é«˜ï¼‰
            act.events.forEach(event => {
                for (let i = 0; i < 4; i++) { // å°†äº‹ä»¶æ·»åŠ 4æ¬¡ï¼Œå¤§å¹…æé«˜å…¶è¢«æŠ½ä¸­çš„æ¦‚ç‡
                    weightedEventPool.push(event);
                }
            });
        }
        // åˆ¤æ–­æ˜¯å¦ä¸ºå·²ç»å†è¿‡çš„å¹•ï¼šç©å®¶ç­‰çº§é«˜äºè¿™ä¸€å¹•çš„æœ€é«˜ç­‰çº§
        else if (playerLevel > actMaxLevel) {
            // è¿™æ˜¯è¿‡å»å¹•çš„äº‹ä»¶ï¼Œç»™äºˆä½æƒé‡ï¼ˆå¶å°”å‡ºç°ï¼‰
            act.events.forEach(event => {
                weightedEventPool.push(event); // åªå°†äº‹ä»¶æ·»åŠ 1æ¬¡
            });
        }
        // æœªæ¥çš„å¹•äº‹ä»¶åˆ™å®Œå…¨ä¸æ·»åŠ 
    });

    if (weightedEventPool.length === 0) {
        showEventCard("æš‚æ— å…¬åŠ¡", "fa-file-alt", "å½“å‰é˜¶æ®µæš‚æ— åˆé€‚çš„å…¬åŠ¡å¯å¤„ç†ï¼Œè¯·å°è¯•æå‡è‡ªå·±æˆ–è¿›è¡Œå…¶ä»–æ´»åŠ¨ã€‚");
        // å¦‚æœæ²¡æœ‰äº‹ä»¶ï¼ŒæŠŠæ¶ˆè€—çš„è¡ŒåŠ¨ç‚¹è¿˜ç»™ç©å®¶
        gameState.flags.actionUsed_work--;
        return;
    }

    // ä»æˆ‘ä»¬æ„å»ºå¥½çš„ã€åŠ æƒåçš„äº‹ä»¶æ± ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªäº‹ä»¶
    const randomEvent = getRandomElement(weightedEventPool);
    // ===================== ã€æ ¸å¿ƒä¿®æ”¹é€»è¾‘ ENDã€‘ =====================

    // åç»­çš„äº‹ä»¶æ˜¾ç¤ºé€»è¾‘ä¸æ‚¨åŸæ¥çš„ä¸€è‡´ï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½ä¿ç•™
    let eventHTML = `<p>${randomEvent.desc}</p>`;
    let optionsHTML = [];

    // ç”Ÿæˆäº‹ä»¶é€‰é¡¹
    randomEvent.options.forEach((opt, index) => {
        // æ£€æŸ¥é€‰é¡¹æ˜¯å¦æ»¡è¶³æ¡ä»¶
        let canSelect = true;
        let reqText = "";
        if (opt.requirements) {
            reqText = Object.entries(opt.requirements).map(([attr, val]) => {
                const playerVal = gameState.player.attributes[attr] || 0;
                if (playerVal < val) canSelect = false;
                return `${ATTR_MAP[attr] || attr}â‰¥${val}`;
            }).join("ï¼Œ");
        }

        optionsHTML.push({
            htmlContent: `<span class="option-text">${opt.text}${reqText ? `<div><small>è¦æ±‚ï¼š${reqText}</small></div>` : ""}</span>`,
            disabled: !canSelect,
            callback: () => handleProfessionEventResult(randomEvent, index)
        });
    });

    // æ˜¾ç¤ºäº‹ä»¶å¼¹çª—
    showDecisionCard(randomEvent.title, "fa-scroll", eventHTML, optionsHTML);
}
// =======================================================================
// ===================== ã€æ›¿æ¢ã€‘å¤ç­å°æ¸¸æˆæ ¸å¿ƒé€»è¾‘ (v3 éŸ³ä¹+æ›²ç›®ç‰ˆ) ======
// =======================================================================

// [æ–°å¢] æ›²ç›®æ•°æ®
const SONG_DATA = {
    'fengqiuhaung': {
        name: 'å‡¤æ±‚å‡°',
        difficulty: 'ç®€å•',
        noteCount: 20,
        noteSpeed: 4.5, // ç§’
        noteInterval: [800, 1300], // ms
        bgmId: 'bgm-fengqiuhaung'
    },
    'gaoshan': {
        name: 'é«˜å±±æµæ°´',
        difficulty: 'æ™®é€š',
        noteCount: 30,
        noteSpeed: 4.0,
        noteInterval: [600, 1000],
        bgmId: 'bgm-gaoshanliushui'
    },
    'shimian': {
        name: 'åé¢åŸ‹ä¼',
        difficulty: 'å›°éš¾',
        noteCount: 45,
        noteSpeed: 3.5,
        noteInterval: [400, 700],
        bgmId: 'bgm-shimianmaifu'
    }
};

/**
 * å¯åŠ¨å¤ç­å°æ¸¸æˆçš„æ€»å…¥å£ï¼Œç°åœ¨æ˜¯æ›²ç›®é€‰æ‹©ç•Œé¢ã€‚
 * @param {string} npcId - äº’åŠ¨çš„NPC ID
 */
function startGuzhengMiniGame(npcId) {
    let songOptions = Object.entries(SONG_DATA).map(([id, song]) => {
        return {
            htmlContent: `<i class="fas fa-music"></i><span class="option-text"><strong>${song.name}</strong><div><small>éš¾åº¦: ${song.difficulty}</small></div></span>`,
            callback: () => _showGuzhengRules(npcId, id)
        };
    });
    
    showDecisionCard('ä¸ºå›æŠšç´', 'fa-music', 'ä½ æ‰“ç®—ä¸ºTAå¼¹å¥å“ªä¸€é¦–æ›²å­ï¼Ÿ', songOptions);
}

/**
 * [æ–°å¢] æ˜¾ç¤ºæ¸¸æˆè§„åˆ™
 */
function _showGuzhengRules(npcId, songId) {
    const song = SONG_DATA[songId];
    const rulesContent = `
        <p style="text-align: center; margin-bottom: 15px;">å³å°†å¼¹å¥: <strong class="value">${song.name}</strong></p>
        <div style="text-align: left; line-height: 1.8;">
            <i class="fas fa-info-circle"></i> <strong>ç©æ³•è¯´æ˜ï¼š</strong><br>
            - ğŸŒ¸èŠ±ç“£ä¼šä»ä¸Šæ–¹æ²¿ç€äº”æ¡ç´å¼¦ä¸‹è½ã€‚<br>
            - å½“èŠ±ç“£è¿›å…¥ä¸‹æ–¹å‘å…‰åŒºåŸŸæ—¶ï¼Œç‚¹å‡»å¯¹åº”çš„ç´å¼¦æŒ‰é’®ã€‚<br>
            - è½ç‚¹è¶Šæ¥è¿‘é‡‘è‰²åˆ¤å®šçº¿ï¼Œå¾—åˆ†è¶Šé«˜ï¼<br>
        </div>
    `;
    const options = [
        {
            htmlContent: `<i class="fas fa-play-circle"></i> å¼€å§‹å¼¹å¥`,
            callback: () => _beginGuzhengGameplay(npcId, songId)
        }
    ];
    showDecisionCard('æŠšç´å°å™', 'fa-music', rulesContent, options);
}


/**
 * [ä¿®æ”¹] çœŸæ­£å¼€å§‹è¿è¡Œå°æ¸¸æˆçš„å†…éƒ¨å‡½æ•°
 */
function _beginGuzhengGameplay(npcId, songId) {
    const song = SONG_DATA[songId];
    const gameContainer = document.getElementById('guzheng-game-container');
    const buttonsContainer = document.getElementById('guzheng-hit-buttons-container');
    const scoreDisplay = document.getElementById('guzheng-score-display');

    document.getElementById('guzheng-song-name').textContent = song.name;
    gameContainer.innerHTML = '<div class="guzheng-perfect-zone"></div><div class="guzheng-hit-line"></div><div id="guzheng-feedback" class="guzheng-feedback"></div>';
    buttonsContainer.innerHTML = '';
    scoreDisplay.textContent = 'å¾—åˆ†: 0';

    const NUM_STRINGS = 5;

    gameState.miniGame = {
        score: 0,
        hits: { perfect: 0, good: 0, miss: 0 }, // ç”¨äºæ›´ç²¾ç¡®çš„è®¡åˆ†
        totalNotes: song.noteCount,
        noteSpeed: song.noteSpeed,
        opponentId: npcId,
        gameRunning: true,
        strings: Array(NUM_STRINGS).fill().map(() => []),
        bgm: document.getElementById(song.bgmId)
    };

    if (gameState.miniGame.bgm) {
        gameState.miniGame.bgm.currentTime = 0;
        gameState.miniGame.bgm.play().catch(e => console.error("BGMæ’­æ”¾å¤±è´¥:", e));
    }

    for (let i = 0; i < NUM_STRINGS; i++) {
        const stringEl = document.createElement('div');
        stringEl.className = 'guzheng-string';
        stringEl.id = `string-${i}`;
        gameContainer.appendChild(stringEl);

        const buttonEl = document.createElement('div');
        buttonEl.className = 'guzheng-hit-button';
        buttonEl.onmousedown = () => { handleGuzhengHit(i); buttonEl.classList.add('active'); };
        buttonEl.onmouseup = () => buttonEl.classList.remove('active');
        buttonEl.ontouchstart = (e) => { e.preventDefault(); handleGuzhengHit(i); buttonEl.classList.add('active'); };
        buttonEl.ontouchend = (e) => { e.preventDefault(); buttonEl.classList.remove('active'); };
        buttonsContainer.appendChild(buttonEl);
    }

    // ç”ŸæˆéŸ³ç¬¦çš„é€»è¾‘ä¿æŒä¸å˜
    for (let i = 0; i < gameState.miniGame.totalNotes; i++) {
        setTimeout(() => {
            if (!gameState.miniGame.gameRunning) return;

            const stringIndex = getRandomInt(0, NUM_STRINGS - 1);
            const stringEl = document.getElementById(`string-${stringIndex}`);

            if (stringEl) {
                const note = document.createElement('div');
                note.className = 'guzheng-note';
                note.innerHTML = 'ğŸŒ¸';
                note.style.animationDuration = `${gameState.miniGame.noteSpeed}s`;
                note.dataset.createdAt = performance.now();

                stringEl.appendChild(note);
                gameState.miniGame.strings[stringIndex].push(note);

                setTimeout(() => {
                    if (note.parentElement) {
                        note.remove();
                        showGuzhengFeedback('é”™è¿‡', 'grey');
                        gameState.miniGame.hits.miss++;
                        document.getElementById('sfx-miss')?.play();
                        const notesOnString = gameState.miniGame.strings[stringIndex];
                        const noteIndex = notesOnString.indexOf(note);
                        if (noteIndex > -1) notesOnString.splice(noteIndex, 1);
                    }
                }, gameState.miniGame.noteSpeed * 1000);
            }
        }, i * getRandomInt(song.noteInterval[0], song.noteInterval[1])); 
    }

    // ã€ä¿®å¤æ ¸å¿ƒã€‘ä½¿ç”¨ç‹¬ç«‹çš„å‡½æ•°å¤„ç†æ¸¸æˆç»“æŸï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰é€»è¾‘æ”¾åœ¨setTimeouté‡Œ
    const gameDuration = (gameState.miniGame.totalNotes * song.noteInterval[1]) + (gameState.miniGame.noteSpeed * 1000);
    setTimeout(() => _endGuzhengGame(npcId), gameDuration);

    showOverlay('guzhengGameOverlay');
}

// ã€æ–°å¢çš„è¾…åŠ©å‡½æ•°ã€‘è¯·å°†è¿™ä¸ªæ–°å‡½æ•°ç²˜è´´åˆ° _beginGuzhengGameplay å‡½æ•°çš„ä¸‹æ–¹
function _endGuzhengGame(npcId) {
    if (!gameState.miniGame || !gameState.miniGame.gameRunning) return;
    gameState.miniGame.gameRunning = false;
    if (gameState.miniGame.bgm) gameState.miniGame.bgm.pause();

    // ä½¿ç”¨æ›´ç²¾ç¡®çš„è®¡åˆ†æ–¹å¼
    const finalScore = gameState.miniGame.hits.perfect * 2 + gameState.miniGame.hits.good * 1;
    const successRate = finalScore / (gameState.miniGame.totalNotes * 2);

    let resultText, favorChange;

    if (successRate > 0.8) {
        resultText = 'ä½ çš„ç´å£°å¦‚é«˜å±±æµæ°´ï¼Œå¬è€…æ— ä¸é™¶é†‰ï¼';
        favorChange = getRandomInt(15, 20);
    } else if (successRate > 0.5) {
        resultText = 'ä¸€æ›²ç»ˆäº†ï¼Œè™½æœ‰ç‘•ç–µï¼Œä½†ä¹Ÿé¢‡ä¸ºåŠ¨å¬ã€‚';
        favorChange = getRandomInt(5, 8);
    } else {
        resultText = 'ä½ çš„ç´å£°...åªèƒ½è¯´è¿˜æœ‰å¾ˆå¤§çš„è¿›æ­¥ç©ºé—´ã€‚';
        favorChange = -getRandomInt(1, 3);
    }

    applyEffects({ relationship: { targetId: npcId, favor: favorChange }, attributes: { talent: 2 } });

    const resultContent = `
        ${resultText}<br><br>
        <strong>æœ€ç»ˆæˆç»©:</strong><br>
        å®Œç¾: ${gameState.miniGame.hits.perfect} | ä¸é”™: ${gameState.miniGame.hits.good} | é”™è¿‡: ${gameState.miniGame.hits.miss}<br>
        <strong class="value">${gameState.npcs[npcId].name} å¥½æ„Ÿ ${favorChange > 0 ? '+' : ''}${favorChange}</strong>ï¼Œä½ çš„æ‰æƒ…+2ã€‚
    `;

    showEventCard('ä¸€æ›²ç»ˆäº†', 'fa-music', resultContent);
}

/**
 * å¤„ç†ç©å®¶ç‚¹å‡»ç´å¼¦çš„é€»è¾‘
 */
function handleGuzhengHit(stringIndex) {
    if (!gameState.miniGame || !gameState.miniGame.gameRunning) return;

    const notesOnString = gameState.miniGame.strings[stringIndex];
    // åˆ¤å®šåŒºåŸŸçš„å‚æ•° (ä¸æ‚¨çš„ä»£ç ä¿æŒä¸€è‡´)
    const hitLinePosition = 0.85; 
    const perfectRange = 0.05; // åˆ¤å®šèŒƒå›´ç¼©å°ï¼Œæ›´ç²¾ç¡®
    const goodRange = 0.15;

    let hit = false;
    if (notesOnString.length > 0) {
        for (let i = notesOnString.length - 1; i >= 0; i--) {
            const note = notesOnString[i];
            const elapsed = performance.now() - parseFloat(note.dataset.createdAt);
            const progress = elapsed / (gameState.miniGame.noteSpeed * 1000);
            
            // åªå¤„ç†å·²ç»è¿›å…¥åˆ¤å®šåŒºçš„éŸ³ç¬¦
            if (progress > hitLinePosition - goodRange && progress < 1.0) {
                const distance = Math.abs(progress - hitLinePosition);

                if (distance <= perfectRange) {
                    // å®Œç¾åˆ¤å®š
                    gameState.miniGame.hits.perfect++; // ä¿®å¤ç‚¹1: å¢åŠ å®Œç¾å‘½ä¸­è®¡æ•°
                    showGuzhengFeedback('å®Œç¾!', '#FFD700');
                    const sfx = document.getElementById('sfx-perfect-hit');
                    if(sfx) { sfx.currentTime = 0; sfx.play(); }
                } else if (distance <= goodRange) {
                    // ä¸é”™åˆ¤å®š
                    gameState.miniGame.hits.good++; // ä¿®å¤ç‚¹2: å¢åŠ ä¸é”™å‘½ä¸­è®¡æ•°
                    showGuzhengFeedback('ä¸é”™', '#90EE90');
                    const sfx = document.getElementById('sfx-good-hit');
                    if(sfx) { sfx.currentTime = 0; sfx.play(); }
                }
                
                note.remove();
                notesOnString.splice(i, 1);
                hit = true;
                break; // æ¯æ¬¡ç‚¹å‡»åªå¤„ç†ä¸€ä¸ªéŸ³ç¬¦
            }
        }
    }
    
    if (!hit) {
        // å¦‚æœæ²¡æœ‰å‘½ä¸­ä»»ä½•åœ¨åˆ¤å®šåŒºçš„éŸ³ç¬¦ï¼Œåˆ™ç®—ä½œå¤±è¯¯
        showGuzhengFeedback('å¤±è¯¯', '#F08080');
        const sfx = document.getElementById('sfx-miss');
        if(sfx) { sfx.currentTime = 0; sfx.play(); }
    }

    // ã€ä¿®å¤æ ¸å¿ƒã€‘å®æ—¶åˆ†æ•°ç›´æ¥æ ¹æ®è¯¦ç»†æˆç»©è®¡ç®—ï¼Œç¡®ä¿ä¸€è‡´
    gameState.miniGame.score = gameState.miniGame.hits.perfect * 2 + gameState.miniGame.hits.good * 1;
    document.getElementById('guzheng-score-display').textContent = `å¾—åˆ†: ${gameState.miniGame.score}`;
}

/**
 * æ˜¾ç¤ºæ¸¸æˆåé¦ˆ
 */
function showGuzhengFeedback(text, color) {
    const feedbackEl = document.getElementById('guzheng-feedback');
    if (!feedbackEl) return;
    feedbackEl.textContent = text;
    feedbackEl.style.color = color;
    feedbackEl.classList.remove('show');
    void feedbackEl.offsetWidth; 
    feedbackEl.classList.add('show');
}
// =======================================================================
// =====================  ã€æ–°åŠŸèƒ½ä»£ç ã€‘ START  =========================
// =======================================================================
/**
 * ã€æ–°å¢å‡½æ•°ã€‘æ ¹æ®èŒä¸šäº§å‡ºä¸“å±ä¿¡ç‰©ææ–™
 */
// ===================== ã€è¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
function grantCareerCraftingItem() {
    const careerPath = gameState.career.path;
    if (!careerPath || gameState.career.level < 1) return;

    const itemData = CAREER_CRAFTING_ITEMS[careerPath];

    // â–¼â–¼â–¼ ã€æ ¸å¿ƒä¿®æ”¹ï¼šå°† 0.05 ä¿®æ”¹ä¸º 0.20ã€‘ â–¼â–¼â–¼
    if (itemData && Math.random() < 0.20) { // æ¦‚ç‡ä» 5% æå‡åˆ° 20%
    // â–²â–²â–² ã€ä¿®æ”¹ç»“æŸã€‘ â–²â–²â–²
        addItemToInventory(itemData.id, 1, itemData); 
        logEvent(`åœ¨å¤„ç†å…¬åŠ¡æ—¶ï¼Œä½ æ„å¤–è·å¾—äº† <strong class="value">${itemData.name}</strong>ï¼Œæˆ–è®¸èƒ½åœ¨å…³é”®æ—¶åˆ»æ´¾ä¸Šç”¨åœºã€‚`);
    }
}
// ã€æ–°å¢å‡½æ•°ã€‘ä½¿ç”¨è—å®é˜ç‰©å“å¢åŠ åŠŸç»©
function useInventoryItemForCareer(itemId, instanceId) {
    const itemDef = ITEM_DATA[itemId];
    if (!itemDef || !itemDef.performance_boost) {
        showToast("æ­¤ç‰©æ— æ³•ç”¨äºæå‡åŠŸç»©ã€‚");
        return;
    }

    if (removeItemFromInventory(itemId, 1, instanceId)) {
        const boost = itemDef.performance_boost;
        gameState.career.performance += boost;
        // [æ ¸å¿ƒä¿®æ”¹] å°† checkForPromotion ä½œä¸ºå›è°ƒå‡½æ•°ä¼ å…¥
        showEventCard('å…¬åŠ¡ç²¾è¿›', itemDef.icon, `ä½ ä½¿ç”¨äº†<strong class="value">ã€${itemDef.name}ã€‘</strong>ï¼Œå¤„ç†å…¬åŠ¡å¾—å¿ƒåº”æ‰‹ï¼ŒåŠŸç»©æå‡äº† <strong class="value">${boost}</strong> ç‚¹ï¼`, [{ text: 'çŸ¥é“äº†', callback: checkForPromotion }]);
        renderGame();
    } else {
        showToast("ä½¿ç”¨ç‰©å“å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚");
    }
}

// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢]
function handleProfessionEventResult(event, optionIndex) {
    const opt = event.options[optionIndex];
    let resultText = opt.result_text || "æ“ä½œå®Œæˆ";
    let effects = opt.effects || {};
    let outcome = { text: resultText, effects: effects };

    if (opt.getOutcome) {
        outcome = opt.getOutcome(gameState);
        resultText = outcome.text;
        effects = { ...effects, ...outcome.effects };
    }

    if (outcome.sub_decision) {
        const subDecision = outcome.sub_decision;
        const subOptions = subDecision.options.map(subOpt => {
            return {
                htmlContent: `<span class="option-text">${subOpt.text}</span>`,
                callback: () => {
                    let finalEffects = subOpt.effects || {};
                    let finalResultText = subOpt.result_text || "æŠ‰æ‹©å®Œæˆã€‚";

                    if (finalEffects.attributes) applyEffects({ attributes: finalEffects.attributes });
                    if (finalEffects.core_resources) {
                         Object.entries(finalEffects.core_resources).forEach(([key, val]) => {
                            gameState.career.core_resources[key] = (gameState.career.core_resources[key] || 0) + val;
                        });
                    }
                    if(finalEffects.item) {
                        addItemToInventory(finalEffects.item.id, finalEffects.item.amount || 1);
                    }
logEvent(`ã€${event.title}ã€‘: ${finalResultText}`);
                    // [ä¿®æ”¹ç‚¹] ä½¿ç”¨å›è°ƒæ¥æ£€æŸ¥æ™‹å‡
                    showEventCard(event.title, "fa-check-circle", finalResultText, [{ text: 'å¥½çš„', callback: checkForPromotion }]);
                }
            };
        });
        showDecisionCard(event.title, "fa-scroll", subDecision.desc, subOptions);
        return;
    }

    if (effects.attributes) applyEffects({ attributes: effects.attributes });
    if (effects.wealth) applyEffects({ wealth: effects.wealth });
    if (effects.core_resources && gameState.career.core_resources) {
        Object.entries(effects.core_resources).forEach(([key, val]) => {
            gameState.career.core_resources[key] = (gameState.career.core_resources[key] || 0) + val;
        });
    }
    if (effects.item) {
        addItemToInventory(effects.item.id, effects.item.amount || 1);
    }

    let performanceGain = getRandomInt(5, 15);
    if (gameState.buffs && gameState.buffs.career_luck) {
        performanceGain = Math.floor(performanceGain * 1.5);
        logEvent("åœ¨ã€åŠŸåã€‘ç¥ç¦çš„å½±å“ä¸‹ï¼Œä½ å¤„ç†å…¬åŠ¡äº‹åŠåŠŸå€ï¼");
    }
    gameState.career.performance += performanceGain;
    resultText += `<br>åŠŸç»©+${performanceGain}`;

    grantCareerCraftingItem();

    // [æ ¸å¿ƒä¿®æ”¹] å°† checkForPromotion ä½œä¸ºå›è°ƒå‡½æ•°ä¼ å…¥
    showEventCard("å…¬åŠ¡å¤„ç†ç»“æœ", "fa-check-circle", resultText, [{ text: 'çŸ¥é“äº†', callback: checkForPromotion }]);
}

// ===================== ã€ç¬¬äºŒæ­¥ï¼šè¯·ç”¨æ­¤å‡½æ•°å®Œæ•´æ›¿æ¢ã€‘ =====================
/**
 * [V2.0] æ£€æŸ¥èŒä¸šç”Ÿæ¶¯é‡Œç¨‹ç¢‘äº‹ä»¶å‡½æ•° - å¢åŠ äº†å®‰å…¨æ£€æŸ¥
 */
function checkMilestoneEvent() {
    if (!gameState.career.path) return;
    const career = PROFESSION_DATA[gameState.career.path];
    
    // ã€æ ¸å¿ƒä¿®å¤ã€‘åœ¨è®¿é—® act ä¹‹å‰ï¼Œå…ˆè¿›è¡Œå®‰å…¨æ£€æŸ¥
    if (!career || !career.acts || gameState.career.currentAct >= career.acts.length) {
        console.warn("èŒä¸šå¹•æ•°è¶…å‡ºç°æœ‰èŒƒå›´ï¼Œå¯èƒ½ç”±æ—§å­˜æ¡£å¯¼è‡´ã€‚å·²è‡ªåŠ¨è·³è¿‡ã€‚");
        return;
    }
    const act = career.acts[gameState.career.currentAct];
    if (!act) { // å¦‚æœ act ä»ç„¶æ˜¯ undefinedï¼Œåˆ™ç›´æ¥é€€å‡ºï¼Œé˜²æ­¢æŠ¥é”™
        return;
    }
    
    // --- ä»¥ä¸‹ä¸ºåŸæœ‰æ­£ç¡®é€»è¾‘ï¼Œäºˆä»¥ä¿ç•™ ---
    const milestone = act.milestone_event;
    if (!milestone || (gameState.career.milestone_triggered && gameState.career.milestone_triggered > gameState.career.currentAct)) return;
    let canTrigger = false;
    if (milestone.trigger.career_level && gameState.career.level >= milestone.trigger.career_level) {
        if (milestone.trigger.condition) {
            if (milestone.trigger.condition(gameState)) canTrigger = true;
        } else {
            canTrigger = true;
        }
    }
    if (canTrigger) {
        gameState.career.milestone_triggered = gameState.career.currentAct + 1;
        let options = [{
            htmlContent: `<i class="fas fa-gavel"></i> é¢å¯¹æŒ‘æˆ˜`,
            callback: () => {
                const successRate = 0.6;
                if (Math.random() < successRate) {
                    showEventCard(milestone.title, 'fa-crown', milestone.success.text);
                    applyEffects(milestone.success.effects);
                    if (gameState.career.currentAct < career.acts.length - 1) {
                        gameState.career.currentAct++;
                        logEvent(`ä½ çš„äººç”Ÿè¿›å…¥äº†æ–°çš„ç¯‡ç« ï¼š<strong class="value">${career.acts[gameState.career.currentAct].title}</strong>`);
                    }
                } else {
                    showEventCard(milestone.title, 'fa-skull-crossbones', milestone.failure.text);
                    applyEffects(milestone.failure.effects);
                }
            }
        }];
        showDecisionCard(`äººç”Ÿè½¬æŠ˜ç‚¹ï¼š${milestone.title}`, 'fa-star', milestone.desc, options);
    }
}
// =======================================================================
// ======================= æ–°ç‰ˆå•†ä¼šäº¤æ˜“ç©æ³•æ¨¡å— ==========================
// =======================================================================

const WAREHOUSE_LEVELS = [
    { level: 1, name: "åˆå§‹è´§æ¶", capacity: 100, upgradeCost: 0 },
    { level: 2, name: "å°å‹ä»“åº“", capacity: 300, upgradeCost: 5000 },
    { level: 3, name: "ä¸­å‹ä»“åº“", capacity: 600, upgradeCost: 20000 },
    { level: 4, name: "å¤§å‹ä»“åº“", capacity: 900, upgradeCost: 80000 },
    { level: 5, name: "å·¨å‹è´§æ ˆ", capacity: 1500, upgradeCost: 200000 }
];

const TRADE_SIM_DATA = {
    // ä»“åº“ç­‰çº§æ•°æ® (æ³¨ï¼šå®é™…å‡çº§é€»è¾‘ä½¿ç”¨çš„æ˜¯ WAREHOUSE_LEVELS)
    warehouses: [
        { name: "åˆå§‹ä»“åº“", capacity: 100, cost: 0 },
        { name: "ä¸­å‹ä»“åº“", capacity: 300, cost: 50 },
        { name: "å¤§å‹ä»“åº“", capacity: 600, cost: 120 }
    ],
    // å•†å“æ•°æ®
    goods: {
        yunjin: { guild: "æ±Ÿå—", name: "äº‘é”¦", basePrice: [120, 180] },
        longjingcha: { guild: "æ±Ÿå—", name: "é¾™äº•èŒ¶", basePrice: [80, 120] },
        zishahu: { guild: "æ±Ÿå—", name: "ç´«ç ‚å£¶", basePrice: [60, 100] },
        suxiu: { guild: "æ±Ÿå—", name: "è‹ç»£", basePrice: [90, 140] },
        hubi: { guild: "æ±Ÿå—", name: "æ¹–ç¬”", basePrice: [40, 70] },
        huimo: { guild: "æ±Ÿå—", name: "å¾½å¢¨", basePrice: [50, 80] },
        xuanzhi: { guild: "æ±Ÿå—", name: "å®£çº¸", basePrice: [30, 50] },
        duanyan: { guild: "æ±Ÿå—", name: "ç«¯ç š", basePrice: [100, 200] },
        hetianyu: { guild: "è¥¿åŸŸ", name: "å’Œç”°ç‰", basePrice: [200, 400] },
        putaojiu: { guild: "è¥¿åŸŸ", name: "è‘¡è„é…’", basePrice: [70, 110] },
        yeguangbei: { guild: "è¥¿åŸŸ", name: "å¤œå…‰æ¯", basePrice: [80, 130] },
        hutao: { guild: "è¥¿åŸŸ", name: "èƒ¡æ¡ƒ", basePrice: [20, 40] },
        ziran: { guild: "è¥¿åŸŸ", name: "å­œç„¶", basePrice: [25, 45] },
        xuelian: { guild: "è¥¿åŸŸ", name: "é›ªè²", basePrice: [150, 250] },
        luotuo: { guild: "è¥¿åŸŸ", name: "éª†é©¼", basePrice: [300, 500] },
        ditan: { guild: "è¥¿åŸŸ", name: "åœ°æ¯¯", basePrice: [90, 150] },
        renshen: { guild: "åŒ—å¢ƒ", name: "äººå‚", basePrice: [180, 280] },
        diaopi: { guild: "åŒ—å¢ƒ", name: "è²‚çš®", basePrice: [130, 200] },
        lurong: { guild: "åŒ—å¢ƒ", name: "é¹¿èŒ¸", basePrice: [160, 240] },
        tiekuang: { guild: "åŒ—å¢ƒ", name: "é“çŸ¿", basePrice: [40, 70] },
        beidima: { guild: "åŒ—å¢ƒ", name: "åŒ—åœ°é©¬", basePrice: [250, 400] },
        xiongdan: { guild: "åŒ—å¢ƒ", name: "ç†Šèƒ†", basePrice: [120, 180] },
        songzi: { guild: "åŒ—å¢ƒ", name: "æ¾å­", basePrice: [30, 50] },
        lingzhi: { guild: "åŒ—å¢ƒ", name: "çµèŠ", basePrice: [200, 300] },
        shanhu: { guild: "æµ·å¤–", name: "çŠç‘š", basePrice: [250, 400] },
        zhenzhu: { guild: "æµ·å¤–", name: "çç ", basePrice: [150, 250] },
        xiangya: { guild: "æµ·å¤–", name: "è±¡ç‰™", basePrice: [200, 350] },
        hujiao: { guild: "æµ·å¤–", name: "èƒ¡æ¤’", basePrice: [60, 100] },
        xiyangzhong: { guild: "æµ·å¤–", name: "è¥¿æ´‹é’Ÿ", basePrice: [300, 500] },
        boliqi: { guild: "æµ·å¤–", name: "ç»ç’ƒå™¨", basePrice: [100, 180] },
        xiangliao: { guild: "æµ·å¤–", name: "é¦™æ–™", basePrice: [70, 120] },
        zimingzhong: { guild: "æµ·å¤–", name: "è‡ªé¸£é’Ÿ", basePrice: [400, 600] }
    },
    // éšæœºäº‹ä»¶
    randomEvents: [
        { name: "æ±Ÿå—æ°´ç¾", desc: "æ±Ÿå—çªå‘æ°´ç¾ï¼Œæœ¬åœ°å•†å“ä¾›åº”çŸ­ç¼ºï¼Œä»·æ ¼ä¸Šæ¶¨ã€‚", prob: 0.1, effect: { type: 'guild', guild: "æ±Ÿå—", multiplier: 1.4 } },
        { name: "è¥¿åŸŸæ²™æš´", desc: "è¥¿åŸŸå•†è·¯å› æ²™æš´å—é˜»ï¼Œè¿è¾“æˆæœ¬å¤§å¢ã€‚", prob: 0.1, effect: { type: 'guild', guild: "è¥¿åŸŸ", multiplier: 1.35 } },
        { name: "åŒ—å¢ƒå¤§é›ª", desc: "åŒ—å¢ƒå¤§é›ªå°å±±ï¼Œç‰¹äº§éš¾ä»¥è¿å‡ºã€‚", prob: 0.15, effect: { type: 'guild', guild: "åŒ—å¢ƒ", multiplier: 1.3 } },
        { name: "æµ·ä¸Šé£æš´", desc: "æµ·ä¸Šé£æš´æ¥è¢­ï¼Œæµ·å¤–å•†å“åˆ°è´§å»¶è¿Ÿï¼Œä»·æ ¼é£æ¶¨ã€‚", prob: 0.1, effect: { type: 'guild', guild: "æµ·å¤–", multiplier: 1.5 } },
        { name: "è¾¹å¢ƒæˆ˜äº‹", desc: "è¾¹å¢ƒæˆ˜äº‹åƒç´§ï¼Œå†›éœ€ç‰©èµ„ä»·æ ¼é£™å‡ã€‚", prob: 0.08, effect: { type: 'goods', goods: ['tiekuang', 'beidima'], multiplier: 2.0 } },
        { name: "ç§‘ä¸¾å¤§è€ƒ", desc: "ä¸‰å¹´ä¸€åº¦çš„ç§‘ä¸¾å¼€å§‹ï¼Œæ–‡æˆ¿å››å®éœ€æ±‚å¤§å¢ã€‚", prob: 0.15, effect: { type: 'goods', goods: ['hubi', 'huimo', 'xuanzhi', 'duanyan'], multiplier: 1.6 } },
        { name: "çš‡å®¤åº†å…¸", desc: "å®«ä¸­ä¸¾åŠåº†å…¸ï¼Œå¥¢ä¾ˆå“ä¸çç©éœ€æ±‚æ—ºç››ã€‚", prob: 0.05, effect: { type: 'goods', goods: ['yunjin', 'suxiu', 'hetianyu', 'shanhu', 'zhenzhu', 'xiangya'], multiplier: 1.5 } },
        { name: "é’±åº„ç´§ç¼©", desc: "é’±åº„æ”¶ç´§é“¶æ ¹ï¼Œå¸‚åœºæµé€šçš„è´§å¸å‡å°‘ï¼Œå•†å“ä»·æ ¼æ™®éä¸‹è·Œã€‚", prob: 0.1, effect: { type: 'all', multiplier: 0.85 } },
        { name: "æµè¡Œé£å°š", desc: "æŸä»¶å•†å“çªç„¶åœ¨äº¬åŸè´µå¦‡åœˆä¸­æµè¡Œèµ·æ¥ï¼", prob: 0.08, effect: { type: 'random_good', multiplier: 1.8 } }
    ]
};
// =======================================================================
// ===================== ã€æ–°å¢ã€‘å¥³æ€§è§†è§’å¤«å›äº’åŠ¨ç³»ç»Ÿæ ¸å¿ƒæ•°æ® ==============
// =======================================================================
const SPOUSE_STATES = {
    ambitious: { id: 'ambitious', name: 'æ„æ°”é£å‘', icon: 'fa-chart-line', desc: 'äº‹ä¸šé¡ºåˆ©ï¼Œå¿ƒæƒ…æ„‰æ‚¦ã€‚' },
    frustrated: { id: 'frustrated', name: 'å¿ƒçƒ¦æ„ä¹±', icon: 'fa-cloud-showers-heavy', desc: 'äº‹ä¸šä¸é¡ºï¼Œæƒ…ç»ªä½è½ã€‚' },
    leisured: { id: 'leisured', name: 'é—²æƒ…é€¸è‡´', icon: 'fa-leaf', desc: 'æ— äº‹ä¸€èº«è½»ï¼Œä¹äºé™ªä¼´ã€‚' },
    exhausted: { id: 'exhausted', name: 'èº«å¿ƒä¿±ç–²', icon: 'fa-bed', desc: 'å¥åº·ä¸ä½³ï¼Œéœ€è¦ç…§æ–™ã€‚' },
    suspicious: { id: 'suspicious', name: 'ç–‘çª¦ä¸›ç”Ÿ', icon: 'fa-user-secret', desc: 'å¯¹ä½ å¿ƒå­˜æ€€ç–‘ï¼Œè¨€è¡Œæ•æ„Ÿã€‚' }
};

const FEMALE_SPOUSE_INTERACTIONS = {
    daily: [
        { id: 'care', name: 'å…³å¿ƒè¿‘å†µ', desc: 'ç»´ç³»æ„Ÿæƒ…çš„åŸºç¡€ã€‚' },
        { id: 'red_sleeve', name: 'çº¢è¢–æ·»é¦™', desc: 'é™ªä¼´å¤œè¯»ï¼Œæå‡æ‰æƒ…ä¸æ©å® ã€‚', cost: { action: 1 }, states: ['ambitious', 'frustrated'] },
        { id: 'drink_chess', name: 'å°é…Œå¯¹å¼ˆ', desc: 'é£èŠ±é›ªæœˆï¼Œå¢è¿›æ„Ÿæƒ…ã€‚', states: ['leisured'] },
        { id: 'give_gift', name: 'èµ é€ç¤¼ç‰©', desc: 'ç”¨ç§äº§ä¸ºä»–å‡†å¤‡ä¸€ä»½å¿ƒæ„ã€‚' }
    ],
    support: [
        { id: 'manage_network', name: 'æ‰“ç‚¹äººè„‰', desc: 'åŠ¨ç”¨ç§äº§ï¼Œä¸ºä»–çš„äº‹ä¸šé“ºè·¯ã€‚', cost: { wealth: 500 } },
        { id: 'analyze_situation', name: 'åˆ†ææ—¶å±€', desc: 'ç”¨ä½ çš„æ™ºæ…§ä¸ºä»–æ’å¿§è§£éš¾ã€‚', req: { wisdom: 60 }, states: ['frustrated'] },
        { id: 'solve_problem', name: 'æ’å¿§è§£éš¾', desc: 'ä»–ä¼šä¸»åŠ¨å‘ä½ æ±‚åŠ©ã€‚', is_event: true }
    ],
    household: [
        { id: 'pillow_talk', name: 'å¹æ•è¾¹é£', desc: 'å½±å“ä»–å¯¹å†…å®…äººäº‹çš„çœ‹æ³•ã€‚', req: { favor: 70, scheming: 50 }, states: ['ambitious', 'leisured', 'exhausted'] },
        { id: 'discuss_concubine', name: 'å•†è®®å¦¾å®¤', desc: 'æå‡ºå¯¹å¦¾å®¤çš„èµç½šå»ºè®®ã€‚' },
        { id: 'complain_mother_in_law', name: 'è¯·æ•™å©†å©†ä¹‹äº‹', desc: 'ä»¥é€€ä¸ºè¿›ï¼Œå·§å¦™åœ°å‘ŠçŠ¶ã€‚', req: { charm: 70 } },
        { id: 'expel_concubine', name: 'é©±èµ¶æ¶å¦¾', desc: 'æ»¡è¶³ç»ˆææ¡ä»¶åï¼Œå¯å¼€å®—ç¥ ï¼Œè¯·å®¶æ³•ã€‚', req: { favor: 100, authority: 100, evidence: true } }
    ]
};

// [æ›¿æ¢] HUSBAND_INTERACTION_DATA å¯¹è±¡
const HUSBAND_INTERACTION_DATA = {
    daily_affection: [
        {
            id: 'care_inquiry',
            name: 'å…³å¿ƒè¿‘å†µ',
            desc: 'ç»´ç³»æ„Ÿæƒ…çš„åŸºç¡€ã€‚',
            req: {}
        },
        {
            id: 'red_sleeve',
            name: 'çº¢è¢–æ·»é¦™',
            desc: 'é™ªä¼´å¤œè¯»ï¼Œæå‡æ‰æƒ…ä¸æ©å® ã€‚',
            req: { state: ['æ„æ°”é£å‘', 'å¿ƒçƒ¦æ„ä¹±'] }
        },
        {
            id: 'drink_chess',
            name: 'å°é…Œå¯¹å¼ˆ',
            desc: 'é£èŠ±é›ªæœˆï¼Œå¢è¿›æ„Ÿæƒ…ã€‚',
            req: { state: ['é—²æƒ…é€¸è‡´'] }
        },
        {
            id: 'give_gift',
            name: 'èµ é€ç¤¼ç‰©',
            desc: 'ç”¨ç§äº§ä¸ºä»–å‡†å¤‡ä¸€ä»½å¿ƒæ„ã€‚',
            req: {}
        },
        // [æ–°å¢]
        {
            id: 'prepare_meal',
            name: 'é€ä¸Šåƒé£Ÿ',
            desc: 'ä¸ºå¤«å›å‡†å¤‡ä»–å–œçˆ±çš„ç‚¹å¿ƒã€‚',
            req: { state: ['èº«å¿ƒä¿±ç–²', 'é—²æƒ…é€¸è‡´'] }
        },
        // [æ–°å¢]
        {
            id: 'play_music',
            name: 'æŠšç´è§£å¿§',
            desc: 'å¼¹å¥ä¸€æ›²ï¼Œä¸ºä»–èˆ’ç¼“å¿ƒç¥ã€‚',
            req: { talent: 60, state: ['å¿ƒçƒ¦æ„ä¹±'] }
        }
    ],
    career_support: [
        {
            id: 'manage_network',
            name: 'æ‰“ç‚¹äººè„‰',
            desc: 'åŠ¨ç”¨ç§äº§ï¼Œä¸ºä»–çš„äº‹ä¸šé“ºè·¯ã€‚',
            cost: { privateAssets: 500 },
            req: {}
        },
        {
            id: 'analyze_situation',
            name: 'åˆ†ææ—¶å±€',
            desc: 'ç”¨ä½ çš„æ™ºæ…§ä¸ºä»–æ’å¿§è§£éš¾ã€‚',
            req: { wisdom: 60, state: ['å¿ƒçƒ¦æ„ä¹±'] }
        },
        // [æ–°å¢]
        {
            id: 'use_family_ties',
            name: 'åŠ¨ç”¨å¨˜å®¶äººè„‰',
            desc: 'è¯·å¨˜å®¶å‡ºé¢ä¸ºå¤«å›åŠ©åŠ›ã€‚',
            req: { favor: 80 } // éœ€è¦å¤«å¦»æ©çˆ±å€¼é«˜
        },
        // [æ–°å¢]
        {
            id: 'praise_husband',
            name: 'åœ¨å¤–ç§°èµå¤«å›',
            desc: 'åœ¨è´µå¦‡åœˆä¸­ç§°èµå¤«å›çš„æ‰å¹²ã€‚',
            req: { charm: 70 }
        }
    ],
    household_discussion: [
        {
            id: 'pillow_talk',
            name: 'å¹æ•è¾¹é£',
            desc: 'å½±å“ä»–å¯¹å†…å®…äººäº‹çš„çœ‹æ³•ã€‚',
            req: { favor: 70, scheming: 50, state_not: ['ç–‘çª¦ä¸›ç”Ÿ'] }
        },
        // [æ–°å¢]
        {
            id: 'discuss_children_edu',
            name: 'å•†è®®å­å—£å‰ç¨‹',
            desc: 'ä¸å¤«å›å…±åŒè§„åˆ’å­å¥³çš„æœªæ¥ã€‚',
            req: { favor: 60 }
        },
        // [æ–°å¢]
        {
            id: 'request_authority',
            name: 'è¯·æ±‚æŒç®¡è´¢æƒ',
            desc: 'è®¤ä¸ºè‡ªå·±èƒ½æ›´å¥½åœ°æ‰“ç†å®¶åº“ã€‚',
            req: { wisdom: 80, authority: 50 } // éœ€è¦ä¸€å®šæ™ºæ…§å’Œéƒ¨åˆ†æŒå®¶æƒ
        }
    ]
};
// [æ–°å¢] WIFE_INTERACTION_DATA å¯¹è±¡
const WIFE_INTERACTION_DATA = {
    daily_affection: [
        {
            id: 'praise_publicly',
            name: 'å½“ä¼—ç§°èµ',
            desc: 'åœ¨å®¶äººé¢å‰ç§°èµå¥¹çš„æŒå®¶ä¹‹èƒ½ã€‚',
            req: {}
        },
        {
            id: 'accompany_back',
            name: 'é™ªä¼´å›é—¨',
            desc: 'é™ªå¥¹å›å¨˜å®¶ï¼Œè®©å¥¹å€æœ‰é¢œé¢ã€‚',
            req: { favor: 50 }
        },
        {
            id: 'listen_troubles',
            name: 'å€¾å¬çƒ¦æ¼',
            desc: 'è€å¿ƒå€¾å¬å¥¹ç®¡ç†åå®…çš„çƒ¦æ¼ã€‚',
            req: {}
        },
        {
            id: 'give_personal_gift',
            name: 'èµ é€ç§ç¤¼',
            desc: 'ç”¨ä½ çš„ç§äº§ä¸ºå¥¹å‡†å¤‡æƒŠå–œã€‚',
            req: {}
        }
    ],
    household_discussion: [
        {
            id: 'delegate_authority',
            name: 'ä¸‹æ”¾æŒå®¶æƒ',
            desc: 'å°†éƒ¨åˆ†æˆ–å…¨éƒ¨æŒå®¶æƒäº¤ç»™å¥¹ã€‚',
            req: { prestige: 60 } // éœ€è¦ä¸€å®šå®¶å¨
        },
        {
            id: 'discuss_concubines',
            name: 'å•†è®®å¦¾å®¤äº‹å®œ',
            desc: 'å°±å¦¾å®¤çš„èµç½šæ™‹å‡å¾æ±‚å¥¹çš„æ„è§ã€‚',
            req: { favor: 70 } // éœ€æ©çˆ±å€¼é«˜
        },
        {
            id: 'plan_banquet',
            name: 'å…±åŠå®¶å®´',
            desc: 'ä¸å¥¹ä¸€èµ·ç­–åˆ’ä¸€åœºå®¶å®´ã€‚',
            req: {}
        }
    ],
    career_support: [
        {
            id: 'provide_funds',
            name: 'æ‹¨ä»˜èµ„é‡‘',
            desc: 'ä»ç§äº§æ‹¨ä»˜èµ„é‡‘æ”¯æŒå¥¹çš„äº‹ä¸šæˆ–çˆ±å¥½ã€‚',
            req: {}
        },
        {
            id: 'praise_management',
            name: 'èµæ‰¬æŒå®¶ä¹‹èƒ½',
            desc: 'è‚¯å®šå¥¹åœ¨ç®¡ç†å†…åŠ¡ä¸Šçš„è´¡çŒ®ã€‚',
            req: { authority_holder: 'wife' } // éœ€è¦å¦»å­æ˜¯æŒäº‹è€…
        }
    ]
};

const FAVOR_LEVEL_DATA = {
    0: { name: 'ç›¸æ•¬å¦‚å†°', desc: 'ä¸ˆå¤«åœ¨æ‰€æœ‰å†…æ–—äº‹ä»¶ä¸­ï¼Œ100%åå‘å©†å©†æˆ–å—å® å¦¾å®¤ã€‚' },
    21: { name: 'å¹³æ·¡å¦‚æ°´', desc: 'ä¸ˆå¤«åœ¨å†…æ–—ä¸­æŒä¸­ç«‹æ€åº¦ï¼Œå€¾å‘äºâ€œæ¯äº‹å®äººâ€ã€‚' },
    51: { name: 'ç´ç‘Ÿå’Œé¸£', desc: 'ä¸ˆå¤«åœ¨å†…æ–—ä¸­70%çš„å‡ ç‡åå‘äºä½ ã€‚' },
    81: { name: 'æƒ…æ·±æ„ç¬ƒ', desc: 'ä¸ˆå¤«åœ¨å†…æ–—ä¸­95%çš„å‡ ç‡æ— æ¡ä»¶æ”¯æŒä½ ï¼Œå¹¶ä¸ºä½ æŠµæŒ¡å‹åŠ›ã€‚' },
    100: { name: 'å¿ƒæœ‰çµçŠ€', desc: 'ç»å¯¹ä¿¡ä»»ï¼Œä½ çš„æ‰€æœ‰å»ºè®®éƒ½å°†100%æˆåŠŸã€‚' }
};

// =======================================================================
// ===================== ã€æ–°å¢ã€‘ç»´ç³»ä¿¡ä»»äº‹ä»¶åº“ ==========================
// =======================================================================

// ç”·æ€§ç©å®¶ç»´ç³»ä¸å¦»å­ä¿¡ä»»çš„äº‹ä»¶åº“
const MALE_TRUST_EVENTS = {
    gift: [
        { title: "èµ é€ç é’—", desc: "ä½ è·¯è¿‡é¦–é¥°é“ºï¼Œæƒ³èµ·å¦»å­ä¼¼ä¹å¾ˆå–œæ¬¢ä¸€æ”¯å—æµ·çç é’—ã€‚", options: [
            { text: "ä¹°ä¸‹ç›¸èµ ", cost: { wealth: 500 }, effects: { suspicion: -10, favor: 8 }, log: "å¦»å­æ”¶åˆ°ç é’—æƒŠå–œä¸å·²ï¼Œä½ ä»¬çš„æƒ…æ„Ÿå‡æ¸©ã€‚" },
            { text: "å›Šä¸­ç¾æ¶©", effects: { favor: -2 }, log: "ä½ æœ€ç»ˆæ²¡æœ‰è´­ä¹°ï¼Œå¦»å­ä¼¼ä¹æœ‰äº›å¤±è½ã€‚" }
        ]},
        { title: "äº²æ‰‹åˆ¶ä½œ", desc: "ä½ æ¡åˆ°ä¸€å—ä¸Šå¥½çš„æ¥ æœ¨ï¼Œæ‰“ç®—äº²æ‰‹ä¸ºå¥¹åšä¸€ä¸ªå°ç‰©ä»¶ã€‚", options: [
            { text: "åˆ¶ä½œæœ¨æ¢³", req: { talent: 40 }, effects: { suspicion: -12, favor: 10 }, log: "ä½ äº²æ‰‹æ‰“ç£¨çš„æœ¨æ¢³è™½ä¸è´µé‡ï¼Œå´æ»¡å«å¿ƒæ„ï¼Œå¦»å­ååˆ†æ„ŸåŠ¨ã€‚" },
            { text: "åˆ¶ä½œå‘ç°ª", req: { talent: 60 }, effects: { suspicion: -15, favor: 12 }, log: "ä½ ç²¾å·§çš„æ‰‹è‰ºè®©å¦»å­èµä¸ç»å£ï¼Œå¥¹ç«‹åˆ»å°†å‘ç°ªæˆ´ä¸Šã€‚" }
        ]},
        // ... æ­¤å¤„ä¸ºå…¶ä»–18ä¸ªç”·æ€§èµ ç¤¼äº‹ä»¶ ...
    ],
    talk: [
        { title: "å¦è¯šå…¬åŠ¡", desc: "ä½ ä¸»åŠ¨ä¸å¦»å­è°ˆèµ·æœ€è¿‘åœ¨å…¬åŠ¡ä¸Šçš„çƒ¦å¿ƒäº‹ã€‚", options: [
            { text: "å¯»æ±‚å¥¹çš„å»ºè®®", req: { wisdom: 50 }, effects: { suspicion: -8, favor: 5 }, log: "å¥¹çš„å»ºè®®è™½ä¸ä¸“ä¸šï¼Œä½†è®©ä½ æ„Ÿåˆ°æ¸©æš–ï¼Œç–‘è™‘ä¹Ÿæ¶ˆè§£äº†äº›è®¸ã€‚" },
            { text: "åªæ˜¯å€¾è¯‰", effects: { suspicion: -6, favor: 3 }, log: "ä½ çš„å¦è¯šè®©å¥¹è§‰å¾—å—åˆ°äº†å°Šé‡ã€‚" }
        ]},
        { title: "èµç¾å²³å®¶", desc: "ä½ åœ¨å¦»å­é¢å‰ç§°èµå¥¹å¨˜å®¶çš„å®¶é£ä¸å“è¡Œã€‚", options: [
            { text: "çœŸå¿ƒå®æ„åœ°èµç¾", effects: { suspicion: -10, favor: 7 }, log: "å¦»å­å¬åååˆ†é«˜å…´ï¼Œè®¤ä¸ºä½ å°Šé‡å¥¹çš„å®¶äººã€‚" },
            { text: "é¡ºä¾¿æåŠå²³å®¶åŠ©åŠ›", req: { charm: 60 }, effects: { suspicion: -5, favor: 5 }, log: "ä½ çš„è¯è¯­ä¸€è¯­åŒå…³ï¼Œå¦»å­ä¼šå¿ƒä¸€ç¬‘ã€‚" }
        ]},
        // ... æ­¤å¤„ä¸ºå…¶ä»–18ä¸ªç”·æ€§äº¤è°ˆäº‹ä»¶ ...
    ],
    accompany: [
        { title: "é™ªä¼´å›é—¨", desc: "å¦»å­æƒ³å›å¨˜å®¶çœ‹çœ‹ï¼Œä½ å†³å®šæ”¾ä¸‹æ‰‹å¤´äº‹åŠ¡ï¼Œé™ªå¥¹ä¸€åŒå‰å¾€ã€‚", options: [
            { text: "æ¬£ç„¶å‰å¾€", effects: { suspicion: -15, favor: 10, reputation: 5 }, log: "ä½ çš„é™ªä¼´è®©å¦»å­åœ¨å¨˜å®¶éå¸¸æœ‰é¢å­ï¼Œä½ ä»¬çš„å…³ç³»æ›´åŠ äº²å¯†ã€‚" },
            { text: "é€åˆ°é—¨å£", effects: { suspicion: -5, favor: 2 }, log: "ä½ å°†å¥¹é€åˆ°å²³å®¶é—¨å£ï¼Œä¹Ÿç®—å°½åˆ°äº†ç¤¼æ•°ã€‚" }
        ]},
        { title: "å…±èµé£æœˆ", desc: "ä½ æè®®ä¸å¦»å­ä¸€åŒå»æ¹–å¿ƒäº­èµæœˆã€‚", options: [
            { text: "æœˆä¸‹å¯¹é…Œ", effects: { suspicion: -12, favor: 8 }, log: "ä½ ä»¬åœ¨æœˆä¸‹å°é…Œï¼Œç›¸è°ˆç”šæ¬¢ï¼Œä»¿ä½›å›åˆ°äº†åˆè¯†ä¹‹æ—¶ã€‚" },
            { text: "å³å…´èµ‹è¯—", req: { talent: 70 }, effects: { suspicion: -18, favor: 15 }, log: "ä½ å³å…´èµ‹è¯—ä¸€é¦–ï¼Œå¦»å­çœ¼ä¸­æ»¡æ˜¯å´‡æ‹œçš„å…‰èŠ’ã€‚" }
        ]},
        // ... æ­¤å¤„ä¸ºå…¶ä»–18ä¸ªç”·æ€§é™ªä¼´äº‹ä»¶ ...
    ]
};

// å¥³æ€§ç©å®¶ç»´ç³»ä¸å¤«å›ä¿¡ä»»çš„äº‹ä»¶åº“
const FEMALE_TRUST_EVENTS = {
    gift: [
        { title: "ç¼åˆ¶å¤–è¢", desc: "å¤©æ°”è½¬å‡‰ï¼Œä½ æ‰“ç®—ä¸ºå¤«å›äº²æ‰‹ç¼åˆ¶ä¸€ä»¶å¤–è¢ã€‚", options: [
            { text: "ç²¾å¿ƒç¼åˆ¶", req: { talent: 50 }, effects: { suspicion: -12, favor: 10 }, log: "ä½ çš„é’ˆçº¿ç»†å¯†ï¼Œå¤«å›ç©¿ä¸Šåååˆ†åˆèº«ï¼Œå¯¹ä½ çš„è´¤æƒ èµä¸ç»å£ã€‚" },
            { text: "è´­ä¹°ç°æˆ", cost: { wealth: 300 }, effects: { suspicion: -8, favor: 5 }, log: "ä½ ä¹°äº†ä¸€ä»¶ä¸Šå¥½çš„å¤–è¢ï¼Œå¤«å›ä¹Ÿå¾ˆé«˜å…´ã€‚" }
        ]},
        { title: "å‡†å¤‡é†’é…’æ±¤", desc: "å¤«å›åº”é…¬æ™šå½’ï¼Œé†‰æ„é†ºé†ºã€‚", options: [
            { text: "äº²æ‰‹ç†¬åˆ¶", effects: { suspicion: -10, favor: 8 }, log: "ä½ ç«¯ä¸Šä¸€ç¢—çƒ­æ°”è…¾è…¾çš„é†’é…’æ±¤ï¼Œå¤«å›å¿ƒä¸­ä¸€æš–ï¼Œé…’é†’åå¯¹ä½ å……æ»¡æ„Ÿæ¿€ã€‚" },
            { text: "è®©ä¸‹äººå‡†å¤‡", effects: { suspicion: -5, favor: 3 }, log: "ä½ å©å’ä¸‹äººå¤‡å¥½é†’é…’æ±¤ï¼Œä¹Ÿç®—å°½åˆ°äº†å¦»å­çš„æœ¬åˆ†ã€‚" }
        ]},
        // ... æ­¤å¤„ä¸ºå…¶ä»–18ä¸ªå¥³æ€§èµ ç¤¼äº‹ä»¶ ...
    ],
    talk: [
        { title: "ä¸»åŠ¨é—®è¯¢", desc: "ä½ è§å¤«å›é¢æœ‰æ„å®¹ï¼Œä¸»åŠ¨ä¸Šå‰è¯¢é—®æ˜¯å¦é‡åˆ°äº†çƒ¦å¿ƒäº‹ã€‚", options: [
            { text: "æ¸©æŸ”å¼€è§£", req: { charm: 60 }, effects: { suspicion: -10, favor: 8 }, log: "ä½ çš„æ¸©æŸ”è®©ä»–æ”¾ä¸‹äº†é˜²å¤‡ï¼Œå‘ä½ å€¾è¯‰äº†çƒ¦æ¼ã€‚" },
            { text: "æå‡ºå»ºè®®", req: { wisdom: 70 }, effects: { suspicion: -15, favor: 12 }, log: "ä½ ç‹¬åˆ°çš„è§è§£è®©ä»–èŒ…å¡é¡¿å¼€ï¼Œå¯¹ä½ åˆ®ç›®ç›¸çœ‹ã€‚" }
        ]},
        { title: "æåŠå­å—£", desc: "ä½ ä¸å¤«å›è°ˆè®ºèµ·å­©å­ä»¬çš„è¶£äº‹ã€‚", options: [
            { text: "åˆ†äº«è¶£äº‹", effects: { suspicion: -8, favor: 5 }, log: "è°ˆåŠå­©å­ï¼Œä½ ä»¬ä¹‹é—´çš„è¯é¢˜å¤šäº†èµ·æ¥ï¼Œæ°”æ°›èæ´½ã€‚" },
            { text: "è§„åˆ’æœªæ¥", req: { wisdom: 60 }, effects: { suspicion: -12, favor: 8 }, log: "ä½ ä»¬ä¸€åŒä¸ºå­©å­çš„æœªæ¥åšè§„åˆ’ï¼Œè®©ä»–æ„Ÿå—åˆ°äº†å®¶åº­çš„æ¸©æš–ã€‚" }
        ]},
        // ... æ­¤å¤„ä¸ºå…¶ä»–18ä¸ªå¥³æ€§äº¤è°ˆäº‹ä»¶ ...
    ],
    accompany: [
        { title: "çº¢è¢–æ·»é¦™", desc: "å¤«å›åœ¨ä¹¦æˆ¿å¤œè¯»ï¼Œä½ å†³å®šå‰å»é™ªä¼´ã€‚", options: [
            { text: "é»˜é»˜ç£¨å¢¨", effects: { suspicion: -10, favor: 7 }, log: "æ— å£°çš„é™ªä¼´èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼Œå¤«å›æ„Ÿåˆ°ååˆ†å®‰å¿ƒã€‚" },
            { text: "æŠšç´ä¸€æ›²", req: { talent: 70 }, effects: { suspicion: -15, favor: 12 }, log: "ä½ çš„ç´å£°æ‚ æ‰¬ï¼Œä¸ºä»–é©±æ•£äº†ç–²æƒ«ï¼Œè®©ä»–å¯¹ä½ æ›´æ·»çˆ±æ„ã€‚" }
        ]},
        { title: "å…±ç†å®¶äº‹", desc: "ä½ é‚€è¯·å¤«å›ä¸€åŒæ ¸å¯¹å®¶ä¸­è´¦ç›®ã€‚", options: [
            { text: "å±•ç°èƒ½åŠ›", req: { wisdom: 60 }, effects: { suspicion: -12, favor: 8 }, log: "ä½ å°†è´¦ç›®æ•´ç†å¾—äº•äº•æœ‰æ¡ï¼Œè®©ä»–çœ‹åˆ°äº†ä½ çš„æŒå®¶èƒ½åŠ›ã€‚" },
            { text: "å…±åŒå•†è®®", effects: { suspicion: -10, favor: 6 }, log: "ä½ ä»¬ä¸€åŒå•†è®®å®¶äº‹ï¼Œè®©ä»–è§‰å¾—ä½ æ˜¯åœ¨ä¸ä»–å…±åŒæ‰¿æ‹…è¿™ä¸ªå®¶ã€‚" }
        ]},
        // ... æ­¤å¤„ä¸ºå…¶ä»–18ä¸ªå¥³æ€§é™ªä¼´äº‹ä»¶ ...
    ]
};

// ===================== ã€æ–°å¢ã€‘å¦¾å®¤ä½ä»½ç³»ç»Ÿæ ¸å¿ƒæ•°æ® =====================
const CONCUBINE_RANKS = [
    { level: 0, name: 'ä¾å¦¾', allowance: 500, favorBonus: 0, promotionFavorReq: 60, promotionChildReq: false },
    { level: 1, name: 'è‰¯å¨£', allowance: 1200, favorBonus: 5, promotionFavorReq: 80, promotionChildReq: true },
    { level: 2, name: 'è´µå«”', allowance: 3000, favorBonus: 10, promotionFavorReq: Infinity, promotionChildReq: false }
];

// ===================== ã€æ–°å¢ã€‘å¤«å¦»æ¸©å­˜äº‹ä»¶åº“ START =====================
// ===================== ã€å®Œæ•´æ›¿æ¢ç”¨ä»£ç å—ã€‘å¤«å¦»æ¸©å­˜äº‹ä»¶åº“ (V2.0 ç»ˆææ‰©å……ç‰ˆ) START =====================
const SPOUSE_INTIMACY_EVENTS = {
    // ç©å®¶ä¸ºç”·æ€§æ—¶ï¼Œä¸å¦»å­çš„äº’åŠ¨äº‹ä»¶
    wife: [
        // æ‚¨å·²æœ‰çš„10ä¸ªäº‹ä»¶ (å·²å®Œæ•´ä¿ç•™)
        {
            title: "çº¢è¢–æ·»é¦™",
            desc: "å¤œæ·±äº†ï¼Œä½ è§ä¹¦æˆ¿ç¯ç«æœªç†„ï¼Œä¾¿ç«¯ç€ä¸€ç¢—è²å­ç¾¹èµ°äº†è¿›å»ã€‚ä½ çš„å¦»å­è§ä½ å‰æ¥ï¼Œçœ¼ä¸­æ»¡æ˜¯æƒŠå–œä¸æŸ”æƒ…ã€‚",
            options: [
                { text: "ã€å–‚å¥¹åƒã€‘", req: { charm: 70 }, effects: { favor: 15, health: 2 }, log: "ä½ æ‹¿èµ·æ±¤åŒ™ï¼Œäº²è‡ªå–‚å¥¹åƒä¸‹ã€‚å¥¹é¢é¢Šç»¯çº¢ï¼Œè§‰å¾—è¿™è²å­ç¾¹ç”œåˆ°äº†å¿ƒåº•ã€‚" },
                { text: "ã€å®å˜±å¥¹æ—©äº›æ­‡æ¯ã€‘", effects: { favor: 10, virtue: 1 }, log: "ä½ å®å˜±å¥¹ä¸è¦å¤ªè¿‡åŠ³ç´¯ï¼Œè¿™ä»½å…³å¿ƒè®©å¥¹æ„Ÿåˆ°æ— æ¯”æ¸©æš–ã€‚" }
            ]
        },
        {
            title: "é›¨å¤œé—²è¯",
            desc: "çª—å¤–ç»†é›¨è¿ç»µï¼Œä½ ä»¬åœ¨æ¦»ä¸Šç›¸æ‹¥è€Œå§ï¼Œé—²èŠèµ·å¾€äº‹ã€‚",
            options: [
                { text: "ã€å›å¿†åˆè§ã€‘", effects: { favor: 12 }, log: "ä½ ä»¬å›å¿†èµ·åˆè§æ—¶çš„æƒ…æ™¯ï¼Œç›¸è§†ä¸€ç¬‘ï¼Œä»¿ä½›ä¸€åˆ‡éƒ½è¿˜åœ¨æ˜¨å¤©ã€‚" },
                { text: "ã€è§„åˆ’æœªæ¥ã€‘", req: { wisdom: 60 }, effects: { favor: 10 }, log: "ä½ ä»¬ä¸€åŒè§„åˆ’ç€å­å¥³çš„æœªæ¥ä¸å®¶æ—çš„å…´ç››ï¼Œå¿ƒä¸­å……æ»¡äº†å¯¹æœªæ¥çš„æœŸç›¼ã€‚" }
            ]
        },
        {
            title: "é†‰é…’çš„å¨‡æ†¨",
            desc: "å¥¹åœ¨ä¸€æ¬¡å®¶å®´ä¸Šå¤šå–äº†å‡ æ¯ï¼Œæ­¤åˆ»æ­£åŒé¢Šç»¯çº¢ï¼Œçœ¼ç¥è¿·ç¦»åœ°çœ‹ç€ä½ ï¼Œæ¯”å¹³æ—¥é‡Œå¤šäº†å‡ åˆ†å¨‡æ†¨ã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹å¸å¦†ã€‘", effects: { favor: 15 }, log: "ä½ æ¸©æŸ”åœ°ä¸ºå¥¹å¸å»é’—ç¯ï¼Œæ“¦æ‹­è„¸é¢Šã€‚å¥¹å®‰å¿ƒåœ°åœ¨ä½ æ€€ä¸­ç¡å»ï¼Œå£ä¸­è¿˜å‘¢å–ƒç€ä½ çš„åå­—ã€‚" },
                { text: "ã€â€œæƒ©ç½šâ€å¥¹ã€‘", effects: { favor: 12 }, log: "ä½ ç¬‘ç€åˆ®äº†åˆ®å¥¹çš„é¼»å­ï¼Œè¯´è¦â€œæƒ©ç½šâ€å¥¹ä¸èƒœé…’åŠ›ï¼Œå¥¹å´ giggling åœ°å»äº†ä¸Šæ¥ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ ç†å®¹",
            desc: "æ¸…æ™¨ï¼Œå¥¹ä¸ºä½ æ•´ç†è¡£å† ï¼Œç»†å¿ƒåœ°æŠšå¹³ä½ è¡£é¢†çš„æ¯ä¸€å¤„è¤¶çš±ã€‚",
            options: [
                { text: "ã€æ¡ä½å¥¹çš„æ‰‹ã€‘", effects: { favor: 10 }, log: "ä½ æ¡ä½å¥¹ä¸ºä½ å¿™ç¢Œçš„åŒæ‰‹ï¼Œæ”¾åœ¨å”‡è¾¹è½»å»ï¼Œå¥¹æ¸©æŸ”åœ°å¯¹ä½ ä¸€ç¬‘ã€‚" },
                { text: "ã€ç§°èµå¥¹è´¤æƒ ã€‘", effects: { favor: 8 }, log: "â€œæœ‰å¦»å¦‚æ­¤ï¼Œå¤«å¤ä½•æ±‚ã€‚â€ä½ çš„ç§°èµè®©å¥¹ä¸€æ•´å¤©å¿ƒæƒ…éƒ½å¾ˆå¥½ã€‚" }
            ]
        },
        {
            title: "å¤«å¦»ä¸€ä½“",
            desc: "ä½ å› å…¬åŠ¡çƒ¦å¿ƒï¼Œå”‰å£°å¹æ°”ã€‚å¥¹å¯Ÿè§‰åï¼Œé»˜é»˜åœ°ä»èº«åæŠ±ä½äº†ä½ ã€‚",
            options: [
                { text: "ã€å‘å¥¹å€¾è¯‰ã€‘", effects: { favor: 12 }, log: "ä½ å‘å¥¹å€¾è¯‰äº†çƒ¦æ¼ï¼Œå¥¹è™½ä¸èƒ½ä¸ºä½ åˆ†å¿§ï¼Œä½†è¿™ä»½æ— å£°çš„æ”¯æŒç»™äº†ä½ è«å¤§çš„åŠ›é‡ã€‚" },
                { text: "ã€åæ‰‹æŠ±ä½å¥¹ã€‘", effects: { favor: 10 }, log: "ä½ åæ‰‹å°†å¥¹æ‹¥å…¥æ€€ä¸­ï¼Œå‘Šè¯‰å¥¹ä¸å¿…æ‹…å¿ƒã€‚å¤«å¦»åŒå¿ƒï¼Œå†å¤§çš„å›°éš¾ä¹Ÿèƒ½è¿‡å»ã€‚" }
            ]
        },
        {
            title: "æ—§ç‰©æƒ…æ€",
            desc: "ä½ ä»¬åœ¨æ•´ç†æ—§ç‰©æ—¶ï¼Œç¿»å‡ºäº†å½“å¹´çš„å®šæƒ…ä¿¡ç‰©ã€‚",
            options: [
                { text: "ã€æ„Ÿæ…¨ä¸‡åƒã€‘", effects: { favor: 10 }, log: "â€œä¸€æ™ƒçœ¼ï¼Œç«Ÿå·²è¿‡äº†è¿™ä¹ˆå¤šå¹´ã€‚â€ä½ ä»¬ä¸€åŒå›å¿†èµ·å½“å¹´çš„é’æ¶©æ—¶å…‰ï¼Œæ„Ÿæ…¨ä¸‡åƒã€‚" },
                { text: "ã€ä¸ºå¥¹é‡æ–°æˆ´ä¸Šã€‘", effects: { favor: 12 }, log: "ä½ æ‹¿èµ·ä¿¡ç‰©ï¼Œå¦‚å½“å¹´ä¸€èˆ¬ï¼Œéƒ‘é‡åœ°ä¸ºå¥¹é‡æ–°ä½©æˆ´ä¸Šã€‚å¥¹çœ¼çœ¶å¾®çº¢ï¼Œæ»¡æ˜¯æ„ŸåŠ¨ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ ç¼è¡¥",
            desc: "ä½ å‘ç°è¢–å£æœ‰ä¸€å¤„å°çš„ç ´æŸï¼Œå¥¹è§äº†ï¼Œç«‹åˆ»å–æ¥é’ˆçº¿ï¼Œä¸ºä½ ç»†ç»†ç¼è¡¥ã€‚",
            options: [
                { text: "ã€é™é™çœ‹ç€å¥¹ã€‘", effects: { favor: 10 }, log: "çƒ›å…‰ä¸‹ï¼Œå¥¹ä¸ºä½ ç¼è¡¥è¡£ç‰©çš„ä¾§è„¸æ¸©æŸ”è€Œä¸“æ³¨ï¼Œä½ å¿ƒä¸­ä¸€ç‰‡å®‰å®ã€‚" },
                { text: "ã€ä»èƒŒåæ‹¥ä½å¥¹ã€‘", effects: { favor: 12 }, log: "ä½ ä»èƒŒåæ‹¥ä½å¥¹ï¼Œå°†å¤´é åœ¨å¥¹è‚©ä¸Šï¼Œå¥¹å—”æ€ªä½ åˆ«é—¹ï¼Œå˜´è§’å´å¿ä¸ä½ä¸Šæ‰¬ã€‚" }
            ]
        },
        {
            title: "æ’’å¨‡",
            desc: "å¥¹ä»Šæ—¥ä¸çŸ¥ä¸ºä½•ï¼Œåƒä¸ªå­©å­ä¸€æ ·å¯¹ä½ æ’’å¨‡ï¼Œè¦ä½ é™ªå¥¹ç©ç¿»èŠ±ç»³ã€‚",
            options: [
                { text: "ã€å® æººåœ°é™ªå¥¹ç©ã€‘", effects: { favor: 12 }, log: "ä½ å® æººåœ°é™ªå¥¹ç©äº†ä¸€ä¸‹åˆï¼Œè™½ç„¶å¹¼ç¨šï¼Œä½†å¥¹çš„ç¬‘å£°æ˜¯ä½ æœ€å¤§çš„æ»¡è¶³ã€‚" },
                { text: "ã€æ•™è®­å¥¹æ²¡æ­£å½¢ã€‘", effects: { favor: -8 }, log: "ä½ æ¿èµ·è„¸æ•™è®­å¥¹æ²¡æœ‰ä¸»æ¯çš„æ ·å­ï¼Œå¥¹å§”å±ˆåœ°æ‰äº†æ‰å˜´ï¼Œä¸å†ç†ä½ ã€‚" }
            ]
        },
        {
            title: "å™©æ¢¦",
            desc: "åŠå¤œï¼Œå¥¹ä»å™©æ¢¦ä¸­æƒŠé†’ï¼Œç´§ç´§åœ°æŠ±ä½ä½ ï¼Œèº«ä½“è¿˜åœ¨å¾®å¾®å‘æŠ–ã€‚",
            options: [
                { text: "ã€è½»å£°å®‰æŠšã€‘", effects: { favor: 15 }, log: "ä½ å°†å¥¹ç´§ç´§æ‹¥åœ¨æ€€é‡Œï¼Œè½»å£°å®‰æŠšï¼Œç›´åˆ°å¥¹å†æ¬¡å¹³é™ä¸‹æ¥ï¼Œå®‰ç„¶å…¥ç¡ã€‚" },
                { text: "ã€ç‚¹ç¯è¯¢é—®ã€‘", effects: { favor: 10 }, log: "ä½ ç‚¹äº®çƒ›ç«ï¼Œä¸ºå¥¹å€’æ¥çƒ­èŒ¶ï¼Œè€å¿ƒè¯¢é—®å¥¹æ¢¦åˆ°äº†ä»€ä¹ˆã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ åˆ†å¿§",
            desc: "ä½ çš„ä¸€ä½æ”¿æ•Œæœ€è¿‘ååˆ†åš£å¼ ï¼Œå¥¹å¾—çŸ¥åï¼Œä¸ºä½ åˆ†æäº†å¯¹æ–¹çš„å¼±ç‚¹ï¼Œå¹¶æå‡ºäº†åº”å¯¹ä¹‹ç­–ã€‚",
            options: [
                { text: "ã€å¬å–å¥¹çš„å»ºè®®ã€‘", req: { wisdom: 80 }, effects: { favor: 18 }, log: "ä½ æƒŠè®¶äºå¥¹çš„èªæ…§ä¸è°‹ç•¥ï¼Œå¥¹çš„å»ºè®®ç«ŸçœŸçš„è®©ä½ æ‰¾åˆ°äº†ç ´å±€ä¹‹æ³•ï¼" },
                { text: "ã€è®¤ä¸ºå¦‡äººä¹‹è§ã€‘", effects: { favor: -10 }, log: "ä½ è®¤ä¸ºå¦‡é“äººå®¶ä¸åº”å¹²æ¶‰æœæ”¿ï¼Œå¥¹çš„å¥½æ„è¢«ä½ å½“æˆäº†é©´è‚è‚ºã€‚" }
            ]
        },
        // ========== æ–°å¢30ä¸ªä¸å¦»å­çš„æ¸©å­˜äº‹ä»¶ ==========
        {
            title: "å¥¹çš„çˆ±å¥½",
            desc: "ä½ å‘ç°å¥¹æœ€è¿‘åœ¨é’»ç ”æ£‹è°±ï¼Œä¼¼ä¹å¯¹æ£‹è‰ºäº§ç”Ÿäº†æµ“åšçš„å…´è¶£ã€‚",
            options: [
                { text: "ã€é™ªå¥¹å¯¹å¼ˆã€‘", effects: { favor: 12, wisdom: 1 }, log: "ä½ ä»¬å¯¹å¼ˆäº†ä¸€å±€ï¼Œä½ è€å¿ƒæŒ‡å¯¼ï¼Œå¥¹å­¦å¾—å¾ˆå¿«ï¼Œä½ ä»¬åœ¨åˆ‡ç£‹ä¸­å¢è¿›äº†æ„Ÿæƒ…ã€‚" },
                { text: "ã€é€å¥¹çç¨€æ£‹è°±ã€‘", cost: 300, effects: { favor: 15 }, log: "ä½ èŠ±è´¹300ä¸¤ä¸ºå¥¹å¯»æ¥ä¸€æœ¬å¤è°±ï¼Œå¥¹å¦‚è·è‡³å®ï¼Œå¯¹ä½ çš„æ”¯æŒå¾ˆæ˜¯æ„Ÿæ¿€ã€‚" }
            ]
        },
        {
            title: "å¨˜å®¶æ¥ä¿¡",
            desc: "å¥¹æ”¶åˆ°å¨˜å®¶çš„æ¥ä¿¡ï¼Œè¯»å®Œåæœ‰äº›é—·é—·ä¸ä¹ã€‚",
            options: [
                { text: "ã€ä¸»åŠ¨è¯¢é—®ã€‘", effects: { favor: 10 }, log: "ä½ ä¸»åŠ¨è¯¢é—®ï¼Œå¥¹å‘ä½ åéœ²äº†å®¶ä¸­çš„çƒ¦å¿ƒäº‹ã€‚ä½ çš„å€¾å¬è®©å¥¹æ„Ÿåˆ°å®‰æ…°ã€‚" },
                { text: "ã€æè®®é™ªå¥¹å›é—¨ã€‘", effects: { favor: 15 }, log: "ä½ æè®®é™ªå¥¹å›å¨˜å®¶çœ‹çœ‹ï¼Œå¥¹çœ¼ä¸­ä¸€äº®ï¼Œè§‰å¾—ä½ éå¸¸ä½“è´´ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ åˆ¶è¡£",
            desc: "å¥¹å·å·ä¸ºä½ é‡äº†å°ºå¯¸ï¼Œè¯´è¦äº²æ‰‹ä¸ºä½ åšä¸€ä»¶åˆèº«çš„å¯è¡£ã€‚",
            options: [
                { text: "ã€æœŸå¾…åœ°ç­‰å¾…ã€‘", effects: { favor: 10 }, log: "æ•°æ—¥åï¼Œä½ ç©¿ä¸Šäº†å¥¹äº²æ‰‹ç¼åˆ¶çš„å¯è¡£ï¼ŒæŸ”è½¯èˆ’é€‚ï¼Œæ»¡å«å¿ƒæ„ã€‚" },
                { text: "ã€æ‰“è¶£å¥¹ã€‘", req: { charm: 60 }, effects: { favor: 12 }, log: "ä½ æ‰“è¶£é“ï¼šâ€œå¤«äººå¦‚æ­¤è´¤æƒ ï¼Œè«ä¸æ˜¯æƒ³å°†æˆ‘ç‰¢ç‰¢æ‹´ä½ï¼Ÿâ€å¥¹çº¢ç€è„¸å•äº†ä½ ä¸€å£ã€‚" }
            ]
        },
        {
            title: "ç®¡ç†è´¦ç›®",
            desc: "å¥¹æ‹¿ç€è´¦æœ¬å‘ä½ è¯·æ•™ä¸€å¤„ä¸è§£çš„åœ°æ–¹ï¼Œç¥æƒ…ä¸“æ³¨ã€‚",
            options: [
                { text: "ã€è€å¿ƒè®²è§£ã€‘", req: { wisdom: 70 }, effects: { favor: 10 }, log: "ä½ ä¸ºå¥¹è¯¦ç»†è®²è§£äº†å…¶ä¸­çš„é—¨é“ï¼Œå¥¹å¯¹ä½ çš„åšå­¦æ›´åŠ é’¦ä½©ã€‚" },
                { text: "ã€è®©å¥¹è‡ªå·±æ‘¸ç´¢ã€‘", effects: { favor: -5 }, log: "ä½ è®©å¥¹è‡ªå·±æ‘¸ç´¢ï¼Œå¥¹è§‰å¾—ä½ ä¸å¤Ÿè€å¿ƒã€‚" }
            ]
        },
        {
            title: "å›­ä¸­æ¼«æ­¥",
            desc: "åˆåé˜³å…‰æ­£å¥½ï¼Œä½ ä»¬åœ¨è‡ªå®¶èŠ±å›­ä¸­ä¸€åŒæ¼«æ­¥ï¼Œé—²è¯å®¶å¸¸ã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹æ‘˜èŠ±ã€‘", effects: { favor: 12 }, log: "ä½ ä¸ºå¥¹æ‘˜ä¸‹ä¸€æœµå¼€å¾—æ­£è‰³çš„èŠ±ï¼Œäº²æ‰‹ä¸ºå¥¹ç°ªåœ¨å‘é—´ï¼Œå¥¹ç¬‘é¥å¦‚èŠ±ã€‚" },
                { text: "ã€è°ˆè®ºèŠ±è‰ã€‘", req: { talent: 50 }, effects: { favor: 8 }, log: "ä½ ä»¬è°ˆè®ºç€å„ç§èŠ±è‰çš„å…¸æ•…ï¼Œæ°”æ°›ååˆ†é›…è‡´ã€‚" }
            ]
        },
        {
            title: "å°å°çš„æƒŠå–œ",
            desc: "ä½ åœ¨ä¹¦æˆ¿çš„ç šå°ä¸‹ï¼Œå‘ç°äº†ä¸€å¼ å¥¹ç•™ä¸‹çš„å­—æ¡ï¼Œä¸Šé¢ç”»ç€ä¸€ä¸ªå¯çˆ±çš„ç¬‘è„¸ã€‚",
            options: [
                { text: "ã€å›èµ æƒŠå–œã€‘", effects: { favor: 15 }, log: "ä½ ä¹Ÿåœ¨å¥¹çš„æ¢³å¦†ç›’é‡Œè—äº†ä¸€é¢—ç³–ï¼Œå¥¹å‘ç°åï¼Œä¸€æ•´å¤©å¿ƒæƒ…éƒ½å¾ˆå¥½ã€‚" },
                { text: "ã€ä¼šå¿ƒä¸€ç¬‘ã€‘", effects: { favor: 8 }, log: "è¿™ä»½å°å°çš„æƒŠå–œè®©ä½ ä¸€å¤©çš„å·¥ä½œç–²æƒ«éƒ½çƒŸæ¶ˆäº‘æ•£ã€‚" }
            ]
        },
        {
            title: "æ•™å¯¼å­å—£",
            desc: "ä½ ä»¬çš„å­©å­æ­£åœ¨èƒŒä¹¦ï¼Œé‡åˆ°äº†å›°éš¾ï¼Œå¥¹æ­£è€å¿ƒåœ°ä¸€ééæ•™å¯¼ã€‚",
            options: [
                { text: "ã€ä¸Šå‰ä¸€åŒæ•™å¯¼ã€‘", effects: { favor: 10 }, log: "ä½ ä»¬ä¸€åŒæ•™å¯¼å­©å­ï¼Œå…¶ä¹èèçš„å®¶åº­æ°›å›´è®©å­©å­å€æ„Ÿæ¸©æš–ã€‚" },
                { text: "ã€ç§°èµå¥¹çš„è€å¿ƒã€‘", effects: { favor: 12 }, log: "ä½ ç§°èµå¥¹æ˜¯ä¸€ä½æ…ˆæ¯ï¼Œå¥¹å¬åå¾ˆæ˜¯å—ç”¨ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æŒ¡é…’",
            desc: "åœ¨å®¶å®´ä¸Šï¼Œä¸€ä½äº²æˆšä¸æ–­å‘ä½ æ•¬é…’ï¼Œå¥¹ subtly åœ°ä¸ºä½ æŒ¡ä¸‹äº†å‡ æ¯ã€‚",
            options: [
                { text: "ã€æ„Ÿæ¿€åœ°çœ‹å¥¹ä¸€çœ¼ã€‘", effects: { favor: 12 }, log: "ä½ ä»¬ç›¸è§†ä¸€ç¬‘ï¼Œè¿™ä»½é»˜å¥‘å°½åœ¨ä¸è¨€ä¸­ã€‚" },
                { text: "ã€äº‹åå…³å¿ƒå¥¹ã€‘", effects: { favor: 10 }, log: "å®´åï¼Œä½ å…³å¿ƒå¥¹æ˜¯å¦ä¸é€‚ï¼Œå¥¹æ‘‡æ‘‡å¤´ï¼Œè¯´ä¸ºä½ åšä»€ä¹ˆéƒ½å€¼å¾—ã€‚" }
            ]
        },
        {
            title: "å¥¹çš„ä¸å®‰",
            desc: "â€œå¤«å›...ä¼šå«Œå¼ƒå¦¾èº«å¹´è€è‰²è¡°å—ï¼Ÿâ€å¥¹å¿½ç„¶æœ‰äº›ä¸å®‰åœ°é—®é“ã€‚",
            options: [
                { text: "ã€ç”¨è¡ŒåŠ¨è¯æ˜ã€‘", req: { charm: 80 }, effects: { favor: 18 }, log: "ä½ æ²¡æœ‰å›ç­”ï¼Œåªæ˜¯å°†å¥¹æ‹¥å…¥æ€€ä¸­ï¼Œç”¨ä¸€ä¸ªæ·±å»å›åº”äº†å¥¹æ‰€æœ‰çš„ä¸å®‰ã€‚" },
                { text: "ã€æ¸©æŸ”åœ°æ‰¿è¯ºã€‘", effects: { favor: 12 }, log: "â€œå‚»ç“œï¼Œåœ¨æˆ‘å¿ƒé‡Œï¼Œä½ æ°¸è¿œæ˜¯æœ€å¥½çš„ã€‚â€ä½ çš„æ‰¿è¯ºè®©å¥¹å®‰å¿ƒã€‚" }
            ]
        },
        {
            title: "ç”Ÿç—…æ—¶çš„ç…§æ–™",
            desc: "ä½ å¶æ„Ÿé£å¯’ï¼Œå§åºŠä¼‘æ¯ã€‚å¥¹ç«¯æ¥æ±¤è¯ï¼Œäº²è‡ªå–‚ä½ å–ä¸‹ï¼Œçœ¼ä¸­æ»¡æ˜¯å…³åˆ‡ã€‚",
            options: [
                { text: "ã€æ¡ä½å¥¹çš„æ‰‹ã€‘", effects: { favor: 15, health: 5 }, log: "ä½ æ¡ä½å¥¹çš„æ‰‹ï¼Œå‘Šè¯‰å¥¹ä¸å¿…æ‹…å¿ƒã€‚å¥¹çš„ç…§æ–™è®©ä½ æ¢å¤å¾—å¾ˆå¿«ã€‚" },
                { text: "ã€è®©å¥¹ä¹Ÿæ³¨æ„èº«ä½“ã€‘", effects: { favor: 12 }, log: "ä½ å®å˜±å¥¹ä¸è¦å› ç…§é¡¾ä½ è€Œç´¯åäº†ï¼Œè¿™ä»½ä½“è´´è®©å¥¹å¾ˆæ˜¯æ„ŸåŠ¨ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ è¾©æŠ¤",
            desc: "ä½ çš„ä¸€é¡¹å†³å®šå—åˆ°äº†é•¿è¾ˆçš„è´¨ç–‘ï¼Œå¥¹å´åœ¨ä½ ä¹‹å‰ï¼Œæœ‰ç†æœ‰æ®åœ°ä¸ºä½ çš„å†³å®šåšå‡ºäº†è§£é‡Šå’Œè¾©æŠ¤ã€‚",
            options: [
                { text: "ã€ç§ä¸‹æ„Ÿè°¢å¥¹ã€‘", effects: { favor: 18 }, log: "ä½ ç§ä¸‹æ„Ÿè°¢å¥¹çš„ç»´æŠ¤ï¼Œå¥¹ç¬‘ç€è¯´â€œæˆ‘ä»¬æ˜¯å¤«å¦»ï¼Œæœ¬å°±ä¸€ä½“â€ã€‚" },
                { text: "ã€å½“ä¼—æ”¯æŒå¥¹ã€‘", effects: { favor: 15 }, log: "ä½ å½“ä¼—è¡¨ç¤ºå®Œå…¨åŒæ„å¦»å­çš„çœ‹æ³•ï¼Œä½ ä»¬å¤«å¦»åŒå¿ƒçš„æ¨¡æ ·è®©é•¿è¾ˆä¹Ÿæ— è¯å¯è¯´ã€‚" }
            ]
        },
        {
            title: "æ•´ç†ä¹¦æˆ¿",
            desc: "å¥¹å°†ä½ æ‚ä¹±çš„ä¹¦æˆ¿æ•´ç†å¾—äº•äº•æœ‰æ¡ï¼Œè¿˜ç‚¹ä¸Šäº†ä¸€ç‚‰å®‰ç¥çš„ç†é¦™ã€‚",
            options: [
                { text: "ã€ä»èƒŒåæ‹¥æŠ±å¥¹ã€‘", effects: { favor: 12 }, log: "ä½ ä»èƒŒåæ‹¥ä½æ­£åœ¨å¿™ç¢Œçš„å¥¹ï¼Œæ„Ÿè°¢å¥¹çš„è¾›åŠ³ã€‚" },
                { text: "ã€ç§°èµå¥¹çš„èƒ½å¹²ã€‘", effects: { favor: 8 }, log: "ä½ ç§°èµå¥¹æŒå®¶æœ‰é“ï¼Œå¥¹å¾®ç¬‘ç€æ¥å—äº†ä½ çš„å¤¸å¥–ã€‚" }
            ]
        },
        {
            title: "å¥¹çš„â€œå°é‡‘åº“â€",
            desc: "å¥¹æœ‰äº›ä¸å¥½æ„æ€åœ°å‘Šè¯‰ä½ ï¼Œå¥¹ç”¨è‡ªå·±çš„å«å¦†å’Œæœˆä¾‹åšäº†ä¸€äº›å°æŠ•èµ„ï¼Œæ”’ä¸‹äº†ä¸€ç¬”å¯è§‚çš„â€œå°é‡‘åº“â€ã€‚",
            options: [
                { text: "ã€ç§°èµå¥¹æœ‰å¤´è„‘ã€‘", effects: { favor: 10 }, log: "ä½ ç§°èµå¥¹æœ‰ç†è´¢å¤´è„‘ï¼Œå¥¹å¬åå¾ˆæ˜¯å¾—æ„ã€‚" },
                { text: "ã€è®©å¥¹ä¸Šäº¤ã€‘", effects: { favor: -15 }, log: "ä½ è®©å¥¹å°†é’±ä¸Šäº¤å®¶åº“ï¼Œå¥¹è™½ç„¶ç…§åšäº†ï¼Œä½†å¿ƒä¸­ååˆ†ä¸å¿«ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ çº³å¦¾çš„â€œå»ºè®®â€",
            desc: "å¥¹â€œå¤§åº¦â€åœ°å‘ä½ æè®®ï¼Œè¯´ä½ åº”è¯¥å†çº³ä¸€æˆ¿å¦¾å®¤ï¼Œä»¥å¼€ææ•£å¶ã€‚",
            options: [
                { text: "ã€æ–­ç„¶æ‹’ç»ã€‘", req: { virtue: 70 }, effects: { favor: 20 }, log: "â€œæœ‰å¤«äººä¸€äººè¶³çŸ£ã€‚â€ä½ æ–­ç„¶æ‹’ç»ï¼Œè¿™ä»½ä¸“æƒ…è®©å¥¹æ„ŸåŠ¨å¾—çƒ­æ³ªç›ˆçœ¶ã€‚" },
                { text: "ã€é¡ºæ°´æ¨èˆŸã€‘", effects: { favor: -20 }, log: "ä½ ç«ŸçœŸçš„å¼€å§‹è€ƒè™‘æ­¤äº‹ï¼Œå¥¹çœ¼ä¸­é—ªè¿‡ä¸€ä¸å—ä¼¤å’Œå¤±æœ›ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æŒ‰æ‘©",
            desc: "è§ä½ ä¸€è„¸ç–²æƒ«ï¼Œå¥¹ä¸»åŠ¨æå‡ºä¸ºä½ æŒ‰æ‘©æ”¾æ¾ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶æ¥å—ã€‘", effects: { favor: 12, health: 3 }, log: "å¥¹æ¸©çƒ­çš„åŒæ‰‹åœ¨ä½ è‚©ä¸ŠæŒ‰æï¼Œè®©ä½ èº«ä½“çš„ç–²æƒ«å’Œå¿ƒä¸­çš„çƒ¦é—·éƒ½ä¸€æ‰«è€Œç©ºã€‚" },
                { text: "ã€æ‹’ç»ã€‘", effects: { favor: -5 }, log: "ä½ æ‹’ç»äº†å¥¹çš„å¥½æ„ï¼Œå¥¹æœ‰äº›å¤±è½ã€‚" }
            ]
        },
        {
            title: "ä¸‹å¨çš„æƒŠå–œ",
            desc: "ä»Šæ—¥çš„æ™šé¤ï¼Œå¥¹äº²æ‰‹ä¸ºä½ åšäº†å‡ é“ä½ å®¶ä¹¡çš„èœè‚´ã€‚",
            options: [
                { text: "ã€å¤§åŠ èµèµã€‘", effects: { favor: 15 }, log: "ä½ å°å‡ºäº†å®¶ä¹¡çš„å‘³é“ï¼Œå¯¹å¥¹çš„ç”¨å¿ƒååˆ†æ„ŸåŠ¨ï¼Œå°†é¥­èœä¸€æ‰«è€Œç©ºã€‚" },
                { text: "ã€æå‡ºæ”¹è¿›æ„è§ã€‘", effects: { favor: -3 }, log: "ä½ å–„æ„åœ°æŒ‡å‡ºäº†å‡ å¤„ä¸åƒçš„åœ°æ–¹ï¼Œå¥¹çš„çƒ­æƒ…ä¼¼ä¹è¢«æµ‡äº†ä¸€ç›†å†·æ°´ã€‚" }
            ]
        },
        {
            title: "æ¨¡ä»¿ä½ çš„ç¬”è¿¹",
            desc: "ä½ å‘ç°å¥¹ç«Ÿåœ¨å·å·æ¨¡ä»¿ä½ çš„ç¬”è¿¹ï¼Œå†™ç€ä½ çš„åå­—ã€‚",
            options: [
                { text: "ã€ä»èƒŒåæŠ±ä½å¥¹ã€‘", effects: { favor: 15 }, log: "ä½ ä»èƒŒåæŠ±ä½å¥¹ï¼Œåœ¨å¥¹è€³è¾¹è½»å£°é—®â€œå¤«äººæ˜¯åœ¨æ€å¿µä¸ºå¤«å—ï¼Ÿâ€å¥¹ç¾å¾—æŠ¬ä¸èµ·å¤´ã€‚" },
                { text: "ã€å‡è£…æ²¡çœ‹è§ã€‘", effects: { favor: 8 }, log: "ä½ å‡è£…æ²¡çœ‹è§ï¼Œå¿ƒä¸­å´æ„Ÿåˆ°ä¸€ä¸ç”œèœœã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ å‡†å¤‡è¡Œå›Š",
            desc: "ä½ å³å°†å‡ºè¿œé—¨ï¼Œå¥¹ä¸ºä½ ç»†å¿ƒåœ°æ‰“ç‚¹è¡Œå›Šï¼Œä»é‡Œè¡£åˆ°å¤–è¢ï¼Œæ— ä¸€ä¸å¤‡ã€‚",
            options: [
                { text: "ã€æ¡ä½å¥¹çš„æ‰‹ã€‘", effects: { favor: 12 }, log: "ä½ æ¡ä½å¥¹ä¸ºä½ å¿™ç¢Œçš„åŒæ‰‹ï¼Œå®å˜±å¥¹åœ¨å®¶ä¹Ÿè¦ç…§é¡¾å¥½è‡ªå·±ã€‚" },
                { text: "ã€è®¸è¯ºå¸¦ç¤¼ç‰©ã€‘", effects: { favor: 10 }, log: "ä½ æ‰¿è¯ºä¼šä¸ºå¥¹å¸¦å›æœ€å¥½çœ‹çš„ç¤¼ç‰©ï¼Œå¥¹ç¬‘ç€ç‚¹å¤´ã€‚" }
            ]
        },
        {
            title: "ç­‰å¾…é—¨ç¦",
            desc: "ä½ åº”é…¬æ™šå½’ï¼Œå‘ç°å¥¹ç«Ÿä¸€ç›´æœªç¡ï¼Œåœ¨é—¨å»Šä¸‹æç€ç¯ç¬¼ç­‰ä½ ã€‚",
            options: [
                { text: "ã€å¿ƒä¸­æ„§ç–šã€‘", effects: { favor: 18 }, log: "ä½ å¿ƒä¸­æ„§ç–šåˆæ„ŸåŠ¨ï¼Œä¸Šå‰å°†å¥¹æ‹¥å…¥æ€€ä¸­ï¼Œæ‰¿è¯ºä»¥åä¼šæ—©äº›å›æ¥ã€‚" },
                { text: "ã€è®©å¥¹å…ˆå»ç¡ã€‘", effects: { favor: 8 }, log: "ä½ è®©å¥¹å…ˆå»ç¡ï¼Œä¸å¿…ç­‰ä½ ï¼Œå¥¹ç‚¹å¤´åº”æ˜¯ï¼Œä½†ä½ ä»å¥¹çœ¼ä¸­çœ‹åˆ°äº†ä¸€ä¸å¤±è½ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ è¯»ä¹¦",
            desc: "ä½ æ„Ÿåˆ°çœ¼ç›ç–²æƒ«ï¼Œå¥¹ä¾¿ä¸»åŠ¨æ‹¿èµ·ä¹¦å·ï¼Œä¸ºä½ è½»å£°è¯µè¯»ã€‚",
            options: [
                { text: "ã€æ•åœ¨å¥¹è…¿ä¸Šã€‘", effects: { favor: 15 }, log: "ä½ è‡ªç„¶åœ°æ•åœ¨å¥¹è…¿ä¸Šï¼Œå¬ç€å¥¹æ¸©æŸ”çš„å£°éŸ³ï¼Œæ¸æ¸å®‰ç„¶å…¥ç¡ã€‚" },
                { text: "ã€ä¸€åŒæ¢è®¨ã€‘", effects: { favor: 10 }, log: "ä½ ä»¬ä¸€åŒæ¢è®¨ä¹¦ä¸­çš„å†…å®¹ï¼Œååˆ†æƒ¬æ„ã€‚" }
            ]
        },
        {
            title: "å¥¹çš„æ¢¦è¯",
            desc: "åŠå¤œï¼Œä½ è¢«æƒŠé†’ï¼Œç«Ÿå¬åˆ°èº«æ—çš„å¥¹è¯´ç€æ¢¦è¯ï¼Œå¥å¥éƒ½æ˜¯ä½ çš„åå­—ã€‚",
            options: [
                { text: "ã€å°†å¥¹æ‹¥å¾—æ›´ç´§ã€‘", effects: { favor: 10 }, log: "ä½ å°†å¥¹æ‹¥å¾—æ›´ç´§ï¼Œå¿ƒä¸­ä¸€ç‰‡æŸ”è½¯ã€‚" },
                { text: "ã€ç¬¬äºŒå¤©å‘Šè¯‰å¥¹ã€‘", effects: { favor: 8 }, log: "ç¬¬äºŒå¤©ä½ å°†æ­¤äº‹å‘Šè¯‰å¥¹ï¼Œå¥¹ç¾å¾—æ— åœ°è‡ªå®¹ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ åˆ†æ‹…å‹åŠ›",
            desc: "ä½ å› ä¸€ç¬”ç”Ÿæ„äºæŸè€Œæ„çœ‰ä¸å±•ï¼Œå¥¹ç«Ÿæ‹¿å‡ºè‡ªå·±çš„å«å¦†è¡¥è´´ä½ ï¼Œè¯´â€œå¤«å¦»æœ¬æ˜¯ä¸€ä½“ï¼Œæˆ‘çš„ä¾¿æ˜¯ä½ çš„â€ã€‚",
            options: [
                { text: "ã€æ„ŸåŠ¨åœ°æ”¶ä¸‹ã€‘", effects: { favor: 25 }, log: "è¿™ä»½æ·±æƒ…ä¸æ”¯æŒè®©ä½ æ— æ¯”åŠ¨å®¹ï¼Œä½ å‘èª“è¦åŠ å€å¯¹å¥¹å¥½ã€‚" },
                { text: "ã€æ‹’ç»ã€‘", effects: { favor: 12 }, log: "ä½ æ‹’ç»äº†å¥¹çš„é’±ï¼Œä½†å¥¹çš„å¿ƒæ„ä½ å·²å…¨éƒ¨æ”¶åˆ°ã€‚" }
            ]
        },
        {
            title: "å­©å­ä»¬çš„â€œå‘ŠçŠ¶â€",
            desc: "ä½ ä»¬çš„å­©å­è·‘æ¥å‘ä½ â€œå‘ŠçŠ¶â€ï¼Œè¯´æ¯äº²ä»Šå¤©å¯¹ä»–ä»¬å¤ªè¿‡ä¸¥å‰ã€‚",
            options: [
                { text: "ã€ç»´æŠ¤å¦»å­ã€‘", effects: { favor: 15 }, log: "ä½ ç»´æŠ¤äº†å¦»å­çš„å¨ä¸¥ï¼Œå¹¶å‘Šè¯‰å­©å­æ…ˆæ¯ä¸¥çˆ¶çš„é“ç†ã€‚å¦»å­å¯¹ä½ çš„æ”¯æŒå¾ˆæ˜¯æ„Ÿæ¿€ã€‚" },
                { text: "ã€â€œæ‰¹è¯„â€å¦»å­ã€‘", effects: { favor: -10 }, log: "ä½ å½“ç€å­©å­çš„é¢â€œæ‰¹è¯„â€äº†å¦»å­ï¼Œè®©å¥¹åœ¨å­©å­é¢å‰å¤±äº†å¨ä¿¡ï¼Œå¥¹å¯¹æ­¤å¾ˆæ˜¯ä¸æ»¡ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ±‚çš„å¹³å®‰ç¬¦",
            desc: "å¥¹å°†ä¸€ä¸ªäº²æ‰‹ç»£åˆ¶çš„å¹³å®‰ç¬¦äº¤ç»™ä½ ï¼Œè¯´æ˜¯ç‰¹åœ°å»åº™é‡Œä¸ºä½ æ±‚æ¥çš„ã€‚",
            options: [
                { text: "ã€è´´èº«æ”¶è—ã€‘", effects: { favor: 15 }, log: "ä½ å°†å¹³å®‰ç¬¦è´´èº«æ”¶è—ï¼Œè¿™ä»½å¿ƒæ„è®©ä½ æ„Ÿåˆ°æ— æ¯”æ¸©æš–ã€‚" },
                { text: "ã€æ„Ÿè°¢å¥¹ã€‘", effects: { favor: 8 }, log: "ä½ æ„Ÿè°¢å¥¹çš„å¿ƒæ„ï¼Œå¥¹ç¬‘ç€è¯´åªè¦ä½ å¹³å®‰å°±å¥½ã€‚" }
            ]
        },
        {
            title: "å¯¹é•œæ¢³å¦†",
            desc: "å¥¹ååœ¨é•œå‰æ¢³å¦†ï¼Œä½ èµ°ä¸Šå‰ï¼Œæ‹¿èµ·æ¢³å­ï¼Œä¸ºå¥¹æ¢³ç†ä¸€å¤´ä¹Œé»‘çš„é•¿å‘ã€‚",
            options: [
                { text: "ã€ä¸ºå¥¹æ¢³å¤´ã€‘", effects: { favor: 15 }, log: "ä½ ç¬¨æ‹™å´æ¸©æŸ”åœ°ä¸ºå¥¹æ¢³ç†é•¿å‘ï¼Œå¥¹ä»é•œä¸­çœ‹ç€ä½ ï¼Œçœ¼ä¸­æ»¡æ˜¯çˆ±æ„ã€‚" },
                { text: "ã€ç§°èµå¥¹çš„ç¾è²Œã€‘", effects: { favor: 10 }, log: "ä½ ç§°èµå¥¹çš„ç¾è²Œï¼Œå¥¹å¬åç¬‘é¥å¦‚èŠ±ã€‚" }
            ]
        },
        {
            title: "æ£€æŸ¥ä½ çš„è¡Œå›Š",
            desc: "ä½ å‡ºå·®å½’æ¥ï¼Œå¥¹ä¸ºä½ æ•´ç†è¡Œå›Šæ—¶ï¼Œâ€œæ— æ„â€ä¸­é—®èµ·ä¸€ä»¶å¹¶éå¥¹ä¸ºä½ å‡†å¤‡çš„ç‰©å“ã€‚",
            options: [
                { text: "ã€å¦ç„¶è§£é‡Šã€‘", req: { wisdom: 70 }, effects: { favor: 8 }, log: "ä½ å¦ç„¶è§£é‡Šäº†ç‰©å“çš„æ¥å†ï¼Œå¥¹å¹¶æœªå¤šç–‘ã€‚" },
                { text: "ã€æªå¡è¿‡å»ã€‘", effects: { favor: -5 }, log: "ä½ çš„æªå¡è®©å¥¹èµ·äº†ç–‘å¿ƒã€‚" }
            ]
        },
        {
            title: "ä¸€èµ·çœ‹è´¦æœ¬",
            desc: "æœˆåº•ï¼Œä½ ä»¬ä¸€åŒæ ¸å¯¹å®¶ä¸­çš„è´¦ç›®ã€‚",
            options: [
                { text: "ã€ç§°èµå¥¹æŒå®¶æœ‰é“ã€‘", effects: { favor: 10 }, log: "è´¦ç›®æ¸…æ™°ï¼Œå¼€æ”¯åˆç†ï¼Œä½ ç§°èµå¥¹æŒå®¶æœ‰é“ã€‚" },
                { text: "ã€æŒ‡å‡ºå‡ å¤„ä¸å¦¥ã€‘", effects: { favor: -5 }, log: "ä½ æŒ‡å‡ºäº†å‡ å¤„ä¸åˆç†çš„å¼€é”€ï¼Œå¥¹æœ‰äº›ä¸å¿«ã€‚" }
            ]
        },
        {
            title: "æŸ“ä¸Šé£å¯’",
            desc: "å¥¹ä¸æ…æŸ“ä¸Šé£å¯’ï¼Œå§åºŠä¸èµ·ï¼Œçœ‹èµ·æ¥ååˆ†è™šå¼±ã€‚",
            options: [
                { text: "ã€äº²è‡ªç…§æ–™ã€‘", effects: { favor: 20 }, log: "ä½ æ”¾ä¸‹å…¬åŠ¡ï¼Œäº²è‡ªä¸ºå¥¹ç«¯èŒ¶é€è¯ï¼Œæ‚‰å¿ƒç…§æ–™ï¼Œå¥¹æ„ŸåŠ¨ä¸å·²ã€‚" },
                { text: "ã€è¯·ååŒ»ã€‘", cost: 300, effects: { favor: 10 }, log: "ä½ èŠ±è´¹300ä¸¤ä¸ºå¥¹è¯·æ¥ååŒ»ï¼Œå¥¹çš„ç—…å¾ˆå¿«å°±å¥½äº†ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ ä¿å®ˆç§˜å¯†",
            desc: "å¥¹æ— æ„ä¸­å‘ç°äº†ä½ çš„ä¸€ä¸ªç§˜å¯†ï¼Œä½†å¥¹æ²¡æœ‰å£°å¼ ï¼Œåªæ˜¯é»˜é»˜åœ°ä¸ºä½ æ©ç›–äº†è¿‡å»ã€‚",
            options: [
                { text: "ã€å¿ƒæ€€æ„Ÿæ¿€ã€‘", effects: { favor: 20 }, log: "ä½ å¯¹å¥¹çš„ä½“è´´å’Œæ™ºæ…§å¿ƒæ€€æ„Ÿæ¿€ï¼Œä½ ä»¬çš„ä¿¡ä»»æ›´æ·±äº†ä¸€å±‚ã€‚" },
                { text: "ã€å¿ƒç”Ÿè­¦æƒ•ã€‘", effects: { favor: -5 }, log: "ä½ å¼€å§‹è­¦æƒ•å¥¹ï¼Œæ‹…å¿ƒå¥¹ä¼šä»¥æ­¤ä¸ºæŠŠæŸ„ã€‚" }
            ]
        },
        {
            title: "ä¸€ä¸ªæ‹¥æŠ±",
            desc: "ä½ å¤„ç†å®Œå…¬åŠ¡ï¼Œç–²æƒ«åœ°å›åˆ°æˆ¿ä¸­ï¼Œå¥¹æ²¡æœ‰å¤šè¨€ï¼Œåªæ˜¯èµ°ä¸Šå‰æ¥ï¼Œç»™äº†ä½ ä¸€ä¸ªæ¸©æš–çš„æ‹¥æŠ±ã€‚",
            options: [
                { text: "ã€ç´§ç´§å›æŠ±ã€‘", effects: { favor: 15 }, log: "è¿™ä¸ªæ‹¥æŠ±é©±æ•£äº†ä½ æ‰€æœ‰çš„ç–²æƒ«ï¼Œè®©ä½ æ„Ÿåˆ°äº†å®¶çš„æ¸©æš–ã€‚" },
                { text: "ã€æ‹æ‹å¥¹çš„èƒŒã€‘", effects: { favor: 8 }, log: "ä½ æ‹äº†æ‹å¥¹çš„èƒŒï¼Œæ„Ÿè°¢å¥¹çš„ç†è§£ã€‚" }
            ]
        }
    ],
    // ç©å®¶ä¸ºå¥³æ€§æ—¶ï¼Œä¸å¤«å›çš„äº’åŠ¨äº‹ä»¶
    husband: [
        // æ‚¨å·²æœ‰çš„10ä¸ªäº‹ä»¶ (å·²å®Œæ•´ä¿ç•™)
        {
            title: "ä¸ºä½ æçœ‰",
            desc: "æ¸…æ™¨æ¢³å¦†æ—¶ï¼Œä½ çš„å¤«å›ç«Ÿæ‹¿èµ·äº†çœ‰ç¬”ï¼Œç¬‘ç€è¯´è¦ä¸ºä½ â€œç”»çœ‰æ·±æµ…å…¥æ—¶æ— â€ã€‚",
            options: [
                { text: "ã€ä»»ä»–æ–½ä¸ºã€‘", effects: { favor: 15 }, log: "ä»–ç¬¨æ‹™çš„ç¬”è§¦ç”»å¾—æ­ªæ­ªæ‰­æ‰­ï¼Œä½ ä»¬ç›¸è§†å¤§ç¬‘ï¼Œé—ºæˆ¿ä¹‹ä¸­å……æ»¡äº†ç”œèœœçš„ç©ºæ°”ã€‚" },
                { text: "ã€å¤ºè¿‡çœ‰ç¬”ã€‘", effects: { favor: 8 }, log: "ä½ ç¬‘ç€å¤ºè¿‡çœ‰ç¬”ï¼Œè¯´ä»–åªä¼šæ£ä¹±ï¼Œä»–å´é¡ºåŠ¿æ¡ä½äº†ä½ çš„æ‰‹ã€‚" }
            ]
        },
        {
            title: "å®˜åœºå¤±æ„",
            desc: "ä½ çš„å¤«å›ä»Šæ—¥ä»è¡™é—¨å›æ¥åï¼Œä¾¿ä¸€ç›´é—·é—·ä¸ä¹ï¼Œä¼¼ä¹æ˜¯å—äº†å§”å±ˆã€‚",
            options: [
                { text: "ã€æ¸©è¨€åŠæ…°ã€‘", req: { charm: 70 }, effects: { favor: 12 }, log: "ä½ çš„æ¸©æŸ”åŠæ…°è®©ä»–æ‰“å¼€äº†å¿ƒæ‰‰ï¼Œå‘ä½ å€¾è¯‰äº†çƒ¦æ¼ï¼Œå¿ƒä¸­èˆ’ç•…äº†ä¸å°‘ã€‚" },
                { text: "ã€ä¸ºä»–å‡†å¤‡é…’èœã€‘", effects: { favor: 10 }, log: "ä½ æ²¡æœ‰å¤šé—®ï¼Œåªæ˜¯é»˜é»˜ä¸ºä»–å‡†å¤‡äº†ä¸€æ¡Œä»–çˆ±åƒçš„é…’èœï¼Œè¿™ä»½æ— å£°çš„ä½“è´´è®©ä»–å¾ˆæ˜¯æ„ŸåŠ¨ã€‚" }
            ]
        },
        {
            title: "æ„å¤–çš„ç¤¼ç‰©",
            desc: "å¹¶éå¹´èŠ‚ï¼Œä»–å´ä¸ºä½ å¸¦å›äº†ä¸€æ”¯æ–°ä¸Šå¸‚çš„å£è„‚ï¼Œè¯´æ˜¯çœ‹é¢œè‰²å¾ˆè¡¬ä½ ã€‚",
            options: [
                { text: "ã€å½“å³æ¶‚ä¸Šã€‘", effects: { favor: 15 }, log: "ä½ å½“å³æ¶‚ä¸Šï¼Œå¹¶é—®ä»–å¥½ä¸å¥½çœ‹ã€‚ä»–çœ‹ç€ä½ å¨‡è‰³çš„çº¢å”‡ï¼Œå–‰ç»“æ»šåŠ¨ï¼Œä¸€æŠŠå°†ä½ æ¨ªæŠ±èµ·æ¥ã€‚" },
                { text: "ã€é“è°¢å¹¶æ”¶ä¸‹ã€‘", effects: { favor: 8 }, log: "ä½ å‘ä»–é“è°¢ï¼Œä»–è§ä½ å–œæ¬¢ï¼Œå¾ˆæ˜¯æ»¡è¶³ã€‚" }
            ]
        },
        {
            title: "åƒé†‹",
            desc: "åœ¨å®¶å®´ä¸Šï¼Œä½ ä¸å¤«å›çš„ä¸€ä½åŒåƒšå¤šèŠäº†å‡ å¥ï¼Œä»–ä¾¿æœ‰äº›ä¸å¿«ï¼Œä¸€æ•´ä¸ªæ™šä¸Šéƒ½æ²¡æ€ä¹ˆè¯´è¯ã€‚",
            options: [
                { text: "ã€ç§ä¸‹å“„ä»–ã€‘", effects: { favor: 12 }, log: "å›åˆ°æˆ¿ä¸­ï¼Œä½ ç”¨å‡ å¥è½¯è¯­å’Œæ’’å¨‡ä¾¿å“„å¥½äº†è¿™ä¸ªâ€œé†‹å›å­â€ï¼Œä»–æœ‰äº›ä¸å¥½æ„æ€ï¼Œä½ ä»¬çš„æ„Ÿæƒ…åè€Œæ›´å¥½äº†ã€‚" },
                { text: "ã€ä¸ä»–ç†è®ºã€‘", effects: { favor: -8 }, log: "ä½ è®¤ä¸ºä»–æ— ç†å–é—¹ï¼Œä¸ä»–ç†è®ºèµ·æ¥ï¼Œä¸¤äººä¸æ¬¢è€Œæ•£ã€‚" }
            ]
        },
        {
            title: "æ•™ä½ æ­¦è‰º",
            desc: "è§ä½ å¯¹åé™¢çš„å…µå™¨æ¶æ„Ÿå…´è¶£ï¼Œä»–ç¬‘ç€è¯´è¦æ•™ä½ å‡ æ‹›é˜²èº«çš„åŠŸå¤«ã€‚",
            options: [
                { text: "ã€è®¤çœŸå­¦ä¹ ã€‘", req: { health: 60 }, effects: { favor: 15, martial: 2 }, log: "ä»–åœ¨ä½ èº«åï¼Œæ‰‹æŠŠæ‰‹åœ°æ•™ä½ ã€‚åä¸ºæ•™ä¹ ï¼Œå®ä¸ºè°ƒæƒ…ï¼Œä½ ä»¬åœ¨æ‰“é—¹ä¸­æ„Ÿæƒ…è¿…é€Ÿå‡æ¸©ã€‚" },
                { text: "ã€å€Ÿå£æ¨è¾ã€‘", effects: { favor: -3 }, log: "ä½ å¯¹èˆåˆ€å¼„æªä¸æ„Ÿå…´è¶£ï¼Œä»–æœ‰äº›å¤±æœ›ã€‚" }
            ]
        },
        {
            title: "æ·±å¤œå½’æ¥",
            desc: "ä½ æ·±å¤œé†’æ¥ï¼Œå‘ç°ä»–é£å°˜ä»†ä»†åœ°ä»å¤–åœ°èµ¶å›ï¼Œåªä¸ºèƒ½ä¸é”™è¿‡ä½ ä»¬çš„æˆå©šçºªå¿µæ—¥ã€‚",
            options: [
                { text: "ã€å¿ƒç–¼åœ°ä¸ºä»–å‡†å¤‡çƒ­æ°´ã€‘", effects: { favor: 20 }, log: "ä½ å¿ƒç–¼ä»–ä¸€è·¯åŠ³é¡¿ï¼Œä¸ºä»–å‡†å¤‡äº†çƒ­æ°´å’Œå®µå¤œï¼Œä»–å°†ä½ ç´§ç´§æ‹¥å…¥æ€€ä¸­ï¼Œè§‰å¾—ä¸€åˆ‡éƒ½å€¼å¾—ã€‚" },
                { text: "ã€æŠ±æ€¨ä»–ä¸çˆ±æƒœèº«ä½“ã€‘", effects: { favor: 12 }, log: "ä½ å˜´ä¸ŠæŠ±æ€¨ä»–ä¸çˆ±æƒœèº«ä½“ï¼Œçœ¼ä¸­å´æ»¡æ˜¯å¿ƒç–¼ï¼Œä»–ç¬‘ç€æ¥å—äº†ä½ çš„â€œæ•™è®­â€ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ’‘è…°",
            desc: "ä¸€ä½é•¿èˆŒçš„è´µå¦‡åœ¨å®´ä¼šä¸Šå¯¹ä½ å‡ºè¨€ä¸é€Šï¼Œä»–å¬é—»åï¼Œç«‹åˆ»ä¸Šå‰ä¸ºä½ è§£å›´ï¼Œè¨€è¯­é—´å°½æ˜¯ç»´æŠ¤ä¹‹æ„ã€‚",
            options: [
                { text: "ã€å¿ƒä¸­ä¸€æš–ã€‘", effects: { favor: 18 }, log: "ä»–ä¸ºä½ æ’‘è…°çš„æ ·å­ï¼Œè®©ä½ æ„Ÿåˆ°äº†å‰æ‰€æœªæœ‰çš„å®‰å¿ƒå’Œéª„å‚²ã€‚" },
                { text: "ã€ç¤ºæ„ä»–ä¸å¿…å¦‚æ­¤ã€‘", effects: { favor: 8 }, log: "ä½ ç¤ºæ„è‡ªå·±å¯ä»¥å¤„ç†ï¼Œä»–ä¾¿é€€åˆ°ä¸€æ—ï¼Œå«ç¬‘çœ‹ç€ä½ ç”¨æ™ºæ…§åŒ–è§£äº†å±æœºã€‚" }
            ]
        },
        {
            title: "ç¬¨æ‹™çš„å…³æ€€",
            desc: "ä½ å¶æ„Ÿé£å¯’ï¼Œä»–ç«Ÿäº²è‡ªå»å¨æˆ¿ä¸ºä½ ç†¬è¯ï¼Œç»“æœç«¯æ¥ä¸€ç¢—é»‘ä¹ä¹çš„ä¸æ˜è¯æ±ï¼Œç¥æƒ…è¿˜æœ‰äº›ç´§å¼ ã€‚",
            options: [
                { text: "ã€ç¬‘ç€å–ä¸‹ã€‘", effects: { favor: 15 }, log: "ä½ ç¬‘ç€å°†é‚£ç¢—è‹¦æ¶©çš„è¯æ±ä¸€é¥®è€Œå°½ï¼Œè¯è™½è‹¦ï¼Œå¿ƒå´æ¯”èœœè¿˜ç”œã€‚" },
                { text: "ã€è®©ä»–å«å¤§å¤«ã€‘", effects: { favor: 5 }, log: "ä½ è®©ä»–è¿˜æ˜¯å»è¯·å¤§å¤«ï¼Œä»–æœ‰äº›ä¸å¥½æ„æ€åœ°æŒ äº†æŒ å¤´ã€‚" }
            ]
        },
        {
            title: "åˆ†äº«ç§˜å¯†",
            desc: "ä»–ä¸ä½ åˆ†äº«äº†ä¸€ä¸ªä»–ä»æœªå¯¹äººè¨€è¯´çš„ç§˜å¯†ï¼Œä¸€ä¸ªå…³äºä»–ç«¥å¹´çš„åˆ›ä¼¤ã€‚",
            options: [
                { text: "ã€è®¤çœŸå€¾å¬å¹¶å®‰æ…°ã€‘", effects: { favor: 20 }, log: "ä»–å‘ä½ æ•å¼€äº†æœ€è„†å¼±çš„ä¸€é¢ï¼Œä½ ä»¬çš„ä¿¡ä»»ä¸æƒ…æ„Ÿéƒ½è¾¾åˆ°äº†æ–°çš„é«˜åº¦ã€‚" },
                { text: "ã€ä¸çŸ¥æ‰€æªã€‘", effects: { favor: 5 }, log: "ä½ ä¸€æ—¶ä¸çŸ¥è¯¥å¦‚ä½•å›åº”ï¼Œåªèƒ½ç¬¨æ‹™åœ°å®‰æ…°å‡ å¥ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ ä½œç”»",
            desc: "ä»–é“ºå¼€ç”»å·ï¼Œè¯´è¦ä¸ºä½ ç”»ä¸€å¹…ä¸¹é’ã€‚ä½ ä¸ºä»–ç ”å¢¨ï¼Œçœ‹ä»–åœ¨çº¸ä¸Šå°†ä½ çš„å®¹é¢œä¸€ç‚¹ç‚¹å‹¾å‹’å‡ºæ¥ã€‚",
            options: [
                { text: "ã€ç”»å¾—æƒŸå¦™æƒŸè‚–ã€‘", req: { talent: 80 }, effects: { favor: 18 }, log: "ç”»ä¸­çš„ä½ ç«Ÿæ¯”çœŸäººæ›´æ·»ä¸‰åˆ†ç¥éŸµï¼Œä½ æƒŠå¹äºä»–çš„ç”»æŠ€ï¼Œä»–åˆ™ç—´è¿·äºä½ çš„å®¹é¢œã€‚" },
                { text: "ã€ç”»å¾—æƒ¨ä¸å¿ç¹ã€‘", effects: { favor: 10 }, log: "ä»–ç”»å‡ºçš„å°äººè®©ä½ å¿ä¿Šä¸ç¦ï¼Œè™½ç„¶ç”»æŠ€ä¸ä½³ï¼Œä½†è¿™ä»½å¿ƒæ„å´æ— æ¯”çè´µã€‚" }
            ]
        },
        // ========== æ–°å¢30ä¸ªä¸å¤«å›çš„æ¸©å­˜äº‹ä»¶ ==========
        {
            title: "å¸¦å›çš„ç¤¼ç‰©",
            desc: "ä»–å¤–å‡ºå½’æ¥ï¼Œé£å°˜ä»†ä»†ï¼Œå´ç¬¬ä¸€æ—¶é—´ä»æ€€é‡Œæå‡ºä¸€æ”¯æ¸©çƒ­çš„ç³–è‘«èŠ¦é€’ç»™ä½ ã€‚",
            options: [
                { text: "ã€å¼€å¿ƒåœ°åƒèµ·æ¥ã€‘", effects: { favor: 12 }, log: "ä½ åƒä¸ªå­©å­ä¸€æ ·å¼€å¿ƒåœ°åƒèµ·æ¥ï¼Œé…¸ç”œçš„å‘³é“åœ¨å£ä¸­åŒ–å¼€ï¼Œä¹Ÿç”œè¿›äº†å¿ƒé‡Œã€‚" },
                { text: "ã€å…ˆä¸ºä»–æ“¦æ±—ã€‘", effects: { favor: 15 }, log: "ä½ å…ˆæ‹¿å‡ºå¸•å­ä¸ºä»–æ“¦å»é¢è§’çš„æ±—æ°´ï¼Œè¿™ä»½ä½“è´´è®©ä»–å¿ƒä¸­ä¸€æš–ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æš–æ‰‹",
            desc: "å†¬æ—¥å¤©å¯’ï¼Œä½ çš„åŒæ‰‹å†°å†·ã€‚ä»–è§çŠ¶ï¼Œå°†ä½ çš„æ‰‹åŒ…è£¹åœ¨ä»–æ¸©æš–çš„æŒå¿ƒé‡Œã€‚",
            options: [
                { text: "ã€å°†æ‰‹ç¼©è¿›ä»–æ€€é‡Œã€‘", effects: { favor: 15 }, log: "ä½ é¡ºåŠ¿å°†å†°å†·çš„åŒæ‰‹éƒ½ä¼¸è¿›äº†ä»–çš„æ€€é‡Œå–æš–ï¼Œä»–æ— å¥ˆåˆå® æººåœ°ç¬‘äº†ã€‚" },
                { text: "ã€äº«å—è¿™ä»½æ¸©æš–ã€‘", effects: { favor: 10 }, log: "ä»–çš„æŒå¿ƒæ¸©æš–è€Œå¹²ç‡¥ï¼Œè¿™ä»½æš–æ„ä¸€ç›´ä¼ åˆ°äº†ä½ çš„å¿ƒåº•ã€‚" }
            ]
        },
        {
            title: "æ·±å¤œé•¿è°ˆ",
            desc: "ä½ ä»¬åœ¨åºŠä¸Šæ¯«æ— ç¡æ„ï¼Œä¾¿èŠèµ·äº†å¤©å—åœ°åŒ—çš„è¶£é—»ã€‚",
            options: [
                { text: "ã€å¬ä»–è®²å†›ä¸­/å®˜åœºæ•…äº‹ã€‘", effects: { favor: 10, wisdom: 1 }, log: "ä»–ä¸ºä½ è®²è¿°äº†è®¸å¤šä½ ä»æœªå¬è¿‡çš„æ•…äº‹ï¼Œè®©ä½ å¯¹ä»–çš„ä¸–ç•Œæœ‰äº†æ›´å¤šäº†è§£ã€‚" },
                { text: "ã€ä¸ä»–åˆ†äº«ä½ çš„å¿ƒäº‹ã€‘", effects: { favor: 12 }, log: "ä½ ä¸ä»–åˆ†äº«äº†ä½ çš„çƒ¦æ¼ï¼Œä»–è®¤çœŸåœ°å€¾å¬ï¼Œå¹¶ç»™äº†ä½ æ”¯æŒã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ è¯»è¯—",
            desc: "ä»–æ‹¿èµ·ä¸€æœ¬è¯—é›†ï¼Œç”¨ä»–ä½æ²‰ç£æ€§çš„å—“éŸ³ï¼Œä¸ºä½ æœ—è¯µæƒ…è¯—ã€‚",
            options: [
                { text: "ã€é™é™è†å¬ã€‘", effects: { favor: 12 }, log: "ä½ æ²‰é†‰åœ¨ä»–æ¸©æŸ”çš„å£°éŸ³å’Œè¯—å¥çš„æ„å¢ƒä¸­ï¼Œæ„Ÿåˆ°æ— æ¯”çš„æµªæ¼«ã€‚" },
                { text: "ã€ä¸ä»–å¯¹è¯—ã€‘", req: { talent: 70 }, effects: { favor: 15 }, log: "ä½ æ¥ä¸Šäº†ä¸‹ä¸€å¥ï¼Œä½ ä»¬ä¸€æ¥ä¸€å¾€ï¼Œå°†ä¸€é¦–æƒ…è¯—å¯¹å¾—å®Œæ•´ï¼Œé»˜å¥‘åè¶³ã€‚" }
            ]
        },
        {
            title: "èƒŒä½ å›å®¶",
            desc: "ä½ ä»¬å¤–å‡ºæ•£æ­¥ï¼Œä½ çš„è„šä¸æ…æ‰­ä¼¤ï¼Œä»–äºŒè¯ä¸è¯´ï¼Œä¾¿èƒŒèµ·ä½ å¾€å®¶èµ°ã€‚",
            options: [
                { text: "ã€ä¼åœ¨ä»–èƒŒä¸Šã€‘", effects: { favor: 18 }, log: "ä½ ä¼åœ¨ä»–å®½é˜”çš„èƒŒä¸Šï¼Œæ„Ÿåˆ°å‰æ‰€æœªæœ‰çš„å®‰å¿ƒã€‚å›å®¶çš„è·¯ä¼¼ä¹å¾ˆé•¿ï¼Œåˆä¼¼ä¹å¾ˆçŸ­ã€‚" },
                { text: "ã€è¯´è‡ªå·±èƒ½èµ°ã€‘", effects: { favor: 8 }, log: "ä½ å˜´ä¸Šè¯´è‡ªå·±èƒ½èµ°ï¼Œå´è¿˜æ˜¯ä¹–ä¹–åœ°è®©ä»–èƒŒç€ï¼Œä»–çœ‹ç©¿äº†ä½ çš„å£æ˜¯å¿ƒéã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æŒ¡é›¨",
            desc: "å¤©é™å¤§é›¨ï¼Œä»–è„±ä¸‹è‡ªå·±çš„å¤–è¢ï¼Œä¸ºä½ é®åœ¨å¤´é¡¶ï¼Œå°†ä½ ç´§ç´§æŠ¤åœ¨èº«ä¸‹ã€‚",
            options: [
                { text: "ã€ç´§ç´§é ç€ä»–ã€‘", effects: { favor: 15 }, log: "è™½ç„¶ä»–çš„åŠè¾¹èº«å­éƒ½æ¹¿é€äº†ï¼Œä½†ä½ å´æ„Ÿåˆ°æ— æ¯”çš„æ¸©æš–å’Œå®‰å…¨ã€‚" },
                { text: "ã€ä¸ä»–å…±æŠ«ã€‘", effects: { favor: 12 }, log: "ä½ æ‹‰è¿‡è¡£è¢ï¼Œä¸ä»–ä¸€åŒæŠ«ç€ï¼Œåœ¨é›¨ä¸­ç›¸è§†ä¸€ç¬‘ã€‚" }
            ]
        },
        {
            title: "å­©å­çš„ç¡é¢œ",
            desc: "ä½ ä»¬ä¸€åŒç«™åœ¨å­©å­çš„åºŠè¾¹ï¼Œçœ‹ç€å­©å­é¦™ç”œçš„ç¡é¢œã€‚",
            options: [
                { text: "ã€æ¡ä½ä»–çš„æ‰‹ã€‘", effects: { favor: 12 }, log: "ä½ ä»¬ç›¸è§†ä¸€ç¬‘ï¼Œæ¡ä½äº†å½¼æ­¤çš„æ‰‹ã€‚è¿™ä¸€åˆ»ï¼Œä½ ä»¬æ˜¯å¤©åº•ä¸‹æœ€å¹¸ç¦çš„çˆ¶æ¯ã€‚" },
                { text: "ã€è®¨è®ºå­©å­çš„æœªæ¥ã€‘", effects: { favor: 10 }, log: "ä½ ä»¬è½»å£°è®¨è®ºç€å­©å­çš„æœªæ¥ï¼Œå¯¹ç”Ÿæ´»å……æ»¡äº†å¸Œæœ›ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ ç»¾å‘",
            desc: "ä½ æ­£è¦æ¢³å¤´ï¼Œä»–å´æ‹¿è¿‡æ¢³å­ï¼Œè¦äº²è‡ªä¸ºä½ ç»¾ä¸€ä¸ªæ¼‚äº®çš„å‘é«»ã€‚",
            options: [
                { text: "ã€ä»»ä»–æ–½ä¸ºã€‘", effects: { favor: 15 }, log: "ä»–ä¸€ä¸ªæ­¦å°†/æ–‡å®˜ï¼Œç«Ÿç»¾å¾—æœ‰æ¨¡æœ‰æ ·ã€‚ä½ ä»é•œä¸­çœ‹ç€ä»–ä¸“æ³¨çš„æ¨¡æ ·ï¼Œå¿ƒä¸­ç”œèœœã€‚" },
                { text: "ã€æ‰“è¶£ä»–ã€‘", effects: { favor: 10 }, log: "ä½ æ‰“è¶£ä»–æ˜¯å¦ä¹Ÿæ›¾ä¸ºåˆ«çš„å¥³å­ç»¾è¿‡å‘ï¼Œä»–æ€¥å¿™è§£é‡Šï¼Œæ ·å­ååˆ†å¯çˆ±ã€‚" }
            ]
        },
        {
            title: "ç¬¨æ‹™çš„é“æ­‰",
            desc: "ä½ ä»¬å› å°äº‹äº‰åµï¼Œä»–è™½ä¸å–„è¨€è¾ï¼Œå´ä¸ºä½ ä¹°æ¥äº†ä½ æœ€çˆ±åƒçš„ç‚¹å¿ƒï¼Œç¬¨æ‹™åœ°å‘ä½ é“æ­‰ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶åŸè°…ã€‘", effects: { favor: 12 }, log: "ä½ è¢«ä»–ç¬¨æ‹™çš„æ ·å­é€—ç¬‘äº†ï¼Œå¿ƒé‡Œçš„æ°”ä¹Ÿæ¶ˆäº†ï¼Œæ¬£ç„¶åŸè°…äº†ä»–ã€‚" },
                { text: "ã€æ•…æ„ä¸ºéš¾ä»–ã€‘", req: { charm: 70 }, effects: { favor: 10 }, log: "ä½ æ•…æ„æ¿ç€è„¸ä¸ºéš¾ä»–ï¼Œç›´åˆ°ä»–æ€¥å¾—æ»¡å¤´å¤§æ±—æ‰åŸè°…ä»–ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ”¾ç¯",
            desc: "åœ¨æ²³è¾¹ï¼Œä»–ä¸ºä½ ç‚¹äº®ä¸€ç›èŠ±ç¯ï¼Œè®©ä½ è®¸æ„¿ã€‚",
            options: [
                { text: "ã€è®¸ä¸‹ç™½é¦–ä¹‹çº¦ã€‘", effects: { favor: 15 }, log: "ä½ è®¸ä¸‹äº†ä¸ä»–ç™½å¤´å•è€çš„æ„¿æœ›ï¼Œä»–å¬åï¼Œå°†ä½ æ‹¥å¾—æ›´ç´§äº†ã€‚" },
                { text: "ã€ä¸ºå®¶æ—ç¥ˆç¦ã€‘", effects: { favor: 10, virtue: 2 }, log: "ä½ ä¸ºå®¶æ—ç¥ˆç¦ï¼Œä»–ç§°èµä½ è´¤æƒ å¤§åº¦ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ å†™ä¿¡",
            desc: "ä»–å› å…¬å‡ºå·®ï¼Œå´æ¯æ—¥éƒ½å†™ä¿¡ç»™ä½ ï¼Œä¿¡ä¸­æ²¡æœ‰ç”œè¨€èœœè¯­ï¼Œåªæ˜¯è®°å½•ç€æ¯æ—¥çš„æ‰€è§æ‰€é—»ã€‚",
            options: [
                { text: "ã€è®¤çœŸå›ä¿¡ã€‘", effects: { favor: 15 }, log: "ä½ æ¯æ—¥ä¹Ÿè®¤çœŸå›ä¿¡ï¼Œä¸ä»–åˆ†äº«å®¶ä¸­çš„ç‚¹æ»´ã€‚è¿™ä»½å¹³æ·¡çš„ç‰µæŒ‚ï¼Œè®©ä½ ä»¬çš„å¿ƒç´§ç´§ç›¸è¿ã€‚" },
                { text: "ã€çè—ä¿¡ä»¶ã€‘", effects: { favor: 10 }, log: "ä½ å°†ä»–çš„æ¯ä¸€å°ä¿¡éƒ½ç»†å¿ƒçè—èµ·æ¥ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ‹’ç»åº”é…¬",
            desc: "ä»–ä¸ºäº†èƒ½æ—©äº›å›å®¶é™ªä½ ï¼Œæ‹’ç»äº†ä¸€åœºé‡è¦çš„åŒåƒšå®´è¯·ã€‚",
            options: [
                { text: "ã€å¿ƒä¸­æ„ŸåŠ¨ã€‘", effects: { favor: 18 }, log: "ä½ å¿ƒä¸­ååˆ†æ„ŸåŠ¨ï¼Œä¸ºä»–å‡†å¤‡äº†ä¸€æ¡Œä¸°ç››çš„æ™šé¤ã€‚" },
                { text: "ã€åŠä»–ä»¥äº‹ä¸šä¸ºé‡ã€‘", effects: { favor: 8 }, log: "ä½ åŠä»–ä»¥äº‹ä¸šä¸ºé‡ï¼Œä»–å´è¯´ï¼Œä»€ä¹ˆéƒ½æ¯”ä¸ä¸Šä¸ä½ ç›¸ä¼´ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ å­¦åšèœ",
            desc: "ä»–ç«Ÿå·å·å‘å¨å¨˜å­¦ç€åšä½ æœ€çˆ±åƒçš„ä¸€é“èœã€‚",
            options: [
                { text: "ã€å‘³é“å¾ˆå¥½ã€‘", effects: { favor: 15 }, log: "è™½ç„¶å–ç›¸ä¸ä½³ï¼Œä½†å‘³é“ç«Ÿå‡ºå¥‡çš„å¥½ã€‚ä½ å¯¹ä»–åˆ®ç›®ç›¸çœ‹ã€‚" },
                { text: "ã€å‘³é“å¤æ€ªã€‘", effects: { favor: 10 }, log: "å‘³é“è™½ç„¶ä¸€è¨€éš¾å°½ï¼Œä½†ä½ è¿˜æ˜¯ç¬‘ç€åƒäº†ä¸‹å»ï¼Œä¸å¿è¾œè´Ÿä»–çš„å¿ƒæ„ã€‚" }
            ]
        },
        {
            title: "ç»´æŠ¤ä½ çš„å®¶äºº",
            desc: "ä½ å¨˜å®¶é‡åˆ°éº»çƒ¦ï¼Œä»–äºŒè¯ä¸è¯´ï¼ŒåŠ¨ç”¨è‡ªå·±çš„å…³ç³»ä¸ºä½ æ‘†å¹³äº†ã€‚",
            options: [
                { text: "ã€æ„Ÿæ¿€ä¸å°½ã€‘", effects: { favor: 20 }, log: "ä»–å¯¹ä½ å®¶äººçš„ç»´æŠ¤è®©ä½ æ„Ÿæ¿€ä¸å°½ï¼Œè§‰å¾—å«ç»™äº†å¯¹çš„äººã€‚" },
                { text: "ã€è¡¨ç¤ºä¼šå›æŠ¥ã€‘", effects: { favor: 15 }, log: "ä½ è¡¨ç¤ºè¿™ä»½æ©æƒ…ä½ è®°ä¸‹äº†ï¼Œä»–å´è¯´â€œä½ çš„å®¶äººï¼Œä¾¿æ˜¯æˆ‘çš„å®¶äººâ€ã€‚" }
            ]
        },
        {
            title: "è®°å¾—ä½ çš„å–œå¥½",
            desc: "ä½ æ— æ„ä¸­è¯´èµ·å–œæ¬¢æŸç§èŠ±ï¼Œä»–ä¾¿é»˜é»˜è®°ä¸‹ï¼Œå°†åé™¢éƒ½ç§æ»¡äº†é‚£ç§èŠ±ã€‚",
            options: [
                { text: "ã€æƒŠå–œä¸å·²ã€‘", effects: { favor: 18 }, log: "çœ‹ç€æ»¡å›­çš„èŠ±æµ·ï¼Œä½ æƒŠå–œä¸å·²ï¼Œè¿™ä»½ä¸åŠ¨å£°è‰²çš„æµªæ¼«æœ€ä¸ºè‡´å‘½ã€‚" },
                { text: "ã€ä¸ä»–ä¸€åŒæ‰“ç†ã€‘", effects: { favor: 12 }, log: "ä½ ä¸ä»–ä¸€åŒæ‰“ç†èŠ±å›­ï¼Œå¿ƒä¸­å……æ»¡äº†å¹¸ç¦ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ å†™è¯—",
            desc: "ä»–è™½ä¸æ“…æ–‡å¢¨ï¼Œå´ä¸ºä½ å†™ä¸‹äº†ä¸€é¦–æƒ…è¯—ï¼Œè¨€è¾è´¨æœ´ï¼Œå´æƒ…çœŸæ„åˆ‡ã€‚",
            options: [
                { text: "ã€çè—èµ·æ¥ã€‘", effects: { favor: 15 }, log: "ä½ å°†è¿™é¦–ä¸ç®—å·¥æ•´çš„è¯—è§†è‹¥çå®ï¼Œå› ä¸ºè¿™å…¶ä¸­æ»¡å«ç€ä»–çš„çˆ±æ„ã€‚" },
                { text: "ã€æ‰“è¶£ä»–ã€‘", effects: { favor: 10 }, log: "ä½ æ‰“è¶£ä»–çš„æ–‡é‡‡ï¼Œä»–æœ‰äº›ä¸å¥½æ„æ€ï¼Œå´è¿˜æ˜¯å¾ˆé«˜å…´ä½ å–œæ¬¢ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æŒ¡ç¾",
            desc: "ä½ ä»¬åœ¨è¡—ä¸Šé‡åˆ°æƒŠé©¬ï¼Œä»–æ¯«ä¸çŠ¹è±«åœ°å°†ä½ æŠ¤åœ¨èº«åã€‚",
            options: [
                { text: "ã€æ‹…å¿ƒä»–çš„å®‰å±ã€‘", effects: { favor: 20 }, log: "ä½ ç¬¬ä¸€æ—¶é—´æ£€æŸ¥ä»–æ˜¯å¦å—ä¼¤ï¼Œè¿™ä»½å…³å¿ƒè®©ä»–è§‰å¾—ä¸ºä½ åšä»€ä¹ˆéƒ½å€¼å¾—ã€‚" },
                { text: "ã€åæ€•ä¸å·²ã€‘", effects: { favor: 12 }, log: "ä½ å“å¾—ä¸è½»ï¼Œä»–ç´§ç´§åœ°æŠ±ç€ä½ ï¼Œå®‰æ…°ä½ æ²¡äº‹äº†ã€‚" }
            ]
        },
        {
            title: "æ‰¿è®¤é”™è¯¯",
            desc: "ä»–ä¸ºè‡ªå·±ä¹‹å‰çš„æŸä¸ªé”™è¯¯å†³å®šï¼Œéƒ‘é‡åœ°å‘ä½ é“æ­‰ã€‚",
            options: [
                { text: "ã€æ¬£ç„¶åŸè°…ã€‘", effects: { favor: 15 }, log: "èƒ½å¦ç„¶æ‰¿è®¤é”™è¯¯çš„ç”·äººï¼Œæœ€æœ‰é­…åŠ›ã€‚ä½ æ¬£ç„¶åŸè°…äº†ä»–ï¼Œä½ ä»¬çš„ä¿¡ä»»æ›´æ·±äº†ã€‚" },
                { text: "ã€ä¸ä»–ä¸€åŒåæ€ã€‘", effects: { favor: 12 }, log: "ä½ ä»¬ä¸€åŒåæ€äº†æ­¤äº‹ï¼Œå¹¶çº¦å®šä»¥åå‡¡äº‹å¤šå•†é‡ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ‹’ç»è¯±æƒ‘",
            desc: "ä½ å¾—çŸ¥ï¼Œä»–ä¸ºä½ æ‹’ç»äº†ä¸€ä½å¯¹ä»–ç¤ºå¥½çš„ã€å®¶ä¸–æ˜¾èµ«çš„å¥³å­ã€‚",
            options: [
                { text: "ã€å¿ƒä¸­ç”œèœœã€‘", effects: { favor: 20 }, log: "å¾—çŸ¥æ­¤äº‹ï¼Œä½ å¿ƒä¸­æ—¢ç”œèœœåˆéª„å‚²ï¼Œå¯¹ä»–æ›´åŠ çˆ±æ…•ã€‚" },
                { text: "ã€å‡è£…åƒé†‹ã€‘", req: { charm: 80 }, effects: { favor: 15 }, log: "ä½ å‡è£…åƒé†‹ï¼Œä»–æ€¥å¿™å‘ä½ è¡¨å¿ å¿ƒï¼Œä½ ä»¬åœ¨æ‰“é—¹ä¸­æ„Ÿæƒ…æ›´å¥½äº†ã€‚" }
            ]
        },
        {
            title: "ä¸€ä¸ªæ‰¿è¯º",
            desc: "â€œç­‰æˆ‘å‘Šè€è¿˜ä¹¡ï¼Œå°±å¸¦ä½ æ¸¸éåå±±å¤§å·ï¼Œçœ‹å°½ä¸–é—´ç¹åã€‚â€ä»–æŠ±ç€ä½ ï¼Œåœ¨ä½ è€³è¾¹è®¸ä¸‹æ‰¿è¯ºã€‚",
            options: [
                { text: "ã€æ»¡æ€€æœŸå¾…ã€‘", effects: { favor: 15 }, log: "ä½ å¯¹è¿™ä¸ªæ‰¿è¯ºå……æ»¡äº†æœŸå¾…ï¼Œè§‰å¾—æœªæ¥çš„æ—¥å­éƒ½æœ‰äº†ç›¼å¤´ã€‚" },
                { text: "ã€â€œæˆ‘ç­‰ä½ â€ã€‘", effects: { favor: 18 }, log: "â€œå¥½ï¼Œæˆ‘ç­‰ä½ ã€‚â€ä½ ç®€å•çš„ä¸‰ä¸ªå­—ï¼Œæ˜¯ä»–å¥‹æ–—çš„æœ€å¤§åŠ¨åŠ›ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ ç§æ ‘",
            desc: "ä»–åœ¨é™¢å­é‡Œç§ä¸‹äº†ä¸€æ£µæ¡‚èŠ±æ ‘ï¼Œè¯´ç­‰ä½ è€äº†ï¼Œå¯ä»¥ä¸€èµ·åœ¨æ ‘ä¸‹å–èŒ¶èµæ¡‚ã€‚",
            options: [
                { text: "ã€ä¸€åŒæµ‡æ°´ã€‘", effects: { favor: 15 }, log: "ä½ ä»¬ä¸€åŒä¸ºå°æ ‘æµ‡æ°´ï¼Œä»¿ä½›åœ¨æµ‡çŒä½ ä»¬çš„æœªæ¥ã€‚" },
                { text: "ã€æ„ŸåŠ¨ä¸å·²ã€‘", effects: { favor: 12 }, log: "è¿™ä»½æƒ³åˆ°è€çš„æµªæ¼«ï¼Œè®©ä½ æ„ŸåŠ¨ä¸å·²ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ å¯»è¯",
            desc: "ä½ åªæ˜¯éšå£ä¸€æèº«ä½“æŸå¤„ä¸é€‚ï¼Œä»–ä¾¿é»˜é»˜è®°ä¸‹ï¼Œä¸ºä½ å¯»æ¥äº†å¯¹ç—‡çš„è¯æã€‚",
            options: [
                { text: "ã€å¿ƒä¸­æ¸©æš–ã€‘", effects: { favor: 15 }, log: "è¿™ä»½ç»†è‡´å…¥å¾®çš„å…³æ€€ï¼Œè®©ä½ å¿ƒä¸­æ— æ¯”æ¸©æš–ã€‚" },
                { text: "ã€å®å˜±ä»–ä¸è¦ä¹±èŠ±é’±ã€‘", effects: { favor: 8 }, log: "ä½ å®å˜±ä»–ä¸è¦ä¹±èŠ±é’±ï¼Œä»–å´è¯´ä½ çš„å¥åº·æœ€é‡è¦ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ”¾é£ç­",
            desc: "åœ¨éƒŠå¤–ï¼Œä»–ä¸ºä½ æ”¾é£ä¸€åªå¾ˆé«˜å¾ˆé«˜çš„é£ç­ï¼Œå°±åƒä½ ä»¬çš„æ„Ÿæƒ…ï¼Œæ‰¶æ‘‡ç›´ä¸Šã€‚",
            options: [
                { text: "ã€ä¸€åŒç‰µçº¿ã€‘", effects: { favor: 12 }, log: "ä½ ä»¬ä¸€åŒç‰µç€é£ç­çº¿ï¼Œæ„Ÿå—ç€é£çš„åŠ›é‡ï¼Œç¬‘å¾—åƒä¸ªå­©å­ã€‚" },
                { text: "ã€åœ¨è‰åœ°ä¸Šçœ‹ä»–ã€‘", effects: { favor: 8 }, log: "ä½ ååœ¨è‰åœ°ä¸Šï¼Œçœ‹ç€ä»–ä¸ºä½ å¥”è·‘çš„æ ·å­ï¼Œè§‰å¾—å²æœˆé™å¥½ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ é©±èµ¶èšŠè™«",
            desc: "å¤å¤œä¹˜å‡‰ï¼Œä»–ç»†å¿ƒåœ°ä¸ºä½ é©±èµ¶ç€èšŠè™«ï¼Œä¸è®©å®ƒä»¬æ‰“æ‰°ä½ ã€‚",
            options: [
                { text: "ã€ä¸ºä»–æ“¦æ±—ã€‘", effects: { favor: 12 }, log: "ä½ æ‹¿å‡ºå¸•å­ï¼Œä¸ºä»–æ“¦å»é¢è§’çš„æ±—æ°´ã€‚" },
                { text: "ã€é åœ¨ä»–è‚©ä¸Šã€‘", effects: { favor: 10 }, log: "ä½ å®‰å¿ƒåœ°é åœ¨ä»–è‚©ä¸Šï¼Œäº«å—ç€è¿™ä»½å®é™ä¸å‘µæŠ¤ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ‹’ç»ç¾å¦¾",
            desc: "æœ‰åŒåƒšè¦é€ä»–ä¸€ä½ç¾è²Œçš„æ­Œå§¬ä½œä¸ºå¦¾å®¤ï¼Œä»–å´ä»¥â€œå®¶æœ‰è´¤å¦»â€ä¸ºç”±æ‹’ç»äº†ã€‚",
            options: [
                { text: "ã€å‡è£…ç”Ÿæ°”ã€‘", req: { charm: 80 }, effects: { favor: 18 }, log: "ä½ å‡è£…ç”Ÿæ°”åœ°é—®ä»–ä¸ºä½•æ‹’ç»ï¼Œä»–ç¬‘ç€å°†ä½ æ‹¥å…¥æ€€ä¸­ï¼Œè¯´â€œä¸‡åƒç¹åï¼Œä¸åŠä½ ä¸€äººâ€ã€‚" },
                { text: "ã€å¿ƒä¸­çªƒå–œã€‘", effects: { favor: 15 }, log: "ä½ å¿ƒä¸­çªƒå–œï¼Œå¯¹ä»–æ›´åŠ çˆ±æ…•ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ å®ˆå²",
            desc: "é™¤å¤•ä¹‹å¤œï¼Œä½ æœ‰äº›å›°äº†ï¼Œä»–å´åšæŒè¦é™ªä½ ä¸€åŒå®ˆå²ï¼Œè¿æ¥æ–°å¹´çš„ç¬¬ä¸€ç¼•æ™¨å…‰ã€‚",
            options: [
                { text: "ã€ä¸€åŒå®ˆå²ã€‘", effects: { favor: 15 }, log: "ä½ ä»¬ä¸€åŒå®ˆå²ï¼Œè¯´ç€ä½“å·±è¯ï¼Œç›´åˆ°å¤©æ˜ã€‚è¿™ä»½ä»ªå¼æ„Ÿè®©ä½ ä»¬çš„æ„Ÿæƒ…æ›´åŠ æ·±åšã€‚" },
                { text: "ã€è®©ä»–å…ˆç¡ã€‘", effects: { favor: 8 }, log: "ä½ åŠä»–å…ˆå»ç¡ï¼Œä»–å´åšæŒè¦ç­‰ä½ ä¸€èµ·ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æŒ¡ç®­",
            desc: "åœ¨ä¸€æ¬¡ç‹©çŒä¸­ï¼Œä¸€æ”¯æš—ç®­å°„æ¥ï¼Œä»–æ¯«ä¸çŠ¹è±«åœ°ç”¨èº«ä½“ä¸ºä½ æŒ¡ä½äº†ï¼",
            options: [
                { text: "ã€æƒŠæ…Œå¤±æªã€‘", effects: { favor: 25 }, log: "ä½ æƒŠæ…Œå¤±æªåœ°ä¸ºä»–åŒ…æ‰ä¼¤å£ï¼Œä»–å´ç¬‘ç€è¯´ï¼Œåªè¦ä½ æ²¡äº‹å°±å¥½ã€‚æ­¤åï¼Œä½ è§†ä»–å¦‚ç”Ÿå‘½ã€‚" },
                { text: "ã€å†·é™å¤„ç†ã€‘", req: { wisdom: 80 }, effects: { favor: 20 }, log: "ä½ å†·é™åœ°ä¸ºä»–å¤„ç†äº†ä¼¤å£ï¼Œå¹¶ååŠ©ä»–æŠ“ä½äº†åˆºå®¢ã€‚ä½ ä»¬æ˜¯ç”Ÿæ­»ä¸å…±çš„ä¼´ä¾£ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ æ”¾å¼ƒå‰ç¨‹",
            desc: "ä»–ä¸ºäº†èƒ½è°ƒå›äº¬åŸé™ªä¼´ä½ ï¼Œæ”¾å¼ƒäº†ä¸€ä¸ªæ›´å¥½çš„å¤–æ”¾é«˜å‡æœºä¼šã€‚",
            options: [
                { text: "ã€æ„ŸåŠ¨ä¸å·²ã€‘", effects: { favor: 25 }, log: "â€œæ±Ÿå±±å¦‚æ­¤å¤šå¨‡ï¼Œæ€åŠä½ çœ‰çœ¼å«ç¬‘ã€‚â€ä»–å¯¹ä½ çš„æ·±æƒ…ï¼Œè®©ä½ æ„ŸåŠ¨å¾—æ— ä»¥å¤åŠ ã€‚" },
                { text: "ã€è®¤ä¸ºä»–ä¸ç†æ™ºã€‘", effects: { favor: -5 }, log: "ä½ è®¤ä¸ºä»–å¤ªè¿‡å„¿å¥³æƒ…é•¿ï¼Œä¸ºäº†ä½ ä¸é¡¾å‰ç¨‹ï¼Œä»–æœ‰äº›å—ä¼¤ã€‚" }
            ]
        },
        {
            title: "ä¸ºä½ è€Œæ”¹å˜",
            desc: "ä½ æ›¾æ— æ„ä¸­è¯´è¿‡ä¸å–œæ¬¢ä»–æŸä¸ªä¹ æƒ¯ï¼Œä»–ä¾¿çœŸçš„ä¸ºä½ æ”¹æ‰äº†ã€‚",
            options: [
                { text: "ã€å¿ƒä¸­æ„ŸåŠ¨ã€‘", effects: { favor: 15 }, log: "è¿™ä»½ä¸ºä½ è€Œæ”¹å˜çš„å¿ƒæ„ï¼Œè®©ä½ æ— æ¯”åŠ¨å®¹ã€‚" },
                { text: "ã€å‡è£…æ²¡å‘ç°ã€‘", effects: { favor: 8 }, log: "ä½ æ²¡æœ‰ç‚¹ç ´ï¼Œåªæ˜¯é»˜é»˜åœ°äº«å—ç€è¿™ä»½æ”¹å˜ã€‚" }
            ]
        }
    ]
};
// ===================== ã€å®Œæ•´æ›¿æ¢ç”¨ä»£ç å—ã€‘å¤«å¦»æ¸©å­˜äº‹ä»¶åº“ (V2.0 ç»ˆææ‰©å……ç‰ˆ) END =====================
// ===================== ã€æ–°å¢ã€‘å¤«å¦»æ¸©å­˜äº‹ä»¶åº“ END =====================
// ===================== ã€è¯·ç”¨æ­¤ä»£ç å—å®Œæ•´æ›¿æ¢ã€‘ =====================
const HAREM_EVENT_DATA = {
    // Low-intensity jealousy events
    jealousy: [
        {
            id: 'fake_pregnancy',
            title: 'å‡å­•äº‰å® ',
            trigger: (concubine) => concubine.mood === 'jealous' && concubine.ambition > 50 && Math.random() < 0.2,
            description: (concubine) => `ä½ çš„å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> è¿‘æ—¥å£°ç§°è‡ªå·±å·²æœ‰èº«å­•ï¼Œå‘ä½ ç´¢è¦æ›´å¤šèµèµå’Œç…§é¡¾ã€‚`,
            options: [
                {
                    text: 'ã€ä¿¡ä»¥ä¸ºçœŸï¼Œå¤§åŠ èµèµã€‘',
                     action: (concubine) => {
                        applyEffects({ wealth: -500 });
                        applyEffects({ relationship: { targetId: concubine.id, favor: 10 } });
                        concubine.mood = 'å¾—æ„';
                        logEvent(`ä½ èµèµäº†å£°ç§°æœ‰å­•çš„${concubine.name}ï¼Œä½†ä¸€ä¸ªæœˆåè‹¥æ— æ‰€å‡ºï¼Œä½ çš„å£°æœ›ä¼šå› â€œè¯†äººä¸æ˜â€è€Œå¾®é™ã€‚`);
                        gameState.flags[`fake_preg_${concubine.id}`] = gameState.date.year;
                    }
                },
                {
                    text: 'ã€æš—ä¸­æ´¾äººè°ƒæŸ¥ã€‘',
                    action: (concubine) => {
                        const isFake = Math.random() < 0.7; // 70% chance it's fake
                        if (isFake) {
                            showEventCard('è°ƒæŸ¥ç»“æœ', 'fa-search', `å¿ƒè…¹ä¸‹äººå›æŠ¥ï¼Œ${concubine.name}è„‰è±¡å¹³ç¨³ï¼Œå¹¶æ— èº«å­•ã€‚æ­¤äº‹æ˜¯ä½ å¤„ç½®çš„å¥½æ—¶æœºã€‚`);
                        } else {
                            showEventCard('è°ƒæŸ¥ç»“æœ', 'fa-search', `å¤ªåŒ»è¯Šæ–­ï¼Œ${concubine.name}ç¡®æœ‰èº«å­•ï¼ä½ é™©äº›å†¤æ‰äº†å¥¹ã€‚`);
                            applyEffects({ relationship: { targetId: concubine.id, favor: -10 } });
                        }
                    }
                },
                {
                    text: 'ã€è¯·æ­£å¦»å¤„ç†ã€‘',
                    action: (concubine) => {
                        const wife = gameState.npcs[gameState.marriage.spouseId];
                        if (wife.attributes.wisdom > 70) {
                            showEventCard('ä¸»æ¯ä¹‹å¨', 'fa-chess-queen', `ä½ çš„æ­£å¦»ä¸‰è¨€ä¸¤è¯­ä¾¿è¯†ç ´äº†${concubine.name}çš„ä¼ä¿©ï¼Œå¹¶ç½šå¥¹æŠ„å†™å¥³åˆ™ï¼Œåå®…å¨æœ›æå‡ã€‚`);
                            wife.householdPrestige = (wife.householdPrestige || 0) + 10;
                        } else {
                            showEventCard('å¤„ç½®ä¸å½“', 'fa-frown', 'æ­£å¦»æœªèƒ½å¤„ç†å¥½æ­¤äº‹ï¼Œåè€Œè¢«å¦¾å®¤å€’æ‰“ä¸€è€™ã€‚');
                            wife.householdPrestige = (wife.householdPrestige || 0) - 5;
                        }
                    }
                }
            ]
        },
        // ============= æ–°å¢30ä¸ªåå®…äº‹ä»¶ START =============
        {
            id: 'imitation_style',
            title: 'åˆ»æ„æ¨¡ä»¿',
            trigger: (concubine, wife) => wife && concubine.favor < wife.favor - 20 && concubine.ambition > 40 && Math.random() < 0.25,
            description: (concubine, wife) => `ä½ å‘ç°å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> æœ€è¿‘çš„ç©¿ç€æ‰“æ‰®ã€è¨€è¡Œä¸¾æ­¢éƒ½åœ¨åˆ»æ„æ¨¡ä»¿ä½ çš„æ­£å¦» <strong class="highlight-npc">${wife.name}</strong>ã€‚`,
            options: [
                { text: 'ã€è®¤ä¸ºæœ‰è¶£ï¼Œä¸äºˆç†ä¼šã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: 2}}); return 'ä½ è§‰å¾—è¿™åªæ˜¯åå®…å¥³çœ·é—´çš„å°æƒ…è¶£ï¼Œå¹¶æœªæ”¾åœ¨å¿ƒä¸Šã€‚'; } },
                { text: 'ã€ç§ä¸‹æç‚¹å¥¹è¦æœ‰è‡ªå·±çš„é£æ ¼ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: -5}}); return `ä½ æç‚¹äº†${c.name}ä¸€ç•ªï¼Œå¥¹æœ‰äº›ç¾æ¼ï¼Œè®¤ä¸ºä½ çœ‹ä¸èµ·å¥¹ã€‚`; } },
                { text: 'ã€ç§°èµå¥¹çš„æ¨¡ä»¿æƒŸå¦™æƒŸè‚–ã€‘', action: (c, w) => { c.ambition += 5; applyEffects({relationship: {targetId: w.id, favor: -5}}); return 'ä½ çš„ç§°èµåŠ©é•¿äº†å¥¹çš„æ°”ç„°ï¼Œæ­£å¦»å¯¹æ­¤é¢‡æœ‰å¾®è¯ã€‚'; } }
            ]
        },
        {
            id: 'feigning_illness',
            title: 'ç§°ç—…äº‰å® ',
            trigger: (concubine) => concubine.jealousy > 60 && concubine.favor < 50 && Math.random() < 0.3,
            description: (concubine) => `åœ¨ä½ æ­£è¦å»æ­£å¦»æˆ¿ä¸­æ—¶ï¼Œå¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> çš„ä¸«é¬Ÿæ…Œå¼ æ¥æŠ¥ï¼Œè¯´å¥¹çªç„¶â€œç—…å€’â€äº†ã€‚`,
            options: [
                { text: 'ã€å‰å»æ¢æœ›ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: 8}}); gameState.marriage.familyHarmony -= 3; return 'ä½ å‰å»æ¢æœ›ï¼Œå¥¹çœ‹èµ·æ¥å¹¶æ— å¤§ç¢ã€‚ä½ è™½çŸ¥å…¶æ„ï¼Œä½†ä¹Ÿæœªç‚¹ç ´ã€‚'; } },
                { text: 'ã€æ´¾å¤ªåŒ»å»è¯Šæ²»ã€‘', action: (c) => { applyEffects({wealth: -50}); if(Math.random() < 0.8) { applyEffects({relationship: {targetId: c.id, favor: -10}}); return 'å¤ªåŒ»å›æŠ¥å¹¶æ— å¤§ç¢ï¼Œä½ å¯Ÿè§‰åˆ°å¥¹åœ¨è£…ç—…ï¼Œå¯¹å¥¹å¿ƒç”Ÿä¸æ‚¦ã€‚'; } else { return 'å¤ªåŒ»è¯Šæ–­å¥¹ç¡®æœ‰äº›ä½“è™šï¼Œä½ æœ‰äº›å†…ç–šã€‚'; } } },
                { text: 'ã€ä¸äºˆç†ä¼šã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -8}}); return 'ä½ æœªäºˆç†ä¼šï¼Œå¥¹å› æ­¤å¿ƒæ€€æ€¨æ€¼ã€‚'; } }
            ]
        },
        {
            id: 'child_comparison',
            title: 'å­å—£æ¯”è¾ƒ',
            trigger: (concubine, wife) => {
                const concubineChild = gameState.children.find(child => child.motherId === concubine.id && !child.isDead);
                const wifeChild = wife ? gameState.children.find(child => child.motherId === wife.id && !child.isDead) : null;
                return concubineChild && wifeChild && concubine.jealousy > 50 && Math.random() < 0.25;
            },
            description: (concubine, wife) => {
                const cChild = gameState.children.find(child => child.motherId === concubine.id);
                const wChild = gameState.children.find(child => child.motherId === wife.id);
                return `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> åœ¨ä½ é¢å‰ï¼Œæœ‰æ„æ— æ„åœ°å°†å¥¹çš„å­©å­ <strong class="highlight-npc">${cChild.name}</strong> ä¸å«¡å­/å¥³ <strong class="highlight-npc">${wChild.name}</strong> ä½œæ¯”è¾ƒï¼Œè¨€è¯­é—´æ»¡æ˜¯ç‚«è€€ä¹‹æ„ã€‚`;
            },
            options: [
                { text: 'ã€å¤¸èµå¥¹çš„å­©å­ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: 5}, relationship: {targetId: w.id, favor: -3}}); return `ä½ å¤¸èµäº†${c.name}çš„å­©å­ï¼Œå¥¹ååˆ†å¾—æ„ï¼Œä½†æ­£å¦»æœ‰äº›ä¸å¿«ã€‚`; } },
                { text: 'ã€å¼ºè°ƒå«¡åº¶æœ‰åˆ«ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: -8}}); return `ä½ å¼ºè°ƒå«¡åº¶å°Šå‘ï¼Œ${c.name}çš„è„¸è‰²å˜å¾—éš¾çœ‹ã€‚`; } },
                { text: 'ã€ä¸€è§†åŒä»ï¼Œå„è‡ªé¼“åŠ±ã€‘', action: (c, w) => { gameState.marriage.familyHarmony += 3; return 'ä½ å¯¹ä¸¤ä¸ªå­©å­éƒ½ç»™äºˆäº†é¼“åŠ±ï¼Œæš‚æ—¶å¹³æ¯äº†é£æ³¢ã€‚'; } }
            ]
        },
        {
            id: 'servant_dispute',
            title: 'ä¸‹äººäº‰æ‰§',
            trigger: (concubine, wife) => wife && concubine.favor > 40 && wife.favor > 40 && Math.random() < 0.2,
            description: (concubine, wife) => `æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> çš„å¿ƒè…¹ä¸«é¬Ÿä¸å® å¦¾ <strong class="highlight-npc">${concubine.name}</strong> çš„ä¸«é¬Ÿå› ä¸€ç‚¹å°äº‹åœ¨é™¢ä¸­èµ·äº†äº‰æ‰§ï¼Œäº’ä¸ç›¸è®©ã€‚`,
            options: [
                { text: 'ã€å„æ‰“äº”åå¤§æ¿ã€‘', action: (c, w) => { gameState.marriage.familyHarmony -= 2; return 'ä½ å„æ‰“äº”åå¤§æ¿ï¼Œä½†åŒæ–¹éƒ½è§‰å¾—ä½ åè¢’å¯¹æ–¹ã€‚'; } },
                { text: 'ã€åè¢’æ­£å¦»ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: w.id, favor: 5}, relationship: {targetId: c.id, favor: -5}}); return 'ä½ ç»´æŠ¤äº†æ­£å¦»çš„ä½“é¢ï¼Œä½†å® å¦¾å¿ƒæœ‰ä¸ç”˜ã€‚'; } },
                { text: 'ã€åè¢’å® å¦¾ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: 5}, relationship: {targetId: w.id, favor: -8}}); return 'ä½ å®‰æŠšäº†å® å¦¾ï¼Œä½†ä¸¥é‡æŸå®³äº†æ­£å¦»çš„å¨ä¸¥ã€‚'; } }
            ]
        },
        {
            id: 'kitchen_dispute',
            title: 'å°å¨æˆ¿ä¹‹äº‰',
            trigger: (concubine) => concubine.favor > 60 && concubine.jealousy > 40 && Math.random() < 0.3,
            description: (concubine) => `å—å® çš„å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> å‘ä½ æŠ±æ€¨ï¼Œè¯´å¨æˆ¿å…‹æ‰£äº†å¥¹é™¢é‡Œçš„ç‡•çªä»½ä¾‹ï¼Œè¨€è¯­é—´æš—ç¤ºæ˜¯åˆ«çš„å§å¦¹æé¬¼ã€‚`,
            options: [
                { text: 'ã€ä¸ºå¥¹å‡ºå¤´ï¼Œå½»æŸ¥å¨æˆ¿ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: 8}}); return `ä½ ä¸ºå¥¹å‡ºå¤´ï¼Œå½»æŸ¥äº†å¨æˆ¿ï¼Œ${c.name}å¯¹ä½ çš„ç»´æŠ¤å¾ˆæ˜¯å—ç”¨ã€‚`; } },
                { text: 'ã€è®¤ä¸ºæ˜¯å°äº‹ï¼Œä¸äºˆç†ä¼šã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -5}}); return 'ä½ è§‰å¾—è¿™æ˜¯å°é¢˜å¤§åšï¼Œå¥¹è®¤ä¸ºä½ ä¸é‡è§†å¥¹ã€‚'; } }
            ]
        },
        {
            id: 'blocking_meeting',
            title: 'é˜»æŒ é¢è§',
            trigger: (concubine, wife) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return otherConcubine && concubine.ambition > 60 && concubine.jealousy > 50 && Math.random() < 0.15;
            },
            description: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return `å¦¾å®¤ <strong class="highlight-npc">${otherConcubine.name}</strong> å‰æ¥æ±‚è§ï¼Œä½†è¢« <strong class="highlight-npc">${concubine.name}</strong> ä»¥â€œå¤«å›æ­£åœ¨ä¼‘æ¯â€ä¸ºç”±æ‹¦åœ¨äº†é—¨å¤–ã€‚`;
            },
            options: [
                { text: 'ã€èµæ‰¬å¥¹â€œæ‡‚äº‹â€ã€‘', action: (c) => { c.ambition += 5; return `ä½ èµæ‰¬äº†${c.name}ï¼Œå¥¹çš„é‡å¿ƒæœ‰æ‰€å¢é•¿ã€‚`; } },
                { text: 'ã€æ–¥è´£å¥¹è‡ªä½œä¸»å¼ ã€‘', action: (c) => { c.ambition -= 5; return `ä½ æ–¥è´£äº†${c.name}ï¼Œå¥¹çš„æ°”ç„°è¢«æš‚æ—¶å‹åˆ¶ã€‚`; } }
            ]
        },
        {
            id: 'gift_comparison',
            title: 'æ”€æ¯”ç¤¼ç‰©',
            trigger: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return otherConcubine && concubine.jealousy > 60 && Math.random() < 0.2;
            },
            description: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> ä¸ <strong class="highlight-npc">${otherConcubine.name}</strong> åœ¨èŠ±å›­ä¸­â€œå¶é‡â€ï¼Œè¨€è¯­é—´äº’ç›¸æ”€æ¯”ä½ é€ç»™å¥¹ä»¬çš„ç¤¼ç‰©ã€‚`;
            },
            options: [
                { text: 'ã€æ‰¿è¯ºé€æ›´è´µé‡çš„ç¤¼ç‰©ã€‘', action: () => { applyEffects({wealth: -1000}); return 'ä½ æ‰¿è¯ºä¼šé€ä¸Šæ›´è´µé‡çš„ç¤¼ç‰©ï¼Œæš‚æ—¶å¹³æ¯äº†é£æ³¢ï¼Œä½†èŠ±è´¹ä¸è²ã€‚'; } },
                { text: 'ã€å‡ºè¨€è­¦å‘Šã€‘', action: () => { gameState.marriage.familyHarmony -= 5; return 'ä½ è­¦å‘Šå¥¹ä»¬å®‰åˆ†å®ˆå·±ï¼Œä½†ä¸¤äººéƒ½ä¸æœæ°”ã€‚'; } }
            ]
        },
        {
            id: 'past_rumor',
            title: 'æ—§äº‹é‡æ',
            trigger: (concubine) => concubine.jealousy > 70 && concubine.personality.includes('è…¹é»‘') && Math.random() < 0.15,
            description: (concubine) => `åå®…çªç„¶å¼€å§‹æµä¼ ä¸€äº›å…³äºå® å¦¾ <strong class="highlight-npc">${concubine.name}</strong> åœ¨å…¥åºœå‰ä¸æŸä½ä¹¦ç”Ÿæœ‰æ—§æƒ…çš„æµè¨€ã€‚`,
            options: [
                { text: 'ã€ç›¸ä¿¡å¥¹ï¼Œå¹¶å®‰æŠšã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: 10}}); return `ä½ é€‰æ‹©ç›¸ä¿¡${c.name}ï¼Œå¥¹çš„çœ¼ä¸­æ»¡æ˜¯æ„Ÿæ¿€ã€‚`; } },
                { text: 'ã€å¿ƒç”ŸèŠ¥è’‚ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -10}}); return 'æµè¨€åœ¨ä½ å¿ƒä¸­ç§ä¸‹äº†æ€€ç–‘çš„ç§å­ã€‚'; } }
            ]
        },
         {
            id: 'mother_in_law_praise',
            title: 'å©†æ¯çš„å¤¸å¥–',
            trigger: (concubine, wife) => wife && wife.id && concubine.jealousy > 50 && Math.random() < 0.2,
            description: (concubine, wife) => `ä½ çš„æ¯äº²å½“ä¼—å¤¸å¥–äº†æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> è´¤è‰¯æ·‘å¾·ï¼Œä¸€æ—çš„å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> è„¸è‰²æœ‰äº›éš¾çœ‹ã€‚`,
            options: [
                { text: 'ã€å®‰æŠšå¦¾å®¤ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: 5}}); return `ä½ ç§ä¸‹å®‰æŠšäº†${c.name}å‡ å¥ï¼Œå¥¹å¿ƒæƒ…å¥½äº†äº›ã€‚`; } },
                { text: 'ã€ä¸äºˆç†ä¼šã€‘', action: () => 'è¿™æ˜¯å¦»å¦¾é—´å¸¸æœ‰çš„äº‹ï¼Œä½ å¹¶æœªæ”¾åœ¨å¿ƒä¸Šã€‚' }
            ]
        },
        {
            id: 'seeking_alliance',
            title: 'è¯·æ±‚ç»“ç›Ÿ',
            trigger: (concubine, wife) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead && oc.favor > 60);
                return otherConcubine && concubine.ambition > 50 && concubine.favor < 40 && Math.random() < 0.15;
            },
            description: (concubine) => {
                const favoredConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.favor > 60);
                return `å¤±å® çš„å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> ç§ä¸‹æ‰¾åˆ°ä½ ï¼Œå¸Œæœ›èƒ½ä¸ä½ è”æ‰‹ï¼Œä¸€åŒå¯¹ä»˜é£å¤´æ­£ç››çš„ <strong class="highlight-npc">${favoredConcubine.name}</strong>ã€‚`;
            },
            options: [
                { text: 'ã€åŒæ„è”æ‰‹ã€‘', action: (c) => { c.ambition += 10; return 'ä½ åŒæ„äº†ç»“ç›Ÿï¼Œåå®…çš„äº‰æ–—å°†æ›´åŠ å¤æ‚ã€‚'; } },
                { text: 'ã€æ‹’ç»å¹¶è­¦å‘Šã€‘', action: (c) => { return 'ä½ æ‹’ç»äº†å¥¹ï¼Œå¹¶è­¦å‘Šå¥¹ä¸è¦åŠ¨æ­ªå¿ƒæ€ã€‚'; } }
            ]
        },
        {
            id: 'pity_play',
            title: 'å–æƒ¨åšåŒæƒ…',
            trigger: (concubine) => concubine.favor < 30 && concubine.jealousy > 50 && Math.random() < 0.3,
            description: (concubine) => `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> åœ¨ä½ é¢å‰å“­è¯‰è‡ªå·±å‡ºèº«ä½å¾®ï¼Œåœ¨åºœä¸­å¤‡å—å†·è½ï¼Œè¨€è¯­é—´æ»¡æ˜¯å§”å±ˆã€‚`,
            options: [
                { text: 'ã€å¿ƒç”Ÿæ€œæ‚¯ï¼Œå¥½è¨€å®‰æ…°ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: 8}}); return 'ä½ çš„å®‰æ…°è®©å¥¹å¾ˆæ˜¯æ„ŸåŠ¨ã€‚'; } },
                { text: 'ã€èµèµè´¢ç‰©ã€‘', action: (c) => { applyEffects({wealth: -200, relationship: {targetId: c.id, favor: 5}}); return 'ä½ èµèµäº†å¥¹ä¸€äº›è´¢ç‰©ï¼Œæš‚æ—¶å®‰æŠšäº†å¥¹ã€‚'; } }
            ]
        },
        {
            id: 'showing_off_talent',
            title: 'å±•éœ²æ‰è‰º',
            trigger: (concubine) => concubine.personality.includes('æ´»æ³¼') && concubine.favor > 50 && Math.random() < 0.25,
            description: (concubine) => `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> åœ¨å®¶å®´ä¸Šä¸»åŠ¨çŒ®èˆä¸€æ›²ï¼Œèˆå§¿æ›¼å¦™ï¼Œå¼•å¾—æ»¡å ‚å–å½©ï¼Œä¹Ÿè®©å…¶ä»–å¦¾å®¤é»¯ç„¶å¤±è‰²ã€‚`,
            options: [
                { text: 'ã€å¤§åŠ èµèµã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: 10}}); return `ä½ çš„èµèµè®©${c.name}æ›´åŠ å¾—æ„ï¼Œä½†å…¶ä»–å¦¾å®¤çš„å«‰å¦’å€¼ä¹Ÿéšä¹‹ä¸Šå‡ã€‚`; } },
                { text: 'ã€å¹³æ·¡å›åº”ã€‘', action: () => 'ä½ åªæ˜¯å¹³æ·¡åœ°è¡¨ç¤ºä¸é”™ï¼Œæ²¡æœ‰è¿‡å¤šè¡¨ç¤ºã€‚' }
            ]
        },
        {
            id: 'accidental_offense',
            title: 'æ— å¿ƒä¹‹å¤±',
            trigger: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return otherConcubine && Math.random() < 0.2;
            },
            description: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> åœ¨é—²èŠæ—¶æ— æ„ä¸­è¯´é”™äº†è¯ï¼Œå†’çŠ¯äº† <strong class="highlight-npc">${otherConcubine.name}</strong> çš„å®¶äººï¼Œä¸¤äººèµ·äº†å£è§’ã€‚`;
            },
            options: [
                { text: 'ã€å‡ºé¢è°ƒè§£ã€‘', action: () => { gameState.marriage.familyHarmony += 2; return 'åœ¨ä½ çš„è°ƒè§£ä¸‹ï¼Œä¸¤äººäº’ç›¸é“æ­‰ï¼Œå¹³æ¯äº†é£æ³¢ã€‚'; } },
                { text: 'ã€ä»»å…¶äº‰åµã€‘', action: () => { gameState.marriage.familyHarmony -= 4; return 'ä½ æ²¡æœ‰æ’æ‰‹ï¼Œä¸¤äººçš„æ¢å­è¶Šç»“è¶Šæ·±ã€‚'; } }
            ]
        },
        {
            id: 'taking_credit_for_food',
            title: 'å†’é¢†ç¾¹æ±¤',
            trigger: (concubine, wife) => wife && concubine.ambition > 50 && Math.random() < 0.15,
            description: (concubine, wife) => `æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> äº²æ‰‹ä¸ºä½ ç‚–äº†è¡¥æ±¤ï¼Œå´è¢«å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> æŠ¢å…ˆä¸€æ­¥ç«¯åˆ°ä½ é¢å‰ï¼Œå¹¶æš—ç¤ºæ˜¯å¥¹æ‰€åšã€‚`,
            options: [
                { text: 'ã€ä¿¡ä»¥ä¸ºçœŸï¼Œç§°èµå¦¾å®¤ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: 5}, relationship: {targetId: w.id, favor: -10}}); return 'ä½ ç§°èµäº†å¦¾å®¤ï¼Œæ­£å¦»å¾—çŸ¥åååˆ†å§”å±ˆã€‚'; } },
                { text: 'ã€å¯Ÿè§‰ä¸å¯¹ï¼Œç‚¹ç ´æ­¤äº‹ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: -8}}); return `ä½ è®¤å‡ºè¿™æ˜¯æ­£å¦»çš„æ‰‹è‰ºï¼Œç‚¹ç ´äº†${c.name}çš„è°è¨€ï¼Œå¥¹ç¾æ„§éš¾å½“ã€‚`; } }
            ]
        },
        {
            id: 'using_children_to_gain_favor',
            title: 'åˆ©ç”¨å­å—£',
            trigger: (concubine) => {
                const child = gameState.children.find(c => c.motherId === concubine.id && !c.isDead);
                return child && concubine.ambition > 60 && Math.random() < 0.2;
            },
            description: (concubine) => `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> æœ€è¿‘æ€»è®©å¥¹çš„å­©å­æ¥ä½ ä¹¦æˆ¿ç©è€ï¼Œæ„å›¾é€šè¿‡å­©å­æ¥åšå–ä½ æ›´å¤šçš„å…³æ³¨ã€‚`,
            options: [
                { text: 'ã€å–œæ¬¢å­©å­ï¼Œç»å¸¸é™ªä¼´ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: 5}}); return 'ä½ å¾ˆå–œæ¬¢å­©å­ï¼Œç»å¸¸é™ªä¼´ï¼Œä¹Ÿè®©å…¶æ¯å‡­å­è´µã€‚'; } },
                { text: 'ã€è®¤ä¸ºå½±å“å…¬åŠ¡ï¼Œè®©å…¶ç¦»å¼€ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -3}}); return 'ä½ è®©å­©å­ç¦»å¼€ï¼Œä»¥å…æ‰“æ‰°å…¬åŠ¡ã€‚'; } }
            ]
        },
    ],
    // High-intensity scheming events
    scheming: [
        {
            id: 'poisoned_bird_nest_soup',
            title: 'ä¸€ç¢—ç‡•çª',
            trigger: (concubine, wife) => {
                return wife && wife.isPregnant && concubine.mood === 'jealous' && concubine.jealousy > 80 && Math.random() < 0.15;
            },
            description: (concubine, wife) => `ä½ æ€€å­•çš„æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> åœ¨å–ä¸‹å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> é€æ¥çš„ç‡•çªåï¼Œçªç„¶è…¹ç—›ä¸æ­¢ï¼å¤ªåŒ»è¯Šæ–­ä¸ºâ€œåŠ¨äº†èƒæ°”â€ï¼Œä½†ä¼¼ä¹å¦æœ‰éšæƒ…ã€‚`,
            options: [
                {
                    text: 'ã€å½»æŸ¥åˆ°åº•ï¼ã€‘',
                    action: (concubine, wife) => {
                        showEventCard('åå®…è°ƒæŸ¥', 'fa-search', 'ä½ ä¸‹ä»¤å½»æŸ¥æ­¤äº‹ï¼Œåºœä¸­é£å£°é¹¤å”³ã€‚');
                        const foundEvidence = Math.random() < (gameState.player.attributes.wisdom / 150);
                        if (foundEvidence) {
                            showEventCard('æ°´è½çŸ³å‡º', 'fa-gavel', `ä½ æ‰¾åˆ°äº†ç¡®å‡¿è¯æ®ï¼Œè¯æ˜æ˜¯${concubine.name}ä¸‹çš„æ‰‹ï¼ä½ å¯ä»¥å†³å®šå¦‚ä½•å¤„ç½®å¥¹ã€‚`);
                        } else {
                            showEventCard('è°ƒæŸ¥æ— æœ', 'fa-times', 'è°ƒæŸ¥é™·å…¥åƒµå±€ï¼Œæ²¡èƒ½æ‰¾åˆ°è¯æ®ã€‚');
                        }
                    }
                },
                {
                    text: 'ã€ä¸ºäº†å£°èª‰ï¼Œå‹ä¸‹æ­¤äº‹ã€‘',
                    action: (concubine, wife) => {
                        applyEffects({relationship: {targetId: wife.id, favor: -20}});
                        concubine.ambition = (concubine.ambition || 50) + 10;
                        showEventCard('æ¯äº‹å®äºº', 'fa-shield-alt', 'ä½ é€‰æ‹©å‹ä¸‹æ­¤äº‹ï¼Œæ­£å¦»å¯¹ä½ æ„Ÿåˆ°å¤±æœ›ï¼Œè€Œä¸‹æ¯’çš„å¦¾å®¤åˆ™æ›´åŠ æœ‰æƒ walangæã€‚');
                    }
                }
            ]
        },
        {
            id: 'stolen_item_frameup',
            title: 'æ ½èµƒé™·å®³',
            trigger: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead && oc.favor > concubine.favor);
                return otherConcubine && concubine.ambition > 70 && concubine.personality.includes('è…¹é»‘') && Math.random() < 0.1;
            },
            description: (concubine) => {
                const victim = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead && oc.favor > concubine.favor);
                return `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> å“­è¯‰è‡ªå·±ä¸€ä»¶è´µé‡çš„é¦–é¥°è¢«ç›—ï¼Œå¹¶æš—ç¤ºåœ¨ <strong class="highlight-npc">${victim.name}</strong> çš„æˆ¿ä¸­è§è¿‡ã€‚`;
            },
            options: [
                { text: 'ã€æœæŸ¥æˆ¿é—´ã€‘', action: (c) => { const v = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== c.id && !oc.isDead && oc.favor > c.favor); applyEffects({relationship: {targetId: v.id, favor: -15}}); return `ä½ åœ¨${v.name}æˆ¿ä¸­æœå‡ºäº†é¦–é¥°ï¼Œå¥¹ç™¾å£è«è¾©ï¼Œå«å†¤å—å±ˆã€‚`; } },
                { text: 'ã€ç›¸ä¿¡å® å¦¾ï¼Œä¸äºˆç†ä¼šã€‘', action: (c) => { const v = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== c.id && !oc.isDead && oc.favor > c.favor); applyEffects({relationship: {targetId: c.id, favor: -10}, relationship: {targetId: v.id, favor: 5}}); return 'ä½ é€‰æ‹©ç›¸ä¿¡æ›´å—å® çš„ä¸€æ–¹ï¼Œæ­¤äº‹ä¸äº†äº†ä¹‹ã€‚'; } }
            ]
        },
        {
            id: 'sowing_discord_with_wife',
            title: 'æŒ‘æ‹¨ç¦»é—´',
            trigger: (concubine, wife) => wife && concubine.ambition > 60 && concubine.personality.includes('è…¹é»‘') && Math.random() < 0.12,
            description: (concubine, wife) => `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> åœ¨ä½ é¢å‰â€œæ— æ„â€ä¸­æèµ·ï¼Œè¯´çœ‹åˆ°æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> ä¸å¨˜å®¶å…„å¼Ÿå¾€æ¥è¿‡äºå¯†åˆ‡ï¼Œä¼¼ä¹åœ¨è½¬ç§»åºœä¸­èµ„äº§ã€‚`,
            options: [
                { text: 'ã€æ€€ç–‘æ­£å¦»ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: w.id, favor: -15}}); w.suspicionValue = (w.suspicionValue || 0) + 20; return 'ä½ å¯¹æ­£å¦»äº§ç”Ÿäº†æ€€ç–‘ï¼Œå¤«å¦»å…³ç³»å‡ºç°è£‚ç—•ã€‚'; } },
                { text: 'ã€æ–¥è´£å¦¾å®¤ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: -10}}); return `ä½ æ–¥è´£${c.name}æ¬å¼„æ˜¯éï¼Œå¥¹å™¤è‹¥å¯’è‰ã€‚`; } }
            ]
        },
        {
            id: 'ruin_banquet',
            title: 'ç ´åå®¶å®´',
            trigger: (concubine, wife) => wife && concubine.jealousy > 70 && gameState.marriage.householdAuthorityHolder === 'wife' && Math.random() < 0.1,
            description: (concubine, wife) => `ç”±æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> æ“åŠçš„ä¸€åœºé‡è¦å®¶å®´ä¸Šï¼Œä¸€é“å…³é”®èœè‚´ç«Ÿå‡ºäº†é—®é¢˜ï¼ˆè¿‡å’¸/æœ‰å¼‚ç‰©ï¼‰ï¼Œè®©ä½ åœ¨å®¾å®¢é¢å‰å¤§å¤±é¢œé¢ã€‚å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> ä¼¼ä¹åœ¨æš—è‡ªçªƒå–œã€‚`,
            options: [
                { text: 'ã€è´£ç½šæ­£å¦»ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: w.id, favor: -10}}); gameState.family.reputation -= 5; return 'ä½ è´£ç½šäº†åŠäº‹ä¸åŠ›çš„æ­£å¦»ï¼Œå®¶æ—å£°æœ›å—æŸã€‚'; } },
                { text: 'ã€ç»´æŠ¤æ­£å¦»ï¼Œæš—ä¸­è°ƒæŸ¥ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: w.id, favor: 5}}); gameState.family.reputation -= 2; return 'ä½ ç»´æŠ¤äº†æ­£å¦»ï¼Œå¹¶å†³å®šæš—ä¸­è°ƒæŸ¥æ­¤äº‹æ˜¯å¦æœ‰äººæé¬¼ã€‚'; } }
            ]
        },
        {
            id: 'witchcraft_framing',
            title: 'å·«è›Šä¹‹ç¥¸',
            trigger: (concubine) => concubine.ambition > 80 && concubine.personality.includes('è…¹é»‘') && Math.random() < 0.05,
            description: (concubine) => `ä½ åœ¨è‡ªå·±çš„åºŠä¸‹ï¼Œå‘ç°äº†ä¸€ä¸ªå†™æœ‰ä½ ç”Ÿè¾°å…«å­—çš„å·«è›Šå¨ƒå¨ƒï¼Œä¸Šé¢æ‰æ»¡äº†é“¶é’ˆï¼è€Œè¿™å¨ƒå¨ƒçš„é’ˆæ³•ï¼Œä¸å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> çš„ç»£å“ç«Ÿæœ‰å‡ åˆ†ç›¸ä¼¼ã€‚`,
            options: [
                { text: 'ã€å‹ƒç„¶å¤§æ€’ï¼Œå°†å…¶èµæ­»ã€‘', action: (c) => { c.isDead = true; gameState.marriage.concubines = gameState.marriage.concubines.filter(id => id !== c.id); return `ä½ å‹ƒç„¶å¤§æ€’ï¼Œä¸‹ä»¤å°†${c.name}èµæ­»ã€‚æ— è®ºçœŸç›¸å¦‚ä½•ï¼Œåå®…éƒ½æ€èµ·äº†ä¸€åœºè¡€é›¨è…¥é£ã€‚`; } },
                { text: 'ã€æ‰“å…¥å†·å®«ï¼Œæ°¸ä¸ç›¸è§ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -100}}); c.isGrounded = true; c.groundedTurns = 999; return `ä½ å°†${c.name}æ‰“å…¥å†·å®«ï¼Œç»ˆèº«ç›‘ç¦ã€‚`; } }
            ]
        },
        {
            id: 'intercepting_letters',
            title: 'æˆªè·å¯†ä¿¡',
            trigger: (concubine, wife) => wife && concubine.ambition > 75 && Math.random() < 0.08,
            description: (concubine, wife) => `ä½ å‘ç°å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> ä¼¼ä¹åœ¨å·å·æˆªç•™æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> ä¸å¨˜å®¶çš„å¾€æ¥ä¿¡ä»¶ã€‚`,
            options: [
                { text: 'ã€å½“åœºæ­ç©¿ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -15}}); return `ä½ å½“åœºæ­ç©¿äº†${c.name}çš„è¡Œå¾„ï¼Œå¥¹ç™¾å£è«è¾©ã€‚`; } },
                { text: 'ã€ä»¥æ­¤ä¸ºæŠŠæŸ„ã€‘', action: (c) => { c.ambition -= 10; return `ä½ æŒæ¡äº†${c.name}çš„æŠŠæŸ„ï¼Œä»æ­¤å¥¹å¯¹ä½ è¨€å¬è®¡ä»ã€‚`; } }
            ]
        },
        {
            id: 'threatening_servant',
            title: 'å¨é€¼ä¸‹äºº',
            trigger: (concubine) => concubine.ambition > 65 && !concubine.personality.includes('å–„è‰¯') && Math.random() < 0.12,
            description: (concubine) => `ä¸€ä½ä¸‹äººå‘ä½ å“­è¯‰ï¼Œè¯´å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> å¨é€¼TAå»åšä¸€ä»¶ä¼¤å¤©å®³ç†ä¹‹äº‹ï¼ˆå¦‚ä½œä¼ªè¯ï¼‰ã€‚`,
            options: [
                { text: 'ã€ä¸ºä¸‹äººæ’‘è…°ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -10}}); return `ä½ ä¸ºä¸‹äººæ’‘è…°ï¼Œå¹¶è­¦å‘Šäº†${c.name}ã€‚`; } },
                { text: 'ã€ç‰ºç‰²ä¸‹äººï¼Œæ‹‰æ‹¢å¦¾å®¤ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: 5}, attributes: {virtue: -10}}); return `ä½ å°†ä¸‹äººäº¤ç”±${c.name}å¤„ç½®ï¼Œèµ¢å¾—äº†å¥¹çš„ä¿¡ä»»ï¼Œä½†å“å¾·å¤§æŸã€‚`; } }
            ]
        },
        {
            id: 'faking_miscarriage',
            title: 'ä¼ªé€ å°äº§',
            trigger: (concubine, wife) => {
                const otherPregnant = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead && oc.isPregnant);
                return wife && !concubine.isPregnant && otherPregnant && concubine.ambition > 85 && Math.random() < 0.07;
            },
            description: (concubine, wife) => {
                const pregnantOne = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.isPregnant);
                return `åœ¨ä¸€æ¬¡å£è§’åï¼Œå¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> çªç„¶â€œå°äº§â€ï¼Œå¹¶æŒ‡è®¤æ˜¯è¢«æ€€å­•çš„ <strong class="highlight-npc">${pregnantOne.name}</strong> æ¨å€’æ‰€è‡´ã€‚`;
            },
            options: [
                { text: 'ã€å½»æŸ¥æ­¤äº‹ã€‘', action: () => 'ä½ å†³å®šå½»æŸ¥æ­¤äº‹ï¼Œè¿˜æ— è¾œè€…æ¸…ç™½ã€‚' },
                { text: 'ã€å„æ‰“äº”åå¤§æ¿ã€‘', action: () => { gameState.marriage.familyHarmony -= 10; return 'ä½ çš„å’Œç¨€æ³¥è®©åŒæ–¹éƒ½ä¸æ»¡æ„ï¼Œåå®…çŸ›ç›¾æ¿€åŒ–ã€‚'; } }
            ]
        },
        {
            id: 'spreading_rumors_outside',
            title: 'å¤–æ‰¬å®¶ä¸‘',
            trigger: (concubine, wife) => wife && concubine.favor < 20 && concubine.jealousy > 80 && Math.random() < 0.1,
            description: (concubine, wife) => `ä½ å¬é—»å¤–é¢å¼€å§‹æµä¼ ä¸€äº›å…³äºä½ å®¶å®…ä¸å®ã€å® å¦¾ç­å¦»çš„è°£è¨€ï¼Œä¼¼ä¹æ˜¯ <strong class="highlight-npc">${concubine.name}</strong> åœ¨èƒŒåæ£é¬¼ã€‚`,
            options: [
                { text: 'ã€ç¦è¶³å¹¶ç½šä¿¸ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -15}}); gameState.family.reputation -= 5; return `ä½ ä¸¥æƒ©äº†${c.name}ï¼Œä½†å®¶æ—å£°æœ›å·²ç„¶å—æŸã€‚`; } },
                { text: 'ã€è®©å¥¹è‡ªè¡Œæ¾„æ¸…ã€‘', action: (c) => { gameState.family.reputation -= 8; return 'ä½ è®©å¥¹è‡ªå·±å»æ¾„æ¸…ï¼Œç»“æœè¶Šæè¶Šé»‘ã€‚'; } }
            ]
        },
        {
            id: 'financial_sabotage',
            title: 'é‡œåº•æŠ½è–ª',
            trigger: (concubine, wife) => wife && concubine.ambition > 70 && gameState.marriage.householdAuthorityHolder === 'wife' && Math.random() < 0.1,
            description: (concubine, wife) => `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> ä¼¼ä¹åœ¨æš—ä¸­ç ´åç”±æ­£å¦» <strong class="highlight-npc">${wife.name}</strong> ç®¡ç†çš„è´¦ç›®ï¼Œæ„å›¾è®©å¥¹åœ¨å¹´åº•æ ¸ç®—æ—¶å‡ºé”™ã€‚`,
            options: [
                { text: 'ã€æé†’æ­£å¦»ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: w.id, favor: 5}}); return 'ä½ æé†’äº†æ­£å¦»ï¼Œè®©å¥¹æœ‰æ‰€é˜²å¤‡ã€‚'; } },
                { text: 'ã€å°†è®¡å°±è®¡ã€‘', action: (c, w) => { return 'ä½ å†³å®šå°†è®¡å°±è®¡ï¼Œçœ‹çœ‹å¥¹ä»¬èƒ½é—¹å‡ºä»€ä¹ˆèŠ±æ ·ã€‚'; } }
            ]
        },
        {
            id: 'stealing_heir_affection',
            title: 'è®¨å¥½å«¡å­',
            trigger: (concubine, wife) => {
                const heir = wife ? gameState.children.find(c => c.motherId === wife.id && !c.isDead) : null;
                return heir && concubine.ambition > 60 && Math.random() < 0.18;
            },
            description: (concubine, wife) => `ä½ å‘ç°å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> æœ€è¿‘æ€»æ˜¯æœ‰æ„æ— æ„åœ°è®¨å¥½ä½ çš„å«¡å­ï¼Œä¼¼ä¹æƒ³ç¦»é—´ä»–ä»¬æ¯å­å…³ç³»ã€‚`,
            options: [
                { text: 'ã€ç¦æ­¢å¥¹æ¥è§¦å«¡å­ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: c.id, favor: -8}}); return 'ä½ çš„ç¦ä»¤è®©å…¶æœ‰æ‰€æ”¶æ•›ã€‚'; } },
                { text: 'ã€æé†’æ­£å¦»å¤šåŠ ç•™æ„ã€‘', action: (c, w) => { applyEffects({relationship: {targetId: w.id, favor: 3}}); return 'ä½ æé†’äº†æ­£å¦»ï¼Œè®©å¥¹å¤šåŠ ç•™æ„ã€‚'; } }
            ]
        },
        {
            id: 'revealing_past_secret',
            title: 'æ­éœ²æ—§äº‹',
            trigger: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return otherConcubine && concubine.personality.includes('è…¹é»‘') && Math.random() < 0.1;
            },
            description: (concubine) => {
                const victim = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return `å¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> åœ¨å®¶å®´ä¸Šâ€œæ— æ„â€ä¸­è¯´æ¼å˜´ï¼Œæ­éœ²äº† <strong class="highlight-npc">${victim.name}</strong> å…¥åºœå‰çš„ä¸€ä»¶ç³—äº‹ï¼Œè®©å¥¹å½“ä¼—éš¾å ªã€‚`;
            },
            options: [
                { text: 'ã€æ–¥è´£æ­äººéšç§è€…ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -10}}); return `ä½ æ–¥è´£äº†${c.name}ï¼Œç»´æŠ¤äº†åå®…çš„ä½“é¢ã€‚`; } },
                { text: 'ã€å®‰æŠšå—å®³è€…ã€‘', action: (c) => { const v = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== c.id && !oc.isDead); applyEffects({relationship: {targetId: v.id, favor: 5}}); return `ä½ å®‰æŠšäº†${v.name}ï¼Œè®©å¥¹æ„Ÿåˆ°ä¸€ä¸æ¸©æš–ã€‚`; } }
            ]
        },
        {
            id: 'poisoning_pet',
            title: 'æ¯’å®³å® ç‰©',
            trigger: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead && oc.favor > concubine.favor);
                return otherConcubine && concubine.jealousy > 85 && !concubine.personality.includes('å–„è‰¯') && Math.random() < 0.08;
            },
            description: (concubine) => {
                const victim = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead && oc.favor > concubine.favor);
                return `å—å® çš„å¦¾å®¤ <strong class="highlight-npc">${victim.name}</strong> å…»çš„çˆ±å® çªç„¶æš´æ¯™ï¼Œç§ç§è¿¹è±¡éƒ½æŒ‡å‘äº†å«‰å¦’å·²ä¹…çš„ <strong class="highlight-npc">${concubine.name}</strong>ã€‚`;
            },
            options: [
                { text: 'ã€ä¸¥æƒ©å‡¶æ‰‹ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -20}}); return `ä½ ä¸¥æƒ©äº†${c.name}ï¼Œä¸º${gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== c.id && !oc.isDead && oc.favor > c.favor).name}è®¨å›äº†å…¬é“ã€‚`; } },
                { text: 'ã€è¯æ®ä¸è¶³ï¼Œæ— æ³•å®šè®ºã€‘', action: () => 'ä½ å› è¯æ®ä¸è¶³ï¼Œæ— æ³•å¤„ç½®ï¼Œæ­¤äº‹æˆäº†ä¸€æ¡©æ‚¬æ¡ˆã€‚' }
            ]
        },
        {
            id: 'isolating_concubine',
            title: 'å­¤ç«‹æ— æ´',
            trigger: (concubine) => {
                const otherConcubine = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead);
                return otherConcubine && concubine.ambition > 60 && Math.random() < 0.12;
            },
            description: (concubine) => {
                const victim = gameState.marriage.concubines.map(id => gameState.npcs[id]).find(oc => oc && oc.id !== concubine.id && !oc.isDead && oc.favor < 30);
                return `ä½ å‘ç° <strong class="highlight-npc">${concubine.name}</strong> æ­£åœ¨è”åˆå…¶ä»–å¦¾å®¤ï¼Œå­¤ç«‹ä¸å—å® çš„ <strong class="highlight-npc">${victim.name}</strong>ã€‚`;
            },
            options: [
                { text: 'ã€å‡ºé¢åˆ¶æ­¢ã€‘', action: (c) => { gameState.marriage.familyHarmony += 5; return 'ä½ å‡ºé¢åˆ¶æ­¢äº†è¿™ç§è¡Œä¸ºï¼Œç»´æŠ¤äº†åå®…çš„ç§©åºã€‚'; } },
                { text: 'ã€é™è§‚å…¶å˜ã€‘', action: () => 'ä½ é€‰æ‹©é™è§‚å…¶å˜ï¼Œä»»ç”±å¥¹ä»¬äº‰æ–—ã€‚' }
            ]
        },
        {
            id: 'bribing_your_servant',
            title: 'æ”¶ä¹°å¿ƒè…¹',
            trigger: (concubine) => concubine.ambition > 70 && Math.random() < 0.08,
            description: (concubine) => `ä½ çš„å¿ƒè…¹ä¸«é¬Ÿå‘ä½ å¦ç™½ï¼Œå¦¾å®¤ <strong class="highlight-npc">${concubine.name}</strong> è¯•å›¾ç”¨é‡é‡‘æ”¶ä¹°å¥¹ï¼Œè®©å¥¹ç›‘è§†ä½ çš„ä¸€ä¸¾ä¸€åŠ¨ã€‚`,
            options: [
                { text: 'ã€å°†è®¡å°±è®¡ï¼Œä¼ é€’å‡æ¶ˆæ¯ã€‘', action: (c) => { c.ambition -= 5; return 'ä½ å†³å®šå°†è®¡å°±è®¡ï¼Œé€šè¿‡ä¸«é¬Ÿå‘å¥¹ä¼ é€’ä¸€äº›å‡æ¶ˆæ¯ã€‚'; } },
                { text: 'ã€æ•²æ‰“è¯¥å¦¾å®¤ã€‘', action: (c) => { applyEffects({relationship: {targetId: c.id, favor: -10}}); return `ä½ æ•²æ‰“äº†${c.name}ä¸€ç•ªï¼Œå¥¹å“å¾—ä¸è½»ã€‚`; } }
            ]
        }
    ]
};
function triggerPunishment_Male(gs, type) {
    const wife = gs.npcs[gs.marriage.spouseId];
    if (type === 'ç¼´çº³å®‰æŠšè´¹') {
        const fee = Math.floor((gs.finances.wealth + gs.family.moneyChest) * 0.3);
        applyEffects({ wealth: -fee });
        gs.marriage.householdAuthorityHolder = 'wife'; // äº¤å‡ºæŒå®¶æƒ
        // æ·»åŠ debuff
        if(!gs.player.debuffs) gs.player.debuffs = {};
        gs.player.debuffs['wife_supervision'] = { description: 'å¦»æ—çš„ç›‘è§†ï¼Œæœªæ¥å‡ºè½¨è´¥éœ²é£é™©å¢åŠ 20%' };
        showEventCard('é£æµçš„ä»£ä»·', 'fa-money-bill-wave', `ä½ æ”¯ä»˜äº† ${fee} ä¸¤ä½œä¸ºâ€œå®‰æŠšè´¹â€ï¼Œå¹¶äº¤å‡ºäº†æŒå®¶æƒã€‚`);
        // ä¸æƒ…äººæ–­ç»å…³ç³»
        gs.social.secretLovers = [];

    } else if (type === 'å’Œç¦»') {
        const propertyLoss = Math.floor(gs.family.moneyChest * 0.5) + Math.floor(gs.player.privateAssets * 0.3);
        applyEffects({ wealth: -propertyLoss });
        gs.family.reputation = Math.floor(gs.family.reputation * 0.5);
        gs.player.attributes.reputation = 0;
        
        // æ ¸å¿ƒè°ƒæ•´ï¼šå²³å®¶ä¹‹æ€’
        if((wife.attributes.family || 50) >= (gs.family.reputation / 2)){
             gs.career.path = null; // äº‹ä¸šçº¿è¢«æ‘§æ¯
             showEventCard('å²³å®¶ä¹‹æ€’', 'fa-gavel', `ä½ çš„å‰å¦»å®¶æ—å¯¹ä½ è¿›è¡Œç–¯ç‹‚æŠ¥å¤ï¼Œä½ çš„äº‹ä¸šè¢«å½»åº•æ‘§æ¯ï¼`);
        }
        
        // å­å¥³æŠšå…»æƒ
        gs.children = gs.children.filter(c => c.motherId !== wife.id);
        
        showEventCard('å’Œç¦»', 'fa-heart-broken', `ä½ ä¸${wife.name}å’Œç¦»ï¼ŒæŸå¤±äº†å¤§é‡å®¶äº§ï¼Œå£°æœ›å¤§è·Œã€‚`);
        gameState.marriage.isMarried = false;
        gameState.marriage.spouseId = null;
    }
}

/**
 * è§¦å‘å¥³æ€§ç©å®¶å®…æ–—æƒ©ç½šçš„å‡½æ•°
 * @param {object} gs - gameState
 * @param {string} type - 'ä¼‘å¼ƒ' æˆ– 'èµæ­»'
 */
function triggerPunishment_Female(gs, type) {
    const husband = gs.npcs[gs.marriage.spouseId];
    if (type === 'ä¼‘å¼ƒ') {
        showEventCard('ä¸€çº¸ä¼‘ä¹¦', 'fa-file-signature', 'ä½ è¢«å‡€èº«å‡ºæˆ·ï¼Œå¤±å»æ‰€æœ‰å­å¥³ï¼Œå£°æœ›å°½æ¯ï¼Œä½†æ€»ç®—ä¿ä½äº†æ€§å‘½ã€‚');
        // ç©å®¶æ¸¸æˆçŠ¶æ€å¯ä»¥å˜ä¸ºâ€œå¼ƒå¦‡â€ï¼Œå¼€å¯æ–°çš„ç”Ÿå­˜çº¿
        gs.flags.playerStatus = 'divorced';
    } else if (type === 'èµæ­»') {
        showEndGame({ title: "çº¢é¢œè–„å‘½", text: `ä½ å› â€œä¸è´â€è¢«å¤«å®¶èµæ­»ï¼Œå¹´ä»…${Math.floor(gs.player.age)}å²ã€‚` });
    }
    // æ¸…ç†å©šå§»çŠ¶æ€
    gameState.marriage.isMarried = false;
    gameState.marriage.spouseId = null;
    gameState.children = gs.children.filter(c => c.fatherId !== husband.id);
}

// ä¸€ä¸ªé€šç”¨çš„æˆåŠŸç‡åˆ¤å®šå‡½æ•°
function checkSuccess(attributeValue, difficulty) {
    const successRate = Math.min(0.95, Math.max(0.05, (attributeValue / difficulty)));
    return Math.random() < successRate;
}
function triggerInnerCourtEvent() {
    // å¦‚æœæœªå©šï¼Œåˆ™ä¸è§¦å‘
    if ((!gameState.marriage.isMarried && gameState.marriage.concubines.length === 0)) return;
    
    // éšæœºæ€§ï¼Œä¸æ˜¯æ¯å›åˆéƒ½è§¦å‘
    if (Math.random() > 0.4) return; // æ¯å›åˆ40%å‡ ç‡æ£€å®šä¸€æ¬¡

    const struggles = INNER_COURT_STRUGGLES[gameState.player.gender];
    if (!struggles) return;
    
    // è·å–é…å¶å¯¹è±¡
    const spouse = gameState.npcs[gameState.marriage.spouseId];
    if(!spouse && gameState.player.gender === 'female') return; // å¥³æ€§ç©å®¶å¿…é¡»æœ‰ä¸ˆå¤«æ‰èƒ½è§¦å‘å®…æ–—

    // å¯»æ‰¾æ‰€æœ‰å¯èƒ½è§¦å‘çš„äº‹ä»¶
    const possibleEvents = Object.values(struggles).filter(event => 
        event.trigger && event.trigger(gameState)
    );

    if (possibleEvents.length > 0) {
        // éšæœºé€‰æ‹©ä¸€ä¸ªè§¦å‘
        const eventToTrigger = getRandomElement(possibleEvents);
        
        // [ä¿®å¤æ ¸å¿ƒ] ä½¿ç”¨ .trigger() è€Œä¸æ˜¯ .generate() æ¥è·å–äº‹ä»¶å®ä¾‹
        const eventInstance = eventToTrigger.trigger(gameState);
        if (!eventInstance) return; // å¦‚æœtriggerè¿”å›falseï¼Œåˆ™ä¸ç»§ç»­

        const options = eventToTrigger.options.map(opt => ({
            htmlContent: `<span class="option-text">${opt.text}</span>`,
            disabled: opt.req && (
                (opt.req.hasAuthority && gameState.marriage.householdAuthorityHolder !== 'player') ||
                !Object.entries(opt.req).every(([key, val]) => {
                    if (key === 'favor_gt') return spouse.favor > val;
                    // å…¼å®¹å¤šç§å±æ€§æ£€æŸ¥
                    return (gameState.player.attributes[key] || gameState.player[key] || 0) >= val;
                })
            ),
            callback: () => {
                // actionç°åœ¨åº”è¯¥åªè¿”å›ä¸€ä¸ªç»“æœå­—ç¬¦ä¸²
                const resultLog = opt.action(eventInstance.involved);
                // å¦‚æœä¸æ˜¯æœ€ç»ˆå®¡åˆ¤äº‹ä»¶ï¼Œåˆ™æ˜¾ç¤ºæ™®é€šç»“æœ
                if (!eventToTrigger.isFinal) { 
                    showEventCard(eventToTrigger.title, 'fa-theater-masks', resultLog);
                }
            }
        }));
        
        // æ¨å…¥äº‹ä»¶é˜Ÿåˆ—ï¼Œé˜²æ­¢å¼¹çª—å†²çª
        eventQueue.push(() => {
            showDecisionCard(eventToTrigger.title, 'fa-theater-masks', eventInstance.description, options);
        });
    }
}
// =======================================================================
// ===================== ã€æ–°å¢ã€‘å¥³æ€§è§†è§’å¤«å›äº’åŠ¨ç³»ç»Ÿæ ¸å¿ƒæ•°æ® ==============
// =======================================================================
// ===================== ã€æ–°å¢ã€‘èŒä¸šåç§°è½¬æ¢å·¥å…· =====================
const CAREER_CHINESE_TO_ENGLISH_MAP = {};
for (const gender in careerPaths) {
    for (const key in careerPaths[gender]) {
        const careerInfo = careerPaths[gender][key];
        CAREER_CHINESE_TO_ENGLISH_MAP[careerInfo.name] = key;
    }
}
// ===================== ã€ç¬¬ä¸€æ­¥(1/2)ï¼šæ›¿æ¢æ­¤å¯¹è±¡ã€‘è¡¥å……é…å¶å…³ç³»ç­‰çº§åç§° =====================
const RELATIONSHIP_DATA = {
'spouse': {
        name: 'é…å¶', type: 'spouse', genderScope: 'opposite',
        levelNames: ['ç›¸æ•¬å¦‚å®¾', 'ç´ç‘Ÿå’Œé¸£', 'æƒ…æ·±æ„ç¬ƒ', 'æ¯”ç¿¼è¿æ', 'ç¥ä»™çœ·ä¾£'], // [æ–°å¢]
        interactions: [] // äº’åŠ¨ç”±ä¸“é—¨çš„å©šå§»/åºœé‚¸æ ‡ç­¾é¡µå¤„ç†
    },
    'concubine': {
        name: 'å¦¾å®¤', type: 'romance', genderScope: 'opposite',
        levelNames: ['ä¾å¦¾', 'è‰¯å¨£', 'è´µå«”', 'ä¾§å¦ƒ', 'è´µå¦ƒ'],
        interactions: [] // äº’åŠ¨ç”±ä¸“é—¨çš„å©šå§»/åºœé‚¸æ ‡ç­¾é¡µå¤„ç†
    },
    'family': {
        name: 'å®¶äºº', type: 'friendship', genderScope: 'any',
        levelNames: ['å®¶äºº'], // å®¶äººå…³ç³»ç­‰çº§é€šå¸¸æ˜¯å›ºå®šçš„
        interactions: []
    },
    // ==================== å‹è°Šå…³ç³» (Friendship) ====================
    'red_confidante': { // ç”·æ€§ç©å®¶çš„å¼‚æ€§çŸ¥å·±
        name: 'çº¢é¢œçŸ¥å·±', type: 'friendship', genderScope: 'opposite',
        levelNames: ['èæ°´ç›¸é€¢', 'æ„æ°”ç›¸æŠ•', 'æƒºæƒºç›¸æƒœ', 'çº¢é¢œçŸ¥å·±', 'æ­¤ç”ŸæŒšå‹'],
        interactions: [
            { id: 'moon_drink', name: 'æœˆä¸‹å¯¹é¥®', min_favor: 60, min_level: 2 },
            { id: 'receive_gift', name: 'æ„å¤–èµ ç¤¼', min_favor: 65, min_level: 2 },
            { id: 'be_rescued', name: 'ä¸ºå›è§£å›´', min_favor: 70, min_level: 3 },
            { id: 'become_lover', name: 'è½¬ä¸ºæƒ…äºº', min_favor: 80, min_level: 3 }
        ]
    },
    'blue_confidante': { // å¥³æ€§ç©å®¶çš„å¼‚æ€§çŸ¥å·±
        name: 'è“é¢œçŸ¥å·±', type: 'friendship', genderScope: 'opposite',
        levelNames: ['èæ°´ç›¸é€¢', 'æ„æ°”ç›¸æŠ•', 'æƒºæƒºç›¸æƒœ', 'è“é¢œçŸ¥å·±', 'æ­¤ç”ŸæŒšå‹'],
        interactions: [
            { id: 'moon_drink', name: 'æœˆä¸‹å¯¹é¥®', min_favor: 60, min_level: 2 },
            { id: 'receive_gift', name: 'æ„å¤–èµ ç¤¼', min_favor: 65, min_level: 2 },
            { id: 'be_rescued', name: 'ä¸ºå›è§£å›´', min_favor: 70, min_level: 3 },
            { id: 'become_lover', name: 'è½¬ä¸ºæƒ…äºº', min_favor: 80, min_level: 3 }
        ]
    },
    'brother': { // å…„å¼Ÿ/åŒè¢
        name: 'å…„å¼ŸåŒè¢', type: 'friendship', genderScope: 'same',
        levelNames: ['ç‚¹å¤´ä¹‹äº¤', 'åŒåƒš', 'æˆ˜å‹', 'å¿ƒè…¹', 'ç”Ÿæ­»ä¹‹äº¤'],
        interactions: [
            { id: 'fight_together', name: 'å¹¶è‚©ä½œæˆ˜', min_favor: 60, min_level: 2 }
        ]
    },
     'confidante': { // é—ºèœœ
        name: 'é—ºä¸­å¯†å‹', type: 'friendship', genderScope: 'same',
        levelNames: ['åˆè¯†', 'æ‰‹å¸•äº¤', 'çŸ¥å·±', 'é—ºä¸­å¯†å‹', 'ä¸€ç”Ÿä¹‹äº¤'],
        interactions: [
            { id: 'share_secret', name: 'åˆ†äº«å¿ƒäº‹', min_favor: 60, min_level: 2 }
        ]
    },

    // ==================== æ‹çˆ±å…³ç³» (Romance) ====================
    'lover': {
        name: 'ç§˜å¯†æƒ…äºº', type: 'romance', genderScope: 'any',
        levelNames: ['åˆè¯†æƒ…æ„«', 'æƒ…æ„æ¸æµ“', 'é±¼æ°´ä¹‹æ¬¢', 'éš¾èˆéš¾åˆ†', 'åˆ»éª¨é“­å¿ƒ'],
        interactions: [
            { id: 'rendezvous', name: 'ç§ä¼šé‚€çº¦', min_favor: 40, min_level: 2 },
            { id: 'jealousy', name: 'äº‰é£åƒé†‹', min_favor: 60, min_level: 3 },
            { id: 'propose_elopement', name: 'è¯·æ±‚ç§å¥”', min_favor: 90, min_level: 4 },
        ]
    },

    // ==================== ç‰¹æ®Šå…³ç³» (Special) ====================
    'sworn_sibling': {
        name: 'ä¹‰ç»“é‡‘å…°', type: 'special', genderScope: 'same',
        levelNames: ['ä¹‰ç»“é‡‘å…°'], // ç­‰çº§å›ºå®š
        interactions: [
            { id: 'teach_skill', name: 'ä¼ æˆæŠ€èƒ½', min_favor: 80 },
            { id: 'overcome_difficulty', name: 'å…±æ¸¡éš¾å…³', min_favor: 70 }
        ]
    },
    'master': {
        name: 'å¸ˆçˆ¶',
        type: 'special',
        genderScope: 'any',
        levelNames: ['å¸ˆå¾’'], // ç­‰çº§å›ºå®š
        interactions: [
             { id: 'teach_skill', name: 'ä¼ æˆæŠ€èƒ½', desc: 'å¸ˆçˆ¶æ¬²ä¼ æˆä½ ç‹¬é—¨æŠ€è‰ºã€‚', min_favor: 80 }
        ]
    },
    'former_apprentice': { 
        name: 'å‡ºå¸ˆå¼Ÿå­',
        type: 'special',
        genderScope: 'any',
        levelNames: ['å¸ˆå¾’æƒ…æ·±'],
        interactions: [
             { id: 'ask_help', name: 'å¯»æ±‚å¸®åŠ©', min_favor: 60, min_level: 0 }
        ]
    }
};

const RELATIONSHIP_LEVELS = {
    friendship: [ // çŸ¥å·±ã€åŒè¢ç­‰
        { level: 0, name: 'åˆè¯†', threshold: 0 },
        { level: 1, name: 'ç†Ÿæ‚‰', threshold: 50 },
        { level: 2, name: 'å‹å¥½', threshold: 120 },
        { level: 3, name: 'äº²å¯†', threshold: 250 },
        { level: 4, name: 'æŒšå‹', threshold: 500 }
    ],
    romance: [ // æƒ…äºº
        { level: 0, name: 'åˆè¯†', threshold: 0 },
        { level: 1, name: 'æš§æ˜§', threshold: 60 },
        { level: 2, name: 'äº²å¯†', threshold: 150 },
        { level: 3, name: 'çƒ­æ‹', threshold: 300 },
        { level: 4, name: 'æŒšçˆ±', threshold: 600 }
    ],
    spouse: [ // å¤«å¦»
        { level: 0, name: 'ç›¸æ•¬å¦‚å®¾', threshold: 0 },
        { level: 1, name: 'ç´ç‘Ÿå’Œé¸£', threshold: 80 },
        { level: 2, name: 'æƒ…æ·±æ„ç¬ƒ', threshold: 200 },
        { level: 3, name: 'æ¯”ç¿¼è¿æ', threshold: 400 },
        { level: 4, name: 'ç¥ä»™çœ·ä¾£', threshold: 700 }
    ]
};
const LOVER_DATA = {
    interactions: [
        { id: 'choose_date_location', name: 'ç§å¯†çº¦ä¼š', icon: 'fa-calendar-check', min_favor: 20 },
        { id: 'secret_lover', name: 'é‡‘å±‹è—å¨‡', icon: 'fa-home', min_favor: 70, gender: 'male' },
        { id: 'take_as_concubine', name: 'çº³ä¸ºå¦¾å®¤', icon: 'fa-user-plus', min_favor: 80, gender: 'male' },
        { id: 'propose_marriage', name: 'æ±‚å¨¶ä¸ºå¦»', icon: 'fa-ring', min_favor: 90, gender: 'male' }
    ],
    dateLocations: [
        { name: 'æ¹–å¿ƒäº­', events: ['moon_drink'] },
        { name: 'ç”»èˆ«', events: ['boat_serenade'] }
    ]
};
const TRADING_GOODS_DATA = {
    // ä¸œå¸‚å•†ä¼š
    'silk': { name: 'æ±Ÿå—ä¸ç»¸', guild: 'east', type: 'å¥¢ä¾ˆå“', basePrice: 100, fluctuation: 0.25 },
    'porcelain': { name: 'æ™¯å¾·ç“·å™¨', guild: 'east', type: 'å·¥è‰ºå“', basePrice: 80, fluctuation: 0.20 },
    'tea_longjing': { name: 'é¾™äº•æ–°èŒ¶', guild: 'east', type: 'é¥®å“', basePrice: 70, fluctuation: 0.15, perishable: 2 }, // perishable: 2å¹´ä¿è´¨æœŸ
    'stationery': { name: 'æ–‡æˆ¿å››å®', guild: 'east', type: 'æ–‡åŒ–å“', basePrice: 140, fluctuation: 0.10 },
    'embroidery_su': { name: 'è‹ç»£ç²¾å“', guild: 'east', type: 'å¥¢ä¾ˆå“', basePrice: 200, fluctuation: 0.30 },
    'brocade_hang': { name: 'æ­é”¦', guild: 'east', type: 'çººç»‡å“', basePrice: 95, fluctuation: 0.18 },
    'bamboo_craft': { name: 'ç«¹åˆ¶å·¥è‰ºå“', guild: 'east', type: 'å·¥è‰ºå“', basePrice: 45, fluctuation: 0.12 },
    'wine_shaoxing': { name: 'ç»å…´é»„é…’', guild: 'east', type: 'é¥®å“', basePrice: 60, fluctuation: 0.15, perishable: 3 },
    // è¥¿å¸‚å•†ä¼š
    'jade_hetian': { name: 'å’Œç”°ç¾ç‰', guild: 'west', type: 'å¥¢ä¾ˆå“', basePrice: 300, fluctuation: 0.35 },
    'carpet_persian': { name: 'æ³¢æ–¯åœ°æ¯¯', guild: 'west', type: 'å¥¢ä¾ˆå“', basePrice: 250, fluctuation: 0.30 },
    'wine_xiyu': { name: 'è¥¿åŸŸè‘¡è„é…’', guild: 'west', type: 'é¥®å“', basePrice: 90, fluctuation: 0.20, perishable: 5 },
    'horse_turkic': { name: 'çªå¥éªé©¬', guild: 'west', type: 'åéª‘', basePrice: 400, fluctuation: 0.40 },
    'lotus_tian': { name: 'å¤©å±±é›ªè²', guild: 'west', type: 'è¯æ', basePrice: 180, fluctuation: 0.25, perishable: 4 },
    'spice_hu': { name: 'èƒ¡äººé¦™æ–™', guild: 'west', type: 'è°ƒæ–™', basePrice: 120, fluctuation: 0.22, perishable: 2 },
    'glass_dashi': { name: 'å¤§é£Ÿç‰ç’ƒ', guild: 'west', type: 'å·¥è‰ºå“', basePrice: 150, fluctuation: 0.28 },
    'yak_wool': { name: 'åè•ƒç‰¦ç‰›æ¯›', guild: 'west', type: 'çººç»‡å“', basePrice: 110, fluctuation: 0.15 },
    // å—æ´‹å•†ä¼š
    'pearl_donghai': { name: 'ä¸œæµ·çç ', guild: 'south', type: 'å¥¢ä¾ˆå“', basePrice: 220, fluctuation: 0.35 },
    'coral': { name: 'çŠç‘šé¥°å“', guild: 'south', type: 'å·¥è‰ºå“', basePrice: 190, fluctuation: 0.30 },
    'spice_nanyang': { name: 'å—æ´‹é¦™æ–™', guild: 'south', type: 'è°ƒæ–™', basePrice: 130, fluctuation: 0.25, perishable: 2 },
    'ivory_carving': { name: 'è±¡ç‰™é›•åˆ»', guild: 'south', type: 'å¥¢ä¾ˆå“', basePrice: 280, fluctuation: 0.40 },
    'rhino_horn_cup': { name: 'çŠ€è§’æ¯', guild: 'south', type: 'è¯æ', basePrice: 200, fluctuation: 0.30, perishable: 10 },
    'coconut_oil': { name: 'æ¤°å­æ²¹', guild: 'south', type: 'é£Ÿå“', basePrice: 70, fluctuation: 0.15, perishable: 1 },
    'hardwood': { name: 'çƒ­å¸¦ç¡¬æœ¨', guild: 'south', type: 'ææ–™', basePrice: 85, fluctuation: 0.20 },
    'pearl_shell': { name: 'çç è´', guild: 'south', type: 'ææ–™', basePrice: 65, fluctuation: 0.18 },
    // å¡åŒ—å•†ä¼š
    'horse_saibei': { name: 'å¡åŒ—è‰¯é©¬', guild: 'north', type: 'åéª‘', basePrice: 350, fluctuation: 0.35 },
    'fur_coat': { name: 'è²‚çš®å¤§è¡£', guild: 'north', type: 'å¥¢ä¾ˆå“', basePrice: 240, fluctuation: 0.30 },
    'ginseng_changbai': { name: 'é•¿ç™½äººå‚', guild: 'north', type: 'è¯æ', basePrice: 170, fluctuation: 0.25, perishable: 5 },
    'deer_antler': { name: 'é¹¿èŒ¸', guild: 'north', type: 'è¯æ', basePrice: 160, fluctuation: 0.25, perishable: 5 },
    'cheese': { name: 'è‰åŸå¥¶é…ª', guild: 'north', type: 'é£Ÿå“', basePrice: 60, fluctuation: 0.20, perishable: 1 },
    'yurt': { name: 'æ¯¡å¸', guild: 'north', type: 'ç”Ÿæ´»å“', basePrice: 120, fluctuation: 0.15 },
    'bow_arrow': { name: 'å¼“çŸ¢', guild: 'north', type: 'æ­¦å™¨', basePrice: 100, fluctuation: 0.20 },
    'stone_carving': { name: 'å†»çŸ³é›•åˆ»', guild: 'north', type: 'å·¥è‰ºå“', basePrice: 140, fluctuation: 0.22 }
};

const MARKET_EVENT_DATA = [
    // åŸæœ‰äº‹ä»¶ (å·²ä¿ç•™)
    { id:'flood_jiangnan', name: 'æ±Ÿå—æ°´ç¾', effects: { 'silk': 0.25, 'tea_longjing': -0.15 } },
    { id:'snow_north', name: 'åŒ—æ–¹å¤§é›ª', effects: { 'fur_coat': 0.30, 'horse_saibei': -0.20 } },
    { id:'storm_donghai', name: 'ä¸œæµ·é£æµª', effects: { 'pearl_donghai': 0.40, 'coral': 0.25 } },
    { id:'border_conflict', name: 'è¾¹å¢ƒå†²çª', effects: { 'bow_arrow': 0.35, 'horse_turkic': 0.25 } },
    { id:'palace_purchase', name: 'å®«å»·é‡‡è´­', effects: { 'silk': 0.30, 'porcelain': 0.20, 'embroidery_su': 0.40 } },
    { id:'exam_season', name: 'ç§‘ä¸¾è€ƒè¯•', effects: { 'stationery': 0.35 } },
    { id:'noble_wedding', name: 'è´µæ—å©šç¤¼', effects: { 'jade_hetian': 0.30, 'pearl_donghai': 0.25 } },

    // æ–°å¢äº‹ä»¶
    { id:'canal_blockage', name: 'è¿æ²³æ·¤å¡', effects: { 'silk': 0.20, 'porcelain': 0.18, 'tea_longjing': 0.15, 'stationery': 0.10 } },
    { id:'xiyu_peace', name: 'è¥¿åŸŸå’Œå¹³æ¡çº¦', effects: { 'jade_hetian': -0.20, 'carpet_persian': -0.18, 'wine_xiyu': -0.15 } },
    { id:'saibei_trade_boom', name: 'å¡åŒ—é€šå•†ç¹è£', effects: { 'horse_saibei': -0.15, 'fur_coat': -0.10, 'ginseng_changbai': -0.12 } },
    { id:'nanyang_tribute', name: 'å—æ´‹è¯¸å›½æ¥æœ', effects: { 'pearl_donghai': 0.20, 'coral': 0.18, 'ivory_carving': 0.25, 'spice_nanyang': 0.15 } },
    { id:'folk_art_craze', name: 'æ°‘é—´è‰ºæœ¯é£æ½®', effects: { 'embroidery_su': 0.20, 'bamboo_craft': 0.30, 'stone_carving': 0.25 } },
    { id:'plague_scare', name: 'ç–«ç—…ä¼ é—»', effects: { 'lotus_tian': 0.40, 'ginseng_changbai': 0.35, 'deer_antler': 0.30, 'rhino_horn_cup': 0.25 } },
    { id:'noble_fashion', name: 'è´µæ—æ–°é£å°š', effects: { 'silk': 0.22, 'jade_hetian': 0.18, 'pearl_donghai': 0.20, 'fur_coat': 0.15 } },
    { id:'military_demand', name: 'å†›å¤‡éœ€æ±‚å¤§å¢', effects: { 'horse_turkic': 0.30, 'horse_saibei': 0.28, 'bow_arrow': 0.40, 'yak_wool': 0.15 } },
    { id:'drought_warning', name: 'å¹²æ—±é¢„è­¦', effects: { 'tea_longjing': 0.20, 'wine_shaoxing': 0.15, 'wine_xiyu': 0.18 } },
    { id:'good_harvest', name: 'ç²®é£Ÿä¸°æ”¶', effects: { 'cheese': -0.20, 'coconut_oil': -0.15 } },
    { id:'overseas_competition', name: 'æµ·å¤–ç«äº‰åŠ å‰§', effects: { 'spice_nanyang': -0.25, 'ivory_carving': -0.15, 'coral': -0.10 } },
    { id:'scholar_gathering', name: 'æ–‡äººé›…é›†', effects: { 'stationery': 0.25, 'tea_longjing': 0.15, 'wine_shaoxing': 0.10 } },
    { id:'new_mine_found', name: 'å‘ç°æ–°ç‰çŸ¿', effects: { 'jade_hetian': -0.25 } },
    { id:'temple_construction', name: 'å¤§å…´åœŸæœ¨ä¿®å¯ºåº™', effects: { 'hardwood': 0.30, 'stone_carving': 0.20 } },
    { id:'luxury_tax', name: 'æœå»·å¾æ”¶å¥¢ä¾ˆå“ç¨', effects: { 'silk': 0.15, 'jade_hetian': 0.20, 'pearl_donghai': 0.18, 'fur_coat': 0.12, 'ivory_carving': 0.22 } }
];
// åˆå§‹åŒ–å•†ä¼šäº¤æ˜“çŠ¶æ€ (åœ¨setupNewGameä¸­è°ƒç”¨)
function initTradeSimState() {
    if (!gameState.tradeSim) {
        gameState.tradeSim = {
            turn: 0,
            warehouse: {}, // { yunjin: 10, ... }
            currentPrices: {}, // { yunjin: { price: 150, trend: 0 }, ... }
            marketNews: [],
            warehouseLevel: 0, // 0: åˆå§‹, 1: ä¸­å‹, 2: å¤§å‹
            debt: 0
        };
        // é¦–æ¬¡è¿›å…¥æ—¶ï¼Œç”Ÿæˆåˆå§‹ä»·æ ¼
        updateTradePrices(true);
    }
}

// å¯åŠ¨æ–°ç‰ˆå•†ä¼šäº¤æ˜“ç©æ³•
function startTradeSim() {
    initTradeSimState();
    renderTradeSimUI();
    showOverlay('tradeSimOverlay');
}

// æ¸²æŸ“äº¤æ˜“ç•Œé¢
function renderTradeSimUI() {
    const sim = gameState.tradeSim;
    const warehouseInfo = TRADE_SIM_DATA.warehouses[sim.warehouseLevel];
    const currentCapacity = Object.values(sim.warehouse).reduce((sum, amount) => sum + amount, 0);

    let html = `
    <div class="trade-sim-container">
        <div class="trade-sim-header">
            <div class="trade-sim-header-item"><strong>ç¬¬ ${sim.turn / 2 + 1} å¹´ ${sim.turn % 2 === 0 ? 'ä¸ŠåŠå¹´' : 'ä¸‹åŠå¹´'}</strong></div>
            <div class="trade-sim-header-item">èµ„é‡‘: <strong class="value">${formatNumber(gameState.finances.wealth)}</strong> ä¸¤</div>
            <div class="trade-sim-header-item">ä»“åº“: ${currentCapacity} / ${warehouseInfo.capacity} (${warehouseInfo.name})</div>
            <div class="trade-sim-header-item">æ¬ æ¬¾: <strong style="color:red;">${formatNumber(sim.debt)}</strong> ä¸¤</div>
        </div>
        <div class="trade-sim-news">
            <strong>å¸‚åœºæƒ…æŠ¥:</strong>
            <ul>
                ${sim.marketNews.length > 0 ? sim.marketNews.map(news => `<li>${news}</li>`).join('') : '<li>é£å¹³æµªé™ã€‚</li>'}
            </ul>
        </div>
        <div class="trade-sim-body">
            <table class="trade-sim-table">
                <thead>
                    <tr>
                        <th>å•†å“</th>
                        <th>åº“å­˜</th>
                        <th>ç°ä»·</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    ${Object.keys(TRADE_SIM_DATA.goods).map(id => renderTradeGoodRow(id)).join('')}
                </tbody>
            </table>
        </div>
        <div class="trade-sim-footer">
            <button class="control-btn" onclick="nextTradeTurn()">è¿›å…¥ä¸‹åŠå¹´</button>
            <button class="control-btn" onclick="manageWarehouse()">ä»“åº“ç®¡ç†/å‡çº§</button>
            <button class="control-btn" onclick="manageDebt()">é’±åº„å€Ÿè´·</button>
        </div>
    </div>
    `;
    document.getElementById('tradeSimContent').innerHTML = html;
}
// æ”¾ç½®åœ¨ merchant guild ç›¸å…³çš„å‡½æ•°åŒºåŸŸ

function updateMarketStatus() {
    const ts = gameState.tradingSystem;
    ts.marketStatus.fluctuations = [];
    ts.marketStatus.prices = {};

    // éšæœºé€‰æ‹©1-3ä¸ªå¸‚åœºäº‹ä»¶
    const eventCount = getRandomInt(1, 3);
    const selectedEvents = [];
    for (let i = 0; i < eventCount; i++) {
        selectedEvents.push(getRandomElement(MARKET_EVENT_DATA));
    }

    // åˆå§‹åŒ–æ‰€æœ‰å•†å“çš„åŸºç¡€ä»·æ ¼
    for (const goodId in TRADING_GOODS_DATA) {
        const good = TRADING_GOODS_DATA[goodId];
        // åŸºç¡€ä»·æ ¼ä¸Šæœ‰ä¸€ä¸ªå°çš„éšæœºæ³¢åŠ¨
        ts.marketStatus.prices[goodId] = Math.floor(good.basePrice * (1 + (Math.random() - 0.5) * 0.4)); 
    }

    // åº”ç”¨å¸‚åœºäº‹ä»¶æ•ˆæœ
    selectedEvents.forEach(event => {
        for (const goodId in event.effects) {
            if (TRADING_GOODS_DATA[goodId]) {
                const good = TRADING_GOODS_DATA[goodId];
                const change = event.effects[goodId];
                ts.marketStatus.prices[goodId] = Math.floor(ts.marketStatus.prices[goodId] * (1 + change));
                
                // è®°å½•åˆ°æ³¢åŠ¨ä¿¡æ¯å¡ä¸­
                ts.marketStatus.fluctuations.push({
                    id: goodId,
                    name: good.name,
                    change: change,
                    reason: event.name
                });
            }
        }
    });

    // æ ‡è®°äº¤æ˜“æœŸå¼€å§‹ (1-15æ—¥)
    ts.isTradingPeriod = true; 
    logEvent('<strong>äº¬åŸå„å¤§å•†ä¼šå¼€å¸‚ï¼Œæ–°ä¸€è½®çš„äº¤æ˜“å¼€å§‹äº†ï¼</strong>');
}
// æ¸²æŸ“å•†å“è¡¨æ ¼çš„æ¯ä¸€è¡Œ
function renderTradeGoodRow(goodId) {
    const good = TRADE_SIM_DATA.goods[goodId];
    const sim = gameState.tradeSim;
    const priceInfo = sim.currentPrices[goodId];
    const stock = sim.warehouse[goodId] || 0;
    
    let trendArrow = '';
    if (priceInfo.trend > 0) trendArrow = `<span class="price-up">â†‘</span>`;
    if (priceInfo.trend < 0) trendArrow = `<span class="price-down">â†“</span>`;

    return `
    <tr>
        <td><strong>${good.name}</strong><br><small>${good.guild}</small></td>
        <td>${stock}</td>
        <td>${priceInfo.price} ${trendArrow}</td>
        <td>
            <button class="btn-buy" onclick="buyGood('${goodId}')">ä¹°å…¥</button>
            <button class="btn-sell" onclick="sellGood('${goodId}')" ${stock === 0 ? 'disabled' : ''}>å–å‡º</button>
        </td>
    </tr>
    `;
}

// æ›´æ–°æ‰€æœ‰å•†å“ä»·æ ¼
function updateTradePrices(isInitial = false) {
    const sim = gameState.tradeSim;
    sim.marketNews = [];

    // 1. è§¦å‘éšæœºäº‹ä»¶
    const activeEvents = [];
    TRADE_SIM_DATA.randomEvents.forEach(event => {
        if (Math.random() < event.prob) {
            activeEvents.push(event);
            sim.marketNews.push(event.desc);
        }
    });

    // 2. è®¡ç®—æ¯ä¸ªå•†å“çš„æ–°ä»·æ ¼
    Object.keys(TRADE_SIM_DATA.goods).forEach(id => {
        const good = TRADE_SIM_DATA.goods[id];
        let price = getRandomInt(good.basePrice[0], good.basePrice[1]);

        // åº”ç”¨äº‹ä»¶å½±å“
        activeEvents.forEach(event => {
            let applies = false;
            if (event.effect.type === 'all') applies = true;
            if (event.effect.type === 'guild' && event.effect.guild === good.guild) applies = true;
            if (event.effect.type === 'goods' && event.effect.goods.includes(id)) applies = true;
            if (event.effect.type === 'random_good' && !event.affectedGood) {
                event.affectedGood = getRandomElement(Object.keys(TRADE_SIM_DATA.goods));
            }
            if (event.effect.type === 'random_good' && event.affectedGood === id) applies = true;
            
            if (applies) {
                price *= event.effect.multiplier;
            }
        });
        
        price = Math.round(price);
        
        let trend = 0;
        if (!isInitial && sim.currentPrices[id]) {
            trend = price - sim.currentPrices[id].price;
        }

        sim.currentPrices[id] = { price, trend };
    });
}

// ä¹°å…¥å•†å“
function buyGood(goodId) {
    const sim = gameState.tradeSim;
    const good = TRADE_SIM_DATA.goods[goodId];
    const price = sim.currentPrices[goodId].price;
    const warehouseInfo = TRADE_SIM_DATA.warehouses[sim.warehouseLevel];
    const currentCapacity = Object.values(sim.warehouse).reduce((sum, amount) => sum + amount, 0);
    const availableSpace = warehouseInfo.capacity - currentCapacity;
    const maxCanBuy = Math.floor(gameState.finances.wealth / price);

    if (availableSpace <= 0) {
        showToast("ä»“åº“å·²æ»¡ï¼");
        return;
    }
    if (maxCanBuy <= 0) {
        showToast("èµ„é‡‘ä¸è¶³ï¼");
        return;
    }
    
    const amountStr = prompt(`ä¹°å…¥ ${good.name} (å•ä»·: ${price}ä¸¤)\nä»“åº“å‰©ä½™å®¹é‡: ${availableSpace}, ä½ æœ€å¤šå¯ä¹°: ${Math.min(availableSpace, maxCanBuy)}`, '1');
    const amount = parseInt(amountStr);
    
    if (isNaN(amount) || amount <= 0) return;
    if (amount > availableSpace) { showToast("ä»“åº“å®¹é‡ä¸è¶³ï¼"); return; }
    if (amount > maxCanBuy) { showToast("èµ„é‡‘ä¸è¶³ï¼"); return; }

    applyEffects({ wealth: -amount * price });
    sim.warehouse[goodId] = (sim.warehouse[goodId] || 0) + amount;
    renderTradeSimUI();
}

// å–å‡ºå•†å“
function sellGood(goodId) {
    const sim = gameState.tradeSim;
    const good = TRADE_SIM_DATA.goods[goodId];
    const price = sim.currentPrices[goodId].price;
    const stock = sim.warehouse[goodId] || 0;

    const amountStr = prompt(`å–å‡º ${good.name} (å•ä»·: ${price}ä¸¤)\nä½ å½“å‰æŒæœ‰: ${stock}`, `${stock}`);
    const amount = parseInt(amountStr);
    
    if (isNaN(amount) || amount <= 0) return;
    if (amount > stock) { showToast("åº“å­˜ä¸è¶³ï¼"); return; }

    applyEffects({ wealth: amount * price });
    sim.warehouse[goodId] -= amount;
    if (sim.warehouse[goodId] === 0) {
        delete sim.warehouse[goodId];
    }
    renderTradeSimUI();
}

// è¿›å…¥ä¸‹ä¸€å›åˆ
function nextTradeTurn() {
    const sim = gameState.tradeSim;
    sim.turn++;

    // ç»“ç®—ä»“å‚¨è´¹
    const warehouseInfo = TRADE_SIM_DATA.warehouses[sim.warehouseLevel];
    if (warehouseInfo.cost > 0) {
        applyEffects({ wealth: -warehouseInfo.cost });
        sim.marketNews.push(`æ”¯ä»˜ä»“åº“ç§Ÿé‡‘ ${warehouseInfo.cost} ä¸¤ã€‚`);
    }

    // ç»“ç®—åˆ©æ¯
    if (sim.debt > 0) {
        const interest = Math.ceil(sim.debt * 0.05); // 5% åˆ©æ¯
        applyEffects({ wealth: -interest });
        sim.debt += interest;
        sim.marketNews.push(`æ”¯ä»˜é’±åº„åˆ©æ¯ ${interest} ä¸¤ã€‚`);
    }

    updateTradePrices();
    renderTradeSimUI();
}

// ç®¡ç†ä»“åº“
function manageWarehouse() {
    const sim = gameState.tradeSim;
    const currentLevel = sim.warehouseLevel;
    if (currentLevel >= TRADE_SIM_DATA.warehouses.length - 1) {
        showToast("å·²æ˜¯é¡¶çº§ä»“åº“ã€‚");
        return;
    }
    const nextWarehouse = TRADE_SIM_DATA.warehouses[currentLevel + 1];
    
    if (confirm(`æ˜¯å¦èŠ±è´¹ ${nextWarehouse.cost * 10} ä¸¤å‡çº§ä¸º ${nextWarehouse.name} (å®¹é‡: ${nextWarehouse.capacity})ï¼Ÿ`)) {
        const upgradeCost = nextWarehouse.cost * 10;
        if (gameState.finances.wealth < upgradeCost) {
            showToast("èµ„é‡‘ä¸è¶³ä»¥å‡çº§ä»“åº“ï¼");
            return;
        }
        applyEffects({ wealth: -upgradeCost });
        sim.warehouseLevel++;
        showToast("ä»“åº“å‡çº§æˆåŠŸï¼");
        renderTradeSimUI();
    }
}

// ç®¡ç†å€Ÿè´·
function manageDebt() {
    const sim = gameState.tradeSim;
    const maxLoan = gameState.family.reputation * 100;

    let content = `<p>å½“å‰æ¬ æ¬¾: ${sim.debt} ä¸¤ã€‚</p><p>ä»¥ä½ çš„å£°æœ›ï¼Œæœ€å¤šå¯ä»é’±åº„å€Ÿè´· ${maxLoan} ä¸¤ã€‚</p>`;
    let options = [];

    options.push({
        htmlContent: 'å€Ÿé’±',
        callback: () => {
            const amountStr = prompt(`è¯·è¾“å…¥è¦å€Ÿå…¥çš„é‡‘é¢ (æœ€å¤šå¯å€Ÿ ${maxLoan - sim.debt})`);
            const amount = parseInt(amountStr);
            if (isNaN(amount) || amount <= 0) return;
            if (amount + sim.debt > maxLoan) { showToast("è¶…å‡ºä½ çš„å€Ÿè´·ä¸Šé™ï¼"); return; }
            applyEffects({ wealth: amount });
            sim.debt += amount;
            renderTradeSimUI();
        }
    });

    if (sim.debt > 0) {
        options.push({
            htmlContent: 'è¿˜é’±',
            callback: () => {
                const amountStr = prompt(`è¯·è¾“å…¥è¦å¿è¿˜çš„é‡‘é¢ (å½“å‰æ¬ æ¬¾ ${sim.debt})`, `${sim.debt}`);
                const amount = parseInt(amountStr);
                if (isNaN(amount) || amount <= 0) return;
                if (amount > gameState.finances.wealth) { showToast("èµ„é‡‘ä¸è¶³ä»¥å¿è¿˜ï¼"); return; }
                const realAmount = Math.min(amount, sim.debt);
                applyEffects({ wealth: -realAmount });
                sim.debt -= realAmount;
                renderTradeSimUI();
            }
        });
    }

    showDecisionCard("é’±åº„ä¸šåŠ¡", "fa-coins", content, options);
}
// =======================================================================
// ===================== ã€æ–°åŠŸèƒ½ä»£ç ã€‘ç¤¾äº¤ç©æ³•å‡½æ•° START =====================
// =======================================================================

function showWeddingBanquet(groom, bride, guestIdsJson) {
    const overlay = document.getElementById('weddingOverlay');
    const guestIds = JSON.parse(guestIdsJson);
    
    let banquetHTML = `
        <div class="wedding-stage" id="wedding-stage-3">
            <div class="overlay-header">å–œå®´</div>
            <p>å®´å¸­ä¸Šå®¾ä¸»å°½æ¬¢ï¼Œä½ çš„å¥½å‹ä»¬çº·çº·å‰æ¥æ•¬é…’é“è´ºã€‚</p>
            <div id="wedding-toasts">
            ${guestIds.map(id => {
                const guest = gameState.npcs[id];
                return `<p>${guest.name}: "æ­è´ºæ–°äººï¼Œç™¾å¹´å¥½åˆï¼" (é€ä¸Šè´ºç¤¼)</p>`;
            }).join('')}
            </div>
            <button class="control-btn" style="margin-top:20px;" onclick="closeAllOverlays()">ç¤¼æˆ</button>
        </div>
    `;
    overlay.innerHTML = banquetHTML;
    
    // ç»“ç®—è´ºç¤¼
    const giftMoney = guestIds.length * getRandomInt(100, 300);
    if(giftMoney > 0) {
        applyEffects({wealth: giftMoney});
        showToast(`æ”¶åˆ°å®¾å®¢è´ºç¤¼å…±è®¡ ${giftMoney} ä¸¤ã€‚`);
    }
}

// =======================================================================
// ===================== ã€æ–°å¢ã€‘ä¿ƒè†é•¿è°ˆå°æ¸¸æˆæ ¸å¿ƒé€»è¾‘ =====================
// =======================================================================
// ===================== ã€ç¬¬äºŒæ­¥ï¼šè¯·ç”¨è¿™ä¸¤ä¸ªå‡½æ•°å®Œæ•´æ›¿æ¢æ—§ç‰ˆæœ¬ã€‘ =====================

function startConversationMiniGame(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return;
    if (!checkAndUseNpcActionPoint(npcId)) {
        return;
    }

    // [ä¿®æ”¹] ä»æ–°çš„ã€åŠŸèƒ½æ›´ä¸°å¯Œçš„äº‹ä»¶åº“ä¸­éšæœºæŠ½å–çƒ¦æ¼
    const dilemma = getRandomElement(CONVERSATION_DILEMMAS);
    
    // [ä¿ç•™å¹¶ä¼˜åŒ–] æ ¹æ®NPCæ€§æ ¼ç”Ÿæˆâ€œç©æ³•æç¤ºâ€
    const personalityMap = { "èªæ…§": "wisdom", "æ•é”": "wisdom", "æ¸©æŸ”": "charm", "æ´»æ³¼": "charm", "ç«¯åº„": "virtue", "åšéŸ§": "virtue", "å–„è‰¯": "virtue", "æ¸…å†·": "wisdom", "æ´’è„±": "charm" };
    const bestChoiceType = personalityMap[npc.personality[0]] || 'wisdom';
    
    let hintText = '';
    if (bestChoiceType === 'wisdom') {
        hintText = `<p class="comment" style="text-align:center;">TAçœ‹èµ·æ¥å¿ƒäº‹é‡é‡ï¼Œä¼¼ä¹éœ€è¦ä¸€äº›ç†æ€§çš„åˆ†æã€‚</p>`;
    } else if (bestChoiceType === 'charm') {
        hintText = `<p class="comment" style="text-align:center;">TAçš„çœ‰å®‡é—´å¸¦ç€ä¸€ä¸æ„ç»ªï¼Œæˆ–è®¸éœ€è¦çš„æ˜¯æƒ…æ„Ÿä¸Šçš„å…±é¸£ã€‚</p>`;
    } else if (bestChoiceType === 'virtue') {
        hintText = `<p class="comment" style="text-align:center;">TAä¼¼ä¹æ­£é™·å…¥ä¸¤éš¾çš„æŠ‰æ‹©ï¼Œæ¸´æœ›å¾—åˆ°ä¸€ä¸ªåšå®ˆé“ä¹‰çš„æŒ‡å¼•ã€‚</p>`;
    }

    // [æ ¸å¿ƒä¿®æ”¹] é€‰é¡¹çš„æ–‡æœ¬ç°åœ¨æ˜¯åŠ¨æ€çš„ï¼Œç›´æ¥ä»äº‹ä»¶åº“ä¸­è¯»å–
    const options = [
        { htmlContent: `<i class="fas fa-lightbulb"></i> ${dilemma.responses.wisdom.text}`, callback: () => handleConversationChoice(npcId, 'wisdom', dilemma) },
        { htmlContent: `<i class="fas fa-grin-stars"></i> ${dilemma.responses.charm.text}`, callback: () => handleConversationChoice(npcId, 'charm', dilemma) },
        { htmlContent: `<i class="fas fa-leaf"></i> ${dilemma.responses.virtue.text}`, callback: () => handleConversationChoice(npcId, 'virtue', dilemma) },
    ];
    
    const cardContent = `<p>"${dilemma.desc}"</p>${hintText}`;
    showDecisionCard(`ä¸ ${npc.name} çš„äº¤è°ˆ`, 'fa-heart', cardContent, options);
}

function handleConversationChoice(npcId, choiceType, dilemma) {
    const npc = gameState.npcs[npcId];
    if (!npc || !dilemma) return;

    // [æ ¸å¿ƒä¿®æ”¹] ç›´æ¥ä»ä¼ å…¥çš„dilemmaå¯¹è±¡ä¸­è·å–å¯¹åº”çš„ç»“æœï¼Œä¸å†éœ€è¦å¤æ‚çš„åˆ¤æ–­é€»è¾‘
    const response = dilemma.responses[choiceType];
    if (!response || !response.outcome) {
        console.error("å¯¹è¯é€‰é¡¹æˆ–ç»“æœæœªå®šä¹‰ï¼", dilemma, choiceType);
        return;
    }
    
    const outcome = response.outcome;
    
    // æ˜¾ç¤ºç‹¬ç‰¹çš„ã€é¢„è®¾å¥½çš„ç»“æœ
    showEventCard(outcome.title, 'fa-heart-pulse', outcome.log);
    
    // åº”ç”¨ç‹¬ç‰¹çš„ã€é¢„è®¾å¥½çš„æ•ˆæœ
    if (outcome.effects) {
        let effectsToApply = {};
        if (outcome.effects.favor || outcome.effects.trust || outcome.effects.emotionValue) {
            effectsToApply.relationship = {
                targetId: npcId,
                favor: outcome.effects.favor || 0,
                trust: outcome.effects.trust || 0,
                emotionValue: outcome.effects.emotionValue || 0
            };
        }
        if (outcome.effects.attributes) {
            effectsToApply.attributes = outcome.effects.attributes;
        }
        applyEffects(effectsToApply);
    }
    
    // äº’åŠ¨ååˆ·æ–°NPCè¯¦æƒ…ç•Œé¢
    showNPCDetails(npcId);
}
// ===================== ã€æ–°å¢ã€‘ä¿ƒè†é•¿è°ˆå°æ¸¸æˆæ ¸å¿ƒé€»è¾‘ END =====================
function startGoMiniGame(npcId) {
    const cost = 20; 
    if (gameState.finances.wealth < cost) {
        showToast(`å¯¹å¼ˆéœ€è¦ ${cost} ä¸¤èŒ¶æ°´é’±ï¼Œä½ çš„èµ„é‡‘ä¸è¶³ã€‚`);
        return;
    }

    const betAmountStr = prompt(`è¯·è¾“å…¥æœ¬æ¬¡å¯¹å¼ˆçš„èµŒé‡‘ï¼ˆè¾“å…¥0ä¸ºåˆ‡ç£‹ï¼Œèµ¢äº†åŒå€è¿”è¿˜ï¼Œè¾“äº†æ‰£é™¤ï¼‰ï¼š`, "100");
    let betAmount = parseInt(betAmountStr);

    if (isNaN(betAmount) || betAmount < 0) {
        showToast("è¯·è¾“å…¥æœ‰æ•ˆçš„èµŒé‡‘ã€‚");
        return;
    }
    
    // ã€æ–°å¢ã€‘é™åˆ¶èµŒé‡‘ä¸Šé™
    if (betAmount > 50000) {
        showToast("èµŒé‡‘æœ€é«˜ä¸å¾—è¶…è¿‡50000ä¸¤ï¼Œå·²è‡ªåŠ¨ä¸ºä½ è°ƒæ•´ã€‚");
        betAmount = 50000;
    }

    if (gameState.finances.wealth < cost + betAmount) {
        showToast(`ä½ çš„èµ„é‡‘ä¸è¶³ä»¥æ”¯ä»˜èŒ¶æ°´é’±å’ŒèµŒé‡‘ã€‚`);
        return;
    }
    
    applyEffects({ wealth: -(cost + betAmount) });

    const container = document.getElementById('goGameContainer');
    let boardHTML = '<div class="go-board">';
    for (let i = 0; i < 25; i++) {
        boardHTML += `<div class="go-cell" onclick="placeGoStone(this, ${i}, '${npcId}', ${betAmount})"></div>`;
    }
    boardHTML += '</div>';
    container.innerHTML = boardHTML;
    document.getElementById('goGameStatus').textContent = `èµŒé‡‘ï¼š${betAmount} ä¸¤ã€‚ä½ æ‰§é»‘å­ï¼Œè¯·è½å­ã€‚`;
    
    gameState.miniGame = { 
        board: Array(25).fill(null), 
        turn: 'player', 
        opponent: npcId,
        bet: betAmount,
        gameOver: false
    };
    
    showOverlay('goGameOverlay');
}
function placeGoStone(cell, index, npcId, betAmount) {
    const game = gameState.miniGame;
    if (game.gameOver || game.turn !== 'player' || game.board[index] !== null) return;
    
    cell.textContent = 'âš«';
    game.board[index] = 'player';
    
    const handleEndGame = (result) => {
        game.gameOver = true;
        let resultText = '';
        let favorChange = 0;

        if (result === 'win') {
            document.getElementById('goGameStatus').textContent = `ä½ èµ¢äº†ï¼è·å¾— ${betAmount * 2} ä¸¤èµŒé‡‘ã€‚`;
            applyEffects({ wealth: betAmount * 2 }); // èµ¢äº†åŒå€è¿”è¿˜
            favorChange = 5;
            resultText = `ä½ åœ¨æ£‹å±€ä¸­æˆ˜èƒœäº†${gameState.npcs[npcId].name}ï¼Œå¯¹æ–¹å¯¹ä½ åˆ®ç›®ç›¸çœ‹ã€‚`;
        } else if (result === 'lose') {
            document.getElementById('goGameStatus').textContent = 'ä½ è¾“äº†ã€‚';
            // èµŒé‡‘åœ¨å¼€å§‹æ—¶å·²æ‰£é™¤ï¼Œè¿™é‡Œæ— éœ€å†æ‰£
            favorChange = 3;
            resultText = `è™½ç„¶è¾“äº†æ£‹å±€ï¼Œä½†ä¹Ÿä¸${gameState.npcs[npcId].name}å¢è¿›äº†æ„Ÿæƒ…ã€‚`;
        } else { // draw
            document.getElementById('goGameStatus').textContent = 'å¹³å±€ï¼èµŒé‡‘é€€è¿˜ã€‚';
            applyEffects({ wealth: betAmount }); // å¹³å±€é€€è¿˜æœ¬é‡‘
            favorChange = 4;
            resultText = `ä¸€å±€ç»ˆäº†ï¼Œä¸åˆ†èƒœè´Ÿï¼Œä½ ä»¬å¯¹å½¼æ­¤çš„æ£‹è‰ºéƒ½ååˆ†æ¬£èµã€‚`;
        }
        applyEffects({relationship: { targetId: npcId, influence: result === 'win' ? 10 : 0, favor: favorChange }});
        showEventCard('æ‰‹è°ˆå¯¹å¼ˆ', 'fa-chess', resultText);
    };

    if (checkGoWin('player')) {
        handleEndGame('win');
        return;
    }
    if (game.board.every(s => s !== null)) {
        handleEndGame('draw');
        return;
    }
    
    game.turn = 'npc';
    document.getElementById('goGameStatus').textContent = 'å¯¹æ–¹æ­£åœ¨æ€è€ƒ...';
    
    setTimeout(() => {
        if (game.gameOver) return;
        const npcMove = getNpcGoMove();
        if (npcMove === -1) { // æ²¡æœ‰å¯è½å­çš„åœ°æ–¹ï¼Œå¹³å±€
            handleEndGame('draw');
            return;
        }

        game.board[npcMove] = 'npc';
        document.querySelector(`.go-board .go-cell:nth-child(${npcMove + 1})`).textContent = 'âšª';
        
        if (checkGoWin('npc')) {
            handleEndGame('lose');
            return;
        }
        if (game.board.every(s => s !== null)) {
            handleEndGame('draw');
            return;
        }

        game.turn = 'player';
        document.getElementById('goGameStatus').textContent = 'è½®åˆ°ä½ äº†ã€‚';
    }, 1000);
}
function checkGoWin(player) {
    const board = gameState.miniGame.board;
    const size = 5; // 5x5 æ£‹ç›˜
    const winCount = 4; // å››å­è¿ç 

    for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
            const index = r * size + c;
            if (board[index] !== player) continue;

            // æ£€æŸ¥æ°´å¹³æ–¹å‘
            if (c + winCount <= size) {
                let win = true;
                for (let i = 1; i < winCount; i++) {
                    if (board[index + i] !== player) {
                        win = false;
                        break;
                    }
                }
                if (win) return true;
            }

            // æ£€æŸ¥å‚ç›´æ–¹å‘
            if (r + winCount <= size) {
                let win = true;
                for (let i = 1; i < winCount; i++) {
                    if (board[index + i * size] !== player) {
                        win = false;
                        break;
                    }
                }
                if (win) return true;
            }

            // æ£€æŸ¥å³ä¸‹æ–œæ–¹å‘
            if (r + winCount <= size && c + winCount <= size) {
                let win = true;
                for (let i = 1; i < winCount; i++) {
                    if (board[index + i * (size + 1)] !== player) {
                        win = false;
                        break;
                    }
                }
                if (win) return true;
            }

            // æ£€æŸ¥å·¦ä¸‹æ–œæ–¹å‘
            if (r + winCount <= size && c - (winCount - 1) >= 0) {
                let win = true;
                for (let i = 1; i < winCount; i++) {
                    if (board[index + i * (size - 1)] !== player) {
                        win = false;
                        break;
                    }
                }
                if (win) return true;
            }
        }
    }
    return false;
}// [æ›¿æ¢]
function getNpcGoMove() {
    const board = gameState.miniGame.board;
    const size = 5;

    // 1. æ£€æŸ¥NPCè‡ªå·±èƒ½å¦ä¸€æ­¥è·èƒœ
    for (let i = 0; i < size * size; i++) {
        if (board[i] === null) {
            board[i] = 'npc';
            if (checkGoWin('npc')) {
                board[i] = null; // æ¢å¤æ£‹ç›˜
                return i;
            }
            board[i] = null; // æ¢å¤æ£‹ç›˜
        }
    }

    // 2. æ£€æŸ¥ç©å®¶èƒ½å¦ä¸€æ­¥è·èƒœ (è¿›è¡Œé˜²å®ˆ)
    for (let i = 0; i < size * size; i++) {
        if (board[i] === null) {
            board[i] = 'player';
            if (checkGoWin('player')) {
                board[i] = null; // æ¢å¤æ£‹ç›˜
                return i;
            }
            board[i] = null; // æ¢å¤æ£‹ç›˜
        }
    }

    // 3. å¯»æ‰¾ä¸€ä¸ªéšæœºçš„ç©ºä½
    let availableMoves = [];
    for (let i = 0; i < size * size; i++) {
        if (board[i] === null) {
            availableMoves.push(i);
        }
    }

    // 4. ä½œä¸ºç®€å•çš„è¿›æ”»ç­–ç•¥ï¼Œä¼˜å…ˆé€‰æ‹©æ£‹ç›˜ä¸­å¿ƒåŒºåŸŸ
    const centerMoves = [6, 7, 8, 11, 12, 13, 16, 17, 18].filter(m => availableMoves.includes(m));
    if (centerMoves.length > 0) {
        return getRandomElement(centerMoves);
    }

    return availableMoves.length > 0 ? getRandomElement(availableMoves) : -1;
}

function handleLoverInteraction(npcId, actionId) {
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨å‡½æ•°å¼€å¤´åŠ å…¥æ–°çš„æ£€æŸ¥
    if (!checkAndUseNpcActionPoint(npcId)) {
        return;
    }

    const npc = gameState.npcs[npcId];
    const player = gameState.player;
    if (!npc) return;

    if (gameState.marriage.isMarried && gameState.marriage.spouseId) {
        const spouse = gameState.npcs[gameState.marriage.spouseId];
        if (spouse) {
            spouse.suspicionValue = (spouse.suspicionValue || 0) + getRandomInt(3, 7);
            logEvent(`ä½ ä¸<strong class="highlight-npc">${npc.name}</strong>çš„äº²å¯†äº’åŠ¨è®©ä½ æœ‰äº›å¿ƒè™šï¼Œä½ é…å¶çš„ç–‘å¿ƒå¢åŠ äº†ã€‚`);
        }
    }

    switch(actionId) {
        case 'rendezvous':
            showEventCard('æœˆä¸‹ä¹‹çº¦', 'fa-kiss-wink-heart', 'ä½ ä»¬åœ¨æœˆå½±èŠ±é¦™ä¸­äº’è¯‰è¡·è‚ ï¼Œæƒ…æ„æ›´æµ“ã€‚æƒ…æ„+20ã€‚');
            applyEffects({ relationship: { targetId: npcId, favor: 20 } });
            if(Math.random() < 0.2) triggerBirth(npcId, true);
            break;
        case 'poetry_quiz':
            startPoetryMiniGame(npcId);
            break;
        case 'take_as_concubine_lover':
            acquireConcubine(npcId);
            break;
        case 'propose_marriage_lover':
            marrySuitor(npcId);
            break;
        case 'intimacy':
            if (gameState.player.gender === 'female') {
                showEventCard('ç¼ ç»µæ‚±æ»', 'fa-moon', `ä½ ä¸${npc.name}å…±åº¦è‰¯å®µ... å“å¾·-2`);
                applyEffects({ attributes: { virtue: -2 }});
                triggerBirth(npc.id, true); 
            }
            break;
        default:
            showToast(`è§¦å‘äº†æœªçŸ¥çš„æƒ…äººäº’åŠ¨: ${actionId}`);
            break;
    }
}

function handleSwornSiblingInteraction(npcId, actionId) {
    // ã€æ ¸å¿ƒä¿®æ”¹ã€‘åœ¨å‡½æ•°å¼€å¤´åŠ å…¥æ–°çš„æ£€æŸ¥
    if (!checkAndUseNpcActionPoint(npcId)) {
        return;
    }

    const npc = gameState.npcs[npcId];
    if (!npc) return;

    const eventPool = SWORN_SIBLING_EVENTS[actionId];
    if (!eventPool || eventPool.length === 0) {
        showToast("æš‚æ— æ›´å¤šäº’åŠ¨å‰§æƒ…ã€‚");
        return;
    }

    const event = getRandomElement(eventPool);

    const options = event.options.map(opt => ({
        htmlContent: `<span class="option-text">${opt.text}</span>`,
        callback: () => {
            if (opt.effects) {
                if (opt.effects.attributes) applyEffects({ attributes: opt.effects.attributes });
                if (opt.effects.wealth) applyEffects({ wealth: opt.effects.wealth });
                if (opt.effects.reputation) applyEffects({ reputation: opt.effects.reputation });
                if (opt.effects.career_performance) gameState.career.performance += opt.effects.career_performance;
                if (opt.effects.relationship) applyEffects({ relationship: { targetId: npcId, ...opt.effects.relationship } });
                if (opt.effects.item) addItemToInventory(opt.effects.item.id, opt.effects.item.amount || 1, ITEM_DATA[opt.effects.item.id]);
            }
            showEventCard(event.title, 'fa-hands-helping', opt.log);
        }
    }));

    showDecisionCard(event.title, 'fa-hands-helping', event.desc, options);
}

// =======================================================================
// ===================== ã€æ–°å¢ã€‘ä¹‰ç»“é‡‘å…°ä»ªå¼æ ¸å¿ƒé€»è¾‘ =====================
// =======================================================================
// ===================== ã€æ–°å¢ã€‘NPCä¸»åŠ¨è¡¨ç™½å‡½æ•° =====================
// ===================== ã€æ–°å¢ã€‘NPCä¸»åŠ¨æ±‚å©šå‡½æ•° =====================
function triggerMarriageProposal(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return;

    const proposalText = `
        <p>ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> åœ¨ä½ ä»¬å¸¸å»çš„ç§˜å¯†åœ°ç‚¹ç›¸ä¼šã€‚ä»–å¿½ç„¶å•è†è·ªåœ°ï¼Œå–å‡ºä¸€æšç²¾è‡´çš„æˆ’æŒ‡ï¼Œçœ¼ç¥æ— æ¯”çœŸè¯šï¼š</p>
        <p class="comment" style="text-align:center;">â€œæˆ‘ä¸æƒ³å†è®©ä½ æˆ‘å·å·æ‘¸æ‘¸ã€‚è¯·å«ç»™æˆ‘ï¼Œè®©æˆ‘ç»™ä½ ä¸€ä¸ªåæ­£è¨€é¡ºçš„æœªæ¥ã€‚â€</p>
    `;

    const options = [
        {
            htmlContent: `<i class="fas fa-ring"></i> â€œæˆ‘æ„¿æ„ã€‚â€`,
            callback: () => {
                // ç›´æ¥è°ƒç”¨ç°æœ‰çš„ç»“å©šå‡½æ•°
                marrySuitor(npcId);
            }
        },
        {
            htmlContent: `<i class="fas fa-times"></i> â€œå¯¹ä¸èµ·ï¼Œæˆ‘è¿˜æœªå‡†å¤‡å¥½ã€‚â€`,
            callback: () => {
                applyEffects({ relationship: { targetId: npcId, favor: -30, devotion: -20 } });
                showEventCard('ç¼˜åˆ†æœªåˆ°', 'fa-heart-broken', `ä½ æ‹’ç»äº† ${npc.name} çš„æ±‚å©šï¼Œä»–çœ‹èµ·æ¥ä¼¤å¿ƒæ¬²ç»ï¼Œä½ ä»¬çš„å…³ç³»å‡ºç°äº†å·¨å¤§çš„è£‚ç—•ã€‚`);
            }
        }
    ];

    showDecisionCard('ç™½é¦–ä¹‹çº¦', 'fa-ring', proposalText, options);
}
function triggerLoverProposal(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return;

    const proposalText = `
        <p>ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> åœ¨æœˆä¸‹æ•£æ­¥ï¼ŒTAå¿½ç„¶åœä¸‹è„šæ­¥ï¼Œçœ¼ç¥ç¼çƒ­åœ°æœ›ç€ä½ ï¼š</p>
        <p class="comment" style="text-align:center;">â€œæˆ‘å¿ƒæ‚¦ä½ ï¼Œå·²éä¸€æ—¥ã€‚ä¸çŸ¥ä½ ...æ˜¯å¦ä¹Ÿå¯¹æˆ‘æœ‰æ„ï¼Ÿæˆ‘æ„¿ä¸è®¡ååˆ†ï¼Œåªæ±‚èƒ½ä¼´ä½ å·¦å³ã€‚â€</p>
    `;

    const options = [
        {
            htmlContent: `<i class="fas fa-heart"></i> â€œæˆ‘äº¦å¿ƒæ‚¦äºä½ ã€‚â€`,
            callback: () => {
                const rel = gameState.social.relationships[npcId];
                if (rel) {
                    rel.type = 'lover'; // å…³ç³»è½¬ä¸ºæƒ…äºº
                    rel.level = 0;
                    rel.emotionValue = (rel.emotionValue || 0) + 50;
                    if (!gameState.social.secretLovers.includes(npcId)) {
                        gameState.social.secretLovers.push(npcId);
                    }
                }
                applyEffects({ relationship: { targetId: npcId, favor: 30 } });
                showEventCard('ä¸¤æƒ…ç›¸æ‚¦', 'fa-heart-pulse', `ä½ æ¥å—äº† ${npc.name} çš„å¿ƒæ„ï¼Œä½ ä»¬çš„å…³ç³»æ›´è¿›ä¸€æ­¥ï¼Œæˆä¸ºäº†ç§˜å¯†æƒ…äººã€‚`);
            }
        },
        {
            htmlContent: `<i class="fas fa-hand-paper"></i> â€œä½ æˆ‘ä¹‹é—´ï¼Œåªæ˜¯çŸ¥å·±ã€‚â€`,
            callback: () => {
                applyEffects({ relationship: { targetId: npcId, favor: -25 } });
                showEventCard('æœ‰ç¼˜æ— åˆ†', 'fa-heart-broken', `ä½ å©‰æ‹’äº† ${npc.name} çš„æƒ…æ„ï¼ŒTAçœ‹èµ·æ¥ä¼¤å¿ƒæ¬²ç»ã€‚`);
            }
        }
    ];

    showDecisionCard('æœˆä¸‹å€¾å¿ƒ', 'fa-moon', proposalText, options);
}
/**
 * å¯åŠ¨ç»“æ‹œä»ªå¼çš„ç¬¬ä¸€æ­¥ï¼šå‰ç½®äº‹ä»¶â€œé‡‘å…°ä¹‹çº¦â€
 * @param {string} npcId - æè®®ç»“æ‹œçš„NPC ID
 */
function triggerOathProposal(npcId) {
    const npc = gameState.npcs[npcId];
    if (!npc) return;

    const proposalText = `
        <p>æŸæ—¥ï¼Œ<strong class="highlight-npc">${npc.name}</strong> ä¸ä½ å¯¹åé¥®é…’ï¼Œå¿½ç„¶ä¸¾æ¯éƒ‘é‡è¯´é“ï¼š</p>
        <p class="comment" style="text-align:center;">â€œä½ æˆ‘ç›¸è¯†è™½çŸ­ï¼Œå´æ„æ°”ç›¸æŠ•ï¼Œè‚èƒ†ç›¸ç…§ã€‚è‹¥ä¸å«Œå¼ƒï¼Œæ„¿ä¸ä½ ç»“ä¸ºå¼‚å§“${gameState.player.gender === 'male' ? 'å…„å¼Ÿ' : 'å§å¦¹'}ï¼Œä»æ­¤ç¥¸ç¦ä¸å…±ï¼Œç”Ÿæ­»ä¸è´Ÿã€‚â€</p>
    `;

    const options = [
        {
            htmlContent: `<i class="fas fa-handshake"></i> æ¬£ç„¶åº”å…ï¼šâ€œæ­£åˆæˆ‘æ„ï¼â€`,
            callback: () => startOathCeremony(npcId)
        },
        {
            htmlContent: `<i class="fas fa-clock"></i> å®¹æˆ‘ä¸‰æ€ï¼šâ€œæ­¤äº‹é‡å¤§ï¼Œéœ€æ‹©è‰¯è¾°å‰æ—¥ã€‚â€`,
            callback: () => {
                showEventCard('ä¸‰æ€è€Œåè¡Œ', 'fa-clock', `ä½ è®¤ä¸ºç»“æ‹œä¹‹äº‹éœ€éƒ‘é‡ï¼Œå†³å®šç¨åå†è®®ã€‚`);
            }
        }
    ];

    showDecisionCard('é‡‘å…°ä¹‹çº¦', 'ğŸ¤', proposalText, options);
}

/**
 * åˆå§‹åŒ–ä»ªå¼çŠ¶æ€å¹¶å¼€å§‹ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©åœ°ç‚¹
 * @param {string} npcId - ç»“æ‹œçš„NPC ID
 */
function startOathCeremony(npcId) {
    oathCeremonyState = {
        npcId: npcId,
        location: null,
        item: null,
        bonuses: {}
    };
    showOathLocationChoice();
}

/**
 * æ˜¾ç¤ºç»“æ‹œåœ°ç‚¹çš„é€‰æ‹©ç•Œé¢
 */
function showOathLocationChoice() {
    const locations = [
        { id: 'peach_blossom', name: 'æ¡ƒèŠ±æ ‘ä¸‹', desc: 'æµªæ¼«è¯—æ„', icon: 'fa-tree' },
        { id: 'mountain_top', name: 'å±±å·…è§‚æ—¥å°', desc: 'è±ªè¿ˆå£®é˜”', icon: 'fa-mountain' },
        { id: 'temple', name: 'å¤å¯ºç¦…é™¢', desc: 'åº„é‡è‚ƒç©†', icon: 'fa-gopuram' },
        { id: 'courtyard', name: 'è‡ªå®¶åº­é™¢', desc: 'æ¸©é¦¨ç§å¯†', icon: 'fa-home' }
    ];

    const options = locations.map(loc => ({
        htmlContent: `<i class="fas ${loc.icon}"></i><span class="option-text"><strong>${loc.name}</strong><div><small>${loc.desc}</small></div></span>`,
        callback: () => {
            oathCeremonyState.location = loc.id;
            // æ ¹æ®åœ°ç‚¹è®¾ç½®åŠ æˆ
            switch(loc.id) {
                case 'peach_blossom': oathCeremonyState.bonuses.attributes = { charm: 5 }; break;
                case 'mountain_top': oathCeremonyState.bonuses.attributes = { martial: 5 }; break;
                case 'temple': oathCeremonyState.bonuses.attributes = { virtue: 5 }; break;
                case 'courtyard': oathCeremonyState.bonuses.attributes = { reputation: 5 }; break;
            }
            showOathItemChoice(); // è¿›å…¥ä¸‹ä¸€æ­¥
        }
    }));

    showDecisionCard('é€‰æ‹©ç»“æ‹œåœ°ç‚¹', 'fa-map-signs', 'è¯·é€‰æ‹©ä¸€å¤„åˆé€‚çš„åœ°ç‚¹ï¼Œä»¥ç¤ºéƒ‘é‡ã€‚', options);
}

/**
 * æ˜¾ç¤ºç»“æ‹œä¿¡ç‰©çš„é€‰æ‹©ç•Œé¢
 */
function showOathItemChoice() {
    const items = [
        { id: 'blood_wine', name: 'è¡€é…’ç›Ÿèª“', desc: 'æ»´è¡€å…¥é…’ï¼Œå…±é¥®ç›Ÿèª“', cost: 100 },
        { id: 'golden_å¸–', name: 'é‡‘å…°å¸–æ–‡', desc: 'äº²æ‰‹ä¹¦å†™ç»“æ‹œå¸–æ–‡', cost: 150 },
        { id:'jade_pendant', name: 'ç‰ä½©äº’èµ ', desc: 'äº’æ¢è´´èº«ç‰ä½©', cost: 300 },
        { id: 'sword_tassel', name: 'å‰‘ç©—ç›¸ç³»', desc: 'å°†å‰‘ç©—ç³»äºå¯¹æ–¹å‰‘ä¸Š', cost: 200 }
    ];

    const options = items.map(item => ({
        htmlContent: `<i class="fas fa-gem"></i><span class="option-text"><strong>${item.name}</strong><div><small>${item.desc} (èŠ±è´¹: ${item.cost}ä¸¤)</small></div></span>`,
        disabled: gameState.finances.wealth < item.cost,
        callback: () => {
            oathCeremonyState.item = item.id;
            oathCeremonyState.cost = item.cost;
            displayOathCeremony(); // è¿›å…¥æœ€ç»ˆä»ªå¼
        }
    }));

    showDecisionCard('å‡†å¤‡ä¿¡ç‰©', 'fa-gift', 'ä¿¡ç‰©æ˜¯æƒ…è°Šçš„è§è¯ï¼Œè¯·é€‰æ‹©ä¸€ç§ä»ªå¼ã€‚', options);
}

/**
 * æ˜¾ç¤ºæœ€ç»ˆçš„ç»“æ‹œä»ªå¼åŠ¨ç”»ä¸æ–‡æœ¬
 */
function displayOathCeremony() {
    const npc = gameState.npcs[oathCeremonyState.npcId];
    const player = gameState.player;
    const genderTerm = player.gender === 'male' ? 'å…„å¼Ÿ' : 'å§å¦¹';

    const header = document.getElementById('oathCeremonyHeader');
    const animation = document.getElementById('oathCeremonyAnimation');
    const content = document.getElementById('oathCeremonyContent');
    const optionsContainer = document.getElementById('oathCeremonyOptions');
    const confirmBtn = document.getElementById('oathCeremonyConfirmBtn');
    
    header.textContent = 'ä¹‰ç»“é‡‘å…° Â· ç›Ÿèª“æ­¤ç”Ÿ';
    animation.innerHTML = 'ğŸ”¥';
    content.innerHTML = `
        <p>é¦™ç‚‰ä¸­é’çƒŸè¢…è¢…ï¼Œä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> è·ªäºå¤©åœ°å‰ï¼Œæœ—å£°è¯µè¯»ï¼š</p>
        <blockquote>
            çš‡å¤©åœ¨ä¸Šï¼ŒåšåœŸä¸ºè¯ã€‚<br>
            ä»Šæ—¥æˆ‘ <strong>${player.name}</strong> ä¸ <strong>${npc.name}</strong> ç»“ä¸ºå¼‚å§“${genderTerm}ï¼Œ<br>
            ä¸æ±‚åŒå¹´åŒæœˆåŒæ—¥ç”Ÿï¼Œä½†æ±‚åŒå¹´åŒæœˆåŒæ—¥æ­»ã€‚<br>
            è‚èƒ†ç›¸ç…§ï¼Œè£è¾±ä¸å…±ï¼Œå¦‚æœ‰è¿èƒŒï¼Œå¤©äººå…±æˆ®ï¼
        </blockquote>
        <p>è¯µè¯»å®Œæ¯•ï¼Œä½ äºŒäººç›¸è§†ä¸€ç¬‘ï¼Œå°†ä¿¡ç‰©äº¤æ¢ï¼Œä»ªå¼å³å°†å®Œæˆã€‚</p>
    `;
    optionsContainer.style.display = 'none';
    confirmBtn.style.display = 'block';

    showOverlay('oathCeremonyOverlay');
}

/**
 * å®Œæˆç»“æ‹œä»ªå¼ï¼Œåº”ç”¨æ‰€æœ‰æ•ˆæœ
 */
function completeOath() {
    const npcId = oathCeremonyState.npcId;
    const npc = gameState.npcs[npcId];
    const player = gameState.player;
    const rel = gameState.social.relationships[npcId];
    const genderTerm = player.gender === 'male' ? 'å…„å¼Ÿ' : 'å§å¦¹';
    if (oathCeremonyState.cost) {
        applyEffects({ wealth: -oathCeremonyState.cost });
    }
    if (rel) {
        rel.type = 'sworn_sibling';
        rel.level = 4;
        rel.emotionValue = (rel.emotionValue || 0) + 200;
    } else {
        gameState.social.relationships[npcId] = {
            type: 'sworn_sibling', favor: 100, emotionValue: 200, level: 4,
            eventsExperienced: (rel ? rel.eventsExperienced : 0) + 1, isSworn: true
        };
    }
    if (!gameState.social.swornSiblings) {
        gameState.social.swornSiblings = [];
    }
    if (!gameState.social.swornSiblings.includes(npcId)) {
        gameState.social.swornSiblings.push(npcId);
    }
    gameState.social.friends = (gameState.social.friends || []).filter(id => id !== npcId);
    if (oathCeremonyState.bonuses) {
        applyEffects(oathCeremonyState.bonuses);
    }
    showEventCard('ä¹‰ç»“é‡‘å…°', 'fa-hands-helping', `ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> ç„šé¦™ç»“æ‹œï¼Œä»æ­¤ç¥¸ç¦ä¸å…±ï¼Œæˆä¸ºç”Ÿæ­»ä¸ç¦»çš„${genderTerm}ï¼`);
    
    // â–¼â–¼â–¼ ã€æ–°å¢ã€‘è®°äº‹åŠŸèƒ½ â–¼â–¼â–¼
    logEvent(`ä½ ä¸ <strong class="highlight-npc">${npc.name}</strong> ä¹‰ç»“é‡‘å…°ï¼Œä»æ­¤ç¥¸ç¦ä¸å…±ã€‚`, true);
    // â–²â–²â–² ã€æ–°å¢ç»“æŸã€‘ â–²â–²â–²
    
    oathCeremonyState = {};
    closeAllOverlays();
    renderGame();
    showNPCDetails(npcId);
}
// ===================== ã€æ–°åŠŸèƒ½ä»£ç ã€‘ç¤¾äº¤ç©æ³•å‡½æ•° END =======================
// =======================================================================
// ======================= æ–°å¢ï¼šå¾’å¼Ÿæ§½ä½å‡çº§æ•°æ®ä¸åŠŸèƒ½ =====================
// =======================================================================

/**
 * å®šä¹‰å¾’å¼Ÿæ§½ä½å‡çº§çš„æ¡ä»¶å’Œæˆæœ¬
 * slot: ç›®æ ‡æ§½ä½æ•°
 * req.level: éœ€è¦è¾¾åˆ°çš„èŒä¸šç­‰çº§ (ç©å®¶çœ‹åˆ°çš„ç­‰çº§ï¼Œä¸æ˜¯ç´¢å¼•)
 * cost: éœ€è¦èŠ±è´¹çš„é“¶ä¸¤
 * desc: æ˜¾ç¤ºåœ¨æŒ‰é’®ä¸‹æ–¹çš„æè¿°æ–‡æœ¬
 */
const APPRENTICE_SLOT_UPGRADES = [
    // ç©å®¶åˆå§‹æ‹¥æœ‰ 1 ä¸ªæ§½ä½
    { slot: 2, req: { level: 3 }, cost: 5000, desc: "è§£é”ç¬¬äºŒä¸ªå¾’å¼Ÿä½ (éœ€èŒä¸šç­‰çº§è¾¾åˆ°3çº§)" },
    { slot: 3, req: { level: 5 }, cost: 20000, desc: "è§£é”ç¬¬ä¸‰ä¸ªå¾’å¼Ÿä½ (éœ€èŒä¸šç­‰çº§è¾¾åˆ°5çº§)" },
    { slot: 4, req: { level: 8 }, cost: 50000, desc: "è§£é”ç¬¬å››ä¸ªå¾’å¼Ÿä½ (éœ€èŒä¸šç­‰çº§è¾¾åˆ°8çº§)" }
];

/**
 * å¤„ç†å‡çº§å¾’å¼Ÿæ§½ä½çš„æ ¸å¿ƒå‡½æ•°
 */
function upgradeApprenticeSlot() {
    const nextSlotNumber = gameState.apprenticeSlots + 1;
    const upgradeInfo = APPRENTICE_SLOT_UPGRADES.find(u => u.slot === nextSlotNumber);

    if (!upgradeInfo) {
        showToast("å·²è¾¾åˆ°æœ€å¤§å¾’å¼Ÿæ•°é‡ã€‚");
        return;
    }

    // ç©å®¶çœ‹åˆ°çš„èŒä¸šç­‰çº§æ˜¯ career.level ç´¢å¼• + 1
    const playerCareerLevel = gameState.career.level + 1;
    const meetsLevelReq = playerCareerLevel >= upgradeInfo.req.level;
    const meetsWealthReq = gameState.finances.wealth >= upgradeInfo.cost;

    if (!meetsLevelReq) {
        showEventCard('æ¡ä»¶ä¸è¶³', 'fa-times-circle', `ä½ çš„èŒä¸šç­‰çº§å°šæœªè¾¾åˆ° ${upgradeInfo.req.level} çº§ï¼Œæ— æ³•æ‰©å……å¸ˆé—¨ã€‚`);
        return;
    }

    if (!meetsWealthReq) {
        showEventCard('æ¡ä»¶ä¸è¶³', 'fa-times-circle', `å‡çº§éœ€è¦èŠ±è´¹ ${upgradeInfo.cost} ä¸¤ï¼Œä½ çš„èµ„é‡‘ä¸è¶³ã€‚`);
        return;
    }

    // æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼Œå¼¹å‡ºç¡®è®¤çª—å£
    showDecisionCard(
        'æ‰©å……å¸ˆé—¨',
        'fa-user-plus',
        `ä½ ç¡®å®šè¦èŠ±è´¹ <span class="value">${upgradeInfo.cost}</span> ä¸¤æ¥æ‰©å……å¸ˆé—¨ï¼Œè§£é”ç¬¬ ${nextSlotNumber} ä¸ªå¾’å¼Ÿä½å—ï¼Ÿ`,
        [
            {
                htmlContent: `<i class="fas fa-check"></i> ç¡®è®¤å‡çº§`,
                callback: () => {
                    applyEffects({ wealth: -upgradeInfo.cost });
                    gameState.apprenticeSlots = nextSlotNumber;
                    showEventCard('å¸ˆé—¨å£®å¤§', 'fa-users', `ä½ æˆåŠŸæ‰©å……äº†å¸ˆé—¨ï¼Œç°åœ¨å¯ä»¥æ‹›æ”¶ ${nextSlotNumber} åå¾’å¼Ÿäº†ï¼`);
                    // å‡çº§åï¼Œç«‹åˆ»åˆ·æ–°å¾’å¼Ÿç³»ç»Ÿç•Œé¢
                    showApprenticeSystem();
                }
            },
            {
                htmlContent: `<i class="fas fa-times"></i> ç¨åå†è¯´`,
                style: `background:var(--control-bg);`,
                callback: () => closeAllOverlays()
            }
        ]
    );
}

// =======================================================================
// ===================== ã€æ–°å¢ã€‘ç«‹ç»˜åŠ è½½å¤±è´¥å¤„ç†å‡½æ•° =====================
// =======================================================================
function handleAvatarError(imgElement) {
    const maxRetries = 2;
    let retries = parseInt(imgElement.getAttribute('data-retries') || '0', 10);

    if (retries < maxRetries) {
        // ç¨ç­‰ç‰‡åˆ»åé‡è¯•ï¼Œé˜²æ­¢ç½‘ç»œæ³¢åŠ¨
        setTimeout(() => {
            // é€šè¿‡åœ¨URLåæ·»åŠ ä¸€ä¸ªéšæœºå‚æ•°æ¥å¼ºåˆ¶æµè§ˆå™¨é‡æ–°åŠ è½½ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¼“å­˜
            const originalSrc = imgElement.src.split('?')[0];
            imgElement.src = `${originalSrc}?retry=${new Date().getTime()}`;
        }, 500);
        imgElement.setAttribute('data-retries', retries + 1);
    } else {
        // é‡è¯•æ¬¡æ•°ç”¨å°½åï¼Œæ˜¾ç¤ºå¤‡ç”¨å¤´åƒ
        imgElement.style.display = 'none';
        const fallbackSvg = imgElement.nextElementSibling;
        if (fallbackSvg && fallbackSvg.classList.contains('avatar-svg')) {
            fallbackSvg.style.display = 'block';
        }
    }
}
// =======================================================================
// =================== ã€æ–°å¢ã€‘å¤©å‘½è½®å›å½•ç³»ç»Ÿ - æ•°æ® START ==================
// =======================================================================

// [ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬å®Œæ•´æ›¿æ¢] DUSTY_MIRROR_CONFIG æ•°æ®å¯¹è±¡
const DUSTY_MIRROR_CONFIG = {
    virtue: {
        name: "å¾·è¡Œä¹‹ç¢‘",
        icon: "fa-leaf",
        getData: (gs) => ({
            virtue: gs.player.attributes.virtue || 0,
            goodDeeds: gs.flags.goodDeeds || 0,
            badDeeds: gs.flags.badDeeds || 0,
            abandonedChild: gs.flags.abandonedChild || false,
            murdered: gs.flags.murdered || false
        }),
        ratings: [
            { level: 'S', name: 'å¾·ä¾”å¤©åœ°', threshold: (data) => data.virtue > 180 && data.goodDeeds > 20 && !data.abandonedChild && !data.murdered,
              desc: "æ±ä¹‹åï¼Œå·²éæœ±å¢™æ‰€èƒ½å›°ã€‚åŸä¸­å­¤å„¿è°“æ±ä¸ºäº²ï¼Œé™Œä¸Šé¥¥æ°‘è§†æ±ä¸ºç¥ã€‚ä¸‡å®¶ç”Ÿä½›ï¼Œå¾·å½°å››æµ·ã€‚çºµå²ç¬”å¦‚åˆ€ï¼Œäº¦åªèƒ½ä¸ºæ±ä¹‹ä»å–„ï¼Œä¹¦ä¸‹æœ€åç¾ä¹‹ç¯‡ç« ã€‚" },
            { level: 'A', name: 'æ€€ç‘¾æ¡ç‘œ', threshold: (data) => data.virtue > 120 && data.goodDeeds > data.badDeeds,
              desc: "ä¸€ç”Ÿè¡Œäº‹ï¼Œç£Šè½å…‰æ˜ã€‚äºå‹ï¼Œè‚èƒ†ç›¸ç…§ï¼›äºäº²ï¼Œå…³æ€€å¤‡è‡³ã€‚è™½æœªè‡³æ™®æµä¼—ç”Ÿï¼Œç„¶å†…å¿ƒä¹‹å…‰åï¼Œå·²è¶³ç…§äº®èº«è¾¹ä¹‹äººï¼Œå ªä¸ºä¸–å®¶å…¸èŒƒã€‚" },
            { level: 'B', name: 'æªå®ˆå…¶èº«', threshold: (data) => data.virtue >= 60,
              desc: "äºå–„æ¶ä¹‹é—´ï¼Œæ±å¤šæ‹©ä¸­åº¸ä¹‹é“ã€‚ä¸æ›¾è¡Œå¤§å–„ï¼Œäº¦æœªçŠ¯å¤§æ¶ã€‚ä¸€ç”Ÿå¾ªè§„è¹ˆçŸ©ï¼Œæªå®ˆæœ¬å¿ƒï¼Œå¦‚ä¸–é—´å¤§å¤šæ•°äººï¼Œå¹³å‡¡è€Œå®‰ç¨³ã€‚" },
            { level: 'C', name: 'åˆ©å·±ä¹‹å¿ƒ', threshold: (data) => data.virtue < 60 && !data.abandonedChild && !data.murdered,
              desc: "æ±ä¹‹å¤©å¹³ï¼Œå¤šå‘è‡ªèº«å€¾æ–œã€‚å¶æœ‰å–„ä¸¾ï¼Œäº¦ä¸è¿‡æƒè¡¡åˆ©å¼Šä¹‹é€‰ã€‚äºå¾·è¡Œä¸€é€”ï¼Œç»ˆç©¶æœªèƒ½æ‘†è„±åˆ©å·±ä¹‹å¿µï¼Œç•¥æœ‰ç¼ºæ†¾ã€‚" },
            { level: 'D', name: 'ä¸šæŠ¥éšè¡Œ', threshold: (data) => true,
              desc: "ä¸€æ¡ç”±å†·æ¼ ä¸è‡ªç§é“ºå°±ä¹‹è·¯ã€‚é‚£äº›å› ä½ è€Œèµ·çš„æ‚²æ³£ä¸æ€¨æ€¼ï¼Œå·²åŒ–ä½œä¸šéšœï¼Œäºè½®å›è·¯ä¸Šï¼Œå£°å£°ä¸æ¯ã€‚" }
        ]
    },
    accomplishment: {
        name: "åŠŸä¸šä¹‹é¼",
        icon: "fa-gavel",
        getData: (gs) => ({
            level: gs.career.level || 0,
            path: gs.career.path,
            hasMilestone3: gs.flags.achievedFinalMilestone || false,
            endGameTitle: gs.flags.end_game_title || null 
        }),
        ratings: [
            { level: 'S', name: 'åŠŸç›–åƒç§‹', threshold: (data) => data.hasMilestone3 || !!data.endGameTitle,
              desc: "æ±å·²ç«‹äºæ‰€å±é¢†åŸŸä¹‹å·…ã€‚äºæœå ‚ï¼Œåˆ™ä¸ºå®šå›½å®‰é‚¦ä¹‹æŸ±çŸ³ï¼›äºæ²™åœºï¼Œåˆ™ä¸ºä»¤æ•Œä¸§èƒ†ä¹‹å†›é­‚ï¼›äºå•†ç•Œï¼Œåˆ™ä¸ºå¯Œå¯æ•Œå›½ä¹‹ä¼ å¥‡ã€‚æ±ä¹‹åï¼Œå·²æ˜¯æ­¤é“ä¹‹ä¸°ç¢‘ï¼Œç™¾å¹´ä¹‹åï¼Œäº¦ä¸ºäººæ‰€ä¼ é¢‚ã€‚" },
            { level: 'A', name: 'æ˜¾èµ«ä¸€æ–¹', threshold: (data) => data.level >= 8,
              desc: "å‡­å€Ÿè¿‡äººä¹‹æ‰å¹²ï¼Œæ±äºäº‹ä¸šä¸Šå»ºæ ‘é¢‡ä¸°ã€‚å®˜å±…é«˜ä½ï¼Œæˆ–ååŠ¨ä¸€æ–¹ï¼Œä¸ºå®¶æ—å¸¦æ¥äº†æ— ä¸Šè£å…‰ã€‚è™½æœªè‡³é¡¶å³°ï¼Œç„¶å·²æ˜¯å¸¸äººéš¾ä»¥ä¼åŠä¹‹é«˜åº¦ã€‚" },
            { level: 'B', name: 'å…‹å‹¤å…‹ä¿­', threshold: (data) => data.level >= 4,
              desc: "ä¸€ç”Ÿå…¢å…¢ä¸šä¸šï¼Œäºæœ¬èŒä¹‹å†…ï¼Œæœªæ›¾æœ‰è¿‡å¤§ç–æ¼ã€‚è™½æ— æƒŠå¤©åŠ¨åœ°ä¹‹åŠŸï¼Œç„¶äº¦å‡­å·±ä¹‹åŠ›ï¼Œå®‰èº«ç«‹å‘½ï¼Œä¸ºå®¶æ—æŒ£å¾—ä¸€ä»½ä½“é¢ã€‚" },
            { level: 'C', name: 'æ€€æ‰ä¸é‡', threshold: (data) => data.path && data.level >= 1,
              desc: "ç©ºæœ‰æ»¡è…¹æ‰åï¼Œå´æ—¶è¿ä¸æµï¼Œæˆ–å›°äºäººé™…ï¼Œæˆ–å›¿äºçœ¼ç•Œï¼Œç»ˆç©¶æœªèƒ½å¤§å±•æ‹³è„šã€‚åˆå¤œæ¢¦å›ï¼Œå¯æ›¾ä¸ºè™šåº¦ä¹‹å…‰é˜´è€Œå¹æƒ‹ï¼Ÿ" },
            { level: 'D', name: 'ç¢Œç¢Œæ— ä¸º', threshold: (data) => true,
              desc: "äºäº‹ä¸šä¸€é€”ï¼Œæœªæ›¾è¸å‡ºåšå®ä¸€æ­¥ã€‚æˆ–å®‰äºç°çŠ¶ï¼Œæˆ–å¿—å¤§æ‰ç–ï¼Œä¸€ç”Ÿå…‰é˜´æµè½¬ï¼Œæœªèƒ½åœ¨ä¸–é—´ç•™ä¸‹ä»»ä½•åŠŸä¸šä¹‹ç—•è¿¹ã€‚" }
        ]
    },
    // =======================================================================
    // ====================== ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸã€‘æƒ…ç¼˜ä¹‹å· START ===================
    // =======================================================================
    bonds: {
        name: "æƒ…ç¼˜ä¹‹å·",
        icon: "fa-users",
        // [æ–°å¢åˆ¤å®š] getDataå‡½æ•°ç°åœ¨ä¼šæ”¶é›†æ›´ä¸°å¯Œçš„æ•°æ®ç”¨äºâ€œé’Ÿæƒ…â€åˆ¤å®š
        getData: (gs) => {
            const spouse = gs.marriage.isMarried ? gs.npcs[gs.marriage.spouseId] : null;
            const spouseRel = spouse ? gs.social.relationships[spouse.id] : null;
            return {
                lovers: (gs.social.secretLovers || []).length, // æƒ…äººæ•°é‡
                spouseFavor: spouse ? spouse.favor : -1000, // é…å¶å¥½æ„Ÿåº¦
                spouseRelLevel: spouseRel ? (spouseRel.level || 0) : 0, // é…å¶å…³ç³»ç­‰çº§
                divorced: gs.flags.hasDivorced || false, // æ˜¯å¦å’Œç¦»
                loverAffairExposed: gs.flags.loverAffairExposed || false, // ç§æƒ…æ˜¯å¦è´¥éœ²
            };
        },
        // [æ ¸å¿ƒä¿®æ”¹] è¯„çº§ç±»ç›®ã€åˆ¤å®šé€»è¾‘å’Œæè¿°æ–‡æœ¬å·²å…¨éƒ¨é‡å†™ï¼Œä»¥â€œé’Ÿæƒ…â€ä¸ºæ ¸å¿ƒ
        ratings: [
            { level: 'S', name: 'æƒ…æ·±ä¸æ¸', threshold: (data) => data.spouseFavor >= 95 && data.spouseRelLevel >= 4 && data.lovers === 0 && !data.divorced,
              desc: "ä¸€ç”Ÿä¸€ä»£ä¸€åŒäººï¼Œäº‰æ•™ä¸¤å¤„é”€é­‚ã€‚æ±ä¹‹æ·±æƒ…ï¼Œåšå¦‚ç£çŸ³ï¼Œæœªæ›¾ä¸ºè·¯è¾¹é£å…‰åŠ¨æ‘‡åˆ†æ¯«ã€‚äºæ•è¾¹äººï¼Œæ±ä»˜å‡ºäº†å…¨éƒ¨çœŸå¿ƒï¼Œæˆå°±äº†ä¸€æ®µä¸–é—´éš¾è§…çš„ä½³è¯ã€‚" },
            { level: 'A', name: 'ç´ç‘Ÿå’Œé¸£', threshold: (data) => data.spouseFavor >= 80 && data.spouseRelLevel >= 2 && data.lovers <= 1 && !data.divorced && !data.loverAffairExposed,
              desc: "å¤«å¦»åŒå¿ƒï¼Œå…¶åˆ©æ–­é‡‘ã€‚æ±ä¹‹ä¸€ç”Ÿï¼Œä»¥å®¶åº­ä¸ºé‡ï¼Œä¸ä¼´ä¾£ç›¸æ¿¡ä»¥æ²«ï¼Œè™½å¶æœ‰æ³¢æ¾œï¼Œç»ˆæ˜¯ä¸¾æ¡ˆé½çœ‰ï¼Œå…±åº¦ç™½é¦–ã€‚æ­¤ç­‰æƒ…ç¼˜ï¼Œäº¦æ˜¯äººé—´ä¹‹ç¦ã€‚" },
            { level: 'D', name: 'è¦†æ°´éš¾æ”¶', threshold: (data) => data.divorced || data.loverAffairExposed || data.spouseFavor <= -50,
              desc: "è–„æƒ…å¯¡ä¹‰ï¼Œç»ˆè‡³è¦†æ°´éš¾æ”¶ã€‚æˆ–å› ç§æƒ…è´¥éœ²è€Œå£°åç‹¼è—‰ï¼Œæˆ–å› å¤«å¦»åç›®è€ŒåŠ³ç‡•åˆ†é£ã€‚é•œä¸­å­¤å½±ï¼Œå½¢å•å½±åªï¼Œçš†ä¸ºæ±äº²æ‰‹æ‰€é€ ä¹‹å› æœã€‚" },
            { level: 'B', name: 'ç›¸æ•¬å¦‚å®¾', threshold: (data) => data.spouseFavor >= 40,
              desc: "ä¸æ•è¾¹ä¹‹äººï¼Œæ±åšåˆ°äº†ä»¥ç¤¼ç›¸å¾…ï¼Œç›¸æ•¬å¦‚å®¾ã€‚è™½å°‘äº†å‡ åˆ†ç—´ç¼ çˆ±æ‹ï¼Œå´ä¹Ÿç»´ç³»äº†å®¶åº­çš„ä½“é¢ä¸å¹³å’Œã€‚ä¸€ç”Ÿæ³¢æ¾œä¸æƒŠï¼Œä¹Ÿæ— åˆ»éª¨é“­å¿ƒã€‚" },
            { level: 'C', name: 'é•œèŠ±æ°´æœˆ', threshold: (data) => true,
              desc: "æ±æ²‰æ¹äºé•œèŠ±æ°´æœˆä¹‹æƒ…ï¼Œæµè¿äºèŠ±ä¸›ä¹‹é—´ï¼Œå´å¿˜äº†å®¶ä¸­ç­‰å¾…ä¹‹äººã€‚çœŸå¿ƒå‡ è®¸ï¼Œå‡æ„å‡ åˆ†ï¼Œç»ˆç©¶æ˜¯é›¾é‡Œçœ‹èŠ±ï¼Œæœªèƒ½å¯»å¾—ä¸€äººå¿ƒã€‚" }
        ]
    },
    // ====================== ã€æ ¸å¿ƒä¿®æ”¹åŒºåŸŸã€‘æƒ…ç¼˜ä¹‹å· END =====================
    // =======================================================================
    clan: {
        name: "å®¶æ—ä¹‹è°±",
        icon: "fa-sitemap",
        getData: (gs) => ({
            children: gs.children.filter(c => c.age >= 16 && !c.isDead).length,
            grandchildren: gs.children.filter(c => c.marriage.isMarried && c.marriage.grandchildTimer === -1).length,
            successfulChildren: gs.children.filter(c => c.career && c.career.path !== 'unemployed' && c.career.level >= 4).length
        }),
        ratings: [
            { level: 'S', name: 'å…°æ¡‚é½èŠ³', threshold: (data) => data.children >= 5 && data.successfulChildren >= 2 && data.grandchildren > 0,
              desc: "æ±ä¹‹è¡€è„‰ï¼Œå·²æˆå‚å¤©å¤§æ ‘ã€‚å­å­™æˆ–ä¸ºæœå ‚æ–°è´µï¼Œæˆ–ä¸ºå•†ç•Œå·¨å­ï¼Œçš†ä¸ºä¸€æ—¶ä¿Šæ°ã€‚å¼€ææ•£å¶ï¼Œæ»¡é—¨è£å…‰ã€‚æ±ä¸ºå®¶æ—ä¹‹å…´ç››ï¼Œç«‹ä¸‹äº†ä¸ä¸–ä¹‹åŠŸã€‚" },
            { level: 'A', name: 'å­å­™æ»¡å ‚', threshold: (data) => data.children >= 3,
              desc: "å„¿å­™ç»•è†ï¼Œå…±äº«å¤©ä¼¦ã€‚è™½éä¸ªä¸ªé¾™å‡¤ï¼Œç„¶äº¦å¤šæœ‰æˆæ‰è€…ï¼Œè¶³ä»¥å»¶ç»­å®¶æ—è£å…‰ã€‚æ±ä¹‹è†ä¸‹ï¼Œäººä¸å…´æ—ºï¼Œç¦æ°”ç»µå»¶ã€‚" },
            { level: 'B', name: 'å»¶ç»­é¦™ç«', threshold: (data) => data.children >= 1,
              desc: "æ±ç•™æœ‰å­å—£ï¼Œä½¿å®¶æ—å¾—ä»¥å»¶ç»­ã€‚å­©å­ä»¬å¹³å®‰æˆé•¿ï¼Œæˆå®¶ç«‹ä¸šï¼Œè™½æ— å¤§å¯Œå¤§è´µï¼Œäº¦ç®—å°½äº†ä¸ºäººçˆ¶æ¯ä¹‹è´£ã€‚" },
            { level: 'C', name: 'å­å—£å‡‹é›¶', threshold: (data) => data.children > 0 && data.successfulChildren === 0,
              desc: "æˆ–å› å­å—£ç¨€å°‘ï¼Œæˆ–å› æ•™å…»ä¸å–„ï¼Œæ±ä¹‹ä¸‹ä¸€ä»£æœªèƒ½æ‰›èµ·å®¶æ—é‡ä»»ã€‚è¡€è„‰è™½å­˜ï¼Œç„¶å®¶æ—ä¹‹æœªæ¥ï¼Œå·²ç°éšå¿§ã€‚" },
            { level: 'D', name: 'åç»§æ— äºº', threshold: (data) => data.children === 0,
              desc: "ä¸€ç”Ÿè¹‰è·ï¼Œæœªç•™åŠç‚¹è¡€è„‰äºä¸–ã€‚å®¶æ—ä¹‹ä¼ æ‰¿ï¼Œäºæ±è¿™ä¸€ä»£ï¼Œæˆ›ç„¶è€Œæ­¢ã€‚ç™¾å¹´ä¹‹åï¼Œæ— äººå†è®°æ±ä¹‹åå§“ã€‚" }
        ]
    },
    wealth: {
        name: "è´¢å¯Œä¹‹åº“",
        icon: "fa-coins",
        getData: (gs) => ({
            totalAssets: gs.finances.wealth + (gs.player.privateAssets || 0) + gs.family.moneyChest + gs.finances.assets.reduce((sum, a) => sum + (a.currentValue || 0), 0) + (gs.tradingSystem.moneyChest || 0),
            tier: gs.finances.financialTier
        }),
        ratings: [
            { level: 'S', name: 'å¯Œå¯æ•Œå›½', threshold: (data) => data.tier >= 6 && data.totalAssets > 500000,
              desc: "é‡‘ç‰æ»¡å ‚ï¼Œå¯ŒåŸ’ç‹ä¾¯ã€‚æ±ä¹‹è´¢å¯Œï¼Œè¶³ä»¥æ’¼åŠ¨å›½ä¹‹ç»æµã€‚â€˜è´¢ç¥â€™ä¹‹åï¼Œäºæ±è€Œè¨€ï¼Œéæ˜¯è™šèª‰ã€‚" },
            { level: 'A', name: 'è±ªé—¨å·¨å¯Œ', threshold: (data) => data.tier >= 5 && data.totalAssets > 100000,
              desc: "è‰¯ç”°åƒé¡·ï¼Œåå±‹ä¸‡é—´ã€‚æ±ä¹‹ä¸€ç”Ÿï¼Œäºè´¢å¯Œä¹‹é“ä¸Šï¼Œç»è¥æœ‰æ–¹ï¼Œç§¯ç´¯äº†æƒŠäººçš„å®¶ä¸šï¼Œè¶³ä»¥ä»¤å­å­™ä¸‰ä»£è¡£é£Ÿæ— å¿§ã€‚" },
            { level: 'B', name: 'æ®·å®ä¹‹å®¶', threshold: (data) => data.tier >= 3,
              desc: "åƒç©¿ä¸æ„ï¼Œå°æœ‰ç›ˆä½™ã€‚æ±å‡­å‹¤åŠ³ä¸æ™ºæ…§ï¼Œè¿‡ä¸Šäº†æ®·å®å¯Œè¶³çš„ç”Ÿæ´»ï¼Œäºå¸‚äº•ä¹‹ä¸­ï¼Œäº¦æ˜¯ä»¤äººè‰³ç¾¡ä¹‹å®¶ã€‚" },
            { level: 'C', name: 'å‹‰å¼ºåº¦æ—¥', threshold: (data) => data.tier >= 2,
              desc: "ä¸€ç”Ÿä¸ºç”Ÿè®¡æ‰€å›°ï¼Œè™½æœªè‡³é¢ æ²›æµç¦»ï¼Œç„¶äº¦æ—¶å¸¸æ‰è¥Ÿè§è‚˜ã€‚â€˜è´¢â€™ä¹‹ä¸€å­—ï¼Œç»ˆç©¶æ˜¯æ±å¿ƒä¸­æŒ¥ä¹‹ä¸å»ä¹‹æ„äº‘ã€‚" },
            { level: 'D', name: 'å€ºå°é«˜ç­‘', threshold: (data) => data.totalAssets < 0,
              desc: "å®¶å¾’å››å£ï¼Œå€ºä¸»ç›ˆé—¨ã€‚æ±éä½†æœªèƒ½ç§¯ç´¯è´¢å¯Œï¼Œåè€Œæ¬ ä¸‹ç´¯ç´¯å·¨å€ºï¼Œä¸ºå®¶æ—ç•™ä¸‹æ— å°½ä¹‹è´Ÿæ‹…ã€‚" }
        ]
    },
    talents: {
        name: "æ‰å­¦ä¹‹ç’§",
        icon: "fa-brain",
        getData: (gs) => {
            const attrs = gs.player.attributes;
            return {
                attributes: attrs,
                total: (attrs.talent || 0) + (attrs.wisdom || 0) + (attrs.charm || 0) + (attrs.etiquette || 0) + (attrs.martial || 0) + (attrs.health || 0)
            };
        },
        ratings: [
            { level: 'S', name: 'æ–‡æ­¦åŒå…¨', threshold: (data) => Object.values(data.attributes).filter(v => v > 180).length >= 2,
              desc: "æ±ä¹ƒä¸ä¸–å‡ºä¹‹å¥‡æ‰ã€‚ä¸ŠçŸ¥å¤©æ–‡ï¼Œä¸‹æ™“åœ°ç†ï¼Œæ–‡èƒ½æç¬”å®‰å¤©ä¸‹ï¼Œæ­¦èƒ½ä¸Šé©¬å®šä¹¾å¤ã€‚æ±ä¹‹å­˜åœ¨ï¼Œæœ¬èº«ä¾¿æ˜¯ä¸€æ®µä¼ å¥‡ã€‚" },
            { level: 'A', name: 'é¢–æ‚Ÿç»ä¼¦', threshold: (data) => Object.values(data.attributes).some(v => v > 150),
              desc: "äºæŸä¸€é“ï¼Œæ±æœ‰æƒŠä¸–ä¹‹æ‰ã€‚æˆ–ä¸ºæ™ºè®¡æ— åŒä¹‹è°‹å£«ï¼Œæˆ–ä¸ºé£åç»ä»£ä¹‹åå§ã€‚æ±ä¹‹æ‰åï¼Œè¶³ä»¥ä»¤ä¸–äººç©ç›®ã€‚" },
            { level: 'B', name: 'é¢‡æœ‰æ‰å¹²', threshold: (data) => data.total > 400,
              desc: "æ±äºä¿®èº«å…»æ€§ä¸Šï¼Œå°æœ‰æˆå°±ã€‚è°ˆåä¸ä¿—ï¼Œä¸¾æ­¢å¾—ä½“ï¼Œäºäººå‰æ€»èƒ½å±•ç°å‡ºè‰¯å¥½é£è²Œã€‚" },
            { level: 'C', name: 'èµ„è´¨å¹³å¹³', threshold: (data) => data.total <= 400 && data.total > 200,
              desc: "æ±ä¹‹æ‰å­¦ï¼Œä¸å¸¸äººæ— å¼‚ã€‚æœªæ›¾æœ‰è¿‡äººä¹‹å¤„ï¼Œäº¦æ— æ˜æ˜¾ä¹‹çŸ­æ¿ã€‚" },
            { level: 'D', name: 'æ„šé’é©½é©¬', threshold: (data) => true,
              desc: "äºæ‰å­¦ä¹‹é“ï¼Œæœªæ›¾ç”¨å¿ƒã€‚ä¸€ç”Ÿæµ‘æµ‘å™©å™©ï¼Œä¸è‰æœ¨åŒæœ½ã€‚" }
        ]
    }
};
const POSTHUMOUS_TITLES_CONFIG = {
    rules: [
        { condition: (r) => r.virtue === 'S' && r.accomplishment === 'S', title: 'å¾·åŠ­åŠŸå‹‹' },
        { condition: (r) => r.wealth === 'S' && r.virtue === 'D', title: 'ä¸ºå¯Œä¸ä»' },
        { condition: (r) => r.accomplishment === 'S' && r.bonds === 'D', title: 'å­¤å‚²çš„å·¨åŒ ' },
        { condition: (r) => r.clan === 'S', title: 'å…°æ¡‚é½èŠ³' },
        { condition: (r) => r.bonds === 'A' && r.talents === 'A' && ['C','D'].includes(r.accomplishment), title: 'é›…å£«é£æµ' },
        { condition: (r) => r.bonds === 'D' && r.clan === 'D', title: 'ä¸€ä¸–ä¼¶ä»ƒ' },
    ],
    defaults: {
        S: { virtue: 'åœ£å¾·', accomplishment: 'æ­¦å‹‹', bonds: 'æƒ…åœ£', clan: 'å§‹ç¥–', wealth: 'è´¢ç¥', talents: 'æ–‡å®—' },
        A: { virtue: 'ä»å–„', accomplishment: 'åŠŸä¸š', bonds: 'ä¹‰æ°”', clan: 'å…´å®¶', wealth: 'è±ªå¯Œ', talents: 'é›…æ‰' },
        C: { virtue: 'è–„å¾·', accomplishment: 'å¹³åº¸', bonds: 'å¯¡æƒ…', clan: 'å‡‹é›¶', wealth: 'è´«ä¹', talents: 'æµ…è–„' },
        D: { virtue: 'æ— é“', accomplishment: 'æ— ä¸º', bonds: 'å­¤åƒ»', clan: 'ç»å', wealth: 'èµ¤è´«', talents: 'æ„šé’' },
        B: 'å¹³å‡¡æ˜¯ç¦'
    }
};

const INHERITANCE_TALENT_TREE = {
    virtue: { name: 'å¾·è¡Œä¹‹è«', tiers: [
        { cost: 10, id: 'renxin', name: 'ä»å¿ƒ', desc: 'åˆå§‹å“å¾·+20', effects: { attributes: { virtue: 20 } } },
        { cost: 15, id: 'shanyuan', name: 'å–„ç¼˜', desc: 'åˆå§‹ä¸çˆ¶æ¯å¥½æ„Ÿåº¦+30', effects: {} }
    ]},
    accomplishment: { name: 'åŠŸä¸šä¹‹æ‰¿', tiers: [
        { cost: 15, id: 'jiaxue', name: 'å®¶å­¦æ¸Šæº', desc: 'è‹¥é€‰æ‹©ä¸ä¸Šä¸€ä»£ç›¸åŒèŒä¸šï¼Œåˆå§‹èŒä¸šç­‰çº§+1', effects: {} },
        { cost: 20, id: 'xianbei', name: 'å…ˆè¾ˆä¹‹å', desc: 'åˆå§‹å£°æœ›+80', effects: { reputation: 80 } }
    ]},
    bonds: { name: 'æƒ…ç¼˜ä¹‹ç¼˜', tiers: [
        { cost: 10, id: 'taohua', name: 'æ¡ƒèŠ±è¿', desc: 'æå‡é‡åˆ°é«˜é­…åŠ›å€¼NPCçš„å‡ ç‡', effects: { flags: { hasPeachBlossomLuck: true } } },
        { cost: 15, id: 'jiushi', name: 'æ—§æ—¶ç›¸è¯†', desc: 'å¿…å®šé‡åˆ°ä¸Šä¸€ä»£æŒšå‹çš„å­å—£ï¼Œå¹¶è·å¾—50ç‚¹åˆå§‹å¥½æ„Ÿ', effects: {} }
    ]},
    clan: { name: 'å®¶æ—ä¹‹åŸº', tiers: [
        { cost: 10, id: 'fengåš', name: 'ä¸°åšç§äº§', desc: 'åˆå§‹ä¸ªäººç§äº§å¢åŠ 5000ä¸¤', effects: { privateAssets: 5000 } },
        { cost: 20, id: 'gaomen', name: 'é«˜é—¨èµ·ç‚¹', desc: 'æ–°æ¸¸æˆå¼€å§‹æ—¶ï¼Œå®¶æ—å£°æœ›é¢å¤–+50', effects: { reputation: 50 } }
    ]},
    wealth: { name: 'è´¢å¯Œä¹‹æº', tiers: [
        { cost: 5, id: 'yichan', name: 'é—äº§ç»§æ‰¿', desc: 'ç›´æ¥ç»§æ‰¿ä¸Šä¸€ä»£æœ€ç»ˆè´¢å¯Œçš„2% (å¯é‡å¤è´­ä¹°)', effects: {}, repeatable: true, multiplier: 0.02 },
        { cost: 20, id: 'shangye', name: 'å•†ä¸šå—…è§‰', desc: 'åœ¨å•†ä¼šäº¤æ˜“å’Œäº§ä¸šæŠ•èµ„ä¸­ï¼Œæœ‰æ›´é«˜å‡ ç‡è§¦å‘æ­£é¢äº‹ä»¶', effects: { flags: { hasBusinessSense: true } } }
    ]},
    talents: { name: 'æ‰å­¦ä¹‹èµ‹', tiers: [
        { cost: 2, id: 'jichu', name: 'åŸºç¡€å±æ€§', desc: 'ä»»æ„é€‰æ‹©ä¸€é¡¹åŸºç¡€å…­ç»´å±æ€§+1 (å¯é‡å¤è´­ä¹°)', effects: {}, repeatable: true, isAttribute: true },
        { cost: 25, id: 'tianzi', name: 'å¤©èµ„èªé¢–', desc: 'æ‰€æœ‰é€šè¿‡â€œä¿®èº«â€è·å¾—çš„å±æ€§å¢åŠ 15%', effects: { flags: { isGifted: true } } }
    ]}
};

const WORLDLY_RELICS_DATA = {
    virtue: { id: 'wan_min_san', name: 'ä¸‡æ°‘ä¼', type: 'çå“', icon: 'fa-umbrella', desc: 'æŒæœ‰è€…å“å¾·æ¯æœˆè‡ªåŠ¨+1ï¼Œä¸”åœ¨ä»»ä½•åœ°åŒºéƒ½ä¸ä¼šè¢«åœ°ç—éªšæ‰°ã€‚' },
    accomplishment: { id: 'xian_bei_yin_xin', name: 'å…ˆè¾ˆå°ä¿¡', type: 'çå“', icon: 'fa-stamp', desc: 'æ ¹æ®ä¸Šä¸€ä»£çš„èŒä¸šï¼Œæä¾›å¼ºå¤§çš„è¢«åŠ¨åŠ æˆã€‚' },
    bonds: { id: 'zhi_jiao_ming_lu', name: 'çŸ¥äº¤åå½•', type: 'æ–‡ä¹¦', icon: 'fa-address-book', desc: 'å¿…å®šè§¦å‘â€œæ—§æ—¶ç›¸è¯†â€äº‹ä»¶ï¼Œä¸”ä¸æ•…äººä¹‹å­ï¼ˆæœ€å¤š3ä½ï¼‰åˆå§‹å…³ç³»ä¸ºâ€œæƒºæƒºç›¸æƒœâ€ã€‚' },
    clan: { id: 'chuan_jia_yu_pei', name: 'ä¼ å®¶ç‰ä½©', type: 'çå“', icon: 'fa-gem', desc: 'ä½©æˆ´è€…é­…åŠ›+15, ç¤¼ä»ª+15ï¼Œä¸”å­å—£è¯ç”Ÿæ—¶ï¼Œæœ‰æ›´é«˜å‡ ç‡è·å¾—æ­£é¢æ€§æ ¼ç‰¹è´¨ã€‚' },
    wealth: { id: 'ju_bao_pen_buff', name: 'èšå®ç›†çš„ä¼ è¯´', type: 'BUFF', icon: 'fa-magic', desc: 'ä¸€ä¸ªæ°¸ä¹…buffã€‚æ‰€æœ‰éä¿¸ç¦„çš„é‡‘é’±æ”¶å…¥å¢åŠ 10%ã€‚' },
    talents: { id: 'wu_zi_tian_shu', name: 'æ— å­—å¤©ä¹¦', type: 'çå“', icon: 'fa-book-dead', desc: 'æ¯å›åˆå¯è¿›è¡Œä¸€æ¬¡â€œå‚æ‚Ÿâ€ï¼Œéšæœºæå‡ä¸€é¡¹åŸºç¡€å±æ€§5-10ç‚¹ã€‚' }
};

let inheritanceState = {}; // ç”¨äºå­˜å‚¨ä¼ æ‰¿ç•Œé¢çš„ä¸´æ—¶çŠ¶æ€

// =======================================================================
// =================== ã€æ–°å¢ã€‘å¤©å‘½è½®å›å½•ç³»ç»Ÿ - å‡½æ•° START ==================
// =======================================================================

/**
 * æ¸¸æˆç»“æŸæ—¶å¯åŠ¨å¤©å‘½è½®å›å½•ç³»ç»Ÿçš„æ€»å…¥å£
 */
function startDestinyCycle() {
    const ratings = calculateDustyMirrorRatings();
    showDustyMirrorUI(ratings);
}

/**
 * è®¡ç®—å°˜ç¼˜é•œçš„å…­å¤§ç»´åº¦è¯„çº§
 * @returns {object} - åŒ…å«æ‰€æœ‰ç»´åº¦è¯„çº§ã€æ•°æ®å’Œè°¥å·çš„å¯¹è±¡
 */
function calculateDustyMirrorRatings() {
    let results = {};
    for (const key in DUSTY_MIRROR_CONFIG) {
        const config = DUSTY_MIRROR_CONFIG[key];
        const data = config.getData(gameState);
        for (const rating of config.ratings) {
            if (rating.threshold(data)) {
                results[key] = {
                    level: rating.level,
                    name: rating.name,
                    desc: rating.desc,
                    config: config
                };
                break;
            }
        }
    }
    results.posthumousTitle = generatePosthumousTitle(results);
    return results;
}

/**
 * ç”Ÿæˆè°¥å·
 * @param {object} ratings - å…­å¤§ç»´åº¦çš„è¯„çº§ç»“æœ
 * @returns {string} - æœ€ç»ˆçš„è°¥å·
 */
function generatePosthumousTitle(ratings) {
    for (const rule of POSTHUMOUS_TITLES_CONFIG.rules) {
        if (rule.condition(Object.fromEntries(Object.entries(ratings).map(([k, v]) => [k, v.level])))) {
            return rule.title;
        }
    }
    const levels = Object.values(ratings).map(r => r.level);
    if (levels.every(l => l === 'B')) return POSTHUMOUS_TITLES_CONFIG.defaults.B;

    const highestLevel = ['S', 'A', 'B', 'C', 'D'].find(l => levels.includes(l));
    const highestRatedDimension = Object.keys(ratings).find(k => ratings[k].level === highestLevel);
    
    return POSTHUMOUS_TITLES_CONFIG.defaults[highestLevel][highestRatedDimension];
}

/**
 * æ˜¾ç¤ºå°˜ç¼˜é•œUI
 * @param {object} ratings - è¯„çº§ç»“æœ
 */
function showDustyMirrorUI(ratings) {
    const overlay = document.getElementById('dustyMirrorOverlay');
    let gridHTML = '';

    for(const key in ratings) {
        if (key === 'posthumousTitle') continue;
        const data = ratings[key];
        gridHTML += `
            <div class="dimension-card">
                <div class="dimension-header">
                    <div class="dimension-rating rating-${data.level}">${data.level}</div>
                    <div class="dimension-name">${data.name}</div>
                </div>
                <div class="dimension-comment">â€œ${data.desc}â€</div>
            </div>
        `;
    }

    overlay.innerHTML = `
        <div class="overlay-card">
            <h2 class="mirror-title">å°˜ç¼˜é•œ</h2>
            <div class="posthumous-title">${ratings.posthumousTitle}</div>
            <div class="mirror-grid">${gridHTML}</div>
            <button class="control-btn" style="margin-top: 15px;" onclick='showInheritanceBookUI(${JSON.stringify(ratings)})'>
                <i class="fas fa-arrow-right"></i> å¼€å¯ã€Šæ‰¿ä¸–ä¹¦ã€‹
            </button>
        </div>
    `;
    showOverlay('dustyMirrorOverlay');
}

/**
 * æ˜¾ç¤ºæ‰¿ä¸–ä¹¦ï¼ˆç»§æ‰¿ï¼‰UI
 * @param {object} ratings - ä»å°˜ç¼˜é•œä¼ æ¥çš„è¯„çº§ç»“æœ
 */
function showInheritanceBookUI(ratings) {
    const heirs = gameState.children.filter(c => c.age >= 16 && !c.isDead);
    if (heirs.length === 0) {
        showEventCard('åç»§æ— äºº', 'fa-sad-cry', 'ä½ æ²¡æœ‰æˆå¹´çš„å­å—£å¯ä»¥ç»§æ‰¿ä½ çš„é—å¿—ï¼Œäººç”Ÿå°±æ­¤è½å¹•ã€‚', [{
            text: 'å¼€å¯å…¨æ–°äººç”Ÿ',
            callback: () => startNewGame(gameState.player.gender)
        }]);
        return;
    }
    
    // è®¡ç®—æ‰¿ä¸–ç‚¹
    const ratingPoints = { S: 60, A: 40, B: 20, C: 10, D: 0 };
    let totalPoints = Object.values(ratings).reduce((sum, r) => sum + (ratingPoints[r.level] || 0), 0);
    const finalWealth = DUSTY_MIRROR_CONFIG.wealth.getData(gameState).totalAssets;
    totalPoints += Math.floor(finalWealth / 10000);
    // è°¥å·é™„åŠ ç‚¹ (ç®€åŒ–)
    if (ratings.posthumousTitle === 'å¾·åŠ­åŠŸå‹‹') totalPoints += 50;
    if (ratings.posthumousTitle === 'ä¸ºå¯Œä¸ä»') totalPoints -= 20;

    const relics = [];
    for (const key in ratings) {
        if (ratings[key].level === 'S' && WORLDLY_RELICS_DATA[key]) {
            relics.push(WORLDLY_RELICS_DATA[key]);
        }
    }

    inheritanceState = {
        totalPoints: totalPoints,
        spentPoints: 0,
        heirs: heirs,
        selectedHeirId: null,
        relics: relics,
        chosenTalents: {},
        baseAttributePoints: 0,
    };
    
    const overlay = document.getElementById('inheritanceBookOverlay');
    overlay.innerHTML = `
        <div class="overlay-card">
            <h2 class="mirror-title">æ‰¿ä¸–ä¹¦</h2>
            <div class="overlay-content-wrapper">
                <div class="heir-selection-container">
                    <h4>é€‰æ‹©ä¸€ä½å­å—£ï¼Œç»§æ‰¿ä½ çš„é—å¿—</h4>
                    <div class="heir-list" id="heir-list-container"></div>
                </div>
                <div id="talent-tree-wrapper" style="display:none;">
                     <div class="points-display">æ‰¿ä¸–ç‚¹: <span id="points-remaining">${totalPoints}</span></div>
                     <div class="talent-tree-container" id="talent-tree-container"></div>
                </div>
                <div class="relics-container" id="relics-container"></div>
            </div>
            <button class="control-btn" id="confirm-inheritance-btn" style="margin-top: 15px; display:none;" onclick="confirmInheritance()">
                <i class="fas fa-child"></i> å¼€å¯æ–°çš„äººç”Ÿ
            </button>
        </div>
    `;
    
    renderHeirSelection();
    renderRelics();
    showOverlay('inheritanceBookOverlay');
}

function renderHeirSelection() {
    const container = document.getElementById('heir-list-container');
    container.innerHTML = inheritanceState.heirs.map(heir => `
        <div class="heir-card" id="heir-${heir.id}" onclick="selectHeir('${heir.id}')">
            <div class="avatar-wrapper" style="width: 60px; height: 60px; margin: 0 auto 5px;">
                <img src="${heir.avatar}" class="avatar-image" style="display:block;">
            </div>
            <strong>${heir.name}</strong>
        </div>
    `).join('');
}

function selectHeir(heirId) {
    inheritanceState.selectedHeirId = heirId;
    document.querySelectorAll('.heir-card').forEach(c => c.classList.remove('selected'));
    document.getElementById(`heir-${heirId}`).classList.add('selected');

    document.getElementById('talent-tree-wrapper').style.display = 'block';
    document.getElementById('confirm-inheritance-btn').style.display = 'block';
    renderTalentTree();
}

function renderTalentTree() {
    const container = document.getElementById('talent-tree-container');
    let html = '';
    for(const branchKey in INHERITANCE_TALENT_TREE) {
        const branch = INHERITANCE_TALENT_TREE[branchKey];
        html += `<div class="talent-branch"><div class="talent-branch-header">${branch.name}</div><div class="talent-tier">`;
        branch.tiers.forEach(talent => {
            const isBought = inheritanceState.chosenTalents[talent.id];
            const canAfford = inheritanceState.totalPoints - inheritanceState.spentPoints >= talent.cost;
            let buttonHTML = '';

            if(isBought) {
                buttonHTML = `<button class="btn-bought" disabled>å·²ä¹ å¾—</button>`;
            } else if (canAfford) {
                buttonHTML = `<button class="btn-buy" onclick="buyTalent('${talent.id}', ${talent.cost})">å­¦ä¹  (${talent.cost}ç‚¹)</button>`;
            } else {
                buttonHTML = `<button class="btn-locked" disabled>ç‚¹æ•°ä¸è¶³</button>`;
            }

            html += `
                <div class="talent-node">
                    <strong>${talent.name}</strong>
                    <small>${talent.desc}</small>
                    ${buttonHTML}
                </div>
            `;
        });
        html += `</div></div>`;
    }
    container.innerHTML = html;
}

function buyTalent(talentId, cost) {
    if (inheritanceState.totalPoints - inheritanceState.spentPoints < cost) return;
    
    const talentInfo = Object.values(INHERITANCE_TALENT_TREE).flatMap(b => b.tiers).find(t => t.id === talentId);
    
    // ç‰¹æ®Šå¤„ç†å¯é‡å¤è´­ä¹°çš„å±æ€§ç‚¹
    if (talentInfo.isAttribute) {
        let attrToBoost = prompt("è¦ä¸ºå“ªä¸ªå±æ€§+1ï¼Ÿï¼ˆè¯·è¾“å…¥ï¼šæ‰æƒ…, æ™ºæ…§, é­…åŠ›, ç¤¼ä»ª, æ­¦å­¦, å¥åº·, å“å¾·ï¼‰");
        const attrMapReverse = Object.fromEntries(Object.entries(ATTR_MAP).map(a => a.reverse()));
        const attrKey = attrMapReverse[attrToBoost];
        if (attrKey && gameState.player.attributes.hasOwnProperty(attrKey)) {
            inheritanceState.baseAttributePoints++;
            inheritanceState.chosenTalents[`${talentId}_${attrKey}_${inheritanceState.baseAttributePoints}`] = talentInfo.effects;
        } else {
            showToast("æ— æ•ˆçš„å±æ€§åç§°ï¼");
            return; // è´­ä¹°å¤±è´¥ï¼Œä¸æ‰£ç‚¹æ•°
        }
    } else {
        inheritanceState.chosenTalents[talentId] = talentInfo.effects;
    }
    
    inheritanceState.spentPoints += cost;
    document.getElementById('points-remaining').textContent = inheritanceState.totalPoints - inheritanceState.spentPoints;
    renderTalentTree();
}

function renderRelics() {
    const container = document.getElementById('relics-container');
    if (inheritanceState.relics.length === 0) {
        container.style.display = 'none';
        return;
    }
    container.innerHTML = `<div class="talent-branch-header">æ—·ä¸–é—ç‰© (Sçº§ç»´åº¦å¥–åŠ±)</div>` + inheritanceState.relics.map(relic => `
        <div class="relic-item">
            <div class="relic-icon"><i class="fas ${relic.icon}"></i></div>
            <div class="relic-details">
                <strong>${relic.name}</strong>
                <div class="comment">${relic.desc}</div>
            </div>
        </div>
    `).join('');
}

/**
 * ç¡®è®¤ç»§æ‰¿ï¼Œå¹¶å¼€å¯æ–°æ¸¸æˆ
 */
// [æ›¿æ¢æ­¤å‡½æ•°]
/**
 * ç¡®è®¤ç»§æ‰¿ï¼Œå¹¶å¼€å¯æ–°æ¸¸æˆ
 */
function confirmInheritance() {
    if (!inheritanceState.selectedHeirId) {
        showToast("è¯·å…ˆé€‰æ‹©ä¸€ä½ç»§æ‰¿äººã€‚");
        return;
    }
    const heirData = inheritanceState.heirs.find(h => h.id === inheritanceState.selectedHeirId);
    
    let combinedEffects = {
        attributes: {},
        flags: {},
        items: [],
        bonuses: {} // ç”¨äºå­˜å‚¨ç‰¹æ®ŠåŠ æˆ
    };

    // 1. åˆå¹¶å¤©èµ‹æ ‘æ•ˆæœ
    for (const talentId in inheritanceState.chosenTalents) {
        const effects = inheritanceState.chosenTalents[talentId];
        if (!effects) continue;
        
        if (talentId.startsWith('jichu')) { // åŸºç¡€å±æ€§ç‚¹
             const attrKey = talentId.split('_')[1];
             combinedEffects.attributes[attrKey] = (combinedEffects.attributes[attrKey] || 0) + 1;
        } else {
            // â–¼â–¼â–¼ BUGä¿®å¤ç‚¹ â–¼â–¼â–¼
            // åœ¨ä½¿ç”¨ effects.attributes å’Œ effects.flags ä¹‹å‰ï¼Œå…ˆè¿›è¡Œå®‰å…¨æ£€æŸ¥
            if (effects.attributes) {
                Object.assign(combinedEffects.attributes, effects.attributes);
            }
            if (effects.flags) {
                Object.assign(combinedEffects.flags, effects.flags);
            }
            // â–²â–²â–² ä¿®å¤ç»“æŸ â–²â–²â–²

            // å¤„ç†å…¶ä»–ç±»å‹çš„æ•ˆæœ...
            if(talentId === 'jiaxue') combinedEffects.bonuses.careerLevelBonus = 1;
            if(talentId === 'yichan') combinedEffects.bonuses.wealthMultiplier = (combinedEffects.bonuses.wealthMultiplier || 0) + 0.02;
        }
    }

    // 2. æ·»åŠ æ—·ä¸–é—ç‰©
    inheritanceState.relics.forEach(relic => {
        combinedEffects.items.push(relic);
        // å¦‚æœæ˜¯buffï¼Œç›´æ¥åŠ å…¥flags
        if (relic.type === 'BUFF') {
            combinedEffects.flags[relic.id] = true;
        }
    });
    
    // 3. å‡†å¤‡å¯åŠ¨æ–°æ¸¸æˆçš„æ•°æ®
    const inheritancePackage = {
        name: heirData.name,
        age: heirData.age,
        avatar: heirData.avatar,
        baseAttributes: heirData.attributes,
        effects: combinedEffects,
        previousCareerPath: gameState.career.path,
        previousWealth: DUSTY_MIRROR_CONFIG.wealth.getData(gameState).totalAssets
    };

    restartGame(heirData, inheritancePackage);
}
// =======================================================================
// ===================== ã€æ–°å¢ã€‘å¼ºå¤§çš„å¼€å‘è€…ä½œå¼ŠåŠŸèƒ½ =====================
// =======================================================================

/**
 * æ–°å¢åŠŸèƒ½ï¼šä¸ºå½“å‰äººç”Ÿåº”ç”¨æ‰€æœ‰â€œæ‰¿ä¸–ä¹¦â€ä¸­çš„å¤©èµ‹
 */
function debug_applyAllTalents() {
    if (!confirm("ç¡®å®šè¦ä¸ºå½“å‰äººç”Ÿåº”ç”¨æ‰€æœ‰å¤©èµ‹å—ï¼Ÿè¿™ä¼šæ¶ˆè€—å¤§é‡æ‰¿ä¸–ç‚¹ï¼ˆæ¨¡æ‹Ÿï¼‰ï¼Œå¹¶å¯èƒ½è®©æ¸¸æˆå˜å¾—ç®€å•ã€‚")) {
        return;
    }

    let effects = { attributes: {}, flags: {}, items: [], bonuses: {} };
    const baseAttrPoints = parseInt(prompt("è¦ä¸ºå…­ç»´åŸºç¡€å±æ€§ï¼ˆæ‰æƒ…ã€æ™ºæ…§ç­‰ï¼‰å„å¢åŠ å¤šå°‘ç‚¹ï¼Ÿ", "100")) || 0;

    // 1. éå†å¹¶åˆå¹¶æ‰€æœ‰å¤©èµ‹æ•ˆæœ
    for (const branchKey in INHERITANCE_TALENT_TREE) {
        INHERITANCE_TALENT_TREE[branchKey].tiers.forEach(talent => {
            if (talent.isAttribute) {
                // ä¸ºæ‰€æœ‰åŸºç¡€å±æ€§å¢åŠ ç‚¹æ•°
                Object.keys(ATTR_MAP).forEach(attrKey => {
                    if(effects.attributes[attrKey] !== undefined) {
                       effects.attributes[attrKey] = (effects.attributes[attrKey] || 0) + baseAttrPoints;
                    }
                });
            } else {
                // åˆå¹¶æ™®é€šå¤©èµ‹
                Object.assign(effects.attributes, talent.effects.attributes || {});
                Object.assign(effects.flags, talent.effects.flags || {});
                if (talent.id === 'jiaxue') effects.bonuses.careerLevelBonus = 1;
                if (talent.id === 'yichan') effects.bonuses.wealthMultiplier = (effects.bonuses.wealthMultiplier || 0) + 0.02;
            }
        });
    }

    // 2. åº”ç”¨æ•ˆæœåˆ°å½“å‰æ¸¸æˆ
    applyEffects({ attributes: effects.attributes });
    Object.assign(gameState.flags, effects.flags);

    // 3. å¤„ç†ç‰¹æ®ŠåŠ æˆ
    if (effects.bonuses.careerLevelBonus && gameState.career.path) {
        gameState.career.level = Math.min(gameState.career.level + 1, careerPaths[gameState.player.gender][gameState.career.path].levels.length - 1);
    }

    showToast("æ‰€æœ‰å¤©èµ‹å·²åº”ç”¨è‡³å½“å‰äººç”Ÿï¼");
    closeAllOverlays();
    renderGame();
}

/**
 * æ–°å¢åŠŸèƒ½ï¼šåˆ‡æ¢æ— é™è¡ŒåŠ¨ç‚¹æ¨¡å¼
 */
function toggleUnlimitedActions() {
    gameState.flags.debug_unlimitedActions = !gameState.flags.debug_unlimitedActions;
    const status = gameState.flags.debug_unlimitedActions ? "å¼€å¯" : "å…³é—­";
    showToast(`æ— é™è¡ŒåŠ¨ç‚¹æ¨¡å¼å·² ${status}ï¼`);
    // åˆ·æ–°ä¸»ç•Œé¢ä»¥æ˜¾ç¤ºæ­£ç¡®çš„å‰©ä½™æ¬¡æ•°
    if(gameState.flags.activeTab === 'main') {
        updateActiveTab('main');
    }
}

/**
 * æ–°å¢åŠŸèƒ½ï¼šè·³è¿‡å›åˆ (ç»“æŸäººç”Ÿçš„å¿«æ·æ–¹å¼)
 */
function skipTurns(numberOfTurns) {
    if (isProcessing) return;
    
    if (!confirm(`ç¡®å®šè¦è·³è¿‡ ${numberOfTurns} ä¸ªå›åˆï¼ˆ10å¹´ï¼‰å—ï¼Ÿæ¸¸æˆå°†è‡ªåŠ¨å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚`)) {
        return;
    }

    closeAllOverlays();
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');
    loadingOverlay.style.display = 'flex';
    loadingText.innerText = 'å…‰é˜´ä¼¼ç®­ï¼Œå²æœˆå¦‚æ¢­...';

    isProcessing = true;
    gameState.flags.isBatchProcessing = true; // è®¾ç½®ä¸€ä¸ªå…¨å±€æ ‡å¿—ï¼Œè®©å¼¹çª—å‡½æ•°çŸ¥é“ä¸è¦æ˜¾ç¤ºUI

    let turnsSkipped = 0;

    function processSingleTurn() {
        if (turnsSkipped >= numberOfTurns || checkEndGame()) { // å¦‚æœæ¸¸æˆå·²ç»“æŸï¼Œä¹Ÿåœæ­¢
            // æ‰€æœ‰å›åˆå¤„ç†å®Œæ¯•
            gameState.flags.isBatchProcessing = false;
            isProcessing = false;
            loadingOverlay.style.display = 'none';
            if(!checkEndGame()){
                 showToast(`æˆåŠŸè·³è¿‡äº† ${turnsSkipped / 2} å¹´ï¼`);
                 renderGame(); // æœ€ååˆ·æ–°ä¸€æ¬¡æ¸¸æˆç•Œé¢
            }
            return;
        }

        nextTurn();
        turnsSkipped++;
        loadingText.innerText = `å…‰é˜´ä¼¼ç®­... æ­£åœ¨å¤„ç†ç¬¬ ${turnsSkipped} / ${numberOfTurns} å›åˆ`;

        // ä½¿ç”¨ setTimeout åˆ›å»ºä¸€ä¸ªå¾®å°çš„å»¶è¿Ÿï¼Œä»¥é˜²æ­¢æµè§ˆå™¨å› å¯†é›†è®¡ç®—è€Œå¡æ­»
        setTimeout(processSingleTurn, 50); 
    }

    processSingleTurn();
}

// =======================================================================
// =================== ã€æ–°å¢ã€‘å¤©å‘½è½®å›å½•ç³»ç»Ÿ - å‡½æ•° END ====================
// =======================================================================
window.onload = function() {
    document.getElementById('loadingOverlay').style.display = 'flex';
    setTimeout(() => {
        initGame();
        if (!document.body.dataset.theme) {
             document.body.dataset.theme = 'spring';
        }
        updateParticles('spring');
    }, 1000);
};

</script>
</body>
</html>






